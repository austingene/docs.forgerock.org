<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head>

      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
   <title>OpenIDM Installation Guide</title><link rel="stylesheet" type="text/css" href="coredoc.css"><link rel="stylesheet" type="text/css" href="css/coredoc.css"><link rel="stylesheet" type="text/css" href="sh/css/shCore.css"><link rel="stylesheet" type="text/css" href="sh/css/shCoreEclipse.css"><link rel="stylesheet" type="text/css" href="sh/css/shThemeEclipse.css"><script src="http://code.jquery.com/jquery-1.11.0.min.js" type="text/javascript"></script><script src="uses-jquery.js" type="text/javascript"></script><script src="sh/js/shCore.js" type="text/javascript"></script><script src="sh/js/shBrushAci.js" type="text/javascript"></script><script src="sh/js/shBrushBash.js" type="text/javascript"></script><script src="sh/js/shBrushCsv.js" type="text/javascript"></script><script src="sh/js/shBrushHttp.js" type="text/javascript"></script><script src="sh/js/shBrushJava.js" type="text/javascript"></script><script src="sh/js/shBrushJScript.js" type="text/javascript"></script><script src="sh/js/shBrushLDIF.js" type="text/javascript"></script><script src="sh/js/shBrushPlain.js" type="text/javascript"></script><script src="sh/js/shBrushProperties.js" type="text/javascript"></script><script src="sh/js/shBrushXml.js" type="text/javascript"></script><script src="sh/js/shAll.js" type="text/javascript"></script><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><meta name="description" content="Guide to installing and evaluating OpenIDM. The OpenIDM project offers flexible, open source services for automating management of the identity life cycle."><script type="text/javascript">SyntaxHighlighter.all();</script>
<link rel="shortcut icon" href="http://forgerock.org/favicon.ico">
</head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div lang="en" class="book"><div class="titlepage"><div><div><h1 class="title"><a name="install-guide"></a>OpenIDM Installation Guide</h1></div><div><h2 class="subtitle">Version 3.1.0</h2></div><div><div class="authorgroup"><div class="author"><h3 class="author"><span class="firstname">Mark </span> <span class="surname">Craig</span></h3></div><div class="author"><h3 class="author"><span class="firstname">Lana </span> <span class="surname">Frost</span></h3></div><div class="author"><h3 class="author"><span class="firstname">Paul </span> <span class="surname">Bryan</span></h3></div><div class="author"><h3 class="author"><span class="firstname">Andi </span> <span class="surname">Egloff</span></h3></div><div class="author"><h3 class="author"><span class="firstname">Laszlo </span> <span class="surname">Hordos</span></h3></div><div class="author"><h3 class="author"><span class="firstname">Matthias </span> <span class="surname">Tristl</span></h3></div><div class="author"><h3 class="author"><span class="firstname">Mike </span> <span class="surname">Jang</span></h3><div lang="en" class="affiliation"><span class="orgname">ForgeRock AS<br></span><div class="address"><p><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="street">33&nbsp;New&nbsp;Montgomery&nbsp;St.</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="otheraddr">Suite&nbsp;1500</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="city">San&nbsp;Francisco</span>,&nbsp;<span class="state">CA</span>&nbsp;<span class="postcode">94105</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="country">USA</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="phone">+1&nbsp;415-599-1100&nbsp;(US)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<code class="uri">www.forgerock.com</code><br>
&nbsp;&nbsp;&nbsp;</p></div></div></div></div></div><div><p class="releaseinfo">Software release date: December 3, 2014</p></div><div><p class="copyright">Copyright &copy; 2011-2014 ForgeRock AS</p></div><div><a href="legalnotice.html">Legal Notice</a></div><div><p class="pubdate">Publication date: December&nbsp;03,&nbsp;2014</p></div><div><div class="abstract"><div class="abstract-title">Abstract</div><p>Guide to installing and evaluating OpenIDM. The OpenIDM project offers
   flexible, open source services for automating management of the identity
   life cycle.</p></div></div></div><hr></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="preface"><a href="#preface">Preface</a></span></dt><dt><span class="chapter"><a href="#chap-install">1. Installing OpenIDM Services</a></span></dt><dt><span class="chapter"><a href="#chap-sample">2. First OpenIDM Sample</a></span></dt><dt><span class="chapter"><a href="#chap-samples">3. More OpenIDM Samples</a></span></dt><dt><span class="chapter"><a href="#chap-repository">4. Installing a Repository For Production</a></span></dt><dt><span class="chapter"><a href="#chap-uninstall">5. Removing and Moving OpenIDM Software</a></span></dt><dt><span class="chapter"><a href="#chap-upgrade">6. Migrating to OpenIDM 3.1.0</a></span></dt><dt><span class="glossary"><a href="#openidm-glossary">OpenIDM Glossary</a></span></dt><dt><span class="index"><a href="#d4757e7824">Index</a></span></dt></dl></div><div lang="en" class="preface"><div class="titlepage"><div><div><h1 class="title"><a name="preface"></a>Preface</h1></div></div></div><p>This guide shows you how to install core OpenIDM services for identity
 management, provisioning, and compliance. Unless you are planning a throwaway
 evaluation or test installation, read the <a href="../release-notes/index.html#release-notes" class="link"><em class="citetitle">Release
 Notes</em></a> before you get started.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d4757e187"></a>1.&nbsp;Who Should Use this Guide</h2></div></div></div><p>This guide is written for anyone installing OpenIDM to manage and to
  provision identities, and to ensure compliance with identity management
  regulations.</p><p>This guide covers the install and removal (uninstall)
  procedures that you theoretically perform only once per version. This
  guide aims to provide you with at least some idea of what happens
  behind the scenes when you perform the steps.</p><p>This guide also takes you through all of the samples provided with
  OpenIDM.</p><p>You do not need to be an OpenIDM wizard to learn something from
  this guide, though a background in identity management and maintaining
  web application software can help. You do need some background in
  managing services on your operating systems and in your application
  servers. You can nevertheless get started with this guide, and then
  learn more as you go along.</p><p>If you have a previous version of OpenIDM installed, see the 
  <a href="../release-notes/index.html#chap-compatibility" class="link">
  <em class="citetitle">Compatibility</em></a> section of the 
  <em class="citetitle">Release Notes</em> before installing this version.</p></div><div lang="en" class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="formatting-conventions"></a>2.&nbsp;Formatting Conventions</h2></div></div></div><p>
  Most examples in the documentation are created on GNU/Linux or Mac OS X.

  Where it is helpful to make a distinction between operating environments,
  examples for UNIX, GNU/Linux, Mac OS X, and so forth are labeled (UNIX).
  Mac OS X specific examples can be labeled (Mac OS X).
  Examples for Microsoft Windows can be labeled (Windows).

  To avoid repetition, however, file system directory names are
  often given only in UNIX format as in <code class="filename">/path/to/server</code>,
  even if the text applies to <code class="filename">C:\path\to\server</code> as well.
 </p><p>
  Absolute path names usually begin with the placeholder
  <code class="filename">/path/to/</code>.

  This path might translate to <code class="filename">/opt/</code>,
  <code class="filename">C:\Program Files\</code>, or somewhere else on your system.
 </p><p>
  Command line, terminal sessions are formatted as follows.
 </p><div class="screen"><pre>$ <strong>echo $JAVA_HOME</strong>
<em>/path/to/jdk</em></pre></div><p>
  Command output is sometimes formatted for narrower, more readable output
  even though formatting parameters are not shown in the command.
  In the following example, the query string parameter
  <code class="literal">_prettyPrint=true</code> is omitted.
 </p><div class="screen"><pre>
$ <strong>curl https://bjensen:hifalutin@opendj.example.com:8443/users/newuser</strong>
<em>{
  "_rev" : "000000005b337348",
  "schemas" : [ "urn:scim:schemas:core:1.0" ],
  "contactInformation" : {
    "telephoneNumber" : "+1 408 555 1212",
    "emailAddress" : "newuser@example.com"
  },
  "_id" : "newuser",
  "name" : {
    "familyName" : "New",
    "givenName" : "User"
  },
  "userName" : "newuser@example.com",
  "displayName" : "New User",
  "meta" : {
    "created" : "2014-06-03T09:58:27Z"
  },
  "manager" : [ {
    "_id" : "kvaughan",
    "displayName" : "Kirsten Vaughan"
  } ]
}</em>
 </pre></div><p>
  Program listings are formatted as follows.
 </p><pre class="brush: java;">class Test {
    public static void main(String [] args)  {
        System.out.println("This is a program listing.");
    }
}</pre></div><div lang="en" class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="accessing-doc-online"></a>3.&nbsp;Accessing Documentation Online</h2></div></div></div><p>
  ForgeRock core documentation, such as what you are now reading, aims to be
  technically accurate and complete with respect to the software documented.
 </p><div class="itemizedlist"><p>
   Core documentation therefore follows a three-phase review process
   designed to eliminate errors.
  </p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
    Product managers and software architects review project documentation design
    with respect to the users' software lifecycle needs.
   </p></li><li class="listitem"><p>
    Subject matter experts review proposed documentation changes for
    technical accuracy and completeness
    with respect to the corresponding software.
   </p></li><li class="listitem"><p>
    Quality experts validate implemented documentation changes for
    technical validity with respect to the software,
    technical completeness with respect to the scope of the document,
    and usability for the expected audience.
   </p></li></ul></div><p>
  The review process helps to ensure that documentation published for
  a ForgeRock release is technically accurate and complete.
 </p><p>
  Fully reviewed, published core documentation is available at
  <a class="link" href="http://docs.forgerock.org/" target="_blank">http://docs.forgerock.org/</a>.

  Use this documentation when working with a ForgeRock Enterprise release.
 </p><p>
  In-progress documentation can be found at each project site under the
  <a class="link" href="http://forgerock.org" target="_blank">Developer Community</a> projects page.

  Use this documentation when trying a nightly build.
 </p><p>
  The ForgeRock <a class="link" href="https://wikis.forgerock.org/" target="_blank">Community Wikis</a> and provide additional, user-created information.

  We encourage you to
  <a class="link" href="https://sso.forgerock.com/openam/UI/Login" target="_blank">join the community</a>, so that you can update the Wikis, too.
 </p></div><div lang="en" class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="joining-the-community"></a>4.&nbsp;Joining the ForgeRock Community</h2></div></div></div><p>
  After you
  <a class="link" href="https://backstage.forgerock.com/#/account/register" target="_blank">sign up</a> to join the ForgeRock community,
  you can edit the
  <a class="link" href="https://wikis.forgerock.org/" target="_blank">Community Wikis</a>,
  and also log bugs and feature requests in the
  <a class="link" href="https://bugster.forgerock.org/" target="_blank">issue tracker</a>.
 </p><p>
  If you have a question regarding a project but cannot find an answer
  in the project documentation or Wiki, browse to the
  <a class="link" href="http://forgerock.org" target="_blank">Developer Community</a> page for the project,
  where you can find details on joining the project mailing lists,
  and find links to mailing list archives.

  You can also suggest updates to documentation through the
  <a class="link" href="https://lists.forgerock.org/mailman/listinfo/docs" target="_blank">ForgeRock docs mailing list</a>.
 </p><p>
  The Community Wikis describe how to check out and build source code.

  Should you want to contribute a patch, test, or feature,
  or want to author part of the core documentation,
  first have a look on the ForgeRock site at
  <a class="link" href="http://forgerock.org/get_involved.html" target="_blank">how to get involved</a>.
 </p></div></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-install"></a>Chapter&nbsp;1.&nbsp;Installing OpenIDM Services</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="section"><a href="#before-you-start">1.1. Before You Run OpenIDM</a></span></dt><dt><span class="section"><a href="#installing-openidm">1.2. Installing and Running OpenIDM</a></span></dt><dt><span class="section"><a href="#first-steps-with-rest">1.3. To Get Started With the OpenIDM REST Interface</a></span></dt><dt><span class="section"><a href="#openidm-uis">1.4. OpenIDM User Interfaces</a></span></dt></dl></div><p>
  This chapter covers the tasks required to install and start OpenIDM.
 </p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="before-you-start"></a>1.1.&nbsp;Before You Run OpenIDM</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#java-prerequisites">1.1.1. Java Environment</a></span></dt><dt><span class="section"><a href="#application-container-prerequisites">1.1.2. Application Container</a></span></dt></dl></div><p>
   This section covers what you need to know before running OpenIDM.
  </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="java-prerequisites"></a>1.1.1.&nbsp;Java Environment</h3></div></div></div><a class="indexterm" name="d4757e336"></a><p>
    This release of OpenIDM requires Java Development Kit 6 or Java Development
    Kit 7. ForgeRock recommends the most recent update of Java 6 or 7 to ensure
    that you have the latest security fixes.
   </p><p>
    In addition, on Windows systems, you must set the
    <code class="literal">JAVA_HOME</code> environment variable to point to the root of a
    valid Java installation. The following steps indicate how to set the
    <code class="literal">JAVA_HOME</code> environment variable on Windows Server 2008 R2.
    Adjust the steps for your specific environment.
   </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
      Locate your JRE Installation Directory. If you have not changed the
      installation path for the Java Runtime Environment during installation, it
      will be in a directory under <code class="literal">C:\Program Files\Java\</code>.
     </p></li><li class="listitem"><p>
      Select Start &gt; Control Panel &gt; System and Security &gt; System.
     </p></li><li class="listitem"><p>
      Click Advanced System Settings.
     </p></li><li class="listitem"><p>
      Click Environment Variables.
     </p></li><li class="listitem"><p>
      Under System Variables, click New.
     </p></li><li class="listitem"><p>
      Enter the Variable name (<code class="literal">JAVA_HOME</code>) and set the
      Variable value to the JRE installation directory, for example
      <code class="literal">C:\Program Files\Java\jre7</code>.
     </p></li><li class="listitem"><p>
      Click OK.
     </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="application-container-prerequisites"></a>1.1.2.&nbsp;Application Container</h3></div></div></div><a class="indexterm" name="d4757e385"></a><p>
    OpenIDM services run in an OSGi container with an embedded Servlet
    container, and an embedded noSQL database. By default the OSGi container is
    Apache Felix. The default Servlet container is Jetty. For OpenIDM
    3.1.0, the only supported configuration is running
    the services in Apache Felix and Jetty.
   </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="installing-openidm"></a>1.2.&nbsp;Installing and Running OpenIDM</h2></div></div></div><p>
    Follow the procedures in this section to install and run OpenIDM.
   </p><div class="procedure"><a name="install-openidm"></a><div class="procedure-title">Procedure&nbsp;1.1.&nbsp;To Install OpenIDM Services</div><a class="indexterm" name="d4757e400"></a><p>
     Follow these steps to install OpenIDM.
    </p><ol class="procedure" type="1"><li class="step"><p>
      Make sure you have an appropriate version of Java installed.
     </p><div class="screen"><pre><strong>$ java -version</strong>
      <em>
java version "1.6.0_24"
Java(TM) SE Runtime Environment (build 1.6.0_24-b07-334)
Java HotSpot(TM) 64-Bit Server VM (build 19.1-b02-334, mixed mode)</em>
     </pre></div><p>
      Check the release notes for Java requirements in the chapter, <a href="../release-notes/index.html#chap-before-you-install" class="link"><em class="citetitle">Before You
     Install OpenIDM Software</em></a>.
     </p></li><li class="step"><a class="indexterm" name="d4757e422"></a><div class="itemizedlist"><p>
       Download OpenIDM from one of the following locations:
      </p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        The <a class="link" href="http://www.forgerock.com/download-stack/" target="_blank">
        Forgerock.com Download</a> page has the latest stable, supported
        release of OpenIDM Enterprise, along with the other products in the
        ForgeRock Identity Platform.
       </p></li><li class="listitem"><p>
        <a class="link" href="http://forgerock.org/openidm.html" target="_blank">
        Builds</a> includes the nightly build and the OpenIDM agents. Note
        that this is the working version of the trunk and should not be used in
        a production environment.
       </p></li><li class="listitem"><p>
        <a class="link" href="http://forgerock.org/openidm-archive.html" target="_blank">
        Archives</a> includes the stable builds for all previous releases of
        OpenIDM.
       </p></li></ul></div></li><li class="step"><p>
      Unpack the contents of the .zip file into the install location.
     </p><div class="screen"><pre><strong>$ cd /path/to
$ unzip ~/Downloads/openidm-3.1.0.zip
      </strong>
      <em>
...
inflating: openidm/connectors/scriptedsql-connector-1.4.1.0.jar
inflating: openidm/bin/felix.jar
inflating: openidm/bin/openidm.jar</em>
     </pre></div></li><li class="step"><p>
      By default, OpenIDM listens for HTTP and HTTPS connections on ports 8080
      and 8443, respectively. To change the default port, edit the
      <code class="filename">/path/to/openidm/conf/boot/boot.properties</code> file. For
      more information, see <a href="../integrators-guide/index.html#appendix-ports-used" class="link"><em class="citetitle">Ports Used</em></a>
      in the <em class="citetitle">Integrator's Guide</em>.
     </p></li><li class="step"><a class="indexterm" name="d4757e470"></a><p>Before running OpenIDM in production, replace the default OrientDB
     repository provided for evaluation with a JDBC repository.</p><p>See the chapter on <a href="../install-guide/index.html#chap-repository" class="link"><em class="citetitle">Installing
     a Repository For Production</em></a> for details.</p></li></ol></div><div class="procedure"><a name="run-openidm"></a><div class="procedure-title">Procedure&nbsp;1.2.&nbsp;To Start OpenIDM Services</div><a class="indexterm" name="d4757e486"></a><p>Follow these steps to run OpenIDM interactively.</p><p>To run OpenIDM as a background process, see <a href="../integrators-guide/index.html#chap-services" class="link"><em class="citetitle">Starting and
    Stopping OpenIDM</em></a> in the <em class="citetitle">Integrator's
    Guide</em>.</p><ol class="procedure" type="1"><li class="step"><p>Start the Felix container, load all OpenIDM services, and start a
     command shell to allow you to manage the container.</p><ul class="stepalternatives">
      <li class="step"><p>Start OpenIDM (UNIX).</p><div class="screen"><pre><strong>$ ./startup.sh</strong>
        <em>
Using OPENIDM_HOME:   /path/to/openidm
Using OPENIDM_OPTS:   -Xmx1024m -Xms1024m
Using LOGGING_CONFIG:
 -Djava.util.logging.config.file=/path/to/openidm/conf/logging.properties
Using boot properties at /path/to/openidm/conf/boot/boot.properties
OpenIDM version "3.1.0" (revision: XXXX)
-&gt; OpenIDM ready
        </em>
       </pre></div></li>
      <li class="step"><p>Start OpenIDM (Windows).</p><div class="screen"><pre><strong>C:\&gt; cd \path\to\openidm
C:\&gt; startup.bat
        </strong>
        <em>
"Using OPENIDM_HOME:   \path\to\openidm"
"Using OPENIDM_OPTS:   -Xmx1024m -Xms1024m -Dfile.encoding=UTF-8"
"Using LOGGING_CONFIG:
 -Djava.util.logging.config.file=\path\to\openidm\conf\logging.properties"
Using boot properties at \path\to\openidm\conf\boot\boot.properties
OpenIDM version "3.1.0" (revision: XXXX)
-&gt; OpenIDM ready
-&gt;
        </em>
       </pre></div></li>
     </ul><p>At the resulting <code class="literal">-&gt;</code> prompt, you can enter
     commands such as <span class="command"><strong>help</strong></span> for usage, or
     <span class="command"><strong>ps</strong></span> to view the bundles installed. To see a list of all
     the OpenIDM core services and their states, enter the following
     command.</p><div class="screen"><pre><strong>-&gt; scr list</strong>
      <em>
   Id   State          Name
[  12] [active       ] org.forgerock.openidm.endpoint
[  13] [active       ] org.forgerock.openidm.endpoint
[  14] [active       ] org.forgerock.openidm.endpoint
[  15] [active       ] org.forgerock.openidm.endpoint
[  16] [active       ] org.forgerock.openidm.endpoint
[  17] [active       ] org.forgerock.openidm.endpoint
[  23] [unsatisfied  ] org.forgerock.openidm.info
[  27] [active       ] org.forgerock.openidm.provisioner.openicf.connectorinfoprovider
[  35] [active       ] org.forgerock.openidm.ui.simple
[  29] [active       ] org.forgerock.openidm.restlet
[   3] [active       ] org.forgerock.openidm.repo.orientdb
[   7] [active       ] org.forgerock.openidm.scope
[   5] [active       ] org.forgerock.openidm.audit
[  32] [active       ] org.forgerock.openidm.schedule
[   2] [unsatisfied  ] org.forgerock.openidm.repo.jdbc
[  31] [active       ] org.forgerock.openidm.workflow
[   9] [active       ] org.forgerock.openidm.managed
[  28] [active       ] org.forgerock.openidm.provisioner.openicf
[  22] [active       ] org.forgerock.openidm.health
[  26] [active       ] org.forgerock.openidm.provisioner
[   0] [active       ] org.forgerock.openidm.config.starter
[  34] [active       ] org.forgerock.openidm.taskscanner
[  20] [active       ] org.forgerock.openidm.external.rest
[   6] [active       ] org.forgerock.openidm.router
[  33] [active       ] org.forgerock.openidm.scheduler
[  19] [unsatisfied  ] org.forgerock.openidm.external.email
[  11] [active       ] org.forgerock.openidm.sync
[  25] [active       ] org.forgerock.openidm.policy
[   8] [active       ] org.forgerock.openidm.script
[  10] [active       ] org.forgerock.openidm.recon
[   4] [active       ] org.forgerock.openidm.http.contextregistrator
[   1] [active       ] org.forgerock.openidm.config
[  18] [active       ] org.forgerock.openidm.endpointservice
[  30] [unsatisfied  ] org.forgerock.openidm.servletfilter
[  24] [active       ] org.forgerock.openidm.infoservice
[  21] [active       ] org.forgerock.openidm.authentication
-&gt;
      </em>
     </pre></div><p>A default startup does not include certain configurable services, 
     which will indicate an <code class="literal">unsatisfied</code> state until they 
     are included in the configuration. As you work through the sample 
     configurations described later in this guide, you will notice that these 
     services are active.</p><p>Startup errors and messages are logged to the console by default.
     You can also view these messages in the log files at
     <code class="filename">/path/to/openidm/logs</code>.</p></li><li class="step"><p>Alternatively, you can manage the container and services from the
     Felix administration console.</p><div class="itemizedlist"><p>Use these hints to connect to the console.</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Default Console URL: <a class="link" href="https://localhost:8443/system/console" target="_blank">https://localhost:8443/system/console</a></p></li><li class="listitem"><p>Default user name: <code class="literal">admin</code></p></li><li class="listitem"><p>Default password: <code class="literal">admin</code></p></li></ul></div><div class="itemizedlist"><p>Some basic hints on using the Felix administration console
      follow.</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Select the Components tab to see OpenIDM core services and their
       respective states.</p></li><li class="listitem"><p>Select the Shell tab to access the <code class="literal">-&gt;</code>
       prompt.</p></li><li class="listitem"><p>Select the System Information tab to stop or restart the
       container.</p></li></ul></div></li></ol></div><div class="procedure"><a name="stop-openidm"></a><div class="procedure-title">Procedure&nbsp;1.3.&nbsp;To Stop the OpenIDM Services</div><a class="indexterm" name="d4757e593"></a><ul class="procedure"><li class="step"><p>You can stop OpenIDM Services from the <code class="literal">-&gt;</code>
      prompt, or through the Felix console.</p><ul class="stepalternatives">
      <li class="step"><p>Either enter the <span class="command"><strong>shutdown</strong></span> command at the
        <code class="literal">-&gt;</code> prompt.</p><div class="screen"><pre>-&gt; shutdown
...
$</pre></div></li>
      <li class="step"><p>Or click Stop on the System Information tab of the Felix console,
        by default <a class="link" href="http://localhost:8080/system/console" target="_blank">http://localhost:8080/system/console</a>.</p><p>This stops the Servlet container as well, and the console is
        no longer accessible.</p></li>
      <li class="step"><p>
        On Unix systems, you can stop OpenIDM by using the
        <span class="command"><strong>shutdown.sh</strong></span> script, located in the
        <code class="filename">/path/to/openidm</code> directory.
       </p><div class="screen"><pre><strong>$ ./shutdown.sh</strong>
<em>./shutdown.sh
Stopping OpenIDM (31391)</em></pre></div></li>
     </ul></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="first-steps-with-rest"></a>1.3.&nbsp;To Get Started With the OpenIDM REST Interface</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#rest-output-format">1.3.1. Format REST Output for Readability</a></span></dt></dl></div><a class="indexterm" name="d4757e643"></a><p>
     OpenIDM provides RESTful access to users in the OpenIDM repository. To
     access the OpenIDM repository over REST, you can use a browser-based REST
     client, such as the
     <a class="link" href="https://chrome.google.com/webstore/detail/simple-rest-client/fhjcajmcbmldlhcimfajhfbgofnpcjmb" target="_top">
     Simple REST Client</a> for Chrome, or <a class="link" href="https://addons.mozilla.org/en-US/firefox/addon/restclient/" target="_top">
     RESTClient</a> for Firefox. Alternatively you can use the
     <span class="command"><strong>curl</strong></span> command-line utility that is included with most
     operating systems. For more information about <span class="command"><strong>curl</strong></span>, see
     <a class="link" href="https://github.com/bagder/curl" target="_top">https://github.com/bagder/curl</a>.
    </p><p>
     OpenIDM is accessible over the regular and secure HTTP ports of the Jetty
     Servlet container, 8080 and 8443.
    </p><p>
     If you want to run <span class="command"><strong>curl</strong></span> over the secure port, 8443, you
     must either include the <span class="command"><strong>--insecure</strong></span> option, or follow the
     instructions shown in
     <a href="../integrators-guide/index.html#rest-over-https" class="link"><em class="citetitle">Restrict
     REST Access to the HTTPS Port</em></a>. You can use those
     instructions with the self-signed certificate that is generated when
     OpenIDM starts, or with a <code class="filename">*.crt</code> file provided by a
     certificate authority.
    </p><p>
     In numerous cases, <span class="command"><strong>curl</strong></span> commands to the secure port
     are depicted with a <code class="literal">--cacert self-signed.crt</code> option.
     Instructions for creating that <code class="filename">self-signed.crt</code> file
     are shown in the aforementioned section on <a href="../integrators-guide/index.html#rest-over-https" class="link"><em class="citetitle">Restrict
     REST Access to the HTTPS Port</em></a>.
    </p><p>
     If you would rather use <span class="command"><strong>curl</strong></span> to connect to the regular
     HTTP port, omit the <code class="literal">--cacert self-signed.crt</code> file and
     point to a regular Jetty HTTP URL such as
     <code class="literal">http://localhost:8080/openidm/...</code>.
    </p><div class="note"><h3 class="title">Note</h3><p>
      All RESTful command line examples in this guide, as depicted with
      <span class="command"><strong>curl</strong></span>, are based on the default configuration of
      OpenIDM. If you change configuration files in directories such as
      <code class="filename">openidm/conf</code> and <code class="filename">openidm/script</code>,
      you might need to modify the RESTful commands to reflect those changes.
     </p><p>
      Most of the examples in this guide use client-assigned IDs when creating
      resources, as it makes the examples easier to read.
     </p><p>
      In general, server-assigned UUIDs are better in production, as they can be
      generated easily in clustered environments.
     </p></div><div class="procedure"><a name="first-rest-steps"></a><ol class="procedure" type="1"><li class="step"><p>Access the following URL to obtain the JSON representation of all
     users in the OpenIDM repository.</p><div class="screen"><pre>$ curl \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 http://localhost:8080/openidm/managed/user/?_queryId=query-all-ids</pre></div><p>When you first install OpenIDM with an empty repository, no users
     exist.</p></li><li class="step"><p>Create a user <code class="literal">joe</code> by sending a RESTful POST.</p><p>The following <span class="command"><strong>curl</strong></span> commands create the user
     <code class="literal">joe</code> in the repository.</p><ul class="stepalternatives">
      <li class="step"><p>Create <code class="literal">joe</code> (UNIX).</p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "Content-Type: application/json" \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request POST \
 --data '{ \
 "userName":"joe", \
 "givenName":"joe", \
 "sn":"smith", \
 "mail":"joe@example.com", \
 "telephoneNumber":"555-123-1234", \
 "password":"TestPassw0rd", \
 "description":"My first user", \
 "_id":"joe" \
 }' \
 https://localhost:8443/openidm/managed/user?_action=create</strong>
        <em>
{
  "userName": "joe",
  "stateProvince": "",
  "postalAddress": "",
  "effectiveAssignments": {},
  "roles": [
    "openidm-authorized"
  ],
  "telephoneNumber": "555-123-1234",
  "password": {
    "$crypto": {
      "value": {
        "key": "openidm-sym-default",
        "iv": "gTcveNaZdSHE1qeBgcmzRw==",
        "cipher": "AES/CBC/PKCS5Padding",
        "data": "X9sCuuvNwSbblxdqS65qxw=="
      },
      "type": "x-simple-encryption",
    }
  },
  "effectiveRoles": [
    "openidm-authorized"
  ],
  "givenName": "joe",
  "address2": "",
  "lastPasswordAttempt": "Tue Feb 25 2014 18:03:40 GMT-0800 (PST)",
  "passwordAttempts": "0",
  "sn": "smith",
  "mail": "joe@example.com",
  "country": "",
  "city": "",
  "_rev": "1",
  "lastPasswordSet": "",
  "postalCode": "",
  "accountStatus": "active",
  "description": "My first user",
  "_id":"joe"
}        </em>
       </pre></div></li>
      <li class="step"><p>Create <code class="literal">joe</code> (Windows).</p><div class="screen"><pre>C:\&gt; curl ^
 --cacert self-signed.crt ^
 --header "Content-Type: application/json" ^
 --header "X-OpenIDM-Username: openidm-admin" ^
 --header "X-OpenIDM-Password: openidm-admin" ^
 --request POST ^
 --data "{ ^
 \"userName\":\"joe\", ^
 \"givenName\":\"joe\", ^
 \"sn\":\"smith\", ^
 \"mail\":\"joe@example.com\", ^
 \"telephoneNumber\":\"555-123-1234\", ^
 \"password\":\"TestPassw0rd\", ^
 \"description\":\"My first user\" ^
 \"_id\":\"joe\" ^
 }" ^
 https://localhost:8443/openidm/managed/user?_action=create</pre></div></li>
     </ul></li><li class="step"><p>Fetch the newly created user from the repository with a RESTful
     GET.</p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 https://localhost:8443/openidm/managed/user/joe
     </strong>
     <em>
{
  "effectiveAssignments": {},
  "effectiveRoles": [
    "openidm-authorized"
  ],
  "stateProvince": "",
  "userName": "joe",
  "postalAddress": "",
  "givenName": "joe",
  "address2": "",
  "lastPasswordAttempt": "Tue Feb 25 2014 18:13:03 GMT-0800 (PST)",
  "passwordAttempts": "0",
  "sn": "smith",
  "mail": "joe@example.com",
  "_rev": "1",
  "_id": "joe",
  "country": "",
  "city": "",
  "lastPasswordSet": "",
  "postalCode": "",
  "description": "My first user",
  "accountStatus": "active",
  "telephoneNumber": "555-123-1234",
  "roles": [
    "openidm-authorized"
  ]
}</em></pre></div></li><li class="step"><p>
      Notice that more attributes are returned for user <code class="literal">joe</code>
      than the attributes you added in the previous step. The additional
      attributes are added by a script named
      <code class="literal">onCreate-user-set-default-fields.js</code> that is triggered
      when a new user is created. For more information, see <a href="../integrators-guide/index.html#managed-object-configuration" class="link"><em class="citetitle">Managed Object
      Configuration</em></a> in the <em class="citetitle">Integrator's
      Guide</em>.
     </p><p>
      When you create a user some attributes might be required by the policy
      associated with that user. These are listed in the
      <code class="filename">conf/policy.json</code> file.
     </p></li></ol></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="rest-output-format"></a>1.3.1.&nbsp;Format REST Output for Readability</h3></div></div></div><p>
     With all <span class="command"><strong>curl</strong></span>-based REST calls, OpenIDM returns the JSON
     object all on one line.
    </p><p>
     Without a bit of help, the JSON output is formatted all on one line. One
     example is shown below, and it is difficult to read:
    </p><div class="screen"><pre>
     <em>
      {"mail":"joe@example.com","sn":"smith","passwordAttempts":"0",
      "lastPasswordAttempt":"Mon Apr 14 2014 11:13:37 GMT-0800 (GMT-08:00)",
      "address2":"","givenName":"joe","effectiveRoles":["openidm-authorized"],
      "password":{"$crypto":{"type":"x-simple-encryption","value":{"data":
      "OBFVL9cG8uaLoo1N+SMJ3g==","cipher":"AES/CBC/PKCS5Padding","iv":
      "7rlV4EwkwdRHkt19F8g22A==","key":"openidm-sym-default"}}},"country":"",
      "city":"","_rev":"1","lastPasswordSet":"","postalCode":"","_id":"joe3",
      "description":"My first user","accountStatus":"active","telephoneNumber":
      "555-123-1234","roles":["openidm-authorized"],"effectiveAssignments":{},
      "postalAddress":"","stateProvince":"","userName":"joe3"}
     </em>
    </pre></div><p>
     At least two options are available to clean up this output.
    </p><p>
     The standard way to format JSON output is with a JSON parser such as
     <a class="link" href="http://stedolan.github.io/jq/" target="_top">jq</a>. You would
     "pipe" the output of a REST call to <span class="command"><strong>jq</strong></span>, as follows:
    </p><div class="screen"><pre>$<strong> curl \
--cacert self-signed.crt \
--header "X-OpenIDM-Username: openidm-admin" \
--header "X-OpenIDM-Password: openidm-admin" \
--request GET \
"https://localhost:8443/openidm/managed/user/joe" \
| jq .
     </strong>
    </pre></div><p>
     The ForgeRock REST API includes an optional <code class="literal">_prettyPrint</code>
     request parameter. The default value is <code class="literal">false</code>. To
     use the ForgeRock REST API to format output, add a parameter such as
     <code class="literal">?_prettyPrint=true</code> or
     <code class="literal">&amp;_prettyPrint=true</code>, depending on whether it is added
     to the end of an existing request parameter. In this case, the following
     command would return formatted output:
    </p><div class="screen"><pre>$<strong> curl \
--cacert self-signed.crt \
--header "X-OpenIDM-Username: openidm-admin" \
--header "X-OpenIDM-Password: openidm-admin" \
--request GET \
"https://localhost:8443/openidm/managed/user/joe?_prettyPrint=true"
    </strong>
    </pre></div><p>
     Note that most command-line examples in this guide do not show this
     parameter, although the output is formatted for readability.
    </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="openidm-uis"></a>1.4.&nbsp;OpenIDM User Interfaces</h2></div></div></div><p>
    OpenIDM supports configuration from Web-based user interfaces (WUI),
    hereafter known as the UI.
   </p><p>
    OpenIDM includes UIs at two different endpoints,
    <code class="literal">/openidmui</code> and <code class="literal">/admin</code>. We refer to the
    administrative tools available at each endpoint as the User View UI and the
    Administrative UI (Admin UI), respectively.
   </p><p>
    The User View UI allows regular users to update parts of their own profiles,
    such as password updates and user data such as addresses. When enabled,
    anonymous users can self-register and reset their passwords, as described
    in the following section: <a href="../integrators-guide/index.html#ui-configuring" class="link"><em class="citetitle">
    Configuring the Default User Interface</em></a>.
   </p><p>
    Administrative users can do more in the User View UI. They can create and
    delete user accounts. They can also modify profiles for existing users.
    To rephrase, in the User View UI, administrative users can configure managed
    user data that conforms to the core schema of OpenIDM, including default
    policies set up in the <code class="filename">policy.json</code> configuration file.
    For more information, see the following chapter: <a class="link" href="integrators-guide#chap-policies" target="_blank"><em class="citetitle">Using Policies to
    Validate Data</em></a>.
   </p><p>
    In addition, administrative users can configure and manage workflows in the
    User View UI. For more information, see the following section:
    <a href="../integrators-guide/index.html#ui-managing-workflows" class="link"><em class="citetitle">Managing
    Workflows from the User Interface</em></a>.
   </p><p>
    In essence, the User View UI supports day-to-day administrative tasks.
   </p><p>
    In contrast, the Admin UI allows an administrator to define the overall
    OpenIDM system configuration. Administrators would access the Admin UI to
    learn OpenIDM, during initial system setup, and when they identify new
    requirements.
   </p><p>
    Unlike the User View UI, the Admin UI allows you to configure connections to
    external data stores, as well as the way OpenIDM reconciles information
    between internal and external data stores.
   </p><p>
    When OpenIDM is running on the localhost system, you can access these UIs
    at <code class="literal">https://localhost:8443/openidmui</code> and
    <code class="literal">https://localhost:8443/admin</code>, respectively.
   </p></div></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-sample"></a>Chapter&nbsp;2.&nbsp;First OpenIDM Sample</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="section"><a href="#before-you-begin-sample">2.1. Before You Begin</a></span></dt><dt><span class="section"><a href="#about-the-sample">2.2. About the Sample</a></span></dt><dt><span class="section"><a href="#install-sample1">2.3. Install the Sample</a></span></dt><dt><span class="section"><a href="#sample1-adminui">2.4. Review the Sample in the Administrative User Interface</a></span></dt><dt><span class="section"><a href="#sample-running-reconciliation">2.5. Running Reconciliation</a></span></dt><dt><span class="section"><a href="#sample-viewing-users-logs">2.6. Viewing Users and Logs</a></span></dt><dt><span class="section"><a href="#sample-adding-users-resource">2.7. Adding Users in a Resource</a></span></dt><dt><span class="section"><a href="#sample-adding-users-rest">2.8. Adding Users Over REST</a></span></dt></dl></div><a class="indexterm" name="d4757e902"></a><a class="indexterm" name="d4757e905"></a><a class="indexterm" name="d4757e910"></a><p>This chapter provides an overview of the first sample and how it is
 configured. To see a listing and an overview of the rest of the samples
 provided, see the README found in <code class="filename">openidm/samples</code> and in
 the chapter <a href="../install-guide/index.html#chap-samples" class="link"><em class="citetitle">More OpenIDM
 Samples</em></a>.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="before-you-begin-sample"></a>2.1.&nbsp;Before You Begin</h2></div></div></div><p>Install OpenIDM as described in the chapter on <a href="../install-guide/index.html#chap-install" class="link"><em class="citetitle">Installing
  OpenIDM Services</em></a>.</p><p>OpenIDM comes with an internal noSQL database, OrientDB, for use as
  the internal repository out of the box. This makes it easy to get started
  with OpenIDM. OrientDB is not yet supported for production use, however,
  so use a supported JDBC database when moving to production.</p><p>If you want to query the internal noSQL database, you can download 
  OrientDB (version 1.7.8) from <a class="link" href="http://www.orientechnologies.com/download/" target="_top">http://www.orientechnologies.com/download/</a>.
  You will find the shell console in the <code class="filename">bin</code> directory. 
  Start OrientDB console using either <span class="command"><strong>console.sh</strong></span> or 
  <span class="command"><strong>console.bat</strong></span>, and then connect to the running OpenIDM with 
  the <span class="command"><strong>connect</strong></span> command.</p><div class="screen"><pre>$ cd /path/to/orientdb-community-1.7.8/bin
$ ./console.sh
OrientDB console v.1.7.8 (build @BUILD@) www.orientechnologies.com
Type 'help' to display all the commands supported.

Installing extensions for GREMLIN language v.2.5.0-SNAPSHOT

orientdb&gt; connect remote:localhost/openidm admin admin
Connecting to database [remote:localhost/openidm] with user 'admin'...OK

orientdb&gt; </pre></div><div class="variablelist"><p>When you have connected to the database, you might find the following
   commands useful.</p><dl class="variablelist"><dt><span class="term"><span class="command"><strong>info</strong></span></span></dt><dd><p>Shows classes and records</p></dd><dt><span class="term"><span class="command"><strong>select * from managed_user</strong></span></span></dt><dd><p>Shows all users in the OpenIDM repository</p></dd><dt><span class="term"><span class="command"><strong>select * from audit_activity</strong></span></span></dt><dd><p>Shows all activity audit records</p><p>This table is created when there is some activity.</p></dd><dt><span class="term"><span class="command"><strong>select * from audit_recon</strong></span></span></dt><dd><p>Shows all reconciliation audit records</p><p>This table is created when you run reconciliation.</p></dd></dl></div><p>
   You can also use OrientDB Studio to query the default OrientDB repository.
   After you have installed and started OpenIDM, point your browser to
   <a class="link" href="http://localhost:2480/" target="_top">http://localhost:2480/</a>. The default database is
   <code class="literal">openidm</code> and the default user and password are
   <code class="literal">admin</code> and <code class="literal">admin</code>. Click Connect to
   connect to the repository.
  </p><p>
   To change the default password, use the following POST request on the
   <code class="literal">repo</code> endpoint:
  </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 "https://localhost:8443/openidm/repo?_action=updateDbCredentials&amp;user=admin&amp;password=newPassword"
   </strong></pre></div><p>
   You must restart OpenIDM for the change to take effect.
  </p><p>
   This command updates both the repository and the repository configuration file.
  </p><p>
   For more information about OrientDB Studio, see
   the <a class="link" href="http://code.google.com/p/orient/wiki/OrientDB_Studio" target="_top">
   OrientDB Studio documentation</a>.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="about-the-sample"></a>2.2.&nbsp;About the Sample</h2></div></div></div><p>OpenIDM connects data objects held in external resources
  by mapping one object to another. To connect to external resources,
  OpenIDM uses <a class="link" href="http://openicf.forgerock.org" target="_top">OpenICF</a>
  connectors, configured for use with the external resources.</p><p>
   When objects in one external resource change, OpenIDM determines how the
   changes affect other objects, and can make the changes as necessary. This
   sample demonstrates how OpenIDM does this by using
   <em class="firstterm">reconciliation</em>. OpenIDM reconciliation compares the
   objects in one object set to mapped objects in another object set.
   Reconciliation can work in write mode, where OpenIDM writes changes to
   affected objects, or in report mode, where OpenIDM reports on what changes
   would be written without making the changes. For a complete explanation of
   reconciliation and synchronization, see the section on <a href="../integrators-guide/index.html#sync-types" class="link"><em class="citetitle">Types of
   Synchronization</em></a> in the <em class="citetitle">Integrator's
   Guide</em>.
  </p><p>
   This sample connects to an XML file that holds sample user data. The
   XML file is configured as the authoritative source. In this sample, users are
   created in the local repository to show you how you can manage local users
   through the REST APIs as well as through the OpenIDM UI.
  </p><p>
   You can also use OpenIDM without storing managed
   objects for users in the local repository, instead reconciling and
   synchronizing objects directly through connectors to external
   resources.
  </p><p>Furthermore, this sample involves only one external resource. In
  practice, you can connect as many resources as needed for your
  deployment.</p><div class="variablelist"><a name="about-the-sample-configuration"></a><div class="variablelist-title">Sample Configuration Files</div><p>You can find configuration files for the sample under the
   <code class="filename">openidm/samples/sample1/conf</code> directory. As you review
   the sample, keep the following in mind.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
       Start OpenIDM with the configuration associated with Sample 1.
      </p><div class="screen"><pre>$ ./startup.sh -p samples/sample1</pre></div><p>
       For more information, see <a class="xref" href="#install-sample1" title="2.3.&nbsp;Install the Sample">Section&nbsp;2.3, &#8220;Install the Sample&#8221;</a>.</p></li><li class="listitem"><p>OpenIDM regularly scans for any scheduler configuration files in the
     <code class="filename">conf</code> directory.</p></li><li class="listitem"><p>OpenIDM's reconciliation service reads the mappings and actions for
    the source and target users from
    <code class="filename">conf/sync.json</code>.</p></li><li class="listitem"><p>When you initiate a reconcilitation, OpenIDM queries all users in the
     source, and then creates, deletes, or modifies users in the local OpenIDM
     repository as mapped in <code class="filename">conf/sync.json</code>.
    </p></li><li class="listitem"><p>OpenIDM writes all operations to the audit logs in both the internal
    database and also the flat files in the <code class="filename">openidm/audit</code>
    directory.</p></li><li class="listitem"><p>
      The default Sample 1 version of the
      <code class="filename">conf/authentication.json</code> file includes three
      authentication modules: <code class="literal">MANAGED_USER</code>,
      <code class="literal">INTERNAL_USER</code>, and <code class="literal">CLIENT_CERT</code>. For
      more information, see the Integrator's Guide section on
      <a href="../integrators-guide/index.html#passthrough-auth" class="link">
      <em class="citetitle">Using Delegated Authentication</em></a>.
     </p></li></ol></div><p>
    When you start OpenIDM with the <code class="literal">-p</code> project variable
    (<span class="command"><strong>./startup.sh -p samples/sample1</strong></span>), the
    <code class="literal">&amp;{launcher.project.location}</code> is set to a value of
    <code class="literal">samples/sample1</code>. The configuration files use this,
    as shown in the following sections.
   </p><p>
    The following configuration files play important roles in this sample.
   </p><dl class="variablelist"><dt><span class="term"><code class="filename">samples/sample1/conf/provisioner.openicf-xml.json</code></span></dt><dd><p>This connector configuration file serves as the XML file resource.
      It is a copy of the file of the same name found in the
      <code class="filename">samples/provisioners</code> directory.
     </p><p>
      In this sample, the connector instance acts as the authoritative source
      for users. In the configuration file you can see that the
      <code class="literal">xmlFilePath</code> is set to
      <code class="filename">&amp;{launcher.project.location}/data/xmlConnectorData.xml</code>.
     </p><p>
      The <code class="literal">&amp;{launcher.project.location}</code>, in this case, is
      <code class="filename">sample/sample1</code>.</p><p>For details on the OpenICF connector configuration files see
     <a href="../integrators-guide/index.html#chap-resource-conf" class="link"><em class="citetitle">Connecting to External Resources</em></a> in
     the <em class="citetitle">Integrator's Guide</em>.
     </p></dd><dt><span class="term"><code class="filename">samples/sample1/conf/schedule-reconcile_systemXmlAccounts_managedUser.json</code></span></dt><dd><p>The sample schedule configuration file defines a reconciliation
     job that, if enabled by setting <code class="literal">"enabled" : true</code>,
     starts a reconciliation each minute for the mapping named
     <code class="literal">systemXmlAccounts_managedUser</code>. The mapping is defined
     in the configuration file, <code class="filename">conf/sync.json</code>.</p><pre class="brush: javascript;">{
    "enabled" : false,
    "type": "cron",
    "schedule": "30 0/1 * * * ?",
    "persisted" : true,
    "misfirePolicy" : "fireAndProceed",
    "invokeService": "sync",
    "invokeContext": {
        "action": "reconcile",
        "mapping": "systemXmlfileAccounts_managedUser"
    }
}</pre><p>For information about the schedule configuration see <a href="../integrators-guide/index.html#chap-scheduler-conf" class="link"><em class="citetitle">Scheduling Tasks and Events</em></a> in the
     <em class="citetitle">Integrator's Guide</em>.</p><p>
      Apart from the scheduled reconciliation run, you can also start
     the reconciliation run through the REST interface. The call to the REST 
     interface is an HTTP POST such as the following.
     </p><div class="screen"><pre>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 "https://localhost:8443/openidm/recon?_action=recon&amp;mapping=systemXmlfileAccounts_managedUser&amp;waitForCompletion=true"</pre></div><p>
      The <code class="literal">waitForCompletion=true</code> parameter specifies that the
      operation should return only when it has completed.
     </p><div class="note"><h3 class="title">Note</h3><p>
       If you want to set up a self-signed certificate, refer to the following
       section of the Integrator's Guide:<a href="../integrators-guide/index.html#rest-over-https" class="link"><em class="citetitle">Restrict REST
       Access to the HTTPS Port</em></a>.
      </p><p>
       Alternatively, just substitute a <span class="command"><strong>-k</strong></span> or
       <span class="command"><strong>--insecure</strong></span> for
       <span class="command"><strong>--cacert self-signed.crt</strong></span> in the REST calls (the
       <span class="command"><strong>curl</strong></span> commands) described in the OpenIDM documentation.
      </p></div></dd><dt><span class="term"><code class="filename">samples/sample1/conf/sync.json</code></span></dt><dd><p>This sample configuration file defines the configuration for
     reconciliation and synchronization. The
     <code class="literal">systemXmlAccounts_managedUser</code> is the mapping for the 
     reconciliation. This entry in <code class="filename">conf/sync.json</code> defines 
     the synchronization mappings between the XML file connector (source) and 
     the local repository (target).</p><pre class="brush: javascript;">
{
    "mappings": [
        {
            "name": "systemXmlfileAccounts_managedUser",
            "source": "system/xmlfile/account",
            "target": "managed/user",
            "correlationQuery": {
                "type": "text/javascript",
                "source": "var query = {'_queryId' : 'for-userName',
                    'uid' :  source.name};query;"
            },
            "properties": [
                {
                    "source": "email",
                    "target": "mail"
                },
                {
                    "source": "firstname",
                    "target": "givenName"
                },
                {
                    "source": "lastname",
                    "target": "sn"
                },
                }
                    "source": "description",
                    "target": "description"
                },
                {
                    "source": "_id",
                    "target": "_id"
                },
                {
                    "source": "name",
                    "target": "userName"
                },
                {
                    "source": "password",
                    "target": "password"
                },
                {
                    "source" : "mobileTelephoneNumber",
                    "target" : "telephoneNumber"
                },
                {
                    "source" : "roles",
                    "transform" : {
                        "type" : "text/javascript",
                        "source" : "source.split(',')"
                    },
                    "target" : "roles"
                }           
            ],
            "policies": [
                {
                    "situation": "CONFIRMED",
                    "action": "UPDATE"
                },
                {
                    "situation": "FOUND",
                    "action": "IGNORE"
                },
                {
                    "situation": "ABSENT",
                    "action": "CREATE"
                },
                {
                    "situation": "AMBIGUOUS",
                    "action": "IGNORE"
                },
                {
                    "situation": "MISSING",
                    "action": "IGNORE"
                },
                {
                    "situation": "SOURCE_MISSING",
                    "action": "IGNORE"
                },
                {
                    "situation": "UNQUALIFIED",
                    "action": "IGNORE"
                },
                {
                    "situation": "UNASSIGNED",
                    "action": "IGNORE"
                }
            ]
        }
    ]
}</pre><p>Source and target paths that start with <code class="literal">managed</code>,
     such as <code class="literal">managed/user</code>, always refer to objects in the
     local OpenIDM repository. Paths that start with <code class="literal">system</code>, 
     such as <code class="literal">system/xmlfile/account</code>, refer to connector 
     objects, in this case the XML file connector.</p><p>For more information about synchronization, reconciliation, and
      <code class="filename">sync.json</code>, see <a href="../integrators-guide/index.html#chap-synchronization" class="link"><em class="citetitle">Configuring Synchronization</em></a> in the
      <em class="citetitle">Integrator's Guide</em>.</p><p>For additional examples related to scripting, see the <a href="../integrators-guide/index.html#appendix-scripting" class="link"><em class="citetitle">Scripting Reference</em></a> appendix in the
     <em class="citetitle">Integrator's Guide</em>.</p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="install-sample1"></a>2.3.&nbsp;Install the Sample</h2></div></div></div><p>
   Now that OpenDJ is configured, prepare OpenIDM as described in
   <a href="../install-guide/index.html#preparing-openidm" class="link"><em class="citetitle">Preparing
   OpenIDM</em></a> You can then start OpenIDM with the configuration
   for sample 1.
  </p><div class="screen"><pre>$ cd /path/to/openidm
$ ./startup.sh -p samples/sample1</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sample1-adminui"></a>2.4.&nbsp;Review the Sample in the Administrative User Interface</h2></div></div></div><p>
   OpenIDM includes a web-based Administrative User Interface, known as the
   "Admin UI". For details, see
   <a href="../integrators-guide/index.html#ui-admin" class="link"><em class="citetitle">Administering
   OpenIDM from the UI</em></a>.
  </p><p>
   After starting OpenIDM, you can access the Admin UI by navigating to
   <code class="literal">https://localhost:8443/admin</code>. The first time you log in,
   use the default administrative credentials, (Login: openidm-admin, Password:
   openidm-admin). After logging in, OpenIDM asks you to change the credentials
   for the administrative account, which is a good idea. However, you can bypass
   this request by closing that window.
  </p><p>
   You should now see the Resources screen, with the connectors and managed
   objects associated with that configuration.
  </p><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/admin-ui-sample1.png" align="middle" height="360" alt="OpenIDM Admin UI with Sample 1"></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sample-running-reconciliation"></a>2.5.&nbsp;Running Reconciliation</h2></div></div></div><p>Start OpenIDM with the configuration for sample 1.</p><div class="screen"><pre>$ cd /path/to/openidm
$ ./startup.sh -p samples/sample1
  </pre></div><p>
   Reconcile the objects in the resources, either by setting
   <code class="literal">"enabled" : true</code> in the schedule configuration file
   (<code class="filename">conf/schedule-reconcile_systemXmlAccounts_managedUser.json</code>)
   and then waiting until the scheduled reconciliation happens, or by using the
   REST interface, as shown in the following example.
  </p><div class="screen"><pre>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 "https://localhost:8443/openidm/recon?_action=recon&amp;mapping=systemXmlfileAccounts_managedUser&amp;waitForCompletion=true"</pre></div><p>
  Successful reconciliation returns a reconciliation run ID, and the status of
  the reconciliation operation, as follows:
 </p><div class="screen"><pre>{
  "_id":"2d87c817-3d00-4776-a705-7de2c65937d8",
  "state":"SUCCESS"
}</pre></div><p>
   Alternatively, you can run the same reconciliation in the Admin UI. To do so,
   select Mappings. For Sample 1, you should see one mapping,
   <code class="literal">systemXmlfileAccounts_managedUser</code>. Select Edit to access
   configuration options associated with reconciliation. To run the
   reconciliation, click Reconcile Now.
  </p><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/admin-ui-mappings-sample1.png" align="middle" height="360" alt="OpenIDM Admin UI Mappings with Sample 1"></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sample-viewing-users-logs"></a>2.6.&nbsp;Viewing Users and Logs</h2></div></div></div><p>
   After reconciliation, you can use the Admin UI to display user records in
   both the source and target resources. Navigate to the URL where OpenIDM is
   installed. If it is local, navigate to
   <code class="literal">https://localhost:8443/admin</code>. Select mappings, you should
   see the result of the reconciliation.
  </p><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/users-recon-sample1.png" align="middle" height="360" alt="List of users after first reconciliation for Sample 1"></td></tr></table></div><p>Alternatively, you can use the REST interface to display
  all users in the local repository. Use a REST client to perform an HTTP 
  GET on the following URL: <code class="literal">
  https://localhost:8443/openidm/managed/user?_queryId=query-all-ids</code>
  with the headers <code class="literal">"X-OpenIDM-Username: openidm-admin"</code> and 
  <code class="literal">"X-OpenIDM-Password: openidm-admin"</code>.
  </p><p>OpenIDM returns JSON data. Depending on the browser, you can use a
   REST client to display the JSON or download it as a file. Alternatively,
   you can use the following
   <a class="link" href="http://curl.haxx.se/" target="_top"><span class="command"><strong>curl</strong></span></a>
   command to get the JSON response.
  </p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/managed/user?_queryId=query-all-ids"
   </strong>
   <em>{
  "remainingPagedResults": -1,
  "pagedResultsCookie": null,
  "resultCount": 2,
  "result": [
    {
      "_rev": "0",
      "_id": "scarter"
    },
    {
      "_rev": "0",
      "_id": "bjensen"
    }
  ]
}  </em>
</pre></div><p>
   You can set up arbitrary queries. For more information on the use of the
   various query expressions in a REST call, see the following
   section on <span class="olink">
   <em class="citetitle">Defining and Calling Queries</em></span>.
  </p><p>
   If you created user <code class="literal">joe</code>, as described in the procedure
   entitled <span class="olink"><em class="citetitle">To
   Get Started With the OpenIDM REST Interface</em></span>, you should
   see the ID for that user somewhere in this list. If you did not include
   <code class="literal">"_id:joe"</code> in the command to create user
   <code class="literal">joe</code>, you would see a system-generated UUID in the list
   instead of the specified ID.
  </p><p>Now try a RESTful GET of user
  <code class="literal">bjensen</code> by appending the user ID to the managed user URL 
  (<code class="literal">https://localhost:8443/openidm/managed/user/</code>).</p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/managed/user/bjensen"</strong>
   <em>
{
    "mail" : "bjensen@example.com",
    "sn" : "Jensen",
    "passwordAttempts" : "0",
    "lastPasswordAttempt" : "Tue Apr 15 2014 20:58:46 GMT-0800 (GMT-08:00)",
    "address2" : "",
    "givenName" : "Barbara",
    "effectiveRoles" : [ "openidm-authorized" ],
    "country" : "",
    "city" : "",
    "lastPasswordSet" : "",
    "postalCode" : "",
    "_id" : "bjensen",
    "_rev" : "1",
    "description" : "Created By XML1",
    "accountStatus" : "active",
    "telephoneNumber" : "1234567",
    "roles" : [ "openidm-authorized" ],
    "postalAddress" : "",
    "stateProvince" : "",
    "userName" : "bjensen@example.com"
}</em>
</pre></div><p>
   The complete user record is returned. If you need this level of information
   for all users, substitute <code class="literal">query-all</code> for
   <code class="literal">query-all-ids</code>.
  </p><p>
   So with some of the query expressions described in the <a href="../integrators-guide/index.html#queries" class="link"><em class="citetitle">Defining and Calling
  Queries</em></a>, you can filter the output.
  </p><p>
   As defined in the mapping file <code class="filename">conf/sync.json</code>, the
   <code class="literal">sn</code> and <code class="literal">mail</code> parameters correspond
   to surname (sn) and email address, respectively.
  </p><p>
   For example, the following RESTful GET filters output by surname (sn):
  </p><div class="screen"><pre>$ <strong>curl \
   --cacert self-signed.crt \
   --header "X-OpenIDM-Username: openidm-admin" \
   --header "X-OpenIDM-Password: openidm-admin" \
   --request GET \
   "https://localhost:8443/openidm/managed/user?_queryFilter=sn%20%pr&amp;_fields=sn"
  </strong>
   <em>{
 "result" : [ {
    "sn" : "Carter",
 }, {
    "sn" : "Jensen"
 } ]
 "resultCount" : 2,
 "pagedResultsCookie" : null,
 "remainingPagedResults" : -1
}</em></pre></div><p>
   Now that you have a listing of desired users, you can add more fields:
  </p><div class="screen"><pre>$ <strong>curl \
   --cacert self-signed.crt \
   --header "X-OpenIDM-Username: openidm-admin" \
   --header "X-OpenIDM-Password: openidm-admin" \
   --request GET \
   "https://localhost:8443/openidm/managed/user?_queryFilter=sn%20%pr&amp;_fields=sn,mail,description"
  </strong>
   <em>{
 "result" : [ {
    "sn" : "Carter",
    "mail" : "scarter@example.com",
    "description" : "Created by XML1",
 }, {
    "sn" : "Jensen"
    "mail" : "bjensen@example.com",
    "description" : "Created by XML1",
 } ]
 "resultCount" : 2,
 "pagedResultsCookie" : null,
 "remainingPagedResults" : -1
}</em></pre></div><p>This information is also available in the CSV format audit logs located 
  in the <code class="filename">openidm/audit</code> directory.</p><div class="screen"><pre>$ <strong>ls /path/to/openidm/audit/</strong>
   <em>
access.csv activity.csv recon.csv
   </em></pre></div><p>
   For more information on what you can find in each of these files, see the
   Integrator's Guide section on
   <a href="../integrators-guide/index.html#audit-log-types" class="link"><em class="citetitle">Audit Log
   Types</em></a>.
  </p><p>
   You can get a similar level of information for each user. For example, after
   reconciliation, you can return to <a class="xref" href="#sample-viewing-users-logs" title="2.6.&nbsp;Viewing Users and Logs">Section&nbsp;2.6, &#8220;Viewing Users and Logs&#8221;</a>,
   select a user, and review information from the reconciled linked resource.
  </p><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/linked-user.png" align="middle" height="360" alt="User data after a reconciliation"></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sample-adding-users-resource"></a>2.7.&nbsp;Adding Users in a Resource</h2></div></div></div><p>Add a user to the source connector XML data file to see reconciliation
  in action. During the next reconciliation, OpenIDM finds the new user in the
  source connector, and creates the user in the local repository. To add the
  user, copy the following XML into
  <code class="filename">openidm/samples/sample1/data/xmlConnectorData.xml</code>.</p><pre class="brush: xml;">&lt;ri:__ACCOUNT__&gt;
    &lt;icf:__UID__&gt;tmorris&lt;/icf:__UID__&gt;
    &lt;icf:__NAME__&gt;tmorris@example.com&lt;/icf:__NAME__&gt;
    &lt;ri:password&gt;TestPassw0rd#&lt;/ri:password&gt;
    &lt;ri:firstname&gt;Toni&lt;/ri:firstname&gt;
    &lt;ri:lastname&gt;Morris&lt;/ri:lastname&gt;
    &lt;ri:email&gt;tmorris@example.com&lt;/ri:email&gt;
    &lt;ri:mobileTelephoneNumber&gt;1234567&lt;/ri:mobileTelephoneNumber&gt;
    &lt;ri:roles&gt;openidm-authorized&lt;/ri:roles&gt;
    &lt;icf:__DESCRIPTION__&gt;Created By XML1&lt;/icf:__DESCRIPTION__&gt;
 &lt;/ri:__ACCOUNT__&gt;</pre><p>Run reconciliation again, as described in the section on <a class="link" href="#sample-running-reconciliation" title="2.5.&nbsp;Running Reconciliation"><em class="citetitle">Running
  Reconciliation</em></a>. After reconciliation has run, query the
  local repository to see the new user appear in the list of all users under
  <code class="literal">https://localhost:8443/openidm/managed/user?_queryId=query-all-ids</code>.</p><div class="screen"><pre><strong>
$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/managed/user?_queryId=query-all-ids"</strong>
<em>
{
   "result": [ {
      "_id": "bjensen",
      "_rev": "0"
   }, {
      "_id": "scarter",
      "_rev": "0"
   }, {
      "_id": "tmorris",
      "_rev": "0"
   } ],
   "resultCount": 3,
   "pagedResultsCookie": null,
   "remainingPagedResults": -1
}</em>
</pre></div><p>
   Also look at the reconciliation audit log,
   <code class="filename">openidm/audit/recon.csv</code> to see what took place during
   reconciliation. This formatted excerpt from the log covers the two
   reconciliation runs done in this sample.
  </p><pre class="brush: csv;">
"_id",  "action",...,"reconId","situation","sourceObjectId",                "targetObjectId","timestamp";
"7e...","CREATE",...,"486...", "ABSENT",   "system/xmlfile/account/bjensen","managed/user/bjensen",...;
"1a...","CREATE",...,"486...", "ABSENT",   "system/xmlfile/account/scarter","managed/user/scarter",...;
"33...","UPDATE",...,"aa9...", "CONFIRMED","system/xmlfile/account/bjensen","managed/user/bjensen",...;
"1d...","UPDATE",...,"aa9...", "CONFIRMED","system/xmlfile/account/scarter","managed/user/scarter",...;
"0e...","CREATE",...,"aa9...", "ABSENT",   "system/xmlfile/account/tmorris","managed/user/tmorris",...;
</pre><p>
   The relevant audit log fields in this example are: action, situation,
   <code class="literal">sourceObjectId</code>, and <code class="literal">targetObjectId</code>.
   For each object in the source, reconciliation leads to an action on the
   target.
  </p><p>In the first reconciliation run (the abbreviated
  <code class="literal">reconID</code> is shown as <code class="literal">486...</code>), the source
  object does not exist in the target, resulting in an ABSENT situation and an
  action to CREATE the object in the target. The object created earlier in the
  target does not exist in the source, and so is IGNORED.</p><p>In the second reconciliation run (the abbreviated
  <code class="literal">reconID</code> is shown as <code class="literal">aa9...</code>), after you
  added a user to the source XML, OpenIDM performs an UPDATE on the user objects
  <code class="literal">bjensen</code> and <code class="literal">scarter</code> that already exist 
  in the target, in this case changing the internal ID. OpenIDM performs a CREATE 
  on the target for the new user (<code class="literal">tmorris</code>).</p><p>You configure the action that OpenIDM takes based on an object's
  situation in the configuration file, <code class="filename">conf/sync.json</code>.
  For the list of all possible situations and actions, see the <a href="../integrators-guide/index.html#chap-synchronization" class="link"><em class="citetitle">Configuring Synchronization</em></a> chapter in the
  <em class="citetitle">Integrator's Guide</em>.</p><p>For details on auditing, see the <a href="../integrators-guide/index.html#chap-auditing" class="link"><em class="citetitle">Using Audit Logs</em></a> chapter in the
  <em class="citetitle">Integrator's Guide</em>.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sample-adding-users-rest"></a>2.8.&nbsp;Adding Users Over REST</h2></div></div></div><p>
   You can add users to the local repository over the REST interface. The
   following example adds a user named James Berg.
  </p><p>Create <code class="literal">james</code> (UNIX).</p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 --data '{
  "_id":"jberg",
  "userName":"jberg",
  "sn":"Berg",
  "givenName":"James",
  "mail":"jberg@example.com",
  "telephoneNumber":"5556787",
  "description":"Created by OpenIDM REST.",
  "password":"MyPassw0rd"
 }' \
 "https://localhost:8443/openidm/managed/user?_action=create"
   </strong>
   <em>{
    "mail" : "jberg@example.com",
    "sn" : "Berg",
    "passwordAttempts" : "0",
    "lastPasswordAttempt" : "Tue Apr 15 2014 21:05:12 GMT-0800 (GMT-08:00)",
    "address2" : "",
    "givenName" : "James",
    "effectiveRoles" : [ "openidm-authorized" ],
    "password" : {
      "$crypto" : {
        "type" : "x-simple-encryption",
        "value" : {
          "data" : "QYRcIS9FbksBEwyd4dNEpg==",
          "cipher" : "AES/CBC/PKCS5Padding",
          "iv" : "R5Kjs6jZZtqCockFCS6BfA==",
          "key" : "openidm-sym-default"
        }
      }
    },
    "country" : "",
    "city" : "",
    "_rev" : "1",
    "lastPasswordSet" : "",
    "postalCode" : "",
    "_id" : "jberg",
    "description" : "Created by OpenIDM REST.",
    "accountStatus" : "active",
    "telephoneNumber" : "5556787",
    "roles" : [ "openidm-authorized" ],
    "effectiveAssignments" : { },
    "postalAddress" : "",
    "stateProvince" : "",
    "userName" : "jberg"
}</em>
   </pre></div><p>Create <code class="literal">james</code> (Windows).</p><div class="screen"><pre>C:\&gt; <strong>curl
 --cacert self-signed.crt
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 --header "Content-Type: application/json"
 --request POST
 --data "{
 \"_id\":\"jberg\",
 \"userName\":\"jberg\",
 \"sn\":\"Berg\",
 \"givenName\":\"James\",
 \"email\":\"jberg@example.com\",
 \"telephoneNumber\":\"5556787\",
 \"description\":\"Created by OpenIDM REST.\",
 \"password\":\"MyPassw0rd\"
 }"
 "https://localhost:8443/openidm/managed/user?_action=create"</strong>
</pre></div><p>The output is essentially identical to that for UNIX.</p><p>OpenIDM creates the new user in the repository. If you configure a
  mapping to apply changes from the local repository to the XML file connector
  as a target, OpenIDM then updates the XML file to add the new user.</p><p>
   You can also add users through the UI, which uses the OpenIDM REST API.
   When you have logged into the UI as the OpenIDM administrator, the process is
   straightforward, as shown in the following figure.
  </p><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/sample1-useradd.png" align="middle" height="360" alt="Examples of adding a new user"></td></tr></table></div></div></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-samples"></a>Chapter&nbsp;3.&nbsp;More OpenIDM Samples</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="section"><a href="#before-you-begin-samples">3.1. Before You Begin</a></span></dt><dt><span class="section"><a href="#more-sample1">3.2. Sample 1 - XML File</a></span></dt><dt><span class="section"><a href="#more-sample2">3.3. Sample 2 - LDAP One Way</a></span></dt><dt><span class="section"><a href="#more-sample2b">3.4. Sample 2b - LDAP Two Way</a></span></dt><dt><span class="section"><a href="#more-sample2c">3.5. Sample 2c - Synchronizing LDAP Group Membership</a></span></dt><dt><span class="section"><a href="#more-sample2d">3.6. Sample 2d - Synchronizing LDAP Groups</a></span></dt><dt><span class="section"><a href="#samples-groovy-connector-toolkit">3.7. Using the Groovy Connector Toolkit to Create Scripted Connectors</a></span></dt><dt><span class="section"><a href="#samples-powershell">3.8. Sample - Using the PowerShell Connector Toolkit to Create Scripted Connectors</a></span></dt><dt><span class="section"><a href="#more-sample4">3.9. Sample 4 - CSV to XML File</a></span></dt><dt><span class="section"><a href="#more-sample5">3.10. Sample 5 - Synchronization of Two Resources</a></span></dt><dt><span class="section"><a href="#more-sample5b">3.11. Sample 5b - Failure Compensation With Multiple Resources</a></span></dt><dt><span class="section"><a href="#more-sample6">3.12. Sample 6 - LiveSync With an AD Server</a></span></dt><dt><span class="section"><a href="#more-sample7">3.13. Sample 7 - Scripting a SCIM-like Schema</a></span></dt><dt><span class="section"><a href="#more-sample8">3.14. Sample 8 - Logging in Scripts</a></span></dt><dt><span class="section"><a href="#more-sample9">3.15. Sample 9 - Asynchronous Reconciliation Using Workflows</a></span></dt><dt><span class="section"><a href="#more-sample-openam">3.16. Sample - Configuring Authentication Management With OpenAM</a></span></dt><dt><span class="section"><a href="#more-sample-audit">3.17. Sample - Demonstrate Extended Audit Capabilities</a></span></dt><dt><span class="section"><a href="#sample-google-connector">3.18. Sample - Connecting to Google With the Google Apps Connector</a></span></dt><dt><span class="section"><a href="#sample-salesforce-connector">3.19. Sample - Connecting to Salesforce With the Salesforce Connector</a></span></dt></dl></div><p>The current distribution of OpenIDM comes with a variety of samples
 in <code class="filename">openidm/samples/</code>. Sample 1 is described in 
 <a href="../install-guide/index.html#chap-sample" class="link"><em class="citetitle">First OpenIDM
 Sample</em></a>. This chapter describes the remaining OpenIDM 
 samples.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="before-you-begin-samples"></a>3.1.&nbsp;Before You Begin</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#install-samples">3.1.1. Installing the Samples</a></span></dt><dt><span class="section"><a href="#preparing-openidm">3.1.2. Preparing OpenIDM</a></span></dt></dl></div><p>Install OpenIDM, as described in <a href="../install-guide/index.html#chap-install" class="link"><em class="citetitle">Installing
  OpenIDM Services</em></a>.</p><p>OpenIDM comes with an internal noSQL database, OrientDB, for use as
  the internal repository out of the box. This makes it easy to get started
  with OpenIDM. OrientDB is not yet supported for production use, however, 
  so use a supported JDBC database when moving to production.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="install-samples"></a>3.1.1.&nbsp;Installing the Samples</h3></div></div></div><a class="indexterm" name="d4757e1627"></a><p>
    Each sample directory in <code class="filename">openidm/samples/</code> contains a
    number of subdirectories, such as <code class="filename">conf/</code> and
    <code class="filename">script/</code>. To start OpenIDM with a sample configuration,
    navigate to the <code class="filename">/path/to/openidm</code> directory and use the
    <code class="literal">-p</code> option of the <span class="command"><strong>startup</strong></span> command to
    point to the sample whose configuration you want to use. Some, but not all
    samples require additional software, such as an external LDAP server or
    database.
   </p><p>
    When you move from one sample to the next, bear in mind that you are
    changing the OpenIDM configuration. For information on how configuration
    changes work, see <span class="olink"><em class="citetitle">Changing the
    Configuration</em></span> in the <em class="citetitle">Integrator's
    Guide</em>.
   </p><p>
    The command-line examples in this chapter (and throughout the OpenIDM
    documentation) assume a UNIX shell. If you are running these samples on
    Windows, adjust the command-line examples accordingly. For an indication of
    what the corresponding Windows command would look like, see the examples in
    the <a href="../install-guide/index.html#chap-sample" class="link"><em class="citetitle">First OpenIDM
    Sample</em></a>.
   </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="preparing-openidm"></a>3.1.2.&nbsp;Preparing OpenIDM</h3></div></div></div><p>Install an instance of OpenIDM specifically to try the samples. That
   way you can experiment as much as you like, and discard the result if you
   are not satisfied.</p><p>
    If you are using the same instance of OpenIDM for multiple samples, it is
    helpful to clear out the repository created for an earlier sample. To do so,
    shut down OpenIDM and delete the <code class="filename">openidm/db/openidm</code>
    directory.
   </p><div class="screen"><pre>$ rm -rf /path/to/openidm/db/openidm</pre></div><p>
    OpenIDM should now be ready to start with a new sample. For a number of
    the following samples, users are created either at the UI or with a
    commons REST call. Once added, and when reconciliation is complete, such
    users should be able to log into the UI.
   </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="more-sample1"></a>3.2.&nbsp;Sample 1 - XML File</h2></div></div></div><p>Sample 1 is described in the chapter, <a href="../install-guide/index.html#chap-sample" class="link"><em class="citetitle">First OpenIDM
  Sample</em></a>.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="more-sample2"></a>3.3.&nbsp;Sample 2 - LDAP One Way</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#external-ldap-config-2">3.3.1. LDAP Server Configuration</a></span></dt><dt><span class="section"><a href="#install-sample2">3.3.2. Install the Sample</a></span></dt><dt><span class="section"><a href="#run-sample2">3.3.3. Reconcile the Repository</a></span></dt></dl></div><a class="indexterm" name="d4757e1693"></a><p>
   Sample 2 resembles the first sample, but in sample 2 OpenIDM is connected to
   a local LDAP server. The sample has been tested with <a class="link" href="http://www.forgerock.org/opendj.html" target="_blank">OpenDJ</a>, but should
   work with any LDAPv3 compliant server.
  </p><p>
   Sample 2 demonstrates how OpenIDM can pick up new or changed objects from an
   external resource. The sample contains only one mapping, from the external
   LDAP server resource to the OpenIDM repository. The sample therefore does not
   push any changes made to OpenIDM managed user objects out to the LDAP server.
  </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="external-ldap-config-2"></a>3.3.1.&nbsp;LDAP Server Configuration</h3></div></div></div><div class="itemizedlist"><p>
     Sample 2 expects the following configuration for the external LDAP server:
    </p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
      The LDAP server runs on the local host.
     </p></li><li class="listitem"><p>
      The LDAP server listens on port 1389.
     </p></li><li class="listitem"><p>
      A user with DN <code class="literal">cn=Directory Manager</code> and password
      <code class="literal">password</code> has read access to the LDAP server.
     </p></li><li class="listitem"><p>
      Directory data for that server is stored under base DN
      <code class="literal">dc=example,dc=com</code>.
     </p></li><li class="listitem"><p>
      User objects for that server are stored under base DN
      <code class="literal">ou=People,dc=example,dc=com</code>.
     </p></li><li class="listitem"><p>
      User objects have the object class <code class="literal">inetOrgPerson</code>.
     </p></li><li class="listitem"><p>
      User objects have the following attributes:
     </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
        <code class="literal">cn</code>
       </p></li><li class="listitem"><p>
        <code class="literal">description</code>
       </p></li><li class="listitem"><p>
        <code class="literal">givenName</code>
       </p></li><li class="listitem"><p>
        <code class="literal">mail</code>
       </p></li><li class="listitem"><p>
        <code class="literal">sn</code>
       </p></li><li class="listitem"><p>
        <code class="literal">telephoneNumber</code>
       </p></li><li class="listitem"><p>
        <code class="literal">uid</code>
       </p></li><li class="listitem"><p>
        <code class="literal">userPassword</code>
       </p></li></ul></div><p>
      An example user object follows.
     </p><pre class="brush: ldif;">
dn: uid=jdoe,ou=People,dc=example,dc=com
objectClass: person
objectClass: organizationalPerson
objectClass: inetOrgPerson
objectClass: top
givenName: John
uid: jdoe
cn: John Doe
telephoneNumber: 1-415-523-0772
sn: Doe
mail: jdoe@example.com
description: Created by OpenIDM
userPassword: password</pre></li></ul></div><p>
    A sample LDIF file, with two users, is provided in
    <code class="filename">openidm/samples/sample2/data/Example.ldif</code>.
   </p><p>
    The following steps provide setup instructions for an OpenDJ server. Adjust
    these instructions if you are using an alternative LDAP server.
   </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
      Download and extract the OpenDJ zip archive.
     </p><p>
      Find a link to the OpenDJ download page at <a class="link" href="http://forgerock.com/download-stack/" target="_blank">http://forgerock.com/download-stack/</a>.
      </p></li><li class="step"><p>
       Install OpenDJ using the command-line setup. During the install, import
       the LDIF data required for this sample:
      </p><div class="screen"><pre><strong>$ cd /path/to/opendj
$ ./setup --cli \
--hostname localhost \
--ldapPort 1389 \
--rootUserDN "cn=Directory Manager" \
--rootUserPassword password \
--adminConnectorPort 4444 \
--baseDN dc=com \
--ldifFile /path/to/openidm/samples/sample2/data/Example.ldif \
--acceptLicense \
--no-prompt</strong>
<em>...
Configuring Directory Server ..... Done.
Importing LDIF file /path/to/openidm/samples/sample2/data/Example.ldif ...... Done.
Starting Directory Server ...... Done..
...</em></pre></div></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="install-sample2"></a>3.3.2.&nbsp;Install the Sample</h3></div></div></div><p>
    Prepare OpenIDM as described in <a class="xref" href="#preparing-openidm" title="3.1.2.&nbsp;Preparing OpenIDM">Section&nbsp;3.1.2, &#8220;Preparing OpenIDM&#8221;</a>, then
    start OpenIDM with the configuration for sample 2.
   </p><div class="screen"><pre>$ cd /path/to/openidm
$ ./startup.sh -p samples/sample2</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="run-sample2"></a>3.3.3.&nbsp;Reconcile the Repository</h3></div></div></div><p>
    The mapping configuration file (<code class="filename">sync.json</code>) for this
    sample includes the mapping <code class="literal">systemLdapAccounts_managedUser</code>,
    which synchronize users from the source LDAP server with the target
    OpenIDM repository.
   </p><p>
    You can run this part of the sample by using the <code class="literal">curl</code>
    command-line utility, or by using the OpenIDM Administration UI. This
    section provides instructions for both methods.
   </p><div class="procedure"><a name="d4757e1849"></a><div class="procedure-title">Procedure&nbsp;3.1.&nbsp;To Run the Sample Using the Command Line</div><ol class="procedure" type="1"><li class="step"><p>
      Reconcile the repository by running the following command:
     </p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 "https://localhost:8443/openidm/recon?_action=recon&amp;mapping=systemLdapAccounts_managedUser&amp;waitForCompletion=true"</strong>
<em>{
  "state": "SUCCESS",
  "_id": "f3c618aa-cc3b-49ed-9a3a-00b012db2513"
}</em>
     </pre></div><p>
      The reconciliation operation creates the two users from the LDAP server in
      the OpenIDM repository, assigning the new objects random unique IDs.
     </p></li><li class="step"><p>
      To retrieve the users from the repository, query their IDs as follows:
     </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/managed/user?_queryId=query-all-ids"</strong>
<em>{
  "remainingPagedResults": -1,
  "pagedResultsCookie": null,
  "resultCount": 2,
  "result": [
    {
      "_rev": "0",
      "_id": "0a5546d6-149b-4f8b-b3be-4afa8a267d45"
    },
    {
      "_rev": "0",
      "_id": "840394b9-ced0-4f13-a5ad-6a0d825f0705"
    }
  ]
}</em></pre></div></li><li class="step"><p>
      To retrieve individual user objects, include the ID in the URL, for
      example:
     </p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/managed/user/0a5546d6-149b-4f8b-b3be-4afa8a267d45"</strong>
<em>{
  "displayName": "Babara Jensen",
  "stateProvince": "",
  "userName": "bjensen",
  "postalAddress": "",
  "effectiveAssignments": {},
  "roles": [
    "openidm-authorized"
  ],
  "country": "",
  "effectiveRoles": [
    "openidm-authorized"
  ],
  "givenName": "Barbara",
  "address2": "",
  "lastPasswordAttempt": "Mon Nov 24 2014 21:17:19 GMT+0200 (SAST)",
  "passwordAttempts": "0",
  "sn": "Jensen",
  "mail": "bjensen@example.com",
  "city": "",
  "lastPasswordSet": "",
  "postalCode": "",
  "_id": "0a5546d6-149b-4f8b-b3be-4afa8a267d45",
  "_rev": "1",
  "accountStatus": "active",
  "description": "Created for OpenIDM",
  "telephoneNumber": "1-360-229-7105"
}</em>       </pre></div></li></ol></div><div class="procedure"><a name="d4757e1885"></a><div class="procedure-title">Procedure&nbsp;3.2.&nbsp;To Run the Sample Using the Admin UI</div><ol class="procedure" type="1"><li class="step"><p>
      Log in to the Admin UI at the URL
      <code class="literal">https://localhost:8443/admin</code> as the default
      administrative user (<code class="literal">openidm-admin</code>) with password
      <code class="literal">openidm-admin</code>.
     </p><p>
      The first time you log into the Admin UI, you are prompted to change your
      password. If you do not want to change your password at this time, simply
      click X to close this window, and continue with the sample.
     </p></li><li class="step"><p>
      Select the Mappings tab.
     </p><p>
      This tab shows one configured mapping, from the <code class="literal">ldap</code>
      server to the OpenIDM repository (<code class="literal">managed/user</code>).
     </p><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/sample2-mappings.png" align="middle" height="360" alt="Mappings tab showing the mapping for Sample 2"></td></tr></table></div></li><li class="step"><p>
      Click anywhere on the mapping and click Reconcile Now.
     </p><p>
      The reconciliation operation creates the two users from the LDAP server in
      the OpenIDM repository.
     </p></li><li class="step"><p>
      Retrieve the users in the repository by clicking the User View link at the
      top right of the Admin UI.
     </p><p>
      This link opens the User View UI. If you did not change your password in
      the first step, you are prompted to change your password again. You can
      bypass this by simply clicking X to close the password prompt window.
     </p></li><li class="step"><p>
      Select the Users tab.
     </p><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/sample2-users.png" align="middle" height="360" alt="Users tab showing the users in the repo for Sample 2"></td></tr></table></div><p>
      The two users from the LDAP server have been reconciled to the OpenIDM
      repository.
     </p></li><li class="step"><p>
      To retrieve the details of a specific user, click that username on the
      Users tab.
     </p><p>
      The following image shows the details of user <code class="literal">bjensen</code>.
     </p><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/sample2-bjensen.png" align="middle" height="360" alt="User details for a specific user"></td></tr></table></div></li></ol></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="more-sample2b"></a>3.4.&nbsp;Sample 2b - LDAP Two Way</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#external-ldap-config-2b">3.4.1. External LDAP Configuration</a></span></dt><dt><span class="section"><a href="#install-sample2b">3.4.2. Install the Sample</a></span></dt><dt><span class="section"><a href="#run-sample2b">3.4.3. Run the Sample</a></span></dt></dl></div><a class="indexterm" name="d4757e1954"></a><p>
   Like sample 2, sample 2b connects to an external LDAP server. However,
   sample 2b has two mappings configured, one from the LDAP server to the
   OpenIDM repository, and the other from the OpenIDM repository to the LDAP
   server.
  </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="external-ldap-config-2b"></a>3.4.1.&nbsp;External LDAP Configuration</h3></div></div></div><p>
    Configure the LDAP server as for sample 2,
    <a class="xref" href="#external-ldap-config-2" title="3.3.1.&nbsp;LDAP Server Configuration">Section&nbsp;3.3.1, &#8220;LDAP Server Configuration&#8221;</a>. The LDAP user must have write
    access to create users from OpenIDM on the LDAP server. When you configure
    the LDAP server, import the appropriate LDIF file
    (<code class="filename">openidm/samples/sample2b/data/Example.ldif).</code>
   </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="install-sample2b"></a>3.4.2.&nbsp;Install the Sample</h3></div></div></div><p>
    Prepare OpenIDM as described in <a class="xref" href="#preparing-openidm" title="3.1.2.&nbsp;Preparing OpenIDM">Section&nbsp;3.1.2, &#8220;Preparing OpenIDM&#8221;</a>, then
    start OpenIDM with the configuration for sample 2b.
   </p><div class="screen"><pre>$ cd /path/to/openidm
$ ./startup.sh -p samples/sample2b</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="run-sample2b"></a>3.4.3.&nbsp;Run the Sample</h3></div></div></div><p>
    The mapping configuration file (<code class="filename">sync.json</code>) for this
    sample includes two mappings, <code class="literal">systemLdapAccounts_managedUser</code>,
    which synchronizes users from the source LDAP server with the target
    OpenIDM repository, and <code class="literal">managedUser_systemLdapAccounts</code>,
    which synchronizes changes from the OpenIDM repository to the LDAP server.
   </p><p>
    You can run this part of the sample by using the <code class="literal">curl</code>
    command-line utility, or by using the OpenIDM Administration UI. This
    section provides instructions for both methods.
   </p><div class="procedure"><a name="d4757e1999"></a><div class="procedure-title">Procedure&nbsp;3.3.&nbsp;To Run the Sample Using the Command Line</div><ol class="procedure" type="1"><li class="step"><p>
      Reconcile the repository over the REST interface by running the following
      command:
     </p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 "https://localhost:8443/openidm/recon?_action=recon&amp;mapping=systemLdapAccounts_managedUser&amp;waitForCompletion=true"</strong>
<em>{
  "state": "SUCCESS",
  "_id": "027e25e3-7a33-4858-9080-161c2b40a6bf"
}</em></pre></div><p>
      The reconciliation operation returns a reconciliation run ID and the
      status of the operation. Reconciliation creates user objects from LDAP in
      the OpenIDM repository, assigning the new objects random unique IDs.
     </p></li><li class="step"><p>
      To retrieve the users from the repository, query their IDs as follows:
     </p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/managed/user?_queryId=query-all-ids"</strong>
<em>{
  "remainingPagedResults": -1,
  "pagedResultsCookie": null,
  "resultCount": 2,
  "result": [
    {
      "_rev": "0",
      "_id": "2cb34789-ee67-4f50-88f2-022460c37253"
    },
    {
      "_rev": "0",
      "_id": "625942ac-3cb8-47aa-9de1-217d24967b3b"
    }
  ]
}</em></pre></div></li><li class="step"><p>
      To retrieve individual user objects, include the ID in the URL, for
      example:
     </p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/managed/user/625942ac-3cb8-47aa-9de1-217d24967b3b"</strong>
<em>{
  "displayName": "Babara Jensen",
  "stateProvince": "",
  "userName": "bjensen",
  "postalAddress": "",
  "effectiveAssignments": {},
  "roles": [
    "openidm-authorized"
  ],
  "country": "",
  "effectiveRoles": [
    "openidm-authorized"
  ],
  "givenName": "Barbara",
  "address2": "",
  "lastPasswordAttempt": "Tue Nov 25 2014 12:29:15 GMT+0200 (SAST)",
  "passwordAttempts": "0",
  "sn": "Jensen",
  "mail": "bjensen@example.com",
  "city": "",
  "lastPasswordSet": "",
  "postalCode": "",
  "_id": "625942ac-3cb8-47aa-9de1-217d24967b3b",
  "_rev": "1",
  "description": "Created for OpenIDM",
  "accountStatus": "active",
  "telephoneNumber": "1-360-229-7105"
}</em></pre></div></li><li class="step"><p>
      Test the second mapping by creating a user in the OpenIDM repository.
     </p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 --data '{
    "mail":"fdoe@example.com",
    "sn":"Doe",
    "telephoneNumber":"555-1234",
    "userName":"fdoe",
    "givenName":"Felicitas",
    "description":"Felicitas Doe",
    "displayName":"fdoe"}' \
 "https://localhost:8443/openidm/managed/user?_action=create"</strong>
<em>{
  "displayName": "fdoe",
  "stateProvince": "",
  "userName": "fdoe",
  "postalAddress": "",
  "effectiveAssignments": {},
  "roles": [
    "openidm-authorized"
  ],
  "country": "",
  "effectiveRoles": [
    "openidm-authorized"
  ],
  "givenName": "Felicitas",
  "address2": "",
  "lastPasswordAttempt": "Tue Nov 25 2014 12:49:06 GMT+0200 (SAST)",
  "passwordAttempts": "0",
  "sn": "Doe",
  "mail": "fdoe@example.com",
  "city": "",
  "_rev": "1",
  "lastPasswordSet": "",
  "postalCode": "",
  "_id": "c462fac4-528a-45c5-ba76-d2744952d418",
  "description": "Felicitas Doe",
  "accountStatus": "active",
  "telephoneNumber": "555-1234"
}</em></pre></div></li><li class="step"><p>
      By default, <span class="emphasis"><em>implicit synchronization</em></span> is enabled for
      mappings <span class="emphasis"><em>from</em></span> the <code class="literal">managed/user</code>
      repository <span class="emphasis"><em>to</em></span> any external resource. This means that
      when you update a managed object, any mappings defined in the
      <code class="filename">sync.json</code> file that have the managed object as the
      source are automatically executed to update the target system. For more
      information, see <a href="../integrators-guide/index.html#synchronization-mappings-file" class="link"><em class="citetitle">Synchronization
      Mappings File</em></a> in the <em class="citetitle">Integrator's
      Guide</em>.
     </p><p>
      Test that the implicit reconciliation has been successful by querying the
      users in the LDAP directory over REST, as follows:
     </p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/system/ldap/account?_queryId=query-all-ids"</strong>
<em>{
  "remainingPagedResults": -1,
  "pagedResultsCookie": null,
  "resultCount": 3,
  "result": [
    {
      "_id": "uid=jdoe,ou=People,dc=example,dc=com",
      "dn": "uid=jdoe,ou=People,dc=example,dc=com"
    },
    {
      "_id": "uid=bjensen,ou=People,dc=example,dc=com",
      "dn": "uid=bjensen,ou=People,dc=example,dc=com"
    },
    {
      "_id": "uid=fdoe,ou=People,dc=example,dc=com",
      "dn": "uid=fdoe,ou=People,dc=example,dc=com"
    }
  ]
}</em></pre></div><p>
      Note the new entry for user <code class="literal">fdoe</code>.
     </p></li><li class="step"><p>
      Query the complete entry by including <code class="literal">fdoe</code>'s ID in
      the URL.
     </p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/system/ldap/account/uid=fdoe,ou=People,dc=example,dc=com"</strong>
<em>{
  "_id": "uid=fdoe,ou=People,dc=example,dc=com",
  "dn": "uid=fdoe,ou=People,dc=example,dc=com",
  "mail": "fdoe@example.com",
  "uid": "fdoe",
  "ldapGroups": [],
  "cn": "fdoe",
  "givenName": "Felicitas",
  "telephoneNumber": "555-1234",
  "description": "Felicitas Doe",
  "sn": "Doe"
}</em></pre></div></li></ol></div><div class="procedure"><a name="d4757e2096"></a><div class="procedure-title">Procedure&nbsp;3.4.&nbsp;To Run the Sample Using the Admin UI</div><ol class="procedure" type="1"><li class="step"><p>
      Log in to the Admin UI at the URL
      <code class="literal">https://localhost:8443/admin</code> as the default
      administrative user (<code class="literal">openidm-admin</code>) with password
      <code class="literal">openidm-admin</code>.
     </p><p>
      The first time you log into the Admin UI, you are prompted to change your
      password. If you do not want to change your password at this time, simply
      click X to close this window, and continue with the sample.
     </p></li><li class="step"><p>
      Select the Mappings tab.
     </p><p>
      This tab shows two configured mappings, one from the
      <code class="literal">ldap</code> server to the OpenIDM repository
      (<code class="literal">managed/user</code>) and one from the OpenIDM repository to
      the <code class="literal">ldap</code> server.
     </p><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/sample2b-mappings.png" align="middle" height="360" alt="Mappings tab showing the mapping for Sample 2b"></td></tr></table></div></li><li class="step"><p>
      Click anywhere on the first mapping and click Reconcile Now.
     </p><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/sample2b-reconcile.png" align="middle" height="360" alt="Mappings tab showing reconciliation for Sample 2b"></td></tr></table></div><p>
      The reconciliation operation creates the two users from the LDAP server in
      the OpenIDM repository.
     </p></li><li class="step"><p>
      Retrieve the users in the repository by clicking the User View link at the
      top right of the Admin UI.
     </p><p>
      This link opens the User View UI. If you did not change your password in
      the first step, you are prompted to change your password again. You can
      bypass this by simply clicking X to close the password prompt window.
     </p></li><li class="step"><p>
      Select the Users tab.
     </p><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/sample2-users.png" align="middle" height="360" alt="Users tab showing the users in the repo for Sample 2b"></td></tr></table></div><p>
      The two users from the LDAP server have been reconciled to the OpenIDM
      repository.
     </p></li><li class="step"><p>
      To retrieve the details of a specific user, click that username on the
      Users tab.
     </p><p>
      The following image shows the details of user <code class="literal">bjensen</code>.
     </p><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/sample2-bjensen.png" align="middle" height="360" alt="User details for a specific user"></td></tr></table></div></li><li class="step"><p>
      Add a new user in the OpenIDM repository by clicking Add User on the Users
      tab.
     </p><p>
      Complete the user details and click Create.
     </p><p>
      The following image shows a new record being created for user
      <code class="literal">fdoe</code>.
     </p><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/sample2b-new-user.png" align="middle" height="360" alt="New user record for fdoe"></td></tr></table></div></li><li class="step"><p>
      By default, <span class="emphasis"><em>implicit synchronization</em></span> is enabled for
      mappings <span class="emphasis"><em>from</em></span> the <code class="literal">managed/user</code>
      repository <span class="emphasis"><em>to</em></span> any external resource. This means that
      when you update a managed object, any mappings defined in the
      <code class="filename">sync.json</code> file that have the managed object as the
      source are automatically executed to update the target system. For more
      information, see <a href="../integrators-guide/index.html#synchronization-mappings-file" class="link"><em class="citetitle">Synchronization
      Mappings File</em></a> in the <em class="citetitle">Integrator's
      Guide</em>.
     </p><p>
      To test that the implicit reconciliation has been successful, look at
      <code class="literal">fdoe</code>'s record in the User View UI. At the bottom of the
      user profile, the Linked Systems panel indicates the external resource to
      which this user entry is mapped.
     </p><p>
      The following image shows that <code class="literal">fdoe</code> now exists in the
      linked resource <code class="literal">ldap account</code>, and shows her entry as it
      appears on the LDAP server.
     </p><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/sample2b-fdoe.png" align="middle" height="360" alt="New user record for fdoe"></td></tr></table></div></li></ol></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="more-sample2c"></a>3.5.&nbsp;Sample 2c - Synchronizing LDAP Group Membership</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#external-ldap-config-2c">3.5.1. External LDAP Configuration</a></span></dt><dt><span class="section"><a href="#install-sample2c">3.5.2. Install the Sample</a></span></dt><dt><span class="section"><a href="#run-sample2c">3.5.3. Run the Sample</a></span></dt></dl></div><a class="indexterm" name="d4757e2231"></a><p>
   Like sample 2b, sample 2c connects to an external LDAP server and has
   mappings from the LDAP server to the OpenIDM repository, and from the
   OpenIDM repository to the LDAP server. However, in sample 2c, LDAP group
   memberships are synchronized, in addition to user entries.
  </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="external-ldap-config-2c"></a>3.5.1.&nbsp;External LDAP Configuration</h3></div></div></div><p>
    Configure the LDAP server as for sample 2,
    <a class="xref" href="#external-ldap-config-2" title="3.3.1.&nbsp;LDAP Server Configuration">Section&nbsp;3.3.1, &#8220;LDAP Server Configuration&#8221;</a>. The LDAP user must have write
    access to create users from OpenIDM on the LDAP server. When you configure
    the LDAP server, import the appropriate LDIF file
    (<code class="filename">openidm/samples/sample2c/data/Example.ldif</code>). This file
    includes the following two LDAP groups:
   </p><pre class="brush: ldif;">
dn: ou=Groups,dc=example,dc=com
ou: Groups
objectClass: organizationalUnit
objectClass: top

dn: cn=openidm,ou=Groups,dc=example,dc=com
uniqueMember: uid=jdoe,ou=People,dc=example,dc=com
cn: openidm
objectClass: groupOfUniqueNames
objectClass: top

dn: cn=openidm2,ou=Groups,dc=example,dc=com
uniqueMember: uid=bjensen,ou=People,dc=example,dc=com
cn: openidm2
objectClass: groupOfUniqueNames
objectClass: top</pre><p>
    The users with DNs <code class="literal">uid=jdoe,ou=People,dc=example,dc=com</code>
    and <code class="literal">uid=bjensen,ou=People,dc=example,dc=com</code> are also
    imported with the <code class="filename">Example.ldif</code> file.
   </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="install-sample2c"></a>3.5.2.&nbsp;Install the Sample</h3></div></div></div><p>
    Prepare OpenIDM as described in <a class="xref" href="#preparing-openidm" title="3.1.2.&nbsp;Preparing OpenIDM">Section&nbsp;3.1.2, &#8220;Preparing OpenIDM&#8221;</a>,
    then start OpenIDM with the configuration for sample 2c.
   </p><div class="screen"><pre>$ cd /path/to/openidm
$ ./startup.sh -p samples/sample2c</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="run-sample2c"></a>3.5.3.&nbsp;Run the Sample</h3></div></div></div><p>
    The mapping configuration file (<code class="filename">sync.json</code>) for this
    sample includes two mappings, <code class="literal">systemLdapAccounts_managedUser</code>,
    which synchronizes users from the source LDAP server with the target
    OpenIDM repository, and <code class="literal">managedUser_systemLdapAccounts</code>,
    which synchronizes changes from the OpenIDM repository to the LDAP server.
   </p><p>
    You can run this part of the sample by using the <code class="literal">curl</code>
    command-line utility, or by using the OpenIDM Administration UI. This
    section provides instructions for both methods.
   </p><div class="procedure"><a name="d4757e2289"></a><div class="procedure-title">Procedure&nbsp;3.5.&nbsp;To Run the Sample Using the Command Line</div><ol class="procedure" type="1"><li class="step"><p>
      Reconcile the repository over the REST interface by running the following
      command:
     </p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 "https://localhost:8443/openidm/recon?_action=recon&amp;mapping=systemLdapAccounts_managedUser&amp;waitForCompletion=true"</strong>
<em>{
  "state": "SUCCESS",
  "_id": "8a25d1ca-c0f3-4e0f-82a0-b5c346282782"
}</em></pre></div><p>
      The reconciliation operation returns a reconciliation run ID and the
      status of the operation. Reconciliation creates user objects from LDAP in
      the OpenIDM repository, assigning the new objects random unique IDs.
     </p></li><li class="step"><p>
      To retrieve the users from the repository, query their IDs as follows:
     </p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/managed/user?_queryId=query-all-ids"</strong>
<em>{
  "remainingPagedResults": -1,
  "pagedResultsCookie": null,
  "resultCount": 2,
  "result": [
    {
      "_rev": "0",
      "_id": "40f41f52-44a0-40fe-83ab-a95b92a25805"
    },
    {
      "_rev": "0",
      "_id": "cec9e2d7-cb6c-4622-94a8-2cb43695476f"
    }
  ]
}</em></pre></div></li><li class="step"><p>
      To retrieve individual user objects, include the ID in the URL. The
      following request retrieves the user object for John Doe:
     </p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/managed/user/cec9e2d7-cb6c-4622-94a8-2cb43695476f"</strong>
<em>{
  "displayName": "John Doe",
  "userName": "jdoe",
  "stateProvince": "",
  "postalAddress": "",
  "ldapGroups": [
    "cn=openidm,ou=Groups,dc=example,dc=com"
  ],
  "effectiveAssignments": {},
  "roles": [
    "openidm-authorized"
  ],
  "country": "",
  "effectiveRoles": [
    "openidm-authorized"
  ],
  "givenName": "John",
  "address2": "",
  "lastPasswordAttempt": "Wed Nov 26 2014 14:30:58 GMT+0200 (SAST)",
  "passwordAttempts": "0",
  "sn": "Doe",
  "mail": "jdoe@example.com",
  "city": "",
  "lastPasswordSet": "",
  "postalCode": "",
  "_id": "cec9e2d7-cb6c-4622-94a8-2cb43695476f",
  "_rev": "1",
  "description": "Created for OpenIDM",
  "accountStatus": "active",
  "telephoneNumber": "1-415-599-1100"
}</em></pre></div><p>
      Note that John Doe's user object contains an <code class="literal">ldapGroups</code>
      property, the value of which indicates his groups on the LDAP server:
     </p><pre class="brush: plain;">"ldapGroups":["cn=openidm,ou=Groups,dc=example,dc=com"]</pre></li><li class="step"><p>
      Update John Doe's <code class="literal">ldapGroups</code> property, to change his
      membership from the <code class="literal">openidm</code> group to the
      <code class="literal">openidm2</code> group.
     </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 --data '[
    {
      "operation":"replace",
      "field":"/ldapGroups",
      "value": ["cn=openidm2,ou=Groups,dc=example,dc=com"]
    }
 ]' \
 "https://localhost:8443/openidm/managed/user?_action=patch&amp;_queryId=for-userName&amp;uid=jdoe"</strong>
<em>{
  "displayName": "John Doe",
  "userName": "jdoe",
  "stateProvince": "",
  "postalAddress": "",
  "effectiveAssignments": {},
  "ldapGroups": [
    "cn=openidm2,ou=Groups,dc=example,dc=com"
  ],
  "roles": [
    "openidm-authorized"
  ],
  "city": "",
  "effectiveRoles": [
    "openidm-authorized"
  ],
  "givenName": "John",
  "lastPasswordAttempt": "Wed Nov 26 2014 14:30:58 GMT+0200 (SAST)",
  "address2": "",
  "passwordAttempts": "0",
  "sn": "Doe",
  "mail": "jdoe@example.com",
  "country": "",
  "_rev": "2",
  "lastPasswordSet": "",
  "postalCode": "",
  "_id": "cec9e2d7-cb6c-4622-94a8-2cb43695476f",
  "description": "Created for OpenIDM",
  "accountStatus": "active",
  "telephoneNumber": "1-415-599-1100"
}</em>   </pre></div><p>
      This command changes John Doe's <code class="literal">ldapGroups</code> property in
      the OpenIDM repository, from
      <code class="literal">"cn=openidm,ou=Groups,dc=example,dc=com"</code> to
      <code class="literal">"cn=openidm2,ou=Groups,dc=example,dc=com"</code>. As a result
      of implicit synchronization, the change is propagated to the LDAP server.
      John Doe is removed from the first LDAP group and added to the second LDAP
      group in OpenDJ.
     </p></li><li class="step"><p>
      You can verify this change by querying John Doe's record on the LDAP
      server, as follows:
     </p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/system/ldap/account/uid=jdoe,ou=People,dc=example,dc=com"</strong>
<em>{
  "_id": "uid=jdoe,ou=People,dc=example,dc=com",
  "telephoneNumber": "1-415-599-1100",
  "description": "Created for OpenIDM",
  "sn": "Doe",
  "dn": "uid=jdoe,ou=People,dc=example,dc=com",
  "ldapGroups": [
    "cn=openidm2,ou=Groups,dc=example,dc=com"
  ],
  "uid": "jdoe",
  "cn": "John Doe",
  "givenName": "John",
  "mail": "jdoe@example.com"
}</em>
     </pre></div></li></ol></div><div class="procedure"><a name="d4757e2372"></a><div class="procedure-title">Procedure&nbsp;3.6.&nbsp;To Run the Sample Using the Admin UI</div><ol class="procedure" type="1"><li class="step"><p>
      Log in to the Admin UI at the URL
      <code class="literal">https://localhost:8443/admin</code> as the default
      administrative user (<code class="literal">openidm-admin</code>) with password
      <code class="literal">openidm-admin</code>.
     </p><p>
      The first time you log into the Admin UI, you are prompted to change your
      password. If you do not want to change your password at this time, simply
      click X to close this window, and continue with the sample.
     </p></li><li class="step"><p>
      Select the Mappings tab.
     </p><p>
      This tab shows two configured mappings, one from the
      <code class="literal">ldap</code> server to the OpenIDM repository
      (<code class="literal">managed/user</code>) and one from the OpenIDM repository to
      the <code class="literal">ldap</code> server.
     </p><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/sample2b-mappings.png" align="middle" height="360" alt="Mappings tab showing the mapping for Sample 2c"></td></tr></table></div></li><li class="step"><p>
      Click anywhere on the first mapping and click Reconcile Now.
     </p><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/sample2b-reconcile.png" align="middle" height="360" alt="Mappings tab showing reconciliation for Sample 2c"></td></tr></table></div><p>
      The reconciliation operation creates the two users from the LDAP server in
      the OpenIDM repository.
     </p></li><li class="step"><p>
      Retrieve the users in the repository by clicking the User View link at the
      top right of the Admin UI.
     </p><p>
      This link opens the User View UI. If you did not change your password in
      the first step, you are prompted to change your password again. You can
      bypass this by simply clicking X to close the password prompt window.
     </p></li><li class="step"><p>
      Select the Users tab.
     </p><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/sample2-users.png" align="middle" height="360" alt="Users tab showing the users in the repo for Sample 2c"></td></tr></table></div><p>
      The two users from the LDAP server have been reconciled to the OpenIDM
      repository.
     </p></li><li class="step"><p>
      To retrieve the details of a specific user, click that username on the
      Users tab.
     </p><p>
      The following image shows the details of user <code class="literal">jdoe</code>.
     </p><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/sample2c-jdoe.png" align="middle" height="360" alt="User details for a specific user"></td></tr></table></div><p>
      Note the Linked Systems section of John Doe's profile. The Linked Resource
      item indicates the external resource on which John Doe's managed object
      is mapped, in this case, <code class="literal">ldap account</code>.
     </p><p>
      In this linked resource, John Doe's <code class="literal">ldapGroups</code> are
      displayed. Currently, John Doe is a member of
      <code class="literal">cn=openidm,ou=Groups,dc=example,dc=com</code>.
     </p></li><li class="step"><p>
      Update John Doe's <code class="literal">ldapGroups</code> property, in the
      repository, to change his membership from the <code class="literal">openidm</code>
      group to the <code class="literal">openidm2</code> group.
     </p><p>
      In the current default version of the User View UI, only specific
      properties of a managed object can be edited. It is therefore not possible
      to update John Doe's <code class="literal">ldapGroups</code> property using the UI.
     </p><p>
      Instead, update his managed/user object over REST, as follows:
     </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 --data '[
    {
      "operation":"replace",
      "field":"/ldapGroups",
      "value": ["cn=openidm2,ou=Groups,dc=example,dc=com"]
    }
 ]' \
 "https://localhost:8443/openidm/managed/user?_action=patch&amp;_queryId=for-userName&amp;uid=jdoe"</strong>
<em>{
  "displayName": "John Doe",
  "userName": "jdoe",
  "stateProvince": "",
  "postalAddress": "",
  "effectiveAssignments": {},
  "ldapGroups": [
    "cn=openidm2,ou=Groups,dc=example,dc=com"
  ],
  "roles": [
    "openidm-authorized"
  ],
  "city": "",
  "effectiveRoles": [
    "openidm-authorized"
  ],
  "givenName": "John",
  "lastPasswordAttempt": "Wed Nov 26 2014 14:30:58 GMT+0200 (SAST)",
  "address2": "",
  "passwordAttempts": "0",
  "sn": "Doe",
  "mail": "jdoe@example.com",
  "country": "",
  "_rev": "2",
  "lastPasswordSet": "",
  "postalCode": "",
  "_id": "cec9e2d7-cb6c-4622-94a8-2cb43695476f",
  "description": "Created for OpenIDM",
  "accountStatus": "active",
  "telephoneNumber": "1-415-599-1100"
}</em>   </pre></div><p>
      This command changes John Doe's <code class="literal">ldapGroups</code> property in
      the OpenIDM repository, from
      <code class="literal">"cn=openidm,ou=Groups,dc=example,dc=com"</code> to
      <code class="literal">"cn=openidm2,ou=Groups,dc=example,dc=com"</code>. As a result
      of implicit synchronization, the change is propagated to the LDAP server.
      John Doe is removed from the first LDAP group and added to the second LDAP
      group in OpenDJ.
     </p></li><li class="step"><p>
      You can verify this change by reloading John Doe's user profile in the
      User View UI, and looking at the value of his <code class="literal">ldapGroups</code>
      property in the Linked Systems panel.
     </p><p>
      The following image shows the updated record for John Doe, with a new
      <code class="literal">ldapGroups</code> value of
      <code class="literal">cn=openidm2,ou=Groups,dc=example,dc=com</code>.
     </p><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/sample2c-jdoe2.png" align="middle" height="360" alt="Updated ldapGroups property for John Doe"></td></tr></table></div></li></ol></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="more-sample2d"></a>3.6.&nbsp;Sample 2d - Synchronizing LDAP Groups</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#external-ldap-config-2d">3.6.1. External LDAP Configuration</a></span></dt><dt><span class="section"><a href="#install-sample2d">3.6.2. Install the Sample</a></span></dt><dt><span class="section"><a href="#run-sample2d">3.6.3. Running the Sample</a></span></dt></dl></div><a class="indexterm" name="d4757e2518"></a><p>Sample 2d also connects to an external LDAP server. This sample 
  focuses on LDAP Group synchronization.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="external-ldap-config-2d"></a>3.6.1.&nbsp;External LDAP Configuration</h3></div></div></div><p>Configure the LDAP server as for sample 2,
   <a class="xref" href="#external-ldap-config-2" title="3.3.1.&nbsp;LDAP Server Configuration">Section&nbsp;3.3.1, &#8220;LDAP Server Configuration&#8221;</a>. The LDAP user must have write
   access to create users from OpenIDM on the LDAP server.</p><p>In addition, two LDAP Groups should be created, which can be found in 
   the LDIF file: <code class="filename">openidm/samples/sample2d/data/Example.ldif</code> 
   (if they have not already been added through sample 2c):</p><pre class="brush: ldif;">
dn: ou=Groups,dc=example,dc=com
ou: Groups
objectClass: organizationalUnit
objectClass: top

dn: cn=openidm,ou=Groups,dc=example,dc=com
uniqueMember: uid=jdoe,ou=People,dc=example,dc=com
cn: openidm
objectClass: groupOfUniqueNames
objectClass: top

dn: cn=openidm2,ou=Groups,dc=example,dc=com
uniqueMember: uid=bjensen,ou=People,dc=example,dc=com
uniqueMember: uid=jdoe,ou=People,dc=example,dc=com
cn: openidm2
objectClass: groupOfUniqueNames
objectClass: top
</pre><p>The user with dn <code class="literal">uid=jdoe,ou=People,dc=example,dc=com</code> 
   is also imported with the <code class="filename">Example.ldif</code> file.</p><p>There is an additional user, <code class="literal">bjensen</code> in the
   sample LDIF file. This user is essentially a "dummy" user, provided for
   compliance with RFC 4519, which stipulates that every
   <code class="literal">groupOfUniqueNames</code> object must contain at least one
   <code class="literal">uniqueMember</code>. <code class="literal">bjensen</code> is not actually
   used in this sample.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="install-sample2d"></a>3.6.2.&nbsp;Install the Sample</h3></div></div></div><p>Prepare OpenIDM as described in <a class="xref" href="#preparing-openidm" title="3.1.2.&nbsp;Preparing OpenIDM">Section&nbsp;3.1.2, &#8220;Preparing OpenIDM&#8221;</a>, 
   then start OpenIDM with the configuration for sample 2d.</p><div class="screen"><pre>$ cd /path/to/openidm
$ ./startup.sh -p samples/sample2d</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="run-sample2d"></a>3.6.3.&nbsp;Running the Sample</h3></div></div></div><p>
    The mapping configuration file (<code class="filename">sync.json</code>) for this
    sample includes three mappings:
   </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">systemLdapAccounts_managedUser</code></p><p>
      Synchronizes users from the source LDAP server with the target
      OpenIDM repository,
     </p></li><li class="listitem"><p><code class="literal">managedUser_systemLdapAccounts</code></p><p>
      Synchronizes changes from the OpenIDM repository to the LDAP server.
     </p></li><li class="listitem"><p><code class="literal">systemLdapGroups_managedGroup</code></p><p>
      Synchronizes groups from the source LDAP server with the target OpenIDM
      repository.
     </p></li></ul></div><p>
    Due to the similarity with other OpenIDM samples, especially samples 2b
    and 2c, the focus of this sample is on the mapping unique to this sample,
    <code class="literal">systemLdapGroups_managedGroup</code>.
   </p><p>
    You can run this part of the sample by using the <code class="literal">curl</code>
    command-line utility, or by using the OpenIDM Administration UI. This
    section provides instructions for both methods.
   </p><div class="procedure"><a name="d4757e2607"></a><div class="procedure-title">Procedure&nbsp;3.7.&nbsp;To Run the Sample Using the Command Line</div><ol class="procedure" type="1"><li class="step"><p>
      Reconcile the repository over the REST interface for the group mapping,
      <code class="literal">systemLdapGroups_managedGroup</code> by running the following
      command:
     </p><div class="screen"><pre>$ <strong> curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 "https://localhost:8443/openidm/recon?_action=recon&amp;mapping=systemLdapGroups_managedGroup&amp;waitForCompletion=true"</strong></pre></div><p>
      The reconciliation operation returns a reconciliation run ID, and the status
      of the operation.
     </p></li><li class="step"><p>
      With the configuration of sample 2d, OpenIDM creates group objects from
      LDAP in OpenIDM. To list group objects by ID, run a query over the REST
      interface.
     </p><div class="screen"><pre>$ <strong> curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/managed/group?_queryFilter=true"</strong></pre></div><p>
      The resulting JSON object should include content similar to the
      following.
     </p><pre class="brush: javascript;">
 {
   "result" : [ {
      "dn" : "cn=openidm,ou=Groups,dc=example,dc=com",
      "_id" : "837df489-35d6-48d1-81a5-23792b49838a",
      "_rev" : "1",
      "description" : [ ],
      "uniqueMember" : [ "uid=jdoe,ou=People,dc=example,dc=com" ],
      "name" : [ "openidm" ]
   }, {
      "dn" : "cn=openidm2,ou=Groups,dc=example,dc=com",
      "_id" : "7575c1c7-86cf-43bc-bf1d-5c9cfc539124",
      "_rev" : "1",
      "description" : [ ],
      "uniqueMember" : [ "uid=bjensen,ou=People,dc=example,dc=com" ],
      "name" : [ "openidm2" ]
   } ],
      "resultCount" : 2,
      "pagedResultsCookie" : null,
      "remainingPagedResults" : -1
 }</pre></li></ol></div><div class="procedure"><a name="d4757e2633"></a><div class="procedure-title">Procedure&nbsp;3.8.&nbsp;To Run the Sample Using the Admin UI</div><ol class="procedure" type="1"><li class="step"><p>
      Log in to the Admin UI at the URL
      <code class="literal">https://localhost:8443/admin</code> as the default
      administrative user (<code class="literal">openidm-admin</code>) with password
      <code class="literal">openidm-admin</code>.
     </p><p>
      The first time you log into the Admin UI, you are prompted to change your
      password. If you do not want to change your password at this time,
      click X to close this window, and continue with the sample.
     </p></li><li class="step"><p>
      Select the Mappings tab.
     </p><p>
      This tab shows three configured mappings, from the
      <code class="literal">ldap</code> server accounts repository to the OpenIDM
      repository (<code class="literal">managed/user</code>), from the OpenIDM repository
      back to the <code class="literal">ldap</code> server, and from the
      <code class="literal">ldap</code> server group accounts repository to the OpenIDM
      <code class="literal">managed/group</code> repository.
     </p><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/sample2d-mappings.png" align="middle" height="360" alt="Mappings tab showing the mapping for Sample 2d"></td></tr></table></div></li><li class="step"><p>
      Click anywhere on the third mapping and click Reconcile Now.
     </p><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/sample2d-reconcile.png" align="middle" height="360" alt="Mappings tab showing reconciliation for Sample 2b"></td></tr></table></div><p>
      The reconciliation operation creates the two groups from the LDAP server in
      the OpenIDM repository.
     </p></li><li class="step"><p>
      Retrieve the groups in the repository by clicking the Correlation link
      below the mapping. Scroll down to Data Association Management.
     </p><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/sample2d-groups.png" align="middle" height="360" alt="Data Association Management showing groups for Sample 2d"></td></tr></table></div><p>
      The two groups from the LDAP server (source) have been reconciled to the
      OpenIDM repository (target).
     </p></li></ol></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="samples-groovy-connector-toolkit"></a>3.7.&nbsp;Using the Groovy Connector Toolkit to Create Scripted Connectors</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#more-sample3">3.7.1. Sample 3 - Using the Groovy Connector Toolkit to Connect to MySQL With ScriptedSQL</a></span></dt><dt><span class="section"><a href="#sample-scripted-rest">3.7.2. Sample - Using the Groovy Connector Toolkit to Connect to OpenDJ With ScriptedREST</a></span></dt><dt><span class="section"><a href="#sample-scripted-crest">3.7.3. Sample - Using the Groovy Connector Toolkit to Connect to OpenDJ With ScriptedCREST</a></span></dt><dt><span class="section"><a href="#samples-azure">3.7.4. Sample - Using the Groovy Connector Toolkit to Connect to
    Microsoft Azure</a></span></dt></dl></div><p>
   OpenICF 1.4 introduces a generic Groovy Connector Toolkit that enables you to
   run Groovy scripts on any external resource.
  </p><p>
   The Groovy Connector Toolkit is not a complete connector, in the traditional
   sense. Rather, it is a framework within which you must write your own Groovy
   scripts to address the requirements of your implementation. Specific scripts
   are provided within these samples, which demonstrate how the Groovy Connector
   Toolkit can be used. These scripts cannot be used "as is" in your deployment,
   but are a good starting point on which to base your customization.
  </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="more-sample3"></a>3.7.1.&nbsp;Sample 3 - Using the Groovy Connector Toolkit to Connect to MySQL With ScriptedSQL</h3></div></div></div><p>
    This sample uses a ScriptedSQL implementation of the Groovy Connector
    Toolkit in which an instance of the ScriptedSQL framework is made to work
    with the <code class="literal">hrdb</code> schema. The "connector" in this sample is
    therefore really an <code class="literal">hrdb</code> connector that is implemented
    with the help of the Groovy Connector Toolkit.
   </p><p>
    The Groovy Connector Toolkit is bundled with OpenIDM 3.1.0, in
    the JAR <code class="filename">openidm/connectors/groovy-connector-1.4.1.0.jar</code>.
    The connector configuration file for this sample
    (<code class="filename">sample3/conf/provisioner.openicf-scriptedsql.json</code>)
    indicates the ScriptedSQL implementation of the Groovy connector as follows:
   </p><pre class="brush: javascript;">{
    "name" : "scriptedsql",
    "connectorRef" : {
        "bundleName" : "org.forgerock.openicf.connectors.groovy-connector",
        "bundleVersion" : "[1.4.0.0,2.0.0.0)",
        "connectorName" : "org.forgerock.openicf.connectors.scriptedsql.ScriptedSQLConnector"
    },
...  </pre><p>
    This sample demonstrates the use of <em class="firstterm">complex data types</em>.
    Complex data types can be stored, retrieved and synchronized like any other
    object property. They are stored in the managed data as JSON, represented as
    a string, but can be mapped to external resources in any format required.
    You can customize the mapping to do additional work with or transformations
    on those data types. The sample defines one complex data type,
    <code class="literal">cars</code>, discussed in more detail later in this section.
   </p><p>
    The mapping in this sample shows the use of event hooks to perform an
    action. The mapping configuration from the internal repository to the
    external <code class="literal">hrdb</code> database system
    (<code class="literal">managedUser_systemHrdb</code>), defined in the
    <code class="filename">sync.json</code> file, includes two script hooks. The first is
    for an <code class="literal">onCreate</code> event and the second for an
    <code class="literal">onUpdate</code> event. For both events, OpenIDM logs a statement
    to the log when a user is created or updated in the external system. The
    script source is included in the mapping, but can also be called from an
    external file. For more information, see the <a href="../integrators-guide/index.html#appendix-scripting" class="link"><em class="citetitle">Scripting
    Appendix</em></a> in the <em class="citetitle">Integrators Guide</em>.
   </p><p>
    This sample also demonstrates the configuration of custom scripted
    endpoints, defined in the connector configuration
    (<code class="filename">provisioner.openicf-scriptedsql.json</code>).
   </p><div class="caution"><h3 class="title">Caution</h3><p>
      Because MySQL cannot "un-hash" user passwords there is no way for a
      reconciliation operation to retrieve and store the password from MySQL and
      store it in the managed user object. This issue might impact
      configurations that support multiple external resources in that passwords
      might not be synchronized immediately after reconciliation from MySQL to
      the managed/user repository. Users who are missing from managed/user will
      be created by the reconciliation but their passwords will be empty. When
      those users are synchronized to other external resources, they will have
      empty passwords in those resources. Additional scripting might be required
      to handle this situation, depending on the requirements of your
      deployment.
     </p></div><p>
     This sample configuration assumes a MySQL server, running on the localhost,
     and listening on port 3306. The sample database, <code class="literal">hrdb</code>,
     is created over REST.
   </p><p>
    The Groovy scripts required for the sample are located in the
    <code class="filename">sample3/tools</code> directory. You will need to customize
    these scripts to address the requirements of your specific deployment,
    however, the sample scripts are a good starting point on which to base your
    customization.
   </p><div class="note"><h3 class="title">Note</h3><p>
     This sample is supported with Java version 7 only. The dependencies
     required for the sample are provided in the
     <code class="literal">openidm/bundle</code> folder and do not require a separate
     download. If you are using the ScriptedSQL connector implementation with
     Java version 6, you must download the related dependencies. For more
     information, see <a class="xref" href="#sample-3-java-6" title="3.7.1.5.&nbsp;Using Sample 3 With Java Version 6">Section&nbsp;3.7.1.5, &#8220;Using Sample 3 With Java Version 6&#8221;</a> at the end of this
     section.
    </p></div><p>
    Prepare a fresh installation of OpenIDM before trying this sample.
   </p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="setup-sample3"></a>3.7.1.1.&nbsp;Setting Up the Sample</h4></div></div></div><p>
    This sample requires an installed, running MySQL instance. The connection to
    the MySQL server is defined in the connector configuration file 
    (<code class="filename">sample3/conf/provisioner.openicf-scriptedsql.json</code>). 
    The default connector configuration file assumes the following connection 
    details:
   </p><pre class="brush: javascript;">"configurationProperties" : {
    "username" : "root",
    "password" : "password",
    "driverClassName" : "com.mysql.jdbc.Driver",
    "url" : "jdbc:mysql://localhost:3306/hrdb",
   </pre><div class="itemizedlist"><p>
     As indicated in the preceding excerpt of the connector configuration file,
     the sample expects the following MySQL configuration:
    </p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
      The database is available on the localhost.
     </p></li><li class="listitem"><p>
      The database listens on port 3306.
     </p></li><li class="listitem"><p>
      You can connect over the network to the database with user
     <code class="literal">root</code> and password <code class="literal">password</code>.
     </p></li></ul></div><p>
    If you have an existing MySQL instance, running on a different host, or
    port, adjust the connector configuration accordingly.
   </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
      Prepare OpenIDM as described in <a class="xref" href="#preparing-openidm" title="3.1.2.&nbsp;Preparing OpenIDM">Section&nbsp;3.1.2, &#8220;Preparing OpenIDM&#8221;</a>.
     </p></li><li class="step"><p>
      Download the <a class="link" href="http://dev.mysql.com/downloads/connector/j/5.1.html" target="_blank">MySQL
      Driver</a>, (MySQL Connector/J, version 5.1 or later) from the MySQL
      website. Unpack the download and copy the .jar into the
      <code class="filename">openidm/bundle</code> directory.
     </p><div class="screen"><pre>$ cp mysql-connector-java-<em><strong>version</strong></em>-bin.jar /path/to/openidm/bundle/</pre></div></li><li class="step"><p>
      Create an empty <code class="literal">hrdb</code> database.
     </p><div class="screen"><pre>$ <strong>mysql -u root -p</strong>
<em>Enter password:
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 2
Server version: 5.5.25a MySQL Community Server (GPL)</em>
mysql&gt; <strong>CREATE DATABASE hrdb CHARACTER SET utf8 COLLATE utf8_bin;</strong>
<em>Query OK, 1 row affected (0.00 sec)</em>
mysql&gt; <strong>quit</strong>
<em>Bye</em></pre></div></li><li class="step"><p>
      Start OpenIDM with the configuration for sample 3.
     </p><div class="screen"><pre>$ <strong>cd /path/to/openidm</strong>
$ <strong>./startup.sh -p samples/sample3</strong>
<em>Executing ./startup.sh...
Using OPENIDM_HOME:   /path/to/openidm
Using PROJECT_HOME:   /path/to/openidm/samples/sample3/
Using OPENIDM_OPTS:   -Xmx1024m -Xms1024m
Using LOGGING_CONFIG: -Djava.util.logging.config.file=/path/to/openidm/samples/sample3/
                      /conf/logging.properties
Using boot properties at /path/to/openidm/samples/sample3/conf/boot/boot.properties
OpenIDM version "3.1.0" (revision: 0) null null
-&gt; OpenIDM ready</em></pre></div></li><li class="step"><p>
      Populate the MySQL database with sample data.
     </p><p>
      This step executes a custom script, over the REST interface, that resets
      and populates the <code class="literal">hrdb</code> database.
     </p><p>
      The script is referenced in a system action, defined in the connector
      configuration file
      (<code class="filename">conf/provisioner.openicf-scriptedsql.json</code>) as
      follows:
     </p><pre class="brush: plain;">"systemActions" : [
    {
        "scriptId" : "ResetDatabase",
        "actions" : [
            {
                "systemType" : ".*ScriptedSQLConnector",
                "actionType" : "Groovy",
                "actionFile" : "tools/ResetDatabaseScript.groovy" }
        ]
    }
... </pre><p>
     You can run this script again, at any point, to reset the database.
     Currently, only Groovy script is supported for these types of actions.
    </p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 "https://localhost:8443/openidm/system/scriptedsql?_action=script&amp;scriptId=ResetDatabase"</strong>
<em>{
  "actions": [
    {
      "result": "Database reset successful."
    }
  ]
}</em></pre></div><p>
      The <code class="literal">hrdb</code> database should now be populated with sample
      data.
     </p><p>
      You can review the contents of the database as follows:
     </p><div class="screen"><pre><strong>$ mysql -u root -p</strong>
mysql &gt; <strong>use hrdb;</strong>
<em>Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed</em>
mysql &gt; <strong>select * from users;</strong>
     <em>
+----+--------+--------------+-----------+----------+---------------+--------...
| id | uid    | password     | firstname | lastname | fullname      | email  ...
+----+--------+------------------------------------------+-----------+-------...
|  1 | bob    | e38ad2149... | Bob       | Fleming  | Bob Fleming   | Bob.Fle...
|  2 | rowley | 2aa60a8ff... | Rowley    | Birkin   | Rowley Birkin | Rowley....
|  3 | louis  | 1119cfd37... | Louis     | Balfour  | Louis Balfour | Louis.B...
|  4 | john   | a1d7584da... | John      | Smith    | John Smith    | John.Sm...
|  5 | jdoe   | edba955d0... | John      | Doe      | John Doe      | John.Do...
+----+--------+------------------------------------------+-----------+-------...
5 rows in set (0.00 sec)
     </em></pre></div><div class="note"><h3 class="title">Note</h3><p>
       The passwords in the output shown above are hashed to the SHA-1 standard,
       as they cannot be read into OpenIDM as clear text. The SHA-1 Hash
       function is used for compatibility reasons. Use a more secure algorithm
       in a production database.
      </p></div></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="run-sample3"></a>3.7.1.2.&nbsp;Reconciling the Repository</h4></div></div></div><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
      The mapping configuration file (<code class="filename">sync.json</code>) for this
      sample includes the mapping <code class="literal">systemHrdb_managedUser</code>,
      which synchronize users from the source <code class="literal">hrdb</code> database
      with the target OpenIDM repository.
     </p><p>
      You can test this part of the sample by using the <code class="literal">curl</code>
      command-line utility, or the OpenIDM Administration UI.
     </p><ul class="stepalternatives">
      <li class="step"><p>
        To reconcile the repository by using the Administration UI:
       </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
          Log in to the Admin UI at the URL
          <code class="literal">https://localhost:8443/admin</code> as the default
          administrative user (<code class="literal">openidm-admin</code>) with password
          <code class="literal">openidm-admin</code>.
         </p><p>
          The first time you log into the Admin UI, you are prompted to change
          your password. If you do not want to change your password at this
          time, simply click X to close this window, and continue with the
          sample.
         </p></li><li class="listitem"><p>
          Select the Mappings tab.
         </p><p>
          This tab shows two configured mappings, one from the
          <code class="literal">hrdb</code> database to the OpenIDM repository
          (<code class="literal">managed/user</code>), and one in the opposite direction.
         </p><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/sample3-mappings.png" align="middle" height="360" alt="Mappings tab showing the two mappings for Sample 3"></td></tr></table></div></li><li class="listitem"><p>
          Click on the first mapping (the mapping from
          <code class="literal">system/scriptedsql/account</code> to
          <code class="literal">managed/user</code>).
         </p></li><li class="listitem"><p>
          Click Reconcile Now.
         </p></li></ol></div></li>
      <li class="step"><p>
        To reconcile the repository by using the command-line, launch the
        reconciliation operation with the following command:
       </p><div class="screen"><pre><strong>$ curl \
--cacert self-signed.crt \
--header "X-OpenIDM-Username: openidm-admin" \
--header "X-OpenIDM-Password: openidm-admin" \
--header "Content-Type: application/json" \
--request POST \
"https://localhost:8443/openidm/recon?_action=recon&amp;mapping=systemHrdb_managedUser&amp;waitForCompletion=true"</strong>
<em>{
  "state": "SUCCESS",
  "_id": "f3c618aa-cc3b-49ed-9a3a-00b012db2513"
}</em></pre></div></li>
     </ul><p>
      The reconciliation operation creates the five users from the MySQL
      database in the OpenIDM repository.
     </p></li><li class="step"><p>
      Retrieve the list of users from the repository.
     </p><ul class="stepalternatives">
      <li class="step"><p>
        To retrieve the users in the repository by using the Administration UI:
       </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
          Click the User View link at the top right of the Admin UI.
         </p><p>
          This opens the regular OpenIDM UI. If you did not change your password
          in the first step, you are prompted to change your password again.
          You can bypass this by simply clicking X to close the password prompt
          window.
         </p></li><li class="listitem"><p>
          Select the Users tab.
         </p><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/sample3-users.png" align="middle" height="360" alt="Mappings tab showing the users in the repo for Sample 3"></td></tr></table></div><p>
          The five users from the <code class="literal">hrdb</code> database have been
          reconciled to the OpenIDM repository.
         </p></li><li class="listitem"><p>
          To retrieve the details of a specific user, click that username on the
          Users tab.
         </p><p>
          The following image shows the details for the user Rowley Birkin.
         </p><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/sample3-rowley.png" align="middle" height="360" alt="Mappings tab showing the users in the repo for Sample 3"></td></tr></table></div></li></ol></div></li>
      <li class="step"><p>
        To retrieve the users from the repository by using the command-line,
        query the IDs in the repository as follows:
     </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/managed/user?_queryId=query-all-ids"</strong>
<em>{
  "remainingPagedResults": -1,
  "pagedResultsCookie": null,
  "resultCount": 5,
  "result": [
    {
      "_rev": "0",
      "_id": "9ee75d24-899c-4221-97a0-0aca298febd6"
    },
    {
      "_rev": "0",
      "_id": "25be1c4c-0c2a-48b6-96f6-58d2e4d2357d"
    },
    {
      "_rev": "0",
      "_id": "2850c77b-f51a-4fb2-8cc4-4c1d03108ac2"
    },
    {
      "_rev": "0",
      "_id": "126d74e1-1c03-4774-b18d-bd4d1dfdf884"
    },
    {
      "_rev": "0",
      "_id": "46570045-0644-45c6-af10-c88ad3df93cc"
    }
  ]
}</em></pre></div><p>
      To retrieve a complete user record, query for an individual user, by his
      userName. The following example returns the record for the user
      <code class="literal">Rowley Birkin</code>.
     </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/managed/user/?_queryId=for-userName&amp;uid=rowley"</strong>
<em>{
  "remainingPagedResults": -1,
  "pagedResultsCookie": null,
  "resultCount": 1,
  "result": [
    {
      "stateProvince": "",
      "userName": "rowley",
      "postalAddress": "",
      "effectiveAssignments": null,
      "roles": [
        "openidm-authorized"
      ],
      "telephoneNumber": "",
      "country": "",
      "effectiveRoles": [
        "openidm-authorized"
      ],
      "givenName": "Rowley",
      "address2": "",
      "lastPasswordAttempt": "Wed Nov 05 2014 10:02:02 GMT+0200 (SAST)",
      "passwordAttempts": "0",
      "sn": "Birkin",
      "mail": "Rowley.Birkin@example.com",
      "city": "",
      "lastPasswordSet": "",
      "organization": "SALES",
      "postalCode": "",
      "_id": "126d74e1-1c03-4774-b18d-bd4d1dfdf884",
      "_rev": "1",
      "cars": [
        {
          "model": "328ci",
          "year": "2013",
          "make": "BMW"
        },
        {
          "model": "ES300",
          "year": "2010",
          "make": "Lexus"
        }
      ],
      "accountStatus": "active"
    }
  ]
}    </em></pre></div></li>
      </ul><p>
      Regardless of how you have retrieved Rowley Birkin's entry, note the
      <code class="literal">"cars"</code> property in this user's entry. This property
      demonstrates a complex object, stored in JSON format in the user
      entry, as a list that contains multiple objects. In the MySQL database,
      the <code class="literal">car</code> table joins to the <code class="literal">users</code>
      table through a <code class="literal">cars.users_id</code> column. The Groovy
      scripts read this data from MySQL and repackage it in a way that OpenIDM
      can understand. With support for complex objects, the data is passed
      through to OpenIDM as a list of <code class="literal">car</code> objects. Data is
      synchronized from OpenIDM to MySQL in the same way. Complex objects can
      also be nested to any depth.
     </p><p>
      Group membership (not demonstrated here) is maintained with a traditional
      "join table" in MySQL (<code class="literal">groups_users</code>). OpenIDM does not
      maintain group membership in this way, so the Groovy scripts do the work
      to translate membership between the two resources.
     </p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="sample3-paging"></a>3.7.1.3.&nbsp;Using Paging With Sample 3</h4></div></div></div><p>
    All OpenICF 1.4.1.0 connectors support the use of paging
    parameters to restrict query results. The following command indicates that
    only two records should be returned (<code class="literal">_pageSize=2</code>) and
    that the records should be sorted according to their
    <code class="literal">timestamp</code> and <code class="literal">_id</code>
    (<code class="literal">_sortKeys=timestamp,id</code>). Including the
    <code class="literal">timestamp</code> in the sort ensures that, as you page through
    the set, changes to records that have already been visited are not lost.
    Instead, those records are pushed onto the last page.
   </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 'https://localhost:8443/openidm/system/scriptedsql/account?_queryFilter=uid+sw+""&amp;_fields=id,uid&amp;_pageSize=2&amp;_sortKeys=timestamp,id'</strong>
<em>{
  "remainingPagedResults": -1,
  "pagedResultsCookie": "2014-09-10 12:18:46.0,2",
  "resultCount": 2,
  "result": [
    {
      "_id": "1",
      "uid": "bob"
    },
    {
      "_id": "2",
      "uid": "rowley"
    }
  ]
}
</em></pre></div><p>
    The <code class="literal">"pagedResultsCookie"</code> is used by the server to keep
    track of the position in the search results. You can ignore the
    <code class="literal">"remainingPagedResults": -1</code> in the output. The real value
    of this property is not returned because the scripts that the connector uses
    do not do any counting of the records in the resource.
   </p><p>
    Using the <code class="literal">"pagedResultsCookie"</code> from the previous step,
    run a similar query, to retrieve the following set of records in the
    database. You must URL-encode the space character between the date and time
    in the <code class="literal">"pagedResultsCookie"</code> value, with
    <code class="literal">%20</code>, as shown in the following example:
   </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/system/scriptedsql/account?_queryId=query-all-ids&amp;_pageSize=2&amp;_sortKeys=timestamp,id&amp;_pagedResultsCookie2014-09-10%2012:18:46.0,2"</strong>
<em>{
  "remainingPagedResults": -1,
  "pagedResultsCookie": "2014-09-10 12:18:46.0,4",
  "resultCount": 2,
  "result": [
    {
      "_id": "3",
      "uid": "louis"
    },
    {
      "_id": "4",
      "uid": "john"
    }
  ]
}</em></pre></div><p>
    For more information about paging support, see <a href="../integrators-guide/index.html#paging-query-results" class="link"><em class="citetitle">Paging Query
    Results</em></a> in the <em class="citetitle">Integrator's Guide</em>.
   </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="sample3-updating-mysql"></a>3.7.1.4.&nbsp;Reconciling the MySQL Database</h4></div></div></div><div class="procedure"><p>
     The second mapping defined in the mapping configuration file for this
     sample (<code class="literal">managedUser_systemHrdb</code>) synchronizes users from
     the source OpenIDM repository to the target <code class="literal">hrdb</code>
     database. Instead of running a manual reconciliation operation to
     synchronize these resources, edit one of the user records in the
     OpenIDM UI.
    </p><ol class="procedure" type="1"><li class="step"><p>
      Log in to the OpenIDM UI (https://localhost:8443/openidmui) as any one of
      the users that was created in the repository by the previous
      reconciliation operation.
     </p><p>
      The initial clear text passwords of these users can be seen in the
      <code class="literal">sample3/tools/ResetDatabaseScript.groovy</code> script and are
     provided here for ease of reference:
</p><div class="literallayout"><p>"bob",&nbsp;"password1"<br>
"rowley",&nbsp;"password2"<br>
"louis",&nbsp;"password3"<br>
"john",&nbsp;"password4"<br>
"jdoe",&nbsp;"password5"</p></div><p>
     </p><p>
      Regular users can update their profiles or passwords. Any changes are
      automatically synchronized back to the <code class="literal">hrdb</code> database,
      through the implicit synchronization mechanism.
     </p><p>
      For example, log into the UI as user <code class="literal">john</code> with the
      password <code class="literal">password4</code>.
     </p><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/john-login.png" align="middle" height="360"></td></tr></table></div></li><li class="step"><p>
      Update the password or profile of the user <code class="literal">john</code> (or the
      user as whom you logged in in the previous step).
     </p><p>
      The following example updates the email address for user
      <code class="literal">john</code> to <code class="literal">John.P.Smith@example.com</code>.
     </p><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/john-address-change.png" align="middle" height="360"></td></tr></table></div></li><li class="step"><p>
      Changes are automatically synchronized to the <code class="literal">hrdb</code>
      database. Retrieve user <code class="literal">john</code>'s record from the database
      by including his <code class="literal">_id</code> in a query on the system endpoint,
      for example:
     </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/system/scriptedsql/account/4"</strong>
<em>{
  "_id": "4",
  "email": "John.P.Smith@example.com",
  "organization": "SUPPORT",
  "firstName": "John",
  "lastName": "Smith",
  "uid": "john",
  "fullName": "John Smith"
}</em></pre></div></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="sample-3-java-6"></a>3.7.1.5.&nbsp;Using Sample 3 With Java Version 6</h4></div></div></div><p>
    The default sample works only with Java Version 7, and bundles the required
    dependencies in the <code class="literal">openidm/bundle</code> folder. To use the
    sample with Java Version 6, you must remove these dependencies and download
    the dependencies specific to Java 6. Follow these steps:
   </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
      Remove the following jar files from the <code class="literal">openidm/bundle</code>
      folder:
     </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
         <code class="filename">tomcat-juli-8.0.12.jar</code>
        </p></li><li class="listitem"><p>
         <code class="filename">tomcat-jdbc-8.0.12.jar</code>
        </p></li></ul></div></li><li class="step"><p>
      Create a <code class="filename">lib</code> folder in the OpenIDM installation
      directory.
     </p><div class="screen"><pre><strong>$ cd /path/to/openidm
$ mkdir lib</strong></pre></div></li><li class="step"><p>
      Download the following dependencies to the <code class="filename">openidm/lib</code>
      directory:
     </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        Apache Geronimo Tomcat fork (Juli), <code class="filename">juli-7.0.39.2.jar</code>
        <a class="link" href="http://search.maven.org/#artifactdetails%7Corg.apache.geronimo.ext.tomcat%7Cjuli%7C7.0.39.2%7Cbundle" target="_blank">(org.apache.geronimo.ext.tomcat:juli:7.0.39.2)</a>
       </p></li><li class="listitem"><p>
        Tomcat JDBC Pool Package, <code class="filename">tomcat-jdbc-7.0.53.jar</code>
        <a class="link" href="http://search.maven.org/#artifactdetails%7Corg.apache.tomcat%7Ctomcat-jdbc%7C7.0.53%7Cjar" target="_blank">(org.apache.tomcat:tomcat-jdbc:7.0.53)</a>
       </p></li></ul></div></li></ol></div><p>
    The remainder of the sample should work as for Java Version 7.
   </p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="sample-scripted-rest"></a>3.7.2.&nbsp;Sample - Using the Groovy Connector Toolkit to Connect to OpenDJ With ScriptedREST</h3></div></div></div><a class="indexterm" name="d4757e3284"></a><p>
   This sample uses the Groovy Connector Toolkit to implement a ScriptedREST
   connector, which interacts with the OpenDJ REST API.
   </p><p>
    The Groovy Connector Toolkit is bundled with OpenIDM 3.1.0, in
    the JAR <code class="filename">openidm/connectors/groovy-connector-1.4.1.0.jar</code>.
  </p><p>
   The connector configuration file for this sample
   (<code class="filename">samples/scriptedrest2dj/conf/provisioner.openicf-scriptedrest.json</code>)
   indicates the ScriptedREST implementation of the Groovy connector as follows:
  </p><pre class="brush: javascript;">{
    "name": "scriptedrest",
    "connectorRef": {
        "connectorHostRef": "#LOCAL",
        "connectorName": "org.forgerock.openicf.connectors.scriptedrest.ScriptedRESTConnector",
        "bundleName": "org.forgerock.openicf.connectors.groovy-connector",
        "bundleVersion": "[1.4.0.0,2.0.0.0)"
    },
...  </pre><p>
   The Groovy scripts required for the sample are located in the
   <code class="filename">samples/scriptedrest2dj/tools</code> directory. You will need to
   customize these scripts to address the requirements of your specific
   deployment, however, the sample scripts are a good starting point on which to
   base your customization.
  </p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="sample-scripted-rest-opendj"></a>3.7.2.1.&nbsp;Setting Up OpenDJ</h4></div></div></div><p>
    This sample assumes an OpenDJ server, running on the localhost. Follow these
    steps to install and configure an OpenDJ instance.
   </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
      Download and extract the OpenDJ zip archive.
     </p><p>
      Find a link to the OpenDJ download page from the <a class="link" href="http://forgerock.com/download-stack/" target="_blank">http://forgerock.com/download-stack/</a>.
     </p></li><li class="step"><p>
      Install OpenDJ using the command-line setup, as follows:
     </p><div class="screen"><pre><strong>$ cd /path/to/opendj
$ ./setup --cli \
  --hostname localhost \
  --ldapPort 1389 \
  --rootUserDN "cn=Directory Manager" \
  --rootUserPassword password \
  --adminConnectorPort 4444 \
  --addBaseEntry \
  --baseDN dc=com \
  --acceptLicense \
  --no-prompt</strong>
<em>...
Configuring Directory Server ..... Done.
Creating Base Entry dc=com ..... Done.
Starting Directory Server ....... Done.
...</em>
     </pre></div><p>
      The sample assumes the following configuration:
     </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        The server is installed on the localhost.
       </p></li><li class="listitem"><p>
        The server listens for LDAP connections on port 1389.
       </p></li><li class="listitem"><p>
        The administration connector port is 4444.
       </p></li><li class="listitem"><p>
        The root user DN is <code class="literal">cn=Directory Manager</code>.
       </p></li><li class="listitem"><p>
        The root user password is <code class="literal">password</code>.
       </p></li></ul></div></li><li class="step"><p>
      Configure the OpenDJ server for replication.
     </p><p>
      To enable LiveSync, this server must be configured for replication, even
      if it does not actually participate in a replication topology. The
      following commands configure the server for replication.
     </p><div class="screen"><pre><strong>$ cd /path/to/opendj/bin
$ ./dsconfig create-replication-server \
  --hostname localhost \
  --port 4444 \
  --bindDN "cn=Directory Manager" \
  --bindPassword password \
  --provider-name "Multimaster Synchronization" \
  --set replication-port:8989 \
  --set replication-server-id:2 \
  --type generic \
  --trustAll \
  --no-prompt

$ ./dsconfig create-replication-domain \
  --hostname localhost \
  --port 4444 \
  --bindDN "cn=Directory Manager" \
  --bindPassword password \
  --provider-name "Multimaster Synchronization" \
  --domain-name example_com \
  --set base-dn:dc=example,dc=com \
  --set replication-server:localhost:8989 \
  --set server-id:3 \
  --type generic \
  --trustAll \
  --no-prompt</strong>
     </pre></div></li><li class="step"><p>
      Enable HTTP access to the OpenDJ directory server as follows:
     </p><div class="screen"><pre><strong>$ ./dsconfig set-connection-handler-prop \
 --hostname localhost \
 --port 4444 \
 --bindDN "cn=Directory Manager" \
 --bindPassword password \
 --handler-name "HTTP Connection Handler" \
 --set enabled:true \
 --set listen-port:8090 \
 --no-prompt \
 --trustAll</strong>
     </pre></div></li><li class="step"><p>
      Enable the OpenDJ HTTP access log.
     </p><div class="screen"><pre><strong>$ ./dsconfig set-log-publisher-prop \
 --hostname localhost \
 --port 4444 \
 --bindDN "cn=Directory Manager" \
 --bindPassword password \
 --publisher-name "File-Based HTTP Access Logger" \
 --set enabled:true \
 --no-prompt \
 --trustAll</strong></pre></div></li><li class="step"><p>
      Import the LDIF data required for the sample.
     </p><div class="screen"><pre><strong>$ ./ldapmodify \
 --bindDN "cn=Directory Manager" \
 --bindPassword password \
 --hostname localhost \
 --port 1389 \
 --filename /path/to/openidm/samples/scriptedrest2dj/data/ldap.ldif</strong>
<em>Processing ADD request for dc=example,dc=com
ADD operation successful for DN dc=example,dc=com
Processing ADD request for ou=Administrators,dc=example,dc=com
ADD operation successful for DN ou=Administrators,dc=example,dc=com
Processing ADD request for uid=idm,ou=Administrators,dc=example,dc=com
ADD operation successful for DN uid=idm,ou=Administrators,dc=example,dc=com
Processing ADD request for ou=People,dc=example,dc=com
ADD operation successful for DN ou=People,dc=example,dc=com
Processing ADD request for ou=Groups,dc=example,dc=com
ADD operation successful for DN ou=Groups,dc=example,dc=com</em>
     </pre></div></li><li class="step"><p>
      To configure the mapping between JSON resources and LDAP entries, copy the
      the configuration file for the HTTP connection handler
      (<code class="filename">/path/to/openidm/samples/scriptedrest2dj/data/http-config.json</code>)
      to OpenDJ's configuration directory.
     </p><div class="screen"><pre><strong>$ cd /path/to/opendj
$ cp /path/to/openidm/samples/scriptedrest2dj/data/http-config.json config/</strong></pre></div></li><li class="step"><p>
      Restart OpenDJ for the configuration change to take effect.
     </p><div class="screen"><pre><strong>$ cd /path/to/opendj/bin
$ ./stop-ds --restart</strong>
<em>Stopping Server...
The Directory Server has started successfully</em></pre></div></li></ol></div><p>
    OpenDJ is now configured for this sample.
   </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="sample-scripted-rest-running"></a>3.7.2.2.&nbsp;Running the Sample</h4></div></div></div><p>
    This section illustrates the basic CRUD operations on users and groups using
    the ScriptedREST connector and the OpenDJ REST API. Note that the power of
    the Groovy connector is in the associated Groovy scripts, and their
    application in your specific deployment. The scripts provided with this
    sample are specific to the sample and customization of the scripts is
    required.
   </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
      Start OpenIDM with the configuration for the ScriptedREST sample.
     </p><div class="screen"><pre><strong>$ cd /path/to/openidm
$ ./startup.sh -p samples/scriptedrest2dj/</strong></pre></div></li><li class="step"><p>
      Check the connector configuration is correct by obtaining the status of
      the connector, over REST.
     </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 "https://localhost:8443/openidm/system/scriptedrest?_action=test"</strong>
<em>{
  "ok": true,
  "connectorRef": {
    "bundleVersion": "[1.4.0.0,2.0.0.0)",
    "bundleName": "org.forgerock.openicf.connectors.groovy-connector",
    "connectorName": "org.forgerock.openicf.connectors.scriptedrest.ScriptedRESTConnector"
  },
  "objectTypes": [
    "group",
    "account"
  ],
  "config": "config/provisioner.openicf/scriptedrest",
  "enabled": true,
  "name": "scriptedrest"
}</em>
     </pre></div></li><li class="step"><p>
      Create a group entry on the OpenDJ server.
     </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 --data '{
   "_id" : "group1"
 }' \
 "https://localhost:8443/openidm/system/scriptedrest/group?_action=create"</strong>
<em>{
    "_id": "group1",
    "cn": "group1",
    "members": null,
    "lastModified": null,
    "created": "2014-09-24T17:34:27Z",
    "displayName": "group1"
}</em></pre></div></li><li class="step"><p>
      Create a user entry on the OpenDJ server.
     </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 --data '{
   "givenName" : "Steven",
   "familyName" : "Carter",
   "emailAddress" : "scarter@example.com",
   "telephoneNumber" : "444-444-4444",
   "password" : "Passw0rd",
   "displayName" : "Steven.Carter",
   "uid" : "scarter"
 }' \
 https://localhost:8443/openidm/system/scriptedrest/account?_action=create</strong>
<em>{
    "_id": "scarter",
    "displayName": "Steven.Carter",
    "uid": "scarter",
    "groups": null,
    "familyName": "Carter",
    "emailAddress": "steven.carter@example.com",
    "givenName": "Steven",
    "created": "2014-09-24T17:35:46Z",
    "telephoneNumber": "444-444-4444"
}</em></pre></div><p>
      Notice that at this stage, the user is not a member of any group.
     </p></li><li class="step"><p>
      Update Steven Carter's entry, by modifying his telephone number.
     </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request PUT \
 --data '{
   "givenName" : "Steven",
   "familyName" : "Carter",
   "emailAddress" : "scarter@example.com",
   "telephoneNumber" : "555-555-5555",
   "password" : "Passw0rd",
   "displayName" : "Steven.Carter",
   "uid" : "scarter"
 }' \
 https://localhost:8443/openidm/system/scriptedrest/account/scarter</strong>
<em>{
    "_id": "scarter",
    "displayName": "Steven.Carter",
    "uid": "scarter",
    "groups": null,
    "familyName": "Carter",
    "emailAddress": "steven.carter@example.com",
    "givenName": "Steven",
    "created": "2014-09-24T17:35:46Z",
    "telephoneNumber": "555-555-5555"
}</em></pre></div></li><li class="step"><p>
      Add Steven Carter to the group you created previously, by updating the
      group entry.
     </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request PUT \
 --data '{
 "_id" : "group1",
 "members" : [{"_id" : "scarter"}]
 }' \
 https://localhost:8443/openidm/system/scriptedrest/group/group1</strong>
<em>{
    "_id": "group1",
    "cn": "group1",
    "members": [
        {
            "displayName": "Steven.Carter",
            "_id": "scarter"
        }
    ],
    "lastModified": "2014-09-24T17:31:42Z",
    "created": "2014-09-24T17:27:37Z",
    "displayName": "group1"
}</em></pre></div></li><li class="step"><p>
      Read Steven Carter's entry, to verify that he is now a member of group1.
     </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 https://localhost:8443/openidm/system/scriptedrest/account/scarter</strong>
<em>{
    "_id": "scarter",
    "displayName": "Steven.Carter",
    "uid": "scarter",
    "groups": [
        {
            "_id": "group1"
        }
    ],
    "familyName": "Carter",
    "emailAddress": "steven.carter@example.com",
    "givenName": "Steven",
    "created": "2014-09-24T17:31:04Z",
    "telephoneNumber": "555-555-5555"
}</em></pre></div></li><li class="step"><p>
      Read the group entry to verify its members.
     </p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 https://localhost:8443/openidm/system/scriptedrest/group/group1</strong>
<em>{
    "_id": "group1",
    "cn": "group1",
    "members": [
        {
            "displayName": "Steven.Carter",
            "_id": "scarter"
            }
    ],
    "lastModified": "2014-09-24T17:31:42Z",
    "created": "2014-09-24T17:27:37Z",
    "displayName": "group1"
}</em></pre></div></li><li class="step"><p>
      Delete the user and group entries, returning the OpenDJ server to its
      initial state.
     </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request DELETE \
 https://localhost:8443/openidm/system/scriptedrest/account/scarter</strong>
<em>{
    "_id": "scarter"
}</em>
<strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request DELETE \
 https://localhost:8443/openidm/system/scriptedrest/group/group1</strong>
<em>{
    "_id": "group1"
}</em>
     </pre></div></li></ol></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="sample-scripted-crest"></a>3.7.3.&nbsp;Sample - Using the Groovy Connector Toolkit to Connect to OpenDJ With ScriptedCREST</h3></div></div></div><a class="indexterm" name="d4757e3505"></a><p>
   This sample uses the Groovy Connector Toolkit to implement a ScriptedCREST
   connector, which interacts with the ForgeRock Commons REST (CREST) API to
   connect to an OpenDJ instance. The main difference between a CREST-based API
   and a generic REST API is that the CREST API is inherently recognizable by
   all ForgeRock products. As such, the sample can leverage CREST resources in
   the groovy scripts, to create CREST requests.
   
   </p><p>
    The Groovy Connector Toolkit is bundled with OpenIDM 3.1.0, in
    the JAR <code class="filename">openidm/connectors/groovy-connector-1.4.1.0.jar</code>.
  </p><p>
   The connector configuration file for this sample
   (<code class="filename">samples/scriptedcrest2dj/conf/provisioner.openicf-scriptedcrest.json</code>)
   indicates the ScriptedCREST implementation of the Groovy Connector Toolkit
   as follows:
  </p><pre class="brush: javascript;">{
    "name": "scriptedcrest",
    "connectorRef": {
        "connectorHostRef": "#LOCAL",
        "connectorName": "org.forgerock.openicf.connectors.scriptedcrest.ScriptedCRESTConnector",
        "bundleName": "org.forgerock.openicf.connectors.groovy-connector",
        "bundleVersion": "[1.4.0.0,2.0.0.0)"
    },
...  </pre><p>
   The Groovy scripts required for the sample are located in the
   <code class="filename">samples/scriptedcrest2dj/tools</code> directory. You will need
   to customize these scripts to address the requirements of your specific
   deployment, however, the sample scripts are a good starting point on which to
   base your customization.
  </p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="sample-scripted-crest-opendj"></a>3.7.3.1.&nbsp;Setting Up OpenDJ</h4></div></div></div><p>
    This sample assumes an OpenDJ server, running on the localhost. Follow these
    steps to install and configure an OpenDJ instance.
   </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
      Download and extract the OpenDJ zip archive.
     </p><p>
      Find a link to the OpenDJ download page from the <a class="link" href="http://forgerock.com/download-stack/" target="_blank">http://forgerock.com/download-stack/</a>.
     </p></li><li class="step"><p>
      Install OpenDJ using the command-line setup, as follows:
     </p><div class="screen"><pre><strong>$ cd /path/to/opendj
$ ./setup --cli \
  --hostname localhost \
  --ldapPort 1389 \
  --rootUserDN "cn=Directory Manager" \
  --rootUserPassword password \
  --adminConnectorPort 4444 \
  --addBaseEntry \
  --baseDN dc=com \
  --acceptLicense \
  --no-prompt</strong>
<em>...
Configuring Directory Server ..... Done.
Creating Base Entry dc=com ..... Done.
Starting Directory Server ....... Done.
...</em>
     </pre></div><p>
      The sample assumes the following configuration:
     </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        The server is installed on the localhost.
       </p></li><li class="listitem"><p>
        The server listens for LDAP connections on port 1389.
       </p></li><li class="listitem"><p>
        The administration connector port is 4444.
       </p></li><li class="listitem"><p>
        The root user DN is <code class="literal">cn=Directory Manager</code>.
       </p></li><li class="listitem"><p>
        The root user password is <code class="literal">password</code>.
       </p></li></ul></div></li><li class="step"><p>
      Configure the OpenDJ server for replication.
     </p><p>
      To enable liveSync, this server must be configured for replication, even
      if it does not actually participate in a replication topology. The
      following commands configure the server for replication.
     </p><div class="screen"><pre><strong>$ cd /path/to/opendj/bin
$ ./dsconfig create-replication-server \
  --hostname localhost \
  --port 4444 \
  --bindDN "cn=Directory Manager" \
  --bindPassword password \
  --provider-name "Multimaster Synchronization" \
  --set replication-port:8989 \
  --set replication-server-id:2 \
  --type generic \
  --trustAll \
  --no-prompt

$ ./dsconfig create-replication-domain \
  --hostname localhost \
  --port 4444 \
  --bindDN "cn=Directory Manager" \
  --bindPassword password \
  --provider-name "Multimaster Synchronization" \
  --domain-name example_com \
  --set base-dn:dc=example,dc=com \
  --set replication-server:localhost:8989 \
  --set server-id:3 \
  --type generic \
  --trustAll \
  --no-prompt</strong>
     </pre></div></li><li class="step"><p>
      Enable HTTP access to the OpenDJ directory server as follows:
     </p><div class="screen"><pre><strong>$ ./dsconfig set-connection-handler-prop \
 --hostname localhost \
 --port 4444 \
 --bindDN "cn=Directory Manager" \
 --bindPassword password \
 --handler-name "HTTP Connection Handler" \
 --set enabled:true \
 --set listen-port:8090 \
 --no-prompt \
 --trustAll</strong>
     </pre></div></li><li class="step"><p>
      Enable the OpenDJ HTTP access log.
     </p><div class="screen"><pre><strong>$ ./dsconfig set-log-publisher-prop \
 --hostname localhost \
 --port 4444 \
 --bindDN "cn=Directory Manager" \
 --bindPassword password \
 --publisher-name "File-Based HTTP Access Logger" \
 --set enabled:true \
 --no-prompt \
 --trustAll</strong></pre></div></li><li class="step"><p>
      Import the LDIF data required for the sample.
     </p><div class="screen"><pre><strong>$ ./ldapmodify \
 --bindDN "cn=Directory Manager" \
 --bindPassword password \
 --hostname localhost \
 --port 1389 \
 --filename /path/to/openidm/samples/scriptedcrest2dj/data/ldap.ldif</strong>
<em>Processing ADD request for dc=example,dc=com
ADD operation successful for DN dc=example,dc=com
Processing ADD request for ou=Administrators,dc=example,dc=com
ADD operation successful for DN ou=Administrators,dc=example,dc=com
Processing ADD request for uid=idm,ou=Administrators,dc=example,dc=com
ADD operation successful for DN uid=idm,ou=Administrators,dc=example,dc=com
Processing ADD request for ou=People,dc=example,dc=com
ADD operation successful for DN ou=People,dc=example,dc=com
Processing ADD request for ou=Groups,dc=example,dc=com
ADD operation successful for DN ou=Groups,dc=example,dc=com</em>
     </pre></div></li><li class="step"><p>
      To configure the mapping between JSON resources and LDAP entries, copy the
      the configuration file for the HTTP connection handler
      (<code class="filename">/path/to/openidm/samples/scriptedcrest2dj/data/http-config.json</code>)
      to OpenDJ's configuration directory.
     </p><div class="screen"><pre><strong>$ cd /path/to/opendj
$ cp /path/to/openidm/samples/scriptedcrest2dj/data/http-config.json config/</strong></pre></div></li><li class="step"><p>
      Restart OpenDJ for the configuration change to take effect.
     </p><div class="screen"><pre><strong>$ cd /path/to/opendj/bin
$ ./stop-ds --restart</strong>
<em>Stopping Server...
The Directory Server has started successfully</em></pre></div></li></ol></div><p>
    OpenDJ is now configured for this sample.
   </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="sample-scripted-crest-running"></a>3.7.3.2.&nbsp;Running the Sample</h4></div></div></div><p>
    This section illustrates the basic CRUD operations on users and groups using
    the ScriptedCREST connector implementation and the OpenDJ REST API. Note
    that the power of the Groovy connector is in the associated Groovy scripts,
    and their application in your specific deployment. The scripts provided with
    this sample are specific to the sample and customization of the scripts is
    required.
   </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
      Start OpenIDM with the configuration for the ScriptedCREST sample.
     </p><div class="screen"><pre><strong>$ cd /path/to/openidm
$ ./startup.sh -p samples/scriptedcrest2dj/</strong></pre></div></li><li class="step"><p>
      Check the connector configuration is correct by obtaining the status of
      the connector, over REST.
     </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 "https://localhost:8443/openidm/system/scriptedcrest?_action=test"</strong>
<em>{
  "ok": true,
  "connectorRef": {
    "bundleVersion": "[1.4.0.0,2.0.0.0)",
    "bundleName": "org.forgerock.openicf.connectors.groovy-connector",
    "connectorName": "org.forgerock.openicf.connectors.scriptedcrest.ScriptedCRESTConnector"
  },
  "objectTypes": [
    "groups",
    "users"
  ],
  "config": "config/provisioner.openicf/scriptedcrest",
  "enabled": true,
  "name": "scriptedcrest"
}</em>
     </pre></div></li><li class="step"><p>
      Create a group entry on the OpenDJ server.
     </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 --data '{
   "_id" : "group1"
 }' \
 "https://localhost:8443/openidm/system/scriptedcrest/groups?_action=create"</strong>
<em>{
  "_rev": "0000000028f53bdf",
  "_id": "group1",
  "displayName": "group1",
  "meta": {
    "created": "2014-10-17T07:43:13Z"
  }
}</em></pre></div></li><li class="step"><p>
      Create a user entry on the OpenDJ server.
     </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "Content-Type: application/json" \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request POST \
 --data '{
     "name": {
         "familyName": "Carter",
         "givenName" : "Steven"
     },
     "contactInformation": {
         "emailAddress" : "scarter@example.com",
         "telephoneNumber" : "444-444-4444"
     },
     "password" : "TestPassw0rd",
     "displayName" : "Steven.Carter",
     "_id" : "scarter"
 }' \
 "https://localhost:8443/openidm/system/scriptedcrest/users?_action=create"</strong>
<em>{
  "_rev": "00000000d84482de",
  "meta": {
    "created": "2014-10-17T08:07:46Z"
  },
  "userName": "scarter@example.com",
  "contactInformation": {
    "emailAddress": "scarter@example.com",
    "telephoneNumber": "444-444-4444"
  },
  "name": {
    "givenName": "Steven",
    "familyName": "Carter"
  },
  "displayName": "Steven.Carter",
  "_id": "scarter"
}</em></pre></div><p>
      Notice that at this stage, the user is not a member of any group.
     </p></li><li class="step"><p>
      Update Steven Carter's entry, by modifying his telephone number.
     </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request PUT \
 --data '{
     "name": {
         "familyName": "Carter",
         "givenName" : "Steven"
     },
     "contactInformation": {
         "emailAddress" : "scarter@example.com",
         "telephoneNumber" : "555-555-5555"
     },
     "password" : "TestPassw0rd",
     "displayName" : "Steven.Carter",
     "_id" : "scarter"
 }' \
 "https://localhost:8443/openidm/system/scriptedcrest/users/scarter"</strong>
<em>{
  "_rev": "00000000eb8ba31c",
  "meta": {
    "created": "2014-10-17T08:07:46Z",
    "lastModified": "2014-10-17T08:25:05Z"
  },
  "userName": "scarter@example.com",
  "contactInformation": {
    "emailAddress": "scarter@example.com",
    "telephoneNumber": "555-555-5555"
  },
  "name": {
    "givenName": "Steven",
    "familyName": "Carter"
  },
  "displayName": "Steven.Carter",
  "_id": "scarter"
}</em></pre></div></li><li class="step"><p>
      Add Steven Carter to the group you created previously, by updating the
      members of the group entry.
     </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request PUT \
 --data '{
 "_id" : "group1",
 "members" : [{"_id" : "scarter"}]
 }' \
 "https://localhost:8443/openidm/system/scriptedcrest/groups/group1"</strong>
<em>{
  "_rev": "0000000011ed6ea1",
  "members": [
    {
      "displayName": "Steven.Carter",
      "_id": "scarter"
    }
  ],
  "_id": "group1",
  "displayName": "group1",
  "meta": {
    "created": "2014-10-17T07:43:13Z",
    "lastModified": "2014-10-17T08:26:41Z"
  }
}</em></pre></div></li><li class="step"><p>
      Read Steven Carter's entry, to verify that he is now a member of group1.
     </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/system/scriptedcrest/users/scarter"</strong>
<em>{
  "_rev": "00000000eb8ba31c",
  "groups": [
    {
      "_id": "group1"
    }
  ],
  "meta": {
    "created": "2014-10-17T08:07:46Z",
    "lastModified": "2014-10-17T08:25:05Z"
  },
  "userName": "scarter@example.com",
  "contactInformation": {
    "emailAddress": "scarter@example.com",
    "telephoneNumber": "555-555-5555"
  },
  "name": {
    "givenName": "Steven",
    "familyName": "Carter"
  },
  "displayName": "Steven.Carter",
  "_id": "scarter"
}</em></pre></div></li><li class="step"><p>
      Read the group entry to verify its members.
     </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/system/scriptedcrest/groups/group1"</strong>
<em>{
  "_rev": "0000000011ed6ea1",
  "members": [
    {
      "displayName": "Steven.Carter",
      "_id": "scarter"
    }
  ],
  "_id": "group1",
  "displayName": "group1",
  "meta": {
    "created": "2014-10-17T07:43:13Z",
    "lastModified": "2014-10-17T08:26:41Z"
  }
}</em></pre></div></li><li class="step"><p>
      Delete the user and group entries, returning the OpenDJ server to its
      initial state.
     </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request DELETE \
 "https://localhost:8443/openidm/system/scriptedcrest/users/scarter"</strong>
<em>{
    "_id": "scarter"
}</em>
<strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request DELETE \
 "https://localhost:8443/openidm/system/scriptedcrest/groups/group1"</strong>
<em>{
    "_id": "group1"
}</em>
     </pre></div></li></ol></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="samples-azure"></a>3.7.4.&nbsp;Sample - Using the Groovy Connector Toolkit to Connect to
    Microsoft Azure</h3></div></div></div><a class="indexterm" name="d4757e3727"></a><p>
    This sample uses the Groovy Connector Toolkit to implement a Microsoft Azure
    connector, which interacts with the ForgeRock Commons REST (CREST) API to
    connect to an Azure-based instance of Active Directory. The main difference
    between a CREST-based API and a generic REST API is that the CREST API is
    inherently recognizable by all ForgeRock products. As such, the sample can
    leverage CREST resources in the groovy scripts, to create CREST requests.
   </p><p>
    As noted on the <a class="link" href="http://azure.microsoft.com/en-us/overview/what-is-azure/" target="_blank">
    <em class="citetitle">Microsoft Azure web site</em></a>, Azure is
    Microsoft's cloud platform for building, deploying, and
    managing applications and services.
   </p><p>
    This section assumes that you have a working knowledge of the Microsoft
    Azure platform, and can adjust and modify the configuration as needed to
    get the information needed to configure a Microsoft Azure connector.
   </p><p>
    You will also need to set up OpenIDM as a Microsoft Azure website and as a
    web application. When you do, retain the values of the URI of the website,
    <code class="literal">redirectURI</code>, the <code class="literal">APP ID URI</code>, which
    corresponds to the <code class="literal">resourceURI</code>, the
    <code class="literal">client ID</code>, and the <code class="literal">client Secret</code>.
   </p><p>
    The Groovy Connector Toolkit is bundled with OpenIDM 3.1.0, in
    the following JAR file:
    <code class="filename">openidm/connectors/groovy-connector-1.4.1.0.jar</code>.
   </p><p>
    The connector configuration file for this sample
    (<code class="filename">samples/scriptedazure/conf/provisioner.openicf-scriptedazure.json</code>)
    indicates the Scripted Azure implementation of the Groovy Connector Toolkit
    as follows:
   </p><pre class="brush: javascript;">{
    "name": "scriptedazure",
    "connectorRef": {
    "connectorHostRef": "#LOCAL",
    "connectorName": "org.forgerock.openicf.connectors.groovy.ScriptedConnector",
    "bundleName": "org.forgerock.openicf.connectors.groovy-connector",
    "bundleVersion": "[1.4.0.0,2.0.0.0)"
    },
    ...  </pre><p>
    The Groovy scripts required for the sample are located in the
    <code class="filename">samples/scriptedazure/tools</code> directory. You will need
    to customize these scripts to address the requirements of your specific
    deployment, however, the sample scripts are a good starting point on which to
    base your customization.
   </p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="azure-setup"></a>3.7.4.1.&nbsp;Identifying Appropriate Information from Microsoft Azure</h4></div></div></div><p>
     Microsoft Azure supports RESTful communication with the <a class="link" href="http://msdn.microsoft.com/en-us/library/azure/hh974476.aspx" target="_blank">
     <em class="citetitle">Azure AD Graph API</em></a>. As suggested by the name,
     the API supports access to the Azure-based instance of Active Directory.
    </p><p>
     To get an OAuth 2 access token, you will need to add information to the
     Scripted Azure provisioner file,
     <code class="filename">provisioner.openicf-scriptedazure.json</code>. Substitute
     for the <code class="literal">__configureme__</code> entries shown.
    </p><pre class="brush: javascript;">...
"customConfiguration":"
     graphServiceUrl = 'https://graph.windows.net/__configureme__';
     oauth2 {
         authority = 'https://login.windows.net/__configureme__';
         redirectURI = '__configureme__';
         resourceURI = 'https://graph.windows.net'
     }",
"customSensitiveConfiguration": "
     oauth2 {
         clientId = '__configureme__';
         clientSecret = '__configureme__';
         username = '__configureme__';
         password = '__configureme__'
     }",... </pre><p>
     The following list assumes that you have configured
     <code class="literal">contoso.com</code> as the Azure domain tenant. Substitute
     appropriately. Except for the first item, the following list of items are
     required for an OAuth 2 access token.
    </p><p>
     You should be able to get some of the items needed for the OAuth 2 token
     in the Azure configuration menu related to the OpenIDM web application.
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">graphServiceUrl</code></p><p>
       For a domain tenant of <code class="literal">contoso.com</code>, set this to
       <code class="literal">'https://graph.windows.net/contoso.onmicrosoft.com</code>
      </p></li><li class="listitem"><p><code class="literal">authority</code></p><p>
       Set to <code class="literal">'https://login.windows.net/contoso.onmicrosoft.com'</code>
      </p></li><li class="listitem"><p><code class="literal">redirectURI</code></p><p>
       Set to <code class="literal">'https://localhost:8443/admin/index.html#azureCallback'</code>
      </p></li><li class="listitem"><p><code class="literal">resourceURI</code></p><p>
       Keep the following Graph API setting:
       <code class="literal">'https://graph.windows.net'</code>
      </p></li><li class="listitem"><p><code class="literal">clientId</code></p><p>
       Set to the Client ID shown in the Configure menu of the Azure web
       application.
      </p></li><li class="listitem"><p><code class="literal">clientSecret</code></p><p>
       Set to the Client Secret shown when you added or configured the web
       application. In Azure, the Client Secret is the <code class="literal">key</code>
       associated with the Client ID.
      </p></li><li class="listitem"><p><code class="literal">username</code></p><p>
       Set to the administrative username for Azure.
      </p></li><li class="listitem"><p><code class="literal">password</code></p><p>
       Set to the administrative password for Azure.
      </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="sample-azure-running"></a>3.7.4.2.&nbsp;Running the Sample</h4></div></div></div><p>
     This section illustrates basic CRUD operations on users and groups using
     the scripted Azure connector. Note that the power of the Groovy connector
     is in the associated Groovy scripts, and their application in your specific
     deployment. The scripts provided with this sample are specific to the
     sample and customization of the scripts is required.
    </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
       Start OpenIDM with the configuration for the scripted Azure sample.
      </p><div class="screen"><pre><strong>$ cd /path/to/openidm
$ ./startup.sh -p samples/scriptedazure/</strong></pre></div></li><li class="step"><p>
       Check the connector configuration. Obtain its status over REST.
      </p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 "https://localhost:8443/openidm/system/scriptedazure?_action=test"</strong>
       <em>
 {
     "ok": true,
     "connectorRef": {
        "bundleVersion": "[1.4.0.0,2.0.0.0)",
        "bundleName": "org.forgerock.openicf.connectors.groovy-connector",
        "connectorName": "org.forgerock.openicf.connectors.groovy.ScriptedConnector"
     },
     "objectTypes": [
        "User",
        "Device",
        "Contact",
        "DeviceConfiguration",
        "ServicePrincipal",
        "Group",
        "ExtensionProperty",
        "OAuth2PermissionGrant",
        "DirectoryRole",
        "DirectoryObject",
        "DirectoryRoleTemplate",
        "AppRoleAssignment",
        "DirectoryLinkChange",
        "Application",
        "__ALL__",
        "SubscribedSku",
        "TenantDetail"
     ],
     "config": "config/provisioner.openicf/scriptedazure",
        "enabled": true,
        "name": "scriptedazure"
 }</em>
      </pre></div></li><li class="step"><p>
       Create a group entry on the Azure AD server.
      </p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 --data '{
   "_id": "fake placeholder value",
   "mailEnabled": false,
   "displayName": "Azure Test Group",
   "mailNickname": "Test_Group",
   "securityEnabled": "true",
   "description": "Azure AD Test Group"
 }' \
 "https://localhost:8443/openidm/system/scriptedazure/group?_action=create"
      </strong>
      <em>
 {
   "mailEnabled":false,
   "__NAME__":"ab347420f-4e8e-f045-a437b62c0f3-636e",
   "mailNickname":"Test_Group",
   "displayName":"Azure Test Group",
   "mail":null,
   "onPremisesSecurityIdentifier":null,
   "lastDirSyncTime":null,
   "dirSyncEnabled":null,
   "description":"Azure AD Test Group",
   "proxyAddresses":[

   ],
   "securityEnabled":true,
   "provisioningErrors":[

   ],
   "_id":"ab347420f-4e8e-f045-a437b62c0f3-636e"
 }</em>
      </pre></div></li><li class="step"><p>
       Create a user entry on the Azure AD server.
      </p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 --data '{
   "_id": "fake placeholder value",
   "accountEnabled": true,
   "displayName": "Alex Wu",
   "mailNickname": "AlexW",
   "passwordProfile": { "password" : "Test1234", "forceChangePasswordNextLogin": false },
   "userPrincipalName": "Alex@contoso.onmicrosoft.com"
   }' \
   "https://localhost:8443/openidm/system/scriptedazure/User?_action=create"
     </strong><em>
 {
   "userType":"Member",
   "assignedLicenses":[

   ],
   "passwordPolicies":null,
   "immutableId":null,
   "surname":null,
   "provisionedPlans":[

   ],
   "state":null,
   "accountEnabled":true,
   "telephoneNumber":null,
   "physicalDeliveryOfficeName":null,
   "mail":null,
   "__NAME__":"744aa30f-55e0-4559-b956-985b77d80814",
   "proxyAddresses":[

   ],
   "otherMails":[

   ],
   "passwordProfile":null,
   "assignedPlans":[

   ],
   "facsimileTelephoneNumber":null,
   "displayName":"Alex Wu",
   "onPremisesSecurityIdentifier":null,
   "userPrincipalName":"Alex@contoso.onmicrosoft.com",
   "mobile":null,
   "dirSyncEnabled":null,
   "jobTitle":null,
   "givenName":null,
   "department":null,
   "usageLocation":null,
   "preferredLanguage":null,
   "sipProxyAddress":null,
   "country":null,
   "mailNickname":"AlexW",
   "postalCode":null,
   "lastDirSyncTime":null,
   "city":null,
   "provisioningErrors":[

   ],
   "streetAddress":null,
   "_id":"744aa30f-55e0-4559-b956-985b77d80814"
 }</em></pre></div></li><li class="step"><p>
       Update Alex Wu's entry, by modifying his telephone number.
      </p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request PUT \
 --data '{
   "telephoneNumber" : "555-1234"
 }' \
 "https://localhost:8443/openidm/system/scriptedazure/User/744aa30f-55e0-4559-b956-985b77d80814"</strong>
      <em>...
   "telephoneNumber" : "555-1234"
 ...</em>
      </pre></div></li><li class="step"><p>
       Confirm the result. Get the data for Alex Wu, by <code class="literal">_id</code>.
      </p><div class="screen"><pre>$ curl \
 --cacert self-signed.crt \
 --header "Content-Type: application/json" \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/system/scriptedazure/User/744aa30f-55e0-4559-b956-985b77d80814"</pre></div></li><li class="step"><p>
       Get information on the test group, also by <code class="literal">_id</code>.
      </p><div class="screen"><pre>$ curl \
 --cacert self-signed.crt \
 --header "Content-Type: application/json" \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/system/scriptedazure/Group/ab347420f-4e8e-f045-a437b62c0f3-636e"</pre></div></li><li class="step"><p>
       Delete the entry for user Alex Wu.
      </p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "Content-Type: application/json" \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request DELETE \
 "https://localhost:8443/openidm/system/scriptedazure/User/744aa30f-55e0-4559-b956-985b77d80814"
      </strong>
<em>{
   "_id": "744aa30f-55e0-4559-b956-985b77d80814"
}</em>
      </pre></div></li><li class="step"><p>
       Delete the group created earlier.
      </p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "Content-Type: application/json" \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request DELETE \
 "https://localhost:8443/openidm/system/scriptedazure/Group/ab347420f-4e8e-f045-a437b62c0f3-636e"
      </strong>
<em>{
   "_id": "ab347420f-4e8e-f045-a437b62c0f3-636e"
}</em></pre></div></li></ol></div></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="samples-powershell"></a>3.8.&nbsp;Sample - Using the PowerShell Connector Toolkit to Create Scripted Connectors</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#powershell-setup">3.8.1. Setting Up the PowerShell Sample</a></span></dt><dt><span class="section"><a href="#powershell-test">3.8.2. Testing the PowerShell Sample</a></span></dt></dl></div><p>
   OpenICF 1.4 introduces a generic PowerShell Connector Toolkit that enables
   you to run PowerShell scripts on any external resource.
  </p><p>
   The PowerShell Connector Toolkit is not a complete connector, in the
   traditional sense. Rather, it is a framework within which you must write
   your own PowerShell scripts to address the requirements of your Microsoft
   Windows ecosystem. You can use the PowerShell Connector Toolkit to create
   connectors that can provision any Microsoft system.
  </p><p>
   The PowerShell Connector Toolkit is available, with a subscription, from
   <a class="link" href="https://backstage.forgerock.com/" target="_blank">ForgeRock
   Backstage</a>.
  </p><p>
   This sample provides a number of PowerShell scripts that enable you to
   perform basic CRUD (create, read, update, delete) operations on an Active
   Directory server. The samples use the MS Active Directory PowerShell module.
   For more information on this module, see the corresponding <a class="link" href="http://technet.microsoft.com/en-us/library/hh852274.aspx" target="_blank">Microsoft
   documentation</a>.
  </p><p>
   The sample assumes that OpenIDM is running on the localhost, and that Active
   Directory runs on a remote server. The remote server also runs the OpenICF
   .NET connector server.
  </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="powershell-setup"></a>3.8.1.&nbsp;Setting Up the PowerShell Sample</h3></div></div></div><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
      Install, configure, and start the .NET connector server on the machine
      that is running an Active Directory Domain Controller or on a workstation
      on which the Microsoft Active Directory PowerShell module is installed.
     </p><p>
      For instructions on installing the .NET connector server, see <a href="../integrators-guide/index.html#net-connector-install" class="link"><em class="citetitle">Installing the
      .NET Connector Server</em></a> in the <span class="emphasis"><em>Integrator's
      Guide</em></span>.
     </p></li><li class="step"><p>
      Configure OpenIDM to connect to the .NET connector server.
     </p><p>
      To do so, copy the remote connector provisioner file from the
      <code class="literal">openidm/samples/provisioners</code> directory to the
      <code class="literal">openidm/conf</code> directory, and edit the file according to
      your configuration.
     </p><div class="screen"><pre>$ <strong>cd /path/to/openidm</strong>
$ <strong>cp samples/provisioners/provisioner.openicf.connectorinfoprovider.json conf/</strong></pre></div><p>
      For instructions on editing this file, see <a href="../integrators-guide/index.html#net-connector-openidm" class="link"><em class="citetitle">Configuring
      OpenIDM to Connect to the .NET Connector Server</em></a> in the
      <span class="emphasis"><em>Integrator's Guide</em></span>.
     </p></li><li class="step"><p>
      Download the PowerShell Connector Toolkit archive
      (<code class="filename">mspowershell-connector-1.4.1.0.zip</code>) from <a class="link" href="https://backstage.forgerock.com/" target="_blank">ForgeRock
      Backstage</a>.
     </p><p>
      Extract the archive and move the <code class="filename">MsPowerShell.Connector.dll</code>
      to the folder in which the connector server application
      (<code class="filename">connectorserver.exe</code>) is located.
     </p></li><li class="step"><p>
      Copy the PowerShell scripts from the <code class="literal">tools</code> folder in
      this sample directory, to the machine on which the connector server is
      installed.
     </p><div class="screen"><pre>C:\&gt;<strong>dir openidm\powershell2AD\tools</strong>
<em>Directory of C:\openidm\powershell2AD\tools

11/27/2014  12:53 PM    &lt;DIR&gt;          .
11/27/2014  12:53 PM    &lt;DIR&gt;          ..
11/26/2014  02:32 PM             2,813 ADAuthenticate.ps1
11/26/2014  02:32 PM             8,546 ADCreate.ps1
11/26/2014  02:32 PM             2,530 ADDelete.ps1
11/26/2014  02:32 PM             2,617 ADResolveUsername.ps1
11/26/2014  02:32 PM             8,644 ADSchema.ps1
11/26/2014  02:32 PM             3,458 ADSearch.ps1
11/26/2014  02:32 PM             4,585 ADSync.ps1
11/26/2014  02:32 PM             2,075 ADTest.ps1
11/26/2014  02:32 PM             8,488 ADUpdate.ps1
               9 File(s)         43,756 bytes
               2 Dir(s)  23,696,863,232 bytes free

C:\&gt;</em></pre></div></li><li class="step"><p>
      Edit the PowerShell search and sync scripts (<code class="filename">ADSearch.ps1</code>)
      and (<code class="filename">ADSync.ps1</code>) to specify the base suffix for your
      Active Directory Domain Controller.
     </p><p>
      Specifically, change the value of the <code class="literal">$searchBase</code>
      parameter in these files to match the suffix in your environment. The
      default suffix is:
     </p><div class="screen"><pre>$searchBase = 'CN=Users,DC=example,DC=com'</pre></div></li><li class="step"><p>
      Copy the sample connector configuration for the PowerShell connector
      from the samples directory to your <code class="literal">conf</code> directory.
     </p><div class="screen"><pre>$ <strong>cd /path/to/openidm</strong>
$ <strong>cp samples/provisioners/provisioner.openicf-adpowershell.json conf/</strong></pre></div><p>
      The sample connector configuration assumes that the scripts are located in
      <code class="filename">C:/openidm/samples/powershell2AD/tools/</code>. If you
      copied your scripts to a different location, adjust your connector
      configuration file accordingly.
     </p><p>
      Note that the OpenICF framework requires the path to use forward slash
      characters and not the backslash characters that you would expect in a
      Windows path.
     </p><p>
      In addition, make sure that the value of the
      <code class="literal">"connectorHostRef"</code> property in the connector
      configuration file matches the value that you specified in the remote
      connector configuration file, in step 2 of this procedure. For example:
     </p><div class="screen"><pre>"connectorHostRef" : "dotnet",</pre></div><p>
      The host, port, login and password of the machine on which Active
      Directory runs do not need to be specified here. By default the Active
      Directory cmdlets pick up the first available Domain Controller. In
      addition, the scripts are executed using the credentials of the .Net
      connector server.
     </p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="powershell-test"></a>3.8.2.&nbsp;Testing the PowerShell Sample</h3></div></div></div><p>
    Because you have copied all of the required configuration files into the
    default OpenIDM project, you can start OpenIDM with the default
    configuration (that is, without the <code class="literal">-p</code> option).
   </p><div class="screen"><pre>$ cd /path/to/openidm
$ ./startup.sh</pre></div><p>
    When OpenIDM has started, you can test the sample by using the
    <code class="literal">curl</code> command-line utility. The following examples test
    the scripts that were provided in the <code class="literal">tools</code> directory.
   </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
      Test the connector configuration, and whether OpenIDM is able to connect
      to the .NET connector server with the following request.
     </p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 "https://localhost:8443/openidm/system?_action=test"</strong>
<em>[
  {
    "ok": true,
    "connectorRef": {
      "bundleVersion": "1.4.1.0",
      "bundleName": "MsPowerShell.Connector",
      "connectorName": "Org.ForgeRock.OpenICF.Connectors.MsPowerShell.MsPowerShellConnector"
    },
    "objectTypes": [
      "__ALL__",
      "group",
      "account"
    ],
    "config": "config/provisioner.openicf/adpowershell",
    "enabled": true,
    "name": "adpowershell"
  }
]</em> </pre></div></li><li class="step"><p>
      Query the users in your Active Directory with the following request:
     </p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/system/adpowershell/account?_queryId=query-all-ids"</strong>
<em>{
  "remainingPagedResults": -1,
  "pagedResultsCookie": null,
  "resultCount": 1257,
  "result": [
    {
      "_id": "7c41496a-9898-4074-a537-bed696b6be92",
      "distinguishedName": "CN=Administrator,CN=Users,DC=example,DC=com"
    },
    {
      "_id": "f2e08a5c-473f-4798-a2d5-d5cc27c862a9",
      "distinguishedName": "CN=Guest,CN=Users,DC=example,DC=com"
    },
    {
      "_id": "99de98a3-c125-48dd-a7c2-e21f1488ab06",
      "distinguishedName": "CN=Ben Travis,CN=Users,DC=example,DC=com"
    },
    {
      "_id": "0f7394cc-c66a-404f-ad6d-38dbb4b6526d",
      "distinguishedName": "CN=Barbara Jensen,CN=Users,DC=example,DC=com"
    },
    {
      "_id": "3e6fa858-ed3a-4b58-9325-1fca144eb7c7",
      "distinguishedName": "CN=John Doe,CN=Users,DC=example,DC=com"
    },
    {
      "_id": "6feef4a0-b121-43dc-be68-a96703a49aba",
      "distinguishedName": "CN=Steven Carter,CN=Users,DC=example,DC=com"
    },
...</em></pre></div></li><li class="step"><p>
      To return the complete record of a specific user, include the ID of the
      user in the URL. The following request returns the record for Steven
      Carter.
     </p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/system/adpowershell/account/6feef4a0-b121-43dc-be68-a96703a49aba"</strong>
<em>{
  "_id": "6feef4a0-b121-43dc-be68-a96703a49aba",
  "postalCode": null,
  "passwordNotRequired": false,
  "cn": "Steven Carter",
  "name": "Steven Carter",
  "trustedForDelegation": false,
  "uSNChanged": "47219",
  "manager": null,
  "objectGUID": "6feef4a0-b121-43dc-be68-a96703a49aba",
  "modifyTimeStamp": "11/27/2014 3:37:16 PM",
  "employeeNumber": null,
  "sn": "Carter",
  "userAccountControl": 512,
  "passwordNeverExpires": false,
  "displayName": "Steven Carter",
  "initials": null,
  "pwdLastSet": "130615726366949784",
  "scriptPath": null,
  "badPasswordTime": "0",
  "employeeID": null,
  "badPwdCount": "0",
  "accountExpirationDate": null,
  "userPrincipalName": "steve.carter@ad0.example.com",
  "sAMAccountName": "steve.carter",
  "mail": "steven.carter@example.com",
  "logonCount": "0",
  "cannotChangePassword": false,
  "division": null,
  "streetAddress": null,
  "allowReversiblePasswordEncryption": false,
  "description": null,
  "whenChanged": "11/27/2014 3:37:16 PM",
  "title": null,
  "lastLogon": "0",
  "company": null,
  "homeDirectory": null,
  "whenCreated": "6/23/2014 2:50:48 PM",
  "givenName": "Steven",
  "telephoneNumber": "555-2518",
  "homeDrive": null,
  "uSNCreated": "20912",
  "smartcardLogonRequired": false,
  "distinguishedName": "CN=Steven Carter,CN=Users,DC=example,DC=com",
  "createTimeStamp": "6/23/2014 2:50:48 PM",
  "department": null,
  "memberOf": [
    "CN=employees,DC=example,DC=com"
  ],
  "homePhone": null
}</em></pre></div></li><li class="step"><p>
      Test whether you can authenticate as one of the users in your Active
      Directory. The username that you specify here can be either an ObjectGUID,
      UPN, sAMAccountname or CN.
     </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 "https://localhost:8443/openidm/system/adpowershell/account?_action=authenticate&amp;username=Steven+Carter&amp;password=Passw0rd"</strong>
<em>{
  "_id": "6feef4a0-b121-43dc-be68-a96703a49aba"
}</em></pre></div><p>
      The request returns the ObjectGUID if the authentication is successful.
     </p></li><li class="step"><p>
      You can return the complete record for a specific user, using the query
      filter syntax described in <a href="../integrators-guide/index.html#constructing-queries" class="link"><em class="citetitle">Constructing
      Queries</em></a> in the <span class="emphasis"><em>Integrator's Guide</em></span>.
     </p><p>
      The following query returns the record for the guest user.
     </p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/system/adpowershell/account?_queryFilter=cn+eq+guest"</strong>
<em>{
  "remainingPagedResults": -1,
  "pagedResultsCookie": null,
  "resultCount": 1,
  "result": [
    {
      "_id": "f2e08a5c-473f-4798-a2d5-d5cc27c862a9",
      "postalCode": null,
      "passwordNotRequired": true,
      "cn": "Guest",
      "name": "Guest",
      "trustedForDelegation": false,
      "uSNChanged": "8197",
      "manager": null,
      "objectGUID": "f2e08a5c-473f-4798-a2d5-d5cc27c862a9",
      "modifyTimeStamp": "6/9/2014 12:35:16 PM",
      "employeeNumber": null,
      "userAccountControl": 66082,
      "whenChanged": "6/9/2014 12:35:16 PM",
      "initials": null,
      "pwdLastSet": "0",
      "scriptPath": null,
      "badPasswordTime": "0",
      "employeeID": null,
      "badPwdCount": "0",
      "accountExpirationDate": null,
      "sAMAccountName": "Guest",
      "logonCount": "0",
      "cannotChangePassword": true,
      "division": null,
      "streetAddress": null,
      "allowReversiblePasswordEncryption": false,
      "description": "Built-in account for guest access to the computer/domain",
      "userPrincipalName": null,
      "title": null,
      "lastLogon": "0",
      "company": null,
      "homeDirectory": null,
      "whenCreated": "6/9/2014 12:35:16 PM",
      "givenName": null,
      "homeDrive": null,
      "uSNCreated": "8197",
      "smartcardLogonRequired": false,
      "distinguishedName": "CN=Guest,CN=Users,DC=example,DC=com",
      "createTimeStamp": "6/9/2014 12:35:16 PM",
      "department": null,
      "memberOf": [
        "CN=Guests,CN=Builtin,DC=example,DC=com"
      ],
      "homePhone": null,
      "displayName": null,
      "passwordNeverExpires": true
    }
  ]
}</em></pre></div></li><li class="step"><p>
      Test whether you are able to create a user on the Active Directory server
      by sending a POST request with the <code class="literal">create</code> action.
     </p><p>
      The following request creates the user <code class="literal">Jane Doe</code> on the
      Active Directory server.
     </p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 --data '{
		 "distinguishedName" : "CN=Jane Doe,CN=Users,DC=example,DC=com",
		 "sn" : "Doe",
	 	"cn" : "Jane Doe",
	 	"sAMAccountName" : "sample",
	 	"userPrincipalName" : "janedoe@example.com",
	 	"__ENABLE__" : true,
	 	"__PASSWORD__" : "Passw0rd",
	 	"telephoneNumber" : "0052-611-091"
		}' \
 "https://localhost:8443/openidm/system/adpowershell/account?_action=create"</strong>
<em>{
  "_id": "42725210-8dce-4fdf-b0e0-393cf0377fdf",
  "title": null,
  "uSNCreated": "47244",
  "pwdLastSet": "130615892934093041",
  "cannotChangePassword": false,
  "telephoneNumber": "0052-611-091",
  "smartcardLogonRequired": false,
  "badPwdCount": "0",
  "department": null,
  "distinguishedName": "CN=Jane Doe,CN=Users,DC=example,DC=com",
  "badPasswordTime": "0",
  "employeeID": null,
  "cn": "Jane Doe",
  "division": null,
  "description": null,
  "userPrincipalName": "janedoe@example.com",
  "passwordNeverExpires": false,
  "company": null,
  "memberOf": [],
  "givenName": null,
  "streetAddress": null,
  "sn": "Doe",
  "initials": null,
  "logonCount": "0",
  "homeDirectory": null,
  "employeeNumber": null,
  "objectGUID": "42725210-8dce-4fdf-b0e0-393cf0377fdf",
  "manager": null,
  "lastLogon": "0",
  "trustedForDelegation": false,
  "scriptPath": null,
  "allowReversiblePasswordEncryption": false,
  "modifyTimeStamp": "11/27/2014 8:14:53 PM",
  "whenCreated": "11/27/2014 8:14:52 PM",
  "whenChanged": "11/27/2014 8:14:53 PM",
  "accountExpirationDate": null,
  "name": "Jane Doe",
  "displayName": null,
  "homeDrive": null,
  "passwordNotRequired": false,
  "createTimeStamp": "11/27/2014 8:14:52 PM",
  "uSNChanged": "47248",
  "sAMAccountName": "sample",
  "userAccountControl": 512,
  "homePhone": null,
  "postalCode": null
}
</em>     </pre></div></li><li class="step"><p>
      Test whether you are able to update a user object on the Active Directory
      server by sending a PUT request with the complete object, and including
      the user ID in the URL.
     </p><p>
      The following request updates user <code class="literal">Jane Doe</code>'s entry,
      including her ID in the request. The update sends the same information
      that was sent in the <code class="literal">create</code> request, but adds an
      <code class="literal">employeeNumber</code>.
     </p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request PUT \
 --data '{
		 "distinguishedName" : "CN=Jane Doe,CN=Users,DC=example,DC=com",
		 "sn" : "Doe",
	 	"cn" : "Jane Doe",
	 	"sAMAccountName" : "sample",
	 	"userPrincipalName" : "janedoe@example.com",
	 	"__ENABLE__" : true,
	 	"__PASSWORD__" : "Passw0rd",
	 	"telephoneNumber" : "0052-611-091",
   "employeeNumber": "567893"
		}' \
 "https://localhost:8443/openidm/system/adpowershell/account/42725210-8dce-4fdf-b0e0-393cf0377fdf"</strong>
<em>{
  "_id": "42725210-8dce-4fdf-b0e0-393cf0377fdf",
  "title": null,
  "uSNCreated": "47244",
  "pwdLastSet": "130615906375709689",
  "cannotChangePassword": false,
  "telephoneNumber": "0052-611-091",
  "smartcardLogonRequired": false,
  "badPwdCount": "0",
  "department": null,
  "distinguishedName": "CN=Jane Doe,CN=Users,DC=example,DC=com",
  "badPasswordTime": "0",
  "employeeID": null,
  "cn": "Jane Doe",
  "division": null,
  "description": null,
  "userPrincipalName": "janedoe@example.com",
  "passwordNeverExpires": false,
  "company": null,
  "memberOf": [],
  "givenName": null,
  "streetAddress": null,
  "sn": "Doe",
  "initials": null,
  "logonCount": "0",
  "homeDirectory": null,
  "employeeNumber": "567893",
  "objectGUID": "42725210-8dce-4fdf-b0e0-393cf0377fdf",
  "manager": null,
  "lastLogon": "0",
  "trustedForDelegation": false,
  "scriptPath": null,
  "allowReversiblePasswordEncryption": false,
  "modifyTimeStamp": "11/27/2014 8:37:17 PM",
  "whenCreated": "11/27/2014 8:14:52 PM",
  "whenChanged": "11/27/2014 8:37:17 PM",
  "accountExpirationDate": null,
  "name": "Jane Doe",
  "displayName": null,
  "homeDrive": null,
  "passwordNotRequired": false,
  "createTimeStamp": "11/27/2014 8:14:52 PM",
  "uSNChanged": "47253",
  "sAMAccountName": "sample",
  "userAccountControl": 512,
  "homePhone": null,
  "postalCode": null
}</em>     </pre></div></li><li class="step"><p>
      Test whether you are able to delete a user object on the Active Directory
      server by sending a DELETE request with the user ID in the URL.
     </p><p>
      The following request deletes user <code class="literal">Jane Doe</code>'s entry.
     </p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request DELETE \
 "https://localhost:8443/openidm/system/adpowershell/account/42725210-8dce-4fdf-b0e0-393cf0377fdf"</strong></pre></div><p>
      The response includes the complete user object that was deleted.
     </p><p>
      You can you attempt to query the user object to confirm that it has been
      deleted.
     </p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/system/adpowershell/account/42725210-8dce-4fdf-b0e0-393cf0377fdf"</strong>
<em>{
  "message": "",
  "reason": "Not Found",
  "code": 404
}</em></pre></div></li></ol></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="more-sample4"></a>3.9.&nbsp;Sample 4 - CSV to XML File</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#install-sample4">3.9.1. Install the Sample</a></span></dt><dt><span class="section"><a href="#examine-sample4">3.9.2. Check and then Run the Sample</a></span></dt></dl></div><a class="indexterm" name="d4757e4247"></a><p>Sample 4 works with two databases, a comma-separated value file
   and an XML file. There is no need to include any external
   resources.
  </p><p>
   A correlation query is used to relate the records in these
   two files.
  </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="install-sample4"></a>3.9.1.&nbsp;Install the Sample</h3></div></div></div><p>No external configuration is required for this sample. Prepare 
   OpenIDM as described in <a class="xref" href="#preparing-openidm" title="3.1.2.&nbsp;Preparing OpenIDM">Section&nbsp;3.1.2, &#8220;Preparing OpenIDM&#8221;</a>, then start up 
   OpenIDM with the configuration of sample 4.</p><div class="screen"><pre>$ cd /path/to/openidm
$ ./startup.sh -p samples/sample4</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="examine-sample4"></a>3.9.2.&nbsp;Check and then Run the Sample</h3></div></div></div><p>
    The <code class="filename">sample4/data/hr.csv</code> file contains two example
    users. The first line of the file sets the attribute names.
   </p><p>
    Review the current contents of the database in the
    <code class="filename">sample4/data/xmlConnectorData.xml</code> file. For comparison
    purposes, make a copy of the file in a temporary directory with a command
    like:
   </p><div class="screen"><pre>$ cp /path/to/openidm/samples/sample4/data/xmlConnectorData.xml /tmp/</pre></div><p>
    The reconciliation command run here uses the information
    from the <code class="filename">hr.csv</code> file to update the database in the
    <code class="filename">sample4/data/xmlConnectorData.xml</code> file.
   </p><div class="screen"><pre>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 "https://localhost:8443/openidm/recon?_action=recon&amp;mapping=csv_xmlfile&amp;waitForCompletion=true"</pre></div><p>Check the results of reconciliation. Review the updated contents
    of the <code class="filename">sample4/data/xmlConnectorData.xml</code> file.</p><p>
    If you want to experiment further, try changing the data in the
    <code class="filename">hr.csv</code> file. Run the noted reconciliation command
    again.
   </p><p>
    These users will not be visible from the OpenIDM UI, since they are mapped
    directly between the XML and CSV files. The internal OpenIDM repository is
    not updated in this sample.
   </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="more-sample5"></a>3.10.&nbsp;Sample 5 - Synchronization of Two Resources</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#email-sample5">3.10.1. Configure Email for the Sample</a></span></dt><dt><span class="section"><a href="#install-sample5">3.10.2. Install the Sample</a></span></dt><dt><span class="section"><a href="#run-sample5">3.10.3. Run the Sample</a></span></dt></dl></div><a class="indexterm" name="d4757e4305"></a><p>
   Sample 5 demonstrates the flow of data from one external resource to
   another. The resources are named <code class="literal">LDAP</code> and
   <code class="literal">AD</code> but in the sample, both directory-like resources are
   simulated with XML files.
  </p><p>
   You can optionally configure an outbound email service, if you want to
   receive emailed reconciliation summaries, as described in the following
   section.
  </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="email-sample5"></a>3.10.1.&nbsp;Configure Email for the Sample</h3></div></div></div><p>
    If you do not configure the email service, the functionality of the sample
    does not change. However, you might see the following message at the
    OpenIDM console when you run a reconciliation operation:
   </p><div class="screen"><pre>Email service not configured; report not generated.</pre></div><div class="procedure"><p>
     To configure an email summary, follow these steps:
    </p><ol class="procedure" type="1"><li class="step"><p>
      Copy the template <code class="filename">external.email.json</code> file from
      the <code class="filename">/path/to/openidm/samples/misc</code> directory:
     </p><div class="screen"><pre>$ cd /path/to/openidm
$ cp samples/misc/external.email.json samples/sample5/conf
     </pre></div></li><li class="step"><p>
      Edit the <code class="filename">external.email.json</code> file for outbound email,
      as described in the chapter on
      <a href="../integrators-guide/index.html#chap-mail" class="link"><em class="citetitle">Sending
      Email</em></a>.
     </p></li><li class="step"><p>
      Edit the <code class="filename">reconStats.js</code> file from the
      <code class="filename">/path/to/openidm/samples/sample5/script</code> directory.
      Near the start of the file, configure the OpenIDM email service to send
      statistics to the email addresses of your choice:
     </p><pre class="brush: javascript;">
var params = {
      //UPDATE THESE VALUES
      from : "openidm@example.com",
      to : "youremail@example.com",
      cc : "idmadmin2@example.com,idmadmin3@example.com",
      subject : "Recon stats for " + global.mappingName,
      type : "text/html"
},
template,
     </pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="install-sample5"></a>3.10.2.&nbsp;Install the Sample</h3></div></div></div><p>
    No external configuration is required for this sample. Prepare OpenIDM as
    described in <a class="xref" href="#preparing-openidm" title="3.1.2.&nbsp;Preparing OpenIDM">Section&nbsp;3.1.2, &#8220;Preparing OpenIDM&#8221;</a>, then start OpenIDM with
    the configuration of sample 5.
   </p><div class="screen"><pre>$ cd /path/to/openidm
$ ./startup.sh -p samples/sample5</pre></div><p>
    The XML files that simulate the resources are located in the
    <code class="filename">openidm/samples/sample5/data/</code> folder. When you start
    OpenIDM with the sample 5 configuration, OpenIDM creates the
    <code class="filename">xml_AD_Data.xml</code> file, which does not contain users
    until you run reconciliation.
   </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="run-sample5"></a>3.10.3.&nbsp;Run the Sample</h3></div></div></div><p>
    Run a reconciliation operation, to synchronize the contents of the simulated
    LDAP resource to the OpenIDM repository.
   </p><div class="screen"><pre>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 "https://localhost:8443/openidm/recon?_action=recon&amp;mapping=systemLdapAccounts_managedUser&amp;waitForCompletion=true"</pre></div><p>
    This command creates a user in the repository. It is not necessary to run a
    second reconciliation operation to synchronize the AD resource. Automatic
    synchronization propagates any change made to managed users in the OpenIDM
    repository to the simulated AD resource.
   </p><p>
    Review the contents of <code class="filename">xml_AD_Data.xml</code>. It should now
    contain information for the same user that was present in the startup
    version of the <code class="filename">xml_LDAP_Data.xml</code> file.
   </p><p>
    Alternatively, you can list users in the AD resource with the following
    command:
   </p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/system/ad/account?_queryId=query-all-ids"
   </strong>
   <em>{
  "result" : [ {
    "name" : "DDOE1",
    "__UID__" : "8dad9df3-820d-41ea-a3ab-a80c241bbc98",
    "_id" : "8dad9df3-820d-41ea-a3ab-a80c241bbc98"
  } ],
    "resultCount" : 1,
    "pagedResultsCookie" : null,
    "remainingPagedResults" : -1
}</em>
   </pre></div><p>
    You can use the <code class="literal">_id</code> of the user to read the user
    information from the AD resource, for example:
   </p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/system/ad/account/8dad9df3-820d-41ea-a3ab-a80c241bbc98"
   </strong>
   <em>{
  "email" : [ "mail1@example.com" ],
  "name" : "DDOE1",
  "__UID__" : "8dad9df3-820d-41ea-a3ab-a80c241bbc98",
  "firstname" : "Darth",
  "lastname" : "Doe",
  "_id" : "8dad9df3-820d-41ea-a3ab-a80c241bbc98"
}[</em></pre></div><p>
    To verify that the sample is working, repeat the process. Set up a second
    user in the <code class="filename">xml_LDAP_Data.xml</code> file. An example of how
    that file might appear with a second user (<code class="literal">GDOE1</code>) is
    shown here:
   </p><pre class="brush: xml;">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;icf:OpenICFContainer
    xmlns:icf="http://openidm.forgerock.com/xml/ns/public/resource/openicf/resource-schema-1.xsd"
    xmlns:ri="http://openidm.forgerock.com/xml/ns/public/resource/instances/resource-schema-extension"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://openidm.forgerock.com/xml/ns/public/resource/instances/resource-schema-extension
    /path/to/openidm/samples/sample5/data/resource-schema-extension.xsd
    http://openidm.forgerock.com/xml/ns/public/resource/openicf/resource-schema-1.xsd
    /path/to/openidm/samples/sample5/data/resource-schema-1.xsd"&gt;
    &lt;ri:__ACCOUNT__&gt;
       &lt;icf:__UID__&gt;1&lt;/icf:__UID__&gt;
       &lt;icf:__PASSWORD__&gt;TestPassw0rd2&lt;/icf:__PASSWORD__&gt;
       &lt;ri:firstname&gt;Darth&lt;/ri:firstname&gt;
       &lt;icf:__DESCRIPTION__&gt;Created By XML1&lt;/icf:__DESCRIPTION__&gt;
       &lt;icf:__NAME__&gt;DDOE1&lt;/icf:__NAME__&gt;
       &lt;ri:email&gt;mail1@example.com&lt;/ri:email&gt;
       &lt;ri:lastname&gt;Doe&lt;/ri:lastname&gt;
    &lt;/ri:__ACCOUNT__&gt;
    &lt;ri:__ACCOUNT__&gt;
       &lt;icf:__UID__&gt;2&lt;/icf:__UID__&gt;
       &lt;icf:__PASSWORD__&gt;TestPassw0rd2&lt;/icf:__PASSWORD__&gt;
       &lt;ri:firstname&gt;Garth&lt;/ri:firstname&gt;
       &lt;icf:__DESCRIPTION__&gt;Created By XML1&lt;/icf:__DESCRIPTION__&gt;
       &lt;icf:__NAME__&gt;GDOE1&lt;/icf:__NAME__&gt;
       &lt;ri:email&gt;mail2@example.com&lt;/ri:email&gt;
       &lt;ri:lastname&gt;Doe&lt;/ri:lastname&gt;
    &lt;/ri:__ACCOUNT__&gt;
&lt;/icf:OpenICFContainer&gt;</pre><p>
    Rerun the reconciliation and query REST commands shown previously. The
    reconciliation operation creates the new user from the simulated LDAP
    resource in the OpenIDM repository. An implicit synchronization operation
    then creates that user in the AD resource.
   </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="more-sample5b"></a>3.11.&nbsp;Sample 5b - Failure Compensation With Multiple Resources</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#install-sample5b">3.11.1. Install the Sample</a></span></dt><dt><span class="section"><a href="#onsync-sample5b">3.11.2. Demonstrate onSync</a></span></dt></dl></div><a class="indexterm" name="d4757e4433"></a><p>
   The compensated synchronization mechanism depicted in this sample can help
   manage the risks associated with synchronizing data across multiple
   resources.
  </p><p>
   Typically, when a managed/user object is changed, implicit synchronization
   replays that change to all configured external resources. If synchronization
   fails for one target resource (for example, due to a policy validation
   failure on the target, or the target being unavailable), the synchronization
   operation stops at that point. The effect is that a record might be changed
   in the repository, and in the targets on which synchronization was successful,
   but not on the failed target, or any targets that would have been
   synchronized after the failure. This situation can result in disparate data
   sets across resources. While a reconciliation operation would eventually
   bring all targets back in sync, reconciliation can be an expensive operation
   with large data sets.
  </p><p>
   The compensated synchronization mechanism ensures that either all resources
   are synchronized successfully, or that the original change is rolled back.
   This mechanism uses an <code class="literal">onSync</code> script hook configured with
   a <code class="filename">compensate.js</code> script that can be used to "revert" the
   partial change to managed/user and to the corresponding external resources.
  </p><p>
   Sample 5b is similar to sample 5 in that it simulates two external resources
   with XML files (located in the
   <code class="filename">/path/to/samples/sample5b/data</code> directory). The
   <code class="filename">xml_LDAP_Data.xml</code> file simulates an LDAP data source.
   OpenIDM creates the <code class="filename">xml_AD_Data.xml</code> file when you start
   OpenIDM with the sample. Sample 5b adds the <code class="literal">onSync</code> script
   hook to the process, configured in the
   <code class="filename">sample5b/conf/managed.json</code> file.
  </p><p>
   The following excerpt of the <code class="filename">managed.json</code> file shows
   the <code class="literal">onSync</code> hook, which calls the
   <code class="filename">compensate.js</code> script, provided in the
   <code class="filename">/path/to/openidm/bin/defaults/script</code> directory.
  </p><pre class="brush: javascript;">
...
},
"onSync" : {
   "type" : "text/javascript",
   "file" : "compensate.js"
},
  </pre><p>
   You can use the <code class="literal">onSync</code> script hook to ensure that changes
   made in the repository are synchronized to all external resources, or that
   no changes are made. For more information about how implicit synchronization
   uses the <code class="literal">onSync</code> script hook, see <a href="../integrators-guide/index.html#sync-failure-compensation" class="link"><em class="citetitle">Configuring
   Synchronization Failure Compensation</em></a> in the
   <em class="citetitle">Integrator's Guide</em>.
  </p><p>
   You can optionally configure an outbound email service for this sample, if
   you want to receive emailed reconciliation summaries. The email service
   configuration is identical to that of sample 5
   (<a class="xref" href="#email-sample5" title="3.10.1.&nbsp;Configure Email for the Sample">Section&nbsp;3.10.1, &#8220;Configure Email for the Sample&#8221;</a>).
  </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="install-sample5b"></a>3.11.1.&nbsp;Install the Sample</h3></div></div></div><p>No external configuration is required for this sample. Prepare
    OpenIDM as described in <a class="xref" href="#preparing-openidm" title="3.1.2.&nbsp;Preparing OpenIDM">Section&nbsp;3.1.2, &#8220;Preparing OpenIDM&#8221;</a>, then start
    OpenIDM with the configuration of sample 5b.</p><div class="screen"><pre>$ cd /path/to/openidm
$ ./startup.sh -p samples/sample5b</pre></div><p>
    The XML files that simulate an external LDAP and AD resource are now located
    in the <code class="filename">openidm/samples/sample5b/data/</code> directory. The
    simulated AD data store file, <code class="filename">xml_AD_Data.xml</code>, does not
    contain users until you run reconciliation.
   </p><p>
    Run the sample in exactly the same way that you did for Sample 5, following
    the steps in <a class="xref" href="#run-sample5" title="3.10.3.&nbsp;Run the Sample">Section&nbsp;3.10.3, &#8220;Run the Sample&#8221;</a>.
   </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="onsync-sample5b"></a>3.11.2.&nbsp;Demonstrate onSync</h3></div></div></div><p>
    To demonstrate integration of the samples with the OpenIDM UI, this sample
    uses the UI to view and make changes to user objects in the repository.
    However, you can also use the REST interface to make these changes, as shown
    in the previous section.
   </p><p>
    Log into the OpenIDM UI as the administrative user. On a local system,
    navigate to <code class="literal">https://localhost:8443/openidmui</code>. The default
    administrative account and password are both <code class="literal">openidm-admin</code>.
   </p><p>
    Make a change to the data of an existing user (<code class="literal">DDOE1</code>).
    As a result of the implicit synchronization from the managed object
    repository, that change is reflected almost immediately on the external
    resources. For sample 5b, you should see the changes in both XML files in
    the <code class="filename">/path/to/openidm/sample5b/data</code> directory.
    Alternatively, you can query the external resources over REST, as described
    previously.
   </p><p>
    The synchronization is successful, across all configured external resources,
    so the updated user record can be seen in both the
    <code class="filename">xml_LDAP_Data.xml</code> and
    <code class="filename">xml_AD_Data.xml</code> files.
   </p><p>
    The next step is to simulate a problem connecting to the LDAP resource. One
    way to do so on the local system is to rename the LDAP data file so that it
    is unreadable. On a Linux system, the following command, as an
    administrative user, would serve that purpose:
   </p><div class="screen"><pre>$ cd /path/to/openidm/samples/sample5b/data
$ sudo mv xml_LDAP_Data.xml xml_LDAP_Data.xml.bak</pre></div><p>
    In the UI, now try another update to user <code class="literal">DDOE1</code>. With the
    modified filename of the simulated LDAP resource, implicit synchronization
    cannot write to this resource. An error similar to the following is
    displayed in the log file, <code class="filename">openidm0.log.0</code>:
   </p><div class="screen"><pre>Data file does not exist:
/path/to/openidm/samples/sample5b/data/xml_LDAP_Data.xml</pre></div><p>
    Although the AD resource is available, implicit synchronization will not
    reach this resource, because the mapping is specified
    <span class="emphasis"><em>after</em></span> the managed/user to LDAP mapping in the
    <code class="filename">sync.json</code> file.
   </p><p>
    When the implicit synchronization operation fails for the LDAP resource, the
    <code class="literal">onSync</code> hook invokes the
    <code class="filename">compensate.js</code> script. This script attempts to revert
    the original change by performing another update to DDOE1 in the repository
    (managed/user). This change, in turn, triggers another automatic
    synchronization to the AD and LDAP resources.
   </p><p>
    Because the LDAP resource is still unreadable, the synchronization to LDAP
    fails again, which triggers the <code class="literal">compensate.js</code> script
    again. This time, however, the script recognizes that the change was
    originally called as a result of a compensation and aborts.
   </p><p>
    The original synchronization error from the first update is thrown from the
    script and the UI should display that error. If you refresh the UI, and view
    that user entry again, you will notice that the change to the entry has been
    reverted.
   </p><p>
    Note that if you change the name of the AD resource file (to make it
    unavailable), a change to a managed/user entry will be synchronized
    successfully with the LDAP resource (because that mapping appears first in
    <code class="filename">sync.json</code>). The synchronization will fail for the AD
    resource. In this case, the change will be reverted on both the managed/user
    entry, and the LDAP resource.
   </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="more-sample6"></a>3.12.&nbsp;Sample 6 - LiveSync With an AD Server</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#more-sample6-realad">3.12.1. Sample 6 with an Active AD Deployment</a></span></dt><dt><span class="section"><a href="#d4757e4667">3.12.2. Sample 6 with a Simulated AD Deployment</a></span></dt><dt><span class="section"><a href="#external-resource-sample6">3.12.3. External Configuration</a></span></dt><dt><span class="section"><a href="#install-sample6">3.12.4. Start OpenIDM with Sample 6</a></span></dt><dt><span class="section"><a href="#run-sample6">3.12.5. Run the Sample</a></span></dt></dl></div><a class="indexterm" name="d4757e4597"></a><p>
   Sample 6 resembles sample 5, but demonstrates LiveSync from an external
   resource. Sample 6 includes configuration files for two scenarios, depending
   on whether you have a live Active Directory (AD) service, or whether you
   need to simulate an AD service with an OpenDJ server. Each scenario is
   associated with a file in the
   <code class="filename">/path/to/sample6/alternatives</code> directory. The file you
   select should be copied to the <code class="filename">/path/to/sample6/conf</code>
   directory.
  </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Active AD Deployment</span></dt><dd><p>
       If you have an actual AD deployment available, copy the
       <code class="filename">provisioner.openicf-realad.json</code> file to the
       <code class="filename">conf/</code> subdirectory. You can then configure
       synchronization between an OpenDJ Directory Server and an active AD
       deployment.
      </p><p>
       As this sample demonstrates synchronization <span class="emphasis"><em>from</em></span> the
       AD server <span class="emphasis"><em>to</em></span> OpenDJ, data on the AD server is not
       changed.
      </p></dd><dt><span class="term">Simulated AD Deployment</span></dt><dd><p>
      If you need to simulate an AD deployment, copy the 
      <code class="filename">provisioner.openicf-fakead.json</code> file to the
      <code class="filename">conf/</code> subdirectory. You can then configure
      synchronization between an OpenDJ Directory server and a simulated
      AD server.
     </p><p>
      This sample simulates an AD server on the same instance of OpenDJ, using a
      different base DN.
     </p></dd></dl></div><p>
   The options shown in the associated configuration files can be easily
   modified to work with any standard LDAP server.
  </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="more-sample6-realad"></a>3.12.1.&nbsp;Sample 6 with an Active AD Deployment</h3></div></div></div><p>
    If you have an existing, active instance of AD, set up OpenDJ, as described
    in the <a class="link" href="http://opendj.forgerock.org/opendj-server/doc/install-guide/" target="_blank">
    <em class="citetitle">OpenDJ Installation Guide</em></a>.
   </p><p>
    During installation, populate OpenDJ with the data in the
    <code class="filename">Example.ldif</code> file, available in the
    <code class="filename">/path/to/sample6/data</code> directory.
   </p><p>
    The actions run in this sample should not change any data on the AD server.
   </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d4757e4667"></a>3.12.2.&nbsp;Sample 6 with a Simulated AD Deployment</h3></div></div></div><p>
    In this sample, an AD deployment is simulated with a different baseDN
    (<code class="literal">dc=fakead,dc=com</code>) on the same OpenDJ server instance.
    You can also simulate the AD server with a separate OpenDJ instance, running
    on the same host, as long as the two instances communicate on different
    ports. The data for the simulated AD instance is contained in the file
    <code class="filename">AD.ldif</code>. The data for the OpenDJ instance is contained
    in the file <code class="filename">Example.ldif</code>.
   </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="external-resource-sample6"></a>3.12.3.&nbsp;External Configuration</h3></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="prepare-livesync-sample6"></a>3.12.3.1.&nbsp;Prepare OpenDJ For LiveSync</h4></div></div></div><p>
      This sample assumes a replicated OpenDJ server on the localhost system.
      When configured, OpenDJ replication includes an External Change Log (ECL),
      required to support LiveSync. LiveSync detects changes in OpenDJ by
      reading the ECL.
     </p><p>
      Follow these steps to install and configure an OpenDJ instance.
     </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
       Download and extract the OpenDJ zip archive.
      </p><p>
       Find a link to the OpenDJ download page from the <a class="link" href="http://forgerock.com/download-stack/" target="_blank">http://forgerock.com/download-stack/</a>.
      </p></li><li class="step"><p>
       Install OpenDJ using the command-line setup, as follows:
      </p><div class="screen"><pre><strong>$ cd /path/to/opendj
$ ./setup --cli \
--hostname localhost \
--ldapPort 1389 \
--rootUserDN "cn=Directory Manager" \
--rootUserPassword password \
--adminConnectorPort 4444 \
--addBaseEntry \
--baseDN dc=com \
--acceptLicense \
--no-prompt</strong>
<em>...
Configuring Directory Server ..... Done.
Creating Base Entry dc=com ..... Done.
Starting Directory Server ....... Done.
...</em>
      </pre></div><p>
       The sample assumes the following configuration:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
         The OpenDJ server is installed on the localhost.
        </p></li><li class="listitem"><p>
         The server listens for LDAP connections on port 1389.
        </p></li><li class="listitem"><p>
         The administration connector port is 4444.
        </p></li><li class="listitem"><p>
         The root user DN is <code class="literal">cn=Directory Manager</code>.
        </p></li><li class="listitem"><p>
         The root user password is <code class="literal">password</code>.
        </p></li></ul></div></li><li class="step"><p>
       Import the LDIF data file required for the sample.
      </p><div class="screen"><pre>$<strong> cd /path/to/opendj/bin
 $ ./ldapmodify \
 --bindDN "cn=Directory Manager" \
 --bindPassword password \
 --hostname localhost \
 --port 1389 \
 --filename /path/to/openidm/samples/sample6/data/Example.ldif</strong>
      </pre></div></li><li class="step"><p>
       Configure the OpenDJ server for replication.
      </p><p>
       To enable liveSync, this server must be configured for replication, even
       if it does not actually participate in a replication topology. The
       following commands configure the server for replication.
      </p><div class="screen"><pre>$<strong> ./dsconfig create-replication-server \
 --hostname localhost \
 --port 4444 \
 --bindDN "cn=Directory Manager" \
 --bindPassword password \
 --provider-name "Multimaster Synchronization" \
 --set replication-port:8989 \
 --set replication-server-id:2 \
 --type generic \
 --trustAll \
 --no-prompt

 $ ./dsconfig create-replication-domain \
 --hostname localhost \
 --port 4444 \
 --bindDN "cn=Directory Manager" \
 --bindPassword password \
 --provider-name "Multimaster Synchronization" \
 --domain-name fakead_com \
 --set base-dn:dc=fakead,dc=com \
 --set replication-server:localhost:8989 \
 --set server-id:3 \
 --type generic \
 --trustAll \
 --no-prompt</strong>
      </pre></div></li></ol></div><p>
      Once OpenDJ is configured, you can proceed with either an active or
      simulated AD deployment.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="external-resource-sample6-active"></a>3.12.3.2.&nbsp;External Configuration for an Active AD Deployment</h4></div></div></div><p>
      To configure an active AD deployment for sample 6, open the
      <code class="filename">provisioner.openicf-realad.json</code> file in
      a text editor. Update it as needed. At minimum, you should check and
      if needed update the following parameters in that file, as shown in the
      following table:
     </p><div class="table"><a name="realad-json-configuration"></a><div class="table-title">Table&nbsp;3.1.&nbsp;Key Parameters for an Active AD Configuration</div><div class="table-contents"><table summary="Key Parameters for an Active AD Configuration" border="0"><colgroup><col width="40%"><col width="60%"></colgroup><thead><tr><th>Option</th><th>Description</th></tr></thead><tbody><tr><td>host</td><td>The hostname/IP address of the AD server</td></tr><tr><td>port</td><td>The LDAP port; the default is 389.</td></tr><tr><td>ssl</td><td>By default, SSL is not used.</td></tr><tr><td>principal</td><td>The full DN of the account to bind with, such as
         "CN=Administrator,CN=Users,DC=example,DC=com"</td></tr><tr><td>credentials</td><td>If a password is used, replace null with that password.
          When OpenIDM starts, it encrypts that password in the
          <code class="filename">provisioner.openicf-realad.conf</code> file.</td></tr><tr><td>baseContexts</td><td>The DNs for account containers, such as
         ["CN=Users,DC=Example,DC=com"]</td></tr><tr><td>baseContextsToSynchronize</td><td>Set to the same value as <code class="literal">baseContexts</code></td></tr><tr><td>accountSearchFilter</td><td>Default searches for active user (not computer) accounts</td></tr><tr><td>accountSynchronizationFilter</td><td>Default synchronizes with active user (not computer)
         accounts</td></tr></tbody></table></div></div><br class="table-break"><p>
      If you do not want to filter out computer and disabled user accounts,
      set the <code class="literal">accountSearchFilter</code> and
      <code class="literal">accountSynchronizationFilter</code> to <code class="literal">null</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="external-resource-sample6-simulated"></a>3.12.3.3.&nbsp;External Configuration for a Simulated AD Deployment</h4></div></div></div><p>
      Not everyone has a testable instance of AD readily available. For such
      administrators, you can use the <code class="filename">AD.ldif</code> file from
      the <code class="filename">data/</code> subdirectory to simulate an AD deployment.
     </p><p>
      If you have not already done so, copy the
      <code class="filename">provisioner.openicf-fakead.json</code> file to the
      <code class="filename">conf</code> subdirectory.
     </p><p>
      As previously mentioned, you can use a separate OpenDJ instance to
      simulate  the AD server. However, the following instructions assume that
      the simulated AD server runs on the same OpenDJ instance.
     </p><p>
      Open the <code class="filename">provisioner.openicf-fakead.json</code> file and
      note the following:
     </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        OpenDJ directory server uses port 1389 by default for users who cannot
        use privileged ports, so this is the port that is specified in the
        provisioner file. Adjust the port if your OpenDJ server is listening on
        a different port.
       </p></li><li class="listitem"><p>
        The simulated AD server uses the base DN
        <code class="literal">dc=fakead,dc=com</code>.
       </p></li></ul></div><p>
      To load the data for the simulated AD instance, launch the OpenDJ control
      panel, add the simulated AD baseDN (<code class="literal">dc=fakead,dc=com</code>),
      and then import the <code class="filename">/path/to/sample6/data/AD.ldif</code>
      file. When you import the <code class="filename">AD.ldif</code> file, select
      "Append to Existing Data", not "Overwrite Existing Data". Otherwise, the
      data in the <code class="literal">dc=example,dc=com</code> baseDN will be
      overwritten.
     </p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="install-sample6"></a>3.12.4.&nbsp;Start OpenIDM with Sample 6</h3></div></div></div><p>
     Now that OpenDJ and a real or simulated AD database is configured,
     prepare OpenIDM as described in <a class="xref" href="#preparing-openidm" title="3.1.2.&nbsp;Preparing OpenIDM">Section&nbsp;3.1.2, &#8220;Preparing OpenIDM&#8221;</a>.
     You can then start OpenIDM with the configuration for sample 6.
    </p><div class="screen"><pre>$ cd /path/to/openidm
$ ./startup.sh -p samples/sample6</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="run-sample6"></a>3.12.5.&nbsp;Run the Sample</h3></div></div></div><p>The following sections show how to run the sample with command-based
     reconciliation with a REST call, and to configure scheduled reconciliation
     with LiveSync.
    </p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="run-sample6-reconciliation"></a>3.12.5.1.&nbsp;Using Reconciliation</h4></div></div></div><p>
     Now that OpenIDM is in operation, review the entries in the OpenDJ
     data store. When you run reconciliation, any entries that share the same
     <code class="literal">uid</code> with the AD data store will be updated with the
     contents from AD.
    </p><p>
     If you have set up the simulated AD data store as described in
     <a class="xref" href="#external-resource-sample6-simulated" title="3.12.3.3.&nbsp;External Configuration for a Simulated AD Deployment">Section&nbsp;3.12.3.3, &#8220;External Configuration for a Simulated AD Deployment&#8221;</a>, compare the
     entries for <code class="literal">uid=jdoe</code> as shown in the
     <code class="filename">AD.ldif</code> and <code class="filename">Example.ldif</code> files.
     Note the different values of <code class="literal">givenName</code> for
     <code class="literal">uid=jdoe</code>.
    </p><p>
     Run reconciliation over the REST interface. If you have followed the
     instructions for the simulated AD data store, the following command
     takes the information for user <code class="literal">jdoe</code> imported from the
     <code class="filename">AD.ldif</code> file, with a <code class="literal">givenName</code> of
     Johnny, and synchronizes that information to the LDAP database, overwriting
     the <code class="literal">givenName</code> of John for that same user
     <code class="literal">jdoe</code>.
    </p><div class="screen"><pre>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 "https://localhost:8443/openidm/recon?_action=recon&amp;mapping=systemAdAccounts_managedUser&amp;waitForCompletion=true"</pre></div><p>
    The reconciliation operation returns a reconciliation run ID, and the status
    of the operation.
   </p><div class="screen"><pre>{
  "state": "SUCCESS",
  "_id": "985ee939-fbe1-4607-a757-00b404b4ef77"
}</pre></div><p>
     The reconciliation operation synchronizes the data in the AD deployment
     with OpenIDM repository (managed/user). That information is then
     automatically synchronized to the OpenDJ server, as described in
     <a href="../integrators-guide/index.html#handling-sync" class="link">
      <em class="citetitle">Synchronization Situations and Actions</em></a>.
    </p><p>After reconciliation, list all users in the OpenDJ server data
     store.</p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/system/ldap/account?_queryId=query-all-ids"</strong></pre></div><p>The result should resemble the following JSON object.</p><pre class="brush: javascript;">{
  "result": [ {
     "dn" : "uid=jdoe,ou=People,dc=example,dc=com",
     "_id" : "uid=jdoe,ou=People,dc=example,dc=com"
     }, {
     "dn" : "uid=bjensen,ou=People,dc=example,dc=com",
     "_id" : "uid=bjensen,ou=People,dc=example,dc=com"
    } ],
  "resultCount": 2,
  "pagedResultsCookie": null,
  "remainingPagedResults": -1,
}</pre><p>
     You see only two entries, as the <code class="literal">uid=jdoe</code> entry from
     <code class="literal">dc=fakead,dc=com</code> overwrites the original LDAP entry for
     <code class="literal">uid=jdoe</code> in the reconciled LDAP data store.
    </p><p>
     To read the user object in the OpenDJ server, run the
     <span class="command"><strong>ldapsearch</strong></span> command. The following example returns the
     entry for user <code class="literal">uid=jdoe</code>:
    </p><div class="screen"><pre><strong>$ ./ldapsearch \
 --port 1389 \
 --baseDN dc=example,dc=com \
 "(uid=jdoe)"</strong></pre></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="run-sample6-live-sync"></a>3.12.5.2.&nbsp;Using LiveSync</h4></div></div></div><p>You can start reconciliation by using a scheduled configuration or
     by using the REST interface directly. However, to use LiveSync, you must
     configure a schedule. When LiveSync is active, the default schedule in the
     <code class="filename">schedule-activeSynchroniser_systemAdAccount.json</code>
     configuration file runs LiveSync every 15 seconds.
    </p><p>
     LiveSync pushes changes made in the AD data store to the OpenIDM repository,
     automatically.
    </p><p>
     LiveSync is disabled by default. To activate LiveSync, change the
     value of the <code class="literal">"enabled"</code> property
     from <code class="literal">false</code> to <code class="literal">true</code>.
    </p><pre class="brush: javascript;">{
    "enabled" : false,
    "type" : "cron",
    "schedule" : "0/15 * * * * ?",
    "invokeService" : "provisioner",
    "invokeContext" : {
        "action" : "liveSync",
        "source" : "system/ad/account"
    },
    "invokeLogLevel" : "debug"
}</pre><div class="procedure"><a name="test-live-sync"></a><div class="procedure-title">Procedure&nbsp;3.9.&nbsp;Testing LiveSync</div><p>
      Now you can test LiveSync. This procedure assumes that you have configured
      OpenDJ using the parameters and commands described in this section.
     </p><ol class="procedure" type="1"><li class="step"><p>
       Create an LDIF file with a new user entry (<code class="literal">uid=bsmith</code>)
       that will be added to the simulated AD data store.
      </p></li><li class="step"><p>
       The following is the contents of a sample
       <code class="filename">bsmith.ldif</code> file for demonstration purposes:
       </p><div class="screen"><pre>dn: uid=bsmith,ou=People,dc=fakead,dc=com
objectClass: person
objectClass: inetOrgPerson
objectClass: organizationalPerson
objectClass: top
givenName: Barry
description: Created to see LiveSync work
uid: bsmith
cn: Barry
sn: Smith
mail: bsmith@example.com
telephoneNumber: 1-415-523-0772
userPassword: passw0rd</pre></div><p>
      </p></li><li class="step"><p>
       Navigate to the <code class="filename">/path/to/opendj/bin</code> directory.
      </p></li><li class="step"><p>
       Use the <span class="command"><strong>ldapmodify</strong></span> command to add the
       <code class="filename">bsmith.ldif</code> file to the directory.
      </p><div class="screen"><pre><strong>$ ./ldapmodify
 --port 1389
 --defaultAdd
 --bindDN "cn=Directory Manager"
 --bindPassword password
 --filename /path/to/bsmith.ldif</strong></pre></div></li><li class="step"><p>
       Now you can test synchronization by viewing the new user in the OpenIDM
       repository. The easiest way to do this, is through OpenIDM UI. You should
       be able to log into the UI with any of the accounts in the AD data store.
       For this example, log into the UI as user <code class="literal">bsmith</code>, with
       password <code class="literal">passw0rd</code>. The fact that you can log into the
       UI as this new user indicates that LiveSync has synchronized the user
       from the AD data store to the managed/user repository.
      </p></li><li class="step"><p>
       Implicit synchronization pushes this change out to the OpenDJ data store.
       To test this synchronization operation, search the OpenDJ baseDN for the
       new user entry.
      </p><div class="screen"><pre><strong>$ ./ldapsearch \
 --port 1389 \
 --baseDN ou=people,dc=example,dc=com \
 "(uid=bsmith)"</strong></pre></div></li></ol></div></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="more-sample7"></a>3.13.&nbsp;Sample 7 - Scripting a SCIM-like Schema</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#install-sample7">3.13.1. Install the Sample</a></span></dt><dt><span class="section"><a href="#run-sample7">3.13.2. Running the Sample</a></span></dt></dl></div><a class="indexterm" name="d4757e5066"></a><p>Sample 7 demonstrates how you can use OpenIDM to expose user data with a
  SCIM-like schema. The sample uses the XML file connector to read in attributes
  from external accounts and construct a JSON object for users stored in the
  OpenIDM repository. For more information about SCIM schema, see
  <a class="link" href="http://www.simplecloud.info/specs/draft-scim-core-schema-01.html" target="_blank">
  <em class="citetitle">System for Cross-Domain Identity Management:
   Core Schema 1.1</em></a>.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="install-sample7"></a>3.13.1.&nbsp;Install the Sample</h3></div></div></div><p>Prepare OpenIDM as described in <a class="xref" href="#preparing-openidm" title="3.1.2.&nbsp;Preparing OpenIDM">Section&nbsp;3.1.2, &#8220;Preparing OpenIDM&#8221;</a>, 
   then start OpenIDM with the configuration for sample 7.</p><div class="screen"><pre>$ cd /path/to/openidm
$ ./startup.sh -p samples/sample7</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="run-sample7"></a>3.13.2.&nbsp;Running the Sample</h3></div></div></div><p>Run a reconciliation to pull the user from
   <code class="filename">samples/sample7/data/xmlConnectorData.xml</code> into the 
   OpenIDM internal repository.</p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 "https://localhost:8443/openidm/recon?_action=recon&amp;mapping=systemXmlfileAccounts_managedUser&amp;waitForCompletion=true"</strong></pre></div><p>Reconciliation creates a user object in the repository. Retrieve the
   user from the repository.</p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/managed/user/DDOE1"</strong></pre></div><p>The user object has the following JSON representation.</p><pre class="brush: javascript;">{
  "_id" : "DDOE1",
  "_rev" : "2",
  "schemas" : "['urn:scim:schemas:core:1.0']",
  "ims" : [ {
    "type" : "aim",
    "value" : "jonyOnAim"
  }, {
    "type" : "skype",
    "value" : "skyperHiasl"
  } ],
  "locale" : null,
  "phoneNumbers" : [ {
    "type" : "work",
    "value" : "1234567"
  }, {
    "type" : "home",
    "value" : "1234568"
  } ],
  "emails" : [ {
    "type" : "work",
    "value" : "hallo@example.com",
    "primary" : true
  }, {
    "type" : "home",
    "value" : "jdoe@forgerock.com"
  } ],
  "externalId" : "DDOE1",
  "preferredLanguage" : "en_US",
  "meta" : {
    "lastModified" : "Thu May 01 2014 12:57:10 GMT-0800 (GMT-08:00)",
    "created" : "Thu May 01 2014 12:56:27 GMT-0800 (GMT-08:00)"
  },
  "userType" : "permanent",
  "photos" : [ {
    "type" : "photo",
    "value" : "https://photos.example.com/profilephoto/72930000000Ccne/F"
  }, {
    "type" : "thumbnail",
    "value" : "https://photos.example.com/profilephoto/72930000000Ccne/T"
  } ],
  "title" : "Mr.Universe",
  "timezone" : "America/Denver",
  "profileUrl" : "https://login.example.com/DDOE1",
  "nickName" : "Jonny",
  "name" : {
    "familyName" : "Doe",
    "middleName" : "Hias",
    "formatted" : "Dr. John H Doe III",
    "givenName" : "John",
    "honorificSuffix" : "III",
    "honorificPrefix" : "Dr."
  },
  "userName" : "DDOE1",
  "displayName" : "John Doe",
  "addresses" : [ {
    "streetAddress" : "100 Universal City Plaza",
    "region" : "CA",
    "formatted" : "100 Universal City Plaza\nHollywood, CA 91608 USA",
    "postalCode" : "91608",
    "primary" : "true",
    "locality" : "Hollywood",
    "type" : "work",
    "country" : "USA"
  }, {
    "streetAddress" : "222 Universal City Plaza",
    "region" : "CA",
    "formatted" : "222 Universal City Plaza\nHollywood, CA 91622 USA",
    "postalCode" : "91622",
    "primary" : "false",
    "locality" : "Hollywood",
    "type" : "home",
    "country" : "USA"
  } ],
  "groups" : [ {
    "value" : "usemploys",
    "display" : "US Employees"
  }, {
    "value" : "euemploys",
    "display" : "EU Employees"
  } ]
}</pre><p>
    The sample script file, <code class="filename">scim.js</code> in the
    <code class="filename">/path/to/samples/sample7/script</code> directory,
    transforms the user data from the resource into the JSON object layout
    required by SCIM schema.
   </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="more-sample8"></a>3.14.&nbsp;Sample 8 - Logging in Scripts</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#install-sample8">3.14.1. Install the Sample</a></span></dt><dt><span class="section"><a href="#run-sample8">3.14.2. Running the Sample</a></span></dt></dl></div><a class="indexterm" name="d4757e5118"></a><p>OpenIDM provides a <code class="literal">logger</code> object with
  <code class="literal">debug()</code>, <code class="literal">error()</code>,
  <code class="literal">info()</code>, <code class="literal">trace()</code>, and
  <code class="literal">warn()</code> functions that you can use to log messages to 
  the OpenIDM console from your scripts.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="install-sample8"></a>3.14.1.&nbsp;Install the Sample</h3></div></div></div><p>Prepare OpenIDM as described in <a class="xref" href="#preparing-openidm" title="3.1.2.&nbsp;Preparing OpenIDM">Section&nbsp;3.1.2, &#8220;Preparing OpenIDM&#8221;</a>, 
   then start OpenIDM with the configuration for sample 8.</p><div class="screen"><pre>$ cd /path/to/openidm
$ ./startup.sh -p samples/sample8</pre></div><p>The <code class="filename">sync.json</code> file in the
    <code class="filename">/path/to/samples/sample8/conf</code> directory includes
    brief examples of log messages.
   </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="run-sample8"></a>3.14.2.&nbsp;Running the Sample</h3></div></div></div><p>Run reconciliation over the REST interface.</p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 "https://localhost:8443/openidm/recon?_action=recon&amp;mapping=systemXmlfileAccounts_managedUser&amp;waitForCompletion=true"</strong></pre></div><p>
    The reconciliation operation returns a reconciliation run ID, and the status
    of the operation.
   </p><p>Notice the log messages displayed on the OpenIDM (Felix) console.
   The following example omits timestamps and so forth to show only the message
   strings.</p><pre class="brush: plain;">-&gt;
...Case no Source: the source object contains: = null [5235432-...
...Case emptySource: the source object contains: = {lastname=Carter, mobile...
...Case sourceDescription: the source object contains: = Created By XML1
...Case onCreate: the source object contains: = {lastname=Carter, mobile...
...Case result: the source object contains: = {SOURCE_IGNORED={count=0, ids=[]},...</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="more-sample9"></a>3.15.&nbsp;Sample 9 - Asynchronous Reconciliation Using Workflows</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#install-sample9">3.15.1. Install the Sample</a></span></dt><dt><span class="section"><a href="#run-sample9">3.15.2. Running the Sample</a></span></dt></dl></div><a class="indexterm" name="d4757e5177"></a><p>Sample 9 demonstrates asynchronous reconciliation using workflows. 
  Reconciliation generates an approval request for each ABSENT user. The 
  configuration for this action is defined in the <code class="filename">conf/sync.json</code> 
  file, which specifies that an <code class="literal">ABSENT</code> condition should 
  launch the <code class="literal">managedUserApproval</code> workflow:</p><pre class="brush: javascript;">...
    {
        "situation" : "ABSENT",
        "action" : {
            "workflowName" : "managedUserApproval",
            "type" : "text/javascript",
            "file" : "workflow/triggerWorkflowFromSync.js"
        }
    },
 ...  </pre><p>When the request is approved by an administrator, the absent users are 
  created by an asynchronous reconciliation process.</p><p>Prepare a fresh installation of OpenIDM before trying this
  sample.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="install-sample9"></a>3.15.1.&nbsp;Install the Sample</h3></div></div></div><p>Prepare OpenIDM as described in <a class="xref" href="#preparing-openidm" title="3.1.2.&nbsp;Preparing OpenIDM">Section&nbsp;3.1.2, &#8220;Preparing OpenIDM&#8221;</a>, 
     then start OpenIDM with the configuration for sample 9.</p><div class="screen"><pre><strong>$ cd /path/to/openidm
$ ./startup.sh -p samples/sample9</strong></pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="run-sample9"></a>3.15.2.&nbsp;Running the Sample</h3></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Run reconciliation over the REST interface.</p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 "https://localhost:8443/openidm/recon?_action=recon&amp;mapping=systemXmlfileAccounts_managedUser&amp;waitForCompletion=true"</strong></pre></div><p>
          The reconciliation operation returns a reconciliation run ID, and the
          status of the operation.
         </p><p>
          Reconciliation starts an approval workflow for each ABSENT user. These
          approval workflows (named <code class="literal">managedUserApproval</code>)
          wait for the request to be approved by an administrator.
         </p></li><li class="listitem"><p>Query the invoked workflow task instances over REST.</p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/workflow/taskinstance?_queryId=query-all-ids"</strong></pre></div><p>
          In this case, the request returns two workflow results, each with a
          process ID (<code class="literal">_id</code>) as well as a process definition
          ID. You will use the value of the <code class="literal">_id</code> shortly.
         </p><div class="screen"><pre>{
 "result" : [ {
   "tenantId" : "",
   "createTime" : "2014-05-01T13:48:42.980-08:00",
   "executionId" : "101",
   "delegationStateString" : null,
   "processVariables" : { },
   "_id" : "123",
   "processInstanceId" : "101",
   "description" : null,
   "priority" : 50,
   "name" : "Evaluate request",
   "dueDate" : null,
   "parentTaskId" : null,
   "processDefinitionId" : "managedUserApproval:1:3",
   "taskLocalVariables" : { },
   "suspensionState" : 1,
   "assignee" : "openidm-admin",
   "cachedElContext" : null,
   "queryVariables" : null,
   "activityInstanceVariables" : { },
   "deleted" : false,
   "suspended" : false,
   "_rev" : 1,
   "revisionNext" : 2,
   "category" : null,
   "taskDefinitionKey" : "evaluateRequest",
   "owner" : null,
   "eventName" : null,
   "delegationState" : null
 }, {
   "tenantId" : "",
   "createTime" : "2014-05-01T13:48:42.980-08:00",
   "executionId" : "102",
   "delegationStateString" : null,
   "processVariables" : { },
   "_id" : "124",
   "processInstanceId" : "102",
   "description" : null,
   "priority" : 50,
   "name" : "Evaluate request",
   "dueDate" : null,
   "parentTaskId" : null,
   "processDefinitionId" : "managedUserApproval:1:3",
   "taskLocalVariables" : { },
   "suspensionState" : 1,
   "assignee" : "openidm-admin",
   "cachedElContext" : null,
   "queryVariables" : null,
   "activityInstanceVariables" : { },
   "deleted" : false,
   "suspended" : false,
   "_rev" : 1,
   "revisionNext" : 2,
   "category" : null,
   "taskDefinitionKey" : "evaluateRequest",
   "owner" : null,
   "eventName" : null,
   "delegationState" : null
 } ],
 "resultCount" : 2,
 "pagedResultsCookie" : null,
 "remainingPagedResults" : -1
}</pre></div></li><li class="listitem"><p>
         Approve the requests over REST, by setting the
         <code class="literal">"requestApproved"</code> parameter for the specified task
         instance to <code class="literal">"true"</code>. Note the use of one of the
         values of <code class="literal">_id</code> in the REST call, in this case,
         <code class="literal">124</code>.
        </p><p>On UNIX:</p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 --data '{"requestApproved": "true"}' \
 "https://localhost:8443/openidm/workflow/taskinstance/124?_action=complete"</strong></pre></div><p>On Windows:</p><div class="screen"><pre><strong>$ curl ^
 --cacert self-signed.crt ^
 --header "X-OpenIDM-Username: openidm-admin" ^
 --header "X-OpenIDM-Password: openidm-admin" ^
 --header "Content-Type: application/json" ^
 --request POST ^
 --data "{\"requestApproved\": \"true\"}" ^
 "https://localhost:8443/openidm/workflow/taskinstance/124?_action=complete"</strong></pre></div><p>A successful call returns the following:</p><div class="screen"><pre>{"Task action performed":"complete"}</pre></div></li><li class="listitem"><p>
         Once the request has been approved, an asynchronous reconciliation
         operation runs, which creates the users whose accounts were approved in
         the previous step.
        </p><p>
         List the users that were created by the asynchronous reconciliation.
        </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/managed/user?_queryId=query-all-ids"</strong></pre></div><p>One user is returned.</p><div class="screen"><pre>{
 "result": [ {
   "_rev": "0",
   "_id": "1"
 } ],
 "resultCount": 1,
 "pagedResultsCookie": null,
 "remainingPagedResults": -1,
}</pre></div></li></ol></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="more-sample-openam"></a>3.16.&nbsp;Sample - Configuring Authentication Management With OpenAM</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#prepare-sample-openam">3.16.1. Prepare the Sample</a></span></dt><dt><span class="section"><a href="#configure-openam-sample">3.16.2. Configuring OpenIDM for the OpenAM Sample</a></span></dt><dt><span class="section"><a href="#install-sample-openam">3.16.3. Install the Sample</a></span></dt><dt><span class="section"><a href="#run-sample-openam">3.16.4. Running the Sample</a></span></dt><dt><span class="section"><a href="#review-sample-openam">3.16.5. Make Sure the Sample Works as Intended</a></span></dt><dt><span class="section"><a href="#sample-openam-going-further">3.16.6. Additional Options for the OpenAM Sample</a></span></dt></dl></div><a class="indexterm" name="d4757e5286"></a><p>
   This sample demonstrates how you can protect a deployment of OpenIDM with
   ForgeRock's <a class="link" href="http://docs.forgerock.org/en/index.html?product=openam" target="_blank">
   <em class="citetitle">OpenAM Access Management</em></a> product.
  </p><p>
   In this sample, you will use OpenIDM together with OpenAM and ForgeRock's
   <a class="link" href="http://docs.forgerock.org/en/index.html?product=opendj" target="_top">
   <em class="citetitle">OpenDJ Directory Services</em></a> product.
  </p><p>
   When configured together, you can demonstrate one use case that maximizes
   Identity Relationship Management (IRM) functionality. OpenIDM can maintain
   user data in OpenDJ data stores. Once protected by OpenAM, you can configure
   rules for authorized access.
  </p><p>
   This sample configures OpenIDM on one system, with a URL of
   <code class="literal">openidm.example.com</code>. It configures OpenAM and OpenDJ on
   a separate second system, with a URL of <code class="literal">openam.example.com</code>.
  </p><div class="note"><h3 class="title">Note</h3><p>
    This sample assumes that you have deployed OpenAM 12.
   </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="prepare-sample-openam"></a>3.16.1.&nbsp;Prepare the Sample</h3></div></div></div><p>
    Before installing OpenIDM, you need to prepare your systems. To set up this
    sample, you need to take the following basic steps:
   </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
      Install OpenDJ, using a base DN of <code class="literal">dc=example,dc=com</code>.
      Be sure to import the <code class="filename">Example.ldif</code> file available in
      the <code class="literal">samples/openam/data</code> directory.
      This example assumes that you install OpenDJ on the same system as
      OpenIDM, with a FQDN of <code class="literal">openidm.example.com</code>.
     </p><p>
      You can import the appropriate <code class="filename">Example.ldif</code> file with
      the following command.
     </p><div class="screen"><pre>$ cd /path/to/opendj/bin
$ ./ldapmodify \
--bindDN "cn=Directory Manager" \
--bindPassword password \
--hostname localhost \
--port 1389 \
--filename /path/to/openidm/samples/openam/data/Example.ldif
     </pre></div><p>
      If you set up OpenDJ on a secure port with a self-signed certificate, you
      should import that certificate into the OpenIDM datastore. For more
      information, see <a href="../integrators-guide/index.html#security-management-service" class="link"><em class="citetitle">Accessing the
      Security Management Service</em></a> in the <em class="citetitle">Integrator's
      Guide</em>.
     </p></li><li class="listitem"><p>
      Install an OpenAM 12 server in an environment that OpenIDM can access with
      RESTful calls. For installation instructions, see the <a class="link" href="http://openam.forgerock.org/openam-documentation/openam-doc-source/doc/install-guide/index.html" target="_blank">
      <em class="citetitle">OpenAM Installation Guide</em></a>. This example
      assumes that you have deployed the associated <code class="literal">.war</code>
      file in your selected Java EE container with the following name:
      <code class="filename">openam.war</code>.
     </p><p>
      Configure the OpenAM JVM on a secure port such as 8443.
     </p><p>
      When installing OpenAM, configure it to use the OpenDJ data store
      installed on <code class="literal">openam.example.com</code>.
     </p><p>
      As described in the following procedure, <a class="link" href="http://openam.forgerock.org/openam-documentation/openam-doc-source/doc/install-guide/index.html#configure-openam-custom" target="_blank">
      <em class="citetitle">To Custom Configure OpenAM</em></a>, Make sure the
      trust store used by the JVM running OpenAM has the necessary certificates
      installed.
     </p><p>
      This sample assumes that you will configure OpenAM-based Single Sign-On
      (SSO) as described in the OpenAM Administration Guide. For this sample,
      configure <code class="literal">.example.com</code> as the sole cookie domain as
      described in the following section of the OpenAM Reference Guide:
      <a class="link" href="http://openam.forgerock.org/openam-documentation/openam-doc-source/doc/reference#system-platform-attrs" target="_blank">
      <em class="citetitle">System Configuration: Platform</em></a>.
     </p><div class="note"><h3 class="title">Note</h3><p>
       When you configure OpenAM for this sample, you do not need to install a
       Java EE agent. This sample uses the <code class="literal">OPENAM_SESSION</code>
       module to protect OpenIDM. That module is included in the
       <code class="literal">/path/to/openam/conf/authentication.json</code> file.
      </p></div></li><li class="listitem"><p>
      Prepare OpenIDM as described in <a class="xref" href="#preparing-openidm" title="3.1.2.&nbsp;Preparing OpenIDM">Section&nbsp;3.1.2, &#8220;Preparing OpenIDM&#8221;</a>.
     </p></li><li class="listitem"><p>
      As OpenAM works with FQDNs (and not IP addresses), you will need to set up
      either the noted FQDNs <code class="literal">(openam.example.com and
      openidm.example.com)</code> in an address database such as a DNS server
      or the static <code class="filename">hosts</code> configuration file of both
      systems.
     </p></li><li class="listitem"><p>
      Do not start OpenIDM yet. You will need to configure it further.
     </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="configure-openam-sample"></a>3.16.2.&nbsp;Configuring OpenIDM for the OpenAM Sample</h3></div></div></div><p>
     Before starting OpenIDM, you will need to change two configuration files,
     related to authentication and provisioning.
    </p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="configure-openam-sample-auth-json"></a>3.16.2.1.&nbsp;Configuring the authentication.json File for OpenAM</h4></div></div></div><p>
      To configure OpenIDM authentication, open the
      <code class="filename">authentication.json</code> file. For this sample, you can
      find that file in the <code class="literal">samples/openam/conf</code> directory.
     </p><p>
      Under <code class="literal">"authModules"</code>, find the
      <code class="literal">"OPENAM_SESSION"</code> authentication module. The default
      version of the <code class="filename">authentication.json</code> file includes two
      entries which you must fill in:
     </p><pre class="brush: javascript;">"authModules" : [
  {
     "name" : "OPENAM_SESSION",
     "properties" : {
       "openamDeploymentUrl" : "",
       "groupRoleMapping" : {
         "openidm-admin" : [ ]
       },</pre><p>
      Based on a standard <code class="literal">openidm-admin</code> user and the
      previously noted URL and <code class="literal">.war</code> file for your OpenAM
      deployment, you would change the code snippet to:
     </p><pre class="brush: javascript;">"authModules" : [
  {
     "name" : "OPENAM_SESSION",
     "properties" : {
       "openamDeploymentUrl" : "https://openam.example.com:8443/openam",
       "groupRoleMapping" : {
         "openidm-admin" : [
           "cn=idmAdmins,ou=Groups,dc=example,dc=com"
         ]
       },</pre><p>
      Do remember to include <code class="literal">/openam</code> in the value of
      <code class="literal">"openamDeploymentUrl"</code>. After the Java EE container used
      for OpenAM starts, it unpacks a file such as <code class="literal">openam.war</code>
      so that you can access it on the <code class="literal">/openam</code> endpoint.
     </p><p>
      With the <code class="literal">"groupRoleMapping"</code>, you can add the
      Distinguished Names (DN) of groups to the list. This feature will then
      assign the noted role, such as <code class="literal">openidm-admin</code> to any user
      who is a member of one of these groups. For more information on how roles
      are assigned, see the following section in the Integrator's Guide on
      <a class="link" href="integrators-guide#openidm-roles" target="_blank">
      <em class="citetitle">Roles and Authentication</em></a>.
     </p><p>
      The <code class="literal">"openamDeploymentUrl"</code> shown above assumes that you
      are using SSL. If you have a self-signed certificate, you will need to
      import that into the OpenIDM truststore file. For more information, see
      the following section of the Integrator's Guide: <a class="link" href="integrators-guide#security-management-service" target="_blank"><em class="citetitle">
      Accessing the Security Management Service</em></a>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="configure-openam-sample-prov"></a>3.16.2.2.&nbsp;Configure Provisioning for the OpenAM Sample</h4></div></div></div><p>
       This section describes how you can customize the
       <code class="filename">provisioner.openicf-ldap.json</code> file. The following
       edits parallel those for <a class="link" href="install-guide#more-sample2c" target="_blank"><em class="citetitle">Sample
       2c - Synchronizing LDAP Group Membership</em></a>.
      </p><p>
       Open the noted provisioner file, which you can find in the
       <code class="literal">samples/openam/conf</code> directory. In the
       initial version of this file, you should see something similar to the
       following code:
      </p><pre class="brush: javascript;">{
  "name" : "ldap",
  "configurationProperties" : {
       "host" : "localhost",
       "port" : 1389,
       "ssl" : false,
       "principal" : "cn=Directory Manager",
       "credentials" : "password",
       "baseContexts" : [
           "dc=example,dc=com"
       ],
       "baseContextsToSynchronize" : [
           "dc=example,dc=com"
       ],</pre><p>
       This snippet already matches the noted base context of
       <code class="literal">"dc=example,dc=com"</code> with a principal of
       <code class="literal">"cn=Directory Manager"</code>.
      </p><p>
       Make sure that the following settings are consistent with the
       way you have configured OpenDJ and OpenAM.
      </p><p>
       Change the <code class="literal">"localhost"</code> entry to the
       URL where OpenDJ is installed. In this case, that URL is
       <code class="literal">openidm.example.com</code>. Depending on whether you want to
       set up communications over a regular or secure LDAP port, you might
       change the <code class="literal">"port"</code> number to 389 or 636. The following
       excerpt illustrates the change to a secure connector configuration:
      </p><pre class="brush: javascript;">{
  "name" : "ldap",
  "configurationProperties" : {
      "host" : "openidm.example.com",
      "port" : 636,
      "ssl" : true,
      "principal" : "cn=Directory Manager",
      "credentials" : "password",
      "baseContexts" : [
          "dc=example,dc=com"
      ],
      "baseContextsToSynchronize" : [
          "dc=example,dc=com"
      ],</pre><p>
       Just remember, if you want to set up secure communications with OpenDJ,
       you should configure OpenDJ with that in mind. If you have a self-signed
       certificate for OpenDJ, you will also want to import that into the
       OpenIDM truststore, as discussed in the following section of the
       Integrator's Guide: <a class="link" href="integrators-guide#security-management-service" target="_blank"><em class="citetitle">
       Accessing the Security Management Service</em></a>.
      </p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="install-sample-openam"></a>3.16.3.&nbsp;Install the Sample</h3></div></div></div><p>
    If you have not already done so, make sure OpenDJ is running on its
    assigned system, in this case, <code class="literal">openidm.example.com</code>.
   </p><p>
    Finish preparing OpenIDM, with the procedure described in
    <a class="xref" href="#preparing-openidm" title="3.1.2.&nbsp;Preparing OpenIDM">Section&nbsp;3.1.2, &#8220;Preparing OpenIDM&#8221;</a>, then start OpenIDM with the
    configuration for sample openam.
   </p><div class="screen"><pre>$ cd /path/to/openidm
    $ ./startup.sh -p samples/openam</pre></div><p>
    If you have not already done so, make sure OpenAM is also running on its
    assigned system, in this case, <code class="literal">openam.example.com</code>.
   </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="run-sample-openam"></a>3.16.4.&nbsp;Running the Sample</h3></div></div></div><p>
     With everything configured, now run reconciliation on the
     <code class="literal">openidm.example.com</code> system. The following command
     imports users from the OpenDJ database into the OpenIDM managed/user
     database:
    </p><div class="screen"><pre>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 "https://localhost:8443/openidm/recon?_action=recon&amp;mapping=systemLdapAccounts_managedUser&amp;waitForCompletion=true"</pre></div><p>
    The reconciliation operation returns a reconciliation run ID, and the status
    of the operation.
   </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="review-sample-openam"></a>3.16.5.&nbsp;Make Sure the Sample Works as Intended</h3></div></div></div><p>
    You should still be able to access the OpenIDM UI
    in the "normal" way. In this case, you would point a browser to
    <code class="literal">https://openidm.example.com:8443/openidmui</code>.
   </p><p>
    The difference is how OpenIDM uses a proxy service to authenticate with
    OpenAM's REST-based authentication service. This sample implements the
    proxy service as a custom endpoint in the <code class="filename">openamProxy.js</code>
    file, in the <code class="literal">samples/openam/script</code>
    directory.
   </p><p>
    The first time you log into the OpenIDM UI, you should see a login prompt
    configured with OpenAM. The default version of this prompt appears quite
    similar to the OpenIDM prompt. When you login through OpenAM, successfully,
    you will receive a valid SSO token.
   </p><p>
    The next time you access OpenIDM, with the SSO token stored in your browser,
    you will be logged in automatically, with all the roles configured for your
    user account. This works only if your session is still active in OpenAM.
    For more information, see the OpenAM Administration Guide section on
    <a class="link" href="http://openam.forgerock.org/openam-documentation/openam-doc-source/doc/admin-guide/#session-mgmt" target="_blank">
    <em class="citetitle">Session Management</em></a>.
   </p><div class="note"><h3 class="title">Note</h3><p>You can review the contents of the SSO token by pointing a browser to
    the FQDN of the OpenIDM instance, with the <code class="literal">info/login</code>
    endpoint. In this case, that URL would be
    <code class="literal">https://openidm.example.com/openidm/info/login</code>.</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="sample-openam-going-further"></a>3.16.6.&nbsp;Additional Options for the OpenAM Sample</h3></div></div></div><p>
    You can extend the OpenAM sample in one of three ways:
   </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">Disable INTERNAL_USER when enabling LiveSync</code></p><p>
      To keep OpenDJ in sync with the OpenIDM managed/user database, you can
      enable scheduled reconciliation and LiveSync. To do so, edit the following
      files: <code class="filename">schedule-recon.json</code> and
      <code class="filename">schedule-livesync.json</code>, in the
      <code class="literal">samples/openam/conf</code> directory. Set
      <code class="literal">"enabled" : true</code> in each of these files.
     </p><p>
      This ensures that any change to the OpenDJ user store is automatically
      reflected in the OpenIDM managed/user data store. For a similar example,
      see <a class="xref" href="#more-sample6" title="3.12.&nbsp;Sample 6 - LiveSync With an AD Server">Section&nbsp;3.12, &#8220;Sample 6 - LiveSync With an AD Server&#8221;</a>.
     </p><p>
      You can take these steps while OpenIDM is running.
     </p></li><li class="listitem"><p>
      Execute the reconciliation command described earlier in the description
      for this sample.
     </p></li><li class="listitem"><p>
      Once scheduled reconciliation and LiveSync are configured, you can then
      disable the <code class="literal">INTERNAL_USER</code> under
      <code class="literal">authModules</code> in the relevant
      <code class="filename">authentication.json</code> file. Just navigate to that
      section of the file and set <code class="literal">"enabled" : false</code>. Once
      complete, the only users with access to OpenIDM are users with a valid
      SSO authentication token in their browsers.
     </p></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="more-sample-audit"></a>3.17.&nbsp;Sample - Demonstrate Extended Audit Capabilities</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#audit-config-files">3.17.1. Audit Sample Configuration Files</a></span></dt><dt><span class="section"><a href="#external-audit-mysql-sample">3.17.2. Configuration with MySQL</a></span></dt><dt><span class="section"><a href="#install-sample-audit">3.17.3. Install the Sample</a></span></dt><dt><span class="section"><a href="#run-sample-audit">3.17.4. Running the Sample</a></span></dt></dl></div><a class="indexterm" name="d4757e5661"></a><p>
   This sample demonstrates how you can use the audit features associated with
   OpenIDM, for access, activity, reconciliation, and synchronization.
  </p><p>
   This sample uses a MySQL database as a target repository for audit
   information. This audit sample is closely related to the
   <a href="../install-guide/index.html#chap-sample" class="link"><em class="citetitle">First OpenIDM
   Sample</em></a>.
  </p><p>
   One difference: the audit sample includes a ScriptedSQL implementation of
   the Groovy Connector Toolkit.
  </p><p>
   If you want to use any of the audit features demonstrated in this sample,
   copy information from files in the /path/to/samples/audit-sample directory.
   This can help you set up auditing for any other sample.
  </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="audit-config-files"></a>3.17.1.&nbsp;Audit Sample Configuration Files</h3></div></div></div><p>
    Review the configuration files used in this sample. They can help you
    understand the functionality of the data sets being audited.
   </p><div class="itemizedlist"><p>
     The key configuration files, in the
     <code class="literal">/path/to/samples/audit-sample</code> directory, are as follows:
    </p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
      <code class="filename">conf/provisioner.openicf-scriptedsql.json</code> shows the
      configuration of the <a href="../integrators-guide/index.html#scripted-sql-connector" class="link">
      <em class="citetitle">Scripted SQL Connector</em></a>.
     </p></li><li class="listitem"><p>
      <code class="filename">conf/provisioner.openicf-xml.json</code> shows the
      configuration of the <a href="../integrators-guide/index.html#xml-file-connector" class="link">
      <em class="citetitle">XML File Connector</em></a>.
     </p></li><li class="listitem"><p>
      <code class="filename">conf/audit.json</code> configures audit logging on the
      router, to a remote system, as discussed in <a href="../integrators-guide/index.html#audit-configuration" class="link"><em class="citetitle">Audit
     Configuration</em></a>.
     </p></li><li class="listitem"><p>
      <code class="filename">conf/sync.json</code> shows mappings between managed users
      and the data set attached through the XML File Connector.
     </p></li><li class="listitem"><p>
      <code class="filename">data/sample_audit_db.mysql</code> includes a schema that
      supports tables in the external MySQL database.
     </p></li><li class="listitem"><p>
      Groovy scripts in the <code class="filename">tools/</code> subdirectory supports
      communications between the Scripted SQL connector and the MySQL
      database.
     </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="external-audit-mysql-sample"></a>3.17.2.&nbsp;Configuration with MySQL</h3></div></div></div><p>
    You need to set up communications between OpenIDM and an external MySQL
    database server.
   </p><p>
    Make sure MySQL is running.
   </p><div class="itemizedlist"><p>
     The sample expects the following configuration for MySQL:
    </p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
      The database is available on the local system.
     </p></li><li class="listitem"><p>
      The database listens on the standard MySQL port, 3306.
     </p></li><li class="listitem"><p>
      You can connect to the MySQL database over the network.
     </p></li><li class="listitem"><p>
      MySQL is configured with an administrative account with user
      <code class="literal">root</code> and password <code class="literal">password</code>.
     </p></li><li class="listitem"><p>
      MySQL serves a database called <code class="literal">audit</code> with three tables:
      <code class="literal">access</code>, <code class="literal">activity</code>, and
      <code class="literal">recon</code>.
     </p></li><li class="listitem"><p>
      For more information on the database schema, examine the following data
      definition language file:
      <code class="literal">openidm/samples/audit-sample/data/sample_audit_db.mysql</code>.
      Import the file into MySQL before running the sample.
     </p><div class="screen"><pre>$ <strong>mysql -u root -p &lt; /path/to/openidm/samples/audit-sample/data/sample_audit_db.mysql
     </strong>
Enter password:
$ </pre></div></li></ul></div><p>
    Now you can review the format of the audit database sample, created from
    the <code class="filename">sample_audit_db.mysql</code> file, at the MySQL prompt."
    access that prompt, run the following command:
   </p><div class="screen"><pre>$ <strong>mysql -u root -p</strong>
mysql &gt; <strong>use audit;</strong>
<em>Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed</em></pre></div><p>
    You can now review the current state of the access, activity, and
    reconciliation logs with the following commands:
   </p><div class="screen"><pre>select * from auditaccess;
select * from auditactivity;
select * from auditrecon;
select * from auditsync;</pre></div><p>
    Unless you enable scheduled reconciliation, you will not see audit
    data until you run reconciliation manually.
   </p><p>
    Download the <a class="link" href="http://dev.mysql.com/downloads/connector/j/5.1.html" target="_blank">MySQL
    Driver</a>, (MySQL Connector/J, version 5.1 or later) from the MySQL
    website. Unpack the download and copy the .jar into the
    <code class="filename">openidm/bundle</code> directory.
   </p><div class="screen"><pre>$ cp mysql-connector-java-<em><strong>version</strong></em>-bin.jar \
 /path/to/openidm/bundle/</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="install-sample-audit"></a>3.17.3.&nbsp;Install the Sample</h3></div></div></div><p>Prepare OpenIDM as described in <a class="xref" href="#preparing-openidm" title="3.1.2.&nbsp;Preparing OpenIDM">Section&nbsp;3.1.2, &#8220;Preparing OpenIDM&#8221;</a>,
    then start OpenIDM with the configuration for the audit sample.</p><div class="screen"><pre>$ cd /path/to/openidm
$ ./startup.sh -p samples/audit-sample</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="run-sample-audit"></a>3.17.4.&nbsp;Running the Sample</h3></div></div></div><p>Run reconciliation over the REST interface.</p><div class="screen"><pre>$ curl \
    --cacert self-signed.crt \
    --header "X-OpenIDM-Username: openidm-admin" \
    --header "X-OpenIDM-Password: openidm-admin" \
    --header "Content-Type: application/json" \
    --request POST \
    "https://localhost:8443/openidm/recon?_action=recon&amp;mapping=systemXmlfileAccounts_managedUser&amp;waitForCompletion=true"
   </pre></div><p>
    Alternatively, open the
    <code class="filename">schedule-reconcile_systemXmlAccounts_managedUser.json</code>
    file in the <code class="literal">/path/to/openidm/samples/audit-sample/conf</code>
    directory and change the value of the <code class="literal">"enabled"</code> directive
    to turn on scheduled reconciliation:
   </p><div class="screen"><pre>"enabled" : true,</pre></div><p>
    You can now review the results in the MySQL database, from the MySQL prompt,
    using the commands described earlier.
   </p><p>
    If you have retained the default <code class="literal">"useForQueries" : true</code>
    option in the <code class="filename">conf/audit.json</code> file, you can also
    <code class="literal">GET</code> the same data with a REST call. For examples on how
    you can query reconciliation, activity, and synchronization audit logs,
    see relevant sections of the
    <a href="../integrators-guide/index.html#chap-synchronization" class="link">
     <em class="citetitle">Configuring Synchronization</em></a>. For more
    information on <code class="literal">"useForQueries"</code>, see
    <a href="../integrators-guide/index.html#audit-remote-logging" class="link"><em class="citetitle">Logging
    to a Remote System</em></a>.
   </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sample-google-connector"></a>3.18.&nbsp;Sample - Connecting to Google With the Google Apps Connector</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#google-apps-">3.18.1. Before You Start</a></span></dt><dt><span class="section"><a href="#running-the-google-apps-sample">3.18.2. Running the Google Apps Sample</a></span></dt></dl></div><a class="indexterm" name="d4757e5884"></a><p>
   OpenICF 1.4.1.0 provides a new Google Apps Connector that
   enables you to interact with Google's web applications.
  </p><div class="note"><h3 class="title">Note</h3><p>
    The Google Apps Connector, and this corresponding sample, are provided only
    with <a class="link" href="http://www.forgerock.com/download-stack/" target="_blank">OpenIDM
    Enterprise</a>.
   </p></div><p>
   This sample demonstrates the creation of users and groups on an external
   Google system, using OpenIDM's REST interface.
  </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="google-apps-"></a>3.18.1.&nbsp;Before You Start</h3></div></div></div><p>
    This sample requires that you have a Google Apps account. Obtaining a Google
    Apps account is described in the <a class="link" href="https://support.google.com/a/answer/53926?hl=en" target="_blank">Google
    documentation</a>. The sample uses OAuth2 to authorize the connection to
    the Google service. This authorization mechanism requires that you obtain a
    refresh token from Google. The following steps indicate how to obtain the
    refresh token. 
   </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
      Log in to your Google Apps Admin Console (at
      <code class="literal">https://www.google.com/a/<em class="replaceable"><code>domain-name</code></em></code>)
      and verify that the following APIs are enabled:
     </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        Admin SDK API
       </p></li><li class="listitem"><p>
        Enterprise License Manager API
       </p></li></ul></div></li><li class="step"><p>
      Use the OAuth 2.0 Installed Application flow to obtain a
      <code class="filename">client_secrets.json</code> file. For more information
      about the OAuth 2.0 Installed Application flow, see the corresponding
      <a class="link" href="https://developers.google.com/maps-engine/documentation/oauth/installedapplication" target="_blank">Google
      documentation</a>.
     </p></li><li class="step"><p>
      Download the Google Admin Directory API client library
      (<a class="link" href="https://developers.google.com/resources/api-libraries/download/admin/directory_v1/java" target="_blank">google-api-services-admin-directory_v1-rev42-java-1.19.0.zip</a>)
      and extract it to a writeable directory.
     </p><div class="screen"><pre><strong>$ unzip ~/Downloads/google-api-services-admin-directory_v1-rev42-java-1.19.0.zip -d /path/to</strong>
<em>Archive:  ~/Downloads/google-api-services-admin-directory_v1-rev42-java-1.19.0.zip
   creating: /path/to/admin/
 extracting: /path/to/admin/google-api-services-admin-directory_v1-rev42-1.19.0.jar
 extracting: /path/to/admin/google-api-services-admin-directory_v1-rev42-1.19.0-javadoc.jar
...</em></pre></div></li><li class="step"><p>
      Download the Google Apps connector jar and copy it to the
      <code class="literal">admin</code> directory, created in the previous step.
     </p><div class="screen"><pre><strong>$ cp ~/Downloads/googleapps-connector-1.4.1.0.jar /path/to/admin</strong></pre></div></li><li class="step"><p>
      Change to the <code class="literal">admin</code> directory and run the following
      command on the <code class="filename">client_secrets.json</code> file that you
      obtained earlier in this procedure.
     </p><div class="screen"><pre><strong>$ cd admin/
$ java -jar googleapps-connector-1.4.0.0.jar /path/to/client_secrets.json</strong>
<em>Please open the following address in your browser:
https://accounts.google.com/o/oauth2/auth?
access_type=offline
...</em></pre></div><p>
      This command opens the default browser, and loads a screen on which you
      authorize consent to access the Google Apps account.
     </p><div class="tip"><h3 class="title">Tip</h3><p>
       If you have recently created your Google Apps account, it might take some
       time (often two hours or more) to synchronize the data required for this
       access request to work.
      </p></div></li><li class="step"><p>
      When you have authorized consent, the browser returns a code. Copy and
      paste the code into the terminal from which you ran the original command.
     </p><div class="screen"><pre><em>Attempting to open that address in the default browser now...
Please enter code:</em><strong>XXXXXXXX</strong></pre></div><p>
      A response similar to the following is returned:
     </p><div class="screen"><pre><em>{
    "clientId" : "5x4x3x4x0x8x-cxlx3xsxcx8xixlxmx3x0xrxgx7x6x3x.apps.googleusercontent.com",
    "clientSecret" : "0xhx9xrx8xdxqx9xDxjxUx3x",
    "refreshToken" : "1x7xmxfx_yxuxNxUxFxjxVxVxkxXx3XxHxMxYxzx5xcxI"
}</em></pre></div></li><li class="step"><p>
      Use the information in this response to edit the
      <code class="literal">"configurationProperties"</code> in the Google Apps
      provisioner configuration file
      (<code class="filename">samples/google-connector/conf/provisioner.openicf-google.json</code>).
      For example:
     </p><pre class="brush: javascript;">"configurationProperties": {
    "domain": "example.com",
    "clientId": "5x4x3x4x0x8x-cxlx3xsxcx8xixlxmx3x0xrxgx7x6x3x.apps.googleusercontent.com",
    "clientSecret": "0xhx9xrx8xdxqx9xDxjxUx3x",
    "refreshToken": "1x7xmxfx_yxuxNxUxFxjxVxVxkxXx3XxHxMxYxzx5xcxI"
},   </pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="running-the-google-apps-sample"></a>3.18.2.&nbsp;Running the Google Apps Sample</h3></div></div></div><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
      To run the sample, start OpenIDM with the configuration for the Google
      Apps Connector.
     </p><div class="screen"><pre><strong>$ cd /path/to/openidm
$ ./startup.sh -p samples/google-connector</strong>
<em>Executing ./startup.sh...
Using OPENIDM_HOME:   /path/to/openidm
Using OPENIDM_OPTS:   -Xmx1024m -Xms1024m
Using LOGGING_CONFIG: -Djava.util.logging.config.file=/path/to/openidm/conf/logging.properties
Using boot properties at /path/to/openidm/samples/google-connector/conf/boot/boot.properties
OpenIDM version "3.1.0" (revision: 0) null null
-&gt; OpenIDM ready</em>
     </pre></div></li><li class="step"><p>
      To verify the connector configuration, check the status of the Google Apps
      connector as follows:
     </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 "https://localhost:8443/openidm/system/google?_action=test"</strong>
<em>{
    "name":"google",
    "enabled":true,
    "config":"config/provisioner.openicf/google",
    "connectorRef": {
        "connectorName":"org.forgerock.openicf.connectors.googleapps.GoogleAppsConnector",
        "bundleName":"org.forgerock.openicf.connectors.googleapps-connector",
        "bundleVersion":"[1.4.0.0,2.0.0.0)"
    },
    "ok":true
}</em></pre></div></li><li class="step"><p>
      To test that the connector is working, create, update, and read a user and
      group entry on the Google resource, over REST.
     </p><div class="note"><h3 class="title">Note</h3><p>
       When creating resources for Google, note that the equals
       (<code class="literal">=</code>) character cannot be used in any attribute value.
      </p></div><p>
      The following command creates an entry for user <code class="literal">Sam Carter</code>:
     </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 --data '{
  "__NAME__": "samcarter@example.com",
  "__PASSWORD__"  : "password",
  "givenName" : "Sam",
  "familyName": "Carter",
  "agreedToTerms": true,
  "changePasswordAtNextLogin" : false
 }' \
 "https://localhost:8443/openidm/system/google/__ACCOUNT__?_action=create" \
</strong>
<em>{
    "phones":null,
    "givenName":"Sam",
    "familyName":"Carter",
    "thumbnailPhotoUrl":null,
    "addresses":null,
    "__NAME__":"samcarter@example.com",
    "changePasswordAtNextLogin":false,
    "suspensionReason":null,
    "aliases":null,
    "customerId":"Cwev45or",
    "isDelegatedAdmin":false,
    "lastLoginTime":["1970-01-01T00:00:00.000Z"],
    "agreedToTerms":true,
    "deletionTime":null,
    "isAdmin":false,
    "creationTime":["2014-09-23T18:54:19.000Z"],
    "ims":null,
    "organizations":null,
    "ipWhitelisted":false,
    "fullName":"Sam Carter",
    "includeInGlobalAddressList":true,
    "isMailboxSetup":false,
    "externalIds":null,
    "suspended":false,
    "nonEditableAliases":null,
    "orgUnitPath":"/",
    "relations":null,
    "emails": [
        {
            "address":"samcarter@example.com",
            "primary":true
        }
    ],
    "_id":"101643010677712061243",
    "_rev":"\"SHoRIPAZisvsSqsLJr3m3XS9Uw4/RfZOwrjqrpRsO6PCGNfEp2H00Ds\""
}</em></pre></div></li><li class="step"><p>
      Update the user's phone number by sending a PUT request with the updated
      data, and specifying the user ID in the request, for example:
     </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request PUT \
 --data '{
  "__NAME__": "samcarter@example.com",
  "__PASSWORD__"  : "password",
  "givenName" : "Sam",
  "familyName": "Carter",
  "agreedToTerms": true,
  "changePasswordAtNextLogin" : false
  "phones" :
   [
    {
     "value": "1234567890",
     "type": "home"
    },
    {
     "value": "0987654321",
     "type":"work"
    }
   ]
  }' \
 "https://localhost:8443/openidm/system/google/__ACCOUNT__/101643010677712061243"</strong></pre></div><p>
      The response returns the complete user object, with the updated phone
      numbers.
     </p></li><li class="step"><p>
      Read the user entry from the Google resource:
     </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "If-None-Match" : "*" \
 --request GET \
 "https://localhost:8443/openidm/system/google/__ACCOUNT__/101643010677712061243"</strong>
<em>{
    "phones":
        [
            {"value":"1234567890","type":"home"},
            {"value":"0987654321","type":"work"}
        ],
    "givenName":"Sam",
    "familyName":"Carter",
...
    "_id":"101643010677712061243",
    "_rev":"\"SHoRIPAZisvsSqsLJr3m3XS9Uw4/RfZOwrjqrpRsO6PCGNfEp2H00Ds\""
}</em>     </pre></div></li><li class="step"><p>
      Create a group entry on the Google resource.
     </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 --data '{
  "__NAME__": "testGroup@example.com",
  "__DESCRIPTION__": "Group used for google-connector sample.",
  "name": "TestGroup"
 }' \
 "https://localhost:8443/openidm/system/google/__GROUP__?_action=create"
 </strong>
<em>{
 "__DESCRIPTION__": "Group used for google-connector sample.",
 "directMembersCount": 0,
 "nonEditableAliases": null,
 "aliases": null,
 "adminCreated": true,
 "name": "TestGroup",
 "__NAME__": "testGroup@example.com",
 "_id": "03oy7u291s3qw1i",
 "_rev": "\"SHoRIPAZisvsSqsLJr3m3XS9Uw4/8JZsrHGxtdaH4sF8vgzLiPmPqFs\""
}</em></pre></div></li><li class="step"><p>
      Add the user Sam Carter, that you created previously, to the test group.
      Include the <code class="literal">_id</code> that was generated in the user creation
      step in the request URL.
     </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request PUT \
 --data '{
  "groupKey" : "03oy7u291s3qw1i",
  "role": "MEMBER",
  "__NAME__": "samcarter@example.com",
  "email": "samcarter@example.com",
  "type": "MEMBER"
 }' \
 "https://localhost:8443/openidm/system/google/Member/101643010677712061243"
 </strong>
<em>{
    "role": "MEMBER",
    "type": "USER",
    "email": "samcarter@example.com",
    "__NAME__": "03oy7u291s3qw1i/samcarter@example.com",
    "groupKey": "109384837631312225274",
    "_id": "014ykbeg40r6x06/samcarter@example.com",
    "_rev": "\"SHoRIPAZisvsSqsLJr3m3XS9Uw4/GiZLiMKb3U62M58IabSzPKAVIOE\""
}</em></pre></div></li><li class="step"><p>
      Read the group entry by specifying the group <code class="literal">_id</code> in the
      request URL. Notice that the group has one member
      (<code class="literal">"directMembersCount": 1</code>).
     </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/system/google/__GROUP__/03oy7u291s3qw1i"
 </strong>
<em>{
    "__DESCRIPTION__": "Group used for google-connector sample.",
    "directMembersCount": 1,
    "nonEditableAliases": [
        "googleAppsTestGroup@example.com.test-google-a.com"
    ],
    "aliases": null,
    "adminCreated": true,
    "name": "TestGroup",
    "__NAME__": "testGroup@example.com",
    "_id": "03oy7u291s3qw1i",
    "_rev": "\"SHoRIPAZisvsSqsLJr3m3XS9Uw4/WcZC54etzuPtruE7uByf9NQ82Ow\""
}</em></pre></div></li><li class="step"><p>
      Delete the group entry.
     </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json"
 --request DELETE \
 "https://localhost:8443/openidm/system/google/__GROUP__/03oy7u291s3qw1i"
 </strong>
<em>{
    "_id": "03oy7u291s3qw1i"
}</em></pre></div><p>
      The delete request returns the group ID.
     </p></li><li class="step"><p>
      Delete the user Sam Carter, to return the Google system to its original
      state.
     </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request DELETE \
 "https://localhost:8443/openidm/system/google/__ACCOUNT__/101643010677712061243" </strong>
<em>{
    "_id":"101643010677712061243"
}</em></pre></div></li></ol></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sample-salesforce-connector"></a>3.19.&nbsp;Sample - Connecting to Salesforce With the Salesforce Connector</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#salesforce-setup">3.19.1. Before you Start</a></span></dt><dt><span class="section"><a href="#install-sample-salesforce">3.19.2. Install the Sample</a></span></dt><dt><span class="section"><a href="#salesforce-sample-ui">3.19.3. Running the Sample by Using the Admin UI</a></span></dt><dt><span class="section"><a href="#salesforce-sample-cli">3.19.4. Running the Sample by Using the Command Line</a></span></dt></dl></div><a class="indexterm" name="d4757e6122"></a><p>
   OpenIDM 3.1.0 provides a Salesforce Connector that enables
   provisioning, reconciliation, and synchronization with a Salesforce
   organization. The Salesforce Connector is not an OpenICF connector, but a
   separate OpenIDM module, based on the ForgeRock Common Resource API.
  </p><div class="note"><h3 class="title">Note</h3><p>
    The Salesforce Connector, and this corresponding sample, are provided only
    with <a class="link" href="http://www.forgerock.com/download-stack/" target="_blank">OpenIDM
    Enterprise</a>.
   </p></div><p>
   This sample demonstrates the creation and update of users from OpenIDM to
   Salesforce, and from Salesforce to OpenIDM. You can use either the Admin UI,
   or the command line to run this sample. Both methods are outlined in the
   sections that follow.
  </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="salesforce-setup"></a>3.19.1.&nbsp;Before you Start</h3></div></div></div><p>
    This sample requires that you have a Salesforce account, and a Connected
    App with OAuth enabled. For more information about Connected Apps, see the
    <a class="link" href="http://help.salesforce.com/apex/HTViewHelpDoc?id=connected_app_overview.htm" target="_top">Connected
    Apps Overview</a> in the Salesforce documentation.
   </p><div class="procedure"><p>
      To set up a Connected App for OpenIDM, follow these steps:
     </p><ol class="procedure" type="1"><li class="step"><p>
       Log in to <a class="link" href="http://salesforce.com" target="_top">salesforce.com</a>
       with your Salesforce credentials.
      </p></li><li class="step"><p>
       Click <span class="emphasis"><em>Setup</em></span> in the top right corner.
      </p></li><li class="step"><p>
       In the left hand menu, under <span class="emphasis"><em>Build</em></span>, expand the
       <span class="emphasis"><em>Create</em></span> item and click <span class="emphasis"><em>Apps</em></span>.
      </p></li><li class="step"><p>
       On the right hand panel, scroll down to <span class="emphasis"><em>Connected Apps</em></span>
       and click <span class="emphasis"><em>New</em></span>.
      </p></li><li class="step"><p>
       In the <span class="emphasis"><em>New Connected App</em></span> panel, enter the following
       Basic Information:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
         <span class="emphasis"><em>Connected App Name</em></span>. Enter a name that you will
         recognize as the OpenIDM App, for example, <code class="literal">OpenIDM</code>.
        </p></li><li class="listitem"><p>
         <span class="emphasis"><em>API Name</em></span>. This field defaults to the Connected
         App Name, but you can change it. Note that the Application API Name can
         only contain underscores and alphanumeric characters. The name must be
         unique, begin with a letter, not include spaces, not end with an
         underscore, and not contain two consecutive underscores.
        </p></li><li class="listitem"><p>
         <span class="emphasis"><em>Contact Email</em></span>. Enter the email address of the
         person responsible for this Connected App within your organization.
        </p></li></ul></div></li><li class="step"><p>
       Select <span class="emphasis"><em>Enable OAuth Settings</em></span> and enter the following
       information:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
         <span class="emphasis"><em>Callback URL</em></span>. Enter the OpenIDM URL, to which the
         requested OAuth token will be sent, for example
         <code class="literal">https://localhost:8443/admin/oauth.html</code>.
        </p></li><li class="listitem"><p>
         <span class="emphasis"><em>Selected OAuth Scopes</em></span>. Click the
         <span class="emphasis"><em>Add</em></span> button to add the following
         <span class="emphasis"><em>Available Auth Scopes</em></span> to the
         <span class="emphasis"><em>Selected OAuth Scopes</em></span> column:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
           Access and manage your data
          </p></li><li class="listitem"><p>
           Access your basic information
          </p></li><li class="listitem"><p>
           Perform requests on your behalf at any time
          </p></li></ul></div><div class="mediaobject" align="center"><a name="new-app-data"></a><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/new-app-data.png" align="middle" height="360" alt="New connected app data"></td></tr></table></div><p>
         You can leave the remaining fields blank.
        </p></li></ul></div></li><li class="step"><p>
       Click <span class="emphasis"><em>Save</em></span> to create the new Connected App.
      </p></li><li class="step"><p>
       The next window displays your new Connected App.
      </p><p>
       Under the <span class="emphasis"><em>API (Enable OAuth Settings)</em></span> item, the
       Consumer Key and a link to the Consumer Secret are displayed.
      </p><p>
       Click the link to reveal the Consumer Secret.
      </p><div class="mediaobject" align="center"><a name="consumer-key"></a><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/consumer-key.png" align="middle" height="360" alt="Connected app consumer key and secret"></td></tr></table></div><p>
       OpenIDM requires the Consumer Key and Secret to obtain an access token
       and a refresh token for access to salesforce.com.
      </p><p>
       Copy and paste both the key and the secret into a file for use when you
       set up the sample.
      </p></li><li class="step"><p>
       To demonstrate the reconciliation of users from Salesforce to OpenIDM,
       your Salesforce organization should contain at least a few users. Add
       these users now if your Salesforce organization is empty.
      </p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="install-sample-salesforce"></a>3.19.2.&nbsp;Install the Sample</h3></div></div></div><p>
    Prepare OpenIDM as described in <a class="xref" href="#preparing-openidm" title="3.1.2.&nbsp;Preparing OpenIDM">Section&nbsp;3.1.2, &#8220;Preparing OpenIDM&#8221;</a>, then
    start OpenIDM with the configuration for the Salesforce sample.
   </p><div class="screen"><pre>$ cd /path/to/openidm
$ ./startup.sh -p samples/salesforce-connector</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="salesforce-sample-ui"></a>3.19.3.&nbsp;Running the Sample by Using the Admin UI</h3></div></div></div><p>
    The Admin UI is the recommended way to test this sample.
   </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
      Log in to the Admin UI at the URL
      <code class="literal">https://localhost:8443/admin</code> as the default
      administrative user (<code class="literal">openidm-admin</code>) with password
      <code class="literal">openidm-admin</code>.
     </p><p>
      The first time you log into the Admin UI, you are prompted to change your
      password. If you do not want to change your password at this time, simply
      click X to close this window, and continue with the sample.
     </p><p>
      The Resources tab shows the Salesforce connector, which is currently
      disabled.
     </p><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/salesforce-connector.png" align="middle" height="360" alt="Resources tab showing disabled Salesforce connector"></td></tr></table></div></li><li class="step"><p>
      Enable the Salesforce connector by completing the authentication details
      as follows. You will need the Consumer Key and Consumer Secret that you
      obtained in the previous section.
     </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        Click on the Salesforce connector to open the Edit Connector dialog.
       </p></li><li class="listitem"><p>
        Select True from the Enabled list.
       </p></li><li class="listitem"><p>
        Select Salesforce Connector from the Connector Type list.
       </p></li><li class="listitem"><p>
        Under Basic Connector Details select the Sandbox URL (for the purposes
        of testing the sample) and enter the Connector Key and Secret that you
        obtained in the previous section.
       </p></li><li class="listitem"><p>
        You can leave the default LiveSync details for now. Click Update to
        update the connector configuration.
       </p><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/edit-sf-connector.png" align="middle" height="360" alt="Editing the Salesforce connector"></td></tr></table></div></li><li class="listitem"><p>
        On the permission request screen click Allow, to enable OpenIDM to
        access your Salesforce Connected App.
       </p><div class="note"><h3 class="title">Note</h3><p>
         In the current OpenIDM release, an issue is occasionally seen where the
         system appears to time out while retrieving the refresh token from
         Salesforce, at this stage. If this happens, refresh your browser and
         attempt the connector setup again.
        </p></div><p>
        On the Resources tab, your Salesforce Connector should now be Active.
       </p><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/active-sf-connector.png" align="middle" height="360" alt="Salesforce connector now active"></td></tr></table></div></li></ul></div></li><li class="step"><p>
      To test the reconciliation process, select the Mappings tab.
     </p><p>
      This tab shows two configured mappings, one from Salesforce to the OpenIDM
      repository (<code class="literal">managed/user</code>) and one from the OpenIDM
      repository to Salesforce.
     </p><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/salesforce-mappings.png" align="middle" height="360" alt="Mappings tab showing mappings for salesforce connector sample"></td></tr></table></div></li><li class="step"><p>
      Click anywhere on the first mapping and click Reconcile Now.
     </p><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/salesforce-reconcile.png" align="middle" height="360" alt="Mappings tab showing reconciliation for salesforce sample"></td></tr></table></div><p>
      The reconciliation operation creates the users that were present in your
      Salesforce organization in the OpenIDM repository.
     </p></li><li class="step"><p>
      Retrieve the users in the repository by clicking the User View link at the
      top right of the Admin UI.
     </p><p>
      This link opens the User View UI. If you did not change your password in
      the first step, you are prompted to change your password again. You can
      bypass this by simply clicking X to close the password prompt window.
     </p></li><li class="step"><p>
      Select the Users tab.
     </p><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/salesforce-users.png" align="middle" height="360" alt="Users tab showing the users in the repo for salesforce sample"></td></tr></table></div><p>
      The users from the Salesforce organization have been reconciled to the
      OpenIDM repository. If the reconciliation was successful, the list of
      users displayed here should reflect what was in your Salesforce
      organization.
     </p></li><li class="step"><p>
      To retrieve the details of a specific user, click that username on the
      Users tab.
     </p><p>
      The following image shows the details of user <code class="literal">bjensen</code>.
      Note the Linked Systems panel at the bottom of the image. This panel shows
      the corresponding user record in Salesforce.
     </p><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/salesforce-bjensen.png" align="middle" height="360" alt="User details for a specific user"></td></tr></table></div></li><li class="step"><p>
      To test the second mapping (from OpenIDM to Salesforce), update any user
      in the OpenIDM repository. For example, update Babs Jensen's username.
     </p></li><li class="step"><p>
      By default, <span class="emphasis"><em>implicit synchronization</em></span> is enabled for
      mappings <span class="emphasis"><em>from</em></span> the <code class="literal">managed/user</code>
      repository <span class="emphasis"><em>to</em></span> any external resource. This means that
      when you update a managed object, any mappings defined in the
      <code class="filename">sync.json</code> file that have the managed object as the
      source are automatically executed to update the target system. For more
      information, see <a href="../integrators-guide/index.html#synchronization-mappings-file" class="link"><em class="citetitle">Synchronization
      Mappings File</em></a> in the <span class="emphasis"><em>Integrator's
      Guide</em></span>.
     </p><p>
      To test that the implicit synchronization has been successful, look at
      Babs Jensen's record in the User View UI. At the bottom of the user
      profile, the Linked Systems panel indicates Babs Jensen's record in the
      Salesforce data store. Note the changed Username.
     </p><p>
      Alternatively, check the updated user record in Salesforce.
     </p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="salesforce-sample-cli"></a>3.19.4.&nbsp;Running the Sample by Using the Command Line</h3></div></div></div><p>
    Running the sample by using the command line is a little more complex. This
    section breaks the sample into two tasks - configuring the connector, and
    then testing the configuration by running reconciliation operations between
    the two systems.
   </p><div class="procedure"><a name="d4757e6446"></a><div class="procedure-title">Procedure&nbsp;3.10.&nbsp;To Set Up the Salesforce Connector</div><p>
    Before you start, you will need the Consumer Key and Consumer Secret that
    you obtained in the previous section.
   </p><ol class="procedure" type="1"><li class="step"><p>
      Obtain the refresh token from salesforce.com by pointing your browser to
      the following URL. Substitute your Consumer Key for
      <code class="literal">CLIENT_ID</code>. If OpenIDM is not running on the localhost,
      substitute the appropriate hostname and port number in the value of the
      <code class="literal">redirect_uri</code> parameter.
     </p><p>
<a class="link" href="https://login.salesforce.com/services/oauth2/authorize?response_type=code&amp;client_id=CLIENT_ID&amp;redirect_uri=https://localhost:8443/admin/oauth.html&amp;scope=id%20api%20refresh_token" target="_blank">https://login.salesforce.com/services/oauth2/authorize?response_type=code&amp;client_id=CLIENT_ID&amp;redirect_uri=https://localhost:8443/admin/oauth.html&amp;scope=id%20api%20refresh_token</a>
     </p></li><li class="step"><p>
      You are redirected to Salesforce, and prompted to give this application
      access to your Salesforce account. When you have given consent, you should
      receive a response URL that looks similar to the following:
     </p><div class="screen"><pre>https://localhost:8443/admin/index.html#connectors/edit//&amp;code=aPrxJZTK7Rs03PU634VK8Jn9o_U3ZY1ERxM7IiklFzbmVpZ1TTJlU1TiETXKhNHqpr4SlyCkpg%3D%3D</pre></div><p>
      The <code class="literal">&amp;code</code> part of this URL is an authorization
      code, that you need for the following step.
     </p><div class="caution"><h3 class="title">Caution</h3><p>
       Note that this authorization code expires after 10 minutes. If you do not
       complete the OAuth flow within that time, you will need to start this
       process again.
      </p></div></li><li class="step"><p>
      Copy the authorization code from the response URL and use it as the value
      of the <code class="literal">"code"</code> parameter in the following REST call. You
      will also need to supply your Consumer Key and Consumer Secret in this
      call.
     </p><div class="screen"><pre>$ <strong> curl \
 --verbose \
 --data "grant_type=authorization_code" \
 --data "client_id=<em><strong>consumer-key</strong></em>" \
 --data "client_secret=<em><strong>consumer-secret</strong></em>" \
 --data "redirect_uri=https://localhost:8443/admin/oauth.html" \
 --data "code=<em><strong>access-token-code</strong></em>" \
 "https://login.salesforce.com/services/oauth2/token"</strong>
<em>{
  "access_token": "00DS0000003K4fU!AQMAQOzEU.8tCjg8Wk79yKPKCtrtaszX5jrHtoT4NBpJ8x2NFZGjg3PNuc0TWq0EgiGS_mVkfg5f4pVN5uhXbmAx6hRyk80Z",
  "signature": "2uREX1lseXdg3Vng/2+Hrlo/KHOWYoim+poj74wKFtw=",
  "refresh_token": "5Aep861KIwKdekr90I4iHdtDgWwRoG7O_6uHrgJ.yVtMS0UaGxRqE6WFM77W7wCV4muVMgdqKjuWI2i5S6sjN2X",
  "token_type": "Bearer",
  "instance_url": "https://example-com.cs1.my.salesforce.com",
  "scope": "id api refresh_token",
  "issued_at": "1417182949781",
  "id": "https://login.salesforce.com/id/00DS0000003K4fUMAS/00530000009hWLcAAM"
}</em></pre></div><p>
      The output includes an <code class="literal">access_token</code> and a
      <code class="literal">refresh_token</code>. You will need the
      <code class="literal">refresh_token</code> in the following step.
     </p></li><li class="step"><p>
      Edit the <code class="literal">configurationProperties</code> in your Salesforce
      connector configuration file
      (<code class="filename">openidm/samples/salesforce-connector/conf/provisioner.salesforce-salesforce.json</code>)
      to include your Consumer Key (<code class="literal">clientID</code>), Consumer
      Secret (<code class="literal">clientSecret</code>), and refresh token.
     </p><p>
      In addition, set the <code class="literal">"instanceUrl"</code> to the value
      returned in the previous step, and set the <code class="literal">"enabled"</code>
      property to <code class="literal">true</code>.
     </p><p>
      The relevant excerpts of the <code class="filename">provisioner.salesforce-salesforce.json</code>
      file are as follows:
     </p><pre class="brush: plain;">{
    "name" : "salesforce",
    "enabled" : true,
    "connectorRef" : {
...
    "configurationProperties" : {
        "connectTimeout" : 120000,
        "loginUrl" : null,
        "idleCheckInterval" : 10000,
        "refreshToken" : "5Aep861KIwKdekr90I4iHdtDgWwRoG7O_6uHrgJ.yVtMS0UaGxRqE6WFM77W7wCV4muVMgdqKjuWI2i5S6sjN2X",
        "clientSecret" : "4850xxxxxxxxxxxxx425",
        "clientId" : "3MVG98dostKihXN7Is8Q0g5q1xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxPdB5f5ATwmaMuWxl",
        "instanceUrl" : "https://example-com.cs1.my.salesforce.com",
        "version" : 29
    }
... </pre></li><li class="step"><p>
      Check that your connector configuration is correct by testing the status
      of the connector, over REST.
     </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 "https://localhost:8443/openidm/system?_action=test"</strong>
<em>[
  {
    "ok": true,
    "connectorRef": {
      "bundleVersion": "2.0.29.2-SNAPSHOT",
      "systemType": "provisioner.salesforce",
      "displayName": "Salesforce Connector",
      "bundleName": "org.forgerock.openidm.salesforce",
      "connectorName": "org.forgerock.openidm.salesforce.Salesforce"
    },
    "objectTypes": [
      "User",
      "PermissionSet",
      "PermissionSetAssignment",
      "Profile",
      "PermissionSetLicenseAssign",
      "Organization",
      "PermissionSetLicense",
      "Group",
      "GroupMember"
    ],
    "config": "config/provisioner.salesforce/salesforce",
    "enabled": true,
    "name": "salesforce"
  }
]</em>
     </pre></div></li></ol></div><div class="procedure"><a name="d4757e6553"></a><div class="procedure-title">Procedure&nbsp;3.11.&nbsp;To Run Reconciliation by Using the Command Line</div><p>
     The mapping configuration file (<code class="filename">sync.json</code>) for this
     sample includes two mappings, <code class="literal">sourceSalesforceUser_managedUser</code>,
     which synchronizes users from the Salesforce with the OpenIDM repository,
     and <code class="literal">managedUser_sourceSalesforceUser</code>,
     which synchronizes changes from the OpenIDM repository to Salesforce.
    </p><ol class="procedure" type="1"><li class="step"><p>
      Reconcile the repository over the REST interface by running the following
      command:
     </p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 "https://localhost:8443/openidm/recon?_action=recon&amp;mapping=sourceSalesforceUser_managedUser&amp;waitForCompletion=true"</strong>
<em>{
  "state": "SUCCESS",
  "_id": "8a6281ef-6faf-43dd-af5c-3a842b38c468"
}</em></pre></div><p>
      The reconciliation operation returns a reconciliation run ID and the
      status of the operation. Reconciliation creates user objects from LDAP in
      the OpenIDM repository, assigning the new objects random unique IDs.
     </p></li><li class="step"><p>
      View the recon entry over REST for an indication of the actions that were
      taken on the OpenIDM repository.
     </p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/recon/8a6281ef-6faf-43dd-af5c-3a842b38c468"</strong>
<em>{
  "duration": 6447,
  "ended": "2014-11-28T15:01:38.399Z",
  "started": "2014-11-28T15:01:31.952Z",
  "parameters": {
    "null": false,
    "boolean": false,
    "number": false,
    "list": false,
    "object": {
      "targetQuery": {
        "_queryId": "query-all-ids",
        "resourceName": "managed/user"
      },
      "sourceQuery": {
        "_queryId": "query-all-ids",
        "resourceName": "system/salesforce/User"
      }
    },
    "pointer": {
      "empty": true
    },
    "transformers": [],
    "set": false,
    "map": true,
    "string": false,
    "collection": false,
    "wrappedObject": {
      "targetQuery": {
        "resourceName": "managed/user",
        "_queryId": "query-all-ids"
      },
      "sourceQuery": {
        "_queryId": "query-all-ids",
        "resourceName": "system/salesforce/User"
      }
    }
  },
  "_id": "8a6281ef-6faf-43dd-af5c-3a842b38c468",
  "mapping": "sourceSalesforceUser_managedUser",
  "state": "SUCCESS",
  "stage": "COMPLETED_SUCCESS",
  "stageDescription": "reconciliation completed.",
  "progress": {
    "links": {
      "created": 8,
      "existing": {
        "total": "0",
        "processed": 0
      }
    },
    "target": {
      "created": 8,
      "existing": {
        "total": "0",
        "processed": 0
      }
    },
    "source": {
      "existing": {
        "total": "9",
        "processed": 9
      }
    }
  },
  "situationSummary": {
    "FOUND_ALREADY_LINKED": 0,
    "UNASSIGNED": 0,
    "TARGET_IGNORED": 0,
    "SOURCE_IGNORED": 0,
    "MISSING": 0,
    "FOUND": 0,
    "AMBIGUOUS": 0,
    "UNQUALIFIED": 0,
    "CONFIRMED": 0,
    "SOURCE_MISSING": 0,
    "ABSENT": 9
  },
  "statusSummary": {
    "SUCCESS": 8,
    "FAILURE": 1
  }
}</em></pre></div><p>
      The output shows that eight entries were created on the target
      (<code class="literal">managed/user</code>).
     </p></li><li class="step"><p>
      You can display those users by querying the IDs in the managed/user
      repository.
     </p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/managed/user?_queryId=query-all-ids"</strong>
<em>{
  "remainingPagedResults": -1,
  "pagedResultsCookie": null,
  "resultCount": 8,
  "result": [
    {
      "_rev": "0",
      "_id": "f15322f2-5873-4e5f-a4e5-2d4bc03dd190"
    },
    {
      "_rev": "0",
      "_id": "85879c60-afa1-4425-8c7a-5cccbbaff587"
    },
    {
      "_rev": "0",
      "_id": "ed3fe655-29a6-4016-b6bc-4b2356911fd1"
    },
    {
      "_rev": "0",
      "_id": "34678464-c080-41b1-8da6-d5fde9d35aeb"
    },
    {
      "_rev": "0",
      "_id": "02d5da29-8349-4f35-affc-5f6c331307ef"
    },
    {
      "_rev": "0",
      "_id": "f91d6fce-bf27-4379-9411-fd626f8a9528"
    },
    {
      "_rev": "0",
      "_id": "6ace9220-59e7-4d97-8683-e03362a9150c"
    },
    {
      "_rev": "0",
      "_id": "56863eea-35d7-4aeb-a017-74ef28fd3116"
    }
  ]
</em></pre></div></li></ol></div></div></div></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-repository"></a>Chapter&nbsp;4.&nbsp;Installing a Repository For Production</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="section"><a href="#repository-mysql">4.1. To Set Up OpenIDM With MySQL</a></span></dt><dt><span class="section"><a href="#repository-mssql">4.2. To Set Up OpenIDM With MS SQL</a></span></dt><dt><span class="section"><a href="#repository-oracledb">4.3. To Set Up OpenIDM With Oracle Database</a></span></dt><dt><span class="section"><a href="#repository-postgresql">4.4. To Set Up OpenIDM With PostgreSQL</a></span></dt></dl></div><a class="indexterm" name="d4757e6608"></a><p>
  By default, OpenIDM uses OrientDB for its internal repository so that you do
  not have to install a database in order to evaluate OpenIDM. Before using
  OpenIDM in production, however, you must replace OrientDB with a supported
  JDBC repository.
 </p><p>
  OpenIDM 3.1.0 supports the use of <a class="link" href="http://dev.mysql.com/downloads/mysql/" target="_blank">MySQL</a>, MS SQL, PostgreSQL, and Oracle Database as
  internal repositories. For details of the supported versions, see <a href="../release-notes/index.html#chap-before-you-install" class="link"><em class="citetitle">Before You Install
  OpenIDM Software</em></a> in the
  <em class="citetitle">Release Notes</em>.
 </p><p>
  For information about the general JDBC repository configuration, and how to
  map OpenIDM objects to JDBC database tables, see <a href="../integrators-guide/index.html#chap-repo" class="link"><em class="citetitle">Managing the
  OpenIDM Repository</em></a> in the <em class="citetitle">Integrator's
  Guide</em>.
 </p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="repository-mysql"></a>4.1.&nbsp;To Set Up OpenIDM With MySQL</h2></div></div></div><div class="procedure"><p>
    After you have installed MySQL on the local host and <span class="emphasis"><em>before
    starting OpenIDM for the first time</em></span>, set up OpenIDM to use the
    new repository, as described in the following sections.
   </p><p>
    This procedure assumes that a password has already been set for the MySQL
    root user.
   </p><ol class="procedure" type="1"><li class="step"><p>
     Download <a class="link" href="http://dev.mysql.com/downloads/connector/j/5.1.html" target="_blank">MySQL
     Connector/J</a>, version 5.1 or later from the MySQL website. Unpack the
     delivery, and copy the .jar into the <code class="filename">openidm/bundle</code>
     directory.
    </p><div class="screen"><pre>
$ cp mysql-connector-java-<em><strong>version</strong></em>-bin.jar /path/to/openidm/bundle/
    </pre></div></li><li class="step"><p>
     Make sure that OpenIDM is stopped.
    </p><div class="screen"><pre>$ cd /path/to/openidm/
$ ./shutdown.sh
OpenIDM is not running, not stopping.
    </pre></div></li><li class="step"><p>
     Remove <code class="filename">openidm/conf/repo.orientdb.json</code>.
    </p><div class="screen"><pre>$ cd /path/to/openidm/conf/
$ rm repo.orientdb.json</pre></div></li><li class="step"><p>
    Copy <code class="filename">openidm/db/mysql/conf/repo.jdbc.json</code> to the
    <code class="filename">openidm/conf</code> directory.
   </p><div class="screen"><pre>$ cd /path/to/openidm
$ cp db/mysql/conf/repo.jdbc.json conf/</pre></div></li><li class="step"><a class="indexterm" name="d4757e6686"></a><p>
    Import the data definition language script for OpenIDM into MySQL.
   </p><div class="screen"><pre><strong>$ cd /path/to/mysql
$ ./bin/mysql -u root -p &lt; /path/to/openidm/db/mysql/scripts/openidm.sql</strong>
<em>Enter password:
$ </em></pre></div><p>This step creates an <code class="literal">openidm</code> database for use
   as the internal repository, and a user <code class="literal">openidm</code> with 
   password <code class="literal">openidm</code> who has all the required privileges to 
   update the database.</p><div class="screen"><pre><strong>$ ./bin/mysql -u root -p</strong>
<em>Enter password:
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 18
Server version: 5.5.19 MySQL Community Server (GPL)
...
mysql&gt; </em><strong>use openidm;</strong>
<em>Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed
mysql&gt; </em><strong>show tables;</strong>
<em>
+---------------------------+
| Tables_in_openidm         |
+---------------------------+
| auditaccess               |
| auditactivity             |
| auditrecon                |
| clusterobjectproperties   |
| clusterobjects            |
| configobjectproperties    |
| configobjects             |
| genericobjectproperties   |
| genericobjects            |
| internaluser              |
| links                     |
| managedobjectproperties   |
| managedobjects            |
| objecttypes               |
| schedulerobjectproperties |
| schedulerobjects          |
| security                  |
| securitykeys              |
| uinotification            |
+---------------------------+
19 rows in set (0.00 sec)</em></pre></div><p>The table names are similar to those used with OrientDB.</p></li><li class="step"><p>
    Update <code class="filename">openidm/conf/repo.jdbc.json</code> as necessary, to
    reflect your MySQL deployment.
   </p><pre class="brush: javascript;">"connection" : {
    "dbType" : "MYSQL",
    "jndiName" : "",
    "driverClass" : "com.mysql.jdbc.Driver",
    "jdbcUrl" : "jdbc:mysql://localhost:3306/openidm",
    "username" : "openidm",
    "password" : "openidm",
    "defaultCatalog" : "openidm",
    "maxBatchSize" : 100,
    "maxTxRetry" : 5,
    "enableConnectionPool" : true,
    "connectionTimeoutInMs" : 30000
},</pre></li></ol></div><p>
     When you have set up MySQL for use as the OpenIDM internal repository,
     start OpenIDM to check that the setup has been successful. After startup,
     you should see that <code class="literal">repo.jdbc</code> is
     <code class="literal">active</code>, whereas <code class="literal">repo.orientdb</code> is
     <code class="literal">unsatisfied</code>.
    </p><div class="screen"><pre><strong>
$ cd /path/to/openidm
$ ./startup.sh</strong>
<em>Using OPENIDM_HOME:   /path/to/openidm
Using OPENIDM_OPTS:   -Xmx1024m -Xms1024m
Using LOGGING_CONFIG:
-Djava.util.logging.config.file=/path/to/openidm/conf/logging.properties
Using boot properties at /path/to/openidm/conf/boot/boot.properties</em>
<strong>-&gt; scr list</strong>
<em>
Id   State          Name
[  19] [active       ] org.forgerock.openidm.config.starter
[  23] [active       ] org.forgerock.openidm.taskscanner
[   8] [active       ] org.forgerock.openidm.external.rest
[  12] [active       ] org.forgerock.openidm.provisioner.openicf.connectorinfoprovider
[  15] [active       ] org.forgerock.openidm.ui.simple
[   1] [active       ] org.forgerock.openidm.router
[  22] [active       ] org.forgerock.openidm.scheduler
[  14] [active       ] org.forgerock.openidm.restlet
[   7] [unsatisfied  ] org.forgerock.openidm.external.email
[  18] [unsatisfied  ] org.forgerock.openidm.repo.orientdb
[   6] [active       ] org.forgerock.openidm.sync
[   3] [active       ] org.forgerock.openidm.script
[   5] [active       ] org.forgerock.openidm.recon
[   2] [active       ] org.forgerock.openidm.scope
[  10] [active       ] org.forgerock.openidm.http.contextregistrator
[  20] [active       ] org.forgerock.openidm.config
[   0] [active       ] org.forgerock.openidm.audit
[  21] [active       ] org.forgerock.openidm.schedule
[  17] [active       ] org.forgerock.openidm.repo.jdbc
[  16] [active       ] org.forgerock.openidm.workflow
[  13] [active       ] org.forgerock.openidm.provisioner.openicf
[   4] [active       ] org.forgerock.openidm.managed
[   9] [active       ] org.forgerock.openidm.authentication
[  11] [active       ] org.forgerock.openidm.provisioner</em></pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="repository-mssql"></a>4.2.&nbsp;To Set Up OpenIDM With MS SQL</h2></div></div></div><div class="procedure"><p>
    These instructions are specific to MS SQL Server 2008 running on
    a local Windows 2008 Server R2 system. Adapt the instructions for your
    environment.
   </p><div class="itemizedlist"><p>
     When you install Microsoft SQL Server, note that OpenIDM has the following
     specific configuration requirements:
    </p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
      During the Feature Selection installation step, make sure that at least
      SQL Server Replication, Full Text Search, and Management Tools - Basic are
      selected.
     </p><p>
      These instructions require SQL Management Studio so make sure that you
      include Management Tools in the installation.
     </p></li><li class="listitem"><p>
      OpenIDM requires SQL Server authentication. During the MS SQL Server
      installation, make sure that you select SQL Server authentication (mixed
      mode) and not just Windows authentication.
     </p></li><li class="listitem"><p>
      TCP/IP must be enabled and configured for the correct IP address and port.
      To configure TCP/IP, follow these steps:
     </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
        Click Start &gt; All Programs &gt; MS SQL Server 2008 R2 &gt; Configuration Tools
        &gt; SQL Server Configuration Manager.
       </p></li><li class="listitem"><p>
        Expand the SQL Server Network Configuration item and select "Protocols
        for MSSQLSERVER".
       </p></li><li class="listitem"><p>
        Double click TCP/IP and select Enabled &gt; Yes.
       </p></li><li class="listitem"><p>
        Select the IP Addresses tab and set the addresses and ports on which the
        server will listen.
       </p><p>
        For this sample procedure, scroll down to IPAll and set TCP Dynamic
        Ports to 1433 (the default port for MS SQL).
       </p></li><li class="listitem"><p>
        Click Apply, then OK.
       </p></li><li class="listitem"><p>
        Restart MS SQL Server for the configuration changes to take effect. To
        restart the server, select SQL Server Services in the left pane, double
        click SQL Server (MSSQLSERVER) and click Restart.
       </p></li><li class="listitem"><p>
        If you have a firewall enabled, ensure that the port you configured in
        the previous step is open for OpenIDM to access MS SQL.
       </p></li></ol></div></li></ul></div><p>
    After you have installed MS SQL on the local host, install OpenIDM, if you
    have not already done so, but <span class="emphasis"><em>do not start</em></span> the OpenIDM
    instance. Import the data definition and set up OpenIDM to use the new
    repository, as described in the following steps.
   </p><ol class="procedure" type="1"><li class="step"><p>
     Use SQL Management Studio to import the data definition language script for
     OpenIDM into MS SQL.
    </p><ol type="a" class="substeps"><li class="step"><p>
       Click Start &gt; All Programs &gt; Microsoft SQL Server 2008 &gt; SQL Server
       Management Studio.
      </p></li><li class="step"><p>
       On the Connect to Server panel, under Server Type, select Database
       Engine. From the Authentication drop down list, select Windows
       Authentication. If needed,  log in as the current user (for
       example, Administrator).
      </p></li><li class="step"><p>
       Select File &gt; Open &gt; File and navigate to the OpenIDM data definition
       language script
       (<code class="filename">path\to\openidm\db\mssql\scripts\openidm.sql</code>).
       Click Open to open the file.
      </p></li><li class="step"><p>
       Click Execute to run the script.
      </p></li></ol></li><li class="step"><p>
     This step creates an <code class="literal">openidm</code> database for use as the
     internal repository, and a user <code class="literal">openidm</code> with password
     <code class="literal">Passw0rd</code> who has all the required privileges to update
     the database. You might need to refresh the view in SQL Server Management
     Studio to see the <code class="literal">openidm</code> database in the Object
     Explorer.
    </p><p>
     Expand Databases &gt; openidm &gt; Tables. You should see the OpenIDM tables in
     the openidm database, as shown in the following example:
    </p><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/sql-tables-2008.png" align="middle" height="360" alt="Default tables in the openidm MS SQL database"></td></tr></table></div><p>
     The table names are similar to those used with OrientDB.
    </p></li><li class="step"><p>
     OpenIDM requires an MS SQL driver that must be created from two separate
     JAR files. Create the driver as follows.
    </p><ol type="a" class="substeps"><li class="step"><p>
       Download the JDBC Driver 4.0 for SQL Server
       (<code class="filename">sqljdbc_4.0.2206.100_enu.exe</code>) from <a class="link" href="http://www.microsoft.com/en-us/download/details.aspx?id=11774" target="_top">
       Microsoft's download site</a>. The precise URL may vary, depending on
       your location.
      </p><p>
       Run the downloaded executable file; it should extract multiple files,
       include Java archive files, to a dedicated folder.
      </p><p>
       Extract the executable Java archive file
       (<code class="filename">sqljdbc4.jar</code>) from the dedicated folder, using
       7-zip or an equivalent file management application.
      </p><p>
       Copy the Java archive file to
       <code class="filename">openidm\db\scripts\mssql</code>.
      </p></li><li class="step"><p>
       Download the <code class="literal">bnd</code> Java archive file
       (<code class="filename">biz.aQute.bnd.jar</code>) that enables you to create OSGi
       bundles. The file can be downloaded from <a class="link" href="http://dl.dropbox.com/u/2590603/bnd/biz.aQute.bnd.jar" target="_top">http://dl.dropbox.com/u/2590603/bnd/biz.aQute.bnd.jar</a>.
       For more information about <code class="literal">bnd</code>, see <a class="link" href="http://www.aqute.biz/Bnd/Bnd" target="_top">http://www.aqute.biz/Bnd/Bnd</a>.
      </p><p>
       Copy the file to <code class="filename">openidm\db\mssql\scripts</code>.
      </p></li><li class="step"><p>
       Your <code class="filename">openidm\db\mssql\scripts</code> directory should now
       contain the following files:
      </p><div class="screen"><pre>
       biz.aQute.bnd.jar  openidm.sql  sqljdbc4.bnd  sqljdbc4.jar
       </pre></div></li><li class="step"><p>
       Bundle the two JAR files together with the following command:
      </p><div class="screen"><pre>
C:\&gt; cd \path\to\openidm\db\mssql\scripts
./&gt; java -jar biz.aQute.bnd.jar wrap -properties sqljdbc4.bnd sqljdbc4.jar
      </pre></div><p>
       This step creates a single <code class="literal">.bar</code> file, named
       <code class="filename">sqljdbc4.bar</code>.
      </p></li><li class="step"><p>
       Rename the <code class="filename">sqljdbc4.bar</code> file to
       <code class="filename">sqljdbc4-osgi.jar</code> and copy it to the
       <code class="filename">openidm\bundle</code> directory.
      </p><div class="screen"><pre>
./&gt; ren sqljdbc4.bar sqljdbc4-osgi.jar
./&gt; copy sqljdbc4-osgi.jar \path\to\openidm\bundle
      </pre></div></li></ol></li><li class="step"><p>
     Remove the default OrientDB repository configuration file
     (<code class="filename">openidm\conf\repo.orientdb.json</code>) from the
     configuration directory.
    </p><div class="screen"><pre>
C:\&gt; cd \path\to\openidm\conf\
.\&gt; del repo.orientdb.json
    </pre></div></li><li class="step"><p>
     Copy the repository configuration file for MS SQL
     (<code class="filename">openidm\db\mssql\conf\repo.jdbc.json</code>) to the
     configuration directory.
    </p><div class="screen"><pre>
C:\&gt; cd \path\to\openidm
.\&gt; cp db\mssql\conf\repo.jdbc.json conf\
    </pre></div></li><li class="step"><p>
     Update <code class="filename">openidm\conf\repo.jdbc.json</code> as necessary, to
     reflect your MS SQL deployment.
    </p><pre class="brush: javascript;">{
    "connection" : {
        "dbType" : "SQLSERVER",
        "jndiName" : "",
        "driverClass" : "com.microsoft.sqlserver.jdbc.SQLServerDriver",
        "jdbcUrl" : "jdbc:sqlserver://localhost:1433;instanceName=default;
                     databaseName=openidm;applicationName=OpenIDM",
        "username" : "openidm",
        "password" : "Passw0rd",
        "defaultCatalog" : "openidm",
        "maxBatchSize" : 100,
        "maxTxRetry" : 5,
        "enableConnectionPool" : true,
        "connectionTimeoutInMs" : 30000
    },
...</pre><p>
     Specifically, check that the port matches what you have configured in MS
     SQL.
    </p></li></ol></div><p>
   When you have completed the preceding steps, start OpenIDM to check that the
   setup has been successful. After startup, you should see that
   <code class="literal">repo.jdbc</code> is <code class="literal">active</code>, whereas
   <code class="literal">repo.orientdb</code> is <code class="literal">unsatisfied</code>.
  </p><div class="screen"><pre><strong>
C:&gt; cd \path\to\openidm
./&gt; startup.bat</strong>
   <em>
"Using OPENIDM_HOME:   \path\to\openidm"
"Using OPENIDM_OPTS:   -Xmx1024m -Xms1024m -Dfile.encoding=UTF-8"
"Using LOGGING_CONFIG:
-Djava.util.logging.config.file=\path\to\openidm\conf\logging.properties"
Using boot properties at \path\to\openidm\conf\boot\boot.properties
-&gt; scr list
Id   State          Name
...
[ 18] [unsatisfied ] org.forgerock.openidm.repo.orientdb
...
[ 17] [active      ] org.forgerock.openidm.repo.jdbc
...
   </em></pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="repository-oracledb"></a>4.3.&nbsp;To Set Up OpenIDM With Oracle Database</h2></div></div></div><p>
   When implementing an Oracle database for OpenIDM, confer with an Oracle DBA
   when creating the database schema, tables, and users. This section assumes
   that you have configured an Oracle Database with
   <a class="link" href="http://docs.oracle.com/cd/B28359_01/network.111/b28317/tnsnames.htm" target="_blank">
    <em class="citetitle">Local Naming Parameters (tnsnames.ora)</em> </a> and a
   service user for use by OpenIDM.
  </p><div class="procedure"><p>
   Import the OpenIDM schema using the data definition language script
   (<code class="filename">/path/to/openidm/db/oracle/scripts/openidm.sql</code>), as the
   appropriate schema owner user.
  </p><p>
   If you have created OpenIDM tables correctly, you should be able to
   query the <code class="literal">internaluser</code> table. The query should return two
   records (<code class="literal">openidm-admin</code> and <code class="literal">anonymous</code>).
   The output here has been formatted for legibility.
  </p><div class="screen"><pre>SQL&gt; select * from internaluser;

OBJECTID     openidm-admin
-----------------------------------------------------------------------------
REV          0
-----------------------------------------------------------------------------
PWD          openidm-admin
-----------------------------------------------------------------------------
ROLES        openidm-admin,openidm-authorized
-----------------------------------------------------------------------------

OBJECTID     anonymous
-----------------------------------------------------------------------------
REV          0
-----------------------------------------------------------------------------
PWD          anonymous
-----------------------------------------------------------------------------
ROLES        openidm-reg
-----------------------------------------------------------------------------</pre></div><p>
   Before you start OpenIDM, create an Oracle DB driver from two separate jar
   files and set up the OpenIDM repository configuration for Oracle DB, as
   follows:
  </p><ol class="procedure" type="1"><li class="step"><p>Download the Oracle JDBC driver for your Oracle DB version
    from <a class="link" href="http://www.oracle.com/technetwork/database/features/jdbc/index-091264.html" target="_blank">Oracle Technology Network</a> and place it in the
    <code class="filename">openidm/db/oracle/scripts</code> directory.</p><div class="screen"><pre>$ ls /path/to/openidm/db/oracle/scripts
ojdbc6_g.jar    openidm.sql
   </pre></div></li><li class="step"><p>
    Create a bind file and edit it to match the version information for your
    JDBC driver.
   </p><p>
    You can use the sample bind file located in
    <code class="filename">openidm/db/mssql/scripts</code>. Copy the bind file
    to the same location as the JDBC driver.
   </p><div class="screen"><pre>$ cd /path/to/openidm/db
$ cp mssql/scripts/sqljdbc4.bnd oracle/scripts
$ ls oracle/scripts
ojdbc6_g.jar    openidm.sql    sqljdbc4.bnd</pre></div><p>
    The JDBC driver version information for your driver is located
    in the <code class="literal">Specification-Version</code> property in the
    MANIFEST file of the driver.</p><div class="screen"><pre>$ cd /path/to/openidm/db/oracle/scripts
$ unzip -q -c ojdbc6_g.jar META-INF/MANIFEST.MF
...
Specification-Vendor: Sun Microsystems Inc.
Specification-Title: JDBC
Specification-Version: 4.0
...</pre></div><p>
    Edit the bind file to match the JDBC driver version.
   </p><div class="screen"><pre>$ more sqljdbc4.bnd
...
version=4.0
Export-Package: *;version=${version}
Bundle-Name: Oracle JDBC Driver 4.0 for SQL Server
Bundle-SymbolicName: Oracle JDBC Driver 4.0 for SQL Server
Bundle-Version: ${version}</pre></div></li><li class="step"><p>
    Download the <code class="literal">bnd</code> Java archive file
    (<code class="filename">biz.aQute.bnd.jar</code>) that enables you to create
    OSGi bundles. The file can be downloaded from
    <a class="link" href="http://dl.dropbox.com/u/2590603/bnd/biz.aQute.bnd.jar" target="_blank">http://dl.dropbox.com/u/2590603/bnd/biz.aQute.bnd.jar</a>.
    For more information about <code class="literal">bnd</code>, see
    <a class="link" href="http://www.aqute.biz/Bnd/Bnd" target="_blank">http://www.aqute.biz/Bnd/Bnd</a>.
   </p><p>
    Place the <code class="literal">bnd</code> Java archive file in the same
    directory as the JDBC driver, and the bind file.
   </p><div class="screen"><pre><strong>$ ls /path/to/openidm/db/oracle/scripts</strong>
biz.aQute.bnd.jar    ojdbc6_g.jar    openidm.sql    sqljdbc4.bnd</pre></div></li><li class="step"><p>
    Change to the directory in which the script files are located and run the
    following command to create the OSGi bundle.
   </p><div class="screen"><pre>$ cd /path/to/openidm/db/oracle/scripts
$ java -jar biz.aQute.bnd.jar wrap -properties sqljdbc4.bnd ojdbc6_g.jar
Dec 10, 2013 9:53:28 AM java.util.prefs.FileSystemPreferences$1 run
INFO: Created user preferences directory.
ojdbc6_g 984 0</pre></div><p>
    A new <code class="literal">.bar</code> file has now been created.
   </p><div class="screen"><pre><strong>$ ls</strong>
biz.aQute.bnd.jar  ojdbc6_g.bar  ojdbc6_g.jar  openidm.sql  sqljdbc4.bnd</pre></div></li><li class="step"><p>Move the <code class="literal">.bar</code> file to the
   <code class="literal">openidm/bundle</code> directory and rename it with a
   <code class="literal">.jar</code> extension. The actual name of the file is
   unimportant.</p><div class="screen"><pre>$ mv ojdbc6_g.bar /path/to/openidm/bundle/ojdbc6_g-osgi.jar</pre></div></li><li class="step"><p>
    Remove the default OrientDB configuration file
   (<code class="filename">openidm/conf/repo.orientdb.json</code>) from the
   configuration directory.
   </p><div class="screen"><pre>$ rm /path/to/openidm/conf/repo.orientdb.json</pre></div></li><li class="step"><p>Copy the OracleDB configuration file
   (<code class="filename">openidm/db/oracle/conf/repo.jdbc.json</code>) to the
   configuration directory.
   </p><div class="screen"><pre>$ cd /path/to/openidm
$ cp db/oracle/conf/repo.jdbc.json conf/</pre></div></li><li class="step"><p>
    Update <code class="filename">openidm/conf/repo.jdbc.json</code> as necessary,
    to reflect your OracleDB deployment. Specifically, edit the
    <code class="literal">jdbcUrl</code>,
    <code class="literal">username</code>, and <code class="literal">password</code> properties. For
    example:</p><pre class="brush: javascript;">"connection" : {
        "dbType" : "ORACLE",
        "jndiName" : "",
        "driverClass" : "oracle.jdbc.OracleDriver",
        "jdbcUrl" : "jdbc:oracle:thin:@//localhost:1521/openidm",
        "username" : "openidm",
        "password" : "password",
        "defaultCatalog" : "openidm",
        "maxBatchSize" : 100,
        "maxTxRetry" : 5,
        "connectionTimeoutInMs" : 30000
    },</pre></li></ol></div><div class="itemizedlist"><p>
    The following parameters relate to the Oracle database:
   </p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
     The <code class="literal">"dbType"</code> is <code class="literal">"ORACLE"</code>.
    </p></li><li class="listitem"><p>
     The <code class="literal">"driverClass"</code> is
     <code class="literal">"oracle.jdbc.OracleDriver"</code>.
    </p></li><li class="listitem"><p>
     The <code class="literal">"jdbcUrl"</code> corresponds to the URL of the Oracle DB
     listener, including the service name, based on your configured Local Naming
     Parameters (tnsnames.ora). It should be whatever is appropriate for your
     environment. Replace "openidm" with the service name from your TNS
     description.
    </p></li><li class="listitem"><p>
     The <code class="literal">"username"</code> and <code class="literal">"password"</code>
     corresponds to the credentials of the service user that connects from
     OpenIDM.
    </p></li><li class="listitem"><p>
     The <code class="literal">"defaultCatalog"</code> is used to generate queries
     appropriate to your OpenIDM schema in Oracle. It should match the user who
     "owns" the tables. If your schema owner was <code class="literal">"openidm"</code>,
     then the <code class="literal">"defaultCatalog"</code> should also be
     <code class="literal">"openidm"</code>. This will cause OpenIDM to generate queries
     such as <code class="literal">"SELECT objectid FROM openidm.internaluser"</code>.
    </p></li></ul></div><p>
     When you have set up OracleDB for use as the OpenIDM internal
     repository, start OpenIDM to check that the setup has been successful. On
     startup, a number of INFO messages are output, as the predefined queries
     are processed.
    </p><p>
     After startup, you should see that <code class="literal">repo.jdbc</code> is
     <code class="literal">active</code>, whereas <code class="literal">repo.orientdb</code> is
     <code class="literal">unsatisfied</code>.
    </p><div class="screen"><pre><strong>$ cd /path/to/openidm
$ ./startup.sh        </strong>
<em>Using OPENIDM_HOME:   /path/to/openidm
Using OPENIDM_OPTS:   -Xmx1024m -Xms1024m
Using LOGGING_CONFIG:
-Djava.util.logging.config.file=/path/to/openidm/conf/logging.properties
Using boot properties at /path/to/openidm/conf/boot/boot.properties
....</em>
<strong>-&gt; scr list</strong>
<em>   Id   State          Name
...
[   2] [unsatisfied  ] org.forgerock.openidm.repo.orientdb
...
[   3] [active       ] org.forgerock.openidm.repo.jdbc
...</em></pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="repository-postgresql"></a>4.4.&nbsp;To Set Up OpenIDM With PostgreSQL</h2></div></div></div><div class="note"><h3 class="title">Note</h3><p>
    The use of PostgreSQL as a repository is supported for Java 1.7 only.
   </p></div><p>
   This procedure assumes that PostgreSQL (version 9.3 or later) is installed
   and running on the local host.
  </p><p>
   <span class="emphasis"><em>Before starting OpenIDM for the first time</em></span>, set up
   OpenIDM to use a PostgreSQL repository, as described in the following
   procedure.
  </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
     OpenIDM includes a script
     (<code class="filename">path/to/openidm/db/postgresql/scripts/createuser.pgsql</code>)
     that sets up an <code class="literal">openidm</code> database and user, with a
     default password of <code class="literal">openidm</code>. The script also grants the
     appropriate permissions.
    </p><p>
     Edit this script if you want to change the password of the
     <code class="literal">openidm</code> user, for example:
    </p><div class="screen"><pre><strong>$ more /path/to/openidm/db/postgresql/scripts/createuser.pgsql</strong>
<em>create user openidm with password 'mypassword';
create database openidm encoding 'utf8' owner openidm;
grant all privileges on database openidm to openidm;</em></pre></div></li><li class="step"><p>
     Execute the <code class="literal">createuser.pgsql</code> script as follows:
    </p><div class="screen"><pre><strong>$ psql &lt; /path/to/openidm/db/postgresql/scripts/createuser.pgsql</strong>
<em>CREATE ROLE
CREATE DATABASE
GRANT</em></pre></div></li><li class="step"><p>
     Execute the <code class="literal">openidm.pgsql</code> script as the new
     <code class="literal">openidm</code> user that you created in the first step.
    </p><div class="screen"><pre><strong>$ psql -U openidm &lt; /path/to/openidm/db/postgresql/scripts/openidm.pgsql</strong>
<em>
CREATE SCHEMA
CREATE TABLE
CREATE TABLE
CREATE TABLE
CREATE INDEX
CREATE INDEX
...
START TRANSACTION
INSERT 0 1
INSERT 0 1
COMMIT
CREATE INDEX
CREATE INDEX</em></pre></div><p>
     Your database has now been initialized.
    </p></li><li class="step"><p>
     Remove the OrientDB repository configuration file from the OpenIDM
     configuration directory (<code class="filename">conf/repo.orientdb.json</code>).
    </p><div class="screen"><pre><strong>$ rm /path/to/openidm/conf/repo.orientdb.json</strong></pre></div></li><li class="step"><p>
     Copy the PostgreSQL repository configuration file
     (<code class="filename">openidm/db/postgres/conf/repo.jdbc.json</code>) to the
     configuration directory.
    </p><div class="screen"><pre><strong>$ cd /path/to/openidm
$ cp db/postgres/conf/repo.jdbc.json conf/</strong></pre></div></li><li class="step"><p>
     If you changed the password in step 1 of this procedure, edit the
     <code class="filename">repo.jdbc.json</code> file to set the value for the
     <code class="literal">"password"</code> field to whatever password you set for the
     <code class="literal">openidm</code> user. For example:
    </p><div class="screen"><pre><strong>$ more conf/repo.jdbc.json</strong>
<em>{
    "connection" : {
        "dbType" : "POSTGRESQL",
        "jndiName" : "",
        "driverClass" : "org.postgresql.Driver",
        "jdbcUrl" : "jdbc:postgresql://localhost:5432/openidm",
        "username" : "openidm",
        "password" : "mypassword",
...}</em></pre></div></li><li class="step"><p>
     PostgreSQL is now set up for use as the OpenIDM internal repository.
    </p><p>
     Start OpenIDM to check that the setup has been successful. After startup,
     you should see that <code class="literal">repo.jdbc</code> is
     <code class="literal">active</code>, whereas <code class="literal">repo.orientdb</code> is
     <code class="literal">unsatisfied</code>.
    </p><div class="screen"><pre><em>-&gt; OpenIDM ready</em>
<strong>scr list</strong>
<em>Id   State          Name
...
[   4] [unsatisfied  ] org.forgerock.openidm.repo.orientdb
...
[   3] [active       ] org.forgerock.openidm.repo.jdbc
...
-&gt;</em></pre></div></li><li class="step"><p>
     If you are using the default project configuration, run the
     <code class="literal">default_schema_optimization.pgsql</code> script to create the
     required indexes. The file includes extensive comments on the indexes
     that are being created.
    </p><div class="screen"><pre><strong>$ psql -U openidm &lt; /path/to/openidm/db/postgresql/scripts/default_schema_optimization.pgsql</strong>
<em>CREATE INDEX
CREATE INDEX
CREATE INDEX
CREATE INDEX
CREATE INDEX
CREATE INDEX</em></pre></div></li></ol></div></div></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-uninstall"></a>Chapter&nbsp;5.&nbsp;Removing and Moving OpenIDM Software</h1></div></div></div><a class="indexterm" name="d4757e7357"></a><p>This chapter shows you how to uninstall OpenIDM software and to move 
 an existing install to a different location.</p><div class="procedure"><a name="d4757e7362"></a><div class="procedure-title">Procedure&nbsp;5.1.&nbsp;To Remove OpenIDM Software</div><ol class="procedure" type="1"><li class="step"><p>Stop OpenIDM services if they are running, by entering
   <code class="literal">shutdown</code> at the <code class="literal">-&gt;</code> prompt either
   on the command line, or on the System Information tab of the Felix
   console.</p><div class="screen"><pre>-&gt; shutdown</pre></div></li><li class="step"><p>Remove the file system directory where you installed OpenIDM
   software.</p><div class="screen"><pre>$ rm -rf /path/to/openidm</pre></div></li><li class="step"><p>If you use a JDBC database for the internal repository, you can
   drop the <code class="literal">openidm</code> database.</p></li></ol></div><div class="procedure"><a name="d4757e7387"></a><div class="procedure-title">Procedure&nbsp;5.2.&nbsp;To Move OpenIDM Software</div><p>If you want to move OpenIDM to a different directory, you do not have 
 to uninstall and reinstall. To move an existing OpenIDM instance, follow these 
 steps:</p><ol class="procedure" type="1"><li class="step"><p>Shutdown OpenIDM, as described in <a href="../install-guide/index.html#stop-openidm" class="link">
     <em class="citetitle">To Stop the OpenIDM Services</em></a>.</p></li><li class="step"><p>Remove the <code class="filename">felix-cache</code> directory.</p><div class="screen"><pre>$ cd path/to/openidm
$ rm -rf felix-cache
     </pre></div></li><li class="step"><p>Move the files.</p><div class="screen"><pre>
$ mv path/to/openidm path/to/new-openidm</pre></div></li><li class="step"><p>Start OpenIDM in the new location.</p><div class="screen"><pre>$ cd path/to/new-openidm
$ ./startup.sh
     </pre></div></li></ol></div></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-upgrade"></a>Chapter&nbsp;6.&nbsp;Migrating to OpenIDM 3.1.0</h1></div></div></div><p>
  The migration process is largely dependent on your particular deployment and
  on the extent to which you have customized OpenIDM. We recommend that you
  engage ForgeRock services for help in migrating an existing deployment.
 </p><p>
  This process assumes that you are migrating a deployment from OpenIDM 3.0.0
  to OpenIDM 3.1.0. For documentation on migrating a deployment from OpenIDM
  2.1.0 to 3.0.0, see the following chapter from the OpenIDM 3.0.0 Installation
  Guide: <a class="link" href="http://docs.forgerock.org/en/openidm/3.0.0/install-guide#chap-upgrade" target="_blank"><em class="citetitle">Migrating to OpenIDM 3.0.0</em></a>.
 </p><p>
  The steps outlined in this section indicate how to preserve customizations,
  where possible, and take advantage of the new functionality offered in this
  release. However, you must be aware of the changes made in
  OpenIDM 3.1.0 that might affect your existing deployment.
  Therefore, before starting this process, see the <a href="../release-notes/index.html#chap-compatibility" class="link"><em class="citetitle">Compatibility
  chapter</em></a> in the Release Notes, and adjust your scripts and
  clients accordingly.
 </p><p>
  OpenIDM 3.1.0 introduces an Administrative UI (Admin UI), which you can use
  to define the overall system configuration. You may consider the Admin UI as
  an option, especially for less complex deployments. For information on the new
  Admin UI, see the following part of the Integrator's Guide:
  <a href="../integrators-guide/index.html#ui-admin" class="link"><em class="citetitle">Configuring
   OpenIDM from the Admin UI </em></a>.
 </p><div class="procedure"><p>
   To perform a basic migration to OpenIDM 3.1.0, follow these
   steps. For the purposes of this procedure, the path to the existing 3.0
   instance is defined as <code class="filename">/path/to/openidm-3.0</code>. The path to
   the new instance is defined as <code class="filename">/path/to/openidm-3.1</code>.
  </p><ol class="procedure" type="1"><li class="step"><p>
    Download and extract the OpenIDM 3.1.0 server.
   </p></li><li class="step"><p>
    Stop your existing OpenIDM 3.0.0 server, if it is running.
   </p><div class="screen"><pre>
$ cd /path/to/openidm-3.0
$ ./shutdown.sh
Stopping OpenIDM (81491)
   </pre></div></li><li class="step"><p>
    Back up your existing deployment by archiving the entire
    <code class="filename">openidm</code> directory.
   </p></li><li class="step"><p>
    On the OpenIDM 3.1.0 server, edit the
    <code class="filename">conf/boot/boot.properties</code> file to match any
    customizations that you made on your OpenIDM 3.0.0 server. Specifically,
    check the following elements:
   </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
      In OpenIDM 3.0.0, port numbers were specified in the
      <code class="filename">conf/boot/boot.properties</code> and
      <code class="filename">conf/config.properties</code> files. In OpenIDM 3.1, the
      HTTP, HTTPS, and mutual authentication ports are specified in the
      <code class="filename">conf/boot/boot.properties</code> file. If you changed the
      default ports in your OpenIDM 3.0 deployment, make sure
      that the corresponding ports are specified in this file.
     </p></li><li class="listitem"><p>
      Check that the keystore and truststore passwords match the current
      passwords for the keystore and truststore of your OpenIDM 3.0 deployment
     </p></li></ul></div><p>
    Depending on the level of customization you have made in your current
    deployment, it might be simpler to start with your OpenIDM 3.0
    <code class="filename">boot.properties</code> file, and copy all new settings from
    that file to the version associated with OpenIDM 3.1. However, as a best
    practice, we recommend that you keep all configuration customizations
    (including new properties and changed settings) in a single location in
    your configuration files. You can then copy and paste these changes as
    appropriate.
   </p></li><li class="step"><p>
    Copy the contents of your original <code class="literal">security/</code> folder to
    the new instance.
   </p><div class="screen"><pre>$ cd /path/to/openidm-3.1
$ cp -r /path/to/openidm-3.0/security .
   </pre></div><p>
    Make sure to modify the <code class="filename">boot.properties</code> file for your
    project to point to the relative location of your
    <code class="filename">keystore.jceks</code> and <code class="filename">truststore</code>
    security files.
   </p><p>
    For example, if your <code class="filename">security/</code> folder is located at
    <code class="filename">/path/to/openidm-3.1/myproject/security</code>, edit the
    <code class="filename">boot.properties</code> file as follows:
    </p><div class="screen"><pre><strong>$ less /path/to/openidm/myproject/conf/boot/boot.properties</strong>
<em>...
openidm.keystore.type=JCEKS
openidm.truststore.type=JKS
openidm.keystore.provider=
openidm.keystore.location=myproject/security/keystore.jceks
openidm.truststore.location=myproject/security/truststore</em></pre></div><p>
   </p><p>
    OpenIDM automatically prepends the locations of the
    <code class="filename">keystore.jceks</code> and <code class="filename">truststore</code>
    files with the installation directory.
   </p></li><li class="step"><p>
    Migrate any custom scripts or default scripts that you have modified to the
    directory with OpenIDM 3.1. In general, custom and customized scripts
    should be located in the <code class="filename">openidm-3.0/script</code> directory
    on the OpenIDM 3.0 deployment.
   </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
      For custom scripts, review the <a href="../release-notes/index.html#chap-compatibility" class="link"><em class="citetitle">Compatibility
      chapter</em></a> to ensure that the scripts will work as
      intended with the new version, then copy these scripts to the new
      instance. For example:
     </p><div class="screen"><pre>$ cd /path/to/openidm-3.1
$ cp /path/to/openidm-3.0/script/my-custom-script.js script/
     </pre></div></li><li class="listitem"><p>
      If you modified an existing OpenIDM 3.0 script, compare that modified
      script against the corresponding script in OpenIDM 3.1. If nothing
      has changed in the default script, check that your customizations will
      work as intended (by reviewing the <a href="../release-notes/index.html#chap-compatibility" class="link"><em class="citetitle">Compatibility
      chapter</em></a>) then copy the customized scripts to the new
      <code class="literal">openidm/script</code> directory. For example:
     </p><div class="screen"><pre>$ cd /path/to/openidm-3.1
$ cp /path/to/openidm-3.0/script/policy.js script/
     </pre></div></li><li class="listitem"><p>
      If a default script has changed since the 3.0 release, such as
      <code class="literal">linkedView.js</code>, copy the modified script to the
      <code class="filename">openidm-3.1/script</code> directory.
     </p><div class="screen"><pre>$ cd /path/to/openidm-3.0
$ cp bin/default/script/linkedView.js script/
     </pre></div><p>
      Check that your customizations will work as expected, then port your
      customizations to the new script in the
      <code class="filename">openidm-3.1/script</code> directory.
     </p></li></ul></div></li><li class="step"><p>
    Several changes have been made to the default configuration in OpenIDM
    3.1.0. Currently, there is no automated way to migrate a
    customized configuration to the new version. The following strategy is
    recommended:
   </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
      Start with the default 3.0.0 configuration.
     </p></li><li class="listitem"><p>
      For each configuration file that you have customized, use a file
      comparison tool such as the UNIX <span class="command"><strong>diff</strong></span> utility to assess
      the differences between your customized file and the 3.1.0
      file.
     </p></li><li class="listitem"><p>
      Based on the results of the <span class="command"><strong>diff</strong></span>, use either your
      existing file as a base and port the 3.1.0 changes to that file, or vice
      versa. Ultimately, you want to preserve your customizations but ensure
      that you are up to date with the latest default configuration. All files
      should end up in the <code class="filename">openidm-3.1/conf</code> directory.
     </p></li><li class="listitem"><p>
      Pay particular attention to the <code class="filename">conf/repo.jdbc.json</code>
      file in your existing deployment.
      If you have customized this file, make sure that these customizations are
      ported to the corresponding file in the 3.1.0 deployment. For example, if
      you have defined any new queries, add these queries to the
      OpenIDM 3.1 instance of the <code class="filename">repo.jdbc.json</code> file.
     </p></li></ul></div></li><li class="step"><p>
    Modify any customized provisioner configurations in your existing project to
    point to the new connectors that are provided with OpenIDM
    3.1.0. Specifically, check that the
    <code class="literal">"connectorRef"</code> properties reflect the new connectors, for
    example:
   </p><pre class="brush: javascript;">{
    "bundleName": "org.forgerock.openicf.connectors.ldap-connector",
    "bundleVersion": "[1.4.0.0,2.0.0.0)",
    "displayName": "LDAP Connector",
    "connectorName": "org.identityconnectors.ldap.LdapConnector"
}, </pre><p>
    Alternatively, copy the connector .jars from your existing installation into
    the <code class="literal">openidm/connectors/</code> folder of the new installation.
   </p><p>
    For more information, see <span class="olink"><em class="citetitle">Integration of
    OpenICF 1.4.0.0</em></span> in the <em class="citetitle">Compatibility</em>
    chapter of the <em class="citetitle">Release Notes</em>.
   </p></li><li class="step"><p>
    Complete the OpenIDM 3.1.0 installation, as described in the
    <a href="../install-guide/index.html#chap-install" class="link"><em class="citetitle">Installation
    chapter</em></a>.
   </p></li><li class="step"><p>
    Migrate your internal user data, managed objects, and reconciliation and
    audit data, if required.
   </p><p>
    When you migrate this data, note the following points:
   </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
      The way in which queries on system objects are constructed has changed.
      This includes correlation queries on system objects. For more information,
      see <a href="../integrators-guide/index.html#constructing-queries" class="link"><em class="citetitle">Constructing
      Queries</em></a> in the <em class="citetitle">Integrators Guide</em>.
     </p></li><li class="listitem"><p>
      The database schema has changed slightly for OpenIDM 3.1.0. The following
      tables have been added: <code class="literal">auditsync</code>.
     </p><p>
      The <code class="literal">reconaction</code> column has been added to the
      <code class="literal">auditrecon</code> table. The <code class="literal">userid</code> column
      has been added to the <code class="literal">auditaccess</code> table.
     </p></li></ul></div><p>
    Your data migration strategy might vary, depending on your repository. You
    can either migrate your existing 3.0.0 database, or start with a new
    3.1.0 database and import your existing data.
   </p><div class="itemizedlist"><p>
     To migrate an existing database:
    </p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
      Using the appropriate schema script from the new OpenIDM 3.1.0 instance
      (<code class="filename">/path/to/openidm-3.1/db/<em class="replaceable"><code>repo</code></em>/scripts/openidm.sql</code>),
      take the changes described above and apply them to your existing database.
     </p><p>
      Use the <code class="literal">--force</code> option in MySQL (or an equivalent
      option for your repository type) to create the new tables, then edit the
      <code class="literal">auditsync</code> table manually, to add the columns described
      previously.
     </p></li></ul></div><div class="itemizedlist"><p>
     To start with a new database:
    </p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
      Set up a clean repository, using the appropriate schema script from the
      new OpenIDM 3.1.0 instance
      (<code class="filename">/path/to/openidm-3.1/db/<em class="replaceable"><code>repo</code></em>/scripts/openidm.sql</code>).
     </p></li><li class="listitem"><p>
      Use a schema comparison tool and adjust the tables in your existing
      repository to match the schema in the new repository.
     </p></li><li class="listitem"><p>
      Export your existing data to the new repository.
     </p></li></ul></div></li><li class="step"><p>
    If you are using the UI, clear your browser cache after the migration.
    The browser cache contains files from the previous OpenIDM release, that
    might not be refreshed when you log into the new UI.
   </p></li><li class="step"><p>
    Start up OpenIDM 3.1.0.
   </p><div class="screen"><pre>$ cd /path/to/openidm-3.1
$ ./startup.sh
   </pre></div></li><li class="step"><p>
    Test that your existing clients and scripts are working as intended.
   </p></li></ol></div></div><div lang="en" class="glossary"><div class="titlepage"><div><div><h1 class="title"><a name="openidm-glossary"></a>OpenIDM Glossary</h1></div></div></div><dl><dt><span class="glossterm">JSON</span></dt><dd class="glossdef"><p>JavaScript Object Notation, a lightweight data interchange format 
  based on a subset of JavaScript syntax. For more information, see the 
  <a class="link" href="http://www.json.org" target="_blank">JSON</a> site.</p></dd><dt><span class="glossterm">JWT</span></dt><dd class="glossdef"><p>
   JSON Web Token. As noted in the <a class="link" href="http://self-issued.info/docs/draft-ietf-oauth-json-web-token.html" target="_blank">
   <em class="citetitle">JSON Web Token draft IETF Memo</em></a>,
   "JSON Web Token (JWT) is a compact URL-safe means of representing claims to
   be transferred between two parties." For OpenIDM, the JWT is associated
   with the <code class="literal">JWT_SESSION</code> authentication module.
  </p></dd><dt><span class="glossterm">managed object</span></dt><dd class="glossdef"><p>An object that represents the identity-related data managed by OpenIDM. 
  Managed objects are configurable, JSON-based data structures that OpenIDM 
  stores in its pluggable repository. The default configuration of a managed 
  object is that of a user, but you can define any kind of managed object, for 
  example, groups or roles.</p></dd><dt><span class="glossterm">mapping</span></dt><dd class="glossdef"><p>A policy that is defined between a source object and a target object 
  during reconciliation or synchronization. A mapping can also define a trigger 
  for validation, customization, filtering, and transformation of source and 
  target objects.</p></dd><dt><span class="glossterm">OSGi</span></dt><dd class="glossdef"><p>A module system and service platform for the Java programming language 
  that implements a complete and dynamic component model. For a good 
  introduction, see the <a class="link" href="http://www.osgi.org/About/WhyOSGi" target="_blank">OSGi</a> site. OpenIDM 
  services are designed to run in any OSGi container, but OpenIDM currently 
  runs in <a class="link" href="http://felix.apache.org/site/index.html" target="_blank">Apache Felix</a>.</p></dd><dt><span class="glossterm">reconciliation</span></dt><dd class="glossdef"><p>During reconciliation, comparisons are made between managed objects 
  and objects on source or target systems. Reconciliation can result in one 
  or more specified actions, including, but not limited to, synchronization.
  </p></dd><dt><span class="glossterm">resource</span></dt><dd class="glossdef"><p>An external system, database, directory server, or other source of 
  identity data to be managed and audited by the identity management system.
  </p></dd><dt><a name="gloss-rest"></a><span class="glossterm">REST</span></dt><dd class="glossdef"><p>Representational State Transfer. A software architecture style for 
  exposing resources, using the technologies and protocols of the World Wide Web. 
  REST describes how distributed data objects, or resources, can be defined and 
  addressed.
  </p></dd><dt><span class="glossterm">source object</span></dt><dd class="glossdef"><p>In the context of reconciliation, a source object is a data object on 
  the source system, that OpenIDM scans before attempting to find a 
  corresponding object on the target system. Depending on the defined mapping, 
  OpenIDM then adjusts the object on the target system (target object).</p></dd><dt><span class="glossterm">synchronization</span></dt><dd class="glossdef"><p>The synchronization process creates, updates, or deletes objects on a 
  target system, based on the defined mappings from the source system. 
  Synchronization can be scheduled or on demand.</p></dd><dt><span class="glossterm">system object</span></dt><dd class="glossdef"><p>A pluggable representation of an object on an external system. For 
  example, a user entry that is stored in an external LDAP directory is 
  represented as a system object in OpenIDM for the period during which 
  OpenIDM requires access to that entry.System objects follow the same 
  RESTful resource-based design principles as managed objects.</p></dd><dt><span class="glossterm">target object</span></dt><dd class="glossdef"><p>In the context of reconciliation, a target object is a data object on 
  the target system, that OpenIDM scans after locating its corresponding object 
  on the source system. Depending on the defined mapping, OpenIDM then adjusts 
  the target object to match the corresponding source object.</p></dd></dl></div><div class="index"><div class="titlepage"><div><div><h1 class="title"><a name="d4757e7824"></a>Index</h1></div></div></div><div class="index"><div class="indexdiv"><h3>A</h3><dl><dt>Application container</dt><dd><dl><dt>Requirements, <a class="indexterm" href="#application-container-prerequisites">Application Container</a></dt></dl></dd></dl></div><div class="indexdiv"><h3>D</h3><dl><dt>Downloading, <a class="indexterm" href="#installing-openidm">Installing and Running OpenIDM</a></dt></dl></div><div class="indexdiv"><h3>G</h3><dl><dt>Getting started, <a class="indexterm" href="#first-steps-with-rest">To Get Started With the OpenIDM REST Interface</a>, <a class="indexterm" href="#chap-sample">First OpenIDM Sample</a></dt></dl></div><div class="indexdiv"><h3>I</h3><dl><dt>Installing, <a class="indexterm" href="#installing-openidm">Installing and Running OpenIDM</a></dt><dd><dl><dt>Samples, <a class="indexterm" href="#install-samples">Installing the Samples</a></dt></dl></dd></dl></div><div class="indexdiv"><h3>J</h3><dl><dt>Java</dt><dd><dl><dt>Requirements, <a class="indexterm" href="#java-prerequisites">Java Environment</a></dt></dl></dd></dl></div><div class="indexdiv"><h3>R</h3><dl><dt>Repository database</dt><dd><dl><dt>Evaluation version, <a class="indexterm" href="#chap-sample">First OpenIDM Sample</a></dt><dt>Production ready, <a class="indexterm" href="#chap-repository">Installing a Repository For Production</a></dt><dt>Requirements, <a class="indexterm" href="#installing-openidm">Installing and Running OpenIDM</a></dt><dt>Table names, <a class="indexterm" href="#repository-mysql">To Set Up OpenIDM With MySQL</a></dt></dl></dd></dl></div><div class="indexdiv"><h3>S</h3><dl><dt>Samples</dt><dd><dl><dt>Google Apps Connector, <a class="indexterm" href="#sample-google-connector">Sample - Connecting to Google With the Google Apps Connector</a></dt><dt>Microsoft Azure Connector, <a class="indexterm" href="#samples-azure">Sample - Using the Groovy Connector Toolkit to Connect to
    Microsoft Azure</a></dt><dt>Salesforce Connector, <a class="indexterm" href="#sample-salesforce-connector">Sample - Connecting to Salesforce With the Salesforce Connector</a></dt><dt>Sample 1 - XML file, <a class="indexterm" href="#chap-sample">First OpenIDM Sample</a></dt><dt>Sample 2 - LDAP one way, <a class="indexterm" href="#more-sample2">Sample 2 - LDAP One Way</a></dt><dt>Sample 2b - LDAP two way, <a class="indexterm" href="#more-sample2b">Sample 2b - LDAP Two Way</a></dt><dt>Sample 2c - Synchronizing LDAP Group Membership, <a class="indexterm" href="#more-sample2c">Sample 2c - Synchronizing LDAP Group Membership</a></dt><dt>Sample 2d - Synchronizing LDAP Groups, <a class="indexterm" href="#more-sample2d">Sample 2d - Synchronizing LDAP Groups</a></dt><dt>Sample 4 - CSV file, <a class="indexterm" href="#more-sample4">Sample 4 - CSV to XML File</a></dt><dt>Sample 5 - Synchronization of two resources, <a class="indexterm" href="#more-sample5">Sample 5 - Synchronization of Two Resources</a></dt><dt>Sample 5b - Failure Compensation With Multiple Resources, <a class="indexterm" href="#more-sample5b">Sample 5b - Failure Compensation With Multiple Resources</a></dt><dt>Sample 6 - LiveSync between two LDAP servers, <a class="indexterm" href="#more-sample6">Sample 6 - LiveSync With an AD Server</a></dt><dt>Sample 7 - Scripting a SCIM-like Schema, <a class="indexterm" href="#more-sample7">Sample 7 - Scripting a SCIM-like Schema</a></dt><dt>Sample 8 - Logging in Scripts, <a class="indexterm" href="#more-sample8">Sample 8 - Logging in Scripts</a></dt><dt>Sample 9 - asynchronous reconciliation, <a class="indexterm" href="#more-sample9">Sample 9 - Asynchronous Reconciliation Using Workflows</a></dt><dt>Sample Audit - Extended Audit Capabilities, <a class="indexterm" href="#more-sample-audit">Sample - Demonstrate Extended Audit Capabilities</a></dt><dt>Sample OpenAM - Authentication Management for OpenIDM, <a class="indexterm" href="#more-sample-openam">Sample - Configuring Authentication Management With OpenAM</a></dt><dt>ScriptedCREST Connector, <a class="indexterm" href="#sample-scripted-crest">Sample - Using the Groovy Connector Toolkit to Connect to OpenDJ With ScriptedCREST</a></dt><dt>ScriptedREST Connector, <a class="indexterm" href="#sample-scripted-rest">Sample - Using the Groovy Connector Toolkit to Connect to OpenDJ With ScriptedREST</a></dt></dl></dd><dt>Starting OpenIDM, <a class="indexterm" href="#installing-openidm">Installing and Running OpenIDM</a></dt><dt>Stopping OpenIDM, <a class="indexterm" href="#installing-openidm">Installing and Running OpenIDM</a></dt></dl></div><div class="indexdiv"><h3>U</h3><dl><dt>Uninstalling, <a class="indexterm" href="#chap-uninstall">Removing and Moving OpenIDM Software</a></dt></dl></div></div></div></div><p>&nbsp;</p><div id="footer"><p>Something wrong on this page? <a href="https://bugster.forgerock.org/jira/secure/CreateIssueDetails!init.jspa?pid=10020&components=10164&issuetype=1">Log a documentation bug.</a></p></div>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-23412190-9']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</body></html>