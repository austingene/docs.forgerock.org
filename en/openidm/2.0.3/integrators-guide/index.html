<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
   <title>OpenIDM 2.0.3 Integrator's Guide</title><link rel="stylesheet" type="text/css" href="css/coredoc.css"><meta name="generator" content="DocBook XSL-NS Stylesheets V1.76.1"><meta name="description" content="Guide to configurating and integrating OpenIDM into identity management solutions. The OpenIDM project offers flexible, open source services for automating management of the identity life cycle."><script type="text/javascript">
/*! jQuery v1.7.1 jquery.com | jquery.org/license */
(function(a,b){function cy(a){return f.isWindow(a)?a:a.nodeType===9?a.defaultView||a.parentWindow:!1}function cv(a){if(!ck[a]){var b=c.body,d=f("<"+a+">").appendTo(b),e=d.css("display");d.remove();if(e==="none"||e===""){cl||(cl=c.createElement("iframe"),cl.frameBorder=cl.width=cl.height=0),b.appendChild(cl);if(!cm||!cl.createElement)cm=(cl.contentWindow||cl.contentDocument).document,cm.write((c.compatMode==="CSS1Compat"?"<!doctype html>":"")+"<html><body>"),cm.close();d=cm.createElement(a),cm.body.appendChild(d),e=f.css(d,"display"),b.removeChild(cl)}ck[a]=e}return ck[a]}function cu(a,b){var c={};f.each(cq.concat.apply([],cq.slice(0,b)),function(){c[this]=a});return c}function ct(){cr=b}function cs(){setTimeout(ct,0);return cr=f.now()}function cj(){try{return new a.ActiveXObject("Microsoft.XMLHTTP")}catch(b){}}function ci(){try{return new a.XMLHttpRequest}catch(b){}}function cc(a,c){a.dataFilter&&(c=a.dataFilter(c,a.dataType));var d=a.dataTypes,e={},g,h,i=d.length,j,k=d[0],l,m,n,o,p;for(g=1;g<i;g++){if(g===1)for(h in a.converters)typeof h=="string"&&(e[h.toLowerCase()]=a.converters[h]);l=k,k=d[g];if(k==="*")k=l;else if(l!=="*"&&l!==k){m=l+" "+k,n=e[m]||e["* "+k];if(!n){p=b;for(o in e){j=o.split(" ");if(j[0]===l||j[0]==="*"){p=e[j[1]+" "+k];if(p){o=e[o],o===!0?n=p:p===!0&&(n=o);break}}}}!n&&!p&&f.error("No conversion from "+m.replace(" "," to ")),n!==!0&&(c=n?n(c):p(o(c)))}}return c}function cb(a,c,d){var e=a.contents,f=a.dataTypes,g=a.responseFields,h,i,j,k;for(i in g)i in d&&(c[g[i]]=d[i]);while(f[0]==="*")f.shift(),h===b&&(h=a.mimeType||c.getResponseHeader("content-type"));if(h)for(i in e)if(e[i]&&e[i].test(h)){f.unshift(i);break}if(f[0]in d)j=f[0];else{for(i in d){if(!f[0]||a.converters[i+" "+f[0]]){j=i;break}k||(k=i)}j=j||k}if(j){j!==f[0]&&f.unshift(j);return d[j]}}function ca(a,b,c,d){if(f.isArray(b))f.each(b,function(b,e){c||bE.test(a)?d(a,e):ca(a+"["+(typeof e=="object"||f.isArray(e)?b:"")+"]",e,c,d)});else if(!c&&b!=null&&typeof b=="object")for(var e in b)ca(a+"["+e+"]",b[e],c,d);else d(a,b)}function b_(a,c){var d,e,g=f.ajaxSettings.flatOptions||{};for(d in c)c[d]!==b&&((g[d]?a:e||(e={}))[d]=c[d]);e&&f.extend(!0,a,e)}function b$(a,c,d,e,f,g){f=f||c.dataTypes[0],g=g||{},g[f]=!0;var h=a[f],i=0,j=h?h.length:0,k=a===bT,l;for(;i<j&&(k||!l);i++)l=h[i](c,d,e),typeof l=="string"&&(!k||g[l]?l=b:(c.dataTypes.unshift(l),l=b$(a,c,d,e,l,g)));(k||!l)&&!g["*"]&&(l=b$(a,c,d,e,"*",g));return l}function bZ(a){return function(b,c){typeof b!="string"&&(c=b,b="*");if(f.isFunction(c)){var d=b.toLowerCase().split(bP),e=0,g=d.length,h,i,j;for(;e<g;e++)h=d[e],j=/^\+/.test(h),j&&(h=h.substr(1)||"*"),i=a[h]=a[h]||[],i[j?"unshift":"push"](c)}}}function bC(a,b,c){var d=b==="width"?a.offsetWidth:a.offsetHeight,e=b==="width"?bx:by,g=0,h=e.length;if(d>0){if(c!=="border")for(;g<h;g++)c||(d-=parseFloat(f.css(a,"padding"+e[g]))||0),c==="margin"?d+=parseFloat(f.css(a,c+e[g]))||0:d-=parseFloat(f.css(a,"border"+e[g]+"Width"))||0;return d+"px"}d=bz(a,b,b);if(d<0||d==null)d=a.style[b]||0;d=parseFloat(d)||0;if(c)for(;g<h;g++)d+=parseFloat(f.css(a,"padding"+e[g]))||0,c!=="padding"&&(d+=parseFloat(f.css(a,"border"+e[g]+"Width"))||0),c==="margin"&&(d+=parseFloat(f.css(a,c+e[g]))||0);return d+"px"}function bp(a,b){b.src?f.ajax({url:b.src,async:!1,dataType:"script"}):f.globalEval((b.text||b.textContent||b.innerHTML||"").replace(bf,"/*$0*/")),b.parentNode&&b.parentNode.removeChild(b)}function bo(a){var b=c.createElement("div");bh.appendChild(b),b.innerHTML=a.outerHTML;return b.firstChild}function bn(a){var b=(a.nodeName||"").toLowerCase();b==="input"?bm(a):b!=="script"&&typeof a.getElementsByTagName!="undefined"&&f.grep(a.getElementsByTagName("input"),bm)}function bm(a){if(a.type==="checkbox"||a.type==="radio")a.defaultChecked=a.checked}function bl(a){return typeof a.getElementsByTagName!="undefined"?a.getElementsByTagName("*"):typeof a.querySelectorAll!="undefined"?a.querySelectorAll("*"):[]}function bk(a,b){var c;if(b.nodeType===1){b.clearAttributes&&b.clearAttributes(),b.mergeAttributes&&b.mergeAttributes(a),c=b.nodeName.toLowerCase();if(c==="object")b.outerHTML=a.outerHTML;else if(c!=="input"||a.type!=="checkbox"&&a.type!=="radio"){if(c==="option")b.selected=a.defaultSelected;else if(c==="input"||c==="textarea")b.defaultValue=a.defaultValue}else a.checked&&(b.defaultChecked=b.checked=a.checked),b.value!==a.value&&(b.value=a.value);b.removeAttribute(f.expando)}}function bj(a,b){if(b.nodeType===1&&!!f.hasData(a)){var c,d,e,g=f._data(a),h=f._data(b,g),i=g.events;if(i){delete h.handle,h.events={};for(c in i)for(d=0,e=i[c].length;d<e;d++)f.event.add(b,c+(i[c][d].namespace?".":"")+i[c][d].namespace,i[c][d],i[c][d].data)}h.data&&(h.data=f.extend({},h.data))}}function bi(a,b){return f.nodeName(a,"table")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function U(a){var b=V.split("|"),c=a.createDocumentFragment();if(c.createElement)while(b.length)c.createElement(b.pop());return c}function T(a,b,c){b=b||0;if(f.isFunction(b))return f.grep(a,function(a,d){var e=!!b.call(a,d,a);return e===c});if(b.nodeType)return f.grep(a,function(a,d){return a===b===c});if(typeof b=="string"){var d=f.grep(a,function(a){return a.nodeType===1});if(O.test(b))return f.filter(b,d,!c);b=f.filter(b,d)}return f.grep(a,function(a,d){return f.inArray(a,b)>=0===c})}function S(a){return!a||!a.parentNode||a.parentNode.nodeType===11}function K(){return!0}function J(){return!1}function n(a,b,c){var d=b+"defer",e=b+"queue",g=b+"mark",h=f._data(a,d);h&&(c==="queue"||!f._data(a,e))&&(c==="mark"||!f._data(a,g))&&setTimeout(function(){!f._data(a,e)&&!f._data(a,g)&&(f.removeData(a,d,!0),h.fire())},0)}function m(a){for(var b in a){if(b==="data"&&f.isEmptyObject(a[b]))continue;if(b!=="toJSON")return!1}return!0}function l(a,c,d){if(d===b&&a.nodeType===1){var e="data-"+c.replace(k,"-$1").toLowerCase();d=a.getAttribute(e);if(typeof d=="string"){try{d=d==="true"?!0:d==="false"?!1:d==="null"?null:f.isNumeric(d)?parseFloat(d):j.test(d)?f.parseJSON(d):d}catch(g){}f.data(a,c,d)}else d=b}return d}function h(a){var b=g[a]={},c,d;a=a.split(/\s+/);for(c=0,d=a.length;c<d;c++)b[a[c]]=!0;return b}var c=a.document,d=a.navigator,e=a.location,f=function(){function J(){if(!e.isReady){try{c.documentElement.doScroll("left")}catch(a){setTimeout(J,1);return}e.ready()}}var e=function(a,b){return new e.fn.init(a,b,h)},f=a.jQuery,g=a.$,h,i=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,j=/\S/,k=/^\s+/,l=/\s+$/,m=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,n=/^[\],:{}\s]*$/,o=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,p=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,q=/(?:^|:|,)(?:\s*\[)+/g,r=/(webkit)[ \/]([\w.]+)/,s=/(opera)(?:.*version)?[ \/]([\w.]+)/,t=/(msie) ([\w.]+)/,u=/(mozilla)(?:.*? rv:([\w.]+))?/,v=/-([a-z]|[0-9])/ig,w=/^-ms-/,x=function(a,b){return(b+"").toUpperCase()},y=d.userAgent,z,A,B,C=Object.prototype.toString,D=Object.prototype.hasOwnProperty,E=Array.prototype.push,F=Array.prototype.slice,G=String.prototype.trim,H=Array.prototype.indexOf,I={};e.fn=e.prototype={constructor:e,init:function(a,d,f){var g,h,j,k;if(!a)return this;if(a.nodeType){this.context=this[0]=a,this.length=1;return this}if(a==="body"&&!d&&c.body){this.context=c,this[0]=c.body,this.selector=a,this.length=1;return this}if(typeof a=="string"){a.charAt(0)!=="<"||a.charAt(a.length-1)!==">"||a.length<3?g=i.exec(a):g=[null,a,null];if(g&&(g[1]||!d)){if(g[1]){d=d instanceof e?d[0]:d,k=d?d.ownerDocument||d:c,j=m.exec(a),j?e.isPlainObject(d)?(a=[c.createElement(j[1])],e.fn.attr.call(a,d,!0)):a=[k.createElement(j[1])]:(j=e.buildFragment([g[1]],[k]),a=(j.cacheable?e.clone(j.fragment):j.fragment).childNodes);return e.merge(this,a)}h=c.getElementById(g[2]);if(h&&h.parentNode){if(h.id!==g[2])return f.find(a);this.length=1,this[0]=h}this.context=c,this.selector=a;return this}return!d||d.jquery?(d||f).find(a):this.constructor(d).find(a)}if(e.isFunction(a))return f.ready(a);a.selector!==b&&(this.selector=a.selector,this.context=a.context);return e.makeArray(a,this)},selector:"",jquery:"1.7.1",length:0,size:function(){return this.length},toArray:function(){return F.call(this,0)},get:function(a){return a==null?this.toArray():a<0?this[this.length+a]:this[a]},pushStack:function(a,b,c){var d=this.constructor();e.isArray(a)?E.apply(d,a):e.merge(d,a),d.prevObject=this,d.context=this.context,b==="find"?d.selector=this.selector+(this.selector?" ":"")+c:b&&(d.selector=this.selector+"."+b+"("+c+")");return d},each:function(a,b){return e.each(this,a,b)},ready:function(a){e.bindReady(),A.add(a);return this},eq:function(a){a=+a;return a===-1?this.slice(a):this.slice(a,a+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(F.apply(this,arguments),"slice",F.call(arguments).join(","))},map:function(a){return this.pushStack(e.map(this,function(b,c){return a.call(b,c,b)}))},end:function(){return this.prevObject||this.constructor(null)},push:E,sort:[].sort,splice:[].splice},e.fn.init.prototype=e.fn,e.extend=e.fn.extend=function(){var a,c,d,f,g,h,i=arguments[0]||{},j=1,k=arguments.length,l=!1;typeof i=="boolean"&&(l=i,i=arguments[1]||{},j=2),typeof i!="object"&&!e.isFunction(i)&&(i={}),k===j&&(i=this,--j);for(;j<k;j++)if((a=arguments[j])!=null)for(c in a){d=i[c],f=a[c];if(i===f)continue;l&&f&&(e.isPlainObject(f)||(g=e.isArray(f)))?(g?(g=!1,h=d&&e.isArray(d)?d:[]):h=d&&e.isPlainObject(d)?d:{},i[c]=e.extend(l,h,f)):f!==b&&(i[c]=f)}return i},e.extend({noConflict:function(b){a.$===e&&(a.$=g),b&&a.jQuery===e&&(a.jQuery=f);return e},isReady:!1,readyWait:1,holdReady:function(a){a?e.readyWait++:e.ready(!0)},ready:function(a){if(a===!0&&!--e.readyWait||a!==!0&&!e.isReady){if(!c.body)return setTimeout(e.ready,1);e.isReady=!0;if(a!==!0&&--e.readyWait>0)return;A.fireWith(c,[e]),e.fn.trigger&&e(c).trigger("ready").off("ready")}},bindReady:function(){if(!A){A=e.Callbacks("once memory");if(c.readyState==="complete")return setTimeout(e.ready,1);if(c.addEventListener)c.addEventListener("DOMContentLoaded",B,!1),a.addEventListener("load",e.ready,!1);else if(c.attachEvent){c.attachEvent("onreadystatechange",B),a.attachEvent("onload",e.ready);var b=!1;try{b=a.frameElement==null}catch(d){}c.documentElement.doScroll&&b&&J()}}},isFunction:function(a){return e.type(a)==="function"},isArray:Array.isArray||function(a){return e.type(a)==="array"},isWindow:function(a){return a&&typeof a=="object"&&"setInterval"in a},isNumeric:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},type:function(a){return a==null?String(a):I[C.call(a)]||"object"},isPlainObject:function(a){if(!a||e.type(a)!=="object"||a.nodeType||e.isWindow(a))return!1;try{if(a.constructor&&!D.call(a,"constructor")&&!D.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(c){return!1}var d;for(d in a);return d===b||D.call(a,d)},isEmptyObject:function(a){for(var b in a)return!1;return!0},error:function(a){throw new Error(a)},parseJSON:function(b){if(typeof b!="string"||!b)return null;b=e.trim(b);if(a.JSON&&a.JSON.parse)return a.JSON.parse(b);if(n.test(b.replace(o,"@").replace(p,"]").replace(q,"")))return(new Function("return "+b))();e.error("Invalid JSON: "+b)},parseXML:function(c){var d,f;try{a.DOMParser?(f=new DOMParser,d=f.parseFromString(c,"text/xml")):(d=new ActiveXObject("Microsoft.XMLDOM"),d.async="false",d.loadXML(c))}catch(g){d=b}(!d||!d.documentElement||d.getElementsByTagName("parsererror").length)&&e.error("Invalid XML: "+c);return d},noop:function(){},globalEval:function(b){b&&j.test(b)&&(a.execScript||function(b){a.eval.call(a,b)})(b)},camelCase:function(a){return a.replace(w,"ms-").replace(v,x)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toUpperCase()===b.toUpperCase()},each:function(a,c,d){var f,g=0,h=a.length,i=h===b||e.isFunction(a);if(d){if(i){for(f in a)if(c.apply(a[f],d)===!1)break}else for(;g<h;)if(c.apply(a[g++],d)===!1)break}else if(i){for(f in a)if(c.call(a[f],f,a[f])===!1)break}else for(;g<h;)if(c.call(a[g],g,a[g++])===!1)break;return a},trim:G?function(a){return a==null?"":G.call(a)}:function(a){return a==null?"":(a+"").replace(k,"").replace(l,"")},makeArray:function(a,b){var c=b||[];if(a!=null){var d=e.type(a);a.length==null||d==="string"||d==="function"||d==="regexp"||e.isWindow(a)?E.call(c,a):e.merge(c,a)}return c},inArray:function(a,b,c){var d;if(b){if(H)return H.call(b,a,c);d=b.length,c=c?c<0?Math.max(0,d+c):c:0;for(;c<d;c++)if(c in b&&b[c]===a)return c}return-1},merge:function(a,c){var d=a.length,e=0;if(typeof c.length=="number")for(var f=c.length;e<f;e++)a[d++]=c[e];else while(c[e]!==b)a[d++]=c[e++];a.length=d;return a},grep:function(a,b,c){var d=[],e;c=!!c;for(var f=0,g=a.length;f<g;f++)e=!!b(a[f],f),c!==e&&d.push(a[f]);return d},map:function(a,c,d){var f,g,h=[],i=0,j=a.length,k=a instanceof e||j!==b&&typeof j=="number"&&(j>0&&a[0]&&a[j-1]||j===0||e.isArray(a));if(k)for(;i<j;i++)f=c(a[i],i,d),f!=null&&(h[h.length]=f);else for(g in a)f=c(a[g],g,d),f!=null&&(h[h.length]=f);return h.concat.apply([],h)},guid:1,proxy:function(a,c){if(typeof c=="string"){var d=a[c];c=a,a=d}if(!e.isFunction(a))return b;var f=F.call(arguments,2),g=function(){return a.apply(c,f.concat(F.call(arguments)))};g.guid=a.guid=a.guid||g.guid||e.guid++;return g},access:function(a,c,d,f,g,h){var i=a.length;if(typeof c=="object"){for(var j in c)e.access(a,j,c[j],f,g,d);return a}if(d!==b){f=!h&&f&&e.isFunction(d);for(var k=0;k<i;k++)g(a[k],c,f?d.call(a[k],k,g(a[k],c)):d,h);return a}return i?g(a[0],c):b},now:function(){return(new Date).getTime()},uaMatch:function(a){a=a.toLowerCase();var b=r.exec(a)||s.exec(a)||t.exec(a)||a.indexOf("compatible")<0&&u.exec(a)||[];return{browser:b[1]||"",version:b[2]||"0"}},sub:function(){function a(b,c){return new a.fn.init(b,c)}e.extend(!0,a,this),a.superclass=this,a.fn=a.prototype=this(),a.fn.constructor=a,a.sub=this.sub,a.fn.init=function(d,f){f&&f instanceof e&&!(f instanceof a)&&(f=a(f));return e.fn.init.call(this,d,f,b)},a.fn.init.prototype=a.fn;var b=a(c);return a},browser:{}}),e.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(a,b){I["[object "+b+"]"]=b.toLowerCase()}),z=e.uaMatch(y),z.browser&&(e.browser[z.browser]=!0,e.browser.version=z.version),e.browser.webkit&&(e.browser.safari=!0),j.test(" ")&&(k=/^[\s\xA0]+/,l=/[\s\xA0]+$/),h=e(c),c.addEventListener?B=function(){c.removeEventListener("DOMContentLoaded",B,!1),e.ready()}:c.attachEvent&&(B=function(){c.readyState==="complete"&&(c.detachEvent("onreadystatechange",B),e.ready())});return e}(),g={};f.Callbacks=function(a){a=a?g[a]||h(a):{};var c=[],d=[],e,i,j,k,l,m=function(b){var d,e,g,h,i;for(d=0,e=b.length;d<e;d++)g=b[d],h=f.type(g),h==="array"?m(g):h==="function"&&(!a.unique||!o.has(g))&&c.push(g)},n=function(b,f){f=f||[],e=!a.memory||[b,f],i=!0,l=j||0,j=0,k=c.length;for(;c&&l<k;l++)if(c[l].apply(b,f)===!1&&a.stopOnFalse){e=!0;break}i=!1,c&&(a.once?e===!0?o.disable():c=[]:d&&d.length&&(e=d.shift(),o.fireWith(e[0],e[1])))},o={add:function(){if(c){var a=c.length;m(arguments),i?k=c.length:e&&e!==!0&&(j=a,n(e[0],e[1]))}return this},remove:function(){if(c){var b=arguments,d=0,e=b.length;for(;d<e;d++)for(var f=0;f<c.length;f++)if(b[d]===c[f]){i&&f<=k&&(k--,f<=l&&l--),c.splice(f--,1);if(a.unique)break}}return this},has:function(a){if(c){var b=0,d=c.length;for(;b<d;b++)if(a===c[b])return!0}return!1},empty:function(){c=[];return this},disable:function(){c=d=e=b;return this},disabled:function(){return!c},lock:function(){d=b,(!e||e===!0)&&o.disable();return this},locked:function(){return!d},fireWith:function(b,c){d&&(i?a.once||d.push([b,c]):(!a.once||!e)&&n(b,c));return this},fire:function(){o.fireWith(this,arguments);return this},fired:function(){return!!e}};return o};var i=[].slice;f.extend({Deferred:function(a){var b=f.Callbacks("once memory"),c=f.Callbacks("once memory"),d=f.Callbacks("memory"),e="pending",g={resolve:b,reject:c,notify:d},h={done:b.add,fail:c.add,progress:d.add,state:function(){return e},isResolved:b.fired,isRejected:c.fired,then:function(a,b,c){i.done(a).fail(b).progress(c);return this},always:function(){i.done.apply(i,arguments).fail.apply(i,arguments);return this},pipe:function(a,b,c){return f.Deferred(function(d){f.each({done:[a,"resolve"],fail:[b,"reject"],progress:[c,"notify"]},function(a,b){var c=b[0],e=b[1],g;f.isFunction(c)?i[a](function(){g=c.apply(this,arguments),g&&f.isFunction(g.promise)?g.promise().then(d.resolve,d.reject,d.notify):d[e+"With"](this===i?d:this,[g])}):i[a](d[e])})}).promise()},promise:function(a){if(a==null)a=h;else for(var b in h)a[b]=h[b];return a}},i=h.promise({}),j;for(j in g)i[j]=g[j].fire,i[j+"With"]=g[j].fireWith;i.done(function(){e="resolved"},c.disable,d.lock).fail(function(){e="rejected"},b.disable,d.lock),a&&a.call(i,i);return i},when:function(a){function m(a){return function(b){e[a]=arguments.length>1?i.call(arguments,0):b,j.notifyWith(k,e)}}function l(a){return function(c){b[a]=arguments.length>1?i.call(arguments,0):c,--g||j.resolveWith(j,b)}}var b=i.call(arguments,0),c=0,d=b.length,e=Array(d),g=d,h=d,j=d<=1&&a&&f.isFunction(a.promise)?a:f.Deferred(),k=j.promise();if(d>1){for(;c<d;c++)b[c]&&b[c].promise&&f.isFunction(b[c].promise)?b[c].promise().then(l(c),j.reject,m(c)):--g;g||j.resolveWith(j,b)}else j!==a&&j.resolveWith(j,d?[a]:[]);return k}}),f.support=function(){var b,d,e,g,h,i,j,k,l,m,n,o,p,q=c.createElement("div"),r=c.documentElement;q.setAttribute("className","t"),q.innerHTML="   <link/><table></table><a href='/a' style='top:1px;float:left;opacity:.55;'>a</a><input type='checkbox'/>",d=q.getElementsByTagName("*"),e=q.getElementsByTagName("a")[0];if(!d||!d.length||!e)return{};g=c.createElement("select"),h=g.appendChild(c.createElement("option")),i=q.getElementsByTagName("input")[0],b={leadingWhitespace:q.firstChild.nodeType===3,tbody:!q.getElementsByTagName("tbody").length,htmlSerialize:!!q.getElementsByTagName("link").length,style:/top/.test(e.getAttribute("style")),hrefNormalized:e.getAttribute("href")==="/a",opacity:/^0.55/.test(e.style.opacity),cssFloat:!!e.style.cssFloat,checkOn:i.value==="on",optSelected:h.selected,getSetAttribute:q.className!=="t",enctype:!!c.createElement("form").enctype,html5Clone:c.createElement("nav").cloneNode(!0).outerHTML!=="<:nav></:nav>",submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0},i.checked=!0,b.noCloneChecked=i.cloneNode(!0).checked,g.disabled=!0,b.optDisabled=!h.disabled;try{delete q.test}catch(s){b.deleteExpando=!1}!q.addEventListener&&q.attachEvent&&q.fireEvent&&(q.attachEvent("onclick",function(){b.noCloneEvent=!1}),q.cloneNode(!0).fireEvent("onclick")),i=c.createElement("input"),i.value="t",i.setAttribute("type","radio"),b.radioValue=i.value==="t",i.setAttribute("checked","checked"),q.appendChild(i),k=c.createDocumentFragment(),k.appendChild(q.lastChild),b.checkClone=k.cloneNode(!0).cloneNode(!0).lastChild.checked,b.appendChecked=i.checked,k.removeChild(i),k.appendChild(q),q.innerHTML="",a.getComputedStyle&&(j=c.createElement("div"),j.style.width="0",j.style.marginRight="0",q.style.width="2px",q.appendChild(j),b.reliableMarginRight=(parseInt((a.getComputedStyle(j,null)||{marginRight:0}).marginRight,10)||0)===0);if(q.attachEvent)for(o in{submit:1,change:1,focusin:1})n="on"+o,p=n in q,p||(q.setAttribute(n,"return;"),p=typeof q[n]=="function"),b[o+"Bubbles"]=p;k.removeChild(q),k=g=h=j=q=i=null,f(function(){var a,d,e,g,h,i,j,k,m,n,o,r=c.getElementsByTagName("body")[0];!r||(j=1,k="position:absolute;top:0;left:0;width:1px;height:1px;margin:0;",m="visibility:hidden;border:0;",n="style='"+k+"border:5px solid #000;padding:0;'",o="<div "+n+"><div></div></div>"+"<table "+n+" cellpadding='0' cellspacing='0'>"+"<tr><td></td></tr></table>",a=c.createElement("div"),a.style.cssText=m+"width:0;height:0;position:static;top:0;margin-top:"+j+"px",r.insertBefore(a,r.firstChild),q=c.createElement("div"),a.appendChild(q),q.innerHTML="<table><tr><td style='padding:0;border:0;display:none'></td><td>t</td></tr></table>",l=q.getElementsByTagName("td"),p=l[0].offsetHeight===0,l[0].style.display="",l[1].style.display="none",b.reliableHiddenOffsets=p&&l[0].offsetHeight===0,q.innerHTML="",q.style.width=q.style.paddingLeft="1px",f.boxModel=b.boxModel=q.offsetWidth===2,typeof q.style.zoom!="undefined"&&(q.style.display="inline",q.style.zoom=1,b.inlineBlockNeedsLayout=q.offsetWidth===2,q.style.display="",q.innerHTML="<div style='width:4px;'></div>",b.shrinkWrapBlocks=q.offsetWidth!==2),q.style.cssText=k+m,q.innerHTML=o,d=q.firstChild,e=d.firstChild,h=d.nextSibling.firstChild.firstChild,i={doesNotAddBorder:e.offsetTop!==5,doesAddBorderForTableAndCells:h.offsetTop===5},e.style.position="fixed",e.style.top="20px",i.fixedPosition=e.offsetTop===20||e.offsetTop===15,e.style.position=e.style.top="",d.style.overflow="hidden",d.style.position="relative",i.subtractsBorderForOverflowNotVisible=e.offsetTop===-5,i.doesNotIncludeMarginInBodyOffset=r.offsetTop!==j,r.removeChild(a),q=a=null,f.extend(b,i))});return b}();var j=/^(?:\{.*\}|\[.*\])$/,k=/([A-Z])/g;f.extend({cache:{},uuid:0,expando:"jQuery"+(f.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(a){a=a.nodeType?f.cache[a[f.expando]]:a[f.expando];return!!a&&!m(a)},data:function(a,c,d,e){if(!!f.acceptData(a)){var g,h,i,j=f.expando,k=typeof c=="string",l=a.nodeType,m=l?f.cache:a,n=l?a[j]:a[j]&&j,o=c==="events";if((!n||!m[n]||!o&&!e&&!m[n].data)&&k&&d===b)return;n||(l?a[j]=n=++f.uuid:n=j),m[n]||(m[n]={},l||(m[n].toJSON=f.noop));if(typeof c=="object"||typeof c=="function")e?m[n]=f.extend(m[n],c):m[n].data=f.extend(m[n].data,c);g=h=m[n],e||(h.data||(h.data={}),h=h.data),d!==b&&(h[f.camelCase(c)]=d);if(o&&!h[c])return g.events;k?(i=h[c],i==null&&(i=h[f.camelCase(c)])):i=h;return i}},removeData:function(a,b,c){if(!!f.acceptData(a)){var d,e,g,h=f.expando,i=a.nodeType,j=i?f.cache:a,k=i?a[h]:h;if(!j[k])return;if(b){d=c?j[k]:j[k].data;if(d){f.isArray(b)||(b in d?b=[b]:(b=f.camelCase(b),b in d?b=[b]:b=b.split(" ")));for(e=0,g=b.length;e<g;e++)delete d[b[e]];if(!(c?m:f.isEmptyObject)(d))return}}if(!c){delete j[k].data;if(!m(j[k]))return}f.support.deleteExpando||!j.setInterval?delete j[k]:j[k]=null,i&&(f.support.deleteExpando?delete a[h]:a.removeAttribute?a.removeAttribute(h):a[h]=null)}},_data:function(a,b,c){return f.data(a,b,c,!0)},acceptData:function(a){if(a.nodeName){var b=f.noData[a.nodeName.toLowerCase()];if(b)return b!==!0&&a.getAttribute("classid")===b}return!0}}),f.fn.extend({data:function(a,c){var d,e,g,h=null;if(typeof a=="undefined"){if(this.length){h=f.data(this[0]);if(this[0].nodeType===1&&!f._data(this[0],"parsedAttrs")){e=this[0].attributes;for(var i=0,j=e.length;i<j;i++)g=e[i].name,g.indexOf("data-")===0&&(g=f.camelCase(g.substring(5)),l(this[0],g,h[g]));f._data(this[0],"parsedAttrs",!0)}}return h}if(typeof a=="object")return this.each(function(){f.data(this,a)});d=a.split("."),d[1]=d[1]?"."+d[1]:"";if(c===b){h=this.triggerHandler("getData"+d[1]+"!",[d[0]]),h===b&&this.length&&(h=f.data(this[0],a),h=l(this[0],a,h));return h===b&&d[1]?this.data(d[0]):h}return this.each(function(){var b=f(this),e=[d[0],c];b.triggerHandler("setData"+d[1]+"!",e),f.data(this,a,c),b.triggerHandler("changeData"+d[1]+"!",e)})},removeData:function(a){return this.each(function(){f.removeData(this,a)})}}),f.extend({_mark:function(a,b){a&&(b=(b||"fx")+"mark",f._data(a,b,(f._data(a,b)||0)+1))},_unmark:function(a,b,c){a!==!0&&(c=b,b=a,a=!1);if(b){c=c||"fx";var d=c+"mark",e=a?0:(f._data(b,d)||1)-1;e?f._data(b,d,e):(f.removeData(b,d,!0),n(b,c,"mark"))}},queue:function(a,b,c){var d;if(a){b=(b||"fx")+"queue",d=f._data(a,b),c&&(!d||f.isArray(c)?d=f._data(a,b,f.makeArray(c)):d.push(c));return d||[]}},dequeue:function(a,b){b=b||"fx";var c=f.queue(a,b),d=c.shift(),e={};d==="inprogress"&&(d=c.shift()),d&&(b==="fx"&&c.unshift("inprogress"),f._data(a,b+".run",e),d.call(a,function(){f.dequeue(a,b)},e)),c.length||(f.removeData(a,b+"queue "+b+".run",!0),n(a,b,"queue"))}}),f.fn.extend({queue:function(a,c){typeof a!="string"&&(c=a,a="fx");if(c===b)return f.queue(this[0],a);return this.each(function(){var b=f.queue(this,a,c);a==="fx"&&b[0]!=="inprogress"&&f.dequeue(this,a)})},dequeue:function(a){return this.each(function(){f.dequeue(this,a)})},delay:function(a,b){a=f.fx?f.fx.speeds[a]||a:a,b=b||"fx";return this.queue(b,function(b,c){var d=setTimeout(b,a);c.stop=function(){clearTimeout(d)}})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,c){function m(){--h||d.resolveWith(e,[e])}typeof a!="string"&&(c=a,a=b),a=a||"fx";var d=f.Deferred(),e=this,g=e.length,h=1,i=a+"defer",j=a+"queue",k=a+"mark",l;while(g--)if(l=f.data(e[g],i,b,!0)||(f.data(e[g],j,b,!0)||f.data(e[g],k,b,!0))&&f.data(e[g],i,f.Callbacks("once memory"),!0))h++,l.add(m);m();return d.promise()}});var o=/[\n\t\r]/g,p=/\s+/,q=/\r/g,r=/^(?:button|input)$/i,s=/^(?:button|input|object|select|textarea)$/i,t=/^a(?:rea)?$/i,u=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,v=f.support.getSetAttribute,w,x,y;f.fn.extend({attr:function(a,b){return f.access(this,a,b,!0,f.attr)},removeAttr:function(a){return this.each(function(){f.removeAttr(this,a)})},prop:function(a,b){return f.access(this,a,b,!0,f.prop)},removeProp:function(a){a=f.propFix[a]||a;return this.each(function(){try{this[a]=b,delete this[a]}catch(c){}})},addClass:function(a){var b,c,d,e,g,h,i;if(f.isFunction(a))return this.each(function(b){f(this).addClass(a.call(this,b,this.className))});if(a&&typeof a=="string"){b=a.split(p);for(c=0,d=this.length;c<d;c++){e=this[c];if(e.nodeType===1)if(!e.className&&b.length===1)e.className=a;else{g=" "+e.className+" ";for(h=0,i=b.length;h<i;h++)~g.indexOf(" "+b[h]+" ")||(g+=b[h]+" ");e.className=f.trim(g)}}}return this},removeClass:function(a){var c,d,e,g,h,i,j;if(f.isFunction(a))return this.each(function(b){f(this).removeClass(a.call(this,b,this.className))});if(a&&typeof a=="string"||a===b){c=(a||"").split(p);for(d=0,e=this.length;d<e;d++){g=this[d];if(g.nodeType===1&&g.className)if(a){h=(" "+g.className+" ").replace(o," ");for(i=0,j=c.length;i<j;i++)h=h.replace(" "+c[i]+" "," ");g.className=f.trim(h)}else g.className=""}}return this},toggleClass:function(a,b){var c=typeof a,d=typeof b=="boolean";if(f.isFunction(a))return this.each(function(c){f(this).toggleClass(a.call(this,c,this.className,b),b)});return this.each(function(){if(c==="string"){var e,g=0,h=f(this),i=b,j=a.split(p);while(e=j[g++])i=d?i:!h.hasClass(e),h[i?"addClass":"removeClass"](e)}else if(c==="undefined"||c==="boolean")this.className&&f._data(this,"__className__",this.className),this.className=this.className||a===!1?"":f._data(this,"__className__")||""})},hasClass:function(a){var b=" "+a+" ",c=0,d=this.length;for(;c<d;c++)if(this[c].nodeType===1&&(" "+this[c].className+" ").replace(o," ").indexOf(b)>-1)return!0;return!1},val:function(a){var c,d,e,g=this[0];{if(!!arguments.length){e=f.isFunction(a);return this.each(function(d){var g=f(this),h;if(this.nodeType===1){e?h=a.call(this,d,g.val()):h=a,h==null?h="":typeof h=="number"?h+="":f.isArray(h)&&(h=f.map(h,function(a){return a==null?"":a+""})),c=f.valHooks[this.nodeName.toLowerCase()]||f.valHooks[this.type];if(!c||!("set"in c)||c.set(this,h,"value")===b)this.value=h}})}if(g){c=f.valHooks[g.nodeName.toLowerCase()]||f.valHooks[g.type];if(c&&"get"in c&&(d=c.get(g,"value"))!==b)return d;d=g.value;return typeof d=="string"?d.replace(q,""):d==null?"":d}}}}),f.extend({valHooks:{option:{get:function(a){var b=a.attributes.value;return!b||b.specified?a.value:a.text}},select:{get:function(a){var b,c,d,e,g=a.selectedIndex,h=[],i=a.options,j=a.type==="select-one";if(g<0)return null;c=j?g:0,d=j?g+1:i.length;for(;c<d;c++){e=i[c];if(e.selected&&(f.support.optDisabled?!e.disabled:e.getAttribute("disabled")===null)&&(!e.parentNode.disabled||!f.nodeName(e.parentNode,"optgroup"))){b=f(e).val();if(j)return b;h.push(b)}}if(j&&!h.length&&i.length)return f(i[g]).val();return h},set:function(a,b){var c=f.makeArray(b);f(a).find("option").each(function(){this.selected=f.inArray(f(this).val(),c)>=0}),c.length||(a.selectedIndex=-1);return c}}},attrFn:{val:!0,css:!0,html:!0,text:!0,data:!0,width:!0,height:!0,offset:!0},attr:function(a,c,d,e){var g,h,i,j=a.nodeType;if(!!a&&j!==3&&j!==8&&j!==2){if(e&&c in f.attrFn)return f(a)[c](d);if(typeof a.getAttribute=="undefined")return f.prop(a,c,d);i=j!==1||!f.isXMLDoc(a),i&&(c=c.toLowerCase(),h=f.attrHooks[c]||(u.test(c)?x:w));if(d!==b){if(d===null){f.removeAttr(a,c);return}if(h&&"set"in h&&i&&(g=h.set(a,d,c))!==b)return g;a.setAttribute(c,""+d);return d}if(h&&"get"in h&&i&&(g=h.get(a,c))!==null)return g;g=a.getAttribute(c);return g===null?b:g}},removeAttr:function(a,b){var c,d,e,g,h=0;if(b&&a.nodeType===1){d=b.toLowerCase().split(p),g=d.length;for(;h<g;h++)e=d[h],e&&(c=f.propFix[e]||e,f.attr(a,e,""),a.removeAttribute(v?e:c),u.test(e)&&c in a&&(a[c]=!1))}},attrHooks:{type:{set:function(a,b){if(r.test(a.nodeName)&&a.parentNode)f.error("type property can't be changed");else if(!f.support.radioValue&&b==="radio"&&f.nodeName(a,"input")){var c=a.value;a.setAttribute("type",b),c&&(a.value=c);return b}}},value:{get:function(a,b){if(w&&f.nodeName(a,"button"))return w.get(a,b);return b in a?a.value:null},set:function(a,b,c){if(w&&f.nodeName(a,"button"))return w.set(a,b,c);a.value=b}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(a,c,d){var e,g,h,i=a.nodeType;if(!!a&&i!==3&&i!==8&&i!==2){h=i!==1||!f.isXMLDoc(a),h&&(c=f.propFix[c]||c,g=f.propHooks[c]);return d!==b?g&&"set"in g&&(e=g.set(a,d,c))!==b?e:a[c]=d:g&&"get"in g&&(e=g.get(a,c))!==null?e:a[c]}},propHooks:{tabIndex:{get:function(a){var c=a.getAttributeNode("tabindex");return c&&c.specified?parseInt(c.value,10):s.test(a.nodeName)||t.test(a.nodeName)&&a.href?0:b}}}}),f.attrHooks.tabindex=f.propHooks.tabIndex,x={get:function(a,c){var d,e=f.prop(a,c);return e===!0||typeof e!="boolean"&&(d=a.getAttributeNode(c))&&d.nodeValue!==!1?c.toLowerCase():b},set:function(a,b,c){var d;b===!1?f.removeAttr(a,c):(d=f.propFix[c]||c,d in a&&(a[d]=!0),a.setAttribute(c,c.toLowerCase()));return c}},v||(y={name:!0,id:!0},w=f.valHooks.button={get:function(a,c){var d;d=a.getAttributeNode(c);return d&&(y[c]?d.nodeValue!=="":d.specified)?d.nodeValue:b},set:function(a,b,d){var e=a.getAttributeNode(d);e||(e=c.createAttribute(d),a.setAttributeNode(e));return e.nodeValue=b+""}},f.attrHooks.tabindex.set=w.set,f.each(["width","height"],function(a,b){f.attrHooks[b]=f.extend(f.attrHooks[b],{set:function(a,c){if(c===""){a.setAttribute(b,"auto");return c}}})}),f.attrHooks.contenteditable={get:w.get,set:function(a,b,c){b===""&&(b="false"),w.set(a,b,c)}}),f.support.hrefNormalized||f.each(["href","src","width","height"],function(a,c){f.attrHooks[c]=f.extend(f.attrHooks[c],{get:function(a){var d=a.getAttribute(c,2);return d===null?b:d}})}),f.support.style||(f.attrHooks.style={get:function(a){return a.style.cssText.toLowerCase()||b},set:function(a,b){return a.style.cssText=""+b}}),f.support.optSelected||(f.propHooks.selected=f.extend(f.propHooks.selected,{get:function(a){var b=a.parentNode;b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex);return null}})),f.support.enctype||(f.propFix.enctype="encoding"),f.support.checkOn||f.each(["radio","checkbox"],function(){f.valHooks[this]={get:function(a){return a.getAttribute("value")===null?"on":a.value}}}),f.each(["radio","checkbox"],function(){f.valHooks[this]=f.extend(f.valHooks[this],{set:function(a,b){if(f.isArray(b))return a.checked=f.inArray(f(a).val(),b)>=0}})});var z=/^(?:textarea|input|select)$/i,A=/^([^\.]*)?(?:\.(.+))?$/,B=/\bhover(\.\S+)?\b/,C=/^key/,D=/^(?:mouse|contextmenu)|click/,E=/^(?:focusinfocus|focusoutblur)$/,F=/^(\w*)(?:#([\w\-]+))?(?:\.([\w\-]+))?$/,G=function(a){var b=F.exec(a);b&&(b[1]=(b[1]||"").toLowerCase(),b[3]=b[3]&&new RegExp("(?:^|\\s)"+b[3]+"(?:\\s|$)"));return b},H=function(a,b){var c=a.attributes||{};return(!b[1]||a.nodeName.toLowerCase()===b[1])&&(!b[2]||(c.id||{}).value===b[2])&&(!b[3]||b[3].test((c["class"]||{}).value))},I=function(a){return f.event.special.hover?a:a.replace(B,"mouseenter$1 mouseleave$1")};
f.event={add:function(a,c,d,e,g){var h,i,j,k,l,m,n,o,p,q,r,s;if(!(a.nodeType===3||a.nodeType===8||!c||!d||!(h=f._data(a)))){d.handler&&(p=d,d=p.handler),d.guid||(d.guid=f.guid++),j=h.events,j||(h.events=j={}),i=h.handle,i||(h.handle=i=function(a){return typeof f!="undefined"&&(!a||f.event.triggered!==a.type)?f.event.dispatch.apply(i.elem,arguments):b},i.elem=a),c=f.trim(I(c)).split(" ");for(k=0;k<c.length;k++){l=A.exec(c[k])||[],m=l[1],n=(l[2]||"").split(".").sort(),s=f.event.special[m]||{},m=(g?s.delegateType:s.bindType)||m,s=f.event.special[m]||{},o=f.extend({type:m,origType:l[1],data:e,handler:d,guid:d.guid,selector:g,quick:G(g),namespace:n.join(".")},p),r=j[m];if(!r){r=j[m]=[],r.delegateCount=0;if(!s.setup||s.setup.call(a,e,n,i)===!1)a.addEventListener?a.addEventListener(m,i,!1):a.attachEvent&&a.attachEvent("on"+m,i)}s.add&&(s.add.call(a,o),o.handler.guid||(o.handler.guid=d.guid)),g?r.splice(r.delegateCount++,0,o):r.push(o),f.event.global[m]=!0}a=null}},global:{},remove:function(a,b,c,d,e){var g=f.hasData(a)&&f._data(a),h,i,j,k,l,m,n,o,p,q,r,s;if(!!g&&!!(o=g.events)){b=f.trim(I(b||"")).split(" ");for(h=0;h<b.length;h++){i=A.exec(b[h])||[],j=k=i[1],l=i[2];if(!j){for(j in o)f.event.remove(a,j+b[h],c,d,!0);continue}p=f.event.special[j]||{},j=(d?p.delegateType:p.bindType)||j,r=o[j]||[],m=r.length,l=l?new RegExp("(^|\\.)"+l.split(".").sort().join("\\.(?:.*\\.)?")+"(\\.|$)"):null;for(n=0;n<r.length;n++)s=r[n],(e||k===s.origType)&&(!c||c.guid===s.guid)&&(!l||l.test(s.namespace))&&(!d||d===s.selector||d==="**"&&s.selector)&&(r.splice(n--,1),s.selector&&r.delegateCount--,p.remove&&p.remove.call(a,s));r.length===0&&m!==r.length&&((!p.teardown||p.teardown.call(a,l)===!1)&&f.removeEvent(a,j,g.handle),delete o[j])}f.isEmptyObject(o)&&(q=g.handle,q&&(q.elem=null),f.removeData(a,["events","handle"],!0))}},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(c,d,e,g){if(!e||e.nodeType!==3&&e.nodeType!==8){var h=c.type||c,i=[],j,k,l,m,n,o,p,q,r,s;if(E.test(h+f.event.triggered))return;h.indexOf("!")>=0&&(h=h.slice(0,-1),k=!0),h.indexOf(".")>=0&&(i=h.split("."),h=i.shift(),i.sort());if((!e||f.event.customEvent[h])&&!f.event.global[h])return;c=typeof c=="object"?c[f.expando]?c:new f.Event(h,c):new f.Event(h),c.type=h,c.isTrigger=!0,c.exclusive=k,c.namespace=i.join("."),c.namespace_re=c.namespace?new RegExp("(^|\\.)"+i.join("\\.(?:.*\\.)?")+"(\\.|$)"):null,o=h.indexOf(":")<0?"on"+h:"";if(!e){j=f.cache;for(l in j)j[l].events&&j[l].events[h]&&f.event.trigger(c,d,j[l].handle.elem,!0);return}c.result=b,c.target||(c.target=e),d=d!=null?f.makeArray(d):[],d.unshift(c),p=f.event.special[h]||{};if(p.trigger&&p.trigger.apply(e,d)===!1)return;r=[[e,p.bindType||h]];if(!g&&!p.noBubble&&!f.isWindow(e)){s=p.delegateType||h,m=E.test(s+h)?e:e.parentNode,n=null;for(;m;m=m.parentNode)r.push([m,s]),n=m;n&&n===e.ownerDocument&&r.push([n.defaultView||n.parentWindow||a,s])}for(l=0;l<r.length&&!c.isPropagationStopped();l++)m=r[l][0],c.type=r[l][1],q=(f._data(m,"events")||{})[c.type]&&f._data(m,"handle"),q&&q.apply(m,d),q=o&&m[o],q&&f.acceptData(m)&&q.apply(m,d)===!1&&c.preventDefault();c.type=h,!g&&!c.isDefaultPrevented()&&(!p._default||p._default.apply(e.ownerDocument,d)===!1)&&(h!=="click"||!f.nodeName(e,"a"))&&f.acceptData(e)&&o&&e[h]&&(h!=="focus"&&h!=="blur"||c.target.offsetWidth!==0)&&!f.isWindow(e)&&(n=e[o],n&&(e[o]=null),f.event.triggered=h,e[h](),f.event.triggered=b,n&&(e[o]=n));return c.result}},dispatch:function(c){c=f.event.fix(c||a.event);var d=(f._data(this,"events")||{})[c.type]||[],e=d.delegateCount,g=[].slice.call(arguments,0),h=!c.exclusive&&!c.namespace,i=[],j,k,l,m,n,o,p,q,r,s,t;g[0]=c,c.delegateTarget=this;if(e&&!c.target.disabled&&(!c.button||c.type!=="click")){m=f(this),m.context=this.ownerDocument||this;for(l=c.target;l!=this;l=l.parentNode||this){o={},q=[],m[0]=l;for(j=0;j<e;j++)r=d[j],s=r.selector,o[s]===b&&(o[s]=r.quick?H(l,r.quick):m.is(s)),o[s]&&q.push(r);q.length&&i.push({elem:l,matches:q})}}d.length>e&&i.push({elem:this,matches:d.slice(e)});for(j=0;j<i.length&&!c.isPropagationStopped();j++){p=i[j],c.currentTarget=p.elem;for(k=0;k<p.matches.length&&!c.isImmediatePropagationStopped();k++){r=p.matches[k];if(h||!c.namespace&&!r.namespace||c.namespace_re&&c.namespace_re.test(r.namespace))c.data=r.data,c.handleObj=r,n=((f.event.special[r.origType]||{}).handle||r.handler).apply(p.elem,g),n!==b&&(c.result=n,n===!1&&(c.preventDefault(),c.stopPropagation()))}}return c.result},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){a.which==null&&(a.which=b.charCode!=null?b.charCode:b.keyCode);return a}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,d){var e,f,g,h=d.button,i=d.fromElement;a.pageX==null&&d.clientX!=null&&(e=a.target.ownerDocument||c,f=e.documentElement,g=e.body,a.pageX=d.clientX+(f&&f.scrollLeft||g&&g.scrollLeft||0)-(f&&f.clientLeft||g&&g.clientLeft||0),a.pageY=d.clientY+(f&&f.scrollTop||g&&g.scrollTop||0)-(f&&f.clientTop||g&&g.clientTop||0)),!a.relatedTarget&&i&&(a.relatedTarget=i===a.target?d.toElement:i),!a.which&&h!==b&&(a.which=h&1?1:h&2?3:h&4?2:0);return a}},fix:function(a){if(a[f.expando])return a;var d,e,g=a,h=f.event.fixHooks[a.type]||{},i=h.props?this.props.concat(h.props):this.props;a=f.Event(g);for(d=i.length;d;)e=i[--d],a[e]=g[e];a.target||(a.target=g.srcElement||c),a.target.nodeType===3&&(a.target=a.target.parentNode),a.metaKey===b&&(a.metaKey=a.ctrlKey);return h.filter?h.filter(a,g):a},special:{ready:{setup:f.bindReady},load:{noBubble:!0},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(a,b,c){f.isWindow(this)&&(this.onbeforeunload=c)},teardown:function(a,b){this.onbeforeunload===b&&(this.onbeforeunload=null)}}},simulate:function(a,b,c,d){var e=f.extend(new f.Event,c,{type:a,isSimulated:!0,originalEvent:{}});d?f.event.trigger(e,null,b):f.event.dispatch.call(b,e),e.isDefaultPrevented()&&c.preventDefault()}},f.event.handle=f.event.dispatch,f.removeEvent=c.removeEventListener?function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)}:function(a,b,c){a.detachEvent&&a.detachEvent("on"+b,c)},f.Event=function(a,b){if(!(this instanceof f.Event))return new f.Event(a,b);a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||a.returnValue===!1||a.getPreventDefault&&a.getPreventDefault()?K:J):this.type=a,b&&f.extend(this,b),this.timeStamp=a&&a.timeStamp||f.now(),this[f.expando]=!0},f.Event.prototype={preventDefault:function(){this.isDefaultPrevented=K;var a=this.originalEvent;!a||(a.preventDefault?a.preventDefault():a.returnValue=!1)},stopPropagation:function(){this.isPropagationStopped=K;var a=this.originalEvent;!a||(a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=K,this.stopPropagation()},isDefaultPrevented:J,isPropagationStopped:J,isImmediatePropagationStopped:J},f.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(a,b){f.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c=this,d=a.relatedTarget,e=a.handleObj,g=e.selector,h;if(!d||d!==c&&!f.contains(c,d))a.type=e.origType,h=e.handler.apply(this,arguments),a.type=b;return h}}}),f.support.submitBubbles||(f.event.special.submit={setup:function(){if(f.nodeName(this,"form"))return!1;f.event.add(this,"click._submit keypress._submit",function(a){var c=a.target,d=f.nodeName(c,"input")||f.nodeName(c,"button")?c.form:b;d&&!d._submit_attached&&(f.event.add(d,"submit._submit",function(a){this.parentNode&&!a.isTrigger&&f.event.simulate("submit",this.parentNode,a,!0)}),d._submit_attached=!0)})},teardown:function(){if(f.nodeName(this,"form"))return!1;f.event.remove(this,"._submit")}}),f.support.changeBubbles||(f.event.special.change={setup:function(){if(z.test(this.nodeName)){if(this.type==="checkbox"||this.type==="radio")f.event.add(this,"propertychange._change",function(a){a.originalEvent.propertyName==="checked"&&(this._just_changed=!0)}),f.event.add(this,"click._change",function(a){this._just_changed&&!a.isTrigger&&(this._just_changed=!1,f.event.simulate("change",this,a,!0))});return!1}f.event.add(this,"beforeactivate._change",function(a){var b=a.target;z.test(b.nodeName)&&!b._change_attached&&(f.event.add(b,"change._change",function(a){this.parentNode&&!a.isSimulated&&!a.isTrigger&&f.event.simulate("change",this.parentNode,a,!0)}),b._change_attached=!0)})},handle:function(a){var b=a.target;if(this!==b||a.isSimulated||a.isTrigger||b.type!=="radio"&&b.type!=="checkbox")return a.handleObj.handler.apply(this,arguments)},teardown:function(){f.event.remove(this,"._change");return z.test(this.nodeName)}}),f.support.focusinBubbles||f.each({focus:"focusin",blur:"focusout"},function(a,b){var d=0,e=function(a){f.event.simulate(b,a.target,f.event.fix(a),!0)};f.event.special[b]={setup:function(){d++===0&&c.addEventListener(a,e,!0)},teardown:function(){--d===0&&c.removeEventListener(a,e,!0)}}}),f.fn.extend({on:function(a,c,d,e,g){var h,i;if(typeof a=="object"){typeof c!="string"&&(d=c,c=b);for(i in a)this.on(i,c,d,a[i],g);return this}d==null&&e==null?(e=c,d=c=b):e==null&&(typeof c=="string"?(e=d,d=b):(e=d,d=c,c=b));if(e===!1)e=J;else if(!e)return this;g===1&&(h=e,e=function(a){f().off(a);return h.apply(this,arguments)},e.guid=h.guid||(h.guid=f.guid++));return this.each(function(){f.event.add(this,a,e,d,c)})},one:function(a,b,c,d){return this.on.call(this,a,b,c,d,1)},off:function(a,c,d){if(a&&a.preventDefault&&a.handleObj){var e=a.handleObj;f(a.delegateTarget).off(e.namespace?e.type+"."+e.namespace:e.type,e.selector,e.handler);return this}if(typeof a=="object"){for(var g in a)this.off(g,c,a[g]);return this}if(c===!1||typeof c=="function")d=c,c=b;d===!1&&(d=J);return this.each(function(){f.event.remove(this,a,d,c)})},bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},live:function(a,b,c){f(this.context).on(a,this.selector,b,c);return this},die:function(a,b){f(this.context).off(a,this.selector||"**",b);return this},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return arguments.length==1?this.off(a,"**"):this.off(b,a,c)},trigger:function(a,b){return this.each(function(){f.event.trigger(a,b,this)})},triggerHandler:function(a,b){if(this[0])return f.event.trigger(a,b,this[0],!0)},toggle:function(a){var b=arguments,c=a.guid||f.guid++,d=0,e=function(c){var e=(f._data(this,"lastToggle"+a.guid)||0)%d;f._data(this,"lastToggle"+a.guid,e+1),c.preventDefault();return b[e].apply(this,arguments)||!1};e.guid=c;while(d<b.length)b[d++].guid=c;return this.click(e)},hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)}}),f.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){f.fn[b]=function(a,c){c==null&&(c=a,a=null);return arguments.length>0?this.on(b,null,a,c):this.trigger(b)},f.attrFn&&(f.attrFn[b]=!0),C.test(b)&&(f.event.fixHooks[b]=f.event.keyHooks),D.test(b)&&(f.event.fixHooks[b]=f.event.mouseHooks)}),function(){function x(a,b,c,e,f,g){for(var h=0,i=e.length;h<i;h++){var j=e[h];if(j){var k=!1;j=j[a];while(j){if(j[d]===c){k=e[j.sizset];break}if(j.nodeType===1){g||(j[d]=c,j.sizset=h);if(typeof b!="string"){if(j===b){k=!0;break}}else if(m.filter(b,[j]).length>0){k=j;break}}j=j[a]}e[h]=k}}}function w(a,b,c,e,f,g){for(var h=0,i=e.length;h<i;h++){var j=e[h];if(j){var k=!1;j=j[a];while(j){if(j[d]===c){k=e[j.sizset];break}j.nodeType===1&&!g&&(j[d]=c,j.sizset=h);if(j.nodeName.toLowerCase()===b){k=j;break}j=j[a]}e[h]=k}}}var a=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,d="sizcache"+(Math.random()+"").replace(".",""),e=0,g=Object.prototype.toString,h=!1,i=!0,j=/\\/g,k=/\r\n/g,l=/\W/;[0,0].sort(function(){i=!1;return 0});var m=function(b,d,e,f){e=e||[],d=d||c;var h=d;if(d.nodeType!==1&&d.nodeType!==9)return[];if(!b||typeof b!="string")return e;var i,j,k,l,n,q,r,t,u=!0,v=m.isXML(d),w=[],x=b;do{a.exec(""),i=a.exec(x);if(i){x=i[3],w.push(i[1]);if(i[2]){l=i[3];break}}}while(i);if(w.length>1&&p.exec(b))if(w.length===2&&o.relative[w[0]])j=y(w[0]+w[1],d,f);else{j=o.relative[w[0]]?[d]:m(w.shift(),d);while(w.length)b=w.shift(),o.relative[b]&&(b+=w.shift()),j=y(b,j,f)}else{!f&&w.length>1&&d.nodeType===9&&!v&&o.match.ID.test(w[0])&&!o.match.ID.test(w[w.length-1])&&(n=m.find(w.shift(),d,v),d=n.expr?m.filter(n.expr,n.set)[0]:n.set[0]);if(d){n=f?{expr:w.pop(),set:s(f)}:m.find(w.pop(),w.length===1&&(w[0]==="~"||w[0]==="+")&&d.parentNode?d.parentNode:d,v),j=n.expr?m.filter(n.expr,n.set):n.set,w.length>0?k=s(j):u=!1;while(w.length)q=w.pop(),r=q,o.relative[q]?r=w.pop():q="",r==null&&(r=d),o.relative[q](k,r,v)}else k=w=[]}k||(k=j),k||m.error(q||b);if(g.call(k)==="[object Array]")if(!u)e.push.apply(e,k);else if(d&&d.nodeType===1)for(t=0;k[t]!=null;t++)k[t]&&(k[t]===!0||k[t].nodeType===1&&m.contains(d,k[t]))&&e.push(j[t]);else for(t=0;k[t]!=null;t++)k[t]&&k[t].nodeType===1&&e.push(j[t]);else s(k,e);l&&(m(l,h,e,f),m.uniqueSort(e));return e};m.uniqueSort=function(a){if(u){h=i,a.sort(u);if(h)for(var b=1;b<a.length;b++)a[b]===a[b-1]&&a.splice(b--,1)}return a},m.matches=function(a,b){return m(a,null,null,b)},m.matchesSelector=function(a,b){return m(b,null,null,[a]).length>0},m.find=function(a,b,c){var d,e,f,g,h,i;if(!a)return[];for(e=0,f=o.order.length;e<f;e++){h=o.order[e];if(g=o.leftMatch[h].exec(a)){i=g[1],g.splice(1,1);if(i.substr(i.length-1)!=="\\"){g[1]=(g[1]||"").replace(j,""),d=o.find[h](g,b,c);if(d!=null){a=a.replace(o.match[h],"");break}}}}d||(d=typeof b.getElementsByTagName!="undefined"?b.getElementsByTagName("*"):[]);return{set:d,expr:a}},m.filter=function(a,c,d,e){var f,g,h,i,j,k,l,n,p,q=a,r=[],s=c,t=c&&c[0]&&m.isXML(c[0]);while(a&&c.length){for(h in o.filter)if((f=o.leftMatch[h].exec(a))!=null&&f[2]){k=o.filter[h],l=f[1],g=!1,f.splice(1,1);if(l.substr(l.length-1)==="\\")continue;s===r&&(r=[]);if(o.preFilter[h]){f=o.preFilter[h](f,s,d,r,e,t);if(!f)g=i=!0;else if(f===!0)continue}if(f)for(n=0;(j=s[n])!=null;n++)j&&(i=k(j,f,n,s),p=e^i,d&&i!=null?p?g=!0:s[n]=!1:p&&(r.push(j),g=!0));if(i!==b){d||(s=r),a=a.replace(o.match[h],"");if(!g)return[];break}}if(a===q)if(g==null)m.error(a);else break;q=a}return s},m.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)};var n=m.getText=function(a){var b,c,d=a.nodeType,e="";if(d){if(d===1||d===9){if(typeof a.textContent=="string")return a.textContent;if(typeof a.innerText=="string")return a.innerText.replace(k,"");for(a=a.firstChild;a;a=a.nextSibling)e+=n(a)}else if(d===3||d===4)return a.nodeValue}else for(b=0;c=a[b];b++)c.nodeType!==8&&(e+=n(c));return e},o=m.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF\-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF\-]|\\.)+)\s*(?:(\S?=)\s*(?:(['"])(.*?)\3|(#?(?:[\w\u00c0-\uFFFF\-]|\\.)*)|)|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*\-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\(\s*(even|odd|(?:[+\-]?\d+|(?:[+\-]?\d*)?n\s*(?:[+\-]\s*\d+)?))\s*\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^\-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF\-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(a){return a.getAttribute("href")},type:function(a){return a.getAttribute("type")}},relative:{"+":function(a,b){var c=typeof b=="string",d=c&&!l.test(b),e=c&&!d;d&&(b=b.toLowerCase());for(var f=0,g=a.length,h;f<g;f++)if(h=a[f]){while((h=h.previousSibling)&&h.nodeType!==1);a[f]=e||h&&h.nodeName.toLowerCase()===b?h||!1:h===b}e&&m.filter(b,a,!0)},">":function(a,b){var c,d=typeof b=="string",e=0,f=a.length;if(d&&!l.test(b)){b=b.toLowerCase();for(;e<f;e++){c=a[e];if(c){var g=c.parentNode;a[e]=g.nodeName.toLowerCase()===b?g:!1}}}else{for(;e<f;e++)c=a[e],c&&(a[e]=d?c.parentNode:c.parentNode===b);d&&m.filter(b,a,!0)}},"":function(a,b,c){var d,f=e++,g=x;typeof b=="string"&&!l.test(b)&&(b=b.toLowerCase(),d=b,g=w),g("parentNode",b,f,a,d,c)},"~":function(a,b,c){var d,f=e++,g=x;typeof b=="string"&&!l.test(b)&&(b=b.toLowerCase(),d=b,g=w),g("previousSibling",b,f,a,d,c)}},find:{ID:function(a,b,c){if(typeof b.getElementById!="undefined"&&!c){var d=b.getElementById(a[1]);return d&&d.parentNode?[d]:[]}},NAME:function(a,b){if(typeof b.getElementsByName!="undefined"){var c=[],d=b.getElementsByName(a[1]);for(var e=0,f=d.length;e<f;e++)d[e].getAttribute("name")===a[1]&&c.push(d[e]);return c.length===0?null:c}},TAG:function(a,b){if(typeof b.getElementsByTagName!="undefined")return b.getElementsByTagName(a[1])}},preFilter:{CLASS:function(a,b,c,d,e,f){a=" "+a[1].replace(j,"")+" ";if(f)return a;for(var g=0,h;(h=b[g])!=null;g++)h&&(e^(h.className&&(" "+h.className+" ").replace(/[\t\n\r]/g," ").indexOf(a)>=0)?c||d.push(h):c&&(b[g]=!1));return!1},ID:function(a){return a[1].replace(j,"")},TAG:function(a,b){return a[1].replace(j,"").toLowerCase()},CHILD:function(a){if(a[1]==="nth"){a[2]||m.error(a[0]),a[2]=a[2].replace(/^\+|\s*/g,"");var b=/(-?)(\d*)(?:n([+\-]?\d*))?/.exec(a[2]==="even"&&"2n"||a[2]==="odd"&&"2n+1"||!/\D/.test(a[2])&&"0n+"+a[2]||a[2]);a[2]=b[1]+(b[2]||1)-0,a[3]=b[3]-0}else a[2]&&m.error(a[0]);a[0]=e++;return a},ATTR:function(a,b,c,d,e,f){var g=a[1]=a[1].replace(j,"");!f&&o.attrMap[g]&&(a[1]=o.attrMap[g]),a[4]=(a[4]||a[5]||"").replace(j,""),a[2]==="~="&&(a[4]=" "+a[4]+" ");return a},PSEUDO:function(b,c,d,e,f){if(b[1]==="not")if((a.exec(b[3])||"").length>1||/^\w/.test(b[3]))b[3]=m(b[3],null,null,c);else{var g=m.filter(b[3],c,d,!0^f);d||e.push.apply(e,g);return!1}else if(o.match.POS.test(b[0])||o.match.CHILD.test(b[0]))return!0;return b},POS:function(a){a.unshift(!0);return a}},filters:{enabled:function(a){return a.disabled===!1&&a.type!=="hidden"},disabled:function(a){return a.disabled===!0},checked:function(a){return a.checked===!0},selected:function(a){a.parentNode&&a.parentNode.selectedIndex;return a.selected===!0},parent:function(a){return!!a.firstChild},empty:function(a){return!a.firstChild},has:function(a,b,c){return!!m(c[3],a).length},header:function(a){return/h\d/i.test(a.nodeName)},text:function(a){var b=a.getAttribute("type"),c=a.type;return a.nodeName.toLowerCase()==="input"&&"text"===c&&(b===c||b===null)},radio:function(a){return a.nodeName.toLowerCase()==="input"&&"radio"===a.type},checkbox:function(a){return a.nodeName.toLowerCase()==="input"&&"checkbox"===a.type},file:function(a){return a.nodeName.toLowerCase()==="input"&&"file"===a.type},password:function(a){return a.nodeName.toLowerCase()==="input"&&"password"===a.type},submit:function(a){var b=a.nodeName.toLowerCase();return(b==="input"||b==="button")&&"submit"===a.type},image:function(a){return a.nodeName.toLowerCase()==="input"&&"image"===a.type},reset:function(a){var b=a.nodeName.toLowerCase();return(b==="input"||b==="button")&&"reset"===a.type},button:function(a){var b=a.nodeName.toLowerCase();return b==="input"&&"button"===a.type||b==="button"},input:function(a){return/input|select|textarea|button/i.test(a.nodeName)},focus:function(a){return a===a.ownerDocument.activeElement}},setFilters:{first:function(a,b){return b===0},last:function(a,b,c,d){return b===d.length-1},even:function(a,b){return b%2===0},odd:function(a,b){return b%2===1},lt:function(a,b,c){return b<c[3]-0},gt:function(a,b,c){return b>c[3]-0},nth:function(a,b,c){return c[3]-0===b},eq:function(a,b,c){return c[3]-0===b}},filter:{PSEUDO:function(a,b,c,d){var e=b[1],f=o.filters[e];if(f)return f(a,c,b,d);if(e==="contains")return(a.textContent||a.innerText||n([a])||"").indexOf(b[3])>=0;if(e==="not"){var g=b[3];for(var h=0,i=g.length;h<i;h++)if(g[h]===a)return!1;return!0}m.error(e)},CHILD:function(a,b){var c,e,f,g,h,i,j,k=b[1],l=a;switch(k){case"only":case"first":while(l=l.previousSibling)if(l.nodeType===1)return!1;if(k==="first")return!0;l=a;case"last":while(l=l.nextSibling)if(l.nodeType===1)return!1;return!0;case"nth":c=b[2],e=b[3];if(c===1&&e===0)return!0;f=b[0],g=a.parentNode;if(g&&(g[d]!==f||!a.nodeIndex)){i=0;for(l=g.firstChild;l;l=l.nextSibling)l.nodeType===1&&(l.nodeIndex=++i);g[d]=f}j=a.nodeIndex-e;return c===0?j===0:j%c===0&&j/c>=0}},ID:function(a,b){return a.nodeType===1&&a.getAttribute("id")===b},TAG:function(a,b){return b==="*"&&a.nodeType===1||!!a.nodeName&&a.nodeName.toLowerCase()===b},CLASS:function(a,b){return(" "+(a.className||a.getAttribute("class"))+" ").indexOf(b)>-1},ATTR:function(a,b){var c=b[1],d=m.attr?m.attr(a,c):o.attrHandle[c]?o.attrHandle[c](a):a[c]!=null?a[c]:a.getAttribute(c),e=d+"",f=b[2],g=b[4];return d==null?f==="!=":!f&&m.attr?d!=null:f==="="?e===g:f==="*="?e.indexOf(g)>=0:f==="~="?(" "+e+" ").indexOf(g)>=0:g?f==="!="?e!==g:f==="^="?e.indexOf(g)===0:f==="$="?e.substr(e.length-g.length)===g:f==="|="?e===g||e.substr(0,g.length+1)===g+"-":!1:e&&d!==!1},POS:function(a,b,c,d){var e=b[2],f=o.setFilters[e];if(f)return f(a,c,b,d)}}},p=o.match.POS,q=function(a,b){return"\\"+(b-0+1)};for(var r in o.match)o.match[r]=new RegExp(o.match[r].source+/(?![^\[]*\])(?![^\(]*\))/.source),o.leftMatch[r]=new RegExp(/(^(?:.|\r|\n)*?)/.source+o.match[r].source.replace(/\\(\d+)/g,q));var s=function(a,b){a=Array.prototype.slice.call(a,0);if(b){b.push.apply(b,a);return b}return a};try{Array.prototype.slice.call(c.documentElement.childNodes,0)[0].nodeType}catch(t){s=function(a,b){var c=0,d=b||[];if(g.call(a)==="[object Array]")Array.prototype.push.apply(d,a);else if(typeof a.length=="number")for(var e=a.length;c<e;c++)d.push(a[c]);else for(;a[c];c++)d.push(a[c]);return d}}var u,v;c.documentElement.compareDocumentPosition?u=function(a,b){if(a===b){h=!0;return 0}if(!a.compareDocumentPosition||!b.compareDocumentPosition)return a.compareDocumentPosition?-1:1;return a.compareDocumentPosition(b)&4?-1:1}:(u=function(a,b){if(a===b){h=!0;return 0}if(a.sourceIndex&&b.sourceIndex)return a.sourceIndex-b.sourceIndex;var c,d,e=[],f=[],g=a.parentNode,i=b.parentNode,j=g;if(g===i)return v(a,b);if(!g)return-1;if(!i)return 1;while(j)e.unshift(j),j=j.parentNode;j=i;while(j)f.unshift(j),j=j.parentNode;c=e.length,d=f.length;for(var k=0;k<c&&k<d;k++)if(e[k]!==f[k])return v(e[k],f[k]);return k===c?v(a,f[k],-1):v(e[k],b,1)},v=function(a,b,c){if(a===b)return c;var d=a.nextSibling;while(d){if(d===b)return-1;d=d.nextSibling}return 1}),function(){var a=c.createElement("div"),d="script"+(new Date).getTime(),e=c.documentElement;a.innerHTML="<a name='"+d+"'/>",e.insertBefore(a,e.firstChild),c.getElementById(d)&&(o.find.ID=function(a,c,d){if(typeof c.getElementById!="undefined"&&!d){var e=c.getElementById(a[1]);return e?e.id===a[1]||typeof e.getAttributeNode!="undefined"&&e.getAttributeNode("id").nodeValue===a[1]?[e]:b:[]}},o.filter.ID=function(a,b){var c=typeof a.getAttributeNode!="undefined"&&a.getAttributeNode("id");return a.nodeType===1&&c&&c.nodeValue===b}),e.removeChild(a),e=a=null}(),function(){var a=c.createElement("div");a.appendChild(c.createComment("")),a.getElementsByTagName("*").length>0&&(o.find.TAG=function(a,b){var c=b.getElementsByTagName(a[1]);if(a[1]==="*"){var d=[];for(var e=0;c[e];e++)c[e].nodeType===1&&d.push(c[e]);c=d}return c}),a.innerHTML="<a href='#'></a>",a.firstChild&&typeof a.firstChild.getAttribute!="undefined"&&a.firstChild.getAttribute("href")!=="#"&&(o.attrHandle.href=function(a){return a.getAttribute("href",2)}),a=null}(),c.querySelectorAll&&function(){var a=m,b=c.createElement("div"),d="__sizzle__";b.innerHTML="<p class='TEST'></p>";if(!b.querySelectorAll||b.querySelectorAll(".TEST").length!==0){m=function(b,e,f,g){e=e||c;if(!g&&!m.isXML(e)){var h=/^(\w+$)|^\.([\w\-]+$)|^#([\w\-]+$)/.exec(b);if(h&&(e.nodeType===1||e.nodeType===9)){if(h[1])return s(e.getElementsByTagName(b),f);if(h[2]&&o.find.CLASS&&e.getElementsByClassName)return s(e.getElementsByClassName(h[2]),f)}if(e.nodeType===9){if(b==="body"&&e.body)return s([e.body],f);if(h&&h[3]){var i=e.getElementById(h[3]);if(!i||!i.parentNode)return s([],f);if(i.id===h[3])return s([i],f)}try{return s(e.querySelectorAll(b),f)}catch(j){}}else if(e.nodeType===1&&e.nodeName.toLowerCase()!=="object"){var k=e,l=e.getAttribute("id"),n=l||d,p=e.parentNode,q=/^\s*[+~]/.test(b);l?n=n.replace(/'/g,"\\$&"):e.setAttribute("id",n),q&&p&&(e=e.parentNode);try{if(!q||p)return s(e.querySelectorAll("[id='"+n+"'] "+b),f)}catch(r){}finally{l||k.removeAttribute("id")}}}return a(b,e,f,g)};for(var e in a)m[e]=a[e];b=null}}(),function(){var a=c.documentElement,b=a.matchesSelector||a.mozMatchesSelector||a.webkitMatchesSelector||a.msMatchesSelector;if(b){var d=!b.call(c.createElement("div"),"div"),e=!1;try{b.call(c.documentElement,"[test!='']:sizzle")}catch(f){e=!0}m.matchesSelector=function(a,c){c=c.replace(/\=\s*([^'"\]]*)\s*\]/g,"='$1']");if(!m.isXML(a))try{if(e||!o.match.PSEUDO.test(c)&&!/!=/.test(c)){var f=b.call(a,c);if(f||!d||a.document&&a.document.nodeType!==11)return f}}catch(g){}return m(c,null,null,[a]).length>0}}}(),function(){var a=c.createElement("div");a.innerHTML="<div class='test e'></div><div class='test'></div>";if(!!a.getElementsByClassName&&a.getElementsByClassName("e").length!==0){a.lastChild.className="e";if(a.getElementsByClassName("e").length===1)return;o.order.splice(1,0,"CLASS"),o.find.CLASS=function(a,b,c){if(typeof b.getElementsByClassName!="undefined"&&!c)return b.getElementsByClassName(a[1])},a=null}}(),c.documentElement.contains?m.contains=function(a,b){return a!==b&&(a.contains?a.contains(b):!0)}:c.documentElement.compareDocumentPosition?m.contains=function(a,b){return!!(a.compareDocumentPosition(b)&16)}:m.contains=function(){return!1},m.isXML=function(a){var b=(a?a.ownerDocument||a:0).documentElement;return b?b.nodeName!=="HTML":!1};var y=function(a,b,c){var d,e=[],f="",g=b.nodeType?[b]:b;while(d=o.match.PSEUDO.exec(a))f+=d[0],a=a.replace(o.match.PSEUDO,"");a=o.relative[a]?a+"*":a;for(var h=0,i=g.length;h<i;h++)m(a,g[h],e,c);return m.filter(f,e)};m.attr=f.attr,m.selectors.attrMap={},f.find=m,f.expr=m.selectors,f.expr[":"]=f.expr.filters,f.unique=m.uniqueSort,f.text=m.getText,f.isXMLDoc=m.isXML,f.contains=m.contains}();var L=/Until$/,M=/^(?:parents|prevUntil|prevAll)/,N=/,/,O=/^.[^:#\[\.,]*$/,P=Array.prototype.slice,Q=f.expr.match.POS,R={children:!0,contents:!0,next:!0,prev:!0};f.fn.extend({find:function(a){var b=this,c,d;if(typeof a!="string")return f(a).filter(function(){for(c=0,d=b.length;c<d;c++)if(f.contains(b[c],this))return!0});var e=this.pushStack("","find",a),g,h,i;for(c=0,d=this.length;c<d;c++){g=e.length,f.find(a,this[c],e);if(c>0)for(h=g;h<e.length;h++)for(i=0;i<g;i++)if(e[i]===e[h]){e.splice(h--,1);break}}return e},has:function(a){var b=f(a);return this.filter(function(){for(var a=0,c=b.length;a<c;a++)if(f.contains(this,b[a]))return!0})},not:function(a){return this.pushStack(T(this,a,!1),"not",a)},filter:function(a){return this.pushStack(T(this,a,!0),"filter",a)},is:function(a){return!!a&&(typeof a=="string"?Q.test(a)?f(a,this.context).index(this[0])>=0:f.filter(a,this).length>0:this.filter(a).length>0)},closest:function(a,b){var c=[],d,e,g=this[0];if(f.isArray(a)){var h=1;while(g&&g.ownerDocument&&g!==b){for(d=0;d<a.length;d++)f(g).is(a[d])&&c.push({selector:a[d],elem:g,level:h});g=g.parentNode,h++}return c}var i=Q.test(a)||typeof a!="string"?f(a,b||this.context):0;for(d=0,e=this.length;d<e;d++){g=this[d];while(g){if(i?i.index(g)>-1:f.find.matchesSelector(g,a)){c.push(g);break}g=g.parentNode;if(!g||!g.ownerDocument||g===b||g.nodeType===11)break}}c=c.length>1?f.unique(c):c;return this.pushStack(c,"closest",a)},index:function(a){if(!a)return this[0]&&this[0].parentNode?this.prevAll().length:-1;if(typeof a=="string")return f.inArray(this[0],f(a));return f.inArray(a.jquery?a[0]:a,this)},add:function(a,b){var c=typeof a=="string"?f(a,b):f.makeArray(a&&a.nodeType?[a]:a),d=f.merge(this.get(),c);return this.pushStack(S(c[0])||S(d[0])?d:f.unique(d))},andSelf:function(){return this.add(this.prevObject)}}),f.each({parent:function(a){var b=a.parentNode;return b&&b.nodeType!==11?b:null},parents:function(a){return f.dir(a,"parentNode")},parentsUntil:function(a,b,c){return f.dir(a,"parentNode",c)},next:function(a){return f.nth(a,2,"nextSibling")},prev:function(a){return f.nth(a,2,"previousSibling")},nextAll:function(a){return f.dir(a,"nextSibling")},prevAll:function(a){return f.dir(a,"previousSibling")},nextUntil:function(a,b,c){return f.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return f.dir(a,"previousSibling",c)},siblings:function(a){return f.sibling(a.parentNode.firstChild,a)},children:function(a){return f.sibling(a.firstChild)},contents:function(a){return f.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:f.makeArray(a.childNodes)}},function(a,b){f.fn[a]=function(c,d){var e=f.map(this,b,c);L.test(a)||(d=c),d&&typeof d=="string"&&(e=f.filter(d,e)),e=this.length>1&&!R[a]?f.unique(e):e,(this.length>1||N.test(d))&&M.test(a)&&(e=e.reverse());return this.pushStack(e,a,P.call(arguments).join(","))}}),f.extend({filter:function(a,b,c){c&&(a=":not("+a+")");return b.length===1?f.find.matchesSelector(b[0],a)?[b[0]]:[]:f.find.matches(a,b)},dir:function(a,c,d){var e=[],g=a[c];while(g&&g.nodeType!==9&&(d===b||g.nodeType!==1||!f(g).is(d)))g.nodeType===1&&e.push(g),g=g[c];return e},nth:function(a,b,c,d){b=b||1;var e=0;for(;a;a=a[c])if(a.nodeType===1&&++e===b)break;return a},sibling:function(a,b){var c=[];for(;a;a=a.nextSibling)a.nodeType===1&&a!==b&&c.push(a);return c}});var V="abbr|article|aside|audio|canvas|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",W=/ jQuery\d+="(?:\d+|null)"/g,X=/^\s+/,Y=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/ig,Z=/<([\w:]+)/,$=/<tbody/i,_=/<|&#?\w+;/,ba=/<(?:script|style)/i,bb=/<(?:script|object|embed|option|style)/i,bc=new RegExp("<(?:"+V+")","i"),bd=/checked\s*(?:[^=]|=\s*.checked.)/i,be=/\/(java|ecma)script/i,bf=/^\s*<!(?:\[CDATA\[|\-\-)/,bg={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},bh=U(c);bg.optgroup=bg.option,bg.tbody=bg.tfoot=bg.colgroup=bg.caption=bg.thead,bg.th=bg.td,f.support.htmlSerialize||(bg._default=[1,"div<div>","</div>"]),f.fn.extend({text:function(a){if(f.isFunction(a))return this.each(function(b){var c=f(this);c.text(a.call(this,b,c.text()))});if(typeof a!="object"&&a!==b)return this.empty().append((this[0]&&this[0].ownerDocument||c).createTextNode(a));return f.text(this)},wrapAll:function(a){if(f.isFunction(a))return this.each(function(b){f(this).wrapAll(a.call(this,b))});if(this[0]){var b=f(a,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){var a=this;while(a.firstChild&&a.firstChild.nodeType===1)a=a.firstChild;return a}).append(this)}return this},wrapInner:function(a){if(f.isFunction(a))return this.each(function(b){f(this).wrapInner(a.call(this,b))});return this.each(function(){var b=f(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=f.isFunction(a);return this.each(function(c){f(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){f.nodeName(this,"body")||f(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(a){this.nodeType===1&&this.appendChild(a)})},prepend:function(){return this.domManip(arguments,!0,function(a){this.nodeType===1&&this.insertBefore(a,this.firstChild)})},before:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this)});if(arguments.length){var a=f.clean(arguments);a.push.apply(a,this.toArray());return this.pushStack(a,"before",arguments)}},after:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this.nextSibling)});if(arguments.length){var a=this.pushStack(this,"after",arguments);a.push.apply(a,f.clean(arguments));return a}},remove:function(a,b){for(var c=0,d;(d=this[c])!=null;c++)if(!a||f.filter(a,[d]).length)!b&&d.nodeType===1&&(f.cleanData(d.getElementsByTagName("*")),f.cleanData([d])),d.parentNode&&d.parentNode.removeChild(d);return this},empty:function()
{for(var a=0,b;(b=this[a])!=null;a++){b.nodeType===1&&f.cleanData(b.getElementsByTagName("*"));while(b.firstChild)b.removeChild(b.firstChild)}return this},clone:function(a,b){a=a==null?!1:a,b=b==null?a:b;return this.map(function(){return f.clone(this,a,b)})},html:function(a){if(a===b)return this[0]&&this[0].nodeType===1?this[0].innerHTML.replace(W,""):null;if(typeof a=="string"&&!ba.test(a)&&(f.support.leadingWhitespace||!X.test(a))&&!bg[(Z.exec(a)||["",""])[1].toLowerCase()]){a=a.replace(Y,"<$1></$2>");try{for(var c=0,d=this.length;c<d;c++)this[c].nodeType===1&&(f.cleanData(this[c].getElementsByTagName("*")),this[c].innerHTML=a)}catch(e){this.empty().append(a)}}else f.isFunction(a)?this.each(function(b){var c=f(this);c.html(a.call(this,b,c.html()))}):this.empty().append(a);return this},replaceWith:function(a){if(this[0]&&this[0].parentNode){if(f.isFunction(a))return this.each(function(b){var c=f(this),d=c.html();c.replaceWith(a.call(this,b,d))});typeof a!="string"&&(a=f(a).detach());return this.each(function(){var b=this.nextSibling,c=this.parentNode;f(this).remove(),b?f(b).before(a):f(c).append(a)})}return this.length?this.pushStack(f(f.isFunction(a)?a():a),"replaceWith",a):this},detach:function(a){return this.remove(a,!0)},domManip:function(a,c,d){var e,g,h,i,j=a[0],k=[];if(!f.support.checkClone&&arguments.length===3&&typeof j=="string"&&bd.test(j))return this.each(function(){f(this).domManip(a,c,d,!0)});if(f.isFunction(j))return this.each(function(e){var g=f(this);a[0]=j.call(this,e,c?g.html():b),g.domManip(a,c,d)});if(this[0]){i=j&&j.parentNode,f.support.parentNode&&i&&i.nodeType===11&&i.childNodes.length===this.length?e={fragment:i}:e=f.buildFragment(a,this,k),h=e.fragment,h.childNodes.length===1?g=h=h.firstChild:g=h.firstChild;if(g){c=c&&f.nodeName(g,"tr");for(var l=0,m=this.length,n=m-1;l<m;l++)d.call(c?bi(this[l],g):this[l],e.cacheable||m>1&&l<n?f.clone(h,!0,!0):h)}k.length&&f.each(k,bp)}return this}}),f.buildFragment=function(a,b,d){var e,g,h,i,j=a[0];b&&b[0]&&(i=b[0].ownerDocument||b[0]),i.createDocumentFragment||(i=c),a.length===1&&typeof j=="string"&&j.length<512&&i===c&&j.charAt(0)==="<"&&!bb.test(j)&&(f.support.checkClone||!bd.test(j))&&(f.support.html5Clone||!bc.test(j))&&(g=!0,h=f.fragments[j],h&&h!==1&&(e=h)),e||(e=i.createDocumentFragment(),f.clean(a,i,e,d)),g&&(f.fragments[j]=h?e:1);return{fragment:e,cacheable:g}},f.fragments={},f.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){f.fn[a]=function(c){var d=[],e=f(c),g=this.length===1&&this[0].parentNode;if(g&&g.nodeType===11&&g.childNodes.length===1&&e.length===1){e[b](this[0]);return this}for(var h=0,i=e.length;h<i;h++){var j=(h>0?this.clone(!0):this).get();f(e[h])[b](j),d=d.concat(j)}return this.pushStack(d,a,e.selector)}}),f.extend({clone:function(a,b,c){var d,e,g,h=f.support.html5Clone||!bc.test("<"+a.nodeName)?a.cloneNode(!0):bo(a);if((!f.support.noCloneEvent||!f.support.noCloneChecked)&&(a.nodeType===1||a.nodeType===11)&&!f.isXMLDoc(a)){bk(a,h),d=bl(a),e=bl(h);for(g=0;d[g];++g)e[g]&&bk(d[g],e[g])}if(b){bj(a,h);if(c){d=bl(a),e=bl(h);for(g=0;d[g];++g)bj(d[g],e[g])}}d=e=null;return h},clean:function(a,b,d,e){var g;b=b||c,typeof b.createElement=="undefined"&&(b=b.ownerDocument||b[0]&&b[0].ownerDocument||c);var h=[],i;for(var j=0,k;(k=a[j])!=null;j++){typeof k=="number"&&(k+="");if(!k)continue;if(typeof k=="string")if(!_.test(k))k=b.createTextNode(k);else{k=k.replace(Y,"<$1></$2>");var l=(Z.exec(k)||["",""])[1].toLowerCase(),m=bg[l]||bg._default,n=m[0],o=b.createElement("div");b===c?bh.appendChild(o):U(b).appendChild(o),o.innerHTML=m[1]+k+m[2];while(n--)o=o.lastChild;if(!f.support.tbody){var p=$.test(k),q=l==="table"&&!p?o.firstChild&&o.firstChild.childNodes:m[1]==="<table>"&&!p?o.childNodes:[];for(i=q.length-1;i>=0;--i)f.nodeName(q[i],"tbody")&&!q[i].childNodes.length&&q[i].parentNode.removeChild(q[i])}!f.support.leadingWhitespace&&X.test(k)&&o.insertBefore(b.createTextNode(X.exec(k)[0]),o.firstChild),k=o.childNodes}var r;if(!f.support.appendChecked)if(k[0]&&typeof (r=k.length)=="number")for(i=0;i<r;i++)bn(k[i]);else bn(k);k.nodeType?h.push(k):h=f.merge(h,k)}if(d){g=function(a){return!a.type||be.test(a.type)};for(j=0;h[j];j++)if(e&&f.nodeName(h[j],"script")&&(!h[j].type||h[j].type.toLowerCase()==="text/javascript"))e.push(h[j].parentNode?h[j].parentNode.removeChild(h[j]):h[j]);else{if(h[j].nodeType===1){var s=f.grep(h[j].getElementsByTagName("script"),g);h.splice.apply(h,[j+1,0].concat(s))}d.appendChild(h[j])}}return h},cleanData:function(a){var b,c,d=f.cache,e=f.event.special,g=f.support.deleteExpando;for(var h=0,i;(i=a[h])!=null;h++){if(i.nodeName&&f.noData[i.nodeName.toLowerCase()])continue;c=i[f.expando];if(c){b=d[c];if(b&&b.events){for(var j in b.events)e[j]?f.event.remove(i,j):f.removeEvent(i,j,b.handle);b.handle&&(b.handle.elem=null)}g?delete i[f.expando]:i.removeAttribute&&i.removeAttribute(f.expando),delete d[c]}}}});var bq=/alpha\([^)]*\)/i,br=/opacity=([^)]*)/,bs=/([A-Z]|^ms)/g,bt=/^-?\d+(?:px)?$/i,bu=/^-?\d/,bv=/^([\-+])=([\-+.\de]+)/,bw={position:"absolute",visibility:"hidden",display:"block"},bx=["Left","Right"],by=["Top","Bottom"],bz,bA,bB;f.fn.css=function(a,c){if(arguments.length===2&&c===b)return this;return f.access(this,a,c,!0,function(a,c,d){return d!==b?f.style(a,c,d):f.css(a,c)})},f.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=bz(a,"opacity","opacity");return c===""?"1":c}return a.style.opacity}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":f.support.cssFloat?"cssFloat":"styleFloat"},style:function(a,c,d,e){if(!!a&&a.nodeType!==3&&a.nodeType!==8&&!!a.style){var g,h,i=f.camelCase(c),j=a.style,k=f.cssHooks[i];c=f.cssProps[i]||i;if(d===b){if(k&&"get"in k&&(g=k.get(a,!1,e))!==b)return g;return j[c]}h=typeof d,h==="string"&&(g=bv.exec(d))&&(d=+(g[1]+1)*+g[2]+parseFloat(f.css(a,c)),h="number");if(d==null||h==="number"&&isNaN(d))return;h==="number"&&!f.cssNumber[i]&&(d+="px");if(!k||!("set"in k)||(d=k.set(a,d))!==b)try{j[c]=d}catch(l){}}},css:function(a,c,d){var e,g;c=f.camelCase(c),g=f.cssHooks[c],c=f.cssProps[c]||c,c==="cssFloat"&&(c="float");if(g&&"get"in g&&(e=g.get(a,!0,d))!==b)return e;if(bz)return bz(a,c)},swap:function(a,b,c){var d={};for(var e in b)d[e]=a.style[e],a.style[e]=b[e];c.call(a);for(e in b)a.style[e]=d[e]}}),f.curCSS=f.css,f.each(["height","width"],function(a,b){f.cssHooks[b]={get:function(a,c,d){var e;if(c){if(a.offsetWidth!==0)return bC(a,b,d);f.swap(a,bw,function(){e=bC(a,b,d)});return e}},set:function(a,b){if(!bt.test(b))return b;b=parseFloat(b);if(b>=0)return b+"px"}}}),f.support.opacity||(f.cssHooks.opacity={get:function(a,b){return br.test((b&&a.currentStyle?a.currentStyle.filter:a.style.filter)||"")?parseFloat(RegExp.$1)/100+"":b?"1":""},set:function(a,b){var c=a.style,d=a.currentStyle,e=f.isNumeric(b)?"alpha(opacity="+b*100+")":"",g=d&&d.filter||c.filter||"";c.zoom=1;if(b>=1&&f.trim(g.replace(bq,""))===""){c.removeAttribute("filter");if(d&&!d.filter)return}c.filter=bq.test(g)?g.replace(bq,e):g+" "+e}}),f(function(){f.support.reliableMarginRight||(f.cssHooks.marginRight={get:function(a,b){var c;f.swap(a,{display:"inline-block"},function(){b?c=bz(a,"margin-right","marginRight"):c=a.style.marginRight});return c}})}),c.defaultView&&c.defaultView.getComputedStyle&&(bA=function(a,b){var c,d,e;b=b.replace(bs,"-$1").toLowerCase(),(d=a.ownerDocument.defaultView)&&(e=d.getComputedStyle(a,null))&&(c=e.getPropertyValue(b),c===""&&!f.contains(a.ownerDocument.documentElement,a)&&(c=f.style(a,b)));return c}),c.documentElement.currentStyle&&(bB=function(a,b){var c,d,e,f=a.currentStyle&&a.currentStyle[b],g=a.style;f===null&&g&&(e=g[b])&&(f=e),!bt.test(f)&&bu.test(f)&&(c=g.left,d=a.runtimeStyle&&a.runtimeStyle.left,d&&(a.runtimeStyle.left=a.currentStyle.left),g.left=b==="fontSize"?"1em":f||0,f=g.pixelLeft+"px",g.left=c,d&&(a.runtimeStyle.left=d));return f===""?"auto":f}),bz=bA||bB,f.expr&&f.expr.filters&&(f.expr.filters.hidden=function(a){var b=a.offsetWidth,c=a.offsetHeight;return b===0&&c===0||!f.support.reliableHiddenOffsets&&(a.style&&a.style.display||f.css(a,"display"))==="none"},f.expr.filters.visible=function(a){return!f.expr.filters.hidden(a)});var bD=/%20/g,bE=/\[\]$/,bF=/\r?\n/g,bG=/#.*$/,bH=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,bI=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,bJ=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,bK=/^(?:GET|HEAD)$/,bL=/^\/\//,bM=/\?/,bN=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,bO=/^(?:select|textarea)/i,bP=/\s+/,bQ=/([?&])_=[^&]*/,bR=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,bS=f.fn.load,bT={},bU={},bV,bW,bX=["*/"]+["*"];try{bV=e.href}catch(bY){bV=c.createElement("a"),bV.href="",bV=bV.href}bW=bR.exec(bV.toLowerCase())||[],f.fn.extend({load:function(a,c,d){if(typeof a!="string"&&bS)return bS.apply(this,arguments);if(!this.length)return this;var e=a.indexOf(" ");if(e>=0){var g=a.slice(e,a.length);a=a.slice(0,e)}var h="GET";c&&(f.isFunction(c)?(d=c,c=b):typeof c=="object"&&(c=f.param(c,f.ajaxSettings.traditional),h="POST"));var i=this;f.ajax({url:a,type:h,dataType:"html",data:c,complete:function(a,b,c){c=a.responseText,a.isResolved()&&(a.done(function(a){c=a}),i.html(g?f("<div>").append(c.replace(bN,"")).find(g):c)),d&&i.each(d,[c,b,a])}});return this},serialize:function(){return f.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?f.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||bO.test(this.nodeName)||bI.test(this.type))}).map(function(a,b){var c=f(this).val();return c==null?null:f.isArray(c)?f.map(c,function(a,c){return{name:b.name,value:a.replace(bF,"\r\n")}}):{name:b.name,value:c.replace(bF,"\r\n")}}).get()}}),f.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(a,b){f.fn[b]=function(a){return this.on(b,a)}}),f.each(["get","post"],function(a,c){f[c]=function(a,d,e,g){f.isFunction(d)&&(g=g||e,e=d,d=b);return f.ajax({type:c,url:a,data:d,success:e,dataType:g})}}),f.extend({getScript:function(a,c){return f.get(a,b,c,"script")},getJSON:function(a,b,c){return f.get(a,b,c,"json")},ajaxSetup:function(a,b){b?b_(a,f.ajaxSettings):(b=a,a=f.ajaxSettings),b_(a,b);return a},ajaxSettings:{url:bV,isLocal:bJ.test(bW[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":bX},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":a.String,"text html":!0,"text json":f.parseJSON,"text xml":f.parseXML},flatOptions:{context:!0,url:!0}},ajaxPrefilter:bZ(bT),ajaxTransport:bZ(bU),ajax:function(a,c){function w(a,c,l,m){if(s!==2){s=2,q&&clearTimeout(q),p=b,n=m||"",v.readyState=a>0?4:0;var o,r,u,w=c,x=l?cb(d,v,l):b,y,z;if(a>=200&&a<300||a===304){if(d.ifModified){if(y=v.getResponseHeader("Last-Modified"))f.lastModified[k]=y;if(z=v.getResponseHeader("Etag"))f.etag[k]=z}if(a===304)w="notmodified",o=!0;else try{r=cc(d,x),w="success",o=!0}catch(A){w="parsererror",u=A}}else{u=w;if(!w||a)w="error",a<0&&(a=0)}v.status=a,v.statusText=""+(c||w),o?h.resolveWith(e,[r,w,v]):h.rejectWith(e,[v,w,u]),v.statusCode(j),j=b,t&&g.trigger("ajax"+(o?"Success":"Error"),[v,d,o?r:u]),i.fireWith(e,[v,w]),t&&(g.trigger("ajaxComplete",[v,d]),--f.active||f.event.trigger("ajaxStop"))}}typeof a=="object"&&(c=a,a=b),c=c||{};var d=f.ajaxSetup({},c),e=d.context||d,g=e!==d&&(e.nodeType||e instanceof f)?f(e):f.event,h=f.Deferred(),i=f.Callbacks("once memory"),j=d.statusCode||{},k,l={},m={},n,o,p,q,r,s=0,t,u,v={readyState:0,setRequestHeader:function(a,b){if(!s){var c=a.toLowerCase();a=m[c]=m[c]||a,l[a]=b}return this},getAllResponseHeaders:function(){return s===2?n:null},getResponseHeader:function(a){var c;if(s===2){if(!o){o={};while(c=bH.exec(n))o[c[1].toLowerCase()]=c[2]}c=o[a.toLowerCase()]}return c===b?null:c},overrideMimeType:function(a){s||(d.mimeType=a);return this},abort:function(a){a=a||"abort",p&&p.abort(a),w(0,a);return this}};h.promise(v),v.success=v.done,v.error=v.fail,v.complete=i.add,v.statusCode=function(a){if(a){var b;if(s<2)for(b in a)j[b]=[j[b],a[b]];else b=a[v.status],v.then(b,b)}return this},d.url=((a||d.url)+"").replace(bG,"").replace(bL,bW[1]+"//"),d.dataTypes=f.trim(d.dataType||"*").toLowerCase().split(bP),d.crossDomain==null&&(r=bR.exec(d.url.toLowerCase()),d.crossDomain=!(!r||r[1]==bW[1]&&r[2]==bW[2]&&(r[3]||(r[1]==="http:"?80:443))==(bW[3]||(bW[1]==="http:"?80:443)))),d.data&&d.processData&&typeof d.data!="string"&&(d.data=f.param(d.data,d.traditional)),b$(bT,d,c,v);if(s===2)return!1;t=d.global,d.type=d.type.toUpperCase(),d.hasContent=!bK.test(d.type),t&&f.active++===0&&f.event.trigger("ajaxStart");if(!d.hasContent){d.data&&(d.url+=(bM.test(d.url)?"&":"?")+d.data,delete d.data),k=d.url;if(d.cache===!1){var x=f.now(),y=d.url.replace(bQ,"$1_="+x);d.url=y+(y===d.url?(bM.test(d.url)?"&":"?")+"_="+x:"")}}(d.data&&d.hasContent&&d.contentType!==!1||c.contentType)&&v.setRequestHeader("Content-Type",d.contentType),d.ifModified&&(k=k||d.url,f.lastModified[k]&&v.setRequestHeader("If-Modified-Since",f.lastModified[k]),f.etag[k]&&v.setRequestHeader("If-None-Match",f.etag[k])),v.setRequestHeader("Accept",d.dataTypes[0]&&d.accepts[d.dataTypes[0]]?d.accepts[d.dataTypes[0]]+(d.dataTypes[0]!=="*"?", "+bX+"; q=0.01":""):d.accepts["*"]);for(u in d.headers)v.setRequestHeader(u,d.headers[u]);if(d.beforeSend&&(d.beforeSend.call(e,v,d)===!1||s===2)){v.abort();return!1}for(u in{success:1,error:1,complete:1})v[u](d[u]);p=b$(bU,d,c,v);if(!p)w(-1,"No Transport");else{v.readyState=1,t&&g.trigger("ajaxSend",[v,d]),d.async&&d.timeout>0&&(q=setTimeout(function(){v.abort("timeout")},d.timeout));try{s=1,p.send(l,w)}catch(z){if(s<2)w(-1,z);else throw z}}return v},param:function(a,c){var d=[],e=function(a,b){b=f.isFunction(b)?b():b,d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};c===b&&(c=f.ajaxSettings.traditional);if(f.isArray(a)||a.jquery&&!f.isPlainObject(a))f.each(a,function(){e(this.name,this.value)});else for(var g in a)ca(g,a[g],c,e);return d.join("&").replace(bD,"+")}}),f.extend({active:0,lastModified:{},etag:{}});var cd=f.now(),ce=/(\=)\?(&|$)|\?\?/i;f.ajaxSetup({jsonp:"callback",jsonpCallback:function(){return f.expando+"_"+cd++}}),f.ajaxPrefilter("json jsonp",function(b,c,d){var e=b.contentType==="application/x-www-form-urlencoded"&&typeof b.data=="string";if(b.dataTypes[0]==="jsonp"||b.jsonp!==!1&&(ce.test(b.url)||e&&ce.test(b.data))){var g,h=b.jsonpCallback=f.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,i=a[h],j=b.url,k=b.data,l="$1"+h+"$2";b.jsonp!==!1&&(j=j.replace(ce,l),b.url===j&&(e&&(k=k.replace(ce,l)),b.data===k&&(j+=(/\?/.test(j)?"&":"?")+b.jsonp+"="+h))),b.url=j,b.data=k,a[h]=function(a){g=[a]},d.always(function(){a[h]=i,g&&f.isFunction(i)&&a[h](g[0])}),b.converters["script json"]=function(){g||f.error(h+" was not called");return g[0]},b.dataTypes[0]="json";return"script"}}),f.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(a){f.globalEval(a);return a}}}),f.ajaxPrefilter("script",function(a){a.cache===b&&(a.cache=!1),a.crossDomain&&(a.type="GET",a.global=!1)}),f.ajaxTransport("script",function(a){if(a.crossDomain){var d,e=c.head||c.getElementsByTagName("head")[0]||c.documentElement;return{send:function(f,g){d=c.createElement("script"),d.async="async",a.scriptCharset&&(d.charset=a.scriptCharset),d.src=a.url,d.onload=d.onreadystatechange=function(a,c){if(c||!d.readyState||/loaded|complete/.test(d.readyState))d.onload=d.onreadystatechange=null,e&&d.parentNode&&e.removeChild(d),d=b,c||g(200,"success")},e.insertBefore(d,e.firstChild)},abort:function(){d&&d.onload(0,1)}}}});var cf=a.ActiveXObject?function(){for(var a in ch)ch[a](0,1)}:!1,cg=0,ch;f.ajaxSettings.xhr=a.ActiveXObject?function(){return!this.isLocal&&ci()||cj()}:ci,function(a){f.extend(f.support,{ajax:!!a,cors:!!a&&"withCredentials"in a})}(f.ajaxSettings.xhr()),f.support.ajax&&f.ajaxTransport(function(c){if(!c.crossDomain||f.support.cors){var d;return{send:function(e,g){var h=c.xhr(),i,j;c.username?h.open(c.type,c.url,c.async,c.username,c.password):h.open(c.type,c.url,c.async);if(c.xhrFields)for(j in c.xhrFields)h[j]=c.xhrFields[j];c.mimeType&&h.overrideMimeType&&h.overrideMimeType(c.mimeType),!c.crossDomain&&!e["X-Requested-With"]&&(e["X-Requested-With"]="XMLHttpRequest");try{for(j in e)h.setRequestHeader(j,e[j])}catch(k){}h.send(c.hasContent&&c.data||null),d=function(a,e){var j,k,l,m,n;try{if(d&&(e||h.readyState===4)){d=b,i&&(h.onreadystatechange=f.noop,cf&&delete ch[i]);if(e)h.readyState!==4&&h.abort();else{j=h.status,l=h.getAllResponseHeaders(),m={},n=h.responseXML,n&&n.documentElement&&(m.xml=n),m.text=h.responseText;try{k=h.statusText}catch(o){k=""}!j&&c.isLocal&&!c.crossDomain?j=m.text?200:404:j===1223&&(j=204)}}}catch(p){e||g(-1,p)}m&&g(j,k,m,l)},!c.async||h.readyState===4?d():(i=++cg,cf&&(ch||(ch={},f(a).unload(cf)),ch[i]=d),h.onreadystatechange=d)},abort:function(){d&&d(0,1)}}}});var ck={},cl,cm,cn=/^(?:toggle|show|hide)$/,co=/^([+\-]=)?([\d+.\-]+)([a-z%]*)$/i,cp,cq=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]],cr;f.fn.extend({show:function(a,b,c){var d,e;if(a||a===0)return this.animate(cu("show",3),a,b,c);for(var g=0,h=this.length;g<h;g++)d=this[g],d.style&&(e=d.style.display,!f._data(d,"olddisplay")&&e==="none"&&(e=d.style.display=""),e===""&&f.css(d,"display")==="none"&&f._data(d,"olddisplay",cv(d.nodeName)));for(g=0;g<h;g++){d=this[g];if(d.style){e=d.style.display;if(e===""||e==="none")d.style.display=f._data(d,"olddisplay")||""}}return this},hide:function(a,b,c){if(a||a===0)return this.animate(cu("hide",3),a,b,c);var d,e,g=0,h=this.length;for(;g<h;g++)d=this[g],d.style&&(e=f.css(d,"display"),e!=="none"&&!f._data(d,"olddisplay")&&f._data(d,"olddisplay",e));for(g=0;g<h;g++)this[g].style&&(this[g].style.display="none");return this},_toggle:f.fn.toggle,toggle:function(a,b,c){var d=typeof a=="boolean";f.isFunction(a)&&f.isFunction(b)?this._toggle.apply(this,arguments):a==null||d?this.each(function(){var b=d?a:f(this).is(":hidden");f(this)[b?"show":"hide"]()}):this.animate(cu("toggle",3),a,b,c);return this},fadeTo:function(a,b,c,d){return this.filter(":hidden").css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){function g(){e.queue===!1&&f._mark(this);var b=f.extend({},e),c=this.nodeType===1,d=c&&f(this).is(":hidden"),g,h,i,j,k,l,m,n,o;b.animatedProperties={};for(i in a){g=f.camelCase(i),i!==g&&(a[g]=a[i],delete a[i]),h=a[g],f.isArray(h)?(b.animatedProperties[g]=h[1],h=a[g]=h[0]):b.animatedProperties[g]=b.specialEasing&&b.specialEasing[g]||b.easing||"swing";if(h==="hide"&&d||h==="show"&&!d)return b.complete.call(this);c&&(g==="height"||g==="width")&&(b.overflow=[this.style.overflow,this.style.overflowX,this.style.overflowY],f.css(this,"display")==="inline"&&f.css(this,"float")==="none"&&(!f.support.inlineBlockNeedsLayout||cv(this.nodeName)==="inline"?this.style.display="inline-block":this.style.zoom=1))}b.overflow!=null&&(this.style.overflow="hidden");for(i in a)j=new f.fx(this,b,i),h=a[i],cn.test(h)?(o=f._data(this,"toggle"+i)||(h==="toggle"?d?"show":"hide":0),o?(f._data(this,"toggle"+i,o==="show"?"hide":"show"),j[o]()):j[h]()):(k=co.exec(h),l=j.cur(),k?(m=parseFloat(k[2]),n=k[3]||(f.cssNumber[i]?"":"px"),n!=="px"&&(f.style(this,i,(m||1)+n),l=(m||1)/j.cur()*l,f.style(this,i,l+n)),k[1]&&(m=(k[1]==="-="?-1:1)*m+l),j.custom(l,m,n)):j.custom(l,h,""));return!0}var e=f.speed(b,c,d);if(f.isEmptyObject(a))return this.each(e.complete,[!1]);a=f.extend({},a);return e.queue===!1?this.each(g):this.queue(e.queue,g)},stop:function(a,c,d){typeof a!="string"&&(d=c,c=a,a=b),c&&a!==!1&&this.queue(a||"fx",[]);return this.each(function(){function h(a,b,c){var e=b[c];f.removeData(a,c,!0),e.stop(d)}var b,c=!1,e=f.timers,g=f._data(this);d||f._unmark(!0,this);if(a==null)for(b in g)g[b]&&g[b].stop&&b.indexOf(".run")===b.length-4&&h(this,g,b);else g[b=a+".run"]&&g[b].stop&&h(this,g,b);for(b=e.length;b--;)e[b].elem===this&&(a==null||e[b].queue===a)&&(d?e[b](!0):e[b].saveState(),c=!0,e.splice(b,1));(!d||!c)&&f.dequeue(this,a)})}}),f.each({slideDown:cu("show",1),slideUp:cu("hide",1),slideToggle:cu("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){f.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),f.extend({speed:function(a,b,c){var d=a&&typeof a=="object"?f.extend({},a):{complete:c||!c&&b||f.isFunction(a)&&a,duration:a,easing:c&&b||b&&!f.isFunction(b)&&b};d.duration=f.fx.off?0:typeof d.duration=="number"?d.duration:d.duration in f.fx.speeds?f.fx.speeds[d.duration]:f.fx.speeds._default;if(d.queue==null||d.queue===!0)d.queue="fx";d.old=d.complete,d.complete=function(a){f.isFunction(d.old)&&d.old.call(this),d.queue?f.dequeue(this,d.queue):a!==!1&&f._unmark(this)};return d},easing:{linear:function(a,b,c,d){return c+d*a},swing:function(a,b,c,d){return(-Math.cos(a*Math.PI)/2+.5)*d+c}},timers:[],fx:function(a,b,c){this.options=b,this.elem=a,this.prop=c,b.orig=b.orig||{}}}),f.fx.prototype={update:function(){this.options.step&&this.options.step.call(this.elem,this.now,this),(f.fx.step[this.prop]||f.fx.step._default)(this)},cur:function(){if(this.elem[this.prop]!=null&&(!this.elem.style||this.elem.style[this.prop]==null))return this.elem[this.prop];var a,b=f.css(this.elem,this.prop);return isNaN(a=parseFloat(b))?!b||b==="auto"?0:b:a},custom:function(a,c,d){function h(a){return e.step(a)}var e=this,g=f.fx;this.startTime=cr||cs(),this.end=c,this.now=this.start=a,this.pos=this.state=0,this.unit=d||this.unit||(f.cssNumber[this.prop]?"":"px"),h.queue=this.options.queue,h.elem=this.elem,h.saveState=function(){e.options.hide&&f._data(e.elem,"fxshow"+e.prop)===b&&f._data(e.elem,"fxshow"+e.prop,e.start)},h()&&f.timers.push(h)&&!cp&&(cp=setInterval(g.tick,g.interval))},show:function(){var a=f._data(this.elem,"fxshow"+this.prop);this.options.orig[this.prop]=a||f.style(this.elem,this.prop),this.options.show=!0,a!==b?this.custom(this.cur(),a):this.custom(this.prop==="width"||this.prop==="height"?1:0,this.cur()),f(this.elem).show()},hide:function(){this.options.orig[this.prop]=f._data(this.elem,"fxshow"+this.prop)||f.style(this.elem,this.prop),this.options.hide=!0,this.custom(this.cur(),0)},step:function(a){var b,c,d,e=cr||cs(),g=!0,h=this.elem,i=this.options;if(a||e>=i.duration+this.startTime){this.now=this.end,this.pos=this.state=1,this.update(),i.animatedProperties[this.prop]=!0;for(b in i.animatedProperties)i.animatedProperties[b]!==!0&&(g=!1);if(g){i.overflow!=null&&!f.support.shrinkWrapBlocks&&f.each(["","X","Y"],function(a,b){h.style["overflow"+b]=i.overflow[a]}),i.hide&&f(h).hide();if(i.hide||i.show)for(b in i.animatedProperties)f.style(h,b,i.orig[b]),f.removeData(h,"fxshow"+b,!0),f.removeData(h,"toggle"+b,!0);d=i.complete,d&&(i.complete=!1,d.call(h))}return!1}i.duration==Infinity?this.now=e:(c=e-this.startTime,this.state=c/i.duration,this.pos=f.easing[i.animatedProperties[this.prop]](this.state,c,0,1,i.duration),this.now=this.start+(this.end-this.start)*this.pos),this.update();return!0}},f.extend(f.fx,{tick:function(){var a,b=f.timers,c=0;for(;c<b.length;c++)a=b[c],!a()&&b[c]===a&&b.splice(c--,1);b.length||f.fx.stop()},interval:13,stop:function(){clearInterval(cp),cp=null},speeds:{slow:600,fast:200,_default:400},step:{opacity:function(a){f.style(a.elem,"opacity",a.now)},_default:function(a){a.elem.style&&a.elem.style[a.prop]!=null?a.elem.style[a.prop]=a.now+a.unit:a.elem[a.prop]=a.now}}}),f.each(["width","height"],function(a,b){f.fx.step[b]=function(a){f.style(a.elem,b,Math.max(0,a.now)+a.unit)}}),f.expr&&f.expr.filters&&(f.expr.filters.animated=function(a){return f.grep(f.timers,function(b){return a===b.elem}).length});var cw=/^t(?:able|d|h)$/i,cx=/^(?:body|html)$/i;"getBoundingClientRect"in c.documentElement?f.fn.offset=function(a){var b=this[0],c;if(a)return this.each(function(b){f.offset.setOffset(this,a,b)});if(!b||!b.ownerDocument)return null;if(b===b.ownerDocument.body)return f.offset.bodyOffset(b);try{c=b.getBoundingClientRect()}catch(d){}var e=b.ownerDocument,g=e.documentElement;if(!c||!f.contains(g,b))return c?{top:c.top,left:c.left}:{top:0,left:0};var h=e.body,i=cy(e),j=g.clientTop||h.clientTop||0,k=g.clientLeft||h.clientLeft||0,l=i.pageYOffset||f.support.boxModel&&g.scrollTop||h.scrollTop,m=i.pageXOffset||f.support.boxModel&&g.scrollLeft||h.scrollLeft,n=c.top+l-j,o=c.left+m-k;return{top:n,left:o}}:f.fn.offset=function(a){var b=this[0];if(a)return this.each(function(b){f.offset.setOffset(this,a,b)});if(!b||!b.ownerDocument)return null;if(b===b.ownerDocument.body)return f.offset.bodyOffset(b);var c,d=b.offsetParent,e=b,g=b.ownerDocument,h=g.documentElement,i=g.body,j=g.defaultView,k=j?j.getComputedStyle(b,null):b.currentStyle,l=b.offsetTop,m=b.offsetLeft;while((b=b.parentNode)&&b!==i&&b!==h){if(f.support.fixedPosition&&k.position==="fixed")break;c=j?j.getComputedStyle(b,null):b.currentStyle,l-=b.scrollTop,m-=b.scrollLeft,b===d&&(l+=b.offsetTop,m+=b.offsetLeft,f.support.doesNotAddBorder&&(!f.support.doesAddBorderForTableAndCells||!cw.test(b.nodeName))&&(l+=parseFloat(c.borderTopWidth)||0,m+=parseFloat(c.borderLeftWidth)||0),e=d,d=b.offsetParent),f.support.subtractsBorderForOverflowNotVisible&&c.overflow!=="visible"&&(l+=parseFloat(c.borderTopWidth)||0,m+=parseFloat(c.borderLeftWidth)||0),k=c}if(k.position==="relative"||k.position==="static")l+=i.offsetTop,m+=i.offsetLeft;f.support.fixedPosition&&k.position==="fixed"&&(l+=Math.max(h.scrollTop,i.scrollTop),m+=Math.max(h.scrollLeft,i.scrollLeft));return{top:l,left:m}},f.offset={bodyOffset:function(a){var b=a.offsetTop,c=a.offsetLeft;f.support.doesNotIncludeMarginInBodyOffset&&(b+=parseFloat(f.css(a,"marginTop"))||0,c+=parseFloat(f.css(a,"marginLeft"))||0);return{top:b,left:c}},setOffset:function(a,b,c){var d=f.css(a,"position");d==="static"&&(a.style.position="relative");var e=f(a),g=e.offset(),h=f.css(a,"top"),i=f.css(a,"left"),j=(d==="absolute"||d==="fixed")&&f.inArray("auto",[h,i])>-1,k={},l={},m,n;j?(l=e.position(),m=l.top,n=l.left):(m=parseFloat(h)||0,n=parseFloat(i)||0),f.isFunction(b)&&(b=b.call(a,c,g)),b.top!=null&&(k.top=b.top-g.top+m),b.left!=null&&(k.left=b.left-g.left+n),"using"in b?b.using.call(a,k):e.css(k)}},f.fn.extend({position:function(){if(!this[0])return null;var a=this[0],b=this.offsetParent(),c=this.offset(),d=cx.test(b[0].nodeName)?{top:0,left:0}:b.offset();c.top-=parseFloat(f.css(a,"marginTop"))||0,c.left-=parseFloat(f.css(a,"marginLeft"))||0,d.top+=parseFloat(f.css(b[0],"borderTopWidth"))||0,d.left+=parseFloat(f.css(b[0],"borderLeftWidth"))||0;return{top:c.top-d.top,left:c.left-d.left}},offsetParent:function(){return this.map(function(){var a=this.offsetParent||c.body;while(a&&!cx.test(a.nodeName)&&f.css(a,"position")==="static")a=a.offsetParent;return a})}}),f.each(["Left","Top"],function(a,c){var d="scroll"+c;f.fn[d]=function(c){var e,g;if(c===b){e=this[0];if(!e)return null;g=cy(e);return g?"pageXOffset"in g?g[a?"pageYOffset":"pageXOffset"]:f.support.boxModel&&g.document.documentElement[d]||g.document.body[d]:e[d]}return this.each(function(){g=cy(this),g?g.scrollTo(a?f(g).scrollLeft():c,a?c:f(g).scrollTop()):this[d]=c})}}),f.each(["Height","Width"],function(a,c){var d=c.toLowerCase();f.fn["inner"+c]=function(){var a=this[0];return a?a.style?parseFloat(f.css(a,d,"padding")):this[d]():null},f.fn["outer"+c]=function(a){var b=this[0];return b?b.style?parseFloat(f.css(b,d,a?"margin":"border")):this[d]():null},f.fn[d]=function(a){var e=this[0];if(!e)return a==null?null:this;if(f.isFunction(a))return this.each(function(b){var c=f(this);c[d](a.call(this,b,c[d]()))});if(f.isWindow(e)){var g=e.document.documentElement["client"+c],h=e.document.body;return e.document.compatMode==="CSS1Compat"&&g||h&&h["client"+c]||g}if(e.nodeType===9)return Math.max(e.documentElement["client"+c],e.body["scroll"+c],e.documentElement["scroll"+c],e.body["offset"+c],e.documentElement["offset"+c]);if(a===b){var i=f.css(e,d),j=parseFloat(i);return f.isNumeric(j)?j:i}return this.css(d,typeof a=="string"?a:a+"px")}}),a.jQuery=a.$=f,typeof define=="function"&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return f})})(window);
</script>
<script type="text/javascript">
/* On double-click, reformat <div class="screen"> for easy copying. */
var minus = "<img alt=\"minus\" class=\"toggle\" width=\"18\" height=\"10\" src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAAKCAYAAAC5Sw6hAAADHmlDQ1BJQ0MgUHJvZmlsZQAAeAGFVN9r01AU/tplnbDhizpnEQk+aJFuZFN0Q5y2a1e6zVrqNrchSJumbVyaxiTtfrAH2YtvOsV38Qc++QcM2YNve5INxhRh+KyIIkz2IrOemzRNJ1MDufe73/nuOSfn5F6g+XFa0xQvDxRVU0/FwvzE5BTf8gFeHEMr/GhNi4YWSiZHQA/Tsnnvs/MOHsZsdO5v36v+Y9WalQwR8BwgvpQ1xCLhWaBpXNR0E+DWie+dMTXCzUxzWKcECR9nOG9jgeGMjSOWZjQ1QJoJwgfFQjpLuEA4mGng8w3YzoEU5CcmqZIuizyrRVIv5WRFsgz28B9zg/JfsKiU6Zut5xCNbZoZTtF8it4fOX1wjOYA1cE/Xxi9QbidcFg246M1fkLNJK4RJr3n7nRpmO1lmpdZKRIlHCS8YlSuM2xp5gsDiZrm0+30UJKwnzS/NDNZ8+PtUJUE6zHF9fZLRvS6vdfbkZMH4zU+pynWf0D+vff1corleZLw67QejdX0W5I6Vtvb5M2mI8PEd1E/A0hCgo4cZCjgkUIMYZpjxKr4TBYZIkqk0ml0VHmyONY7KJOW7RxHeMlfDrheFvVbsrj24Pue3SXXjrwVhcW3o9hR7bWB6bqyE5obf3VhpaNu4Te55ZsbbasLCFH+iuWxSF5lyk+CUdd1NuaQU5f8dQvPMpTuJXYSWAy6rPBe+CpsCk+FF8KXv9TIzt6tEcuAcSw+q55TzcbsJdJM0utkuL+K9ULGGPmQMUNanb4kTZyKOfLaUAsnBneC6+biXC/XB567zF3h+rkIrS5yI47CF/VFfCHwvjO+Pl+3b4hhp9u+02TrozFa67vTkbqisXqUj9sn9j2OqhMZsrG+sX5WCCu0omNqSrN0TwADJW1Ol/MFk+8RhAt8iK4tiY+rYleQTysKb5kMXpcMSa9I2S6wO4/tA7ZT1l3maV9zOfMqcOkb/cPrLjdVBl4ZwNFzLhegM3XkCbB8XizrFdsfPJ63gJE722OtPW1huos+VqvbdC5bHgG7D6vVn8+q1d3n5H8LeKP8BqkjCtbCoV8yAAAAUklEQVQoFWO8HyrynwEKFFa9ZoSxiaEfhInC9TKADAICBkowyAwmYmwmRg3VDGLBZtvHPGmE37Eo4J/0FCMsaesibDZicRiKENVcRDWDGKmVIAFsW0aIsyjVzwAAAABJRU5ErkJggg%3D%3D\">";
var plus = "<img alt=\"plus\" class=\"toggle\" width=\"18\" height=\"10\" src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAAKCAYAAAC5Sw6hAAADHmlDQ1BJQ0MgUHJvZmlsZQAAeAGFVN9r01AU/tplnbDhizpnEQk+aJFuZFN0Q5y2a1e6zVrqNrchSJumbVyaxiTtfrAH2YtvOsV38Qc++QcM2YNve5INxhRh+KyIIkz2IrOemzRNJ1MDufe73/nuOSfn5F6g+XFa0xQvDxRVU0/FwvzE5BTf8gFeHEMr/GhNi4YWSiZHQA/Tsnnvs/MOHsZsdO5v36v+Y9WalQwR8BwgvpQ1xCLhWaBpXNR0E+DWie+dMTXCzUxzWKcECR9nOG9jgeGMjSOWZjQ1QJoJwgfFQjpLuEA4mGng8w3YzoEU5CcmqZIuizyrRVIv5WRFsgz28B9zg/JfsKiU6Zut5xCNbZoZTtF8it4fOX1wjOYA1cE/Xxi9QbidcFg246M1fkLNJK4RJr3n7nRpmO1lmpdZKRIlHCS8YlSuM2xp5gsDiZrm0+30UJKwnzS/NDNZ8+PtUJUE6zHF9fZLRvS6vdfbkZMH4zU+pynWf0D+vff1corleZLw67QejdX0W5I6Vtvb5M2mI8PEd1E/A0hCgo4cZCjgkUIMYZpjxKr4TBYZIkqk0ml0VHmyONY7KJOW7RxHeMlfDrheFvVbsrj24Pue3SXXjrwVhcW3o9hR7bWB6bqyE5obf3VhpaNu4Te55ZsbbasLCFH+iuWxSF5lyk+CUdd1NuaQU5f8dQvPMpTuJXYSWAy6rPBe+CpsCk+FF8KXv9TIzt6tEcuAcSw+q55TzcbsJdJM0utkuL+K9ULGGPmQMUNanb4kTZyKOfLaUAsnBneC6+biXC/XB567zF3h+rkIrS5yI47CF/VFfCHwvjO+Pl+3b4hhp9u+02TrozFa67vTkbqisXqUj9sn9j2OqhMZsrG+sX5WCCu0omNqSrN0TwADJW1Ol/MFk+8RhAt8iK4tiY+rYleQTysKb5kMXpcMSa9I2S6wO4/tA7ZT1l3maV9zOfMqcOkb/cPrLjdVBl4ZwNFzLhegM3XkCbB8XizrFdsfPJ63gJE722OtPW1huos+VqvbdC5bHgG7D6vVn8+q1d3n5H8LeKP8BqkjCtbCoV8yAAAAYElEQVQoFWO8HyrynwEKFFa9ZoSxiaEfhInC9TKADAICBlz4Q67UfxDGJQ8SB5nBRIzNxKihmkEs2Gz7mCeN8DtUAbIY/6SnGGFJWxch2whzCbIYNl9QzUVUM4iRWgkSAKcsS/O6iJF0AAAAAElFTkSuQmCC\">";

$(document).ready(function() {
  /* Workaround for https://bugzilla.mozilla.org/show_bug.cgi?id=116083 */
  if (navigator.userAgent.match(/Firefox/i)) {
    $(".screen").wrap("<pre />");
    $(".programlisting").wrap("<pre />");
  }

  /*
    Include both a wrapped (.screen) and unwrapped (.flat) version of
    each screen element, with [-] image to collapse and [+] image
    to expand content.
   */
  $(".screen").each(function () {
    $(this).replaceWith(
      "<div class=\"screen\" title=\"Click [-] to flatten lines.\">"
        + minus + $(this).html() + "</div>" +
      "<div class=\"flat nodisplay\" title=\"Click [+] to wrap long lines.\">"
        + plus + $(this).html().replace(/(\n|\r\n) /g," ") + "</div>"
    )});
});

/*
  Add class="nodisplay" to parent div; remove from parent's sibling.
  If the current parent is .screen, then next sibling is .flat.
*/
$(".toggle").live("click", function() {
  $(this).parent().toggleClass("nodisplay");
  if ($(this).parent().hasClass("screen")) {
    $(this).parent().next().toggleClass("nodisplay");
  } else {
    $(this).parent().prev().toggleClass("nodisplay");
  }
});
</script>
<link rel="shortcut icon" href="http://forgerock.org/favicon.ico">
</head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div lang="en" class="book" title="OpenIDM 2.0.3 Integrator's Guide"><div class="titlepage"><div><div><h1 class="title"><a name="integrators-guide"></a>OpenIDM 2.0.3 Integrator's Guide</h1></div><div><div class="authorgroup"><div class="author"><h3 class="author"><span class="firstname">Anders</span> <span class="surname">Ask&aring;sen</span></h3></div><div class="author"><h3 class="author"><span class="firstname">Paul</span> <span class="surname">Bryan</span></h3></div><div class="author"><h3 class="author"><span class="firstname">Mark</span> <span class="surname">Craig</span></h3></div><div class="author"><h3 class="author"><span class="firstname">Andi</span> <span class="surname">Egloff</span></h3></div><div class="author"><h3 class="author"><span class="firstname">Laszlo</span> <span class="surname">Hordos</span></h3></div><div class="author"><h3 class="author"><span class="firstname">Matthias</span> <span class="surname">Tristl</span></h3></div></div></div><div><p class="copyright">Copyright &copy; 2011-2012 ForgeRock AS</p></div><div><a href="legalnotice.html">Legal Notice</a></div><div><p class="pubdate">Last updated: March&nbsp;30,&nbsp;2012</p></div><div><div class="abstract" title="Abstract"><div class="abstract-title">Abstract</div><p>Guide to configurating and integrating OpenIDM into identity
   management solutions. The OpenIDM project offers flexible, open source
   services for automating management of the identity life cycle.</p></div></div></div><hr></div><div class="toc"><div class="toc-title">Table of Contents</div><dl><dt><span class="preface"><a href="#preface">Preface</a></span></dt><dt><span class="chapter"><a href="#chap-overview">1. Architectural Overview</a></span></dt><dt><span class="chapter"><a href="#chap-services">2. Starting &amp; Stopping OpenIDM</a></span></dt><dt><span class="chapter"><a href="#chap-configuration">3. Configuration Options</a></span></dt><dt><span class="chapter"><a href="#chap-logs">4. Configuring Server Logs</a></span></dt><dt><span class="chapter"><a href="#chap-resource-conf">5. Connecting to External Resources</a></span></dt><dt><span class="chapter"><a href="#chap-synchronization">6. Configuring Synchronization</a></span></dt><dt><span class="chapter"><a href="#chap-scheduler-conf">7. Scheduling Synchronization</a></span></dt><dt><span class="chapter"><a href="#chap-passwords">8. Managing Passwords</a></span></dt><dt><span class="chapter"><a href="#chap-auth">9. Managing Authentication, Authorization &amp; RBAC</a></span></dt><dt><span class="chapter"><a href="#chap-security">10. Securing &amp; Hardening OpenIDM</a></span></dt><dt><span class="chapter"><a href="#chap-workflow">11. Integrating Business Processes &amp; Workflow</a></span></dt><dt><span class="chapter"><a href="#chap-auditing">12. Using Audit Logs</a></span></dt><dt><span class="chapter"><a href="#chap-mail">13. Sending Email</a></span></dt><dt><span class="chapter"><a href="#chap-best-practices">14. OpenIDM Project Best Practices</a></span></dt><dt><span class="chapter"><a href="#chap-troubleshooting">15. Troubleshooting</a></span></dt><dt><span class="appendix"><a href="#appendix-file-layout">A. File Layout</a></span></dt><dt><span class="appendix"><a href="#appendix-ports-used">B. Ports Used</a></span></dt><dt><span class="appendix"><a href="#appendix-objects">C. Data Models &amp; Objects Reference</a></span></dt><dt><span class="appendix"><a href="#appendix-synchronization">D. Synchronization Reference</a></span></dt><dt><span class="appendix"><a href="#appendix-rest">E. REST API Reference</a></span></dt><dt><span class="appendix"><a href="#appendix-scripting">F. Scripting Reference</a></span></dt><dt><span class="appendix"><a href="#appendix-scheduling">G. Scheduler Reference</a></span></dt><dt><span class="appendix"><a href="#appendix-router">H. Router Service Reference</a></span></dt><dt><span class="appendix"><a href="#appendix-jetty">I. Embedded Jetty Configuration</a></span></dt><dt><span class="index"><a href="#d160e9380">Index</a></span></dt></dl></div><div lang="en" class="preface" title="Preface"><div class="titlepage"><div><div><h2 class="title"><a name="preface"></a>Preface</h2></div></div></div><p>This guide shows you how to integrate OpenIDM as part of a complete
 identity management solution.</p><div class="section" title="1.&nbsp;Who Should Use this Guide"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d160e136"></a>1.&nbsp;Who Should Use this Guide</h2></div></div></div><p>This guide is written for systems integrators building identity
  management solutions based on OpenIDM services. This guide describes
  OpenIDM, and shows you how to set up OpenIDM as part of your identity
  management solution.</p><p>You do not need to be an OpenIDM wizard to learn something from
  this guide, though a background in identity management and building
  identity management solutions can help.</p></div><div lang="en" class="section" title="2.&nbsp;Formatting Conventions"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="formatting-conventions"></a>2.&nbsp;Formatting Conventions</h2></div></div></div><p>Some items are formatted differently from other text, like
 <code class="filename">filenames</code>, <span class="command"><strong>commands</strong></span>, and
 <code class="literal">literal values</code>.</p><div class="screen">$ echo Terminal sessions are formatted with lines folded for easier reading.
 In HTML documents click the [-] image for a flat, copy-paste version. Click
 the [+] image for an expanded, line-wrapped version. &gt; /dev/null</div><p>In many cases, sections pertaining to UNIX, GNU/Linux, Mac OS X, BSD,
 and so forth are marked (UNIX). Sections pertaining to Microsoft Windows
 might be marked (Windows). To avoid repetition, however, file system
 directory names are often given only in UNIX format as in
 <code class="filename">/path/to/openidm</code>, even if the text applies to
 <code class="filename">C:\path\to\openidm</code> as well.</p><div class="programlisting"><strong class="hl-keyword">class</strong> Test
{
    <strong class="hl-keyword">public</strong> <strong class="hl-keyword">static</strong> <strong class="hl-keyword">void</strong> main(String [] args)
    {
        System.out.println(<strong class="hl-string"><em style="color: #f58220">"This is a program listing."</em></strong>);
    }
}</div></div><div lang="en" class="section" title="3.&nbsp;Accessing OpenIDM Documentation Online"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="accessing-doc-online"></a>3.&nbsp;Accessing OpenIDM Documentation Online</h2></div></div></div><p>Core documentation, such as what you are now reading, aims to
 be technically accurate and complete with respect to the software
 documented. Core documentation therefore follows a <a class="link" href="https://wikis.forgerock.org/confluence/display/devcom/Review+Process" target="_blank">three-phase review process</a> designed to eliminate errors. The
 review process should slow authors down enough that documentation you get
 with a stable release has had time to bake fully.</p><p>Fully baked core documentation is available at <a class="link" href="http://docs.forgerock.org" target="_top">docs.forgerock.org</a>.</p><p>The <a class="link" href="https://wikis.forgerock.org/confluence/display/OPENIDM/Home" target="_blank">OpenIDM Wiki</a> regularly brings you more, fresh
 content. In addition, you are welcome to <a class="link" href="https://idp.forgerock.org/openam/UI/Login?service=register" target="_blank">sign
 up</a> and then edit the Wiki if you notice an error, or if you have
 something to share.</p></div><div lang="en" class="section" title="4.&nbsp;Joining the OpenIDM Community"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="joining-the-community"></a>4.&nbsp;Joining the OpenIDM Community</h2></div></div></div><p>After you <a class="link" href="https://idp.forgerock.org/openam/UI/Login?service=register" target="_blank">sign up</a> at ForgeRock, you can also login to the Wiki and the issue
 database to follow what is happening with the project.</p><p>If you have questions regarding OpenIDM which are not answered by the
 documentation, there is a mailing list which can be found at
 <a class="link" href="https://lists.forgerock.org/mailman/listinfo/openidm" target="_blank">https://lists.forgerock.org/mailman/listinfo/openidm</a>
 where you are likely to find an answer.</p><p>The Wiki has information on how to check out OpenIDM source code.
 There is also a mailing list for OpenIDM development which can be found at
 <a class="link" href="https://lists.forgerock.org/mailman/listinfo/openidm-dev" target="_blank">https://lists.forgerock.org/mailman/listinfo/openidm-dev</a>
 Should you want to contribute a patch, test, or feature, or want to author
 part of the core documentation, first have a look on the ForgeRock site
 at <a class="link" href="http://www.forgerock.org/get_involved.html" target="_top">how to get
 involved</a>.</p></div></div><div lang="en" class="chapter" title="Chapter&nbsp;1.&nbsp;Architectural Overview"><div class="titlepage"><div><div><h2 class="title"><a name="chap-overview"></a>Chapter&nbsp;1.&nbsp;Architectural Overview</h2></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl><dt><span class="section"><a href="#openidm-modular-framework">1.1. OpenIDM Modular Framework</a></span></dt><dt><span class="section"><a href="#openidm-infrastructure-modules">1.2. Infrastructure Modules</a></span></dt><dt><span class="section"><a href="#openidm-core-services">1.3. Core Services</a></span></dt><dt><span class="section"><a href="#openidm-access-layer">1.4. Access Layer</a></span></dt></dl></div><a class="indexterm" name="d160e218"></a><p>The following figure provides an overview of the OpenIDM architecture,
  which is covered in more detail in subsequent sections of this chapter.</p><div class="mediaobject" title="OpenIDM architecture"><a name="figure-openidm2-architecture"></a><img src="images/openidm2-architecture.png" longdesc="/Users/mark/Documents/workspace/openidm-2.0.x/target/docbkx/html/integrators-guide/figure-openidm2-architecture.html"><div class="longdesc-link" align="right"><br clear="all"><span class="longdesc-link">[<a href="figure-openidm2-architecture.html" target="longdesc">D</a>]</span></div></div><div class="section" title="1.1.&nbsp;OpenIDM Modular Framework"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="openidm-modular-framework"></a>1.1.&nbsp;OpenIDM Modular Framework</h2></div></div></div><div class="variablelist"><p>The OpenIDM framework is based on OSGi.</p><dl><dt><span class="term">OSGi</span></dt><dd><p>OSGi is a module system and service platform for the Java
       programming language that implements a complete and dynamic component
       model. For a good introduction, see the <a class="link" href="http://www.osgi.org/About/WhyOSGi" target="_blank">OSGi</a> site.
       While OpenIDM services are designed to run in any OSGi container,
       OpenIDM currently runs in <a class="link" href="http://felix.apache.org/site/index.html" target="_blank">Apache
       Felix</a>.</p></dd><dt><span class="term">Servlet</span></dt><dd><p>The optional Servlet layer provides RESTful HTTP access to the
       managed objects and services. While the Servlet layer can be provided by
       many different engines, OpenIDM embeds Jetty by default.</p></dd></dl></div></div><div class="section" title="1.2.&nbsp;Infrastructure Modules"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="openidm-infrastructure-modules"></a>1.2.&nbsp;Infrastructure Modules</h2></div></div></div><div class="variablelist"><p>OpenIDM infrastructure modules provide the underlying features
     needed for core services.</p><dl><dt><span class="term">Scheduler</span></dt><dd><p>The scheduler provides a <span class="command"><strong>cron</strong></span>-like scheduling
       component implemented using the <a class="link" href="http://www.quartz-scheduler.org" target="_blank">Quartz library</a>. Use
       the scheduler, for example, to enable regular synchronizations and
       reconciliations.</p><p>See the <a href="../integrators-guide/index.html#chap-scheduler-conf" class="link"><em class="citetitle">Scheduling Synchronization</em></a> chapter
       for details.</p></dd><dt><span class="term">Script Engine</span></dt><dd><p>The script engine is a pluggable module that provides the triggers
       and plugin points for OpenIDM. OpenIDM currently implements a JavaScript
       engine.</p></dd><dt><span class="term">Audit Logging</span></dt><dd><p>Auditing logs all relevant system activity to the configured
       log stores. This includes the data from reconciliation as a basis for
       reporting, as well as detailed activity logs to capture operations on
       the internal (managed) and external (system) objects.</p><p>See the <a href="../integrators-guide/index.html#chap-auditing" class="link"><em class="citetitle">Using Audit
       Logs</em></a> chapter for details.</p></dd><dt><span class="term">Repository</span></dt><dd><p>The repository provides a common abstraction for a pluggable
       persistence layer. OpenIDM 2.0.3 supports use
       of MySQL to back the repository. Yet, plugin repositories can include
       NoSQL and relational databases, LDAP, and even flat files. The
       repository API operates using a JSON-based object model with RESTful
       principles consistent with the other OpenIDM services. The default,
       embedded implementation for the repository is the NoSQL database
       OrientDB, making it easy to evaluate OpenIDM out of the box before
       using MySQL in your production environment.</p></dd></dl></div></div><div class="section" title="1.3.&nbsp;Core Services"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="openidm-core-services"></a>1.3.&nbsp;Core Services</h2></div></div></div><div class="variablelist"><p>The core services are the heart of the OpenIDM resource oriented
     unified object model and architecture.</p><dl><dt><span class="term">Object Model</span></dt><dd><p>Artifacts handled by OpenIDM are Java object representations of
       the JavaScript object model as defined by JSON. The object model supports
       interoperability and potential integration with many applications,
       services and programming languages. As OpenIDM is a Java-based product,
       these representations are instances of classes: <code class="literal">Map</code>,
       <code class="literal">List</code>, <code class="literal">String</code>,
       <code class="literal">Number</code>, <code class="literal">Boolean</code>, and
       <code class="literal">null</code>.</p><p>OpenIDM can serialize and deserialize these structures to and from
       JSON as required. OpenIDM also exposes a set of triggers and functions
       that system administrators can define in JavaScript which can natively
       read and modify these JSON-based object model structures. OpenIDM is
       designed to support other scripting and programming languages.</p></dd><dt><span class="term">Managed Objects</span></dt><dd><a class="indexterm" name="d160e339"></a><p>A <em class="firstterm">managed object</em> is an object that
       represents the identity-related data managed by OpenIDM. Managed objects
       are configurable, JSON-based data structures OpenIDM stores in its
       pluggable repository. While the default configuration of managed objects
       is that of a user, any object may be defined through
       configuration.</p></dd><dt><span class="term">System Objects</span></dt><dd><a class="indexterm" name="d160e353"></a><p><em class="firstterm">System objects</em> are pluggable representations
       of objects on external systems. They follow the same RESTful resource
       based design principles as managed objects. There is a default
       implementation for the OpenICF framework, which allows any connector
       object to be represented as a system object.</p></dd><dt><span class="term">Mappings</span></dt><dd><a class="indexterm" name="d160e366"></a><p><em class="firstterm">Mappings</em>
       define policies between source and target objects and their attributes
       during synchronization and reconciliation. Mappings can also define
       triggers for validation, customization, filtering, and transformation
       of source and target objects.</p><p>See the <a href="../integrators-guide/index.html#chap-synchronization" class="link"><em class="citetitle">Configuring Synchronization</em></a> chapter for
       details.</p></dd><dt><span class="term">Synchronization &amp; Reconciliation</span></dt><dd><a class="indexterm" name="d160e383"></a><a class="indexterm" name="d160e386"></a><p><em class="firstterm">Reconciliation</em> provides for on-demand and
       scheduled resource comparisons between the OpenIDM managed object
       repository and source or target systems. Comparisons can result in
       different actions depending on the mappings defined between the
       systems.</p><p>Synchronization provides for creating, updating, and deleting
       resources from a source to a target system either on demand or according
       to a schedule.</p><p>See the <a href="../integrators-guide/index.html#chap-synchronization" class="link"><em class="citetitle">Configuring Synchronization</em></a> chapter for
       details.</p></dd></dl></div></div><div class="section" title="1.4.&nbsp;Access Layer"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="openidm-access-layer"></a>1.4.&nbsp;Access Layer</h2></div></div></div><div class="variablelist"><p>The access layer provides the user interfaces and public APIs for
     accessing and managing the OpenIDM repository and its functions.</p><dl><dt><span class="term">RESTful Interfaces</span></dt><dd><p>OpenIDM provides REST APIs for CRUD operations and invoking
       synchronization and reconciliation for both HTTP and Java.</p><p>See the <a href="../integrators-guide/index.html#appendix-rest" class="link"><em class="citetitle">REST
       API Reference</em></a> appendix for details.</p></dd><dt><span class="term">User Interfaces</span></dt><dd><p>User interfaces provide password management, registration,
       self-service, and workflow services.</p></dd></dl></div></div></div><div lang="en" class="chapter" title="Chapter&nbsp;2.&nbsp;Starting &amp; Stopping OpenIDM"><div class="titlepage"><div><div><h2 class="title"><a name="chap-services"></a>Chapter&nbsp;2.&nbsp;Starting &amp; Stopping OpenIDM</h2></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl><dt><span class="section"><a href="#startup-shutdown">2.1. Startup &amp; Shutdown</a></span></dt><dt><span class="section"><a href="#command-line-tools">2.2. Command-Line Tools</a></span></dt></dl></div><p>This chapter covers scripts provided for managing OpenIDM.</p><div class="section" title="2.1.&nbsp;Startup &amp; Shutdown"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="startup-shutdown"></a>2.1.&nbsp;Startup &amp; Shutdown</h2></div></div></div><a class="indexterm" name="d160e434"></a><a class="indexterm" name="d160e437"></a><p>By default you start and stop OpenIDM in interactive mode.</p><div class="itemizedlist"><p>To start OpenIDM interactively, open a terminal or command window,
   change to the <code class="filename">openidm</code> directory, and run the startup
   script:</p><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="command"><strong>startup.sh</strong></span> (UNIX)</p></li><li class="listitem"><p><span class="command"><strong>startup.bat</strong></span> (Windows)</p></li></ul></div><p>The startup script starts OpenIDM, and opens an OSGi console with a
  <code class="literal">-&gt;</code> prompt where you can issue console commands.</p><p>To stop OpenIDM interactively in the OSGi console, enter the
  <span class="command"><strong>shutdown</strong></span> command.</p><div class="screen">-&gt; shutdown</div><div class="orderedlist"><p>You can also start OpenIDM as a background process on UNIX, Linux, and
   Mac OS X. Follow these steps <span class="emphasis"><em>before starting OpenIDM for the first
   time</em></span>.</p><ol class="orderedlist" type="1"><li class="listitem"><p>If you have already started OpenIDM, then shut down OpenIDM and
    remove Felix cache files under
    <code class="filename">openidm/felix-cache/</code>.</p><div class="screen">-&gt; shutdown
...
$ rm -rf felix-cache/*</div></li><li class="listitem"><p>Disable <code class="literal">ConsoleHandler</code> logging before starting
    OpenIDM by editing <code class="filename">openidm/conf/logging.properties</code>
    to set <code class="literal">java.util.logging.ConsoleHandler.level = OFF</code>,
    and to comment out other references to <code class="literal">ConsoleHandler</code>,
    as shown in the following excerpt.</p><div class="programlisting">
# ConsoleHandler: A simple handler for writing formatted records to System.err
<span class="hl-attribute" style="color: #868686">#handlers</span>=java.util.logging.FileHandler, java.util.logging.ConsoleHandler
<span class="hl-attribute" style="color: #868686">handlers</span>=java.util.logging.FileHandler
...
# --- ConsoleHandler ---
<span class="hl-attribute" style="color: #868686"># Default: java.util.logging.ConsoleHandler.level </span>= INFO
<span class="hl-attribute" style="color: #868686">java.util.logging.ConsoleHandler.level </span>= OFF
<span class="hl-attribute" style="color: #868686">#java.util.logging.ConsoleHandler.formatter </span>= ...
<span class="hl-attribute" style="color: #868686">#java.util.logging.ConsoleHandler.filter</span>=...</div></li><li class="listitem"><p>Remove the text-based OSGi console bundle,
    <code class="filename">bundle/org.apache.felix.shell.tui-<em class="replaceable"><code>version</code></em>.jar</code>.</p></li><li class="listitem"><p>Start OpenIDM in the background.</p><div class="screen">$ ./startup.sh &amp;
[3] 454
$ ./startup.sh
Using OPENIDM_HOME:   /path/to/openidm
Using OPENIDM_OPTS:   -Xmx1024m
Using LOGGING_CONFIG:
 -Djava.util.logging.config.file=/path/to/openidm/conf/logging.properties
Using boot properties at /path/to/openidm/conf/boot/boot.properties

$</div><p>Alternatively, use the <span class="command"><strong>nohup</strong></span> command to keep
    OpenIDM running after you log out.</p><div class="screen">$ nohup ./startup.sh &amp;
[2] 394
$ appending output to nohup.out
$</div></li></ol></div><p>To stop OpenIDM running as a background process, use the
  <span class="command"><strong>shutdown.sh</strong></span> script.</p><div class="screen">$ ./shutdown.sh
./shutdown.sh
Stopping OpenIDM (454)</div></div><div class="section" title="2.2.&nbsp;Command-Line Tools"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="command-line-tools"></a>2.2.&nbsp;Command-Line Tools</h2></div></div></div><div class="variablelist"><p>OpenIDM includes these command line tools in the
   <code class="filename">openidm</code> directory.</p><dl><dt><span class="term"><span class="command"><strong>cli.sh</strong></span></span></dt><dd><p>This script supports the following subcommands.</p><div class="variablelist"><dl><dt><span class="term"><span class="command"><strong>validate</strong></span></span></dt><dd><a class="indexterm" name="d160e552"></a><p>Validate all .json configuration files in the
        <code class="filename">conf/</code> directory</p></dd></dl></div></dd><dt><span class="term"><span class="command"><strong>java -jar bundle/init/openidm-crypto-2.0.3.jar</strong></span></span></dt><dd><p>Utility to obfuscate passwords such as the bootstrap password stored
     in <code class="filename">openidm/conf/boot/boot.properties</code></p></dd><dt><span class="term"><span class="command"><strong>java -jar bundle/json-crypto-cli-1.1.0.jar</strong></span></span></dt><dd><a class="indexterm" name="d160e576"></a><p>Utility to encrypt and decrypt values in JSON objects</p></dd><dt><span class="term"><span class="command"><strong>startup.bat</strong></span>, </span><span class="term"><span class="command"><strong>startup.sh</strong></span></span></dt><dd><p>Script to start OpenIDM and the OSGi console</p></dd><dt><span class="term"><span class="command"><strong>shutdown.sh</strong></span></span></dt><dd><p>Script to stop OpenIDM, especially when you run OpenIDM as a
     background process</p></dd></dl></div></div></div><div lang="en" class="chapter" title="Chapter&nbsp;3.&nbsp;Configuration Options"><div class="titlepage"><div><div><h2 class="title"><a name="chap-configuration"></a>Chapter&nbsp;3.&nbsp;Configuration Options</h2></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl><dt><span class="section"><a href="#configuration-objects">3.1. About Configuration Objects</a></span></dt><dt><span class="section"><a href="#when-configuring-notes">3.2. When Changing the Configuration</a></span></dt><dt><span class="section"><a href="#configuring-over-rest">3.3. Configuring OpenIDM Over REST</a></span></dt></dl></div><p>OpenIDM configuration is split between <code class="filename">.properties</code> and container
 configuration files, and also dynamic configuration objects. The majority
 of OpenIDM configuration files are stored under
 <code class="filename">openidm/conf/</code>, as described in the appendix listing the
 <a href="../integrators-guide/index.html#appendix-file-layout" class="link"><em class="citetitle">File
 Layout</em></a>.</p><p>OpenIDM stores configuration objects in its internal repository.
 You can manage the configuration by using either the REST access to the
 configuration objects, or by using the JSON file based views</p><div class="section" title="3.1.&nbsp;About Configuration Objects"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="configuration-objects"></a>3.1.&nbsp;About Configuration Objects</h2></div></div></div><a class="indexterm" name="d160e619"></a><a class="indexterm" name="d160e624"></a><p>OpenIDM exposes internal configuration objects in JSON. Configuration
  elements can be either have single instances or multiple instances for
  an OpenIDM installation.</p><div class="itemizedlist" title="Single Instance Configuration Objects"><a name="single-instance-configuration-objects"></a><div class="itemizedlist-title">Single Instance Configuration Objects</div><p>Single instance configuration objects correspond to services that have
   at most one instance per installation.</p><p>JSON file views of these configuration objects are named
   <code class="filename"><em class="replaceable"><code>object-name</code></em>.json</code>.</p><ul class="itemizedlist" type="disc"><li class="listitem"><p>The <code class="literal">audit</code> configuration specifies how audit
    events are logged.</p></li><li class="listitem"><p>The <code class="literal">authentication</code> configuration controls
    REST access.</p></li><li class="listitem"><p>The <code class="literal">managed</code> configuration defines managed
    objects and their schemas.</p></li><li class="listitem"><p>The <code class="literal">repo.<em class="replaceable"><code>repo-type</code></em></code>
    configuration such as <code class="literal">repo.orientdb</code> or
    <code class="literal">repo.jdbc</code> configures the internal repository.</p></li><li class="listitem"><p>The <code class="literal">router</code> configuration specifies filters to
    apply for specific operations.</p></li><li class="listitem"><p>The <code class="literal">sync</code> configuration defines all the mappings
    OpenIDM uses when synchronizing and reconciling managed objects.</p></li></ul></div><div class="itemizedlist" title="Multiple Instance Configuration Objects"><a name="multiple-instance-configuration-objects"></a><div class="itemizedlist-title">Multiple Instance Configuration Objects</div><p>Multiple instance configuration objects correspond to services that
   can have many instances per installation.</p><p><span class="emphasis"><em>Configuration objects</em></span> are named
   <code class="literal"><em class="replaceable"><code>objectname</code></em>/<em class="replaceable"><code>instancename</code></em></code>. For instance <code class="filename">provisioner.openicf/xml</code>.</p><p><span class="emphasis"><em>JSON file</em></span> views of these configuration objects are named
   <code class="filename"><em class="replaceable"><code>objectname</code></em>-<em class="replaceable"><code>instancename</code></em>.json</code>. For instance <code class="filename">provisioner.openicf-xml.json.</code></p><ul class="itemizedlist" type="disc"><li class="listitem"><p>Multiple <code class="literal">scheduler</code> configurations can run
    reconciliations on different schedules.</p></li><li class="listitem"><p>Multiple <code class="literal">provisioner.openicf</code> configurations
    correspond to the resources connected to OpenIDM.</p></li></ul></div></div><div class="section" title="3.2.&nbsp;When Changing the Configuration"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="when-configuring-notes"></a>3.2.&nbsp;When Changing the Configuration</h2></div></div></div><div class="itemizedlist"><p>When changing OpenIDM's configuration objects, take the following
   points into account.</p><ul class="itemizedlist" type="disc"><li class="listitem"><p>OpenIDM's authoritative configuration source is the internal
    repository. JSON files provide a view of the configuration objects, but
    do not represent the authoritative source.</p><p>OpenIDM updates JSON files after making configuration changes,
    whether those changes are made through REST access to configuration
    objects, or through edits to the JSON files.</p></li><li class="listitem"><p>OpenIDM recognizes changes to JSON files when it is running. OpenIDM
    must be running when you delete configuration objects, even if you do so
    by editing the JSON files.</p></li><li class="listitem"><p>Avoid directly editing configuration objects in the internal
    repository. Use either REST access or JSON files to ensure consistent
    behavior and that operations are logged.</p></li></ul></div></div><div class="section" title="3.3.&nbsp;Configuring OpenIDM Over REST"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="configuring-over-rest"></a>3.3.&nbsp;Configuring OpenIDM Over REST</h2></div></div></div><a class="indexterm" name="d160e752"></a><a class="indexterm" name="d160e755"></a><p>OpenIDM exposes configuration objects under the
  <code class="literal">/openidm/config</code> context.</p><a class="indexterm" name="d160e765"></a><p>You can list the configuration on the local host by performing a GET
  <code class="literal">http://localhost:8080/openidm/config</code>.</p><div class="screen">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 http://localhost:8080/openidm/config

{
    "configurations": [
        {
            "_id": "managed",
            "pid": "managed",
            "factoryPid": null
        },
        {
            "_id": "repo.orientdb",
            "pid": "repo.orientdb",
            "factoryPid": null
        },
        {
            "_id": "scheduler/reconcile_systemXmlAccounts_managedUser",
            "pid": "scheduler.adc5cd2f-7086-4e30-9d80-b36077861868",
            "factoryPid": "scheduler"
        },
        {
            "_id": "org.apache.felix.fileinstall/openidm",
            "pid":
            "org.apache.felix.fileinstall.abb696a2-95c6-4432-ae74-ba60a319d1bb",
            "factoryPid": "org.apache.felix.fileinstall"
        },
        {
            "_id": "sync",
            "pid": "sync",
            "factoryPid": null
        },
        {
            "_id": "audit",
            "pid": "audit",
            "factoryPid": null
        },
        {
            "_id": "provisioner.openicf/xml",
            "pid": "provisioner.openicf.10e2dd6d-442d-466c-a077-643bb53e2006",
            "factoryPid": "provisioner.openicf"
        },
        {
            "_id": "router",
            "pid": "router",
            "factoryPid": null
        },
        {
            "_id": "authentication",
            "pid": "authentication",
            "factoryPid": null
        }
    ]
}</div><p>You can find single instance configuration objects under
  <code class="literal">openidm/config/<em class="replaceable"><code>object-name</code></em></code>.
  The following example shows the default <code class="literal">audit</code>
  configuration.</p><div class="screen">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 http://localhost:8080/openidm/config/audit

{
    "eventTypes": {
        "activity": {
            "filter": {
                "actions": [
                    "create",
                    "update",
                    "delete",
                    "patch",
                    "action"
                ]
            }
        },
        "recon": {}
    },
    "logTo": [
        {
            "logType": "csv",
            "location": "audit",
            "recordDelimiter": ";"
        },
        {
            "logType": "repository"
        }
    ]
}</div><p>Multiple instance configuration objects are found under
  <code class="literal">openidm/config/<em class="replaceable"><code>object-name</code></em>/<em class="replaceable"><code>instance-name</code></em></code>.
  The following example shows the configuration for the XML connector
  provisioner.</p><div class="screen">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 http://localhost:8080/openidm/config/provisioner.openicf/xml

{
    "name": "xmlfile",
    "connectorRef": {
        "bundleName":
            "org.forgerock.openicf.connectors.file.openicf-xml-connector",
        "bundleVersion": "1.1.0.0",
        "connectorName": "com.forgerock.openicf.xml.XMLConnector"
    },
    "producerBufferSize": 100,
    "connectorPoolingSupported": true,
    "poolConfigOption": {
        "maxObjects": 10,
        "maxIdle": 10,
        "maxWait": 150000,
        "minEvictableIdleTimeMillis": 120000,
        "minIdle": 1
    },
    "operationTimeout": {
        "CREATE": -1,
        "TEST": -1,
        "AUTHENTICATE": -1,
        "SEARCH": -1,
        "VALIDATE": -1,
        "GET": -1,
        "UPDATE": -1,
        "DELETE": -1,
        "SCRIPT_ON_CONNECTOR": -1,
        "SCRIPT_ON_RESOURCE": -1,
        "SYNC": -1,
        "SCHEMA": -1
    },
    "configurationProperties": {
        "xsdIcfFilePath": "samples/sample1/data/resource-schema-1.xsd",
        "xsdFilePath": "samples/sample1/data/resource-schema-extension.xsd",
        "xmlFilePath": "samples/sample1/data/xmlConnectorData.xml"
    },
    "objectTypes": {
        "account": {
            "$schema": "http://json-schema.org/draft-03/schema",
            "id": "__ACCOUNT__",
            "type": "object",
            "nativeType": "__ACCOUNT__",
            "properties": {
                "description": {
                    "type": "string",
                    "nativeName": "__DESCRIPTION__",
                    "nativeType": "string"
                },
                "firstname": {
                    "type": "string",
                    "nativeName": "firstname",
                    "nativeType": "string"
                },
                "email": {
                    "type": "array",
                    "items": {
                        "type": "string",
                        "nativeType": "string"
                    },
                    "nativeName": "email",
                    "nativeType": "string"
                },
                "__UID__": {
                    "type": "string",
                    "nativeName": "__UID__"
                },
                "password": {
                    "type": "string",
                    "required": false,
                    "nativeName": "__PASSWORD__",
                    "nativeType": "JAVA_TYPE_GUARDEDSTRING",
                    "flags": [
                        "NOT_READABLE",
                        "NOT_RETURNED_BY_DEFAULT"
                    ]
                },
                "name": {
                    "type": "string",
                    "required": true,
                    "nativeName": "__NAME__",
                    "nativeType": "string"
                },
                "lastname": {
                    "type": "string",
                    "required": true,
                    "nativeName": "lastname",
                    "nativeType": "string"
                }
            }
        }
    },
    "operationOptions": {}
}</div><p>See the <a href="../integrators-guide/index.html#appendix-rest" class="link"><em class="citetitle">REST API
  Reference</em></a> appendix for additional details and
  examples using REST access to update and patch objects.</p></div></div><div lang="en" class="chapter" title="Chapter&nbsp;4.&nbsp;Configuring Server Logs"><div class="titlepage"><div><div><h2 class="title"><a name="chap-logs"></a>Chapter&nbsp;4.&nbsp;Configuring Server Logs</h2></div></div></div><a class="indexterm" name="d160e811"></a><p>This chapter briefly describes server logging. For audit information,
 see the chapter on <a href="../integrators-guide/index.html#chap-auditing" class="link"><em class="citetitle">Using Audit
 Logs</em></a>.</p><p>You can configure logging by editing the
 <code class="filename">openidm/conf/logging.properties</code> file in
 OpenIDM.</p><p>The default configuration writes log messages in simple format to
 <code class="filename">openidm/logs/openidm*.log</code> files, rotating files when
 the size reaches 5 MB, and retaining up to 5 files. Also by default,
 OpenIDM writes all system and custom log messages to the files.</p><p>You can update the configuration to attach loggers to individual
 packages, setting the log level to using the following values.</p><div class="programlisting">
SEVERE (highest value)
WARNING
INFO
CONFIG
FINE
FINER
FINEST (lowest value)</div></div><div lang="en" class="chapter" title="Chapter&nbsp;5.&nbsp;Connecting to External Resources"><div class="titlepage"><div><div><h2 class="title"><a name="chap-resource-conf"></a>Chapter&nbsp;5.&nbsp;Connecting to External Resources</h2></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl><dt><span class="section"><a href="#openidm-openicf">5.1. About OpenIDM &amp; OpenICF</a></span></dt><dt><span class="section"><a href="#connector-info-provider-conf">5.2. Accessing Remote Connectors</a></span></dt><dt><span class="section"><a href="#openicf-provisioner-conf">5.3. Configuring Connectors</a></span></dt><dt><span class="section"><a href="#connector-examples">5.4. Connector Configuration Examples</a></span></dt><dt><span class="section"><a href="#connector-wiz">5.5. Creating Default Connector Configurations</a></span></dt></dl></div><a class="indexterm" name="d160e838"></a><a class="indexterm" name="d160e841"></a><a class="indexterm" name="d160e844"></a><p>This chapter describes how to connect to external resources such
 as LDAP, Active Directory, flat files, and others. Configurations shown
 here are simplified to show essential aspects. Not all resources support
 all OpenIDM operations, however the resources shown here support
 most of the CRUD operations, and also reconciliation and LiveSync.</p><p>In OpenIDM, <em class="firstterm">resources</em> are external systems,
 databases, directory servers, and other sources of identity data to be managed
 and audited by the identity management system. OpenIDM connects to resources
 through the identity connector framework, <a class="link" href="http://openicf.forgerock.org/" target="_blank">OpenICF</a>. OpenICF aims to
 avoid the need to install agents to access resources, instead using the
 resources' native protocols. For example, OpenICF connects to database
 resources using the database's Java connection libraries or JDBC driver.
 It connects to directory servers over JNDI. It connects to UNIX systems
 by using <span class="command"><strong>ssh</strong></span>.</p><p>Connectors are configured through files named
 <code class="filename">openidm/conf/provisioner.openicf-<em class="replaceable"><code>name</code></em></code>
 where <em class="replaceable"><code>name</code></em> corresponds to the name of the
 connector. <span class="emphasis"><em>Do not include dash characters ( <code class="literal">-</code> )
 in the connector <em class="replaceable"><code>name</code></em>.</em></span></p><div class="section" title="5.1.&nbsp;About OpenIDM &amp; OpenICF"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="openidm-openicf"></a>5.1.&nbsp;About OpenIDM &amp; OpenICF</h2></div></div></div><p>The following figure shows how OpenIDM can connect to resources
  through an OpenICF server. In most cases, the OpenICF server runs as part
  of OpenIDM.</p><div class="mediaobject" title="OpenICF architecture"><a name="figure-openicfarch"></a><img src="images/OpenICFArch.png" longdesc="/Users/mark/Documents/workspace/openidm-2.0.x/target/docbkx/html/integrators-guide/figure-openicfarch.html"><div class="longdesc-link" align="right"><br clear="all"><span class="longdesc-link">[<a href="figure-openicfarch.html" target="longdesc">D</a>]</span></div></div><p>OpenICF provides a common service provider interface to allow identity
  services access to the resources containing user information. OpenICF uses
  a connection server that can run as a local connector server inside OpenIDM,
  or as a remote connector server that is a stand-alone process.</p><p>A remote connector server is needed when access
  libraries that cannot be included as part of the OpenIDM process are needed. If a
  resource, such as Microsoft ADSI, does not provide a connection library that
  can be included inside the Java Virtual Machine, then OpenICF can use the
  native .dll with a remote .NET connector server. (OpenICF connects to ADSI through
  a remote connector server implemented as a .NET service.)</p><div class="tip" title="Tip" style="font-style: italic;"><h3 class="title">Tip</h3><p>Not only .NET connector servers but also Java connector
   servers can be run as stand alone, remote services. Run them as remote services for
   scalability, or to have the service run in the cloud.</p><p>By default and for convenience, OpenIDM includes a Java connector
   server that runs as a <code class="literal">"#LOCAL"</code> service.</p></div></div><div class="section" title="5.2.&nbsp;Accessing Remote Connectors"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="connector-info-provider-conf"></a>5.2.&nbsp;Accessing Remote Connectors</h2></div></div></div><a class="indexterm" name="d160e906"></a><p>When configuring remote connectors, the connector info provider
  service to connect through remote connector servers must be used. The configuration is
  stored in the the configuration file,
  <code class="filename">openidm/conf/provisioner.openicf.connectorinfoprovider.json</code>.
  A sample can be found under <code class="filename">openidm/samples/provisioners/</code>.</p><p>The connector info provider service takes this configuration.</p><div class="programlisting">
{
  <strong class="hl-string"><em style="color: #f58220">"connectorsLocation"</em></strong>     : <em class="replaceable"><code>string</code></em>,
  <strong class="hl-string"><em style="color: #f58220">"remoteConnectorServers"</em></strong> : [<em class="replaceable"><code>remoteConnectorServer objects</code></em>]
}</div><div class="variablelist" title="Connector Info Provider Properties"><div class="variablelist-title">Connector Info Provider Properties</div><dl><dt><span class="term">connectorsLocation</span></dt><dd><p>string, optional</p><p>Specifies the directory where OpenICF connectors are located. The
     default location is <code class="filename">openidm/connectors</code>.
     </p></dd><dt><span class="term"><a class="link" href="#remote-connector-server-object-properties" title="Remote Connector Server Properties">remoteConnectorServers</a></span></dt><dd><p>array of RemoteConnectorServer objects, optional</p><p>A list of remote connector servers managed by this service.</p></dd></dl></div><div class="variablelist" title="Remote Connector Server Properties"><a name="remote-connector-server-object-properties"></a><div class="variablelist-title">Remote Connector Server Properties</div><p>The following example shows a <code class="literal">remoteConnectorServer</code>
  object configuration.</p><div class="programlisting">
{
  <strong class="hl-string"><em style="color: #f58220">"name"</em></strong>          : <strong class="hl-string"><em style="color: #f58220">"testServer"</em></strong>,
  <strong class="hl-string"><em style="color: #f58220">"host"</em></strong>          : <strong class="hl-string"><em style="color: #f58220">"127.0.0.1"</em></strong>,
  <strong class="hl-string"><em style="color: #f58220">"port"</em></strong>          : <span class="hl-number">8759</span>,
  <strong class="hl-string"><em style="color: #f58220">"useSSL"</em></strong>        : false,
  <strong class="hl-string"><em style="color: #f58220">"timeout"</em></strong>       : <span class="hl-number">0</span>,
  <strong class="hl-string"><em style="color: #f58220">"key"</em></strong>           : <strong class="hl-string"><em style="color: #f58220">"Passw0rd"</em></strong>,
  <strong class="hl-string"><em style="color: #f58220">"trustManagers"</em></strong> :
    [
       <strong class="hl-string"><em style="color: #f58220">"X509TrustManager"</em></strong>,
       <strong class="hl-string"><em style="color: #f58220">"BlindTrustManager"</em></strong>
    ]
}</div><p>OpenIDM supports the following remote connector server object
  properties.</p><dl><dt><span class="term">name</span></dt><dd><p>string, required</p><p>The name of the remote connector server object. Used to identify the
    remote connector server in connector reference objects.</p></dd><dt><span class="term">host</span></dt><dd><p>string, required</p><p>Remote host to connect to.</p></dd><dt><span class="term">port</span></dt><dd><p>string, optional</p><p>
     Remote port to connect to. Default value: 8759</p></dd><dt><span class="term">useSSL</span></dt><dd><p>boolean, optional</p><p>Specifies to use or not SSL to connect. Default value:
    <code class="literal">false</code></p></dd><dt><span class="term">timeout</span></dt><dd><p>integer, optional</p><p>Specifies the timeout (in milliseconds) to use for the connection.
    Default value: 0</p></dd><dt><span class="term">key</span></dt><dd><p>string, required</p><p>The secret key to use to authenticate to the remote connector
    server.</p></dd><dt><span class="term">trustManagers</span></dt><dd><p>not specified</p><p>Not implemented yet. The service uses the default JVM
    <code class="literal">TrustManager</code>.</p></dd></dl></div></div><div class="section" title="5.3.&nbsp;Configuring Connectors"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="openicf-provisioner-conf"></a>5.3.&nbsp;Configuring Connectors</h2></div></div></div><p>Connectors are configured through the OpenICF provisioner service. Each configuration is stored in an extra file/object in the  <code class="filename">openidm/conf/</code> folder or under the same URL respectively. The file name convention is <code class="filename">provisioner.openicf-<em class="replaceable"><code>name</code></em>.json</code>.</p><div class="note" title="Note" style="font-style: italic;"><h3 class="title">Note</h3><p>Though the <em class="replaceable"><code>name</code></em> part of the file name is free text, it must not contain any "-" character!</p></div><p>The following example shows an OpenICF provisioner service
  configuration.</p><div class="programlisting">{
 <strong class="hl-string"><em style="color: #f58220">"name"</em></strong>                    : <strong class="hl-string"><em style="color: #f58220">"xml"</em></strong>,
 <strong class="hl-string"><em style="color: #f58220">"connectorRef"</em></strong>            : <a class="link" href="#connector-reference" title="Connector Reference">connector-ref-object</a>,
 <strong class="hl-string"><em style="color: #f58220">"poolConfigOption"</em></strong>        : <a class="link" href="#pool-configuration-option" title="Pool Configuration Option">pool-config-option-object</a>,
 <strong class="hl-string"><em style="color: #f58220">"operationTimeout"</em></strong>        : <a class="link" href="#operation-timeout" title="Operation Timeout">operation-timeout-object</a>,
 <strong class="hl-string"><em style="color: #f58220">"configurationProperties"</em></strong> : <a class="link" href="#configuration-properties" title="Configuration Properties">configuration-properties-object</a>,
 <strong class="hl-string"><em style="color: #f58220">"objectTypes"</em></strong>             : <a class="link" href="#object-types" title="Object Types">object-types-object</a>,
 <strong class="hl-string"><em style="color: #f58220">"operationOptions"</em></strong>        : <a class="link" href="#operation-options" title="Operation Options">operation-options-object</a>
}</div><div class="variablelist" title="Connector Reference"><a name="connector-reference"></a><div class="variablelist-title">Connector Reference</div><p>The following example shows a connector reference object.</p><div class="programlisting">
{
  <strong class="hl-string"><em style="color: #f58220">"bundleName"</em></strong>       : <strong class="hl-string"><em style="color: #f58220">"org.forgerock.openicf.connectors.file.xml"</em></strong>,
  <strong class="hl-string"><em style="color: #f58220">"bundleVersion"</em></strong>    : <strong class="hl-string"><em style="color: #f58220">"1.1.0.0"</em></strong>,
  <strong class="hl-string"><em style="color: #f58220">"connectorName"</em></strong>    : <strong class="hl-string"><em style="color: #f58220">"com.forgerock.openicf.xml.XMLConnector"</em></strong>,
  <strong class="hl-string"><em style="color: #f58220">"connectorHostRef"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"host"</em></strong>
}</div><dl><dt><span class="term">bundleName</span></dt><dd><p>string, required</p><p>The <em class="replaceable"><code>ConnectorBundle-Name</code></em> of the OpenICF
     connector.</p></dd><dt><span class="term">bundleVersion</span></dt><dd><p>string, required</p><p>The <em class="replaceable"><code>ConnectorBundle-Version</code></em> of the
     OpenICF connector.</p></dd><dt><span class="term">connectorName</span></dt><dd><p>string, required</p><p>The Connector implementation class name.</p></dd><dt><span class="term">connectorHostRef</span></dt><dd><p>string, optional</p><p>The name of the RemoteConnectorServer object.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>If the connector server is local and the connector .jar is
       installed in <code class="filename">openidm/bundle/</code> (currently not recommended), then the value
       must be
       <code class="literal">"osgi:service/org.forgerock.openicf.framework.api.osgi.ConnectorManager"</code>.</p></li><li class="listitem"><p>If the connector server is local and the connector .jar is
       installed in <code class="filename">openidm/connectors/</code>, then the value
       must be <code class="literal">"#LOCAL"</code>. This is currently the default location.</p></li></ul></div></dd></dl></div><div class="variablelist" title="Pool Configuration Option"><a name="pool-configuration-option"></a><div class="variablelist-title">Pool Configuration Option</div><p>The following example shows a pool configuration option object
   for the connection pool between OpenIDM and the OpenICF connector
   server.</p><div class="programlisting">
{
  <strong class="hl-string"><em style="color: #f58220">"maxObjects"</em></strong>                 : <span class="hl-number">10</span>,
  <strong class="hl-string"><em style="color: #f58220">"maxIdle"</em></strong>                    : <span class="hl-number">10</span>,
  <strong class="hl-string"><em style="color: #f58220">"maxWait"</em></strong>                    : <span class="hl-number">150000</span>,
  <strong class="hl-string"><em style="color: #f58220">"minEvictableIdleTimeMillis"</em></strong> : <span class="hl-number">120000</span>,
  <strong class="hl-string"><em style="color: #f58220">"minIdle"</em></strong>                    : <span class="hl-number">1</span>
}</div><dl><dt><span class="term">maxObjects</span></dt><dd><p>Maximum number of idle and active objects.</p></dd><dt><span class="term">maxIdle</span></dt><dd><p>Maximum number of idle objects</p></dd><dt><span class="term">maxWait</span></dt><dd><p>The maximum time in milliseconds which the pool waits for an object
     before timing out. Zero means never time out.</p></dd><dt><span class="term">minEvictableIdleTimeMillis</span></dt><dd><p>Maximum time in milliseconds an object can be idle before it is
     removed. Zero means never time out.</p></dd><dt><span class="term">minIdle</span></dt><dd><p>The minimum number of idle objects.</p></dd></dl></div><div class="variablelist" title="Operation Timeout"><a name="operation-timeout"></a><div class="variablelist-title">Operation Timeout</div><p>This configuration sets the timeout per operation type.</p><div class="programlisting">
{
  <strong class="hl-string"><em style="color: #f58220">"CREATE"</em></strong>              : -<span class="hl-number">1</span>,
  <strong class="hl-string"><em style="color: #f58220">"TEST"</em></strong>                : -<span class="hl-number">1</span>,
  <strong class="hl-string"><em style="color: #f58220">"AUTHENTICATE"</em></strong>        : -<span class="hl-number">1</span>,
  <strong class="hl-string"><em style="color: #f58220">"SEARCH"</em></strong>              : -<span class="hl-number">1</span>,
  <strong class="hl-string"><em style="color: #f58220">"VALIDATE"</em></strong>            : -<span class="hl-number">1</span>,
  <strong class="hl-string"><em style="color: #f58220">"GET"</em></strong>                 : -<span class="hl-number">1</span>,
  <strong class="hl-string"><em style="color: #f58220">"UPDATE"</em></strong>              : -<span class="hl-number">1</span>,
  <strong class="hl-string"><em style="color: #f58220">"DELETE"</em></strong>              : -<span class="hl-number">1</span>,
  <strong class="hl-string"><em style="color: #f58220">"SCRIPT_ON_CONNECTOR"</em></strong> : -<span class="hl-number">1</span>,
  <strong class="hl-string"><em style="color: #f58220">"SCRIPT_ON_RESOURCE"</em></strong>  : -<span class="hl-number">1</span>,
  <strong class="hl-string"><em style="color: #f58220">"SYNC"</em></strong>                : -<span class="hl-number">1</span>,
  <strong class="hl-string"><em style="color: #f58220">"SCHEMA"</em></strong>              : -<span class="hl-number">1</span>
}</div><dl><dt><span class="term"><em class="replaceable"><code>operation-name</code></em></span></dt><dd><p>Timeout in milliseconds</p><p>A value of <code class="literal">-1</code> disables the timeout.</p></dd></dl></div><div class="variablelist" title="Configuration Properties"><a name="configuration-properties"></a><div class="variablelist-title">Configuration Properties</div><p>This object contains the configuration for the connection between
   the connection server and the resource, and is therefore resource
   specific.</p><p>The following example shows a configuration properties object for
   the default XML sample resource connector.</p><div class="programlisting">
{
  <strong class="hl-string"><em style="color: #f58220">"xsdIcfFilePath"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"samples/sample1/data/resource-schema-1.xsd"</em></strong>,
  <strong class="hl-string"><em style="color: #f58220">"xsdFilePath"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"samples/sample1/data/resource-schema-extension.xsd"</em></strong>,
  <strong class="hl-string"><em style="color: #f58220">"xmlFilePath"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"samples/sample1/data/xmlConnectorData.xml"</em></strong>
 }</div><dl><dt><span class="term"><em class="replaceable"><code>property</code></em></span></dt><dd><p>Individual properties depend on the type of connector.</p></dd></dl></div><div class="variablelist" title="Object Types"><a name="object-types"></a><div class="variablelist-title">Object Types</div><a class="indexterm" name="d160e1206"></a><p>This configuration object specifies the supported object types. The
   property name defines the <code class="literal">objectType</code> used in the
   URI: <code class="literal">system/$<em class="replaceable"><code>systemName</code></em>/$<em class="replaceable"><code>objectType</code></em></code></p><p>The configuration is based on <a class="link" href="http://tools.ietf.org/html/draft-zyp-json-schema-03" target="_blank">JSON
   Schema</a> with extensions described below.</p><p>Attribute names which start and/or end with <code class="literal">__</code> are
   resource type specific attributes used by OpenICF for particular
   purposes, such as <code class="literal">__NAME__</code> as the naming attribute
   for objects on a resource.</p><div class="programlisting">
{
  <strong class="hl-string"><em style="color: #f58220">"account"</em></strong> :
  {
    <strong class="hl-string"><em style="color: #f58220">"$schema"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"http://json-schema.org/draft-03/schema"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"id"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"__ACCOUNT__"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"type"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"object"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"nativeType"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"__ACCOUNT__"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"properties"</em></strong> :
    {
      <strong class="hl-string"><em style="color: #f58220">"name"</em></strong> :
      {
        <strong class="hl-string"><em style="color: #f58220">"type"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"string"</em></strong>,
        <strong class="hl-string"><em style="color: #f58220">"nativeName"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"__NAME__"</em></strong>,
        <strong class="hl-string"><em style="color: #f58220">"nativeType"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"JAVA_TYPE_PRIMITIVE_LONG"</em></strong>,
        <strong class="hl-string"><em style="color: #f58220">"flags"</em></strong> :
        [
          <strong class="hl-string"><em style="color: #f58220">"NOT_CREATABLE"</em></strong>,
          <strong class="hl-string"><em style="color: #f58220">"NOT_UPDATEABLE"</em></strong>,
          <strong class="hl-string"><em style="color: #f58220">"NOT_READABLE"</em></strong>,
          <strong class="hl-string"><em style="color: #f58220">"NOT_RETURNED_BY_DEFAULT"</em></strong>
        ]
      },
      <strong class="hl-string"><em style="color: #f58220">"groups"</em></strong> :
      {
        <strong class="hl-string"><em style="color: #f58220">"type"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"array"</em></strong>,
        <strong class="hl-string"><em style="color: #f58220">"items"</em></strong> :
        {
          <strong class="hl-string"><em style="color: #f58220">"type"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"string"</em></strong>,
          <strong class="hl-string"><em style="color: #f58220">"nativeType"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"string"</em></strong>
        },
        <strong class="hl-string"><em style="color: #f58220">"nativeName"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"__GROUPS__"</em></strong>,
        <strong class="hl-string"><em style="color: #f58220">"nativeType"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"string"</em></strong>,
        <strong class="hl-string"><em style="color: #f58220">"flags"</em></strong> :
        [
          <strong class="hl-string"><em style="color: #f58220">"NOT_RETURNED_BY_DEFAULT"</em></strong>
        ]
      },                
      <strong class="hl-string"><em style="color: #f58220">"givenName"</em></strong> : {
         <strong class="hl-string"><em style="color: #f58220">"type"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"string"</em></strong>,
         <strong class="hl-string"><em style="color: #f58220">"nativeName"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"givenName"</em></strong>,
         <strong class="hl-string"><em style="color: #f58220">"nativeType"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"string"</em></strong>
         },
    }
  }
}</div><dl><dt><span class="term">Object Level Extensions</span></dt><dd><div class="variablelist"><dl><dt><span class="term">nativeType</span></dt><dd><p>string, optional</p><p>The native OpenICF object type.</p></dd></dl></div></dd><dt><span class="term">Property Level Extensions</span></dt><dd><div class="variablelist"><dl><dt><span class="term">nativeType</span></dt><dd><p>string, optional</p><p>The native OpenICF attribute type.</p></dd><dt><span class="term">nativeName</span></dt><dd><p>string, optional</p><p>The native OpenICF attribute name.</p></dd><dt><span class="term">flags</span></dt><dd><p>string, optional</p><p>The native OpenICF attribute flags. The
        <em class="replaceable"><code>required</code></em> and
        <em class="replaceable"><code>multivalued</code></em> flags are defined by the JSON
        schema.</p><pre class="literallayout"><em class="replaceable"><code>required</code></em> = <code class="literal">"required" : true</code></pre><pre class="literallayout"><em class="replaceable"><code>multivalued</code></em> = <code class="literal">"type" : "array"</code></pre></dd></dl></div></dd></dl></div><div class="note" title="Note" style="font-style: italic;"><h3 class="title">Note</h3><p>Avoid using the dash character ( <code class="literal">-</code> ) in property
   names, like <code class="literal">last-name</code>, as dashes in names make
   JavaScript syntax more complex. If you cannot avoid the dash, then write
   <code class="literal">source['last-name']</code> instead of
   <code class="literal">source.last-name</code> in the java script scripts.</p></div><div class="variablelist" title="Operation Options"><a name="operation-options"></a><div class="variablelist-title">Operation Options</div><p>Operation options define how to act on specified operations.
   You can for example deny operations on specific resources to avoid
   OpenIDM accidentally updating a read-only resource during a synchronization
   operation.</p><div class="programlisting">
{
  <strong class="hl-string"><em style="color: #f58220">"SYNC"</em></strong> :
  {
    <strong class="hl-string"><em style="color: #f58220">"denied"</em></strong> : true,
    <strong class="hl-string"><em style="color: #f58220">"onDeny"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"DO_NOTHING"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"objectFeatures"</em></strong> :
    {
      <strong class="hl-string"><em style="color: #f58220">"__ACCOUNT__"</em></strong> :
      {
        <strong class="hl-string"><em style="color: #f58220">"denied"</em></strong> : true,
        <strong class="hl-string"><em style="color: #f58220">"onDeny"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"THROW_EXCEPTION"</em></strong>,
        <strong class="hl-string"><em style="color: #f58220">"operationOptionInfo"</em></strong> :
        {
          <strong class="hl-string"><em style="color: #f58220">"$schema"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"http://json-schema.org/draft-03/schema"</em></strong>,
          <strong class="hl-string"><em style="color: #f58220">"id"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"FIX_ME"</em></strong>,
          <strong class="hl-string"><em style="color: #f58220">"type"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"object"</em></strong>,
          <strong class="hl-string"><em style="color: #f58220">"properties"</em></strong> :
          {
            <strong class="hl-string"><em style="color: #f58220">"_OperationOption-float"</em></strong> :
            {
               <strong class="hl-string"><em style="color: #f58220">"type"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"number"</em></strong>,
               <strong class="hl-string"><em style="color: #f58220">"nativeType"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"JAVA_TYPE_PRIMITIVE_FLOAT"</em></strong>
            }
          }
        }
      },
      <strong class="hl-string"><em style="color: #f58220">"__GROUP__"</em></strong> :
      {
        <strong class="hl-string"><em style="color: #f58220">"denied"</em></strong> : false,
        <strong class="hl-string"><em style="color: #f58220">"onDeny"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"DO_NOTHING"</em></strong>
      }
    }
  }
}</div><div class="itemizedlist"><p>The list of operations is as follows.</p><ul class="itemizedlist" type="disc"><li class="listitem"><p><code class="literal">AUTHENTICATE</code>: <a class="link" href="http://openicf.forgerock.org/connector-framework/apidocs/org/identityconnectors/framework/api/operations/AuthenticationApiOp.html" target="_blank">AuthenticationApiOp</a></p></li><li class="listitem"><p><code class="literal">CREATE</code>: <a class="link" href="http://openicf.forgerock.org/connector-framework/apidocs/org/identityconnectors/framework/api/operations/CreateApiOp.html" target="_blank">CreateApiOp</a></p></li><li class="listitem"><p><code class="literal">DELETE</code>: <a class="link" href="http://openicf.forgerock.org/connector-framework/apidocs/org/identityconnectors/framework/api/operations/DeleteApiOp.html" target="_blank">DeleteApiOp</a></p></li><li class="listitem"><p><code class="literal">GET</code>: <a class="link" href="http://openicf.forgerock.org/connector-framework/apidocs/org/identityconnectors/framework/api/operations/GetApiOp.html" target="_blank">GetApiOp</a></p></li><li class="listitem"><p><code class="literal">RESOLVEUSERNAME</code>: <a class="link" href="http://openicf.forgerock.org/connector-framework/apidocs/org/identityconnectors/framework/api/operations/ResolveUsernameApiOp.html" target="_blank">ResolveUsernameApiOp</a></p></li><li class="listitem"><p><code class="literal">SCHEMA</code>: <a class="link" href="http://openicf.forgerock.org/connector-framework/apidocs/org/identityconnectors/framework/api/operations/SchemaApiOp.html" target="_blank">SchemaApiOp</a></p></li><li class="listitem"><p><code class="literal">SCRIPT_ON_CONNECTOR</code>: <a class="link" href="http://openicf.forgerock.org/connector-framework/apidocs/org/identityconnectors/framework/api/operations/ScriptOnConnectorApiOp.html" target="_blank">ScriptOnConnectorApiOp</a></p></li><li class="listitem"><p><code class="literal">SCRIPT_ON_RESOURCE</code>: <a class="link" href="http://openicf.forgerock.org/connector-framework/apidocs/org/identityconnectors/framework/api/operations/ScriptOnResourceApiOp.html" target="_blank">ScriptOnResourceApiOp</a></p></li><li class="listitem"><p><code class="literal">SEARCH</code>: <a class="link" href="http://openicf.forgerock.org/connector-framework/apidocs/org/identityconnectors/framework/api/operations/SearchApiOp.html" target="_blank">SearchApiOp</a></p></li><li class="listitem"><p><code class="literal">SYNC</code>: <a class="link" href="http://openicf.forgerock.org/connector-framework/apidocs/org/identityconnectors/framework/api/operations/SyncApiOp.html" target="_blank">SyncApiOp</a></p></li><li class="listitem"><p><code class="literal">TEST</code>: <a class="link" href="http://openicf.forgerock.org/connector-framework/apidocs/org/identityconnectors/framework/api/operations/TestApiOp.html" target="_blank">TestApiOp</a></p></li><li class="listitem"><p><code class="literal">UPDATE</code>: <a class="link" href="http://openicf.forgerock.org/connector-framework/apidocs/org/identityconnectors/framework/api/operations/UpdateApiOp.html" target="_blank">UpdateApiOp</a></p></li><li class="listitem"><p><code class="literal">VALIDATE</code>: <a class="link" href="http://openicf.forgerock.org/connector-framework/apidocs/org/identityconnectors/framework/api/operations/ValidateApiOp.html" target="_blank">ValidateApiOp</a></p></li></ul></div><dl><dt><span class="term">denied</span></dt><dd><p>boolean, optional</p><p>This property prevents operation execution if the value is
     <code class="literal">true</code>.</p></dd><dt><span class="term">onDeny</span></dt><dd><p>string, optional</p><p>If <code class="literal">denied</code> is <code class="literal">true</code>, then the
     service uses this value. Default value:
     <code class="literal">DO_NOTHING</code>.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><code class="literal">DO_NOTHING</code>: On operation the service does
       nothing.</p></li><li class="listitem"><p><code class="literal">THROW_EXCEPTION</code>: On operation the service
       throws a  <code class="literal">ForbiddenException</code> exception.</p></li></ul></div></dd></dl></div></div><div class="section" title="5.4.&nbsp;Connector Configuration Examples"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="connector-examples"></a>5.4.&nbsp;Connector Configuration Examples</h2></div></div></div><a class="indexterm" name="d160e1459"></a><p>This section explains provisioner configurations for common
  connectors. Also see <a class="xref" href="#connector-wiz" title="5.5.&nbsp;Creating Default Connector Configurations">Section&nbsp;5.5, &#8220;Creating Default Connector Configurations&#8221;</a> for instructions
  on interactively building connector configurations.</p><div class="section" title="5.4.1.&nbsp;XML File Connector"><div class="titlepage"><div><div><h3 class="title"><a name="xml-file-connector"></a>5.4.1.&nbsp;XML File Connector</h3></div></div></div><p>The following example shows an excerpt of the provisioner
   configuration for an XML file connector.</p><div class="programlisting">
{
    <strong class="hl-string"><em style="color: #f58220">"connectorRef"</em></strong>: {
        <strong class="hl-string"><em style="color: #f58220">"connectorHostRef"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"#LOCAL"</em></strong>,
        <strong class="hl-string"><em style="color: #f58220">"bundleName"</em></strong>:
            <strong class="hl-string"><em style="color: #f58220">"org.forgerock.openicf.connectors.file.file.openicf-xml-connector"</em></strong>,
        <strong class="hl-string"><em style="color: #f58220">"bundleVersion"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"1.1.0.0"</em></strong>,
        <strong class="hl-string"><em style="color: #f58220">"connectorName"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"com.forgerock.openicf.xml.XMLConnector"</em></strong>
    }
}</div><p>The connectorHostRef is optional if the connector server is
   local.</p><p>The configuration properties for the XML file connector set the
   relative path to the file containing the identity data, and also the paths
   to the XML schemas required.</p><div class="programlisting">
{
    <strong class="hl-string"><em style="color: #f58220">"configurationProperties"</em></strong>: {
        <strong class="hl-string"><em style="color: #f58220">"xsdIcfFilePath"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"samples/sample1/data/resource-schema-1.xsd"</em></strong>,
        <strong class="hl-string"><em style="color: #f58220">"xsdFilePath"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"samples/sample1/data/resource-schema-extension.xsd"</em></strong>,
        <strong class="hl-string"><em style="color: #f58220">"xmlFilePath"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"samples/sample1/data/xmlConnectorData.xml"</em></strong>
    }
}</div><div class="variablelist"><dl><dt><span class="term">xmlFilePath</span></dt><dd><p>References the XML file containing account entries</p></dd><dt><span class="term">xsdIcfFilePath</span></dt><dd><p>References the XSD file defining schema common to all XML file
      resources. Do not change the schema defined in this file.</p></dd><dt><span class="term">xsdFilePath</span></dt><dd><p>References custom schema defining attributes specific to your
      project</p></dd></dl></div></div><div class="section" title="5.4.2.&nbsp;Generic LDAP Connector"><div class="titlepage"><div><div><h3 class="title"><a name="ldap-connector"></a>5.4.2.&nbsp;Generic LDAP Connector</h3></div></div></div><p>The following excerpt shows the <code class="literal">connectorRef</code>
   configuration property for connection to an LDAP server. When using the
   connect .jar provided in <code class="filename">openidm/connectors</code>, and
   when using a local connector server, the <code class="literal">connectorHostRef</code>
   property is optional.</p><div class="programlisting">
{
    <strong class="hl-string"><em style="color: #f58220">"connectorRef"</em></strong>: {
        <strong class="hl-string"><em style="color: #f58220">"connectorHostRef"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"#LOCAL"</em></strong>,
        <strong class="hl-string"><em style="color: #f58220">"connectorName"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"org.identityconnectors.ldap.LdapConnector"</em></strong>,
        <strong class="hl-string"><em style="color: #f58220">"bundleName"</em></strong>:
            <strong class="hl-string"><em style="color: #f58220">"org.forgerock.openicf.connectors.ldap.openicf-ldap-connector"</em></strong>,
        <strong class="hl-string"><em style="color: #f58220">"bundleVersion"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"1.1.0.0"</em></strong>
    }
}</div><p>The following excerpt shows settings for many connector configuration
   properties.</p><div class="programlisting">
{
    <strong class="hl-string"><em style="color: #f58220">"accountSynchronizationFilter"</em></strong>: null,
    <strong class="hl-string"><em style="color: #f58220">"passwordAttributeToSynchronize"</em></strong>: null,
    <strong class="hl-string"><em style="color: #f58220">"synchronizePasswords"</em></strong>: false,
    <strong class="hl-string"><em style="color: #f58220">"removeLogEntryObjectClassFromFilter"</em></strong>: true,
    <strong class="hl-string"><em style="color: #f58220">"modifiersNamesToFilterOut"</em></strong>: [],
    <strong class="hl-string"><em style="color: #f58220">"passwordDecryptionKey"</em></strong>: null,
    <strong class="hl-string"><em style="color: #f58220">"credentials"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"Passw0rd"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"changeLogBlockSize"</em></strong>: <span class="hl-number">100</span>,
    <strong class="hl-string"><em style="color: #f58220">"baseContextsToSynchronize"</em></strong>: [
        <strong class="hl-string"><em style="color: #f58220">"ou=People,dc=example,dc=com"</em></strong>
    ],
    <strong class="hl-string"><em style="color: #f58220">"attributesToSynchronize"</em></strong>: [
        <strong class="hl-string"><em style="color: #f58220">"uid"</em></strong>,
        <strong class="hl-string"><em style="color: #f58220">"sn"</em></strong>,
        <strong class="hl-string"><em style="color: #f58220">"cn"</em></strong>,
        <strong class="hl-string"><em style="color: #f58220">"givenName"</em></strong>,
        <strong class="hl-string"><em style="color: #f58220">"mail"</em></strong>,
        <strong class="hl-string"><em style="color: #f58220">"description"</em></strong>
    ],
    <strong class="hl-string"><em style="color: #f58220">"changeNumberAttribute"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"changeNumber"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"passwordDecryptionInitializationVector"</em></strong>: null,
    <strong class="hl-string"><em style="color: #f58220">"filterWithOrInsteadOfAnd"</em></strong>: false,
    <strong class="hl-string"><em style="color: #f58220">"objectClassesToSynchronize"</em></strong>: [
        <strong class="hl-string"><em style="color: #f58220">"inetOrgPerson"</em></strong>
    ],
    <strong class="hl-string"><em style="color: #f58220">"port"</em></strong>: <span class="hl-number">1389</span>,
    <strong class="hl-string"><em style="color: #f58220">"vlvSortAttribute"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"uid"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"passwordAttribute"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"userPassword"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"useBlocks"</em></strong>: true,
    <strong class="hl-string"><em style="color: #f58220">"maintainPosixGroupMembership"</em></strong>: false,
    <strong class="hl-string"><em style="color: #f58220">"failover"</em></strong>: [],
    <strong class="hl-string"><em style="color: #f58220">"ssl"</em></strong>: false,
    <strong class="hl-string"><em style="color: #f58220">"principal"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"cn=Directory Manager"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"baseContexts"</em></strong>: [
        <strong class="hl-string"><em style="color: #f58220">"dc=example,dc=com"</em></strong>
    ],
    <strong class="hl-string"><em style="color: #f58220">"readSchema"</em></strong>: true,
    <strong class="hl-string"><em style="color: #f58220">"accountObjectClasses"</em></strong>: [
        <strong class="hl-string"><em style="color: #f58220">"top"</em></strong>,
        <strong class="hl-string"><em style="color: #f58220">"person"</em></strong>,
        <strong class="hl-string"><em style="color: #f58220">"organizationalPerson"</em></strong>,
        <strong class="hl-string"><em style="color: #f58220">"inetOrgPerson"</em></strong>
    ],
    <strong class="hl-string"><em style="color: #f58220">"accountUserNameAttributes"</em></strong>: [
        <strong class="hl-string"><em style="color: #f58220">"uid"</em></strong>,
        <strong class="hl-string"><em style="color: #f58220">"cn"</em></strong>
    ],
    <strong class="hl-string"><em style="color: #f58220">"host"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"localhost"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"groupMemberAttribute"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"uniqueMember"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"accountSearchFilter"</em></strong>: null,
    <strong class="hl-string"><em style="color: #f58220">"passwordHashAlgorithm"</em></strong>: null,
    <strong class="hl-string"><em style="color: #f58220">"usePagedResultControl"</em></strong>: false,
    <strong class="hl-string"><em style="color: #f58220">"blockSize"</em></strong>: <span class="hl-number">100</span>,
    <strong class="hl-string"><em style="color: #f58220">"uidAttribute"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"entryUUID"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"maintainLdapGroupMembership"</em></strong>: false,
    <strong class="hl-string"><em style="color: #f58220">"respectResourcePasswordPolicyChangeAfterReset"</em></strong>: false
}</div><div class="variablelist"><dl><dt><span class="term">accountSynchronizationFilter</span></dt><dd><p>Used during synchronization actions to filter out LDAP
      accounts</p></dd><dt><span class="term">accountObjectClasses</span></dt><dd><p>The object classes used when creating new LDAP user objects.
      When specifying more than one object class, add each object class as its
      own property. For object classes that inherit from parents other than
      <code class="literal">top</code>, such as <code class="literal">inetOrgPerson</code>, specify
      all object classes in the class hierarchy.</p></dd><dt><span class="term">accountSearchFilter</span></dt><dd><p>Search filter that accounts must match</p></dd><dt><span class="term">accountUserNameAttributes</span></dt><dd><p>Attributes holding the account's user name. Used during
      authentication to find the LDAP entry matching the user name.</p></dd><dt><span class="term">attributesToSynchronize</span></dt><dd><p>List of attributes used during object synchronization. OpenIDM
      ignores change log updates that do not include any of the specified
      attributes. If empty, OpenIDM considers all changes.</p></dd><dt><span class="term">baseContexts</span></dt><dd><p>Base DNs for operations on the LDAP server</p></dd><dt><span class="term">baseContextsToSynchronize</span></dt><dd><p>Base DNs for entries taken into account during
      synchronization</p></dd><dt><span class="term">blockSize</span></dt><dd><p>Block size for simple paged results and VLV index searches,
      reflecting the maximum number of accounts retrieved at any one time</p></dd><dt><span class="term">changeLogBlockSize</span></dt><dd><p>Block size used when fetching change log entries</p></dd><dt><span class="term">changeNumberAttribute</span></dt><dd><p>Change log attribute containing the last change number</p></dd><dt><span class="term">credentials</span></dt><dd><p>Password to connect to the LDAP server</p></dd><dt><span class="term">failover</span></dt><dd><p>LDAP URLs specifying alternative LDAP servers to connect to if
      OpenIDM cannot connect to the primary LDAP server specified in the
      <code class="literal">host</code> and <code class="literal">port</code> properties</p></dd><dt><span class="term">filterWithOrInsteadOfAnd</span></dt><dd><p>In most cases, the filter to fetch change log entries is AND-based.
      If this property is set, the filter ORs the required change numbers
      instead.</p></dd><dt><span class="term">groupMemberAttribute</span></dt><dd><p>LDAP attribute holding members for non-POSIX static groups</p></dd><dt><span class="term">host</span></dt><dd><p>Primary LDAP server host name</p></dd><dt><span class="term">maintainLdapGroupMembership</span></dt><dd><p>If <code class="literal">true</code>, OpenIDM modifies group membership when
      entries are renamed or deleted.</p></dd><dt><span class="term">maintainPosixGroupMembership</span></dt><dd><p>If <code class="literal">true</code>, OpenIDM modifies POSIX group membership
      when entries are renamed or deleted.</p></dd><dt><span class="term">modifiersNamesToFilterOut</span></dt><dd><p>Use to avoid loops caused by OpenIDM's own changes</p></dd><dt><span class="term">objectClassesToSynchronize</span></dt><dd><p>OpenIDM synchronizes only entries having these object
      classes.</p></dd><dt><span class="term">passwordAttribute</span></dt><dd><p>Attribute to which OpenIDM writes the predefined PASSWORD
      attribute</p></dd><dt><span class="term">passwordAttributeToSynchronize</span></dt><dd><p>OpenIDM synchronizes password values on this attribute.</p></dd><dt><span class="term">passwordDecryptionInitializationVector</span></dt><dd><p>Initialization vector used to decrypt passwords when performing
      password synchronization</p></dd><dt><span class="term">passwordDecryptionKey</span></dt><dd><p>Key used to decrypt passwords when performing password
      synchronization</p></dd><dt><span class="term">passwordHashAlgorithm</span></dt><dd><p>Hash password values with the specified algorithm if the LDAP
      server stores them in clear text</p></dd><dt><span class="term">port</span></dt><dd><p>Primary LDAP server port number</p></dd><dt><span class="term">principal</span></dt><dd><p>Bind DN used to connect to the LDAP server</p></dd><dt><span class="term">readSchema</span></dt><dd><p>If <code class="literal">true</code>, read LDAP schema from the LDAP
      server.</p></dd><dt><span class="term">removeLogEntryObjectClassFromFilter</span></dt><dd><p>If <code class="literal">true</code>, the filter to fetch change log entries
      does not contain the <code class="literal">changeLogEntry</code> object class, and
      OpenIDM expects no entries with other object types in the change log.
      Default: <code class="literal">true</code></p></dd><dt><span class="term">respectResourcePasswordPolicyChangeAfterReset</span></dt><dd><p>If <code class="literal">true</code>, bind with the Password Expired and
      Password Policy controls, and throw
      <code class="literal">PasswordExpiredException</code> and other exceptions
      appropriately.</p></dd><dt><span class="term">ssl</span></dt><dd><p>If <code class="literal">true</code>, the specified port listens for
      LDAPS connections.</p></dd><dt><span class="term">synchronizePasswords</span></dt><dd><p>If <code class="literal">true</code>, synchronize passwords.</p></dd><dt><span class="term">uidAttribute</span></dt><dd><p>OpenIDM maps <code class="literal">uid</code> to the specified
      attribute.</p></dd><dt><span class="term">useBlocks</span></dt><dd><p>If <code class="literal">true</code>, use block-based LDAP controls like
      simple paged results and virtual list view.</p></dd><dt><span class="term">usePagedResultControl</span></dt><dd><p>If <code class="literal">true</code>, use simple paged results rather than
      virtual list view when both are available.</p></dd><dt><span class="term">vlvSortAttribute</span></dt><dd><p>Attribute used as the sort key for virtual list view</p></dd></dl></div></div><div class="section" title="5.4.3.&nbsp;Active Directory Connector"><div class="titlepage"><div><div><h3 class="title"><a name="active-directory-connector"></a>5.4.3.&nbsp;Active Directory Connector</h3></div></div></div><p>In contrast to most other connectors, the Active Directory connector
   is written not in Java, but instead in .NET. OpenICF should connect to
   Active Directory over ADSI, the native connection protocol for Active
   Directory. The connector therefore requires a connector server that has
   access to the ADSI .dll files.</p><p>See the <a class="link" href="http://openicf.forgerock.org/connector-framework-internal/connector_server.html" target="_blank">OpenICF Connnector Server</a> page for instructions on installing a .NET
   connector server. Take care to set the key as described in the
   instructions.</p><p>The following excerpt shows the configuration for the connector.</p><div class="programlisting">
{
    <strong class="hl-string"><em style="color: #f58220">"connectorHostRef"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"dotnet"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"connectorName"</em></strong>:
        <strong class="hl-string"><em style="color: #f58220">"Org.IdentityConnectors.ActiveDirectory.ActiveDirectoryConnector"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"bundleName"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"ActiveDirectory.Connector"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"bundleVersion"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"1.0.0.6109"</em></strong>
}</div><p>The <code class="literal">connectorHostRef</code> must point by name to an
   existing connector info provider configuration, that you store in
   <code class="filename">openidm/conf/provisioner.openicf.connectorinfoprovider.json</code>.
   The <code class="literal">connectorHostRef</code> property is required as the Active
   Directory connector must be installed on a .NET connector server, which is
   always "remote" relative to OpenIDM.</p><p>The following excerpt shows the configuration for the connector
   info provider.</p><div class="programlisting">
{
    <strong class="hl-string"><em style="color: #f58220">"connectorsLocation"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"connectors"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"remoteConnectorServers"</em></strong>: [
        {
            <strong class="hl-string"><em style="color: #f58220">"name"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"dotnet"</em></strong>,
            <strong class="hl-string"><em style="color: #f58220">"host"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"10.0.0.10"</em></strong>,
            <strong class="hl-string"><em style="color: #f58220">"port"</em></strong>: <span class="hl-number">8759</span>,
            <strong class="hl-string"><em style="color: #f58220">"useSSL"</em></strong>: false,
            <strong class="hl-string"><em style="color: #f58220">"timeout"</em></strong>: <span class="hl-number">0</span>,
            <strong class="hl-string"><em style="color: #f58220">"key"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"Passw0rd"</em></strong>
        }
    ]
}</div><p>The following excerpt shows typical configuration properties.</p><div class="programlisting">
{
    <strong class="hl-string"><em style="color: #f58220">"DirectoryAdminName"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"EXAMPLE\\Administrator"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"DirectoryAdminPassword"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"passw0rd"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"ObjectClass"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"User"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"Container"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"dc=example,dc=com"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"CreateHomeDirectory"</em></strong>: true,
    <strong class="hl-string"><em style="color: #f58220">"LDAPHostName"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"127.0.0.1"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"SearchChildDomains"</em></strong>: false,
    <strong class="hl-string"><em style="color: #f58220">"DomainName"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"example"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"SyncGlobalCatalogServer"</em></strong>: null,
    <strong class="hl-string"><em style="color: #f58220">"SyncDomainController"</em></strong>: null,
    <strong class="hl-string"><em style="color: #f58220">"SearchContext"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"dc=example,dc=com"</em></strong>
}</div><div class="variablelist"><dl><dt><span class="term">DirectoryAdminName</span></dt><dd><p>Account used to authenticate. This can be a
      <code class="literal"><em class="replaceable"><code>domainname</code></em>\<em class="replaceable"><code>user</code></em></code>
      combination, or simply the user name.</p></dd><dt><span class="term">DirectoryAdminPassword</span></dt><dd><p>Password used to authenticate</p></dd><dt><span class="term">ObjectClass</span></dt><dd><p>Object class for user objects</p></dd><dt><span class="term">Container</span></dt><dd><p>Base context for all searches</p></dd><dt><span class="term">CreateHomeDirectory</span></dt><dd><p>When <code class="literal">true</code>, create a home directory for new
      users.</p></dd><dt><span class="term">LDAPHostName</span></dt><dd><p>Use to enforce connection to a particular Active Directory
      server.</p></dd><dt><span class="term">SearchChildDomains</span></dt><dd><p>When set to <code class="literal">true</code> or <code class="literal">false</code>,
      apply <code class="literal">SyncGlobalCatalogServer</code> and
      <code class="literal">SyncDomainController</code> settings</p></dd><dt><span class="term">DomainName</span></dt><dd><p>Windows domain name</p></dd><dt><span class="term">SyncGlobalCatalogServer</span></dt><dd><p>Global catalog server to use when searching child domains</p></dd><dt><span class="term">SyncDomainController</span></dt><dd><p>Domain controller to use during synchronization when not searching
      child domains</p></dd><dt><span class="term">SearchContext</span></dt><dd><p>Reserved for future use</p></dd></dl></div></div><div class="section" title="5.4.4.&nbsp;CSV File Connector"><div class="titlepage"><div><div><h3 class="title"><a name="csv-file-connector"></a>5.4.4.&nbsp;CSV File Connector</h3></div></div></div><p>The CSV file connector often serves when importing users, either
    for initial provisioning or for ongoing updates. When used continuously in
    production, a CSV file serves as a change log, often containing only user
    records that changed.</p><p>The following example shows an excerpt of the provisioner
   configuration. The default connector-jar location is now, like all other connectors, in <code class="filename">openidm/connectors</code>. Therefore the  <code class="literal">connectorHostRef</code> must point to <code class="literal">"#LOCAL"</code>.</p><div class="programlisting">
{
  <strong class="hl-string"><em style="color: #f58220">"connectorRef"</em></strong>: {
    <strong class="hl-string"><em style="color: #f58220">"connectorHostRef"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"#LOCAL"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"connectorName"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"org.forgerock.openicf.csvfile.CSVFileConnector"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"bundleName"</em></strong>:
      <strong class="hl-string"><em style="color: #f58220">"org.forgerock.openicf.connectors.file.openicf-csvfile-connector"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"bundleVersion"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"1.1.0.0"</em></strong>
  }
}</div><p>The following excerpt shows required configuration properties.</p><div class="programlisting">
{
    <strong class="hl-string"><em style="color: #f58220">"configurationProperties"</em></strong>: {
        <strong class="hl-string"><em style="color: #f58220">"filePath"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"data/hr.csv"</em></strong>,
        <strong class="hl-string"><em style="color: #f58220">"uniqueAttribute"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"uid"</em></strong>
    }
}</div><div class="variablelist"><p>The CSV file connector also supports a number of optional
    configuration properties, in addition to the required properties.</p><dl><dt><span class="term">encoding (optional)</span></dt><dd><p>Default: <code class="literal">"utf-8"</code></p></dd><dt><span class="term">fieldDelimiter (optional)</span></dt><dd><p>Default: <code class="literal">","</code></p></dd><dt><span class="term">filePath (required)</span></dt><dd><p>References the CSV file containing account entries</p></dd><dt><span class="term">multivalueDelimiter (optional)</span></dt><dd><p>Used with multi-valued attributes. Default:
      <code class="literal">";"</code></p></dd><dt><span class="term">passwordAttribute (optional)</span></dt><dd><p>Attribute containing the password. Use when password-based
      authentication is required.</p></dd><dt><span class="term">uniqueAttribute (required)</span></dt><dd><p>Primary key used for the CSV file</p></dd><dt><span class="term">usingMultivalue (optional)</span></dt><dd><p>Whether attributes can have multiple values. Default:
      <code class="literal">false</code></p></dd></dl></div></div><div class="section" title="5.4.5.&nbsp;Scripted SQL Connector"><div class="titlepage"><div><div><h3 class="title"><a name="scripted-sql-connector"></a>5.4.5.&nbsp;Scripted SQL Connector</h3></div></div></div><p>The Scripted SQL Connector uses customizable Groovy scripts to
   interact with the database.</p><div class="itemizedlist"><p>The connector uses one script for each of the following actions
    on the external database.</p><ul class="itemizedlist" type="disc"><li class="listitem"><p>Create</p></li><li class="listitem"><p>Delete</p></li><li class="listitem"><p>Search</p></li><li class="listitem"><p>Sync</p></li><li class="listitem"><p>Test</p></li><li class="listitem"><p>Update</p></li></ul></div><p>See the <code class="filename">openidm/samples/sample3/tools/</code> directory
   for example scripts.</p></div></div><div class="section" title="5.5.&nbsp;Creating Default Connector Configurations"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="connector-wiz"></a>5.5.&nbsp;Creating Default Connector Configurations</h2></div></div></div><a class="indexterm" name="d160e2012"></a><p>Rather than creating provisioner files by hand, use the service that
  OpenIDM exposes through the REST interface to create basic connector
  configuration files named <code class="filename">provisioner-openicf-<em class="replaceable"><code>Connector
  Name</code></em>.json</code> file.</p><div class="orderedlist"><p>You create a new connector configuration file in three stages.</p><ol class="orderedlist" type="1"><li class="listitem"><p>List available connectors.</p></li><li class="listitem"><p>Generate the core configuration.</p></li><li class="listitem"><p>Connect to the target system and generate the final
   configuration.</p></li></ol></div><p>List available connectors using the following command.</p><div class="screen" width="83">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 --request POST "http://localhost:8080/openidm/system?_action=CREATECONFIGURATION"</div><div class="itemizedlist"><p>Available connectors are installed in
   <code class="filename">openidm/connectors</code>. OpenIDM bundles the following
   connectors.</p><ul class="itemizedlist" type="disc"><li class="listitem"><p>csvfile</p></li><li class="listitem"><p>ldap</p></li><li class="listitem"><p>scriptedsql</p></li><li class="listitem"><p>xml</p></li></ul></div><p>The command above therefore should return the following output
  (formatted here with lines folded to make it easier to read.)</p><a name="step1-return"></a><div class="programlisting">
{
  <strong class="hl-string"><em style="color: #f58220">"connectorRef"</em></strong>: [
    {
      <strong class="hl-string"><em style="color: #f58220">"connectorName"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"org.identityconnectors.ldap.LdapConnector"</em></strong>,
      <strong class="hl-string"><em style="color: #f58220">"bundleName"</em></strong>:
        <strong class="hl-string"><em style="color: #f58220">"org.forgerock.openicf.connectors.ldap.openicf-ldap-connector"</em></strong>,
      <strong class="hl-string"><em style="color: #f58220">"bundleVersion"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"1.1.0.0"</em></strong>
    },
    {
      <strong class="hl-string"><em style="color: #f58220">"connectorName"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"com.forgerock.openicf.xml.XMLConnector"</em></strong>,
      <strong class="hl-string"><em style="color: #f58220">"bundleName"</em></strong>:
        <strong class="hl-string"><em style="color: #f58220">"org.forgerock.openicf.connectors.file.openicf-xml-connector"</em></strong>,
      <strong class="hl-string"><em style="color: #f58220">"bundleVersion"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"1.1.0.0"</em></strong>
    },
    {
      <strong class="hl-string"><em style="color: #f58220">"connectorHostRef"</em></strong>:
       <strong class="hl-string"><em style="color: #f58220">"osgi:service/org.forgerock.openicf.framework.api.osgi.ConnectorManager"</em></strong>,
      <strong class="hl-string"><em style="color: #f58220">"connectorName"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"org.forgerock.openicf.scriptedsql.ScriptedSQLConnector"</em></strong>,
      <strong class="hl-string"><em style="color: #f58220">"bundleName"</em></strong>:
       <strong class="hl-string"><em style="color: #f58220">"org.forgerock.openicf.connectors.db.openicf-scriptedsql-connector"</em></strong>,
      <strong class="hl-string"><em style="color: #f58220">"bundleVersion"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"1.1.0.0"</em></strong>
    },
    {
      <strong class="hl-string"><em style="color: #f58220">"connectorHostRef"</em></strong>:
       <strong class="hl-string"><em style="color: #f58220">"osgi:service/org.forgerock.openicf.framework.api.osgi.ConnectorManager"</em></strong>,
      <strong class="hl-string"><em style="color: #f58220">"connectorName"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"org.forgerock.openicf.csvfile.CSVFileConnector"</em></strong>,
      <strong class="hl-string"><em style="color: #f58220">"bundleName"</em></strong>:
       <strong class="hl-string"><em style="color: #f58220">"org.forgerock.openicf.connectors.file.openicf-csvfile-connector"</em></strong>,
      <strong class="hl-string"><em style="color: #f58220">"bundleVersion"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"1.1.0.0"</em></strong>
    }
  ]
}</div><p>To generate the core configuration, choose one of the available
  connectors by copying JSON objects from the list into the body of the REST
  command, as shown below for the XML connector.</p><div class="screen" width="83">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 -d '{"connectorRef":
 {"connectorName":"com.forgerock.openicf.xml.XMLConnector",
 "bundleName":"org.forgerock.openicf.connectors.file.openicf-xml-connector",
 "bundleVersion":"1.1.0.0"}}' 
 --request POST "http://localhost:8080/openidm/system?_action=CREATECONFIGURATION"</div><p>The command returns a core connector configuration. The core connector
  configuration returned is not yet functional. It does not contain
  system specific "configurationProperties" such as the host name and port for
  web based connectors, or the "xmlFilePath" for the XML file based connectors
  as can be seen below. In addition, the configuration returned does not
  include complete "objectTypes" and "operationOptions" parts.</p><div class="programlisting">
{
    <strong class="hl-string"><em style="color: #f58220">"connectorRef"</em></strong>: {
        <strong class="hl-string"><em style="color: #f58220">"connectorName"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"com.forgerock.openicf.xml.XMLConnector"</em></strong>,
        <strong class="hl-string"><em style="color: #f58220">"bundleName"</em></strong>:
            <strong class="hl-string"><em style="color: #f58220">"org.forgerock.openicf.connectors.file.openicf-xml-connector"</em></strong>,
        <strong class="hl-string"><em style="color: #f58220">"bundleVersion"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"1.1.0.0"</em></strong>
    },
    <strong class="hl-string"><em style="color: #f58220">"poolConfigOption"</em></strong>: {
        <strong class="hl-string"><em style="color: #f58220">"maxObjects"</em></strong>: <span class="hl-number">10</span>,
        <strong class="hl-string"><em style="color: #f58220">"maxIdle"</em></strong>: <span class="hl-number">10</span>,
        <strong class="hl-string"><em style="color: #f58220">"maxWait"</em></strong>: <span class="hl-number">150000</span>,
        <strong class="hl-string"><em style="color: #f58220">"minEvictableIdleTimeMillis"</em></strong>: <span class="hl-number">120000</span>,
        <strong class="hl-string"><em style="color: #f58220">"minIdle"</em></strong>: <span class="hl-number">1</span>
    },
    <strong class="hl-string"><em style="color: #f58220">"resultsHandlerConfig"</em></strong>: {
        <strong class="hl-string"><em style="color: #f58220">"enableNormalizingResultsHandler"</em></strong>: true,
        <strong class="hl-string"><em style="color: #f58220">"enableFilteredResultsHandler"</em></strong>: true,
        <strong class="hl-string"><em style="color: #f58220">"enableCaseInsensitiveFilter"</em></strong>: false,
        <strong class="hl-string"><em style="color: #f58220">"enableAttributesToGetSearchResultsHandler"</em></strong>: true
    },
    <strong class="hl-string"><em style="color: #f58220">"operationTimeout"</em></strong>: {
        <strong class="hl-string"><em style="color: #f58220">"CREATE"</em></strong>: -<span class="hl-number">1</span>,
        <strong class="hl-string"><em style="color: #f58220">"UPDATE"</em></strong>: -<span class="hl-number">1</span>,
        <strong class="hl-string"><em style="color: #f58220">"DELETE"</em></strong>: -<span class="hl-number">1</span>,
        <strong class="hl-string"><em style="color: #f58220">"TEST"</em></strong>: -<span class="hl-number">1</span>,
        <strong class="hl-string"><em style="color: #f58220">"SCRIPT_ON_CONNECTOR"</em></strong>: -<span class="hl-number">1</span>,
        <strong class="hl-string"><em style="color: #f58220">"SCRIPT_ON_RESOURCE"</em></strong>: -<span class="hl-number">1</span>,
        <strong class="hl-string"><em style="color: #f58220">"GET"</em></strong>: -<span class="hl-number">1</span>,
        <strong class="hl-string"><em style="color: #f58220">"RESOLVEUSERNAME"</em></strong>: -<span class="hl-number">1</span>,
        <strong class="hl-string"><em style="color: #f58220">"AUTHENTICATE"</em></strong>: -<span class="hl-number">1</span>,
        <strong class="hl-string"><em style="color: #f58220">"SEARCH"</em></strong>: -<span class="hl-number">1</span>,
        <strong class="hl-string"><em style="color: #f58220">"VALIDATE"</em></strong>: -<span class="hl-number">1</span>,
        <strong class="hl-string"><em style="color: #f58220">"SYNC"</em></strong>: -<span class="hl-number">1</span>,
        <strong class="hl-string"><em style="color: #f58220">"SCHEMA"</em></strong>: -<span class="hl-number">1</span>
    },
    <strong class="hl-string"><em style="color: #f58220">"configurationProperties"</em></strong>: {
        <strong class="hl-string"><em style="color: #f58220">"xmlFilePath"</em></strong>: null,
        <strong class="hl-string"><em style="color: #f58220">"xsdFilePath"</em></strong>: null,
        <strong class="hl-string"><em style="color: #f58220">"xsdIcfFilePath"</em></strong>: null
    }
}</div><p>To generate the final configuration, add the missing
  "configurationProperties" to the core configuration, and use the updated
  core configuration as the body for the next command.</p><div class="screen" width="83">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 --data '{
   "connectorRef" :
      {
         "connectorName" : "com.forgerock.openicf.xml.XMLConnector",
         "bundleName" :
             "org.forgerock.openicf.connectors.file.openicf-xml-connector",
         "bundleVersion" : "1.1.0.0"
      },
   "poolConfigOption" :
      {
         "maxObjects" : 10,
         "maxIdle" : 10,
         "maxWait" : 150000,
         "minEvictableIdleTimeMillis" : 120000,
         "minIdle" : 1
      },
   "resultsHandlerConfig" :
      {
         "enableNormalizingResultsHandler" : true,
         "enableFilteredResultsHandler" : true,
         "enableCaseInsensitiveFilter" : false,
         "enableAttributesToGetSearchResultsHandler" : true
      },
   "operationTimeout" :
      {
         "CREATE" : -1,
         "UPDATE" : -1,
         "DELETE" : -1,
         "TEST" : -1,
         "SCRIPT_ON_CONNECTOR" : -1,
         "SCRIPT_ON_RESOURCE" : -1,
         "GET" : -1,
         "RESOLVEUSERNAME" : -1,
         "AUTHENTICATE" : -1,
         "SEARCH" : -1,
         "VALIDATE" : -1,
         "SYNC" : -1,
         "SCHEMA" : -1
      },
   "configurationProperties" :
      {
         "xsdIcfFilePath" : "samples/sample1/data/resource-schema-1.xsd",
         "xsdFilePath" : "samples/sample1/data/resource-schema-extension.xsd",
         "xmlFilePath" : "samples/sample1/data/xmlConnectorData.xml"
      }
 }'
 --request POST "http://localhost:8080/openidm/system?_action=CREATECONFIGURATION"</div><div class="note" title="Note" style="font-style: italic;"><h3 class="title">Note</h3><p>Notice the single quotes around the argument to the
   <code class="option">--data</code> option in the command above. For most UNIX shells,
   single quotes around a string prevent the shell from executing the command
   when encountering a newline in the content. You can therefore pass the
   <code class="option">--data '...'</code> option on a single line or including line feeds.</p></div><p>OpenIDM attempts to read the schema, if available, from the external
  resource in order to generate output. OpenIDM then iterates through schema
  objects and attributes, creating JSON representations for "objectTypes" and
  "operationOptions" for supported objects and operations.</p><div class="programlisting">
{
    <strong class="hl-string"><em style="color: #f58220">"connectorRef"</em></strong>: {
        <strong class="hl-string"><em style="color: #f58220">"connectorHostRef"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"#LOCAL"</em></strong>,
        <strong class="hl-string"><em style="color: #f58220">"connectorName"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"com.forgerock.openicf.xml.XMLConnector"</em></strong>,
        <strong class="hl-string"><em style="color: #f58220">"bundleName"</em></strong>:
            <strong class="hl-string"><em style="color: #f58220">"org.forgerock.openicf.connectors.file.openicf-xml-connector"</em></strong>,
        <strong class="hl-string"><em style="color: #f58220">"bundleVersion"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"1.1.0.0-EA"</em></strong>
    },
    <strong class="hl-string"><em style="color: #f58220">"poolConfigOption"</em></strong>: {
        <strong class="hl-string"><em style="color: #f58220">"maxObjects"</em></strong>: <span class="hl-number">10</span>,
        <strong class="hl-string"><em style="color: #f58220">"maxIdle"</em></strong>: <span class="hl-number">10</span>,
        <strong class="hl-string"><em style="color: #f58220">"maxWait"</em></strong>: <span class="hl-number">150000</span>,
        <strong class="hl-string"><em style="color: #f58220">"minEvictableIdleTimeMillis"</em></strong>: <span class="hl-number">120000</span>,
        <strong class="hl-string"><em style="color: #f58220">"minIdle"</em></strong>: <span class="hl-number">1</span>
    },
    <strong class="hl-string"><em style="color: #f58220">"resultsHandlerConfig"</em></strong>: {
        <strong class="hl-string"><em style="color: #f58220">"enableNormalizingResultsHandler"</em></strong>: true,
        <strong class="hl-string"><em style="color: #f58220">"enableFilteredResultsHandler"</em></strong>: true,
        <strong class="hl-string"><em style="color: #f58220">"enableCaseInsensitiveFilter"</em></strong>: false,
        <strong class="hl-string"><em style="color: #f58220">"enableAttributesToGetSearchResultsHandler"</em></strong>: true
    },
    <strong class="hl-string"><em style="color: #f58220">"operationTimeout"</em></strong>: {
        <strong class="hl-string"><em style="color: #f58220">"CREATE"</em></strong>: -<span class="hl-number">1</span>,
        <strong class="hl-string"><em style="color: #f58220">"UPDATE"</em></strong>: -<span class="hl-number">1</span>,
        <strong class="hl-string"><em style="color: #f58220">"DELETE"</em></strong>: -<span class="hl-number">1</span>,
        <strong class="hl-string"><em style="color: #f58220">"TEST"</em></strong>: -<span class="hl-number">1</span>,
        <strong class="hl-string"><em style="color: #f58220">"SCRIPT_ON_CONNECTOR"</em></strong>: -<span class="hl-number">1</span>,
        <strong class="hl-string"><em style="color: #f58220">"SCRIPT_ON_RESOURCE"</em></strong>: -<span class="hl-number">1</span>,
        <strong class="hl-string"><em style="color: #f58220">"GET"</em></strong>: -<span class="hl-number">1</span>,
        <strong class="hl-string"><em style="color: #f58220">"RESOLVEUSERNAME"</em></strong>: -<span class="hl-number">1</span>,
        <strong class="hl-string"><em style="color: #f58220">"AUTHENTICATE"</em></strong>: -<span class="hl-number">1</span>,
        <strong class="hl-string"><em style="color: #f58220">"SEARCH"</em></strong>: -<span class="hl-number">1</span>,
        <strong class="hl-string"><em style="color: #f58220">"VALIDATE"</em></strong>: -<span class="hl-number">1</span>,
        <strong class="hl-string"><em style="color: #f58220">"SYNC"</em></strong>: -<span class="hl-number">1</span>,
        <strong class="hl-string"><em style="color: #f58220">"SCHEMA"</em></strong>: -<span class="hl-number">1</span>
    },
    <strong class="hl-string"><em style="color: #f58220">"configurationProperties"</em></strong>: {
        <strong class="hl-string"><em style="color: #f58220">"xmlFilePath"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"samples/sample1/data/xmlConnectorData.xml"</em></strong>,
        <strong class="hl-string"><em style="color: #f58220">"xsdFilePath"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"samples/sample1/data/resource-schema-extension.xsd"</em></strong>,
        <strong class="hl-string"><em style="color: #f58220">"xsdIcfFilePath"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"samples/sample1/data/resource-schema-1.xsd"</em></strong>
    },
    <strong class="hl-string"><em style="color: #f58220">"objectTypes"</em></strong>: {
        <strong class="hl-string"><em style="color: #f58220">"OrganizationUnit"</em></strong>: {
            <strong class="hl-string"><em style="color: #f58220">"..."</em></strong>: <strong class="hl-string"><em style="color: #f58220">"..."</em></strong>
        },
        <strong class="hl-string"><em style="color: #f58220">"__GROUP__"</em></strong>: {
            <strong class="hl-string"><em style="color: #f58220">"$schema"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"http://json-schema.org/draft-03/schema"</em></strong>,
            <strong class="hl-string"><em style="color: #f58220">"id"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"__GROUP__"</em></strong>,
            <strong class="hl-string"><em style="color: #f58220">"type"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"object"</em></strong>,
            <strong class="hl-string"><em style="color: #f58220">"nativeType"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"__GROUP__"</em></strong>,
            <strong class="hl-string"><em style="color: #f58220">"properties"</em></strong>: {
                <strong class="hl-string"><em style="color: #f58220">"__DESCRIPTION__"</em></strong>: {
                    <strong class="hl-string"><em style="color: #f58220">"type"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"string"</em></strong>,
                    <strong class="hl-string"><em style="color: #f58220">"required"</em></strong>: true,
                    <strong class="hl-string"><em style="color: #f58220">"nativeName"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"__DESCRIPTION__"</em></strong>,
                    <strong class="hl-string"><em style="color: #f58220">"nativeType"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"string"</em></strong>
                },
                <strong class="hl-string"><em style="color: #f58220">"__NAME__"</em></strong>: {
                    <strong class="hl-string"><em style="color: #f58220">"type"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"string"</em></strong>,
                    <strong class="hl-string"><em style="color: #f58220">"required"</em></strong>: true,
                    <strong class="hl-string"><em style="color: #f58220">"nativeName"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"__NAME__"</em></strong>,
                    <strong class="hl-string"><em style="color: #f58220">"nativeType"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"string"</em></strong>
                }
            }
        },
        <strong class="hl-string"><em style="color: #f58220">"__ACCOUNT__"</em></strong>: {
            <strong class="hl-string"><em style="color: #f58220">"$schema"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"http://json-schema.org/draft-03/schema"</em></strong>,
            <strong class="hl-string"><em style="color: #f58220">"id"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"__ACCOUNT__"</em></strong>,
            <strong class="hl-string"><em style="color: #f58220">"type"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"object"</em></strong>,
            <strong class="hl-string"><em style="color: #f58220">"nativeType"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"__ACCOUNT__"</em></strong>,
            <strong class="hl-string"><em style="color: #f58220">"properties"</em></strong>: {
                <strong class="hl-string"><em style="color: #f58220">"firstname"</em></strong>: {
                    <strong class="hl-string"><em style="color: #f58220">"type"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"string"</em></strong>,
                    <strong class="hl-string"><em style="color: #f58220">"nativeName"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"firstname"</em></strong>,
                    <strong class="hl-string"><em style="color: #f58220">"nativeType"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"string"</em></strong>
                },
                <strong class="hl-string"><em style="color: #f58220">"__DESCRIPTION__"</em></strong>: {
                    <strong class="hl-string"><em style="color: #f58220">"type"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"string"</em></strong>,
                    <strong class="hl-string"><em style="color: #f58220">"nativeName"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"__DESCRIPTION__"</em></strong>,
                    <strong class="hl-string"><em style="color: #f58220">"nativeType"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"string"</em></strong>
                },
                <strong class="hl-string"><em style="color: #f58220">"__UID__"</em></strong>: {
                    <strong class="hl-string"><em style="color: #f58220">"type"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"string"</em></strong>,
                    <strong class="hl-string"><em style="color: #f58220">"nativeName"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"__UID__"</em></strong>,
                    <strong class="hl-string"><em style="color: #f58220">"nativeType"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"string"</em></strong>
                },
                <strong class="hl-string"><em style="color: #f58220">"__NAME__"</em></strong>: {
                    <strong class="hl-string"><em style="color: #f58220">"type"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"string"</em></strong>,
                    <strong class="hl-string"><em style="color: #f58220">"required"</em></strong>: true,
                    <strong class="hl-string"><em style="color: #f58220">"nativeName"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"__NAME__"</em></strong>,
                    <strong class="hl-string"><em style="color: #f58220">"nativeType"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"string"</em></strong>
                }
            }
        }
    },
    <strong class="hl-string"><em style="color: #f58220">"operationOptions"</em></strong>: {
        <strong class="hl-string"><em style="color: #f58220">"CREATE"</em></strong>: {
            <strong class="hl-string"><em style="color: #f58220">"objectFeatures"</em></strong>: {
                <strong class="hl-string"><em style="color: #f58220">"OrganizationUnit"</em></strong>: {
                    <strong class="hl-string"><em style="color: #f58220">"..."</em></strong>: <strong class="hl-string"><em style="color: #f58220">"..."</em></strong>
                },
                <strong class="hl-string"><em style="color: #f58220">"__GROUP__"</em></strong>: {
                    <strong class="hl-string"><em style="color: #f58220">"..."</em></strong>: <strong class="hl-string"><em style="color: #f58220">"..."</em></strong>
                },
                <strong class="hl-string"><em style="color: #f58220">"__ACCOUNT__"</em></strong>: {
                    <strong class="hl-string"><em style="color: #f58220">"denied"</em></strong>: false,
                    <strong class="hl-string"><em style="color: #f58220">"onDeny"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"DO_NOTHING"</em></strong>,
                    <strong class="hl-string"><em style="color: #f58220">"operationOptionInfo"</em></strong>: {
                        <strong class="hl-string"><em style="color: #f58220">"$schema"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"http://json-schema.org/draft-03/schema"</em></strong>,
                        <strong class="hl-string"><em style="color: #f58220">"id"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"FIX_ME"</em></strong>,
                        <strong class="hl-string"><em style="color: #f58220">"type"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"object"</em></strong>,
                        <strong class="hl-string"><em style="color: #f58220">"properties"</em></strong>: {
                            <strong class="hl-string"><em style="color: #f58220">"..."</em></strong>: <strong class="hl-string"><em style="color: #f58220">"..."</em></strong>
                        }
                    }
                }
            }
        },
        <strong class="hl-string"><em style="color: #f58220">"UPDATE"</em></strong>: {
            <strong class="hl-string"><em style="color: #f58220">"objectFeatures"</em></strong>: {
                <strong class="hl-string"><em style="color: #f58220">"__ACCOUNT__"</em></strong>: {
                    <strong class="hl-string"><em style="color: #f58220">"denied"</em></strong>: false,
                    <strong class="hl-string"><em style="color: #f58220">"onDeny"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"DO_NOTHING"</em></strong>,
                    <strong class="hl-string"><em style="color: #f58220">"operationOptionInfo"</em></strong>: {
                        <strong class="hl-string"><em style="color: #f58220">"$schema"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"http://json-schema.org/draft-03/schema"</em></strong>,
                        <strong class="hl-string"><em style="color: #f58220">"id"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"FIX_ME"</em></strong>,
                        <strong class="hl-string"><em style="color: #f58220">"type"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"object"</em></strong>,
                        <strong class="hl-string"><em style="color: #f58220">"properties"</em></strong>: {
                            <strong class="hl-string"><em style="color: #f58220">"..."</em></strong>: <strong class="hl-string"><em style="color: #f58220">"..."</em></strong>
                        }
                    }
                }
            }
        }
    }
}</div><p>As OpenIDM produces a full property set for all attributes and all
  object types in the schema from the external resource, the resulting
  configuration can be large. For an LDAP server, OpenIDM can generate a
  configuration containing several tens of thousands of lines, for example.
  You might therefore want to reduce the schema to a minimum on the external
  resource before you run the final command.</p></div></div><div lang="en" class="chapter" title="Chapter&nbsp;6.&nbsp;Configuring Synchronization"><div class="titlepage"><div><div><h2 class="title"><a name="chap-synchronization"></a>Chapter&nbsp;6.&nbsp;Configuring Synchronization</h2></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl><dt><span class="section"><a href="#sync-types">6.1. Types of Synchronization</a></span></dt><dt><span class="section"><a href="#sync-flexible-data">6.2. Flexible Data Model</a></span></dt><dt><span class="section"><a href="#basic-flow">6.3. Basic Data Flow Configuration</a></span></dt><dt><span class="section"><a href="#handling-sync">6.4. Synchronization Situations &amp; Actions</a></span></dt><dt><span class="section"><a href="#correlation">6.5. Correlation Queries</a></span></dt><dt><span class="section"><a href="#advanced-dataflow">6.6. Advanced Data Flow Configuration</a></span></dt><dt><span class="section"><a href="#alternative-mapping">6.7. Alternative Mappings</a></span></dt></dl></div><a class="indexterm" name="d160e2097"></a><p>One of the core services of OpenIDM is synchronizing identity data from
 different resources. This chapter explains what you must know to get started
 configuring OpenIDM's flexible synchronization mechanism, and illustrates the
 concepts with examples.</p><div class="section" title="6.1.&nbsp;Types of Synchronization"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sync-types"></a>6.1.&nbsp;Types of Synchronization</h2></div></div></div><a class="indexterm" name="d160e2105"></a><p>Synchronization happens either when OpenIDM receives a change directly,
  or when OpenIDM discovers a change on an external resource.</p><p>For direct changes to OpenIDM, OpenIDM immediately pushes updates to
  all external resources configured to receive the updates. A direct change
  can originate not only as a write request through the REST interface, but
  also as an update resulting from reconciliation with another resource.</p><div class="variablelist"><p>OpenIDM discovers changes on external resources through reconciliation,
   and through LiveSync.</p><dl><dt><span class="term">Reconciliation</span></dt><dd><a class="indexterm" name="d160e2121"></a><p>In identity management, <em class="firstterm">reconciliation</em> is the
     process of bidirectional synchronization of objects between different data
     stores. Reconciliation applies mainly to user objects, though OpenIDM
     can reconcile any objects, including groups and roles.</p><p>To perform reconciliation, OpenIDM analyzes both source and target
     systems to uncover the differences that it must reconcile. Reconciliation
     can therefore be a heavyweight process. When working with large data sets,
     finding all changes can be more work than processing the changes.</p><p>Reconciliation is, however, thorough. It recognizes system error
     conditions and catches changes that might be missed by the more
     lightweight LiveSync mechanism. Reconciliation therefore serves as the
     basis for compliance and reporting functionality.</p></dd><dt><span class="term">LiveSync</span></dt><dd><a class="indexterm" name="d160e2137"></a><p><em class="firstterm">LiveSync</em> performs the same job as
     reconciliation. LiveSync relies on a change log on the external resource
     to determine which objects have changed.</p><p>LiveSync is intended to react quickly to changes as they happen.
     LiveSync is however a best effort mechanism that in some cases can miss
     changes.</p><p>Furthermore, not all resources provide the change log mechanism
     that LiveSync requires. The change long provides OpenIDM with a list of
     objects changed since the last request such that OpenIDM does not need to
     scan all objects for changes. OpenDJ provides an external change log.
     Active Directory also provides a change log.</p></dd></dl></div><p>In all cases, OpenIDM relies on mappings that you configure to
  determine what to synchronize and how to carry out synchronization.
  LiveSync relies on the set of mappings that you configure once per OpenIDM
  server, whereas reconciliation also allows you to configure specific mappings
  for a particular reconciliation job.</p><p>You must trigger OpenIDM to poll for changes on external resources,
  usually by scheduling reconciliation or LiveSync as described in the chapter
  on <a href="../integrators-guide/index.html#chap-scheduler-conf" class="link"><em class="citetitle">Scheduling
  Synchronization</em></a>. Alternatively, you can start
  reconciliation through the REST interface.</p><div class="screen" width="91">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 --request POST
 "http://localhost:8080/openidm/sync?_action=recon&amp;mapping=systemLdapAccounts_managedUser"</div></div><div class="section" title="6.2.&nbsp;Flexible Data Model"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sync-flexible-data"></a>6.2.&nbsp;Flexible Data Model</h2></div></div></div><a class="indexterm" name="d160e2162"></a><p>Identity management software tends to favor either a meta-directory
  data model, where all data are mirrored in a central repository, or a
  virtual data model, where only a minimum set of attributes are stored
  centrally, and most are loaded on demand from the external resources
  on which they are stored. The meta-directory model offers fast access at
  the risk of getting out-of-date data. The virtual model guarantees fresh
  data, but pays for that guarantee in terms of performance.</p><p>OpenIDM leaves the data model choice with you. You determine the right
  trade offs for a particular deployment. OpenIDM does not hard code any
  particular schema or set of attributes stored in the repository. Instead,
  you define how external system objects map onto managed objects, and OpenIDM
  dynamically updates the repository to store the managed object attributes
  that you configure.</p><p>You can, for example, choose to follow the data model defined in the
  Simple Cloud Identity Management (<a class="link" href="http://www.simplecloud.info/specs/draft-scim-core-schema-00.html" target="_blank">SCIM</a>) specification. The following object represents a SCIM
  user.</p><div class="programlisting">
{
    <strong class="hl-string"><em style="color: #f58220">"userName"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"james1"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"familyName"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"Berg"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"givenName"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"James"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"email"</em></strong>: [
        <strong class="hl-string"><em style="color: #f58220">"james1@example.com"</em></strong>
    ],
    <strong class="hl-string"><em style="color: #f58220">"description"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"Created by OpenIDM REST."</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"password"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"asdfkj23"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"displayName"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"James Berg"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"phoneNumber"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"12345"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"employeeNumber"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"12345"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"userType"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"Contractor"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"title"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"Vice President"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"active"</em></strong>: true
}</div><div class="note" title="Note" style="font-style: italic;"><h3 class="title">Note</h3><p>Avoid using the dash character ( <code class="literal">-</code> ) in property
   names, like <code class="literal">last-name</code>, as dashes in names make
   JavaScript syntax more complex. If you cannot avoid the dash, then write
   <code class="literal">source['last-name']</code> instead of
   <code class="literal">source.last-name</code> in java script.</p></div></div><div class="section" title="6.3.&nbsp;Basic Data Flow Configuration"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="basic-flow"></a>6.3.&nbsp;Basic Data Flow Configuration</h2></div></div></div><p>Data flow for synchronization involves three types of configuration
  files, two of which you typically edit, and also a links table that OpenIDM
  maintains in its repository, as well as scripts needed to check objects and
  manipulate attributes. The two types of configuration files you edit are the
  connector configuration files, with one file per external resource, and the
  synchronization mappings file, with one file per OpenIDM instance.</p><div class="variablelist"><dl><dt><span class="term">Connector configuration files</span></dt><dd><a class="indexterm" name="d160e2203"></a><p>Connector configuration files are described in the chapter on <a href="../integrators-guide/index.html#chap-resource-conf" class="link"><em class="citetitle">Connecting to
     External Resources</em></a>. Connector configuration files are
     named <code class="filename">openidm/conf/provisioner.<em class="replaceable"><code>resource-name</code></em>.json</code>,
     where <em class="replaceable"><code>resource-name</code></em> reflects the connector
     technology and external resource, such as
     <code class="literal">openicf-xml</code>.</p><p>An excerpt from an example connector configuration follows. The
     example shows the name for the connector and two attributes of an account
     object type. In the attribute mapping definitions, the attribute name is
     mapped from the <code class="literal">nativeName</code>, the attribute name used on
     the external resource, to the attribute name used in OpenIDM. Thus the
     example shows that <code class="literal">sn</code> from LDAP is mapped to
     <code class="literal">lastName</code> in OpenIDM. The <code class="literal">homePhone</code>
     attribute can have multiple values.</p><div class="programlisting">
{
    <strong class="hl-string"><em style="color: #f58220">"name"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"MyLDAP"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"objectTypes"</em></strong>: {
        <strong class="hl-string"><em style="color: #f58220">"account"</em></strong>: {
            <strong class="hl-string"><em style="color: #f58220">"lastName"</em></strong>: {
                <strong class="hl-string"><em style="color: #f58220">"type"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"string"</em></strong>,
                <strong class="hl-string"><em style="color: #f58220">"required"</em></strong>: true,
                <strong class="hl-string"><em style="color: #f58220">"nativeName"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"sn"</em></strong>,
                <strong class="hl-string"><em style="color: #f58220">"nativeType"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"string"</em></strong>
            },
            <strong class="hl-string"><em style="color: #f58220">"homePhone"</em></strong>: {
                <strong class="hl-string"><em style="color: #f58220">"type"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"array"</em></strong>,
                <strong class="hl-string"><em style="color: #f58220">"items"</em></strong>: {
                    <strong class="hl-string"><em style="color: #f58220">"type"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"string"</em></strong>,
                    <strong class="hl-string"><em style="color: #f58220">"nativeType"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"string"</em></strong>
                },
                <strong class="hl-string"><em style="color: #f58220">"nativeName"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"homePhone"</em></strong>,
                <strong class="hl-string"><em style="color: #f58220">"nativeType"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"string"</em></strong>
            }
        }
    }
}</div><p>In order for OpenIDM to access external resource objects and
     attributes, the object and its attributes must match the connector
     configuration. Also, the connector file strictly maps external resource
     objects to OpenIDM objects. To construct attributes and to manipulate
     their values, you use the synchronization mappings file.</p></dd><dt><span class="term">Synchronization mappings file</span></dt><dd><a class="indexterm" name="d160e2248"></a><a class="indexterm" name="d160e2253"></a><p>The synchronization mappings file is
     <code class="filename">openidm/conf/sync.json</code>. The synchronization mappings
     represent the core configuration for OpenIDM synchronization.</p><p>The <code class="filename">sync.json</code> file describes a set of mappings.
     Each mapping specifies how attributes from source objects correspond to
     attributes on target objects. The source and target indicate the direction
     for the data flow, so you must define a mapping for each data flow. For
     example, if you want data flows from an LDAP server to the repository
     and also from the repository to the LDAP server, you must define two
     separate mappings.</p><p>You identify external resource sources and targets as
     <code class="literal">system/<em class="replaceable"><code>name</code></em>/<em class="replaceable"><code>object-type</code></em></code>, where
     <em class="replaceable"><code>name</code></em> is the name used in the connector
     configuration file, and <em class="replaceable"><code>object-type</code></em> is the
     object defined in the connector configuration file list of object types.
     For objects in OpenIDM's internal repository, you use
     <code class="literal">managed/<em class="replaceable"><code>object-type</code></em></code>, where
     <em class="replaceable"><code>object-type</code></em> is defined in
     <code class="filename">openidm/conf/managed.json</code>. The name for the mapping
     by convention is set to a string of the form
     <code class="literal"><em class="replaceable"><code>source</code></em>_<em class="replaceable"><code>target</code></em></code>, as shown in the following example.</p><a name="basic-ldap-mapping"></a><div class="programlisting">
{
    <strong class="hl-string"><em style="color: #f58220">"mappings"</em></strong>: [
        {
            <strong class="hl-string"><em style="color: #f58220">"name"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"systemLdapAccounts_managedUser"</em></strong>,
            <strong class="hl-string"><em style="color: #f58220">"source"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"system/MyLDAP/account"</em></strong>,
            <strong class="hl-string"><em style="color: #f58220">"target"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"managed/user"</em></strong>,
            <strong class="hl-string"><em style="color: #f58220">"properties"</em></strong>: [
                {
                    <strong class="hl-string"><em style="color: #f58220">"target"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"familyName"</em></strong>,
                    <strong class="hl-string"><em style="color: #f58220">"source"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"lastName"</em></strong>
                },
                {
                    <strong class="hl-string"><em style="color: #f58220">"target"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"homePhone"</em></strong>,
                    <strong class="hl-string"><em style="color: #f58220">"source"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"homePhone"</em></strong>
                },
                {
                    <strong class="hl-string"><em style="color: #f58220">"target"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"phoneExtension"</em></strong>,
                    <strong class="hl-string"><em style="color: #f58220">"default"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"0047"</em></strong>
                },
                {
                    <strong class="hl-string"><em style="color: #f58220">"target"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"mail"</em></strong>,
                    <strong class="hl-string"><em style="color: #f58220">"comment"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"Set mail if non-empty."</em></strong>,
                    <strong class="hl-string"><em style="color: #f58220">"source"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"email"</em></strong>,
                    <strong class="hl-string"><em style="color: #f58220">"condition"</em></strong>: {
                        <strong class="hl-string"><em style="color: #f58220">"type"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"text/javascript"</em></strong>,
                        <strong class="hl-string"><em style="color: #f58220">"source"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"(source.email != null)"</em></strong>
                    }
                },
                {
                    <strong class="hl-string"><em style="color: #f58220">"target"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"displayName"</em></strong>,
                    <strong class="hl-string"><em style="color: #f58220">"source"</em></strong>: <strong class="hl-string"><em style="color: #f58220">""</em></strong>;
                    <strong class="hl-string"><em style="color: #f58220">"transform"</em></strong>: {
                        <strong class="hl-string"><em style="color: #f58220">"type"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"text/javascript"</em></strong>,
                        <strong class="hl-string"><em style="color: #f58220">"source"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"(source.lastName +', ' + source.firstName;)"</em></strong>
                    }
                }
            ]
        }
    ]
}</div><p>In this example, the source is the external resource,
     <code class="literal">MyLDAP</code>, and the target is OpenIDM's repository,
     specifically the managed user objects. The <code class="literal">properties</code>
     reflect OpenIDM attribute names. For example, the mapping has the
     attribute <code class="literal">lastName</code> defined in the
     <code class="literal">MyLDAP</code> connector configuration file mapped to
     <code class="literal">familyName</code> in the OpenIDM managed user object. Notice
     that the attribute names come from the connector configuration, rather
     than the external resource itself.</p><a class="indexterm" name="d160e2319"></a><p>You can create attributes on the target as part of the
     mapping. In the example, OpenIDM creates a
     <code class="literal">phoneExtension</code> attribute with a default value of
     <code class="literal">0047</code>.</p><a class="indexterm" name="d160e2332"></a><p>You can also set up conditions under which OpenIDM maps attributes
     as shown for the email attribute in the example. By default, OpenIDM
     synchronizes all attributes. In the example, the mail attribute is set
     only if the script for the condition returns
     <code class="literal">true</code>.</p><a class="indexterm" name="d160e2342"></a><p>OpenIDM lets you transform attributes as well. In the example, the
     <code class="literal">displayName</code> attribute is set using a combination of
     the <code class="literal">lastName</code> and <code class="literal">firstName</code> attribute
     values from the source. For transformations, the <code class="literal">source</code>
     property is optional. However, the source object is only available
     when you specify the <code class="literal">source</code> property. Therefore, in
     order to use <code class="literal">source.lastName</code> and
     <code class="literal">source.firstName</code> to calculate the
     <code class="literal">displayName</code>, the example specifies <code class="literal">"source" :
     ""</code>.</p><p>To add a flow from the repository to <code class="literal">MyLDAP</code>,
     you would define a mapping with source <code class="literal">managed/user</code>
     and target <code class="literal">system/MyLDAP/account</code>, named for example
     <code class="literal">managedUser_systemLdapAccounts</code>.</p><div class="mediaobject" title="OpenIDM name space and object paths"><a name="figure-service-tree"></a><img src="images/ServiceTree.png" longdesc="/Users/mark/Documents/workspace/openidm-2.0.x/target/docbkx/html/integrators-guide/figure-service-tree.html"><div class="longdesc-link" align="right"><br clear="all"><span class="longdesc-link">[<a href="figure-service-tree.html" target="longdesc">D</a>]</span></div><div class="caption"><p>OpenIDM stores managed objects in the repository, and exposes
       them under <code class="literal">/openidm/managed</code>. System objects on
       external resources are exposed under
       <code class="literal">/openidm/system</code>.</p></div></div><div class="variablelist"><a class="indexterm" name="d160e2409"></a><p>By default, OpenIDM synchronizes all objects matching those defined
      in the connector configuration for the resource. Many connectors let you
      limit the scope of objects the connector accesses. For example, the LDAP
      connector lets you specify base DNs and LDAP filters so you need not
      access every entry in the directory. Yet, OpenIDM also lets you filter
      what is considered a valid source or valid target for synchronization by
      using JavaScript code. To apply these filters, use the
      <code class="literal">validSource</code>, and <code class="literal">validTarget</code>
      properties in your mapping.</p><dl><dt><span class="term">validSource</span></dt><dd><p>A script that determines if a source object is valid to be
         mapped. The script yields a boolean value: <code class="literal">true</code>
         indicates the source object is valid; <code class="literal">false</code> can be
         used to defer mapping until some condition is met. In the root scope,
         the source object is provided in the <code class="literal">"source"</code>
         property. If the script is not specified, then all source objects are
         considered valid.</p><div class="programlisting">
{
    <strong class="hl-string"><em style="color: #f58220">"validSource"</em></strong>: {
        <strong class="hl-string"><em style="color: #f58220">"type"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"text/javascript"</em></strong>,
        <strong class="hl-string"><em style="color: #f58220">"source"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"source.ldapPassword != null"</em></strong>
    }
}
</div></dd><dt><span class="term">validTarget</span></dt><dd><p>A script used during reconciliation's second phase, that determines if a target
         object is valid to be mapped. The script yields a boolean value:
         <code class="literal">true</code> indicates the target object is valid;
         <code class="literal">false</code> indicates that the target object should not be
         included in reconciliation. In the root scope, the source object is
         provided in the <code class="literal">"target"</code> property. If the script is
         not specified, then all target objects are considered valid for
         mapping.</p><div class="programlisting">
{
    <strong class="hl-string"><em style="color: #f58220">"validTarget"</em></strong>: {
        <strong class="hl-string"><em style="color: #f58220">"type"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"text/javascript"</em></strong>,
        <strong class="hl-string"><em style="color: #f58220">"source"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"target.employeeType == 'internal'"</em></strong>
    }
}
</div></dd></dl></div><p>During synchronization, your scripts always have access to a
     <code class="literal">source</code> object and a <code class="literal">target</code> object.
     Examples already shown in this section use <code class="literal">source.<em class="replaceable"><code>attributeName</code></em></code> to retrieve attributes from the
     source objects. Your scripts can also write to target attributes using
     <code class="literal">target.<em class="replaceable"><code>attributeName</code></em></code>
     syntax.</p><div class="programlisting">
{
    <strong class="hl-string"><em style="color: #f58220">"onUpdate"</em></strong>: {
        <strong class="hl-string"><em style="color: #f58220">"type"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"text/javascript"</em></strong>,
        <strong class="hl-string"><em style="color: #f58220">"source"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"if ((source.email != null) {target.mail = source.email;}"</em></strong>
    }
}</div><p>See the <a href="../integrators-guide/index.html#appendix-scripting" class="link"><em class="citetitle">Scripting
     Reference</em></a> appendix for more on scripting.</p></dd></dl></div><div class="section" title="6.3.1.&nbsp;Using Encrypted Values"><div class="titlepage"><div><div><h3 class="title"><a name="sync-encrypted-values"></a>6.3.1.&nbsp;Using Encrypted Values</h3></div></div></div><a class="indexterm" name="d160e2485"></a><p>OpenIDM supports reversible encryption of attribute values for
   managed objects. Attribute values to encrypt include passwords (if passwords
   are not already encrypted on the external resource, which would usually exclude them from the synchronization process, see the chapter about <a href="../integrators-guide/index.html#chap-passwords" class="link">
  <em class="citetitle">Passwords</em>
</a>), and also authentication
   questions, credit card numbers, and social security numbers.</p><p>You configure encryption in the managed object configuration. The file
   to edit is <code class="filename">openidm/conf/managed.json</code>. The following
   example shows a managed object configuration that encrypts and decrypts
   <code class="literal">securityAnswer</code>, <code class="literal">ssn</code>, and
   <code class="literal">password</code> attributes using the default symmetric
   key, and additional scripts for extra passwords.</p><div class="programlisting">
{
    <strong class="hl-string"><em style="color: #f58220">"objects"</em></strong>: [
        {
            <strong class="hl-string"><em style="color: #f58220">"name"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"user"</em></strong>,
            <strong class="hl-string"><em style="color: #f58220">"properties"</em></strong>: [
                {
                    <strong class="hl-string"><em style="color: #f58220">"name"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"securityAnswer"</em></strong>,
                    <strong class="hl-string"><em style="color: #f58220">"encryption"</em></strong>: {
                        <strong class="hl-string"><em style="color: #f58220">"key"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"openidm-sym-default"</em></strong>
                    }
                },
                {
                    <strong class="hl-string"><em style="color: #f58220">"name"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"ssn"</em></strong>,
                    <strong class="hl-string"><em style="color: #f58220">"encryption"</em></strong>: {
                        <strong class="hl-string"><em style="color: #f58220">"key"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"openidm-sym-default"</em></strong>
                    }
                },
                {
                    <strong class="hl-string"><em style="color: #f58220">"name"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"password"</em></strong>,
                    <strong class="hl-string"><em style="color: #f58220">"encryption"</em></strong>: {
                        <strong class="hl-string"><em style="color: #f58220">"key"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"openidm-sym-default"</em></strong>
                    }
                }
            ],
            <strong class="hl-string"><em style="color: #f58220">"onStore"</em></strong>: {
                <strong class="hl-string"><em style="color: #f58220">"type"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"text/javascript"</em></strong>,
                <strong class="hl-string"><em style="color: #f58220">"file"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"script/encryptExtraPassword.js"</em></strong>
            },
            <strong class="hl-string"><em style="color: #f58220">"onRetrieve"</em></strong>: {
                <strong class="hl-string"><em style="color: #f58220">"type"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"text/javascript"</em></strong>,
                <strong class="hl-string"><em style="color: #f58220">"file"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"script/decryptExtraPassword.js"</em></strong>
            }
        }
    ]
}</div><p>Do not use the default symmetric key,
   <code class="literal">openidm-sym-default</code>, in production. See the chapter on
   <a href="../integrators-guide/index.html#chap-security" class="link"><em class="citetitle">Securing
   &amp; Hardening OpenIDM</em></a> for instructions on adding your
   own symmetric key.</p></div><div class="section" title="6.3.2.&nbsp;Constructing &amp; Manipulating Attributes"><div class="titlepage"><div><div><h3 class="title"><a name="constructing-attributes"></a>6.3.2.&nbsp;Constructing &amp; Manipulating Attributes</h3></div></div></div><a class="indexterm" name="d160e2526"></a><p>OpenIDM lets you construct and manipulate attributes using scripts
   triggered when an object is created (onCreate), updated (onUpdate), or
   deleted (onDelete), or when a link is created (onLink), or removed
   (onUnlink).</p><p>The following example derives a DN for an LDAP entry when the entry
   is created in the internal repository.</p><div class="programlisting">
{
    <strong class="hl-string"><em style="color: #f58220">"onCreate"</em></strong>: {
        <strong class="hl-string"><em style="color: #f58220">"type"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"text/javascript"</em></strong>,
        <strong class="hl-string"><em style="color: #f58220">"source"</em></strong>:
            <strong class="hl-string"><em style="color: #f58220">"target.dn = 'uid=' + source.uid + ',ou=people,dc=example,dc=com'"</em></strong>
    }
}</div></div><div class="section" title="6.3.3.&nbsp;Reusing Links"><div class="titlepage"><div><div><h3 class="title"><a name="reusing-links"></a>6.3.3.&nbsp;Reusing Links</h3></div></div></div><a class="indexterm" name="d160e2540"></a><p>When two mappings exist to sync the same objects bidirectionally,
   you can use the <code class="literal">links</code> property in one mapping to have
   OpenIDM use the same internally managed link for both mappings. Otherwise,
   if no <code class="literal">links</code> property is specified, OpenIDM maintains a
   link for each mapping.</p><p>The following excerpt shows two mappings, one from MyLDAP accounts
   to managed users, and another from managed users to MyLDAP accounts. In
   the second mapping, the <code class="literal">link</code> property tells OpenIDM
   to reuse the links created in the first mapping, rather than create new
   links.</p><div class="programlisting">
{
    <strong class="hl-string"><em style="color: #f58220">"mappings"</em></strong>: [
        {
            <strong class="hl-string"><em style="color: #f58220">"name"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"systemMyLDAPAccounts_managedUser"</em></strong>,
            <strong class="hl-string"><em style="color: #f58220">"source"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"system/MyLDAP/account"</em></strong>,
            <strong class="hl-string"><em style="color: #f58220">"target"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"managed/user"</em></strong>
        },
        {
            <strong class="hl-string"><em style="color: #f58220">"name"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"managedUser_systemMyLDAPAccounts"</em></strong>,
            <strong class="hl-string"><em style="color: #f58220">"source"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"managed/user"</em></strong>,
            <strong class="hl-string"><em style="color: #f58220">"target"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"system/MyLDAP/account"</em></strong>,
            <strong class="hl-string"><em style="color: #f58220">"links"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"systemMyLDAPAccounts_managedUser"</em></strong>
        }
    ]
}</div></div></div><div class="section" title="6.4.&nbsp;Synchronization Situations &amp; Actions"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="handling-sync"></a>6.4.&nbsp;Synchronization Situations &amp; Actions</h2></div></div></div><a class="indexterm" name="d160e2563"></a><a class="indexterm" name="d160e2568"></a><p>During synchronization, OpenIDM categorizes objects by situation.
  Situations are characterized by whether an object exists on a source or
  target system, whether OpenIDM has registered a link between the source
  object and the target object, and whether the object is considered valid.
  OpenIDM takes action depending on the situation.</p><p>You can define actions for particular situations in the
  <code class="literal">policies</code> section of a synchronization mapping, as
  shown in the following excerpt.</p><div class="programlisting">
{
    <strong class="hl-string"><em style="color: #f58220">"policies"</em></strong>: [
        {
            <strong class="hl-string"><em style="color: #f58220">"situation"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"CONFIRMED"</em></strong>,
            <strong class="hl-string"><em style="color: #f58220">"action"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"UPDATE"</em></strong>
        },
        {
            <strong class="hl-string"><em style="color: #f58220">"situation"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"FOUND"</em></strong>,
            <strong class="hl-string"><em style="color: #f58220">"action"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"IGNORE"</em></strong>
        },
        {
            <strong class="hl-string"><em style="color: #f58220">"situation"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"ABSENT"</em></strong>,
            <strong class="hl-string"><em style="color: #f58220">"action"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"CREATE"</em></strong>
        },
        {
            <strong class="hl-string"><em style="color: #f58220">"situation"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"AMBIGUOUS"</em></strong>,
            <strong class="hl-string"><em style="color: #f58220">"action"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"IGNORE"</em></strong>
        },
        {
            <strong class="hl-string"><em style="color: #f58220">"situation"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"MISSING"</em></strong>,
            <strong class="hl-string"><em style="color: #f58220">"action"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"IGNORE"</em></strong>
        },
        {
            <strong class="hl-string"><em style="color: #f58220">"situation"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"UNQUALIFIED"</em></strong>,
            <strong class="hl-string"><em style="color: #f58220">"action"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"IGNORE"</em></strong>
        },
        {
            <strong class="hl-string"><em style="color: #f58220">"situation"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"UNASSIGNED"</em></strong>,
            <strong class="hl-string"><em style="color: #f58220">"action"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"IGNORE"</em></strong>
        }
    ]
}</div><p>If you do not define a policy for a particular situation, OpenIDM
  takes the default action for the situation.</p><p>The situations and their corresponding actions are described in the
  sections below.</p><div class="section" title="6.4.1.&nbsp;Synchronization Situations"><div class="titlepage"><div><div><h3 class="title"><a name="sync-situations"></a>6.4.1.&nbsp;Synchronization Situations</h3></div></div></div><p>OpenIDM performs synchronization action in two phases. First, OpenIDM
   performs the so called source reconciliation, where OpenIDM accounts for source objects
   and associated links based on the mapping configured. Second, OpenIDM runs
   the target reconciliation, where OpenIDM iterates over the target objects not
   processed in the first phase.</p><div class="orderedlist"><p>During reconciliation OpenIDM builds three lists, assigning values
    to the objects to reconcile.</p><ol class="orderedlist" type="1"><li class="listitem"><p>All valid objects from the source</p><p>OpenIDM assigns valid source objects <code class="literal">qualifies=1</code>.
     Invalid objects, including those not found in the source system, and those
     filtered out by the script specified in the <code class="literal">validSource</code>
     property get <code class="literal">qualifies=0</code>.</p></li><li class="listitem"><p>All records from the appropriate link table</p><p>Objects with corresponding links in the link table of the repository
     get <code class="literal">link=1</code>. Objects without corresponding links get
     <code class="literal">link=0</code>.</p></li><li class="listitem"><p>All valid objects on the target system</p><p>Object found in the target system get <code class="literal">target=1</code>.
     Objects not found in the target system get
     <code class="literal">target=0</code>.</p></li></ol></div><div class="variablelist"><p>Based on the values assigned to objects during source reconciliation,
    OpenIDM assigns situations, listed here with their default actions.</p><dl><dt><span class="term">"CONFIRMED" (qualifies=1, link=1, target=1)</span></dt><dd><p>The mapping qualifies for a target object, and a link to an existing target
      object was found. Detected during change events and reconciliation. Default action: "UPDATE".</p></dd><dt><span class="term">"FOUND" (qualifies=1, link=0, target=1)</span></dt><dd><p>The mapping qualifies for a target object, there is no link to a
      target object, and there is a single target object, correlated by the logic found in the correlationQuery.
      Detected during change events and reconciliation. Default action:
      "UPDATE".</p></dd><dt><span class="term">"ABSENT" (qualifies=1, link=0, target=0)</span></dt><dd><p>The mapping qualifies for a target object, there is no link to a
      target object, and there is no correlated target object found.
      Detected during change events and reconciliation. Default action:
      "CREATE".</p></dd><dt><span class="term">"AMBIGUOUS" (qualifies=1, link=0, target&gt;1)</span></dt><dd><p>The mapping qualifies for a target object, there is no link to a
      target object, but there is more than one correlated target object. Detected during source object changes and reconciliation. Default
      action: "EXCEPTION".</p></dd><dt><span class="term">"MISSING" (qualifies=1, link=1, target=0)</span></dt><dd><p>The mapping is qualified for a target object, and there is a
      qualified link to a target object, but the target object is missing.
      Only detected during reconciliation and source object changes in synchronous mappings.
      Default action: "EXCEPTION".</p></dd><dt><span class="term">"UNQUALIFIED" (qualifies=0, link=0 or 1, target=1 or &gt;1)</span></dt><dd><p>The mapping is not qualified for a source object. There is one or more targets found through the correlation logic. Detected during change events and
      reconciliation. Default action: "DELETE".</p></dd><dt><span class="term">"SOURCE_IGNORED" (qualifies=0, link=0, target=0)</span></dt><dd><p>The source object is unqualified (by validSource), no link, no target is found. Detected during source object changes and reconciliation. Default action: "IGNORE".</p></dd></dl></div><p>Based on the values assigned to objects during target reconciliation,
    OpenIDM assigns situations, listed here with their default actions.</p><div class="variablelist"><dl><dt><span class="term">"TARGET_IGNORED" (qualifies=0)</span></dt><dd><p>During target reconciliation the target becomes unqualified by the "validTagrt" script. Only detected during reconciliation. Default action: "IGNORE"</p></dd><dt><span class="term">"UNASSIGNED" (qualifies=1, link=0)</span></dt><dd><p>A target object exists for which there is no link. Only detected
      during reconciliation. Default action: "EXCEPTION".</p></dd><dt><span class="term">"CONFIRMED" (qualifies=1, link=1, source=1)</span></dt><dd><p>The mapping qualifies for a target object, and a link to a
      source object exists. Detected only during reconciliation. Default
      action: "UPDATE".</p></dd><dt><span class="term">"UNQUALIFIED" (qualifies=0, link=1, source=1, but source does not qualify)</span></dt><dd><p>The mapping is not qualified (by validTarget) for a target object, and there is a
      link from an existing source object where the source exists. Detected during change events and
      reconciliation. Default action: "DELETE".</p></dd><dt><span class="term">SOURCE_MISSING (qualifies=1, link=1, source=0)</span></dt><dd><p>The target qualifies and a link is found. But the source object is missing. Only detected during reconciliation. Default action: "EXCEPTION".</p></dd></dl></div><p>The following sections reiterate in detail how OpenIDM assigns
   situations during each of the two synchronization phases.</p></div><div class="section" title="6.4.2.&nbsp;Source Reconciliation"><div class="titlepage"><div><div><h3 class="title"><a name="source-reconciliation"></a>6.4.2.&nbsp;Source Reconciliation</h3></div></div></div><p>OpenIDM starts reconciliation and LiveSync by reading a list of
   objects from the resource. For reconciliation, the list includes all
   objects available through the connector. For LiveSync, the list contains
   only changed objects. The connector can filter objects out of the list, too.
   You can filter objects out of the list by using the
   <code class="literal">validSource</code> property.</p><p>OpenIDM then iterates over the list, checking each entry against the
   <code class="literal">validSource</code> filter, classifying objects according to
   their situations as described in <a class="xref" href="#sync-situations" title="6.4.1.&nbsp;Synchronization Situations">Section&nbsp;6.4.1, &#8220;Synchronization Situations&#8221;</a>. OpenIDM
   uses the list of links for the current mapping to classify objects. Finally,
   OpenIDM executes the action configured for the situation.</p><p>The following table shows how OpenIDM assigns the appropriate
   situation during source reconciliation, depending on whether a valid
   source exists (Source Qualifies), whether a link with the appropriate type
   exists in the repository (Link Exists), and how many target objects are
   found either based on links or correlation results.</p><div class="table"><a name="d160e2727"></a><div class="table-title">Table&nbsp;6.1.&nbsp;Resolving Source Reconciliation Situations</div><div class="table-contents"><table summary="Resolving Source Reconciliation Situations" width="100%" border="0"><colgroup><col width="11%" class="c1"><col width="11%" class="c2"><col width="11%" class="c3"><col width="11%" class="c4"><col width="11%" class="c5"><col width="11%" class="c6"><col width="11%" class="c7"><col width="23%" class="c8"></colgroup><thead><tr><th colspan="2" align="left">Source Qualifies?</th><th colspan="2" align="left">Link Exists?</th><th colspan="3" align="left">Target Objects
       Found<sup>[<a name="d160e2747" href="#ftn.d160e2747" class="footnote">a</a>]</sup></th><th rowspan="2" align="left" valign="top">Situation</th></tr><tr><th>Yes</th><th>No</th><th>Yes</th><th>No</th><th>0</th><th>1</th><th>&gt; 1</th></tr></thead><tbody><tr><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>X</td><td>X</td><td>&nbsp;</td><td>&nbsp;</td><td>SOURCE_IGNORED</td></tr><tr><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>UNQUALIFIED</td></tr><tr><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>&nbsp;</td><td>X</td><td>UNQUALIFIED</td></tr><tr><td>&nbsp;</td><td>X</td><td>X</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>&nbsp;</td><td>UNQUALIFIED</td></tr><tr><td>&nbsp;</td><td>X</td><td>X</td><td>&nbsp;</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>UNQUALIFIED</td></tr><tr><td>&nbsp;</td><td>X</td><td>X</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>X</td><td>UNQUALIFIED</td></tr><tr><td>X</td><td>&nbsp;</td><td>&nbsp;</td><td>X</td><td>X</td><td>&nbsp;</td><td>&nbsp;</td><td>ABSENT</td></tr><tr><td>X</td><td>&nbsp;</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>FOUND</td></tr><tr><td>X</td><td>&nbsp;</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>&nbsp;</td><td>X</td><td>AMBIGUOUS</td></tr><tr><td>X</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>&nbsp;</td><td>MISSING</td></tr><tr><td>X</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>CONFIRMED</td></tr></tbody><tbody class="footnotes"><tr><td colspan="8"><div class="footnote"><p><sup>[<a id="ftn.d160e2747" href="#d160e2747" class="para">a</a>] </sup>If no link exists for the source object, then
       OpenIDM executes a correlation query.</p></div></td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" title="6.4.3.&nbsp;Target Reconciliation"><div class="titlepage"><div><div><h3 class="title"><a name="target-reconciliation"></a>6.4.3.&nbsp;Target Reconciliation</h3></div></div></div><p>During source reconciliation, OpenIDM cannot detect situations where
   no source object exists, such as the UNASSIGNED situation. When no source
   object exists, OpenIDM detects the situation during the second
   reconciliation phase, target reconciliation. During target reconciliation,
   OpenIDM iterates over all target objects that do not have a representation
   on the source, checking each object against the
   <code class="literal">validTarget</code> filter, determining the appropriate situation,
   and executing the action configured for the situation.</p><p>The following table shows how OpenIDM assigns the appropriate
   situation during target reconciliation, depending on whether a valid target
   exists (Target Qualifies), whether a link with an appropriate type exists
   in the repository (Link Exists), whether a source object exists
   (Source Exists), and whether the source object qualifies (Source Qualifies).
   Not all situations assigned during source reconciliation are assigned
   during target reconciliation.</p><div class="table"><a name="d160e2965"></a><div class="table-title">Table&nbsp;6.2.&nbsp;Resolving Target Reconciliation Situations</div><div class="table-contents"><table summary="Resolving Target Reconciliation Situations" width="100%" border="0"><colgroup><col width="10%" class="c1"><col width="10%" class="c2"><col width="10%" class="c3"><col width="10%" class="c4"><col width="10%" class="c5"><col width="10%" class="c6"><col width="10%" class="c7"><col width="10%" class="c8"><col width="20%" class="c9"></colgroup><thead><tr><th colspan="2" align="left">Target Qualifies?</th><th colspan="2" align="left">Link Exists?</th><th colspan="2" align="left">Source Exists?</th><th colspan="2" align="left">Source Qualifies?</th><th rowspan="2" align="left" valign="top">Situation</th></tr><tr><th>Yes</th><th>No</th><th>Yes</th><th>No</th><th>Yes</th><th>No</th><th>Yes</th><th>No</th></tr></thead><tbody><tr><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>TARGET_IGNORED</td></tr><tr><td>X</td><td>&nbsp;</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>&nbsp;</td><td>UNASSIGNED</td></tr><tr><td>X</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>CONFIRMED</td></tr><tr><td>X</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>&nbsp;</td><td>X</td><td>UNQUALIFIED</td></tr><tr><td>X</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>&nbsp;</td><td>SOURCE_MISSING</td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" title="6.4.4.&nbsp;Synchronization Actions"><div class="titlepage"><div><div><h3 class="title"><a name="sync-actions"></a>6.4.4.&nbsp;Synchronization Actions</h3></div></div></div><div class="variablelist"><p>Once OpenIDM has assigned a situation to an object, OpenIDM takes
    the actions configured in the mapping. If no action is configured, then
    OpenIDM takes the default action for the situation. OpenIDM supports the
    following actions.</p><dl><dt><span class="term">"CREATE"</span></dt><dd><p>Create and link a target object.</p></dd><dt><span class="term">"UPDATE"</span></dt><dd><p>Link and update a target object.</p></dd><dt><span class="term">"DELETE"</span></dt><dd><p>Delete and unlink the target object.</p></dd><dt><span class="term">"LINK"</span></dt><dd><p>Link the correlated target object.</p></dd><dt><span class="term">"UNLINK"</span></dt><dd><p>Unlink the linked target object.</p></dd><dt><span class="term">"EXCEPTION"</span></dt><dd><p>Flag the link situation as an exception.</p></dd><dt><span class="term">"IGNORE"</span></dt><dd><p>Do not change the link or target object state.</p></dd></dl></div></div></div><div class="section" title="6.5.&nbsp;Correlation Queries"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="correlation"></a>6.5.&nbsp;Correlation Queries</h2></div></div></div><a class="indexterm" name="d160e3154"></a><a class="indexterm" name="d160e3159"></a><p>Every time OpenIDM creates an object through synchronization, it
  creates a link between the source and target objects. OpenIDM then uses the
  link to determine the object's situation during later synchronization
  operations.</p><p>Initial, bulk synchronization operations can involve correlating
  many objects that exist both on source and target systems. In this case,
  OpenIDM uses correlation queries to find target objects that already exist,
  and that correspond to source objects. For the target objects that match
  a correlation query, OpenIDM needs only to create a link, rather than a
  new target object.</p><p>Correlation queries run against target resources. The query syntax
  therefore depends on the target system, and is either specific to the data
  store underlying the OpenIDM repository, or to OpenICF query
  capabilities.</p><div class="section" title="6.5.1.&nbsp;Managed Object as Correlation Query Target"><div class="titlepage"><div><div><h3 class="title"><a name="correlation-query-managed-object"></a>6.5.1.&nbsp;Managed Object as Correlation Query Target</h3></div></div></div><p>Queries on managed objects in the repository must be defined in the
   configuration file for the repository, which is either
   <code class="filename">openidm/conf/repo.orientdb.json</code>, or
   <code class="filename">openidm/conf/repo.jdbc.json</code>.</p><p>The following example shows a correlation query defined in
   <code class="filename">openidm/conf/repo.orientdb.json</code>.</p><div class="programlisting">
<strong class="hl-string"><em style="color: #f58220">"for-userName"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"SELECT * FROM ${_resource} WHERE userName = '${uid}'"</em></strong></div><p>The following correlation query example shows the JavaScript to call
   the query defined for OrientDB. The <code class="literal">_query-id</code> property
   value matches the name of the query specified in
   <code class="filename">openidm/conf/repo.orientdb.json</code>,
   <code class="literal">for-userName</code>. The <code class="literal">source.name</code> value
   replaces <code class="literal">${uid}</code> in the query. OpenIDM replaces
   <code class="literal">${_resource}</code> in the query with the name of table that
   holds managed objects.</p><div class="programlisting">
{
  <strong class="hl-string"><em style="color: #f58220">"correlationQuery"</em></strong>: {
    <strong class="hl-string"><em style="color: #f58220">"type"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"text/javascript"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"source"</em></strong>:
      <strong class="hl-string"><em style="color: #f58220">"var query = {'_query-id' : 'for-userName', 'uid' : source.name}; query;"</em></strong>
  }
}</div><p>The query can return zero or more objects, so the situation OpenIDM
   assigns to the source object depends on the number of target objects
   returned.</p><p>With a JDBC-based repository, the query defined in
   <code class="filename">openidm/conf/repo.jdbc.json</code> is more complex due
   to how the tables are indexed. The correlation query you define in
   <code class="filename">openidm/conf/sync.json</code> is the same, however.</p></div><div class="section" title="6.5.2.&nbsp;System Object as Correlation Query Target"><div class="titlepage"><div><div><h3 class="title"><a name="correlation-query-system-object"></a>6.5.2.&nbsp;System Object as Correlation Query Target</h3></div></div></div><p>Correlation queries on system objects access the connector. The
   connector then executes the query on the external resource.</p><p>Your correlation query JavaScript must return a map holding a generic
   query with the following elements.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>A condition such as "Equals"</p></li><li class="listitem"><p>The naming attribute to compare on the system object. In the example
     that follows, the naming attribute is <code class="literal">uid</code>.</p></li><li class="listitem"><p>The value from the source object to use in the search filter. You
     set this as the value of the <code class="literal">value</code> property, which
     takes an array. In the example that follows, the value to use in the
     search filter is <code class="literal">source.userName</code>.</p></li></ul></div><div class="programlisting">
varmap={<strong class="hl-string"><em style="color: #f58220">"query"</em></strong>: {<strong class="hl-string"><em style="color: #f58220">"Equals"</em></strong>: {<strong class="hl-string"><em style="color: #f58220">"field"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"uid"</em></strong>, <strong class="hl-string"><em style="color: #f58220">"values"</em></strong>: [ source.userName ]}}};
map;</div></div></div><div class="section" title="6.6.&nbsp;Advanced Data Flow Configuration"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="advanced-dataflow"></a>6.6.&nbsp;Advanced Data Flow Configuration</h2></div></div></div><a class="indexterm" name="d160e3249"></a><p><a class="xref" href="#basic-flow" title="6.3.&nbsp;Basic Data Flow Configuration">Section&nbsp;6.3, &#8220;Basic Data Flow Configuration&#8221;</a> shows how to trigger scripts when objects
  are created and updated. Other situations require you to trigger scripts
  in response to other synchronization actions. For example, you might not
  want OpenIDM to delete a managed user directly when an external account is
  deleted, but instead unlink the objects and deactivate the user in another
  resource. (Alternatively, you might delete the object in OpenIDM but
  nevertheless execute a script.) The following example shows a more advanced
  mapping configuration.</p><div class="programlisting">&nbsp;&nbsp;1 
&nbsp;&nbsp;2 {
&nbsp;&nbsp;3     <strong class="hl-string"><em style="color: #f58220">"mappings"</em></strong>: [
&nbsp;&nbsp;4         {
&nbsp;&nbsp;5             <strong class="hl-string"><em style="color: #f58220">"name"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"systemLdapAccount_managedUser"</em></strong>,
&nbsp;&nbsp;6             <strong class="hl-string"><em style="color: #f58220">"source"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"system/ldap/account"</em></strong>,
&nbsp;&nbsp;7             <strong class="hl-string"><em style="color: #f58220">"target"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"managed/user"</em></strong>,
&nbsp;&nbsp;8             <strong class="hl-string"><em style="color: #f58220">"validSource"</em></strong>: {
&nbsp;&nbsp;9                 <strong class="hl-string"><em style="color: #f58220">"type"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"text/javascript"</em></strong>,
&nbsp;10                 <strong class="hl-string"><em style="color: #f58220">"file"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"script/isValid.js"</em></strong>
&nbsp;11             },
&nbsp;12             <strong class="hl-string"><em style="color: #f58220">"correlationQuery"</em></strong>: {
&nbsp;13                 <strong class="hl-string"><em style="color: #f58220">"type"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"text/javascript"</em></strong>,
&nbsp;14                 <strong class="hl-string"><em style="color: #f58220">"file"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"script/ldapCorrelationQuery.js"</em></strong>
&nbsp;15             },
&nbsp;16             <strong class="hl-string"><em style="color: #f58220">"properties"</em></strong>: [
&nbsp;17                 {
&nbsp;18                     <strong class="hl-string"><em style="color: #f58220">"source"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"uid"</em></strong>,
&nbsp;19                     <strong class="hl-string"><em style="color: #f58220">"transform"</em></strong>: {
&nbsp;20                         <strong class="hl-string"><em style="color: #f58220">"type"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"text/javascript"</em></strong>,
&nbsp;21                         <strong class="hl-string"><em style="color: #f58220">"source"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"source.toLowerCase()"</em></strong>
&nbsp;22                     },
&nbsp;23                     <strong class="hl-string"><em style="color: #f58220">"target"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"userName"</em></strong>
&nbsp;24                 },
&nbsp;25                 {
&nbsp;26                     <strong class="hl-string"><em style="color: #f58220">"source"</em></strong>: <strong class="hl-string"><em style="color: #f58220">""</em></strong>,
&nbsp;27                     <strong class="hl-string"><em style="color: #f58220">"transform"</em></strong>: {
&nbsp;28                         <strong class="hl-string"><em style="color: #f58220">"type"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"text/javascript"</em></strong>,
&nbsp;29                         <strong class="hl-string"><em style="color: #f58220">"source"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"if (source.myGivenName)</em></strong>
&nbsp;30 <strong class="hl-string"><em style="color: #f58220"></em></strong>                            {source.myGivenName;} <strong class="hl-keyword">else</strong> {source.givenName;}<strong class="hl-string"><em style="color: #f58220">"</em></strong>
&nbsp;31 <strong class="hl-string"><em style="color: #f58220"></em></strong>                    },
&nbsp;32                     <strong class="hl-string"><em style="color: #f58220">"target"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"givenName"</em></strong>
&nbsp;33                 },
&nbsp;34                 {
&nbsp;35                     <strong class="hl-string"><em style="color: #f58220">"source"</em></strong>: <strong class="hl-string"><em style="color: #f58220">""</em></strong>,
&nbsp;36                     <strong class="hl-string"><em style="color: #f58220">"transform"</em></strong>: {
&nbsp;37                         <strong class="hl-string"><em style="color: #f58220">"type"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"text/javascript"</em></strong>,
&nbsp;38                         <strong class="hl-string"><em style="color: #f58220">"source"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"if (source.mySn)</em></strong>
&nbsp;39 <strong class="hl-string"><em style="color: #f58220"></em></strong>                            {source.mySn;} <strong class="hl-keyword">else</strong> {source.sn;}<strong class="hl-string"><em style="color: #f58220">"</em></strong>
&nbsp;40 <strong class="hl-string"><em style="color: #f58220"></em></strong>                    },
&nbsp;41                     <strong class="hl-string"><em style="color: #f58220">"target"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"familyName"</em></strong>
&nbsp;42                 },
&nbsp;43                 {
&nbsp;44                     <strong class="hl-string"><em style="color: #f58220">"source"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"cn"</em></strong>,
&nbsp;45                     <strong class="hl-string"><em style="color: #f58220">"target"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"fullname"</em></strong>
&nbsp;46                 },
&nbsp;47                 {
&nbsp;48                     <strong class="hl-string"><em style="color: #f58220">"comment"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"Multi-valued in LDAP, single-valued in AD.</em></strong>
&nbsp;49 <strong class="hl-string"><em style="color: #f58220"></em></strong>                        Retrieve first non-empty value.<strong class="hl-string"><em style="color: #f58220">",</em></strong>
&nbsp;50 <strong class="hl-string"><em style="color: #f58220"></em></strong>                    <strong class="hl-string"><em style="color: #f58220">"source"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"title"</em></strong>,
&nbsp;51                     <strong class="hl-string"><em style="color: #f58220">"transform"</em></strong>: {
&nbsp;52                         <strong class="hl-string"><em style="color: #f58220">"type"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"text/javascript"</em></strong>,
&nbsp;53                         <strong class="hl-string"><em style="color: #f58220">"file"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"script/getFirstNonEmpty.js"</em></strong>
&nbsp;54                     },
&nbsp;55                     <strong class="hl-string"><em style="color: #f58220">"target"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"title"</em></strong>
&nbsp;56                 },
&nbsp;57                 {
&nbsp;58                     <strong class="hl-string"><em style="color: #f58220">"condition"</em></strong>: {
&nbsp;59                         <strong class="hl-string"><em style="color: #f58220">"type"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"text/javascript"</em></strong>,
&nbsp;60                         <strong class="hl-string"><em style="color: #f58220">"source"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"var clearObj = openidm.decrypt(object);</em></strong>
&nbsp;61 <strong class="hl-string"><em style="color: #f58220"></em></strong>                            ((clearObj.password != null) &amp;&amp;
&nbsp;62                             (clearObj.ldapPassword != clearObj.password))<strong class="hl-string"><em style="color: #f58220">"</em></strong>
&nbsp;63 <strong class="hl-string"><em style="color: #f58220"></em></strong>                    },
&nbsp;64                     <strong class="hl-string"><em style="color: #f58220">"transform"</em></strong>: {
&nbsp;65                         <strong class="hl-string"><em style="color: #f58220">"type"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"text/javascript"</em></strong>,
&nbsp;66                         <strong class="hl-string"><em style="color: #f58220">"source"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"source.password"</em></strong>
&nbsp;67                     },
&nbsp;68                     <strong class="hl-string"><em style="color: #f58220">"target"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"__PASSWORD__"</em></strong>
&nbsp;69                 }
&nbsp;70             ],
&nbsp;71             <strong class="hl-string"><em style="color: #f58220">"onCreate"</em></strong>: {
&nbsp;72                 <strong class="hl-string"><em style="color: #f58220">"type"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"text/javascript"</em></strong>,
&nbsp;73                 <strong class="hl-string"><em style="color: #f58220">"source"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"target.ldapPassword = null;</em></strong>
&nbsp;74 <strong class="hl-string"><em style="color: #f58220"></em></strong>                    target.adPassword = null;
&nbsp;75                     target.password = null;
&nbsp;76                     target.ldapStatus = <strong class="hl-string"><em style="color: #f58220">'New Account'</em></strong><strong class="hl-string"><em style="color: #f58220">"</em></strong>
&nbsp;77 <strong class="hl-string"><em style="color: #f58220"></em></strong>            },
&nbsp;78             <strong class="hl-string"><em style="color: #f58220">"onUpdate"</em></strong>: {
&nbsp;79                 <strong class="hl-string"><em style="color: #f58220">"type"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"text/javascript"</em></strong>,
&nbsp;80                 <strong class="hl-string"><em style="color: #f58220">"source"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"target.ldapStatus = 'OLD'"</em></strong>
&nbsp;81             },
&nbsp;82             <strong class="hl-string"><em style="color: #f58220">"onUnlink"</em></strong>: {
&nbsp;83                 <strong class="hl-string"><em style="color: #f58220">"type"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"text/javascript"</em></strong>,
&nbsp;84                 <strong class="hl-string"><em style="color: #f58220">"file"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"script/triggerAdDisable.js"</em></strong>
&nbsp;85             },
&nbsp;86             <strong class="hl-string"><em style="color: #f58220">"policies"</em></strong>: [
&nbsp;87                 {
&nbsp;88                     <strong class="hl-string"><em style="color: #f58220">"situation"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"CONFIRMED"</em></strong>,
&nbsp;89                     <strong class="hl-string"><em style="color: #f58220">"action"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"UPDATE"</em></strong>
&nbsp;90                 },
&nbsp;91                 {
&nbsp;92                     <strong class="hl-string"><em style="color: #f58220">"situation"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"FOUND"</em></strong>,
&nbsp;93                     <strong class="hl-string"><em style="color: #f58220">"action"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"UPDATE"</em></strong>
&nbsp;94                 },
&nbsp;95                 {
&nbsp;96                     <strong class="hl-string"><em style="color: #f58220">"situation"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"ABSENT"</em></strong>,
&nbsp;97                     <strong class="hl-string"><em style="color: #f58220">"action"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"CREATE"</em></strong>
&nbsp;98                 },
&nbsp;99                 {
100                     <strong class="hl-string"><em style="color: #f58220">"situation"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"AMBIGUOUS"</em></strong>,
101                     <strong class="hl-string"><em style="color: #f58220">"action"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"EXCEPTION"</em></strong>
102                 },
103                 {
104                     <strong class="hl-string"><em style="color: #f58220">"situation"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"MISSING"</em></strong>,
105                     <strong class="hl-string"><em style="color: #f58220">"action"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"EXCEPTION"</em></strong>
106                 },
107                 {
108                     <strong class="hl-string"><em style="color: #f58220">"situation"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"UNQUALIFIED"</em></strong>,
109                     <strong class="hl-string"><em style="color: #f58220">"action"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"UNLINK"</em></strong>
110                 },
111                 {
112                     <strong class="hl-string"><em style="color: #f58220">"situation"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"UNASSIGNED"</em></strong>,
113                     <strong class="hl-string"><em style="color: #f58220">"action"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"EXCEPTION"</em></strong>
114                 }
115             ]
116         }
117     ]
118 }</div><div class="variablelist"><p>Here is the complete list of properties you can use as hooks in
    mapping configurations to call scripts.
   </p><dl><dt><span class="term">Triggered by Situation</span></dt><dd><p>onCreate, onUpdate, onDelete, onLink, onUnlink</p></dd><dt><span class="term">Object Filter</span></dt><dd><p>vaildSource, validTarget</p></dd><dt><span class="term">Correlating Objects</span></dt><dd><p>correlationQuery</p></dd><dt><span class="term">Triggered on Reconciliation</span></dt><dd><p>result</p></dd><dt><span class="term">Scripts Inside Properties</span></dt><dd><p>condition, transform</p></dd></dl></div><p>Your scripts can get data from any connected system at any time by
  using the <code class="literal">openidm.read(id)</code> function, where
  <code class="literal">id</code> is the identifier of the object to read.</p><p>The following example reads a managed user object from the
  repository.</p><div class="programlisting">
repoUser = openidm.read(<strong class="hl-string"><em style="color: #f58220">"managed/user/ddoe);</em></strong></div><p>The following example reads an account from an external LDAP
  resource.</p><div class="programlisting">
externalAccount = openidm.read(<strong class="hl-string"><em style="color: #f58220">"system/ldap/account/ddoe"</em></strong>);</div></div><div class="section" title="6.7.&nbsp;Alternative Mappings"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="alternative-mapping"></a>6.7.&nbsp;Alternative Mappings</h2></div></div></div><a class="indexterm" name="d160e3311"></a><p>Mappings for synchronization are usually stored in
  <code class="filename">openidm/conf/sync.json</code> for reconciliation, LiveSync,
  and for pushing changes made to managed objects to external resources.
  You can, however, provide alternative mappings for scheduled reconciliation
  by adding the mapping to the scheduler configuration instead of referencing
  the <code class="filename">sync.json</code> mapping.</p><div class="programlisting">
{
    <strong class="hl-string"><em style="color: #f58220">"enabled"</em></strong>: true,
    <strong class="hl-string"><em style="color: #f58220">"type"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"cron"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"schedule"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"0 08 16 * * ?"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"invokeService"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"sync"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"invokeContext"</em></strong>: {
        <strong class="hl-string"><em style="color: #f58220">"action"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"reconcile"</em></strong>,
        <span class="bold"><strong>"mapping": {
            "name": "CSV_XML",
            "source": "system/Ldap/account",
            "target": "managed/user",
            "properties": [
                {
                    "source": "firstname",
                    "target": "firstname"
                },
                ...
            ],
            "policies": [...]
        }</strong></span>
    }
}</div></div></div><div lang="en" class="chapter" title="Chapter&nbsp;7.&nbsp;Scheduling Synchronization"><div class="titlepage"><div><div><h2 class="title"><a name="chap-scheduler-conf"></a>Chapter&nbsp;7.&nbsp;Scheduling Synchronization</h2></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl><dt><span class="section"><a href="#scheduler-configuration-file">7.1. Scheduler Configuration</a></span></dt><dt><span class="section"><a href="#scheduler-examples">7.2. Scheduler Examples</a></span></dt></dl></div><a class="indexterm" name="d160e3333"></a><a class="indexterm" name="d160e3336"></a><a class="indexterm" name="d160e3341"></a><a class="indexterm" name="d160e3346"></a><p>OpenIDM provides scheduling for synchronization operations such as
 LiveSync and reconciliation. You schedule the operations using
 <span class="command"><strong>cron</strong></span>-like syntax.</p><p>This chapter describes scheduling for reconciliation and LiveSync.
 Yet, you can use OpenIDM's scheduler service to schedule other events, too.
 See the <a href="../integrators-guide/index.html#appendix-scheduling" class="link"><em class="citetitle">Scheduler
 Reference</em></a> appendix for details.</p><p>You configure the scheduler through JSON objects. The corresponding
 configuration file names take the form
 <code class="filename">openidm/conf/[org.forgerock.openidm.]scheduler-<em class="replaceable"><code>schedule-name</code></em>.json</code>, where
 <code class="literal">[org.forgerock.openidm.]</code> is optional and added
 automatically when OpenIDM reads the configuration, and
 <em class="replaceable"><code>schedule-name</code></em> is the logical name for the
 scheduled operation, such as
 <code class="literal">reconcile_systemXmlAccounts_managedUser</code>.</p><div class="section" title="7.1.&nbsp;Scheduler Configuration"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="scheduler-configuration-file"></a>7.1.&nbsp;Scheduler Configuration</h2></div></div></div><a class="indexterm" name="d160e3382"></a><p>The scheduler configuration file,
  <code class="filename">openidm/conf/[org.forgerock.openidm.]scheduler-<em class="replaceable"><code>schedule-name</code></em>.json</code> has the following format.</p><div class="programlisting">{
  <strong class="hl-string"><em style="color: #f58220">"enabled"</em></strong>       : true,
  <strong class="hl-string"><em style="color: #f58220">"type"</em></strong>          : <strong class="hl-string"><em style="color: #f58220">"</em></strong><em class="replaceable"><code>cron</code></em><strong class="hl-string"><em style="color: #f58220">",
</em></strong>  <strong class="hl-string"><em style="color: #f58220">"startTime"</em></strong>     : <strong class="hl-string"><em style="color: #f58220">"</em></strong><em class="replaceable"><code>(optional) time</code></em><strong class="hl-string"><em style="color: #f58220">",
</em></strong>  <strong class="hl-string"><em style="color: #f58220">"endTime"</em></strong>       : <strong class="hl-string"><em style="color: #f58220">"</em></strong><em class="replaceable"><code>(optional) time</code></em><strong class="hl-string"><em style="color: #f58220">",
</em></strong>  <strong class="hl-string"><em style="color: #f58220">"schedule"</em></strong>      : <strong class="hl-string"><em style="color: #f58220">"</em></strong><em class="replaceable"><code>cron expression</code></em><strong class="hl-string"><em style="color: #f58220">",
</em></strong>  <strong class="hl-string"><em style="color: #f58220">"timeZone"</em></strong>      : <strong class="hl-string"><em style="color: #f58220">"</em></strong><em class="replaceable"><code>(optional) time zone</code></em><strong class="hl-string"><em style="color: #f58220">",
</em></strong>  <strong class="hl-string"><em style="color: #f58220">"invokeService"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"</em></strong><em class="replaceable"><code>service identifier</code></em><strong class="hl-string"><em style="color: #f58220">",
</em></strong>  <strong class="hl-string"><em style="color: #f58220">"invokeContext"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"</em></strong><em class="replaceable"><code>service specific context info</code></em><strong class="hl-string"><em style="color: #f58220">"
</em></strong>}</div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>The optional properties <code class="literal">"startTime"</code>,
    <code class="literal">"endTime"</code>, and <code class="literal">"timeZone"</code> properties
    can be absent, or empty.</p><p>When specifying times and dates, use ISO 8601 format,
    <code class="literal"><em class="replaceable"><code>YYYY</code></em>-<em class="replaceable"><code>MM</code></em>-<em class="replaceable"><code>DD</code></em>T<em class="replaceable"><code>hh</code></em>:<em class="replaceable"><code>mm</code></em>:<em class="replaceable"><code>ss</code></em></code>.</p></li><li class="listitem"><p>OpenIDM relies on the Quartz Scheduler. The <em class="replaceable"><code>cron
    expression</code></em> to use is described in the <a class="link" href="http://www.quartz-scheduler.org/docs/tutorials/crontrigger.html" target="_blank"><em class="citetitle">CronTrigger Tutorial</em></a> and in <a class="link" href="http://www.quartz-scheduler.org/docs/tutorial/TutorialLesson06.html" target="_blank"><em class="citetitle">Lesson 6: CronTrigger</em></a>.</p></li><li class="listitem"><p>The <code class="literal">"invokeService"</code> property takes either
    <code class="literal">"sync"</code> for reconciliation or
    <code class="literal">"provisioner"</code> for LiveSync.</p><p>You can also specify the service identifier by its full name as in
    <code class="literal">"invokeService" : "org.forgerock.openidm.sync"</code>.</p></li><li class="listitem"><p>The <code class="literal">"invokeContext"</code> property depends on the
    setting for <code class="literal">"invokeService"</code>.</p><p>For LiveSync, <code class="literal">"source"</code> takes an external resource
    name and object type.</p><div class="programlisting">
{
    <strong class="hl-string"><em style="color: #f58220">"invokeService"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"provisioner"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"invokeContext"</em></strong>: {
        <strong class="hl-string"><em style="color: #f58220">"action"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"liveSync"</em></strong>,
        <strong class="hl-string"><em style="color: #f58220">"source"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"system/ldap/account"</em></strong>
    }
}</div><p>For reconciliation, <code class="literal">"mapping"</code> takes the name of
    the mapping configured in
    <code class="filename">openidm/conf/sync.json</code>.</p><div class="programlisting">
{
    <strong class="hl-string"><em style="color: #f58220">"invokeService"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"sync"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"invokeContext"</em></strong>: {
        <strong class="hl-string"><em style="color: #f58220">"action"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"reconcile"</em></strong>,
        <strong class="hl-string"><em style="color: #f58220">"mapping"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"systemLdapAccounts_managedUser"</em></strong>
    }
}</div></li></ul></div><p>For reconciliation, you can define the mapping in two ways.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>Referencing the mapping by its name in <code class="filename">sync.json</code>
    as shown in the example above. The mapping must exist in the
    <code class="filename">sync.json</code> file.</p></li><li class="listitem"><p>Configuring the mapping in the scheduler configuration by using the
    <code class="literal">"mapping"</code> property as shown in the example in
    <a href="../integrators-guide/index.html#alternative-mapping" class="link"><em class="citetitle">Alternative
    Mappings Location</em></a>.</p></li></ul></div></div><div class="section" title="7.2.&nbsp;Scheduler Examples"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="scheduler-examples"></a>7.2.&nbsp;Scheduler Examples</h2></div></div></div><a class="indexterm" name="d160e3534"></a><p>The following example shows a schedule for reconciliation that
  is not enabled. When enabled (<code class="literal">"enabled" : true,</code>),
  reconciliation runs every 30 minutes, starting on the hour.</p><div class="programlisting">
{
    <strong class="hl-string"><em style="color: #f58220">"enabled"</em></strong>: false,
    <strong class="hl-string"><em style="color: #f58220">"type"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"cron"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"schedule"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"0 0/30 * * * ?"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"invokeService"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"sync"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"invokeContext"</em></strong>: {
        <strong class="hl-string"><em style="color: #f58220">"action"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"reconcile"</em></strong>,
        <strong class="hl-string"><em style="color: #f58220">"mapping"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"systemLdapAccounts_managedUser"</em></strong>
    }
}</div><p>The following example shows a schedule for LiveSync enabled
  to run every 15 seconds, starting at the beginning of the minute.</p><div class="programlisting">
{
    <strong class="hl-string"><em style="color: #f58220">"enabled"</em></strong>: false,
    <strong class="hl-string"><em style="color: #f58220">"type"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"cron"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"schedule"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"0/15 * * * * ?"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"invokeService"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"provisioner"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"invokeContext"</em></strong>: {
        <strong class="hl-string"><em style="color: #f58220">"action"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"liveSync"</em></strong>,
        <strong class="hl-string"><em style="color: #f58220">"source"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"system/ldap/account"</em></strong>
    }
}</div></div></div><div lang="en" class="chapter" title="Chapter&nbsp;8.&nbsp;Managing Passwords"><div class="titlepage"><div><div><h2 class="title"><a name="chap-passwords"></a>Chapter&nbsp;8.&nbsp;Managing Passwords</h2></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl><dt><span class="section"><a href="#enforce-password-policy">8.1. Enforcing Password Policy</a></span></dt><dt><span class="section"><a href="#password-sync">8.2. Password Synchronization</a></span></dt></dl></div><a class="indexterm" name="d160e3554"></a><p>OpenIDM provides password management features that help you enforce
 password policies, limit the number of passwords users must remember, and
 let users reset and change their passwords.</p><div class="section" title="8.1.&nbsp;Enforcing Password Policy"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="enforce-password-policy"></a>8.1.&nbsp;Enforcing Password Policy</h2></div></div></div><p>A password policy is a set of rules defining what sequence of
  characters constitutes an acceptable password. Acceptable passwords generally
  are too complex for users or automated programs to generate or guess.</p><p>Password policies set requirements for password length, character sets
  that passwords must contain, dictionary words and other values that passwords
  must not contain. Password policies also require that users not reuse old
  passwords, and that users change their passwords on a regular basis.</p><a class="indexterm" name="d160e3566"></a><p>OpenIDM can enforce password policy rules by applying validation rules
  to attributes of managed user objects. Suppose you want to rule out use of
  the following user passwords.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><code class="literal">password</code></p></li><li class="listitem"><p><code class="literal">123456</code></p></li><li class="listitem"><p><code class="literal">12345678</code></p></li><li class="listitem"><p><code class="literal">qwerty</code></p></li><li class="listitem"><p><code class="literal">abc123</code></p></li></ul></div><p>You could include the following configuration in
  <code class="filename">openidm/conf/managed.json</code> to validate passwords.</p><div class="programlisting">
{
    <strong class="hl-string"><em style="color: #f58220">"objects"</em></strong> : [
        {
            <strong class="hl-string"><em style="color: #f58220">"name"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"user"</em></strong>,
            <strong class="hl-string"><em style="color: #f58220">"properties"</em></strong> : [
                {
                    <strong class="hl-string"><em style="color: #f58220">"name"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"password"</em></strong>,
                    <strong class="hl-string"><em style="color: #f58220">"encryption"</em></strong> : {
                        <strong class="hl-string"><em style="color: #f58220">"key"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"openidm-sym-default"</em></strong>
                    }
                }
            ],
            <strong class="hl-string"><em style="color: #f58220">"onValidate"</em></strong> : {
                <strong class="hl-string"><em style="color: #f58220">"type"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"text/javascript"</em></strong>,
                <strong class="hl-string"><em style="color: #f58220">"file"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"script/password-validator.js"</em></strong>
            }
        }
    ]
}</div><p>The corresponding script,
  <code class="filename">openidm/script/password-validator.js</code>, returns
  <code class="literal">true</code> if the password is valid. For example, the following
  script checks that the password is not one of those listed above.</p><div class="programlisting">
<strong class="hl-keyword">const</strong> dictionary = [<strong class="hl-string"><em style="color: #f58220">'password'</em></strong>,<strong class="hl-string"><em style="color: #f58220">'123456'</em></strong>,<strong class="hl-string"><em style="color: #f58220">'12345678'</em></strong>, <strong class="hl-string"><em style="color: #f58220">'qwerty'</em></strong>, <strong class="hl-string"><em style="color: #f58220">'abc123'</em></strong>];

<strong class="hl-keyword">function</strong> isValidPassword() {
    <strong class="hl-keyword">var</strong> cleartextObject = openidm.decrypt(object);
    <strong class="hl-keyword">for</strong> (<strong class="hl-keyword">var</strong> i = <span class="hl-number">0</span>; i &lt; dictionary.length; i++) {
        <strong class="hl-keyword">if</strong> (cleartextObject.password == dictionary[i]) {
            <strong class="hl-keyword">throw</strong> <strong class="hl-string"><em style="color: #f58220">"Password Policy Violation Exception"</em></strong>;
        };
    };
};

isValidPassword();</div><p>To try this script with the default example, update
  <code class="filename">openidm/conf/managed.json</code> as shown above, change the
  sample user's password in
  <code class="filename">openidm/samples/sample1/data/xmlConnectorData.xml</code> to
  something invalid such as <code class="literal">123456</code>, and add a mapping for
  the password property to <code class="filename">openidm/conf/sync.json</code>:</p><div class="programlisting">
"properties" : [
    {
        "source" : "description",
        "target" : "description"
    },
    {
        "source" : "firstname",
        "target" : "givenName"
    },
    {
        "source" : "email",
        "target" : "email"
    },
    {
        "source" : "lastname",
        "target" : "familyName"
    },
    {
        "source" : "name",
        "target" : "userName"
    },
    <span class="strong"><strong>{
        "source" : "password",
        "target" : "password"
    },</strong></span>
    {
        "source" : "name",
        "target" : "_id"
    }
],
  </div><p>In addition remove <code class="literal">"flags" :
  ["NOT_READABLE","NOT_RETURNED_BY_DEFAULT"]</code> from the password
  property in the <code class="filename">provisioner.openicf-xml.json</code>
  file.</p><p>The script called for <code class="literal">onValidate</code> lets you define
  rules to validate a property's value before OpenIDM stores the object.
  If the value violates the rules, OpenIDM throws an exception.</p><p>The following excerpt from
  <code class="filename">openidm/logs/openidm0.log.0</code> shows the exception
  when trying to reconcile a user having an invalid password.</p><div class="programlisting">
Jan 16, 2012 10:21:11 AM
 org.forgerock.openidm.sync.impl.ObjectMapping createTargetObject
WARNING: Failed to create target object
org.forgerock.openidm.objset.ForbiddenException:
 Password Policy Violation Exception</div><div class="variablelist"><p>The password validation mechanism can apply in many situations.</p><dl><dt><span class="term">Password change and password reset</span></dt><dd><p>Password change involves changing a user or account password
     in accordance with password policy. Password reset involves setting a
     new user or account password on behalf of a user.</p><p>You can configure OpenIDM to control password values as they are
     provisioned as shown in the previous examples.</p><p>To change the default administrative user password,
     <code class="literal">openidm-admin</code>, see the procedure, <a href="../integrators-guide/index.html#security-replace-default-user-password" class="link"><em class="citetitle">To Replace the Default User &amp; Password</em></a>,
     for instructions.</p></dd><dt><span class="term">Password recovery</span></dt><dd><p>Password recovery involves recovering a password or setting a new
     password when the password has been forgotten.</p><p>OpenIDM can provide a self-service end user interface for password
     changes, password recovery, and password reset.</p></dd><dt><span class="term">Password comparisons with dictionary words</span></dt><dd><p>You can add dictionary lookups to prevent use of password values
     that match dictionary words.</p></dd><dt><span class="term">Password history</span></dt><dd><p>You can add checks to prevent reuse of previous password
     values</p></dd><dt><span class="term">Password expiration</span></dt><dd><p>You can configure OpenIDM to call a workflow that ensures users
     are able to change expiring or to reset expired passwords.</p></dd></dl></div></div><div class="section" title="8.2.&nbsp;Password Synchronization"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="password-sync"></a>8.2.&nbsp;Password Synchronization</h2></div></div></div><a class="indexterm" name="d160e3705"></a><p>Password synchronization intercepts user password changes, and ensures
  uniform password changes across resources that store the password. Following
  password synchronization, the user authenticates using the same password on
  each resource. No centralized directory or authentication server is required
  for performing authentication. Password synchronization reduces the number of
  passwords users need to remember, so they can use fewer, stronger
  passwords.</p><p>OpenIDM can propagate passwords to the resources storing a user's
  password. OpenIDM can intercept and synchronize passwords changed natively
  on OpenDJ and Active Directory. See the example in
  <code class="filename">samples/misc/managed.json</code> where you installed OpenIDM
  for a sample password synchronization configuration.</p><p>Before using the sample, you must set up OpenDJ and Active Directory,
  and adjust the password attributes, set in the sample as
  <code class="literal">ldapPassword</code> for OpenDJ, <code class="literal">adPassword</code>
  for Active Directory, and <code class="literal">password</code> for the internal
  OpenIDM password. Also, either set up password policy enforcement on OpenDJ
  or Active Directory rather than OpenIDM, or ensure that all password policies
  enforced are identical to prevent password updates on one resource from being
  rejected by OpenIDM or by another resource.</p><p>Also set up password synchronization plugins for OpenDJ and for Active
  Directory. The password synchronization plugins help by intercepting password
  changes on the resource before the passwords are stored in encrypted
  form. The plugins then send intercepted password values to OpenIDM over an
  encrypted channel.</p><div class="procedure" title="Procedure&nbsp;8.1.&nbsp;To Install the OpenDJ Password Synchronization Plugin"><a name="install-opendj-password-sync-plugin"></a><div class="procedure-title">Procedure&nbsp;8.1.&nbsp;To Install the OpenDJ Password Synchronization Plugin</div><a class="indexterm" name="d160e3733"></a><p>Before you start, make sure you configure OpenDJ to communicate over
   LDAPS as described in the <a class="link" href="http://opendj.forgerock.org/doc/admin-guide/OpenDJ-Admin-Guide.html#chap-listeners" target="_blank">OpenDJ documentation</a>.</p><p>The following steps install the plugin in OpenDJ directory server
   running on the same host as OpenIDM. If you run OpenDJ on a different host
   use the fully qualified domain name rather than <code class="literal">localhost</code>,
   and use your certificates rather than the example.</p><ol class="procedure" type="1"><li class="step" title="Step 1"><p>Import the self-signed OpenIDM certificate into the trust store for
    OpenDJ.</p><div class="screen">$ cd /path/to/OpenDJ/config
$ keytool
 -import
 -alias openidm-localhost
 -keystore truststore
 -storepass `cat keystore.pin`
 -file /path/to/openidm/samples/security/openidm-localhost-cert.txt
Owner: CN=localhost, O=OpenIDM Self-Signed Certificate
Issuer: CN=localhost, O=OpenIDM Self-Signed Certificate
Serial number: 4e4bc38e
Valid from: Wed Aug 17 15:35:10 CEST 2011 until: Tue Aug 17 15:35:10 CEST 2021
Certificate fingerprints:
  MD5:  B8:B3:B4:4C:F3:22:89:19:C6:55:98:C5:DF:47:DF:06
  SHA1: DB:BB:F1:14:55:A0:53:80:9D:62:E7:39:FB:83:15:DA:60:63:79:D1
  Signature algorithm name: SHA1withRSA
  Version: 3
Trust this certificate? [no]:  yes
Certificate was added to keystore</div></li><li class="step" title="Step 2"><p>Download the OpenDJ password synchronization plugin, OpenIDM Agents
    - OpenDJ 1.0.0, from the OpenIDM
    <a class="link" href="http://www.forgerock.org/openidm.html" target="_blank">download page</a>.</p></li><li class="step" title="Step 3"><p>Unzip the module delivery.</p><div class="screen">$ unzip ~/Downloads/opendj-accountchange-handler-1.0.0-SNAPSHOT.zip
   creating: opendj/
   creating: opendj/config/
   creating: opendj/config/schema/
...</div></li><li class="step" title="Step 4"><p>Copy files to the directory where OpenDJ is installed.</p><div class="screen">$ cd opendj
$ cp -r * /path/to/OpenDJ/</div></li><li class="step" title="Step 5"><p>Restart OpenDJ to load the additional schema from the module.</p><div class="screen">$ cd /path/to/OpenDJ/bin
$ ./stop-ds --restart</div></li><li class="step" title="Step 6"><p>Add the configuration provided to OpenDJ's configuration.</p><div class="screen">$ ./ldapmodify
 --port 1389
 --hostname `hostname`
 --bindDN "cn=Directory Manager"
 --bindPassword "password"
 --defaultAdd
 --filename ../config/openidm-pwsync-plugin-config.ldif
Processing ADD request for cn=OpenIDM Notification Handler,
 cn=Account Status Notification Handlers,cn=config
ADD operation successful for DN cn=OpenIDM Notification Handler
 ,cn=Account Status Notification Handlers,cn=config</div></li><li class="step" title="Step 7"><p>Restart OpenDJ.</p><div class="screen">$ ./stop-ds --restart
...
[16/Jan/2012:15:55:47 +0100] category=EXTENSIONS severity=INFORMATION
 msgID=1049147 msg=Loaded extension from file '/path/to/OpenDJ/lib/extensions
 /opendj-accountchange-handler-1.0.0.jar' (build &lt;unknown&gt;,
 revision &lt;unknown&gt;)
...
[16/Jan/2012:15:55:51 +0100] category=CORE severity=NOTICE msgID=458891 msg=The
 Directory Server has sent an alert notification generated by class
 org.opends.server.core.DirectoryServer (alert type
 org.opends.server.DirectoryServerStarted, alert ID 458887):
 The Directory Server has started successfully</div></li><li class="step" title="Step 8"><p>Enable the plugin for the appropriate password policy.</p><p>The following command enables the plugin for the default password
    policy.</p><div class="screen">$ ./dsconfig
 set-password-policy-prop
 --port 4444
 --hostname `hostname`
 --bindDN "cn=Directory Manager"
 --bindPassword password
 --policy-name "Default Password Policy"
 --set account-status-notification-handler:"OpenIDM Notification Handler"
 --trustStorePath ../config/admin-truststore
 --no-prompt</div></li></ol></div><div class="procedure" title="Procedure&nbsp;8.2.&nbsp;To Install the Active Directory Password Synchronization Plugin"><a name="install-ad-password-sync-plugin"></a><div class="procedure-title">Procedure&nbsp;8.2.&nbsp;To Install the Active Directory Password Synchronization Plugin</div><a class="indexterm" name="d160e3797"></a><p>You install the plugin on Active Directory primary domain controllers
   (PDCs) to intercept password changes, and send the password values to
   OpenIDM over an encrypted channel. You must have Administrator privileges to
   install the plugin. In a clustered Active Directory environment, you must
   also install the plugin on all PDCs.</p><ol class="procedure" type="1"><li class="step" title="Step 1"><p>Download the Active Directory password synchronization plugin,
    OpenIDM Agents - AD 2.0.1, from the OpenIDM
    <a class="link" href="http://www.forgerock.org/openidm.html" target="_blank">download page</a>.</p></li><li class="step" title="Step 2"><p>Unzip the plugin, and double-click <code class="filename">setup.exe</code> to
    launch the installation wizard.</p></li><li class="step" title="Step 3"><p>Complete the installation with the help of the following hints.</p><div class="variablelist"><dl><dt><span class="term">CDDL license agreement</span></dt><dd><p>You must accept the agreement to proceed with the
       installation.</p></dd><dt><span class="term">OpenIDM URL</span></dt><dd><p>URL where OpenIDM is deployed such as
       <code class="literal">https://openidm.example.com:8444/openidm</code> for
       SSL mutual authentication</p></dd><dt><span class="term">Private Key alias</span></dt><dd><p>Alias used for the OpenIDM certificate also stored in the
       <code class="filename">keystore.jceks</code> file, such as
       <code class="literal">openidm-localhost</code> used for evaluation</p></dd><dt><span class="term">Private Key password</span></dt><dd><p>Password to access the PFX keystore file, such as
       <code class="literal">changeit</code> for evaluation. PFX files contain
       encrypted private keys, certificates used for authentication and
       encryption.</p></dd><dt><span class="term">Directory poll interval (seconds)</span></dt><dd><p>Number of seconds between calls to check that Active Directory
       is available, such as 60</p></dd><dt><span class="term">Query ID parameter</span></dt><dd><p>Query identifier configured in OpenIDM the
       <code class="filename">openidm/conf/repo.*.json</code> file. Use
       <code class="literal">for-userName</code> for evaluation.</p></dd><dt><span class="term">OpenIDM user password attribute </span></dt><dd><p>Password attribute for the <code class="literal">managed/user</code> object
       to which OpenIDM applies password changes</p></dd><dt><span class="term">OpenIDM user search attribute</span></dt><dd><p>The <code class="literal">sAMAccountName</code> value holder attribute name
       in the query definition. For example,
       <code class="literal">"SELECT * FROM ${_resource} WHERE userName = '${uid}'"</code>.
       Use <code class="literal">uid</code> for the evaluation.</p></dd><dt><span class="term">Select Certificate File</span></dt><dd><p>The PKCS 12 format PFX file containing the certificate used to
       encrypt communications with OpenIDM. Use
       <code class="filename">openidm/samples/security/openidm-localhost.p12</code> for
       evaluation.</p></dd><dt><span class="term">Select Output Directory</span></dt><dd><p>Select a secure directory where the password changes are queued.
       The queue contains the encrypted passwords. Yet, the server has to
       prevent access to this folder except access by the <code class="literal">Password
       Sync service</code>. The path name cannot include spaces.</p></dd><dt><span class="term">Select Log Directory</span></dt><dd><p>The plugin stores logs in the location you select. The path name
       cannot include spaces.</p></dd><dt><span class="term">Select Destination Location</span></dt><dd><p>Setup installs the plugin in the location you select, by default
       <code class="filename">C:\Program Files\OpenIDM Password Sync</code>.</p></dd></dl></div></li><li class="step" title="Step 4"><p>After running the installation wizard, restart the computer.</p></li><li class="step" title="Step 5"><p>If you must change any settings after installation, access settings
    using the Registry Editor under HKEY_LOCAL_MACHINE &gt; SOFTWARE &gt;
    ForgeRock &gt; OpenIDM &gt; PasswordSync.</p></li></ol></div><div class="procedure" title="Procedure&nbsp;8.3.&nbsp;To Set Up OpenIDM to Handle Password Changes"><a name="setup-openidm-for-password-sync"></a><div class="procedure-title">Procedure&nbsp;8.3.&nbsp;To Set Up OpenIDM to Handle Password Changes</div><p>Follow these steps to configure OpenIDM to access password changes
   from the directory server.</p><ol class="procedure" type="1"><li class="step" title="Step 1"><p>Add the directory server certificate to the OpenIDM trust store so
    that OpenIDM knows to trust the directory server during mutual
    authentication.</p><p>The following commands show how to do this with the default OpenDJ
    and OpenIDM settings.</p><div class="screen">$ cd /path/to/OpenDJ/config/
$ keytool
 -keystore keystore
 -storepass `cat keystore.pin`
 -export
 -alias server-cert
 &gt; /tmp/opendj.crt
$ cd /path/to/openidm/security/
$ keytool
 -import
 -alias opendj-server-cert
 -file /tmp/opendj.crt
 -keystore truststore
 -storepass changeit
 -trustcacerts
Owner: CN=localhost.localdomain, O=OpenDJ Self-Signed Certificate
Issuer: CN=localhost.localdomain, O=OpenDJ Self-Signed Certificate
Serial number: 4f143976
Valid from: Mon Jan 16 15:51:34 CET 2012 until: Wed Jan 15 15:51:34 CET 2014
Certificate fingerprints:
   MD5:  7B:7A:75:FC:5A:F0:65:E5:84:43:6D:10:B9:EA:CC:F0
   SHA1: D1:C6:C9:8A:EA:09:FD:1E:48:BB:B2:F5:95:41:50:2C:AB:4D:0F:C9
   Signature algorithm name: SHA1withRSA
   Version: 3
Trust this certificate? [no]:  yes
Certificate was added to keystore</div></li><li class="step" title="Step 2"><p>Add the configuration to managed objects to handle password
    synchronization.</p><p>You can find an example for synchronization with both OpenDJ and
    Active Directory in <code class="filename">samples/misc/managed.json</code>,
    JavaScript lines folded for readability:</p><div class="programlisting">
{
    <strong class="hl-string"><em style="color: #f58220">"objects"</em></strong>: [
        {
            <strong class="hl-string"><em style="color: #f58220">"name"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"user"</em></strong>,
            <strong class="hl-string"><em style="color: #f58220">"properties"</em></strong>: [
                {
                    <strong class="hl-string"><em style="color: #f58220">"name"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"ldapPassword"</em></strong>,
                    <strong class="hl-string"><em style="color: #f58220">"encryption"</em></strong>: {
                        <strong class="hl-string"><em style="color: #f58220">"key"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"openidm-sym-default"</em></strong>
                    }
                },
                {
                    <strong class="hl-string"><em style="color: #f58220">"name"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"adPassword"</em></strong>,
                    <strong class="hl-string"><em style="color: #f58220">"encryption"</em></strong>: {
                        <strong class="hl-string"><em style="color: #f58220">"key"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"openidm-sym-default"</em></strong>
                    }
                },
                {
                    <strong class="hl-string"><em style="color: #f58220">"name"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"password"</em></strong>,
                    <strong class="hl-string"><em style="color: #f58220">"encryption"</em></strong>: {
                        <strong class="hl-string"><em style="color: #f58220">"key"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"openidm-sym-default"</em></strong>
                    }
                }
            ],
            <strong class="hl-string"><em style="color: #f58220">"onUpdate"</em></strong>: {
                <strong class="hl-string"><em style="color: #f58220">"type"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"text/javascript"</em></strong>,
                <strong class="hl-string"><em style="color: #f58220">"source"</em></strong>:
                 <strong class="hl-string"><em style="color: #f58220">"if (newObject.ldapPassword != oldObject.ldapPassword) {
</em></strong>                     newObject.password = newObject.ldapPassword
                  } <strong class="hl-keyword">else</strong> <strong class="hl-keyword">if</strong> (newObject.adPassword != oldObject.adPassword) {
                      newObject.password = newObject.adPassword
                  }<strong class="hl-string"><em style="color: #f58220">"
</em></strong>            }
        }
    ]
}</div><p>This sample assumes you define the password as
    <code class="literal">ldapPassword</code> for OpenDJ, and
    <code class="literal">adPassword</code> for Active Directory.</p></li><li class="step" title="Step 3"><p>When you change a password on the directory server and run
    reconciliation, you notice the value changes in OpenIDM.</p><div class="screen">$ tail -f openidm/audit/activity.csv | grep bjensen
...userName=bjensen, ... password={$crypto={...data=tEsy7ZXo6nZtEqzW/uVE/A==...
...userName=bjensen, ... password={$crypto={...data=BReT79lnQEPcvfQG3ibLpg==...</div></li></ol></div></div></div><div lang="en" class="chapter" title="Chapter&nbsp;9.&nbsp;Managing Authentication, Authorization &amp; RBAC"><div class="titlepage"><div><div><h2 class="title"><a name="chap-auth"></a>Chapter&nbsp;9.&nbsp;Managing Authentication, Authorization &amp; RBAC</h2></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl><dt><span class="section"><a href="#openidm-users">9.1. OpenIDM Users</a></span></dt><dt><span class="section"><a href="#openidm-authentication">9.2. Authentication</a></span></dt><dt><span class="section"><a href="#openidm-roles">9.3. Roles</a></span></dt><dt><span class="section"><a href="#openidm-authorization">9.4. Authorization</a></span></dt></dl></div><a class="indexterm" name="d160e3979"></a><a class="indexterm" name="d160e3982"></a><p>OpenIDM currently provides a simple, yet flexible authentication and
 authorization mechanism based on REST interface URLs and on roles stored in
 the repository.</p><div class="section" title="9.1.&nbsp;OpenIDM Users"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="openidm-users"></a>9.1.&nbsp;OpenIDM Users</h2></div></div></div><a class="indexterm" name="d160e3990"></a><a class="indexterm" name="d160e3995"></a><p>OpenIDM distinguishes between internal users and managed users.</p><div class="section" title="9.1.1.&nbsp;Internal Users"><div class="titlepage"><div><div><h3 class="title"><a name="internal-users"></a>9.1.1.&nbsp;Internal Users</h3></div></div></div><p>OpenIDM sets up two internal users by default, anonymous and
   openidm-admin. OpenIDM separates these accounts from all other accounts
   to protect them from any reconciliation or sync processes. You can add
   or remove internal users at any time.</p><div class="variablelist"><dl><dt><span class="term">anonymous</span></dt><dd><p>This user serves to access OpenIDM anonymously, for users
     who do not have their own accounts. The anonymous user is primarily
     intended to allow self-registration.</p><p>OpenIDM stores the anonymous user's password,
     <code class="literal">amonymous</code>, in clear text in the repository internal
     user table. The password is not considered to be secret.</p></dd><dt><span class="term">openidm-admin</span></dt><dd><p>This user serves as the super administrator. After
     installation, the <code class="literal">openidm-admin</code> user has full access,
     and provides a fall back in case other users are locked out. Do not use
     <code class="literal">openidm-admin</code> for normal tasks. Usually no one is
     associated with the <code class="literal">openidm-admin</code> user, so audit log
     records pertaining to <code class="literal">openidm-admin</code> do not reflect
     the actions of any real person.</p><p>OpenIDM encrypts the password, <code class="literal">openidm-admin</code>, by
     dfault. Change the password immediately after installation. For
     instructions, see <a href="../integrators-guide/index.html#security-replace-default-user-password" class="link"><em class="citetitle">To Replace the Default User &amp;
     Password</em></a>.</p></dd></dl></div><p>OpenIDM stores internal users and their role membership in a table
   in the repository called <code class="literal">internaluser</code> when implemented
   in MySQL.</p></div><div class="section" title="9.1.2.&nbsp;Managed Users"><div class="titlepage"><div><div><h3 class="title"><a name="managed-users"></a>9.1.2.&nbsp;Managed Users</h3></div></div></div><a class="indexterm" name="d160e4054"></a><p>External users that OpenIDM manages are referred to as managed users.
   OpenIDM stores managed users in the managed objects table of the repository,
   called <code class="literal">managedobjects</code> when implemented in MySQL. A second
   table, <code class="literal">managedobjectproperties</code> in MySQL, serves as the
   index table.</p><p>By default, the attribute names for managed user login and password
   are <code class="literal">email</code> and <code class="literal">password</code>,
   respectively.</p></div></div><div class="section" title="9.2.&nbsp;Authentication"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="openidm-authentication"></a>9.2.&nbsp;Authentication</h2></div></div></div><p>OpenIDM does not allow access to the REST interface unless you
  authenticate. If a project requires anonymous access, to allow users to
  self-register for example, then allow access by user
  <code class="literal">anonymous</code>, password <code class="literal">anonymous</code>, as
  described in <a class="xref" href="#internal-users" title="9.1.1.&nbsp;Internal Users">Section&nbsp;9.1.1, &#8220;Internal Users&#8221;</a>. In production, only
  applications are expected to access the REST interface.</p><div class="variablelist"><p>OpenIDM supports an improved authentication mechanism on the REST interface. The reason for not using standards, like basic authentication or form based authentication, is their leak of compatibility with AJAX.</p><dl><dt><span class="term">OpenIDM authentication with standard header fields</span></dt><dd><div class="screen">$ curl --user userName:password</div><p>This authentication is compatible with standard basic authentication except that it will not prompt for credentials if they are missing in the request.</p></dd><dt><span class="term">OpenIDM  authentication with OpenIDM header fields</span></dt><dd><div class="screen">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"</div></dd></dl></div><p>For more details about the OpenIDM authentication mechanism please see <a href="../integrators-guide/index.html#security-messages" class="link">
  <em class="citetitle">Use Message Level Security</em>
</a>.</p><p>You can change the attributes OpenIDM uses to store user login and
  password values. The attribute names are shown in a database query
  defined in
  <code class="filename">openidm/conf/repo.<em class="replaceable"><code>repo-type</code></em>.json</code>.
  </p><div class="variablelist"><p>Two queries are defined by default.</p><dl><dt><span class="term"><code class="literal">credential-internaluser-query</code></span></dt><dd><p>Uses the user object ID for login</p></dd><dt><span class="term"><code class="literal">credential-query</code></span></dt><dd><p>Uses the user email attribute for login</p></dd></dl></div><p>The <code class="filename">openidm/conf/authentication.json</code> file defines
  the currently active query as the value of the <code class="literal">queryId</code>
  property. In the following example, <code class="literal">credential-query</code> is
  active.</p><div class="programlisting">
{
    <strong class="hl-string"><em style="color: #f58220">"queryId"</em></strong>: <span class="strong"><strong>"credential-query"</strong></span>,
    <strong class="hl-string"><em style="color: #f58220">"queryOnResource"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"managed/user"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"defaultUserRoles"</em></strong>: [
        <strong class="hl-string"><em style="color: #f58220">"openidm-authorized"</em></strong>
    ]
}</div></div><div class="section" title="9.3.&nbsp;Roles"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="openidm-roles"></a>9.3.&nbsp;Roles</h2></div></div></div><a class="indexterm" name="d160e4157"></a><a class="indexterm" name="d160e4162"></a><div class="variablelist"><p>OpenIDM sets up the following roles by default.</p><dl><dt><span class="term">openidm-reg</span></dt><dd><p>Role for users accessing OpenIDM with the default anonymous
     account</p></dd><dt><span class="term">openidm-admin</span></dt><dd><p>OpenIDM administrator role</p></dd><dt><span class="term">openidm-authorized</span></dt><dd><p>Default role for any user authenticated with a user name and
     password</p></dd><dt><span class="term">openidm-cert</span></dt><dd><p>Default role for any user authenticated with mutual SSL
     authentication</p></dd></dl></div><p>You configure default roles assigned to successfully authenticated
  users authentication using the <code class="literal">defaultUserRoles</code> property
  in <code class="filename">openidm/conf/authentication.json</code>, which takes a list.
  The default value is <code class="literal">openidm-authorized</code>.</p><div class="programlisting">
{
    <strong class="hl-string"><em style="color: #f58220">"queryId"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"credential-query"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"queryOnResource"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"managed/user"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"defaultUserRoles"</em></strong>: [
        <span class="strong"><strong>"openidm-authorized"</strong></span>
    ]
}</div></div><div class="section" title="9.4.&nbsp;Authorization"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="openidm-authorization"></a>9.4.&nbsp;Authorization</h2></div></div></div><a class="indexterm" name="d160e4211"></a><p>OpenIDM access control can be based on REST interface URLs.</p><p>The <code class="filename">openidm/script/router-authz.js</code> script
  controls access to REST interface URLs. OpenIDM calls the script for each
  request. The script either throws the string <code class="literal">Access denied</code>,
  or nothing. If it throws <code class="literal">Access denied</code>, then OpenIDM
  denies the request. The default script is shown below.</p><div class="programlisting">
<strong class="hl-keyword">const</strong> allowCert = false;

<strong class="hl-keyword">function</strong> contains(a, o) {
    <strong class="hl-keyword">if</strong> (<strong class="hl-keyword">typeof</strong>(a) != <strong class="hl-string"><em style="color: #f58220">'undefined'</em></strong> &amp;&amp; a != null) {
        <strong class="hl-keyword">for</strong> (<strong class="hl-keyword">var</strong> i = <span class="hl-number">0</span>; i &lt;= a.length; i++) {
            <strong class="hl-keyword">if</strong> (a[i] === o) {
                <strong class="hl-keyword">return</strong> true;
            }
        }
    }
    <strong class="hl-keyword">return</strong> false;
}

<strong class="hl-keyword">function</strong> allow() {
    <strong class="hl-keyword">if</strong> (<strong class="hl-keyword">typeof</strong>(request.parent) === <strong class="hl-string"><em style="color: #f58220">'undefined'</em></strong> ||
            request.parent.type != <strong class="hl-string"><em style="color: #f58220">'http'</em></strong>) {
        <strong class="hl-keyword">return</strong> true;
    }
    <strong class="hl-keyword">var</strong> roles = request.parent.security[<strong class="hl-string"><em style="color: #f58220">'openidm-roles'</em></strong>];
    <strong class="hl-keyword">if</strong> (contains(roles, <strong class="hl-string"><em style="color: #f58220">'openidm-admin'</em></strong>)) {
        <strong class="hl-keyword">return</strong> true;
    } <strong class="hl-keyword">else</strong> <strong class="hl-keyword">if</strong> (allowCert &amp;&amp; contains(roles, <strong class="hl-string"><em style="color: #f58220">'openidm-cert'</em></strong>)) {
        <strong class="hl-keyword">return</strong> true;
    } <strong class="hl-keyword">else</strong> {
        <strong class="hl-keyword">return</strong> false;
    }
}

<strong class="hl-keyword">if</strong> (!allow()) {
    <strong class="hl-keyword">throw</strong> <strong class="hl-string"><em style="color: #f58220">"Access denied"</em></strong>;
}</div><div class="variablelist"><p>The script can be seen as having three parts: constants, functions,
   and a decision.</p><dl><dt><span class="term">constants</span></dt><dd><p>The constants can function as global switches, for example to toggle
     whether certificate-based authentication is allowed.</p><p>The example that follows shows a constant used to toggle whether
     anonymous authentication is allowed.</p></dd><dt><span class="term">functions</span></dt><dd><p>The default script defines two functions. The
     <code class="literal">allow()</code> function is called by the final if-statement.
     The <code class="literal">contains()</code> function takes the list of roles
     assigned to an authenticated user, and checks whether the list contains
     the role specified as the second argument. If the list does contain the
     role, then <code class="literal">contains()</code> returns
     <code class="literal">true</code>.</p></dd><dt><span class="term">decision</span></dt><dd><p>The if-statement at the end of the script executes first. It calls
     the <code class="literal">allow()</code> function, which calls other functions.
     The <code class="literal">allow()</code> function returns true or false, triggering
     the behavior of the final if-statement. </p></dd></dl></div><p>The following example extends the script to filter out requests not
  under <code class="literal">/openidm/config</code> or
  <code class="literal">/openidm/managed</code>.</p><div class="programlisting">
<strong class="hl-keyword">const</strong> allowCert = false;
<strong class="hl-keyword">const</strong> allowAnon = false;

<strong class="hl-keyword">function</strong> contains(a, o) {
    <strong class="hl-keyword">if</strong> (<strong class="hl-keyword">typeof</strong>(a) != <strong class="hl-string"><em style="color: #f58220">'undefined'</em></strong> &amp;&amp; a != null) {
        <strong class="hl-keyword">for</strong> (<strong class="hl-keyword">var</strong> i = <span class="hl-number">0</span>; i &lt;= a.length; i++) {
            <strong class="hl-keyword">if</strong> (a[i] === o) {
                <strong class="hl-keyword">return</strong> true;
            }
        }
    }
    <strong class="hl-keyword">return</strong> false;
}

<strong class="hl-keyword">function</strong> matchesContext(path, context, allowRoot, allowSubcontext) {
    <strong class="hl-keyword">if</strong> (allowRoot &amp;&amp; path === context) {
        <strong class="hl-keyword">return</strong> true;
    }
    <strong class="hl-keyword">if</strong> (allowSubcontext &amp;&amp; path.substring(<span class="hl-number">0</span>, context.length + <span class="hl-number">1</span>)
            === context + <strong class="hl-string"><em style="color: #f58220">"/"</em></strong>) {
        <strong class="hl-keyword">return</strong> true;
    }
    <strong class="hl-keyword">return</strong> false;
}

<strong class="hl-keyword">function</strong> allow() {
    <strong class="hl-keyword">if</strong> (<strong class="hl-keyword">typeof</strong>(request.parent) === <strong class="hl-string"><em style="color: #f58220">'undefined'</em></strong> ||
            request.parent.type != <strong class="hl-string"><em style="color: #f58220">'http'</em></strong>) {
        <strong class="hl-keyword">return</strong> true;
    }

    <em class="hl-comment" style="color: #868686">// Restrict the URLs that are accessible externally</em>
    <strong class="hl-keyword">var</strong> path = request.parent.path;
    <strong class="hl-keyword">if</strong> (!(matchesContext(path, <strong class="hl-string"><em style="color: #f58220">"/openidm/config"</em></strong>, true, true)
            || matchesContext(path, <strong class="hl-string"><em style="color: #f58220">"/openidm/managed"</em></strong>, false, true))) {
        <strong class="hl-keyword">return</strong> false;
    }

    <strong class="hl-keyword">var</strong> roles = request.parent.security[<strong class="hl-string"><em style="color: #f58220">'openidm-roles'</em></strong>];
    <strong class="hl-keyword">if</strong> (contains(roles, <strong class="hl-string"><em style="color: #f58220">'openidm-admin'</em></strong>)) {
        <strong class="hl-keyword">return</strong> true;
    } <strong class="hl-keyword">else</strong> <strong class="hl-keyword">if</strong> (allowCert &amp;&amp; contains(roles, <strong class="hl-string"><em style="color: #f58220">'openidm-cert'</em></strong>)) {
        <strong class="hl-keyword">return</strong> true;
    } <strong class="hl-keyword">else</strong> <strong class="hl-keyword">if</strong> (allowAnon &amp;&amp; contains(roles, <strong class="hl-string"><em style="color: #f58220">'openidm-reg'</em></strong>)) {
        <strong class="hl-keyword">return</strong> true;    
    } <strong class="hl-keyword">else</strong> {
        <strong class="hl-keyword">return</strong> false;
    }
}

<strong class="hl-keyword">if</strong> (!allow()) {
    <strong class="hl-keyword">throw</strong> <strong class="hl-string"><em style="color: #f58220">"Access denied"</em></strong>;
}</div><p>Compared to the default, this example has a second global constant,
  <code class="literal">allowAnon</code>, used to allow or deny anonymous access. The
  new constant serves in the <code class="literal">allow()</code> function when checking
  for <code class="literal">openidm-reg</code> membership, the role for anonymous
  users.</p><p>Furthermore this example includes an additional function,
  <code class="literal">matchesContext()</code>, called from the
  <code class="literal">allow()</code> function before the role test. The additional test
  filters out all requests not to <code class="literal">/openidm/config</code> or below
  <code class="literal">/openidm/managed</code>. The context root itself is excluded in
  the latter call to avoid actions like patch by query on
  <code class="filename">/openidm/managed/user</code>.</p></div></div><div lang="en" class="chapter" title="Chapter&nbsp;10.&nbsp;Securing &amp; Hardening OpenIDM"><div class="titlepage"><div><div><h2 class="title"><a name="chap-security"></a>Chapter&nbsp;10.&nbsp;Securing &amp; Hardening OpenIDM</h2></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl><dt><span class="section"><a href="#security-ssl-https">10.1. Use SSL and HTTPS</a></span></dt><dt><span class="section"><a href="#security-encrypt-data">10.2. Encrypt Data Internally &amp; Externally</a></span></dt><dt><span class="section"><a href="#security-messages">10.3. Use Message Level Security</a></span></dt><dt><span class="section"><a href="#security-replace-defaults">10.4. Replace Default Security Settings</a></span></dt><dt><span class="section"><a href="#security-jetty">10.5. Secure Jetty</a></span></dt><dt><span class="section"><a href="#security-urls">10.6. Protect Sensitive REST Interface URLs</a></span></dt><dt><span class="section"><a href="#security-files">10.7. Protect Sensitive Files &amp; Directories</a></span></dt><dt><span class="section"><a href="#security-bootstrap">10.8. Obfuscate Bootstrap Information</a></span></dt><dt><span class="section"><a href="#security-remove-dev-tools">10.9. Remove or Protect Development &amp; Debug Tools</a></span></dt><dt><span class="section"><a href="#security-protect-repo">10.10. Protect the OpenIDM Repository</a></span></dt><dt><span class="section"><a href="#security-adjust-log-levels">10.11. Adjust Log Levels</a></span></dt><dt><span class="section"><a href="#security-run-as-service">10.12. Set Up Restart At System Boot</a></span></dt></dl></div><a class="indexterm" name="d160e4312"></a><a class="indexterm" name="d160e4315"></a><p>After following the guidance in this chapter, make sure that you test
 your installation to verify that it behaves as expected before putting it
 into production.</p><p>Out of the box, OpenIDM is set up for ease of development and
 deployment. When deploying OpenIDM in production, take the following
 precautions.</p><div class="section" title="10.1.&nbsp;Use SSL and HTTPS"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="security-ssl-https"></a>10.1.&nbsp;Use SSL and HTTPS</h2></div></div></div><a class="indexterm" name="d160e4325"></a><p>Disable plain HTTP access, included for development convenience, as
  described in the section titled <a href="../integrators-guide/index.html#security-jetty" class="link"><em class="citetitle">Secure
  Jetty</em></a>.</p><p>Use TLS/SSL to access OpenIDM, ideally with mutual authentication so
  that only trusted systems can invoke each other. TLS/SSL protects data on
  the wire. Mutual authentication with certificates imported into the
  applications' trust and key stores provides some confidence for trusting
  application access.</p><p>Augment this protect with message level security where
  appropriate.</p></div><div class="section" title="10.2.&nbsp;Encrypt Data Internally &amp; Externally"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="security-encrypt-data"></a>10.2.&nbsp;Encrypt Data Internally &amp; Externally</h2></div></div></div><a class="indexterm" name="d160e4343"></a><a class="indexterm" name="d160e4348"></a><p>Beyond relying on end-to-end availability of TLS/SSL to protect
  data, OpenIDM also supports explicit encryption of data that goes on the
  wire. This can be important if the TLS/SSL termination happens prior to
  the final end point.</p><p>OpenIDM also supports encryption of data it puts into the repository,
  using a symmetric key. This protects against some attacks on the data
  store.</p><p>OpenIDM automatically encrypts sensitive data in configuration files,
  such as passwords. OpenIDM replaces clear text values when the system first
  reads the configuration file. Take care with configuration files having
  clear text values that OpenIDM has not yet read and updated.</p></div><div class="section" title="10.3.&nbsp;Use Message Level Security"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="security-messages"></a>10.3.&nbsp;Use Message Level Security</h2></div></div></div><a class="indexterm" name="d160e4360"></a><p>OpenIDM supports message level security, forcing authentication before
  granting access. Authentication works by means of a filter-based mechanism
  that lets you use either a HTTP Basic like mechanism or OpenIDM-specific headers, setting a
  cookie in the response that you can use for subsequent authentication. If you
  attempt to access OpenIDM URLs without the appropriate headers or session
  cookie, OpenIDM returns HTTP 401 Unauthorized.</p><p>The following examples show successful authentications.</p><div class="screen">$ curl
 --dump-header /dev/stdout
 --user openidm-admin:openidm-admin
 "http://localhost:8080/openidm/managed/user/?_query-id=query-all-ids"

HTTP/1.1 200 OK
Set-Cookie: JSESSIONID=2l0zobpuk6st1b2m7gvhg5zas;Path=/
Expires: Thu, 01 Jan 1970 00:00:00 GMT
Content-Type: application/json; charset=UTF-8
Date: Wed, 18 Jan 2012 10:36:19 GMT
Accept-Ranges: bytes
Server: Restlet-Framework/2.0.9
Transfer-Encoding: chunked

{"query-time-ms":1,"result":[{"_id":"ajensen"},{"_id":"bjensen"}]}

$ curl
 --dump-header /dev/stdout
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 "http://localhost:8080/openidm/managed/user/?_query-id=query-all-ids"

HTTP/1.1 200 OK
Set-Cookie: JSESSIONID=ixnekr105coj11ji67xcluux8;Path=/
Expires: Thu, 01 Jan 1970 00:00:00 GMT
Content-Type: application/json; charset=UTF-8
Date: Wed, 18 Jan 2012 10:36:40 GMT
Accept-Ranges: bytes
Server: Restlet-Framework/2.0.9
Transfer-Encoding: chunked

{"query-time-ms":0,"result":[{"_id":"ajensen"},{"_id":"bjensen"}]}

$ curl
 --dump-header /dev/stdout
 --header "Cookie: JSESSIONID=ixnekr105coj11ji67xcluux8"
 "http://localhost:8080/openidm/managed/user/?_query-id=query-all-ids"

HTTP/1.1 200 OK
Content-Type: application/json; charset=UTF-8
Date: Wed, 18 Jan 2012 10:37:20 GMT
Accept-Ranges: bytes
Server: Restlet-Framework/2.0.9
Transfer-Encoding: chunked

{"query-time-ms":1,"result":[{"_id":"ajensen"},{"_id":"bjensen"}]}</div><p>Notice that the last example uses the cookie OpenIDM set in the
  response to the penultimate request. You can also request one-time
  authentication without a session.</p><div class="screen">$ curl
 --dump-header /dev/stdout
 --header "X-OpenIDM-NoSession: true"
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 "http://localhost:8080/openidm/managed/user/?_query-id=query-all-ids"

HTTP/1.1 200 OK
Content-Type: application/json; charset=UTF-8
Date: Wed, 18 Jan 2012 10:52:27 GMT
Accept-Ranges: bytes
Server: Restlet-Framework/2.0.9
Transfer-Encoding: chunked

{"query-time-ms":1,"result":[{"_id":"ajensen"},{"_id":"bjensen"}]}</div><p>To log out and destroy the session, send the specific OpenIDM
  header.</p><div class="screen">$ curl
 --dump-header /dev/stdout
 --header "Cookie: JSESSIONID=ixnekr105coj11ji67xcluux8"
 --header "X-OpenIDM-Logout: true"
 "http://localhost:8080/openidm/"

HTTP/1.1 204 No Content</div><p>OpenIDM creates the <code class="literal">openidm-admin</code> user with password
  <code class="literal">openidm-admin</code> by default. This internal user is stored in
  OpenIDM's repository.</p><div class="screen">mysql&gt; select objectid,roles from internaluser;
+---------------+----------------------------------+
| objectid      | roles                            |
+---------------+----------------------------------+
| anonymous     | openidm-reg                      |
| openidm-admin | openidm-admin,openidm-authorized |
+---------------+----------------------------------+
2 rows in set (0.00 sec)</div><a class="indexterm" name="d160e4389"></a><p>OpenIDM uses the internal table for authentication, and also to set
  the roles for RBAC authorization of an authenticated user. The router
  service, described in the <a href="../integrators-guide/index.html#appendix-router" class="link"><em class="citetitle">Router
  Service Reference</em></a> appendix, enables you to apply filters
  as shown in <code class="filename">openidm/conf/router.json</code> and the associated
  script, <code class="filename">openidm/script/router-authz.js</code>. See the chapter
  on <a href="../integrators-guide/index.html#chap-auth" class="link"><em class="citetitle">Managing Authentication,
  Authorization &amp; RBAC</em></a> for details.</p></div><div class="section" title="10.4.&nbsp;Replace Default Security Settings"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="security-replace-defaults"></a>10.4.&nbsp;Replace Default Security Settings</h2></div></div></div><a class="indexterm" name="d160e4413"></a><p>Default security settings facilitate evaluation. Change the default
  encryption key, and then replace the default user password</p><div class="procedure" title="Procedure&nbsp;10.1.&nbsp;To Change Default Encryption Keys"><a name="security-change-encryption-keys"></a><div class="procedure-title">Procedure&nbsp;10.1.&nbsp;To Change Default Encryption Keys</div><a class="indexterm" name="d160e4421"></a><a class="indexterm" name="d160e4424"></a><p>By default, OpenIDM uses an symmetric encryption key with alias
   <code class="literal">openidm-sym-default</code>. Change this default key before
   deploying OpenIDM in production.</p><ol class="procedure" type="1"><li class="step" title="Step 1"><p>Add the new key to the key store.</p><div class="screen">$ cd /path/to/openidm/
$ keytool
 -genseckey
 -alias new-sym-key
 -keyalg AES
 -keysize 128
 -keystore security/keystore.jceks
 -storetype JCEKS
Enter keystore password:
Enter key password for &lt;new-sym-key&gt;
  (RETURN if same as keystore password):
Re-enter new password:
$ </div><p>Also see
    <code class="filename">openidm/samples/security/keystore_readme.txt</code>.</p></li><li class="step" title="Step 2"><p>Change the alias used in
    <code class="filename">openidm/conf/boot/boot.properties</code>.</p></li></ol></div><div class="procedure" title="Procedure&nbsp;10.2.&nbsp;To Replace the Default User &amp; Password"><a name="security-replace-default-user-password"></a><div class="procedure-title">Procedure&nbsp;10.2.&nbsp;To Replace the Default User &amp; Password</div><p>After changing the default encryption key, change at least the default
   user password.</p><ol class="procedure" type="1"><li class="step" title="Step 1"><p>Get the encrypted version of the new password.</p><div class="screen">$ cd /path/to/openidm/
$ echo \"newpwd\" &gt; /tmp/newpwd.json
$ java -jar bundle/json-crypto-cli-1.1.0.jar
 -encrypt
 -keystore security/keystore.jceks
 -storetype jceks
 -storepass changeit
 -alias "new-sym-key"
 -srcjson /tmp/newpwd.json

{
    "$crypto": {
        "value": {
            "iv": "sL0KM93PmvvvaQQ8rP+QAQ==",
            "data": "eSH8YgeezoWsDDIvX1WQ2A==",
            "cipher": "AES/CBC/PKCS5Padding",
            "key": "new-sym-key"
        },
        "type": "x-simple-encryption"
    }
}</div></li><li class="step" title="Step 2"><p>Replace the user object in the
    <code class="filename">openidm/db/scripts/mysql/openidm.sql</code> script before
    setting up MySQL as a repository for OpenIDM.</p><p>Alternatively, replace the user in the internal user table.</p></li></ol></div></div><div class="section" title="10.5.&nbsp;Secure Jetty"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="security-jetty"></a>10.5.&nbsp;Secure Jetty</h2></div></div></div><a class="indexterm" name="d160e4471"></a><p>Before running OpenIDM in production, edit the
  <code class="filename">openidm/conf/jetty.xml</code> configuration to avoid
  clear text HTTP. Opt instead for HTTPS either with or without mutual
  authentication. To disable plain HTTP access, comment out the section in
  <code class="filename">openidm/conf/jetty.xml</code> that enables HTTP on port
  8080.</p><div class="programlisting">
<em class="hl-comment" style="color: #868686">&lt;!--
&lt;Item&gt;
    &lt;New class="org.eclipse.jetty.server.nio.SelectChannelConnector"&gt;
        &lt;Set name="host"&gt;&lt;Property name="jetty.host" /&gt;&lt;/Set&gt;
        &lt;Set name="port"&gt;8080&lt;/Set&gt;
        &lt;Set name="maxIdleTime"&gt;300000&lt;/Set&gt;
        &lt;Set name="Acceptors"&gt;2&lt;/Set&gt;
        &lt;Set name="statsOn"&gt;false&lt;/Set&gt;
        &lt;Set name="confidentialPort"&gt;8443&lt;/Set&gt;
        &lt;Set name="lowResourcesConnections"&gt;20000&lt;/Set&gt;
        &lt;Set name="lowResourcesMaxIdleTime"&gt;5000&lt;/Set&gt;
    &lt;/New&gt;
&lt;/Item&gt;
--&gt;</em></div></div><div class="section" title="10.6.&nbsp;Protect Sensitive REST Interface URLs"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="security-urls"></a>10.6.&nbsp;Protect Sensitive REST Interface URLs</h2></div></div></div><p>Although the repository is accessible directly by default, since
  anything attached to the router is accessible with the default policy,
  avoid direct HTTP access in production. If you do not need such access,
  deny it in the authorization policy to reduce the attack surface.</p><p>Similarly deny direct HTTP access to system objects in production,
  particularly access to action. As a rule of thumb, do not expose anything
  not used in production. The main public interfaces over HTTP are
  <code class="literal">/openidm/managed/</code> and <code class="literal">/openidm/config/</code>.
  Other URIs are triggered indirectly, or are for internal consumption.</p><p>See the chapter on <a href="../integrators-guide/index.html#chap-auth" class="link"><em class="citetitle">Managing
  Authentication, Authorization &amp; RBAC</em></a> for an example
  showing how to protect sensitive URLs.</p></div><div class="section" title="10.7.&nbsp;Protect Sensitive Files &amp; Directories"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="security-files"></a>10.7.&nbsp;Protect Sensitive Files &amp; Directories</h2></div></div></div><p>Protect OpenIDM files from access by unauthorized users.</p><p>In particular, prevent other users from reading files in at least the
  <code class="filename">openidm/conf/boot/</code> and
  <code class="filename">openidm/security/</code> directories.</p></div><div class="section" title="10.8.&nbsp;Obfuscate Bootstrap Information"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="security-bootstrap"></a>10.8.&nbsp;Obfuscate Bootstrap Information</h2></div></div></div><p>OpenIDM uses the information in
  <code class="filename">conf/boot/boot.properties</code> including the key store
  password to start up. You can set an obfuscated version in the file, or
  prompt for the password at start up time.</p><p>To generate obfuscated versions of a password, invoke
  <code class="filename">openidm-crypto-2.0.3.jar</code> from
  the <code class="filename">openidm/</code> directory.</p><div class="screen">$ cd /path/to/openidm
$ java -jar bundle/init/openidm-crypto-2.0.3.jar</div><p>This utility helps obfuscate passwords to prevent casual observation.
  It is not securely encrypted and needs further measures to prevent disclosure.
  Enter the password as shown.</p><pre class="literallayout">OBF:1v2j1uum1xtv1zej1zer1xtn1uvk1v1v
CRYPT:1206319abab995251d745b151b73131c</pre></div><div class="section" title="10.9.&nbsp;Remove or Protect Development &amp; Debug Tools"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="security-remove-dev-tools"></a>10.9.&nbsp;Remove or Protect Development &amp; Debug Tools</h2></div></div></div><p>Before deploying OpenIDM in production, remove or protect development
  and debug tools, including the OSGi console exposed under
  <code class="literal">/system/console</code>. Authentication for this console is not
  integrated with authentication for OpenIDM.</p><p>To remove the OSGi console, remove the web console bundle,
  <code class="filename">org.apache.felix.webconsole-<em class="replaceable"><code>version</code></em>.jar</code>.</p><p>If you cannot remove the OSGi console, then protect it by overriding
  the default <code class="literal">admin:admin</code> credentials. Create a file called
  <code class="filename">openidm/conf/org.apache.felix.webconsole.internal.servlet.OsgiManager.cfg</code>
  containing the user name and password to access the console in Java
  properties file format.</p><div class="programlisting">
<span class="hl-attribute" style="color: #868686">username</span>=<em class="replaceable"><code>user-name</code></em>
<span class="hl-attribute" style="color: #868686">password</span>=<em class="replaceable"><code>password</code></em></div></div><div class="section" title="10.10.&nbsp;Protect the OpenIDM Repository"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="security-protect-repo"></a>10.10.&nbsp;Protect the OpenIDM Repository</h2></div></div></div><p>Use the JDBC repository. OrientDB is not yet supported for production
  use.</p><p>Use a strong password for the JDBC connection. Do not rely on default
  passwords.</p><p>Use a case sensitive database, particularly if you work with systems
  with different identifiers that match except for case. Otherwise correlation
  queries can pick up identifiers that should not be considered the same.</p></div><div class="section" title="10.11.&nbsp;Adjust Log Levels"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="security-adjust-log-levels"></a>10.11.&nbsp;Adjust Log Levels</h2></div></div></div><p>Leave log levels at <code class="literal">INFO</code> in production to ensure
  that you capture enough information to help diagnose issues. See the chapter
  on <a href="../integrators-guide/index.html#chap-logs" class="link"><em class="citetitle">Configuring Server
  Logs</em> for more information.</a>
  </p><p>At start up and shut down, <code class="literal">INFO</code> can produce many
  messages. Yet, during stable operation, <code class="literal">INFO</code> generally
  results in log messages only when coarse-grain operations such as
  scheduled reconciliation start or stop.</p></div><div class="section" title="10.12.&nbsp;Set Up Restart At System Boot"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="security-run-as-service"></a>10.12.&nbsp;Set Up Restart At System Boot</h2></div></div></div><p>You can run OpenIDM in the background as a service (daemon), and
  add startup and shutdown scripts to manage the service at system boot
  and shutdown. For details see the section titled <a href="../integrators-guide/index.html#startup-shutdown" class="link"><em class="citetitle">Startup &amp;
  Shutdown</em></a>.</p><p>See your operating system documentation for details on adding a
  service such as OpenIDM to be started at boot and shut down at system
  shutdown.</p></div></div><div lang="en" class="chapter" title="Chapter&nbsp;11.&nbsp;Integrating Business Processes &amp; Workflow"><div class="titlepage"><div><div><h2 class="title"><a name="chap-workflow"></a>Chapter&nbsp;11.&nbsp;Integrating Business Processes &amp; Workflow</h2></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl><dt><span class="section"><a href="#about-bmpm-2-activiti">11.1. About BPMN 2.0 &amp; Activity Tools</a></span></dt><dt><span class="section"><a href="#openidm-activity-limitations">11.2. Known Issues &amp; Limitations</a></span></dt><dt><span class="section"><a href="#invoking-activiti-workflows">11.3. Invoking Activiti Workflows</a></span></dt><dt><span class="section"><a href="#sample-activiti-workflows">11.4. Example Activiti Workflows With OpenIDM</a></span></dt></dl></div><a class="indexterm" name="d160e4616"></a><a class="indexterm" name="d160e4619"></a><p>Key to any identity management solution is the ability to provide
 workflow driven provisioning activities, whether for self-service actions
 such as request for entitlements, roles or resources, running sunrise or
 sunset processes, handling approvals with escalations, or performing
 maintenance.</p><p>OpenIDM provides an embedded workflow and business process engine
 based on Activiti and the Business Process Model and Notation (BPMN) 2.0
 standard.</p><div class="note" title="Note" style="font-style: italic;"><h3 class="title">Note</h3><p>The embedded workflow and business process engine is currently
  provided as part of a separate, experimental download, the OpenIDM
  2.0.3-SNAPSHOT Experimental Nightly build available
  from the <a class="link" href="http://www.forgerock.org/openidm.html" target="_blank">download page</a>.</p><p>You install the experimental download in the same way as standard
  OpenIDM. See the <a href="../install-guide/index.html#chap-install" class="link"><em class="citetitle">Installation
  Guide</em></a> for instructions. After starting OpenIDM, run
  the <span class="command"><strong>scr list</strong></span> command at the console, and check that the 
  bundle is active.</p><div class="screen">-&gt; scr list
...
[  14] [active       ] org.forgerock.openidm.workflow.activiti
...</div><p>Contact ForgeRock at <a class="link" href="mailto:info@forgerock.com" target="_top">info@forgerock.com</a> for details on support for the experimental
  embedded workflow and business process engine.</p></div><p>More information about Activiti and the Activiti project can be found
 at <a class="link" href="http://www.activiti.org" target="_blank">http://www.activiti.org</a>.</p><div class="section" title="11.1.&nbsp;About BPMN 2.0 &amp; Activity Tools"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="about-bmpm-2-activiti"></a>11.1.&nbsp;About BPMN 2.0 &amp; Activity Tools</h2></div></div></div><p>Business Process Model and Notation 2.0 is the result of consensus
  among Business Process Management (BPM) system vendors. The <a class="link" href="http://omg.org/" target="_blank">Object Management Group</a>
  (OMG) has developed and maintained the <a class="link" href="http://www.omg.org/spec/BPMN/" target="_blank">BPMN</a> standard since
  2004.</p><p>The first version of the BPMN specification focused only on graphical
  notation, and quickly became popular with the business analyst audience.
  BPMN 1.x defines how constructs such as human tasks, executable scripts, and
  automated decisions are visualized in a vendor-neutral, standard way. The
  second version of BPMN extends that focus to include execution semantics,
  and a common exchange format. Thus, BPMN 2.0 process definition models
  can be exchanged not only between different graphical editors, but also
  can be executed as is on any BPMN 2.0-compliant engine, such as the engine
  embedded in OpenIDM.</p><p>Using BMPN 2.0, you can add artifacts describing workflow and business
  process behavior to OpenIDM for provisioning and other purposes. For example,
  you can craft the actual artifacts defining business processes and workflow
  in a text editor such as <span class="command"><strong>vi</strong></span>, or using a special Eclipse
  plugin. The Eclipse plugin provides visual design capabilities, simplifying
  packaging and deployment of the artifact to OpenIDM. See the <a class="link" href="http://docs.codehaus.org/display/ACT/Activiti+BPMN+2.0+Eclipse+Plugin" target="_blank">Activiti BPMN 2.0 Eclipse Plugin</a> documentation for
  instructions on installing Activiti Eclipse BPMN 2.0 Designer.</p><p>Also read the Activiti <em class="citetitle">User Guide</em> section
  covering <a class="link" href="http://www.activiti.org/userguide/#bpmnConstructs" target="_blank"><em class="citetitle">BPMN 2.0 Constructs</em></a>, which
  describes in detail the graphical notations and XML representations for
  events, flows, gateways, tasks, and process constructs.</p></div><div class="section" title="11.2.&nbsp;Known Issues &amp; Limitations"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="openidm-activity-limitations"></a>11.2.&nbsp;Known Issues &amp; Limitations</h2></div></div></div><div class="itemizedlist"><p>The following are known issues and limitation for the experimental
   embedded workflow and business process engine.</p><ul class="itemizedlist" type="disc"><li class="listitem"><p>OpenIDM does not include a form generator, making it difficult to
    include embedded forms (OPENIDM-468).</p></li><li class="listitem"><p>Error handling needs improvement.</p></li><li class="listitem"><p>This version depends on Activiti 5.8, which does not have the fix
    for <a class="link" href="http://jira.codehaus.org/browse/ACT-583" target="_blank">ACT-583</a>: Processes are not found in the .bar file
    if they are below root.</p><p>To work around this issue, create a directory inside the .bar, and
    put the BPMN XML artifact in the directory so that it is properly picked up
    by the Process Engine.</p></li></ul></div></div><div class="section" title="11.3.&nbsp;Invoking Activiti Workflows"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="invoking-activiti-workflows"></a>11.3.&nbsp;Invoking Activiti Workflows</h2></div></div></div><p>You can invoke workflows and business processes from any trigger point
  OpenIDM offers, including reacting to situations discovered during
  reconciliation. Invocation relies on the <code class="literal">openidm.action()</code>
  function.</p><div class="programlisting">
<em class="hl-comment" style="color: #868686">/*
 * Calling 'myWorkflow' workflow
 */</em>
<strong class="hl-keyword">var</strong> map = {    
 <strong class="hl-string"><em style="color: #f58220">"_action"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"myWorkflow"</em></strong>,
 <strong class="hl-string"><em style="color: #f58220">"_workflowParams"</em></strong> : {
    <strong class="hl-string"><em style="color: #f58220">"foo"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"bar"</em></strong>
  }
};

openidm.action(<strong class="hl-string"><em style="color: #f58220">"workflow/activiti"</em></strong>, map);</div></div><div class="section" title="11.4.&nbsp;Example Activiti Workflows With OpenIDM"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sample-activiti-workflows"></a>11.4.&nbsp;Example Activiti Workflows With OpenIDM</h2></div></div></div><p>This section describes two example workflows, one using email
  notification, the other involving a sunset process triggered during
  reconciliation.</p><div class="section" title="11.4.1.&nbsp;Example Email Notification Workflow"><div class="titlepage"><div><div><h3 class="title"><a name="example-activiti-email-notification-flow"></a>11.4.1.&nbsp;Example Email Notification Workflow</h3></div></div></div><p>This example uses the Activiti Eclipse BPMN 2.0 Designer to set up an
   email notification business process. The example relies on an SMTP server
   listening on <code class="literal">localhost</code>, port 25.</p><div class="variablelist"><p>The example sets up a workflow that can accept parameters used to
    specify the sender and recipient of the mail.</p><dl><dt><span class="term"><code class="literal">${fromSender}</code></span></dt><dd><p>Used to specify the sender</p></dd><dt><span class="term"><code class="literal">${toEmail}</code></span></dt><dd><p>Used to specify the recipient</p></dd></dl></div><p>Once you have defined the workflow, drag and drop components to create
   the workflow. This simple example uses only a
   <code class="literal">StartEvent</code>, <code class="literal">MailTask</code>, and
   <code class="literal">EndEvent</code>.</p><div class="mediaobject" title="Email notification process"><a name="figure-bpmn-email-notification"></a><img src="images/bpmn-email-notification.png" longdesc="/Users/mark/Documents/workspace/openidm-2.0.x/target/docbkx/html/integrators-guide/figure-bpmn-email-notification.html"><div class="longdesc-link" align="right"><br clear="all"><span class="longdesc-link">[<a href="figure-bpmn-email-notification.html" target="longdesc">D</a>]</span></div></div><p>After creating the workflow, adjust the generated XML source code to
   use the variables inside the <code class="literal">&lt;serviceTask&gt;</code>
   tag shown in the following listing.</p><div class="programlisting">
<span class="hl-directive" style="color: #868686">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<strong class="hl-tag" style="color: #f58220">&lt;definitions</strong>
 <span class="hl-attribute" style="color: #868686">xmlns</span>=<span class="hl-value" style="color: #333">"http://www.omg.org/spec/BPMN/20100524/MODEL"</span>
 <span class="hl-attribute" style="color: #868686">xmlns:xsi</span>=<span class="hl-value" style="color: #333">"http://www.w3.org/2001/XMLSchema-instance"</span>
 <span class="hl-attribute" style="color: #868686">xmlns:activiti</span>=<span class="hl-value" style="color: #333">"http://activiti.org/bpmn"</span>
 <span class="hl-attribute" style="color: #868686">xmlns:bpmndi</span>=<span class="hl-value" style="color: #333">"http://www.omg.org/spec/BPMN/20100524/DI"</span>
 <span class="hl-attribute" style="color: #868686">xmlns:omgdc</span>=<span class="hl-value" style="color: #333">"http://www.omg.org/spec/DD/20100524/DC"</span>
 <span class="hl-attribute" style="color: #868686">xmlns:omgdi</span>=<span class="hl-value" style="color: #333">"http://www.omg.org/spec/DD/20100524/DI"</span>
 <span class="hl-attribute" style="color: #868686">typeLanguage</span>=<span class="hl-value" style="color: #333">"http://www.w3.org/2001/XMLSchema"</span>
 <span class="hl-attribute" style="color: #868686">expressionLanguage</span>=<span class="hl-value" style="color: #333">"http://www.w3.org/1999/XPath"</span>
 <span class="hl-attribute" style="color: #868686">targetNamespace</span>=<span class="hl-value" style="color: #333">"http://www.activiti.org/test"</span><strong class="hl-tag" style="color: #f58220">&gt;</strong>
 <strong class="hl-tag" style="color: #f58220">&lt;process</strong> <span class="hl-attribute" style="color: #868686">id</span>=<span class="hl-value" style="color: #333">"EmailNotification"</span> <span class="hl-attribute" style="color: #868686">name</span>=<span class="hl-value" style="color: #333">"emailNotification"</span><strong class="hl-tag" style="color: #f58220">&gt;</strong>
   <strong class="hl-tag" style="color: #f58220">&lt;documentation&gt;</strong>Simple Email Notification Task<strong class="hl-tag" style="color: #f58220">&lt;/documentation&gt;</strong>
   <strong class="hl-tag" style="color: #f58220">&lt;startEvent</strong> <span class="hl-attribute" style="color: #868686">id</span>=<span class="hl-value" style="color: #333">"startevent1"</span> <span class="hl-attribute" style="color: #868686">name</span>=<span class="hl-value" style="color: #333">"Start"</span><strong class="hl-tag" style="color: #f58220">&gt;</strong><strong class="hl-tag" style="color: #f58220">&lt;/startEvent&gt;</strong>
   <strong class="hl-tag" style="color: #f58220">&lt;sequenceFlow</strong> <span class="hl-attribute" style="color: #868686">id</span>=<span class="hl-value" style="color: #333">"flow1"</span> <span class="hl-attribute" style="color: #868686">name</span>=<span class="hl-value" style="color: #333">""</span> <span class="hl-attribute" style="color: #868686">sourceRef</span>=<span class="hl-value" style="color: #333">"startevent1"</span>
     <span class="hl-attribute" style="color: #868686">targetRef</span>=<span class="hl-value" style="color: #333">"mailtask1"</span><strong class="hl-tag" style="color: #f58220">&gt;</strong><strong class="hl-tag" style="color: #f58220">&lt;/sequenceFlow&gt;</strong>
   <strong class="hl-tag" style="color: #f58220">&lt;endEvent</strong> <span class="hl-attribute" style="color: #868686">id</span>=<span class="hl-value" style="color: #333">"endevent1"</span> <span class="hl-attribute" style="color: #868686">name</span>=<span class="hl-value" style="color: #333">"End"</span><strong class="hl-tag" style="color: #f58220">&gt;</strong><strong class="hl-tag" style="color: #f58220">&lt;/endEvent&gt;</strong>
   <strong class="hl-tag" style="color: #f58220">&lt;sequenceFlow</strong> <span class="hl-attribute" style="color: #868686">id</span>=<span class="hl-value" style="color: #333">"flow2"</span> <span class="hl-attribute" style="color: #868686">name</span>=<span class="hl-value" style="color: #333">""</span> <span class="hl-attribute" style="color: #868686">sourceRef</span>=<span class="hl-value" style="color: #333">"mailtask1"</span>
     <span class="hl-attribute" style="color: #868686">targetRef</span>=<span class="hl-value" style="color: #333">"endevent1"</span><strong class="hl-tag" style="color: #f58220">&gt;</strong><strong class="hl-tag" style="color: #f58220">&lt;/sequenceFlow&gt;</strong>
   <strong class="hl-tag" style="color: #f58220">&lt;serviceTask</strong> <span class="hl-attribute" style="color: #868686">id</span>=<span class="hl-value" style="color: #333">"mailtask1"</span> <span class="hl-attribute" style="color: #868686">name</span>=<span class="hl-value" style="color: #333">"Email Notification"</span>
     <span class="hl-attribute" style="color: #868686">activiti:type</span>=<span class="hl-value" style="color: #333">"mail"</span><strong class="hl-tag" style="color: #f58220">&gt;</strong>
     <strong class="hl-tag" style="color: #f58220">&lt;extensionElements&gt;</strong>
       <strong class="hl-tag" style="color: #f58220">&lt;activiti:field</strong> <span class="hl-attribute" style="color: #868686">name</span>=<span class="hl-value" style="color: #333">"to"</span> <span class="hl-attribute" style="color: #868686">expression</span>=<span class="hl-value" style="color: #333">"${toEmail}"</span><strong class="hl-tag" style="color: #f58220">
       &gt;</strong><strong class="hl-tag" style="color: #f58220">&lt;/activiti:field&gt;</strong>
       <strong class="hl-tag" style="color: #f58220">&lt;activiti:field</strong> <span class="hl-attribute" style="color: #868686">name</span>=<span class="hl-value" style="color: #333">"from"</span> <span class="hl-attribute" style="color: #868686">expression</span>=<span class="hl-value" style="color: #333">"no-reply@forgerock.com"</span><strong class="hl-tag" style="color: #f58220">
       &gt;</strong><strong class="hl-tag" style="color: #f58220">&lt;/activiti:field&gt;</strong>
       <strong class="hl-tag" style="color: #f58220">&lt;activiti:field</strong> <span class="hl-attribute" style="color: #868686">name</span>=<span class="hl-value" style="color: #333">"subject"</span> <span class="hl-attribute" style="color: #868686">expression</span>=<span class="hl-value" style="color: #333">"Simple Email Notification"</span><strong class="hl-tag" style="color: #f58220">
       &gt;</strong><strong class="hl-tag" style="color: #f58220">&lt;/activiti:field&gt;</strong>
       <strong class="hl-tag" style="color: #f58220">&lt;activiti:field</strong> <span class="hl-attribute" style="color: #868686">name</span>=<span class="hl-value" style="color: #333">"html"</span><strong class="hl-tag" style="color: #f58220">&gt;</strong>
         <strong class="hl-tag" style="color: #f58220">&lt;activiti:expression&gt;</strong><strong class="hl-tag" style="color: #f58220">&lt;![CDATA[</strong>Here is a simple Email Notification
         from ${fromSender}.<strong class="hl-tag" style="color: #f58220">]]&gt;</strong><strong class="hl-tag" style="color: #f58220">&lt;/activiti:expression&gt;</strong>
       <strong class="hl-tag" style="color: #f58220">&lt;/activiti:field&gt;</strong>
     <strong class="hl-tag" style="color: #f58220">&lt;/extensionElements&gt;</strong>
   <strong class="hl-tag" style="color: #f58220">&lt;/serviceTask&gt;</strong>
 <strong class="hl-tag" style="color: #f58220">&lt;/process&gt;</strong>
 <strong class="hl-tag" style="color: #f58220">&lt;bpmndi:BPMNDiagram</strong> <span class="hl-attribute" style="color: #868686">id</span>=<span class="hl-value" style="color: #333">"BPMNDiagram_EmailNotification"</span><strong class="hl-tag" style="color: #f58220">&gt;</strong>
   <strong class="hl-tag" style="color: #f58220">&lt;bpmndi:BPMNPlane</strong> <span class="hl-attribute" style="color: #868686">bpmnElement</span>=<span class="hl-value" style="color: #333">"EmailNotification"</span>
     <span class="hl-attribute" style="color: #868686">id</span>=<span class="hl-value" style="color: #333">"BPMNPlane_EmailNotification"</span><strong class="hl-tag" style="color: #f58220">&gt;</strong>
     <strong class="hl-tag" style="color: #f58220">&lt;bpmndi:BPMNShape</strong> <span class="hl-attribute" style="color: #868686">bpmnElement</span>=<span class="hl-value" style="color: #333">"startevent1"</span> <span class="hl-attribute" style="color: #868686">id</span>=<span class="hl-value" style="color: #333">"BPMNShape_startevent1"</span><strong class="hl-tag" style="color: #f58220">&gt;</strong>
       <strong class="hl-tag" style="color: #f58220">&lt;omgdc:Bounds</strong> <span class="hl-attribute" style="color: #868686">height</span>=<span class="hl-value" style="color: #333">"35"</span> <span class="hl-attribute" style="color: #868686">width</span>=<span class="hl-value" style="color: #333">"35"</span> <span class="hl-attribute" style="color: #868686">x</span>=<span class="hl-value" style="color: #333">"170"</span> <span class="hl-attribute" style="color: #868686">y</span>=<span class="hl-value" style="color: #333">"250"</span><strong class="hl-tag" style="color: #f58220">&gt;</strong><strong class="hl-tag" style="color: #f58220">&lt;/omgdc:Bounds&gt;</strong>
     <strong class="hl-tag" style="color: #f58220">&lt;/bpmndi:BPMNShape&gt;</strong>
     <strong class="hl-tag" style="color: #f58220">&lt;bpmndi:BPMNShape</strong> <span class="hl-attribute" style="color: #868686">bpmnElement</span>=<span class="hl-value" style="color: #333">"endevent1"</span> <span class="hl-attribute" style="color: #868686">id</span>=<span class="hl-value" style="color: #333">"BPMNShape_endevent1"</span><strong class="hl-tag" style="color: #f58220">&gt;</strong>
       <strong class="hl-tag" style="color: #f58220">&lt;omgdc:Bounds</strong> <span class="hl-attribute" style="color: #868686">height</span>=<span class="hl-value" style="color: #333">"35"</span> <span class="hl-attribute" style="color: #868686">width</span>=<span class="hl-value" style="color: #333">"35"</span> <span class="hl-attribute" style="color: #868686">x</span>=<span class="hl-value" style="color: #333">"410"</span> <span class="hl-attribute" style="color: #868686">y</span>=<span class="hl-value" style="color: #333">"250"</span><strong class="hl-tag" style="color: #f58220">&gt;</strong><strong class="hl-tag" style="color: #f58220">&lt;/omgdc:Bounds&gt;</strong>
     <strong class="hl-tag" style="color: #f58220">&lt;/bpmndi:BPMNShape&gt;</strong>
     <strong class="hl-tag" style="color: #f58220">&lt;bpmndi:BPMNShape</strong> <span class="hl-attribute" style="color: #868686">bpmnElement</span>=<span class="hl-value" style="color: #333">"mailtask1"</span> <span class="hl-attribute" style="color: #868686">id</span>=<span class="hl-value" style="color: #333">"BPMNShape_mailtask1"</span><strong class="hl-tag" style="color: #f58220">&gt;</strong>
       <strong class="hl-tag" style="color: #f58220">&lt;omgdc:Bounds</strong> <span class="hl-attribute" style="color: #868686">height</span>=<span class="hl-value" style="color: #333">"55"</span> <span class="hl-attribute" style="color: #868686">width</span>=<span class="hl-value" style="color: #333">"105"</span> <span class="hl-attribute" style="color: #868686">x</span>=<span class="hl-value" style="color: #333">"250"</span> <span class="hl-attribute" style="color: #868686">y</span>=<span class="hl-value" style="color: #333">"240"</span><strong class="hl-tag" style="color: #f58220">&gt;</strong><strong class="hl-tag" style="color: #f58220">&lt;/omgdc:Bounds&gt;</strong>
     <strong class="hl-tag" style="color: #f58220">&lt;/bpmndi:BPMNShape&gt;</strong>
     <strong class="hl-tag" style="color: #f58220">&lt;bpmndi:BPMNEdge</strong> <span class="hl-attribute" style="color: #868686">bpmnElement</span>=<span class="hl-value" style="color: #333">"flow1"</span> <span class="hl-attribute" style="color: #868686">id</span>=<span class="hl-value" style="color: #333">"BPMNEdge_flow1"</span><strong class="hl-tag" style="color: #f58220">&gt;</strong>
       <strong class="hl-tag" style="color: #f58220">&lt;omgdi:waypoint</strong> <span class="hl-attribute" style="color: #868686">x</span>=<span class="hl-value" style="color: #333">"205"</span> <span class="hl-attribute" style="color: #868686">y</span>=<span class="hl-value" style="color: #333">"267"</span><strong class="hl-tag" style="color: #f58220">&gt;</strong><strong class="hl-tag" style="color: #f58220">&lt;/omgdi:waypoint&gt;</strong>
       <strong class="hl-tag" style="color: #f58220">&lt;omgdi:waypoint</strong> <span class="hl-attribute" style="color: #868686">x</span>=<span class="hl-value" style="color: #333">"250"</span> <span class="hl-attribute" style="color: #868686">y</span>=<span class="hl-value" style="color: #333">"267"</span><strong class="hl-tag" style="color: #f58220">&gt;</strong><strong class="hl-tag" style="color: #f58220">&lt;/omgdi:waypoint&gt;</strong>
     <strong class="hl-tag" style="color: #f58220">&lt;/bpmndi:BPMNEdge&gt;</strong>
     <strong class="hl-tag" style="color: #f58220">&lt;bpmndi:BPMNEdge</strong> <span class="hl-attribute" style="color: #868686">bpmnElement</span>=<span class="hl-value" style="color: #333">"flow2"</span> <span class="hl-attribute" style="color: #868686">id</span>=<span class="hl-value" style="color: #333">"BPMNEdge_flow2"</span><strong class="hl-tag" style="color: #f58220">&gt;</strong>
       <strong class="hl-tag" style="color: #f58220">&lt;omgdi:waypoint</strong> <span class="hl-attribute" style="color: #868686">x</span>=<span class="hl-value" style="color: #333">"355"</span> <span class="hl-attribute" style="color: #868686">y</span>=<span class="hl-value" style="color: #333">"267"</span><strong class="hl-tag" style="color: #f58220">&gt;</strong><strong class="hl-tag" style="color: #f58220">&lt;/omgdi:waypoint&gt;</strong>
       <strong class="hl-tag" style="color: #f58220">&lt;omgdi:waypoint</strong> <span class="hl-attribute" style="color: #868686">x</span>=<span class="hl-value" style="color: #333">"410"</span> <span class="hl-attribute" style="color: #868686">y</span>=<span class="hl-value" style="color: #333">"267"</span><strong class="hl-tag" style="color: #f58220">&gt;</strong><strong class="hl-tag" style="color: #f58220">&lt;/omgdi:waypoint&gt;</strong>
     <strong class="hl-tag" style="color: #f58220">&lt;/bpmndi:BPMNEdge&gt;</strong>
   <strong class="hl-tag" style="color: #f58220">&lt;/bpmndi:BPMNPlane&gt;</strong>
 <strong class="hl-tag" style="color: #f58220">&lt;/bpmndi:BPMNDiagram&gt;</strong>
<strong class="hl-tag" style="color: #f58220">&lt;/definitions&gt;</strong></div><p>In Eclipse, select the project, then right click and select
   Create deployment artifacts to generate the components and package them
   in a .bar file for deployment in the <code class="filename">openidm/workflow</code>
   directory.</p><p>Before you deploy the .bar, work around the issue mentioned above
   by adding the XML artifact in the right place in the .bar, for example by
   expanding the .bar, moving the
   <code class="filename">EmailNotification.bpmn20.xml</code> file inside a directory,
   and recreating the .bar.</p><p>After you deploy the .bar, create a script in
   <code class="filename">openidm/script/invokeEmailNotification.js</code>. The script
   invokes the workflow.</p><div class="programlisting">
<em class="hl-comment" style="color: #868686">/*
 * Calling 'EmailNotification' workflow
 */</em>
<strong class="hl-keyword">var</strong> map = {    
 <strong class="hl-string"><em style="color: #f58220">"_action"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"emailNotification"</em></strong>,
 <strong class="hl-string"><em style="color: #f58220">"_workflowParams"</em></strong> : {
    <strong class="hl-string"><em style="color: #f58220">"fromSender"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"noreply@openidm"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"toEmail"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"john.doe@corp.com"</em></strong>
  }
};

openidm.action(<strong class="hl-string"><em style="color: #f58220">"workflow/activiti"</em></strong>, map);</div><p>Also, create a schedule configuration object in
   <code class="filename">openidm/conf/schedule-EmailNotification.json</code>. The
   following schedule invokes the workflow once per minute.</p><div class="programlisting">
{
   <strong class="hl-string"><em style="color: #f58220">"enabled"</em></strong> : true,
   <strong class="hl-string"><em style="color: #f58220">"type"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"cron"</em></strong>,
   <strong class="hl-string"><em style="color: #f58220">"schedule"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"0 0/1 * * * ?"</em></strong>,
   <strong class="hl-string"><em style="color: #f58220">"invokeService"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"script"</em></strong>,
   <strong class="hl-string"><em style="color: #f58220">"invokeContext"</em></strong> : {
       <strong class="hl-string"><em style="color: #f58220">"script"</em></strong> : {
           <strong class="hl-string"><em style="color: #f58220">"type"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"text/javascript"</em></strong>,
           <strong class="hl-string"><em style="color: #f58220">"file"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"script/invokeEmailNotification.js"</em></strong>
       },
   }
}</div></div><div class="section" title="11.4.2.&nbsp;Example Sunset Workflow Triggered By Reconciliation"><div class="titlepage"><div><div><h3 class="title"><a name="example-activiti-recon-sunset-flow"></a>11.4.2.&nbsp;Example Sunset Workflow Triggered By Reconciliation</h3></div></div></div><p>OpenIDM can allow deferred deprovisioning and disabling, such as
   needed when an external consultant's contract expires or is up for
   renewal. This example shows how OpenIDM can be used to handle such
   scenarios.</p><p>To understand the scenario, consider the target resource and the
   authoritative source.</p><p>Set up a CSV file connector to connect to an authoritative source
   file containing the following.</p><div class="programlisting" width="92">
firstName,uid,"lastName","email","employeeNumber",password,"sunrise","sunset","active"
"Darth","DDOE","Doe","doe@...","123456","Z29vZA==","2011-11-30T...","2011-12-23T...","TRUE"</div><p>The authoritative source contains the field, <code class="literal">sunset</code>,
   containing a time and date string referring to a time in the future.</p><p>Set up a simple XML connector to replicate fields in the authoritative
   CSV source on a 1-to-1 basis.</p><p>Define a Sunset Workflow using Activiti Eclipse BPMN 2.0
   Designer.</p><div class="mediaobject" title="Sunset workflow process"><a name="figure-bpmn-sunset-flow"></a><img src="images/bpmn-sunset-flow.png" longdesc="/Users/mark/Documents/workspace/openidm-2.0.x/target/docbkx/html/integrators-guide/figure-bpmn-sunset-flow.html"><div class="longdesc-link" align="right"><br clear="all"><span class="longdesc-link">[<a href="figure-bpmn-sunset-flow.html" target="longdesc">D</a>]</span></div></div><p>Use the following XML artifact.</p><div class="programlisting">
<span class="hl-directive" style="color: #868686">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>

<strong class="hl-tag" style="color: #f58220">&lt;definitions</strong> <span class="hl-attribute" style="color: #868686">id</span>=<span class="hl-value" style="color: #333">"definitions"</span>
            <span class="hl-attribute" style="color: #868686">xmlns</span>=<span class="hl-value" style="color: #333">"http://www.omg.org/spec/BPMN/20100524/MODEL"</span>
            <span class="hl-attribute" style="color: #868686">xmlns:activiti</span>=<span class="hl-value" style="color: #333">"http://activiti.org/bpmn"</span>
            <span class="hl-attribute" style="color: #868686">targetNamespace</span>=<span class="hl-value" style="color: #333">"Examples"</span>
            <span class="hl-attribute" style="color: #868686">xmlns:xsi</span>=<span class="hl-value" style="color: #333">"http://www.w3.org/2001/XMLSchema-instance"</span>
            <span class="hl-attribute" style="color: #868686">xsi:schemaLocation</span>=<span class="hl-value" style="color: #333">"http://www.omg.org/spec/BPMN/20100524/MODEL
              http://www.omg.org/spec/BPMN/2.0/20100501/BPMN20.xsd"</span><strong class="hl-tag" style="color: #f58220">&gt;</strong>

    <strong class="hl-tag" style="color: #f58220">&lt;process</strong> <span class="hl-attribute" style="color: #868686">id</span>=<span class="hl-value" style="color: #333">"sunset"</span> <span class="hl-attribute" style="color: #868686">name</span>=<span class="hl-value" style="color: #333">"sunset usecase"</span><strong class="hl-tag" style="color: #f58220">&gt;</strong>
       <strong class="hl-tag" style="color: #f58220">&lt;startEvent</strong> <span class="hl-attribute" style="color: #868686">id</span>=<span class="hl-value" style="color: #333">"start"</span><strong class="hl-tag" style="color: #f58220"> /&gt;</strong>
       <strong class="hl-tag" style="color: #f58220">&lt;sequenceFlow</strong> <span class="hl-attribute" style="color: #868686">sourceRef</span>=<span class="hl-value" style="color: #333">"start"</span> <span class="hl-attribute" style="color: #868686">targetRef</span>=<span class="hl-value" style="color: #333">"saveInvokeContext"</span><strong class="hl-tag" style="color: #f58220">/&gt;</strong>
       <strong class="hl-tag" style="color: #f58220">&lt;scriptTask</strong> <span class="hl-attribute" style="color: #868686">id</span>=<span class="hl-value" style="color: #333">"saveInvokeContext"</span> <span class="hl-attribute" style="color: #868686">scriptFormat</span>=<span class="hl-value" style="color: #333">"groovy"</span>
         <span class="hl-attribute" style="color: #868686">activiti:returnVariable</span>=<span class="hl-value" style="color: #333">"invokecontext"</span><strong class="hl-tag" style="color: #f58220">&gt;</strong>
           <strong class="hl-tag" style="color: #f58220">&lt;script&gt;</strong>
               <strong class="hl-tag" style="color: #f58220">&lt;![CDATA[</strong>
               invokecontext =
                       org.forgerock.openidm.context.InvokeContext.getContext()
              <strong class="hl-tag" style="color: #f58220">]]&gt;</strong>
           <strong class="hl-tag" style="color: #f58220">&lt;/script&gt;</strong>
       <strong class="hl-tag" style="color: #f58220">&lt;/scriptTask&gt;</strong>
       <strong class="hl-tag" style="color: #f58220">&lt;sequenceFlow</strong> <span class="hl-attribute" style="color: #868686">sourceRef</span>=<span class="hl-value" style="color: #333">"saveInvokeContext"</span>
         <span class="hl-attribute" style="color: #868686">targetRef</span>=<span class="hl-value" style="color: #333">"timerintermediatecatchevent1"</span><strong class="hl-tag" style="color: #f58220">/&gt;</strong>
       
       <strong class="hl-tag" style="color: #f58220">&lt;intermediateCatchEvent</strong> <span class="hl-attribute" style="color: #868686">id</span>=<span class="hl-value" style="color: #333">"timerintermediatecatchevent1"</span>
         <span class="hl-attribute" style="color: #868686">name</span>=<span class="hl-value" style="color: #333">"TimerCatchEvent"</span><strong class="hl-tag" style="color: #f58220">&gt;</strong>
           <strong class="hl-tag" style="color: #f58220">&lt;extensionElements&gt;</strong>
               <strong class="hl-tag" style="color: #f58220">&lt;activiti:field</strong> <span class="hl-attribute" style="color: #868686">name</span>=<span class="hl-value" style="color: #333">"t"</span> <span class="hl-attribute" style="color: #868686">expression</span>=<span class="hl-value" style="color: #333">"${time}"</span><strong class="hl-tag" style="color: #f58220">
               &gt;</strong><strong class="hl-tag" style="color: #f58220">&lt;/activiti:field&gt;</strong>
           <strong class="hl-tag" style="color: #f58220">&lt;/extensionElements&gt;</strong>
           <strong class="hl-tag" style="color: #f58220">&lt;timerEventDefinition&gt;</strong>
               <strong class="hl-tag" style="color: #f58220">&lt;timeDate &gt;</strong>${time}<strong class="hl-tag" style="color: #f58220">&lt;/timeDate&gt;</strong>
           <strong class="hl-tag" style="color: #f58220">&lt;/timerEventDefinition&gt;</strong>
       <strong class="hl-tag" style="color: #f58220">&lt;/intermediateCatchEvent&gt;</strong>
       
       <strong class="hl-tag" style="color: #f58220">&lt;sequenceFlow</strong> <span class="hl-attribute" style="color: #868686">sourceRef</span>=<span class="hl-value" style="color: #333">"timerintermediatecatchevent1"</span>
         <span class="hl-attribute" style="color: #868686">targetRef</span>=<span class="hl-value" style="color: #333">"idmCall"</span><strong class="hl-tag" style="color: #f58220">/&gt;</strong>
       
       
       <strong class="hl-tag" style="color: #f58220">&lt;serviceTask</strong> <span class="hl-attribute" style="color: #868686">id</span>=<span class="hl-value" style="color: #333">"idmCall"</span> <span class="hl-attribute" style="color: #868686">activiti:delegateExpression</span>=<span class="hl-value" style="color: #333">"${openidm}"</span>
         <span class="hl-attribute" style="color: #868686">activiti:async</span>=<span class="hl-value" style="color: #333">"true"</span><strong class="hl-tag" style="color: #f58220">&gt;</strong>
           <strong class="hl-tag" style="color: #f58220">&lt;extensionElements&gt;</strong>
               <strong class="hl-tag" style="color: #f58220">&lt;activiti:field</strong> <span class="hl-attribute" style="color: #868686">name</span>=<span class="hl-value" style="color: #333">"userName"</span> <span class="hl-attribute" style="color: #868686">expression</span>=<span class="hl-value" style="color: #333">"${userName}"</span><strong class="hl-tag" style="color: #f58220">
               &gt;</strong><strong class="hl-tag" style="color: #f58220">&lt;/activiti:field&gt;</strong>
               <strong class="hl-tag" style="color: #f58220">&lt;activiti:field</strong> <span class="hl-attribute" style="color: #868686">name</span>=<span class="hl-value" style="color: #333">"system"</span> <span class="hl-attribute" style="color: #868686">expression</span>=<span class="hl-value" style="color: #333">"${system}"</span><strong class="hl-tag" style="color: #f58220">
               &gt;</strong><strong class="hl-tag" style="color: #f58220">&lt;/activiti:field&gt;</strong>
           <strong class="hl-tag" style="color: #f58220">&lt;/extensionElements&gt;</strong>
       <strong class="hl-tag" style="color: #f58220">&lt;/serviceTask&gt;</strong>
       
       <strong class="hl-tag" style="color: #f58220">&lt;sequenceFlow</strong> <span class="hl-attribute" style="color: #868686">sourceRef</span>=<span class="hl-value" style="color: #333">"idmCall"</span> <span class="hl-attribute" style="color: #868686">targetRef</span>=<span class="hl-value" style="color: #333">"readUserAccount"</span><strong class="hl-tag" style="color: #f58220">/&gt;</strong>
       <strong class="hl-tag" style="color: #f58220">&lt;scriptTask</strong> <span class="hl-attribute" style="color: #868686">id</span>=<span class="hl-value" style="color: #333">"readUserAccount"</span> <span class="hl-attribute" style="color: #868686">scriptFormat</span>=<span class="hl-value" style="color: #333">"groovy"</span>
         <span class="hl-attribute" style="color: #868686">activiti:returnVariable</span>=<span class="hl-value" style="color: #333">"user"</span><strong class="hl-tag" style="color: #f58220"> &gt;</strong>
           <strong class="hl-tag" style="color: #f58220">&lt;script&gt;</strong>
               <strong class="hl-tag" style="color: #f58220">&lt;![CDATA[</strong>
               out:println '********Sunset date for user ' + userName
               org.forgerock.openidm.context.InvokeContext.getContext().
                       putApprover(invokecontext.getApprover())
               org.forgerock.openidm.context.InvokeContext.getContext().
                       putRequester(invokecontext.getRequester())
               org.forgerock.openidm.context.InvokeContext.getContext().
                       pushActivityId(invokecontext.popActivityId())

               user = openidm.read(system + userName);
               <strong class="hl-tag" style="color: #f58220">]]&gt;</strong>
           <strong class="hl-tag" style="color: #f58220">&lt;/script&gt;</strong>
       <strong class="hl-tag" style="color: #f58220">&lt;/scriptTask&gt;</strong>
       <strong class="hl-tag" style="color: #f58220">&lt;sequenceFlow</strong> <span class="hl-attribute" style="color: #868686">sourceRef</span>=<span class="hl-value" style="color: #333">"readUserAccount"</span> <span class="hl-attribute" style="color: #868686">targetRef</span>=<span class="hl-value" style="color: #333">"sendMail"</span><strong class="hl-tag" style="color: #f58220">/&gt;</strong>

       <strong class="hl-tag" style="color: #f58220">&lt;serviceTask</strong> <span class="hl-attribute" style="color: #868686">id</span>=<span class="hl-value" style="color: #333">"sendMail"</span> <span class="hl-attribute" style="color: #868686">name</span>=<span class="hl-value" style="color: #333">"Email Notification"</span>
         <span class="hl-attribute" style="color: #868686">activiti:type</span>=<span class="hl-value" style="color: #333">"mail"</span><strong class="hl-tag" style="color: #f58220">&gt;</strong>
           <strong class="hl-tag" style="color: #f58220">&lt;extensionElements&gt;</strong>
               <strong class="hl-tag" style="color: #f58220">&lt;activiti:field</strong> <span class="hl-attribute" style="color: #868686">name</span>=<span class="hl-value" style="color: #333">"to"</span> <span class="hl-attribute" style="color: #868686">expression</span>=<span class="hl-value" style="color: #333">"${toEmail}"</span><strong class="hl-tag" style="color: #f58220">
               &gt;</strong><strong class="hl-tag" style="color: #f58220">&lt;/activiti:field&gt;</strong>
               <strong class="hl-tag" style="color: #f58220">&lt;activiti:field</strong> <span class="hl-attribute" style="color: #868686">name</span>=<span class="hl-value" style="color: #333">"from"</span> <span class="hl-attribute" style="color: #868686">expression</span>=<span class="hl-value" style="color: #333">"no-reply@forgerock.com"</span><strong class="hl-tag" style="color: #f58220">
               &gt;</strong><strong class="hl-tag" style="color: #f58220">&lt;/activiti:field&gt;</strong>
               <strong class="hl-tag" style="color: #f58220">&lt;activiti:field</strong> <span class="hl-attribute" style="color: #868686">name</span>=<span class="hl-value" style="color: #333">"subject"</span> <span class="hl-attribute" style="color: #868686">expression</span>=<span class="hl-value" style="color: #333">"Disabling User"</span><strong class="hl-tag" style="color: #f58220">
               &gt;</strong><strong class="hl-tag" style="color: #f58220">&lt;/activiti:field&gt;</strong>
               <strong class="hl-tag" style="color: #f58220">&lt;activiti:field</strong> <span class="hl-attribute" style="color: #868686">name</span>=<span class="hl-value" style="color: #333">"text"</span><strong class="hl-tag" style="color: #f58220">&gt;</strong>
                   <strong class="hl-tag" style="color: #f58220">&lt;activiti:expression&gt;</strong><strong class="hl-tag" style="color: #f58220">&lt;![CDATA[</strong>
                   The following user has been disabled:
                   ${user}<strong class="hl-tag" style="color: #f58220">]]&gt;</strong>
                   <strong class="hl-tag" style="color: #f58220">&lt;/activiti:expression&gt;</strong>
               <strong class="hl-tag" style="color: #f58220">&lt;/activiti:field&gt;</strong>
           <strong class="hl-tag" style="color: #f58220">&lt;/extensionElements&gt;</strong>
       <strong class="hl-tag" style="color: #f58220">&lt;/serviceTask&gt;</strong>

       <strong class="hl-tag" style="color: #f58220">&lt;sequenceFlow</strong> <span class="hl-attribute" style="color: #868686">sourceRef</span>=<span class="hl-value" style="color: #333">"sendMail"</span> <span class="hl-attribute" style="color: #868686">targetRef</span>=<span class="hl-value" style="color: #333">"disableAccount"</span><strong class="hl-tag" style="color: #f58220">/&gt;</strong>
       <strong class="hl-tag" style="color: #f58220">&lt;scriptTask</strong> <span class="hl-attribute" style="color: #868686">id</span>=<span class="hl-value" style="color: #333">"disableAccount"</span> <span class="hl-attribute" style="color: #868686">scriptFormat</span>=<span class="hl-value" style="color: #333">"groovy"</span><strong class="hl-tag" style="color: #f58220">&gt;</strong>
           <strong class="hl-tag" style="color: #f58220">&lt;script&gt;</strong>
               <strong class="hl-tag" style="color: #f58220">&lt;![CDATA[</strong>
               out:println '********Disabling user account ' + userName
               user['__ENABLE__'] = false
               openidm.update(system + userName, null, user)
               <strong class="hl-tag" style="color: #f58220">]]&gt;</strong>
           <strong class="hl-tag" style="color: #f58220">&lt;/script&gt;</strong>
       <strong class="hl-tag" style="color: #f58220">&lt;/scriptTask&gt;</strong>
       <strong class="hl-tag" style="color: #f58220">&lt;sequenceFlow</strong> <span class="hl-attribute" style="color: #868686">sourceRef</span>=<span class="hl-value" style="color: #333">"disableAccount"</span> <span class="hl-attribute" style="color: #868686">targetRef</span>=<span class="hl-value" style="color: #333">"end"</span><strong class="hl-tag" style="color: #f58220">/&gt;</strong>
       <strong class="hl-tag" style="color: #f58220">&lt;endEvent</strong> <span class="hl-attribute" style="color: #868686">id</span>=<span class="hl-value" style="color: #333">"end"</span><strong class="hl-tag" style="color: #f58220">/&gt;</strong>

    <strong class="hl-tag" style="color: #f58220">&lt;/process&gt;</strong>
<strong class="hl-tag" style="color: #f58220">&lt;/definitions&gt;</strong></div><p>Set up a deferred action during reconciliation by reacting to a
   <code class="literal">FOUND</code> situation. When called, the script invoked must
   return the proper action to the found situation, which in the case of this
   example is <code class="literal">LINK</code>.</p><p>Add the following script to
   <code class="filename">script/triggerSunset.js</code> where you installed OpenIDM,
   invoked when reconciliation encounters a <code class="literal">FOUND</code>
   situation.</p><div class="programlisting">
<em class="hl-comment" style="color: #868686">/*
 * Calling 'sunrise' workflow
 */</em>
<strong class="hl-keyword">var</strong> map = {    
 <strong class="hl-string"><em style="color: #f58220">"_action"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"sunrise"</em></strong>,
 <strong class="hl-string"><em style="color: #f58220">"_workflowParams"</em></strong> : {
    <strong class="hl-string"><em style="color: #f58220">"userName"</em></strong> : target.__UID__,
    <strong class="hl-string"><em style="color: #f58220">"system"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"system/xmlfile/account/"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"time"</em></strong> : source.sunset,
    <strong class="hl-string"><em style="color: #f58220">"toEmail"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"manager@corp.org"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"fromSender"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"noreply@openidm"</em></strong>
 }
};

openidm.action(<strong class="hl-string"><em style="color: #f58220">"workflow/activiti"</em></strong>, map);

<strong class="hl-string"><em style="color: #f58220">"LINK"</em></strong></div><p>Add the following schedule to
   <code class="filename">conf/scheduler-reconcile_HR_XML.json</code> where you
   installed OpenIDM to invoke the script.</p><div class="programlisting">
{
    <strong class="hl-string"><em style="color: #f58220">"enabled"</em></strong> : true,
    <strong class="hl-string"><em style="color: #f58220">"type"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"cron"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"schedule"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"0 08 16 * * ?"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"invokeService"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"sync"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"invokeContext"</em></strong> : {
       <strong class="hl-string"><em style="color: #f58220">"action"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"reconcile"</em></strong>,
       <strong class="hl-string"><em style="color: #f58220">"mapping"</em></strong> : {
           <strong class="hl-string"><em style="color: #f58220">"name"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"CSV_XML"</em></strong>,
           <strong class="hl-string"><em style="color: #f58220">"source"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"system/CSV/persons"</em></strong>,
           <strong class="hl-string"><em style="color: #f58220">"target"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"system/xmlfile/account"</em></strong>,
           <strong class="hl-string"><em style="color: #f58220">"correlationQuery"</em></strong> : {
               <strong class="hl-string"><em style="color: #f58220">"type"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"text/javascript"</em></strong>,
               <strong class="hl-string"><em style="color: #f58220">"source"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"var myarray = [source.uid];var map = {
</em></strong>                   <strong class="hl-string"><em style="color: #f58220">'query'</em></strong> : {
                       <strong class="hl-string"><em style="color: #f58220">'Equals'</em></strong>: {<strong class="hl-string"><em style="color: #f58220">'field'</em></strong> : <strong class="hl-string"><em style="color: #f58220">'name'</em></strong>,<strong class="hl-string"><em style="color: #f58220">'values'</em></strong> : myarray}
                   }
               };map;<strong class="hl-string"><em style="color: #f58220">"
</em></strong>           },
           <strong class="hl-string"><em style="color: #f58220">"properties"</em></strong> : [
               {
                   <strong class="hl-string"><em style="color: #f58220">"source"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"firstname"</em></strong>,
                   <strong class="hl-string"><em style="color: #f58220">"target"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"firstname"</em></strong>
               },
               {
                   <strong class="hl-string"><em style="color: #f58220">"source"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"uid"</em></strong>,
                   <strong class="hl-string"><em style="color: #f58220">"target"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"name"</em></strong>
               },
               {
                   <strong class="hl-string"><em style="color: #f58220">"source"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"lastname"</em></strong>,
                   <strong class="hl-string"><em style="color: #f58220">"target"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"lastname"</em></strong>
               },
               {
                   <strong class="hl-string"><em style="color: #f58220">"source"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"email"</em></strong>,
                   <strong class="hl-string"><em style="color: #f58220">"target"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"email"</em></strong>
               }
           ],
           <strong class="hl-string"><em style="color: #f58220">"policies"</em></strong> : [
               {
                   <strong class="hl-string"><em style="color: #f58220">"situation"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"CONFIRMED"</em></strong>,
                   <strong class="hl-string"><em style="color: #f58220">"action"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"IGNORE"</em></strong>
               },
               <span class="bold"><strong>{
                   "situation" : "FOUND",
                   "action" : {
                       "type" : "text/javascript",
                       "file" : "script/triggerSunset.js"
                   }
               },</strong></span>
               {
                   <strong class="hl-string"><em style="color: #f58220">"situation"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"ABSENT"</em></strong>,
                   <strong class="hl-string"><em style="color: #f58220">"action"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"IGNORE"</em></strong>
               },
               {
                   <strong class="hl-string"><em style="color: #f58220">"situation"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"AMBIGUOUS"</em></strong>,
                   <strong class="hl-string"><em style="color: #f58220">"action"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"IGNORE"</em></strong>
               },
               {
                   <strong class="hl-string"><em style="color: #f58220">"situation"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"MISSING"</em></strong>,
                   <strong class="hl-string"><em style="color: #f58220">"action"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"IGNORE"</em></strong>
               },
               {
                   <strong class="hl-string"><em style="color: #f58220">"situation"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"UNQUALIFIED"</em></strong>,
                   <strong class="hl-string"><em style="color: #f58220">"action"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"IGNORE"</em></strong>
               },
               {
                   <strong class="hl-string"><em style="color: #f58220">"situation"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"UNASSIGNED"</em></strong>,
                   <strong class="hl-string"><em style="color: #f58220">"action"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"IGNORE"</em></strong>
               }
           ]
       }
    }
}</div></div></div></div><div lang="en" class="chapter" title="Chapter&nbsp;12.&nbsp;Using Audit Logs"><div class="titlepage"><div><div><h2 class="title"><a name="chap-auditing"></a>Chapter&nbsp;12.&nbsp;Using Audit Logs</h2></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl><dt><span class="section"><a href="#audit-log-types">12.1. Audit Log Types</a></span></dt><dt><span class="section"><a href="#audit-log-format">12.2. Audit Log File Formats</a></span></dt><dt><span class="section"><a href="#audit-configuration">12.3. Audit Configuration</a></span></dt><dt><span class="section"><a href="#audit-reports">12.4. Generating Reports</a></span></dt></dl></div><a class="indexterm" name="d160e4865"></a><p>OpenIDM auditing can publish and log all relevant system activity to
 the targets you specify. Auditing can include data from reconciliation as
 a basis for reporting, to access details, to activity logs that capture
 operations on internal (managed) objects and external (system) objects.
 Auditing provides the data for all the relevant reports, including orphan
 account reports.</p><p>The auditing interface allows you to push auditing data to files and
 to the OpenIDM repository.</p><div class="section" title="12.1.&nbsp;Audit Log Types"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="audit-log-types"></a>12.1.&nbsp;Audit Log Types</h2></div></div></div><div class="variablelist"><p>This section describes the types of audit log OpenIDM provides.</p><dl><dt><span class="term">Access Log</span></dt><dd><p>OpenIDM writes messages concerning access to the REST API in this
     log.</p><p>Default file: <code class="filename">openidm/audit/access.csv</code></p></dd><dt><span class="term">Activity Log</span></dt><dd><p>OpenIDM logs operations on internal (managed) and external (system)
     objects to this log type.</p><p>Entries in the activity log contain identifiers both for the
     reconciliation or synchronization action that triggered the activity,
     and also for the original caller and the relationships between related
     actions.</p><p>Default file: <code class="filename">openidm/audit/activity.csv</code></p></dd><dt><span class="term">Reconciliation Log</span></dt><dd><p>OpenIDM logs the results of a reconciliation run, including
     situations and the resulting actions taken to this log type. The activity
     log contains details about the actions, where log entries display parent
     activity identifiers,
     <code class="literal">recon/<em class="replaceable"><code>reconID</code></em></code>.</p><p>Default file: <code class="filename">openidm/audit/recon.csv</code></p></dd></dl></div><p>Where an action happens the context of a higher level business
  function, the log entry points to a parent activity for the context.
  The relationships are hierarchical. For example, a synchronization operation
  could result from scheduled reconciliation for an object type. OpenIDM also
  logs the top level root activity with each entry, making it possible to
  query related activities.</p></div><div class="section" title="12.2.&nbsp;Audit Log File Formats"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="audit-log-format"></a>12.2.&nbsp;Audit Log File Formats</h2></div></div></div><p>This section describes the audit log file formats to help you map
  these to the reports you generate.</p><div class="variablelist" title="Access Log Fields"><a name="audit-access-fields"></a><div class="variablelist-title">Access Log Fields</div><p>Access messages are split into the following fields.</p><dl><dt><span class="term"><code class="literal">"_id"</code></span></dt><dd><p>UUID for the message object, such as
     <code class="literal">"0419d364-1b3d-4e4f-b769-555c3ca098b0"</code></p></dd><dt><span class="term"><code class="literal">"action"</code></span></dt><dd><p>Action requested, such as <code class="literal">"authenticate"</code></p></dd><dt><span class="term"><code class="literal">"ip"</code></span></dt><dd><p>IP address of the client. For access from the local host, this
     can appear for example as <code class="literal">"0:0:0:0:0:0:0:1%0"</code>.</p></dd><dt><span class="term"><code class="literal">"principal"</code></span></dt><dd><p>Principal requesting the operation, such as
     <code class="literal">"openidm-admin"</code></p></dd><dt><span class="term"><code class="literal">"roles"</code></span></dt><dd><p>Roles associated with the principal, such as
     <code class="literal">"[openidm-admin, openidm-authorized]"</code></p></dd><dt><span class="term"><code class="literal">"status"</code></span></dt><dd><p>Result of the operation, such as <code class="literal">"SUCCESS"</code></p></dd><dt><span class="term"><code class="literal">"timestamp"</code></span></dt><dd><p>Time when OpenIDM logged the message, such as
     <code class="literal">"2012-01-10T10:45:42"</code></p></dd></dl></div><div class="variablelist" title="Activity Log Fields"><a name="audit-activity-fields"></a><div class="variablelist-title">Activity Log Fields</div><p>Activity messages are split into the following fields.</p><dl><dt><span class="term"><code class="literal">"_id"</code></span></dt><dd><p>UUID for the message object, such as
     <code class="literal">"0419d364-1b3d-4e4f-b769-555c3ca098b0"</code></p></dd><dt><span class="term"><code class="literal">"action"</code></span></dt><dd><p>Action performed, such as <code class="literal">"create"</code>. See
     the section on <a href="../integrators-guide/index.html#audit-eventtypes" class="link"><em class="citetitle">Event
     Types</em></a> for a list.</p></dd><dt><span class="term"><code class="literal">"activityId"</code></span></dt><dd><p>UUID for the activity corresponding to the UUID of the resource
     context</p></dd><dt><span class="term"><code class="literal">"after"</code></span></dt><dd><p>JSON representation of the object resulting from the activity</p></dd><dt><span class="term"><code class="literal">"before"</code></span></dt><dd><p>JSON representation of the object prior to the activity</p></dd><dt><span class="term"><code class="literal">"message"</code></span></dt><dd><p>Human readable text about the activity</p></dd><dt><span class="term"><code class="literal">"objectId"</code></span></dt><dd><p>Object identifier such as
     <code class="literal">"managed/user/DDOE1"</code></p></dd><dt><span class="term"><code class="literal">"parentActionId"</code></span></dt><dd><p>UUID of the action leading to the activity</p></dd><dt><span class="term"><code class="literal">"requester"</code></span></dt><dd><p>Principal requesting the operation</p></dd><dt><span class="term"><code class="literal">"rev"</code></span></dt><dd><p>Object revision number</p></dd><dt><span class="term"><code class="literal">"rootActionId"</code></span></dt><dd><p>UUID of the root cause for the activity. This matches a
     corresponding <code class="literal">"rootActionId"</code> in a reconciliation
     message.</p></dd><dt><span class="term"><code class="literal">"status"</code></span></dt><dd><p>Result of the operation, such as <code class="literal">"SUCCESS"</code></p></dd><dt><span class="term"><code class="literal">"timestamp"</code></span></dt><dd><p>Time when OpenIDM logged the message, such as
     <code class="literal">"2012-01-10T10:45:42"</code></p></dd></dl></div><div class="variablelist" title="Reconciliation Log Fields"><a name="audit-recon-fields"></a><div class="variablelist-title">Reconciliation Log Fields</div><p>Reconciliation messages are split into the following fields.</p><dl><dt><span class="term"><code class="literal">"_id"</code></span></dt><dd><p>UUID for the message object, such as
     <code class="literal">"0419d364-1b3d-4e4f-b769-555c3ca098b0"</code></p></dd><dt><span class="term"><code class="literal">"action"</code></span></dt><dd><p>Synchronization action, such as <code class="literal">"CREATE"</code>. See
     the section on <a href="../integrators-guide/index.html#sync-actions" class="link"><em class="citetitle">Actions</em></a> for a list.</p></dd><dt><span class="term"><code class="literal">"ambiguousTargetObjectIds"</code></span></dt><dd><p>When the situation is AMBIGUOUS or UNQUALIFIED and OpenIDM cannot
     distinguish between more than one target object, OpenIDM logs the
     identifiers of the objects in this field in comma-separated format. This
     makes it possible to figure out what was ambiguous afterwards.</p></dd><dt><span class="term"><code class="literal">"entryType"</code></span></dt><dd><p>Kind of reconciliation log entry, such as <code class="literal">"start"</code>,
     or <code class="literal">"summary"</code>.</p></dd><dt><span class="term"><code class="literal">"message"</code></span></dt><dd><p>Human readable text about the reconciliation action</p></dd><dt><span class="term"><code class="literal">"reconciling"</code></span></dt><dd><p>What OpenIDM is reconciling, 
     <code class="literal">"source"</code> for the first phase, <code class="literal">"target"</code> for the second phase</p></dd><dt><span class="term"><code class="literal">"reconId"</code></span></dt><dd><p>UUID for the reconciliation operation, which is the same for all
     entries pertaining to the reconciliation run</p></dd><dt><span class="term"><code class="literal">"rootActionId"</code></span></dt><dd><p>UUID of the root cause for the activity. This matches a
     corresponding <code class="literal">"rootActionId"</code> in an activity
     message.</p></dd><dt><span class="term"><code class="literal">"situation"</code></span></dt><dd><p>The situation encountered. See
     the section describing <a href="../integrators-guide/index.html#sync-situations" class="link">sychronization
     situations</a> for a list.</p></dd><dt><span class="term"><code class="literal">"sourceObjectId"</code></span></dt><dd><p>UUID for the source object.</p></dd><dt><span class="term"><code class="literal">"status"</code></span></dt><dd><p>Result of the operation, such as <code class="literal">"SUCCESS"</code></p></dd><dt><span class="term"><code class="literal">"targetObjectId"</code></span></dt><dd><p>UUID for the target object</p></dd><dt><span class="term"><code class="literal">"timestamp"</code></span></dt><dd><p>Time when OpenIDM logged the message, such as
     <code class="literal">"2012-01-10T10:45:42"</code>.</p></dd></dl></div></div><div class="section" title="12.3.&nbsp;Audit Configuration"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="audit-configuration"></a>12.3.&nbsp;Audit Configuration</h2></div></div></div><p>OpenIDM exposes the audit logging configuration under
  <code class="literal">http://<em class="replaceable"><code>host</code></em>:<em class="replaceable"><code>port</code></em>/openidm/config/audit</code>
  for the REST API, and in the file <code class="filename">conf/audit.json</code> where
  you installed OpenIDM. The default <code class="filename">conf/audit.json</code> file
  contains the following object.</p><div class="programlisting">
{
    <strong class="hl-string"><em style="color: #f58220">"eventTypes"</em></strong>: {
        <strong class="hl-string"><em style="color: #f58220">"activity"</em></strong>: {
            <strong class="hl-string"><em style="color: #f58220">"filter"</em></strong>: {
                <strong class="hl-string"><em style="color: #f58220">"actions"</em></strong>: [
                    <strong class="hl-string"><em style="color: #f58220">"create"</em></strong>,
                    <strong class="hl-string"><em style="color: #f58220">"update"</em></strong>,
                    <strong class="hl-string"><em style="color: #f58220">"delete"</em></strong>,
                    <strong class="hl-string"><em style="color: #f58220">"patch"</em></strong>,
                    <strong class="hl-string"><em style="color: #f58220">"action"</em></strong>
                ]
            }
        },
        <strong class="hl-string"><em style="color: #f58220">"recon"</em></strong>: {}
    },
    <strong class="hl-string"><em style="color: #f58220">"logTo"</em></strong>: [
        {
            <strong class="hl-string"><em style="color: #f58220">"logType"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"csv"</em></strong>,
            <strong class="hl-string"><em style="color: #f58220">"location"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"audit"</em></strong>,
            <strong class="hl-string"><em style="color: #f58220">"recordDelimiter"</em></strong>: <strong class="hl-string"><em style="color: #f58220">";"</em></strong>
        },
        {
            <strong class="hl-string"><em style="color: #f58220">"logType"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"repository"</em></strong>
        }
    ]
}</div><div class="section" title="12.3.1.&nbsp;Event Types"><div class="titlepage"><div><div><h3 class="title"><a name="audit-eventtypes"></a>12.3.1.&nbsp;Event Types</h3></div></div></div><p>The <code class="literal">eventTypes</code> configuration specifies what events
   OpenIDM writes to audit logs. OpenIDM supports two
   <code class="literal">eventTypes</code>: <code class="literal">activity</code> for the activity
   log, and <code class="literal">recon</code> for the reconciliation log. The filter
   for actions under activity logging shows the actions on managed or system
   objects for which OpenIDM writes to the activity log.</p><div class="variablelist"><p>The <code class="literal">filter</code> <code class="literal">actions</code> list lets
    you configure under what conditions OpenIDM writes to the activity
    log.</p><dl><dt><span class="term"><code class="literal">read</code></span></dt><dd><p>When an object is read by using its identifier</p></dd><dt><span class="term"><code class="literal">create</code></span></dt><dd><p>When an object is created.</p></dd><dt><span class="term"><code class="literal">update</code></span></dt><dd><p>When an object is updated.</p></dd><dt><span class="term"><code class="literal">delete</code></span></dt><dd><p>When an object is deleted.</p></dd><dt><span class="term"><code class="literal">patch</code></span></dt><dd><p>When an object is partially modified.</p></dd><dt><span class="term"><code class="literal">query</code></span></dt><dd><p>When a query is performed on an object.</p></dd><dt><span class="term"><code class="literal">action</code></span></dt><dd><p>When an action is performed on an object.</p></dd></dl></div><div class="variablelist"><p>The <code class="literal">logTo</code> list lets you define where OpenIDM
    writes the log.</p><dl><dt><span class="term"><code class="literal">csv</code></span></dt><dd><p>Write to a comma-separated variable format file in the location
      specified relative to the directory where you installed OpenIDM.</p><p>Audit file names are fixed, <code class="filename">access.csv</code>,
      <code class="filename">activity.csv</code>, and
      <code class="filename">recon.csv</code>.</p></dd><dt><span class="term"><code class="literal">repository</code></span></dt><dd><p>Write to the OpenIDM database repository.</p><p>OpenIDM stores entries under the
      <code class="literal">/openidm/repo/audit/</code> context, such entries appear as
      <code class="literal">audit/access/<em class="replaceable"><code>_id</code></em></code>,
      <code class="literal">audit/activity/<em class="replaceable"><code>_id</code></em></code>, and
      <code class="literal">audit/recon/<em class="replaceable"><code>_id</code></em></code>, where
      the <em class="replaceable"><code>_id</code></em> is the UUID of the entry such as
      <code class="literal">0419d364-1b3d-4e4f-b769-555c3ca098b0</code>.</p><p>In the OrientDB repository, OpenIDM stores records in
      <code class="literal">audit_activity</code>, <code class="literal">audit_activity</code>,
      and <code class="literal">audit_recon</code> tables.</p><p>In a JDBC repository, OpenIDM stores records in
      <code class="literal">auditaccess</code>, <code class="literal">auditactivity</code>, and
      <code class="literal">auditrecon</code> tables.</p></dd></dl></div></div></div><div class="section" title="12.4.&nbsp;Generating Reports"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="audit-reports"></a>12.4.&nbsp;Generating Reports</h2></div></div></div><p>When generating reports from audit logs, you can correlate information
  from activity and reconciliation logs by matching the
  <code class="literal">"rootActionId"</code> on entries in both logs.</p><p>The following MySQL query shows a join of the audit activity and
  audit reconciliation tables using root action ID values.</p><div class="screen" width="95">
mysql&gt; select distinct auditrecon.activity,auditrecon.sourceobjectid,
 auditrecon.targetobjectid,auditactivity.activitydate,auditrecon.status
 from auditactivity inner join auditrecon
 <span class="strong"><strong>auditactivity.rootactionid=auditrecon.rootactionid</strong></span>
 where auditrecon.activity is not null group by auditrecon.sourceobjectid;
+----------+--------------------------+----------------------+---------------------+---------+
| activity | sourceobjectid           | targetobjectid       | activitydate        | status  |
+----------+--------------------------+----------------------+---------------------+---------+
| CREATE   | system/xmlfile/account/1 | managed/user/juser   | 2012-01-17T07:59:12 | SUCCESS |
| CREATE   | system/xmlfile/account/2 | managed/user/ajensen | 2012-01-17T07:59:12 | SUCCESS |
| CREATE   | system/xmlfile/account/3 | managed/user/bjensen | 2012-01-17T07:59:12 | SUCCESS |
+----------+--------------------------+----------------------+---------------------+---------+
3 rows in set (0.00 sec)</div></div></div><div lang="en" class="chapter" title="Chapter&nbsp;13.&nbsp;Sending Email"><div class="titlepage"><div><div><h2 class="title"><a name="chap-mail"></a>Chapter&nbsp;13.&nbsp;Sending Email</h2></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl><dt><span class="section"><a href="#send-mail-rest">13.1. Sending Mail Over REST</a></span></dt><dt><span class="section"><a href="#send-mail-script">13.2. Sending Mail From a Script</a></span></dt></dl></div><a class="indexterm" name="d160e5431"></a><a class="indexterm" name="d160e5436"></a><p>This chapter shows you how to configure the outbound email service, so
 that you can send email through OpenIDM either by script or through the REST
 API.</p><div class="procedure" title="Procedure&nbsp;13.1.&nbsp;To Set Up Outbound Email"><a name="setup-outbound-email"></a><div class="procedure-title">Procedure&nbsp;13.1.&nbsp;To Set Up Outbound Email</div><p>The outbound email service relies on a configuration object to identify
  the email account used to send messages.</p><ol class="procedure" type="1"><li class="step" title="Step 1"><p>Shut down OpenIDM.</p></li><li class="step" title="Step 2"><p>Copy the sample configuration to
   <code class="filename">openidm/conf</code>.</p><div class="screen">$ cd /path/to/openidm/
$ cp samples/misc/external.email.json conf/</div></li><li class="step" title="Step 3"><p>Edit <code class="filename">external.email.json</code> to reflect the
   account used to send messages.</p><div class="programlisting">
{
        <strong class="hl-string"><em style="color: #f58220">"host"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"smtp.example.com"</em></strong>,
        <strong class="hl-string"><em style="color: #f58220">"port"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"25"</em></strong>,
        <strong class="hl-string"><em style="color: #f58220">"username"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"openidm"</em></strong>,
        <strong class="hl-string"><em style="color: #f58220">"password"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"secret12"</em></strong>,
        <strong class="hl-string"><em style="color: #f58220">"mail.smtp.auth"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"true"</em></strong>,
        <strong class="hl-string"><em style="color: #f58220">"mail.smtp.starttls.enable"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"true"</em></strong>
}</div><p>OpenIDM encrypts the password you provide.</p><div class="variablelist"><p>Follow these hints when editing the configuration.</p><dl><dt><span class="term"><code class="literal">"host"</code></span></dt><dd><p>SMTP server host name or IP address. This can be
      <code class="literal">"localhost"</code> if the server is on the same system as
      OpenIDM.</p></dd><dt><span class="term"><code class="literal">"port"</code></span></dt><dd><p>SMTP server port number such as 25, or 587</p></dd><dt><span class="term"><code class="literal">"username"</code></span></dt><dd><p>Mail account user name needed when <code class="literal">"mail.smtp.auth" :
      "true"</code></p></dd><dt><span class="term"><code class="literal">"password"</code></span></dt><dd><p>Mail account user password needed when <code class="literal">"mail.smtp.auth" :
      "true"</code></p></dd><dt><span class="term"><code class="literal">"mail.smtp.auth"</code></span></dt><dd><p>If <code class="literal">"true"</code>, use SMTP authentication</p></dd><dt><span class="term"><code class="literal">"mail.smtp.starttls.enable"</code></span></dt><dd><p>If <code class="literal">"true"</code>, use TLS</p></dd><dt><span class="term"><code class="literal">"from"</code></span></dt><dd><p>Optional default <code class="literal">From:</code> address</p></dd></dl></div></li><li class="step" title="Step 4"><p>Start up OpenIDM.</p></li><li class="step" title="Step 5"><p>Check that the email service is active.</p><div class="screen">-&gt; scr list
...
[   6] [active       ] org.forgerock.openidm.external.email
...</div></li></ol></div><div class="section" title="13.1.&nbsp;Sending Mail Over REST"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="send-mail-rest"></a>13.1.&nbsp;Sending Mail Over REST</h2></div></div></div><p>Although you are more likely to send mail from a script in production,
  you can send email using the REST API by sending an HTTP POST to
  <code class="literal">/openam/external/email</code> in order to test that your
  configuration works. You pass the message parameters as POST parameters,
  URL encoding the content as necessary.</p><p>The following example sends a test email using the REST API.</p><div class="screen">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 --request POST
 "http://localhost:8080/openidm/external/email?
 _from=openidm@example.com&amp;_to=admin@example.com&amp;
 _subject=Test&amp;_body=Test"</div></div><div class="section" title="13.2.&nbsp;Sending Mail From a Script"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="send-mail-script"></a>13.2.&nbsp;Sending Mail From a Script</h2></div></div></div><p>You can send email from using the resource API <a href="../integrators-guide/index.html#function-ref" class="link">functions</a> with
  the <code class="literal">external/email</code> context, as in the following
  example, where <code class="literal">params</code> is an object containing the
  POST parameters.</p><div class="programlisting">
<strong class="hl-keyword">var</strong> params =  <strong class="hl-keyword">new</strong> <strong class="hl-keyword">Object</strong>();
params._from = <strong class="hl-string"><em style="color: #f58220">"openidm@example.com"</em></strong>;
params._to = <strong class="hl-string"><em style="color: #f58220">"admin@example.com"</em></strong>;
params._cc = <strong class="hl-string"><em style="color: #f58220">"wally@example.com,dilbert@example.com"</em></strong>;
params._subject = <strong class="hl-string"><em style="color: #f58220">"OpenIDM recon report"</em></strong>;
params._type = <strong class="hl-string"><em style="color: #f58220">"text/html"</em></strong>;
params._body = <strong class="hl-string"><em style="color: #f58220">"&lt;html&gt;&lt;body&gt;&lt;p&gt;Recon report follows...&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;"</em></strong>;

openidm.action(<strong class="hl-string"><em style="color: #f58220">"external/email"</em></strong>, params);</div><div class="variablelist"><p>OpenIDM supports the following POST parameters.</p><dl><dt><span class="term"><code class="literal">_from</code></span></dt><dd><p>Sender mail address</p></dd><dt><span class="term"><code class="literal">_to</code></span></dt><dd><p>Comma-separated list of recipient mail addresses</p></dd><dt><span class="term"><code class="literal">_cc</code></span></dt><dd><p>Optional comma-separated list of copy recipient mail addresses</p></dd><dt><span class="term"><code class="literal">_bcc</code></span></dt><dd><p>Optional comma-separated list of blind copy recipient mail
     addresses</p></dd><dt><span class="term"><code class="literal">_subject</code></span></dt><dd><p>Email subject</p></dd><dt><span class="term"><code class="literal">_body</code></span></dt><dd><p>Email body text</p></dd><dt><span class="term"><code class="literal">_type</code></span></dt><dd><p>Optional MIME type. One of <code class="literal">"text/plain"</code>,
     <code class="literal">"text/html"</code>, or <code class="literal">"text/xml"</code>.</p></dd></dl></div></div></div><div lang="en" class="chapter" title="Chapter&nbsp;14.&nbsp;OpenIDM Project Best Practices"><div class="titlepage"><div><div><h2 class="title"><a name="chap-best-practices"></a>Chapter&nbsp;14.&nbsp;OpenIDM Project Best Practices</h2></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl><dt><span class="section"><a href="#immplementation-phase">14.1. Implementation Phases</a></span></dt></dl></div><a class="indexterm" name="d160e5636"></a><p>This chapter lists points to check when implementing an identity
 management solution with OpenIDM.</p><div class="section" title="14.1.&nbsp;Implementation Phases"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="immplementation-phase"></a>14.1.&nbsp;Implementation Phases</h2></div></div></div><p>Any identity management project should follow a set of well defined
  phases, where each phase defines discrete deliverables. The phases take
  the project from initiation to finally going live with a tested
  solution.</p><div class="section" title="14.1.1.&nbsp;Initiation"><div class="titlepage"><div><div><h3 class="title"><a name="d160e5646"></a>14.1.1.&nbsp;Initiation</h3></div></div></div><p>The project's initiation phase involves identifying and gathering
   project background, requirements, and goals at a high level. The deliverable
   for this phase is a statement of work or a mission statement.</p></div><div class="section" title="14.1.2.&nbsp;Definition"><div class="titlepage"><div><div><h3 class="title"><a name="d160e5651"></a>14.1.2.&nbsp;Definition</h3></div></div></div><p>In the definition phase, you gather more detailed information on
   existing systems, determine how to integrate, describe account schemas,
   procedures, and other information relevant to the OpenIDM deployment.
   The deliverable for this phase is one or more documents that define
   detailed requirements for the project, and that cover project definition,
   the business case, use cases to solve, and functional specifications.</p><div class="variablelist"><p>The definition phase should capture at least the following.</p><dl><dt><span class="term">User Administration and Management</span></dt><dd><p>Procedures for managing users and accounts, who manages users,
      what processes look like for joiners, movers and leavers, and what is
      required of OpenIDM to manage users</p></dd><dt><span class="term">Password Management and Password Synchronization</span></dt><dd><p>Procedures for managing account passwords, password policies,
      who manages passwords, and what is required of OpenIDM to manage
      passwords</p></dd><dt><span class="term">Security Policy</span></dt><dd><p>What security policies defines for users, accounts, passwords, and
      access control</p></dd><dt><span class="term">Target Systems</span></dt><dd><p>Target systems and resources with which OpenIDM must integrate.
      Information such as schema, attribute mappings and attribute
      transformation flow, credentials and other integration specific
      information.</p></dd><dt><span class="term">Entitlement Management</span></dt><dd><p>Procedures to manage user access to resources, individual
      entitlements, grouping provisioning activities into encapsulated
      concepts such as roles and groups</p></dd><dt><span class="term">Synchronization and Data Flow</span></dt><dd><p>Detailed outlines showing how identity information flows from
      authoritative sources to target systems, attribute transformations
      required</p></dd><dt><span class="term">Interfaces</span></dt><dd><p>How to secure the REST, user and file-based interfaces, and to
      secure the communication protocols involved</p></dd><dt><span class="term">Auditing and Reporting</span></dt><dd><p>Procedures for auditing and reporting, including who takes
      responsibility for auditing and reporting, and what information is
      aggregated and reported. Characteristics of reporting engines provided,
      or definition of the reporting engine to be integrated.</p></dd><dt><span class="term">Technical Requirements</span></dt><dd><p>Other technical requirements for the solution such as how to
      maintain the solution in terms of monitoring, patch management,
      availability, backup, restore and recovery process. This includes any
      other components leveraged such as a ConnectorServer and plug-ins for
      password synchronization on Active Directory, or OpenDJ.</p></dd></dl></div></div><div class="section" title="14.1.3.&nbsp;Design"><div class="titlepage"><div><div><h3 class="title"><a name="d160e5713"></a>14.1.3.&nbsp;Design</h3></div></div></div><p>This phase focuses on solution design including on OpenIDM and other
   components. The deliverables for this phase are the architecture and design
   documents, and also success criteria with detailed descriptions and test
   cases to verify when project goals have been met.</p></div><div class="section" title="14.1.4.&nbsp;Build"><div class="titlepage"><div><div><h3 class="title"><a name="d160e5718"></a>14.1.4.&nbsp;Build</h3></div></div></div><p>This phase builds and tests the solution prior to moving the solution
   into production.</p></div><div class="section" title="14.1.5.&nbsp;Production"><div class="titlepage"><div><div><h3 class="title"><a name="d160e5723"></a>14.1.5.&nbsp;Production</h3></div></div></div><p>This phase deploys the solution into production until an
   application steady state is reached and maintenance routines and procedures
   can be applied.</p></div></div></div><div lang="en" class="chapter" title="Chapter&nbsp;15.&nbsp;Troubleshooting"><div class="titlepage"><div><div><h2 class="title"><a name="chap-troubleshooting"></a>Chapter&nbsp;15.&nbsp;Troubleshooting</h2></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl><dt><span class="section"><a href="#stops-when-backgrounded">15.1. OpenIDM Stopped in Background</a></span></dt><dt><span class="section"><a href="#internal-recon-sync-errors">15.2. Internal Server Error During Reconciliation or Synchronization</a></span></dt><dt><span class="section"><a href="#sync-service-unsatisfied">15.3. The scr list Command Shows Sync Service As Unsatisfied</a></span></dt><dt><span class="section"><a href="#json-parse-error">15.4. JSON Parsing Error</a></span></dt><dt><span class="section"><a href="#system-not-available">15.5. System Not Available</a></span></dt><dt><span class="section"><a href="#bad-connector-host-reference">15.6. Bad Connector Host Reference in Provisioner Configuration</a></span></dt><dt><span class="section"><a href="#missing-name-attribute">15.7. Missing Name Attribute</a></span></dt></dl></div><a class="indexterm" name="d160e5732"></a><p>When things are not working check this chapter for tips and answers.</p><div class="section" title="15.1.&nbsp;OpenIDM Stopped in Background"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="stops-when-backgrounded"></a>15.1.&nbsp;OpenIDM Stopped in Background</h2></div></div></div><p>When you start OpenIDM in the background without having disabled the
  text console, the job can stop immediately after startup.</p><div class="screen">$ ./startup.sh &amp;
[2] 346
$ ./startup.sh
Using OPENIDM_HOME:   /path/to/openidm
Using OPENIDM_OPTS:   -Xmx1024m
Using LOGGING_CONFIG:
 -Djava.util.logging.config.file=/path/to/openidm/conf/logging.properties
Using boot properties at /path/to/openidm/conf/boot/boot.properties
-&gt; 

[2]+  Stopped                 ./startup.sh</div><p>To resolve this problem, make sure you remove
  <code class="filename">openidm/bundle/org.apache.felix.shell.tui-1.4.1.jar</code>
  before starting OpenIDM, and also remove Felix cache files in
  <code class="filename">openidm/felix-cache/</code>.</p></div><div class="section" title="15.2.&nbsp;Internal Server Error During Reconciliation or Synchronization"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="internal-recon-sync-errors"></a>15.2.&nbsp;Internal Server Error During Reconciliation or Synchronization</h2></div></div></div><p>You might see an error message such as the following returned from
  reconciliation or synchronization.</p><div class="programlisting">
{
    <strong class="hl-string"><em style="color: #f58220">"error"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"Conflict"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"description"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"Internal Server Error:
</em></strong>        org.forgerock.openidm.sync.SynchronizationException:
        Cowardly refusing to perform reconciliation <strong class="hl-keyword">with</strong> an
        empty source object set: Cowardly refusing to perform
        reconciliation <strong class="hl-keyword">with</strong> an empty source object set<strong class="hl-string"><em style="color: #f58220">"
</em></strong>}</div><p>This error can be misleading. This usually means the connector is
  not able to communicate with the target source.</p><p>Check the settings for your connector. For example, with the XML
  connector you get this error if the filename for the source is invalid. With
  the LDAP connector, you can get this error if your connector cannot contact
  the target LDAP server.</p></div><div class="section" title="15.3.&nbsp;The scr list Command Shows Sync Service As Unsatisfied"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sync-service-unsatisfied"></a>15.3.&nbsp;The scr list Command Shows Sync Service As Unsatisfied</h2></div></div></div><p>You might encounter this message in the logs.</p><div class="programlisting">
WARNING: Loading configuration file /path/to/openidm/conf/sync.json failed
org.forgerock.openidm.config.InvalidException:
 Configuration for org.forgerock.openidm.sync could not be parsed and may not
     be valid JSON : Unexpected character ('}' (code 125)): expected a value
     at [Source: java.io.StringReader@3951f910; line: 24, column: 6]
 at org.forgerock.openidm.config.crypto.ConfigCrypto.parse...
 at org.forgerock.openidm.config.crypto.ConfigCrypto.encrypt...
 at org.forgerock.openidm.config.installer.JSONConfigInstaller.setConfig...</div><p>This indicates a syntax error in
  <code class="filename">openidm/conf/sync.json</code>. After fixing your configuration,
  change to the <code class="filename">/path/to/openidm/</code> directory, and use the
  <span class="command"><strong>cli.sh validate</strong></span> command to check that your configuration
  files are valid.</p><div class="screen">$ cd /path/to/openidm ; ./cli.sh validate
Using boot properties at /path/to/openidm/conf/boot/boot.properties
...................................................................
[Validating] Load JSON configuration files from:
[Validating]  /path/to/openidm/conf
[Validating] audit.json .................................. SUCCESS
[Validating] authentication.json ......................... SUCCESS
[Validating] managed.json ................................ SUCCESS
[Validating] provisioner.openicf-xml.json ................ SUCCESS
[Validating] repo.orientdb.json .......................... SUCCESS
[Validating] router.json ................................. SUCCESS
[Validating] scheduler-reconcile_systemXmlAccounts_managedUser.json  SUCCESS
[Validating] sync.json ................................... SUCCESS</div></div><div class="section" title="15.4.&nbsp;JSON Parsing Error"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="json-parse-error"></a>15.4.&nbsp;JSON Parsing Error</h2></div></div></div><p>You might encounter this error message in the logs.</p><div class="programlisting">
"Configuration for org.forgerock.openidm.provisioner.openicf could not be
 parsed and may not be valid JSON : Unexpected character ('}' (code 125)): 
 was expecting double-quote to start field name"</div><p>The error message usually points precisely to the point where the
  JSON file has the syntax problem. The error above was caused by a excess
  comma in the JSON file, <code class="literal">{"attributeName":{},{},}</code>. The
  second comma is too much.</p><p>The situation usually results in the service the JSON file configures
  being left in the <code class="literal">unsatisfied</code> state.</p><p>After fixing your configuration, change to the
  <code class="filename">/path/to/openidm/</code> directory, and use the <span class="command"><strong>cli.sh
  validate</strong></span> command to check that your configuration files are
  valid.</p></div><div class="section" title="15.5.&nbsp;System Not Available"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="system-not-available"></a>15.5.&nbsp;System Not Available</h2></div></div></div><p>OpenIDM throws the following error as a result of a reconciliation
  where the source systems configuration can not be found.</p><div class="programlisting">
{
    <strong class="hl-string"><em style="color: #f58220">"error"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"Conflict"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"description"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"Internal Server Error:
</em></strong>        org.forgerock.openidm.sync.SynchronizationException:
        org.forgerock.openidm.objset.ObjectSetException:
        System: system/HR/account is not available.:
        org.forgerock.openidm.objset.ObjectSetException:
        System: system/HR/account is not available.:
        System: system/HR/account is not available.<strong class="hl-string"><em style="color: #f58220">"
</em></strong>}</div><p>This error occurs when the <code class="literal">"name"</code> property value
  in <code class="filename">provisioner.<em class="replaceable"><code>resource</code></em>.json</code>
  is changed from <code class="literal">HR</code> to something else.</p><p> The same error also occurs when a provisioner configuration fails to
  load due to misconfiguration, or when the path to the data file for a
  CSV or XML connector is incorrectly set.</p></div><div class="section" title="15.6.&nbsp;Bad Connector Host Reference in Provisioner Configuration"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="bad-connector-host-reference"></a>15.6.&nbsp;Bad Connector Host Reference in Provisioner Configuration</h2></div></div></div><p>You might see the following error when a provision configuration
  loads.</p><div class="programlisting">
Wait for meta data for config org.forgerock.openidm.provisioner.openicf-scriptedsql</div><p>In this case the configuration fails to load because some information
  is missing. One possible cause is a wrong value for
  <code class="literal">connectorHostRef</code> in the provisioner configuration
  file.</p><div class="itemizedlist"><p>For local Java connector servers, the following rules apply.</p><ul class="itemizedlist" type="disc"><li class="listitem"><p>If the connector .jar is installed as a bundle under
    <code class="filename">openidm/bundle</code>, then the value must be
    <code class="literal">"connectorHostRef" :
    "osgi:service/org.forgerock.openicf.framework.api.osgi.ConnectorManager",</code>.</p></li><li class="listitem"><p>If the connector .jar is installed as a connector under
    <code class="filename">openidm/connectors</code>, then the value must be 
    <code class="literal">"connectorHostRef" : "#LOCAL",</code>.</p><pre class="literallayout"></pre></li></ul></div></div><div class="section" title="15.7.&nbsp;Missing Name Attribute"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="missing-name-attribute"></a>15.7.&nbsp;Missing Name Attribute</h2></div></div></div><p>In this case, the situation in the audit recon log shows "NULL".</p><p>A missing name attribute error, followed by an
  <code class="literal">IllegalArgumentException</code>, points to misconfiguration of
  the correlation rule, with the correlation query pointing to the external
  system. Such queries usually reference the "name" field which, if empty,
  leads to the error below.</p><div class="programlisting">
Jan 20, 2012 1:59:58 PM
 org.forgerock.openidm.provisioner.openicf.commons.AttributeInfoHelper build
SEVERE: Failed to build name attribute out of [null]
Jan 20, 2012 1:59:58 PM
 org.forgerock.openidm.provisioner.openicf.impl.OpenICFProvisionerService query
SEVERE: Operation [query, system/ad/account] failed with Exception on system
 object: java.lang.IllegalArgumentException: Attribute value must be an
 instance of String.
Jan 20, 2012 1:59:58 PM org.forgerock.openidm.router.JsonResourceRouterService
 handle
WARNING: JSON resource exception
org.forgerock.json.resource.JsonResourceException: IllegalArgumentException
 at org.forgerock.openidm.provisioner....OpenICFProvisionerService.query...
 at org.forgerock.openidm.provisioner.....OpenICFProvisionerService.handle...
 at org.forgerock.openidm.provisioner.impl.SystemObjectSetService.handle...
 at org.forgerock.json.resource.JsonResourceRouter.handle...</div><p>Check your <code class="literal">correlationQuery</code>. Another symptom of a
  broken correlationQuery is that the audit recon log shows a situation
  of "NULL", and no onCreate, onUpdate or similar scripts are executed.</p></div></div><div lang="en" class="appendix" title="Appendix&nbsp;A.&nbsp;File Layout"><div class="titlepage"><div><div><h2 class="title"><a name="appendix-file-layout"></a>Appendix&nbsp;A.&nbsp;File Layout</h2></div></div></div><a class="indexterm" name="d160e5886"></a><a class="indexterm" name="d160e5889"></a><div class="variablelist"><p>When you unpack and start OpenIDM 2.0.3, you
  create the following files and directories.</p><dl><dt><span class="term"><code class="filename">openidm/audit/</code></span></dt><dd><p>OpenIDM audit log directory default location, created at run
    time as configured in <code class="filename">openidm/conf/audit.json</code></p></dd><dt><span class="term"><code class="filename">openidm/audit/access.csv</code></span></dt><dd><p>Default OpenIDM access audit log</p></dd><dt><span class="term"><code class="filename">openidm/audit/activity.csv</code></span></dt><dd><p>Default OpenIDM activity audit log</p></dd><dt><span class="term"><code class="filename">openidm/audit/recon.csv</code></span></dt><dd><p>Default OpenIDM reconciliation audit log</p></dd><dt><span class="term"><code class="filename">openidm/bin/</code></span></dt><dd><p>OpenIDM core libraries</p></dd><dt><span class="term"><code class="filename">openidm/bundle/</code></span></dt><dd><p>OSGi bundles and modules required by OpenIDM. Upgrade can install
    new and upgraded bundles here.</p></dd><dt><span class="term"><code class="filename">openidm/bundle/json-crypto-cli-1.1.0.jar</code></span></dt><dd><p>Utility to encrypt and decrypt values in JSON objects</p></dd><dt><span class="term"><code class="filename">openidm/cli.sh</code></span></dt><dd><p>Management commands for operations such as validating configuration
    files</p></dd><dt><span class="term"><code class="filename">openidm/conf/</code></span></dt><dd><p>OpenIDM configuration files, including .properties files and JSON
    views. You can also access JSON views through the REST interface.</p></dd><dt><span class="term"><code class="filename">openidm/conf/audit.json</code></span></dt><dd><p>Audit event publisher configuration view</p></dd><dt><span class="term"><code class="filename">openidm/conf/authentication.json</code></span></dt><dd><p>Authentication configuration view for access to the REST API</p></dd><dt><span class="term"><code class="filename">openidm/conf/boot/boot.properties</code></span></dt><dd><p>OpenIDM bootstrap properties</p></dd><dt><span class="term"><code class="filename">openidm/conf/config.properties</code></span></dt><dd><p>Felix and OSGi bundle configuration properties</p></dd><dt><span class="term"><code class="filename">openidm/conf/jetty.xml</code></span></dt><dd><p>Jetty configuration controlling access to the REST interface</p></dd><dt><span class="term"><code class="filename">openidm/conf/logging-config.xml</code></span></dt><dd><p>Experimental log configuration</p></dd><dt><span class="term"><code class="filename">openidm/conf/logging.properties</code></span></dt><dd><p>OpenIDM log configuration properties</p></dd><dt><span class="term"><code class="filename">openidm/conf/managed.json</code></span></dt><dd><p>Managed object configuration view</p></dd><dt><span class="term"><code class="filename">openidm/conf/provisioner.openicf-xml.json</code></span></dt><dd><p>Sample XML connector configuration view. After evaluation,
    replace this with your own connector configurations.</p><p>Each connector instance has a corresponding
    <code class="filename">provisioner.openicf-<em class="replaceable"><code>name</code></em>.json</code> configuration file. Each file
    specifies connector configuration details such as network information,
    credentials, attribute schema, and which OpenICF features are
    supported.</p></dd><dt><span class="term"><code class="filename">openidm/conf/repo.orientdb.json</code></span></dt><dd><p>OrientDB internal repository configuration view</p></dd><dt><span class="term"><code class="filename">openidm/conf/router.json</code></span></dt><dd><p>Router service configuration view</p></dd><dt><span class="term"><code class="filename">openidm/conf/scheduler-reconcile_systemXmlAccounts_managedUser.json</code></span></dt><dd><p>Sample XML scheduler configuration view. After evaluation,
    replace this with your own configurations.</p></dd><dt><span class="term"><code class="filename">openidm/conf/sync.json</code></span></dt><dd><p>Sample XML synchronization configuration view. After evaluation,
    replace this with your configuration to describe all mappings used by
    OpenIDM for synchronization and reconciliation.</p></dd><dt><span class="term"><code class="filename">openidm/conf/system.properties</code></span></dt><dd><p>System configuration properties used when starting OpenIDM
    services</p></dd><dt><span class="term"><code class="filename">openidm/connectors/</code></span></dt><dd><p>OpenICF connector libraries. OSGi enabled connector libraries can
    also be stored in <code class="filename">openidm/bundle/</code>.</p></dd><dt><span class="term"><code class="filename">openidm/db/</code></span></dt><dd><p>Internal repository files, including both OrientDB files and data
    definition language scripts for JDBC based repositories such as MySQL</p></dd><dt><span class="term"><code class="filename">openidm/logs/</code></span></dt><dd><p>OpenIDM service log directory</p></dd><dt><span class="term"><code class="filename">openidm/logs/openidm0.log.*</code></span></dt><dd><p>OpenIDM service log files as configured in
    <code class="filename">openidm/conf/logging.properties</code></p></dd><dt><span class="term"><code class="filename">openidm/samples/</code></span></dt><dd><p>OpenIDM sample configurations</p></dd><dt><span class="term"><code class="filename">openidm/sample/misc/</code></span></dt><dd><p>Sample configuration files</p></dd><dt><span class="term"><code class="filename">openidm/sample/provisioners/</code></span></dt><dd><p>Sample connector configuration files</p></dd><dt><span class="term"><code class="filename">openidm/sample/sample1/</code></span></dt><dd><p>XML file connector sample installed with OpenIDM</p></dd><dt><span class="term"><code class="filename">openidm/sample/sample2/</code></span></dt><dd><p>OpenDJ connector sample with no back link</p></dd><dt><span class="term"><code class="filename">openidm/sample/sample2b/</code></span></dt><dd><p>OpenDJ connector sample with back link</p></dd><dt><span class="term"><code class="filename">openidm/sample/sample3/</code></span></dt><dd><p>Scripted SQL connector sample for MySQL</p></dd><dt><span class="term"><code class="filename">openidm/sample/sample4/</code></span></dt><dd><p>CSV connector sample</p></dd><dt><span class="term"><code class="filename">openidm/sample/sample5/</code></span></dt><dd><p>LDAP to OpenIDM to Active Directory attribute flow sample using XML
    resources rather than actual directories</p></dd><dt><span class="term"><code class="filename">openidm/sample/sample6/</code></span></dt><dd><p>LiveSync sample for use with one or two LDAP servers</p></dd><dt><span class="term"><code class="filename">openidm/sample/schedulers/</code></span></dt><dd><p>Sample scheduler configuration files</p></dd><dt><span class="term"><code class="filename">openidm/sample/security/</code></span></dt><dd><p>Sample key store, trust store, and certificates</p></dd><dt><span class="term"><code class="filename">openidm/script/</code></span></dt><dd><p>OpenIDM location for JavaScript files referenced in the
    configuration</p></dd><dt><span class="term"><code class="filename">openidm/script/router-authz.js</code></span></dt><dd><p>Default authorization policy script</p></dd><dt><span class="term"><code class="filename">openidm/security/</code></span></dt><dd><p>OpenIDM security configuration, key store, and trust store</p></dd><dt><span class="term"><code class="filename">openidm/shutdown.sh</code></span></dt><dd><p>Script to shutdown OpenIDM services based on the process
    identifier</p></dd><dt><span class="term"><code class="filename">openidm/startup.bat</code></span></dt><dd><p>Script to start OpenIDM services on Windows</p></dd><dt><span class="term"><code class="filename">openidm/startup.sh</code></span></dt><dd><p>Script to start OpenIDM services</p></dd><dt><span class="term"><code class="filename">openidm/workflow/</code></span></dt><dd><p>OpenIDM location for BPMN 2.0 workflows and .bar files</p></dd></dl></div></div><div lang="en" class="appendix" title="Appendix&nbsp;B.&nbsp;Ports Used"><div class="titlepage"><div><div><h2 class="title"><a name="appendix-ports-used"></a>Appendix&nbsp;B.&nbsp;Ports Used</h2></div></div></div><div class="variablelist"><p>By default the OpenIDM 2.0.3 Jetty configuration
  in <code class="filename">openidm/conf/jetty.xml</code> specifies the following
  ports.</p><dl><dt><span class="term"><code class="literal">8080</code></span></dt><dd><a class="indexterm" name="d160e6249"></a><p>HTTP access to the REST API, requiring OpenIDM authentication. This
    port is not secure, exposing clear text passwords and all data that is not
    encrypted. This port is therefore not suitable for production use.</p></dd><dt><span class="term"><code class="literal">8443</code></span></dt><dd><a class="indexterm" name="d160e6261"></a><p>HTTPS access to the REST API, requiring OpenIDM authentication</p></dd><dt><span class="term"><code class="literal">8444</code></span></dt><dd><a class="indexterm" name="d160e6273"></a><p>HTTPS access to the REST API, requiring SSL mutual authentication.
    Clients presenting certificates found in the trust store under
    <code class="filename">openidm/security/</code> are granted access to the
    system.</p></dd></dl></div></div><div lang="en" class="appendix" title="Appendix&nbsp;C.&nbsp;Data Models &amp; Objects Reference"><div class="titlepage"><div><div><h2 class="title"><a name="appendix-objects"></a>Appendix&nbsp;C.&nbsp;Data Models &amp; Objects Reference</h2></div></div></div><p>OpenIDM allows you to customize of a variety of objects that can be
 addressed via a URL or URI, and that have a common set of functions that
 OpenIDM can perform on them such as CRUD, query, and action.</p><p>Depending on how you intend to use them, different objects are
 appropriate.</p><div class="table"><a name="table-object-types"></a><div class="table-title">Table&nbsp;C.1.&nbsp;OpenIDM Objects</div><div class="table-contents"><a class="indexterm" name="d160e6294"></a><table summary="OpenIDM Objects" width="100%" border="0"><colgroup><col width="28%"><col width="43%"><col width="29%"></colgroup><thead><tr><th>Object Type</th><th>Intended Use</th><th>Special Functionality</th></tr></thead><tbody><tr><td>Managed objects</td><td>Serve as targets and sources for synchronization, and to build
     virtual identities.</td><td>Provide appropriate auditing, script hooks, declarative mappings
     and so forth in addition to the REST interface.</td></tr><tr><td>Configuration objects</td><td>Ideal for look-up tables or other custom configuration, which
     can be configured externally like any other system configuration.</td><td>Adds file view, REST interface, and so forth</td></tr><tr><td>Repository objects</td><td>The equivalent of arbitrary database table access. Appropriate
     when it is appropriate to manage data purely through the underlying
     data store or repository API.</td><td>Persistence and API access</td></tr><tr><td>System objects</td><td>Representation of target resource objects, such as accounts,
     but also resource objects such as groups.</td><td>&nbsp;</td></tr><tr><td>Audit objects</td><td>Houses audit data in the OpenIDM internal repository.</td><td>&nbsp;</td></tr><tr><td>Links</td><td>Defines a relation between two objects.</td><td>&nbsp;</td></tr></tbody></table></div></div><br class="table-break"><div class="section" title="C.1.&nbsp;Accessing Objects"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="objects-resource-api"></a>C.1.&nbsp;Accessing Objects</h2></div></div></div><a class="indexterm" name="d160e6357"></a><p>OpenIDM's uniform programming model means that all objects are queried
  and manipulated in the same way from your scripts using the Resource API.
  The URL or URI used to identify the target object for an operation depends
  on the object type. Also additional functionality is available for different
  types of object, known as <em class="firstterm">Resource Sets</em>.</p><p>For example, you get managed objects, configuration objects, and
  repository objects in the following way using the Resource API. See the
  section on <a href="../integrators-guide/index.html#rest-uri-scheme" class="link">
  <em class="citetitle">URI Scheme</em></a> for information on how to
  construct and object ID.</p><div class="programlisting">
val = openidm.read(<strong class="hl-string"><em style="color: #f58220">"managed/organization/mysampleorg"</em></strong>)

val = openidm.read(<strong class="hl-string"><em style="color: #f58220">"config/custom/mylookuptable"</em></strong>)

val = openidm.read(<strong class="hl-string"><em style="color: #f58220">"repo/custom/mylookuptable"</em></strong>)</div><p>You update entire objects with the <code class="literal">update()</code>
  function.</p><div class="programlisting">
openidm.update(<strong class="hl-string"><em style="color: #f58220">"managed/organization/mysampleorg"</em></strong>, mymap)

openidm.update(<strong class="hl-string"><em style="color: #f58220">"config/custom/mylookuptable"</em></strong>, mymap)

openidm.update(<strong class="hl-string"><em style="color: #f58220">"repo/custom/mylookuptable"</em></strong>, mymap)</div><p>The <code class="literal">create()</code>, <code class="literal">delete()</code>, and
  <code class="literal">query()</code> functions work in similar fashion.</p><p>To get a managed object through the REST API, depending on your
  security settings and authentication configuration, perform an HTTP GET
  on a similar URL, such as
  <code class="literal">https://localhost:8443/openidm/managed/organization/mysampleorg</code>.</p><p>By default, the HTTP GET returns a JSON representation of the object.
  See the <a href="../integrators-guide/index.html#appendix-rest" class="link"><em class="citetitle">REST
  API Reference</em></a> appendix for details.</p></div><div class="section" title="C.2.&nbsp;Managed Objects"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="managed-objects"></a>C.2.&nbsp;Managed Objects</h2></div></div></div><a class="indexterm" name="d160e6408"></a><p>A <em class="firstterm">managed object</em> in OpenIDM is an object which
  represents the identity-related data managed by OpenIDM. Managed objects
  are stored by OpenIDM in its data store. All managed objects are JSON-based
  data structures.</p><div class="section" title="C.2.1.&nbsp;Managed Object Schema"><div class="titlepage"><div><div><h3 class="title"><a name="managed-object-schema"></a>C.2.1.&nbsp;Managed Object Schema</h3></div></div></div><p>Managed objects have an associated schema to enforce a specific
   data structure. Schema is specified using the <a class="link" href="http://tools.ietf.org/html/draft-zyp-json-schema-03" target="_blank">JSON
   Schema</a> specification. This is currently an Internet-Draft, with
   implementations in multiple programming languages.</p><div class="section" title="C.2.1.1.&nbsp;Managed Object Reserved Properties"><div class="titlepage"><div><div><h4 class="title"><a name="managed-object-reserved-properties"></a>C.2.1.1.&nbsp;Managed Object Reserved Properties</h4></div></div></div><p>Top-level properties in a managed object that begin with an underscore
    ( <code class="literal">_</code> ) are reserved by OpenIDM for internal use, and are
    not explicitly part of its schema. Internal properties are read-only, and
    are ignored when provided by the REST API client.</p><div class="variablelist"><p>The following properties exist for all managed objects in
     OpenIDM.</p><dl><dt><span class="term">_id</span></dt><dd><p>string</p><p>The unique identifier for the object. This value forms a part
       of the managed object's URI.</p></dd><dt><span class="term">_rev</span></dt><dd><p>string</p><p>The revision of the object. This is the same value that is
       exposed as the object's ETag through the REST API. The content of this
       attribute is not defined. No consumer should make any assumptions
       of its content beyond equivalence comparison. This attribute may
       be provided by the underlying data store.</p></dd><dt><span class="term">_schema_id</span></dt><dd><p>string</p><p>The a reference to the schema object that the managed object
       is associated with.</p></dd><dt><span class="term">_schema_rev</span></dt><dd><p>string</p><p>The revision of the schema that was used for validation when
       the object was last stored.</p></dd></dl></div></div><div class="section" title="C.2.1.2.&nbsp;Managed Object Schema Validation"><div class="titlepage"><div><div><h4 class="title"><a name="managed-object-schema-validation"></a>C.2.1.2.&nbsp;Managed Object Schema Validation</h4></div></div></div><p>Schema validation is performed unequivocally whenever an object
    is stored, and conditionally whenever an object is retrieved from the
    data store and exhibits a <code class="literal">_schema_rev</code> value that
    differs from the <code class="literal">_rev</code> of the schema that the OpenIDM
    instance currently has for that managed object type. Whenever a schema
    validation is performed, the <code class="literal">_schema_rev</code> of the object
    is updated to contain the <code class="literal">_rev</code> value of the current
    schema.</p></div><div class="section" title="C.2.1.3.&nbsp;Managed Object Derived Properties"><div class="titlepage"><div><div><h4 class="title"><a name="managed-object-derived-properties"></a>C.2.1.3.&nbsp;Managed Object Derived Properties</h4></div></div></div><p>Properties can be defined to be strictly derived from other
    properties within the object. This allows computed and composite
    values to be created in the object. Whenever an object undergoes a
    change, all derived properties are recomputed. The value of derived
    properties are stored in the data store, and are not recomputed upon
    retrieval.</p></div></div><div class="section" title="C.2.2.&nbsp;Data Consistency"><div class="titlepage"><div><div><h3 class="title"><a name="managed-object-data-consistency"></a>C.2.2.&nbsp;Data Consistency</h3></div></div></div><p>Single-object operations shall be consistent within the scope of
   the operation performed, limited by capabilities of the underlying
   data store. Bulk operations shall not have any consistency
   guarantees. OpenIDM does not expose any transactional semantics
   in the managed object access API.</p><p>All access through the REST API uses the ETag and associated
   conditional headers: <code class="literal">If-Match</code>,
   <code class="literal">If-None-Match</code>. In operations that
   modify model objects, conditional headers are mandatory.</p></div><div class="section" title="C.2.3.&nbsp;Managed Object Triggers"><div class="titlepage"><div><div><h3 class="title"><a name="managed-object-triggers"></a>C.2.3.&nbsp;Managed Object Triggers</h3></div></div></div><p><em class="firstterm">Triggers</em> are user-definable functions that
   validate or modify object or property state.</p><div class="section" title="C.2.3.1.&nbsp;State Triggers"><div class="titlepage"><div><div><h4 class="title"><a name="managed-object-state-triggers"></a>C.2.3.1.&nbsp;State Triggers</h4></div></div></div><p>Managed objects are resource-oriented. A set of triggers is
    defined to intercept the supported request methods on managed
    objects. Such triggers are intended to perform authorization, redact,
    or modify objects before the action is performed. The object
    being operated on is in scope for each trigger, meaning that the
    object is retrieved by the data store before the trigger is fired.</p><p>If retrieval of the object fails, the failure occurs before any
    trigger is called. Triggers are executed before any optimistic
    concurrency mechanisms are invoked. The reason for this is to
    prevent a potential attacker from getting information about an
    object (including its presence in the data store) before
    authorization is applied.</p><div class="variablelist"><dl><dt><span class="term">onCreate</span></dt><dd><p>Called upon a request to create a new object. Throwing an
       exception causes the create to fail.</p></dd><dt><span class="term">onRead</span></dt><dd><p>Called upon a request to retrieve a whole object or portion of
       an object. Throwing an exception causes the object to not be
       included in the result. This method is also called when lists of
       objects are retrieved via requests to its container object; in this
       case, only the requested properties are included in the object.
       Allows for uniform access control for retrieval of objects,
       regardless of the method in which they were requested.</p></dd><dt><span class="term">onUpdate</span></dt><dd><p>Called upon a request to store an object. The "old" and "new"
       objects are in-scope for the trigger. The "old" object represents a
       complete object as retrieved from the data store. The trigger can
       elect to change "new" object properties. If as a result of the
       trigger the object's "old" and "new" values are identical (that is,
       update is reverted), the update ends prematurely, though
       successfully. Throwing an exception causes the update to fail.</p></dd><dt><span class="term">onDelete</span></dt><dd><p>Called upon a request to delete an object. Throwing an
       exception causes the deletion to fail.</p></dd></dl></div></div><div class="section" title="C.2.3.2.&nbsp;Object Storage Triggers"><div class="titlepage"><div><div><h4 class="title"><a name="managed-object-storage-triggers"></a>C.2.3.2.&nbsp;Object Storage Triggers</h4></div></div></div><div class="variablelist"><p>An object-scoped trigger applies to an entire object. Unless
    otherwise specified, the object itself is in scope for the trigger.</p><dl><dt><span class="term">onValidate</span></dt><dd><p>Validates an object prior to its
       storage into the data store. Throws an exception in the event of a
       validation failure.</p></dd><dt><span class="term">onRetrieve</span></dt><dd><p>Called when an object is retrieved from the data store.
       Typically used to transform an object after it has been retrieved
       (for example decryption, JIT data conversion).</p></dd><dt><span class="term">onStore</span></dt><dd><p>Called just prior to when an object is stored into the data
        store. Typically used to transform an object just prior to its
        storage (for example, encryption).</p></dd></dl></div></div><div class="section" title="C.2.3.3.&nbsp;Property Storage Triggers"><div class="titlepage"><div><div><h4 class="title"><a name="managed-object-property-storage-triggers"></a>C.2.3.3.&nbsp;Property Storage Triggers</h4></div></div></div><p>A property-scoped trigger applies to a specific property within
    an object. Only the property itself is in scope for the trigger&#8212;no
    other properties in the object should be accessed during execution
    of the trigger. Unless otherwise specified, the order of execution
    of property-scoped triggers is intentionally left undefined.</p><div class="variablelist"><dl><dt><span class="term">onValidate</span></dt><dd><p>Validates a given property value after its retrieval from and
       prior to its storage into the data store. Throws an exception in the
       event of a validation failure.</p></dd><dt><span class="term">onRetrieve</span></dt><dd><p>Called after an object is retrieved from the data store.
       Typically used to transform a given property after its object's
       retrieval.</p></dd><dt><span class="term">onStore</span></dt><dd><p>Called prior to when an object is stored into the data
       store. Typically used to transform a given property prior to its
       object's storage.</p></dd></dl></div></div><div class="section" title="C.2.3.4.&nbsp;Storage Trigger Sequences"><div class="titlepage"><div><div><h4 class="title"><a name="managed-object-storage-trigger-sequences"></a>C.2.3.4.&nbsp;Storage Trigger Sequences</h4></div></div></div><p>The triggers are executed in the following orders.</p><div class="orderedlist" title="Object Retrieval Sequence"><a name="managed-object-retrieval-sequence"></a><div class="orderedlist-title">Object Retrieval Sequence</div><ol class="orderedlist" type="1"><li class="listitem"><p>Retrieve the raw object from the data store</p></li><li class="listitem"><p>Call object <code class="literal">onRetrieve</code> trigger</p></li><li class="listitem"><p>Per-property within the object (order undefined):</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>Call property <code class="literal">onRetrieve</code> trigger</p></li><li class="listitem"><p>Perform schema validation if <code class="literal">_schema_rev</code>
        does not match (see the <a class="link" href="#managed-object-schema-validation" title="C.2.1.2.&nbsp;Managed Object Schema Validation"><em class="citetitle">Schema
        Validation</em></a> section)</p></li></ul></div></li></ol></div><div class="orderedlist" title="Object Storage Sequence"><a name="managed-object-storage-sequence"></a><div class="orderedlist-title">Object Storage Sequence</div><ol class="orderedlist" type="1"><li class="listitem"><p>Per-property within the object (order undefined):</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>Call property <code class="literal">onValidate</code> trigger</p></li><li class="listitem"><p>Call object <code class="literal">onValidate</code> trigger</p></li><li class="listitem"><p>Perform schema validation (see the <a class="link" href="#managed-object-schema-validation" title="C.2.1.2.&nbsp;Managed Object Schema Validation"><em class="citetitle">Schema
         Validation</em></a> section)</p></li></ul></div></li><li class="listitem"><p>Per-property trigger within the object (order undefined):</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>Call property <code class="literal">onStore</code> trigger</p></li><li class="listitem"><p>Call object <code class="literal">onStore</code> trigger</p></li><li class="listitem"><p>Store the object with any resulting changes to the data
          store</p></li></ul></div></li></ol></div></div></div><div class="section" title="C.2.4.&nbsp;Managed Object Encryption"><div class="titlepage"><div><div><h3 class="title"><a name="managed-object-encryption"></a>C.2.4.&nbsp;Managed Object Encryption</h3></div></div></div><p>Sensitive object properties can be encrypted prior to storage,
   typically through the property <code class="literal">onStore</code> trigger. The
   trigger has access to configuration data, which can include arbitrary
   attributes that you define, such as a symmetric encryption key. Such
   attributes can be decrypted during retrieval from the data store through
   the property <code class="literal">onRetrieve</code> trigger.</p></div><div class="section" title="C.2.5.&nbsp;Managed Object Configuration"><div class="titlepage"><div><div><h3 class="title"><a name="managed-object-configuration"></a>C.2.5.&nbsp;Managed Object Configuration</h3></div></div></div><p>Configuration of managed objects is provided through an array of
   managed object configuration objects.</p><div class="programlisting">
{
  <strong class="hl-string"><em style="color: #f58220">"objects"</em></strong>: [ <em class="replaceable"><code>managed-object-config object</code></em>, ... ]
}</div><div class="variablelist"><dl><dt><span class="term">objects</span></dt><dd><p>array of managed-object-config objects, required</p><p>Specifies the objects that the managed object service
       manages.</p></dd></dl></div><div class="variablelist" title="Managed-Object-Config Object Properties"><a name="managed-object-config-object-properties"></a><div class="variablelist-title">Managed-Object-Config Object Properties</div><p>Specifies the configuration of each managed object.</p><div class="programlisting">
{
  <strong class="hl-string"><em style="color: #f58220">"name"</em></strong>      : <em class="replaceable"><code>string</code></em>,
  <strong class="hl-string"><em style="color: #f58220">"schema"</em></strong>    : <em class="replaceable"><code>json-schema object</code></em>,
  <strong class="hl-string"><em style="color: #f58220">"onCreate"</em></strong>  : <em class="replaceable"><code>script object</code></em>,
  <strong class="hl-string"><em style="color: #f58220">"onRead"</em></strong>    : <em class="replaceable"><code>script object</code></em>,
  <strong class="hl-string"><em style="color: #f58220">"onUpdate"</em></strong>  : <em class="replaceable"><code>script object</code></em>,
  <strong class="hl-string"><em style="color: #f58220">"onDelete"</em></strong>  : <em class="replaceable"><code>script object</code></em>,
  <strong class="hl-string"><em style="color: #f58220">"onValidate"</em></strong>: <em class="replaceable"><code>script object</code></em>,
  <strong class="hl-string"><em style="color: #f58220">"onRetrieve"</em></strong>: <em class="replaceable"><code>script object</code></em>,
  <strong class="hl-string"><em style="color: #f58220">"onStore"</em></strong>   : <em class="replaceable"><code>script object</code></em>,
  <strong class="hl-string"><em style="color: #f58220">"properties"</em></strong>: [ <em class="replaceable"><code>property-configuration object</code></em>, ... ]
}</div><dl><dt><span class="term">name</span></dt><dd><p>string, required</p><p>The name of the managed object. Used to identify the
      managed object in URIs and identifiers.</p></dd><dt><span class="term">schema</span></dt><dd><p>json-schema object, optional</p><p>The schema to use to validate the structure and content of
      the managed object. The schema-object format is specified by the
      JSON Schema specification.</p></dd><dt><span class="term">onCreate</span></dt><dd><p>script object, optional</p><p>A script object to trigger when the creation of an object
      is being requested. The object to be created is provided in the
      root scope as an object property. The script may change the
      object. If an exception is thrown, the create aborts with an
      exception.</p></dd><dt><span class="term">onRead</span></dt><dd><p>script object, optional</p><p>A script object to trigger when the read of an object is
      being requested. The object being read is provided in the root
      scope as an object property. The script may change the object.
      If an exception is thrown, the read aborts with an
      exception.</p></dd><dt><span class="term">onUpdate</span></dt><dd><p>script object, optional</p><p>A script object to trigger when an update to an object is
      requested. The old value of the object being updated is provided
      in the root scope as an <code class="literal">oldObject</code> property. The new
      value of the object being updated is provided in the root scope as a
      <code class="literal">newObject</code> property. The script may change the
      <code class="literal">newObject</code>. If an exception is thrown, the update
      aborts with an exception.</p></dd><dt><span class="term">onDelete</span></dt><dd><p>script object, optional</p><p>A script object to trigger when the deletion of an object
      is being requested. The object being deleted is provided in the
      root scope as an object property. If an exception is thrown, the
      deletion aborts with an exception.</p></dd><dt><span class="term">onValidate</span></dt><dd><p>script object, optional</p><p>A script object to trigger when the object requires
      validation. The object to be validated is provided in the root
      scope as an object property. If an exception is thrown, the
      validation fails.</p></dd><dt><span class="term">onRetrieve</span></dt><dd><p>script object, optional</p><p>A script object to trigger once an object is retrieved from
      the repository. The object that was retrieved is provided in the
      root scope as an object property. The script may change the
      object. If an exception is thrown, then object retrieval
      fails.</p></dd><dt><span class="term">onStore</span></dt><dd><p>script object, optional</p><p>A script object to trigger when an object is about to be
      stored in the repository. The object to be stored is provided in
      the root scope as an object property. The script may change the
      object. If an exception is thrown, then object storage
      fails.</p></dd><dt><span class="term">properties</span></dt><dd><p>array of property-config objects, optional</p><p>A list of property specifications.</p></dd></dl></div><div class="variablelist" title="Script Object Properties"><a name="managed-object-script-object-properties"></a><div class="variablelist-title">Script Object Properties</div><div class="programlisting">
{
  <strong class="hl-string"><em style="color: #f58220">"type"</em></strong>  : <strong class="hl-string"><em style="color: #f58220">"text/javascript"</em></strong>,
  <strong class="hl-string"><em style="color: #f58220">"source"</em></strong>: <em class="replaceable"><code>string</code></em>
 }</div><dl><dt><span class="term">type</span></dt><dd><p>string, required</p><p>Specifies the type of script to be executed. Currently, only
      <code class="literal">"text/javascript"</code> is supported.</p></dd><dt><span class="term">source, file</span></dt><dd><p>string, required (only one, source or file is required)</p><p>Specifies the source code of the script (key word script), or the pointer to the file containing the script (key word file), to be executed.</p></dd></dl></div><div class="variablelist" title="Property Config Properties"><a name="managed-object-property-config-properties"></a><div class="variablelist-title">Property Config Properties</div><div class="programlisting">
{
  <strong class="hl-string"><em style="color: #f58220">"name"</em></strong>      : <em class="replaceable"><code>string</code></em>,
  <strong class="hl-string"><em style="color: #f58220">"onValidate"</em></strong>: <em class="replaceable"><code>script object</code></em>,
  <strong class="hl-string"><em style="color: #f58220">"onRetrieve"</em></strong>: <em class="replaceable"><code>script object</code></em>,
  <strong class="hl-string"><em style="color: #f58220">"onStore"</em></strong>   : <em class="replaceable"><code>script object</code></em>,
  <strong class="hl-string"><em style="color: #f58220">"encryption"</em></strong>: <em class="replaceable"><code>property-encryption object</code></em>
}</div><dl><dt><span class="term">name</span></dt><dd><p>string, required</p><p>The name of the property being configured.</p></dd><dt><span class="term">onValidate</span></dt><dd><p>script object, optional</p><p>A script object to trigger when the property requires
      validation. The property to be validated is provided in the root
      scope as the <code class="literal">property</code> property. If an exception is
      thrown, the validation fails.</p></dd><dt><span class="term">onRetrieve</span></dt><dd><p>script object, optional</p><p>A script object to trigger once a property is retrieved
       from the repository. The property that was retrieved is provided
       in the root scope as the <code class="literal">property</code> property. The
       script may change the property value. If an exception is thrown, then
       object retrieval fails.</p></dd><dt><span class="term">onStore</span></dt><dd><p>script object, optional</p><p>A script object to trigger when a property is about to be
       stored in the repository. The property to be stored is provided
       in the root scope as the <code class="literal">property</code> property. The
       script may change the property value. If an exception is thrown, then
       object storage fails.</p></dd><dt><span class="term">encryption</span></dt><dd><p>property-encryption object, optional</p><p>Specifies the configuration for encryption of the property
       in the repository. If omitted or null, the property is not
       encrypted.</p></dd></dl></div><div class="variablelist" title="Property Encryption Object"><a name="managed-object-property-encryption-properties"></a><div class="variablelist-title">Property Encryption Object</div><div class="programlisting">
{
  <strong class="hl-string"><em style="color: #f58220">"cipher"</em></strong>: <em class="replaceable"><code>string</code></em>,
  <strong class="hl-string"><em style="color: #f58220">"key"</em></strong>   : <em class="replaceable"><code>string</code></em>
}</div><dl><dt><span class="term">cipher</span></dt><dd><p>string, optional</p><p>The cipher transformation used to encrypt the property. If
      omitted or null, the default cipher of
      <code class="literal">"AES/CBC/PKCS5Padding"</code> is used.</p></dd><dt><span class="term">key</span></dt><dd><p>string, required</p><p>The alias of the key in the OpenIDM cryptography service
      keystore used to encrypt the property.</p></dd></dl></div></div><div class="section" title="C.2.6.&nbsp;Custom Managed Objects"><div class="titlepage"><div><div><h3 class="title"><a name="custom-managed-objects"></a>C.2.6.&nbsp;Custom Managed Objects</h3></div></div></div><a class="indexterm" name="d160e6963"></a><p>Managed objects in OpenIDM are inherently fully user definable and
   customizable. Like all OpenIDM objects, managed objects can maintain
   relationships to each other in the form of links. Managed objects are
   intended for use as targets and sources for synchronization operations to
   represent domain objects, and to build up virtual identities. The name comes
   from the intention that OpenIDM stores and manages these objects, as opposed
   to system objects that are present in external systems.</p><p>OpenIDM can synchronize and map directly between external systems
   (system objects), without storing intermediate managed objects. Managed
   objects are appropriate, however, as a way to cache the data&#8212;for
   example, when mapping to multiple target systems, or when decoupling the
   availability of systems&#8212;to more fully report and audit on all object
   changes during reconciliation, and to build up views that are different from
   the original source, such transformed and combined or virtual views. Managed
   objects can also be allowed to act as an authoritative source if no other
   appropriate source is available.</p><p>Other object types exist for other settings that should be available
   to a script, such as configuration or look-up tables that do not need audit
   logging.</p><div class="section" title="C.2.6.1.&nbsp;Setting Up a Managed Object Type"><div class="titlepage"><div><div><h4 class="title"><a name="managed-objects-setup"></a>C.2.6.1.&nbsp;Setting Up a Managed Object Type</h4></div></div></div><p>To set up a managed object, you declare the object in the
    <code class="filename">conf/managed.json</code> file where OpenIDM is installed.
    The following example adds a simple <code class="literal">foobar</code> object
    declaration after the user object type.</p><div class="programlisting">
{
    <strong class="hl-string"><em style="color: #f58220">"objects"</em></strong>: [
        {
            <strong class="hl-string"><em style="color: #f58220">"name"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"user"</em></strong>
        },
        {
            <strong class="hl-string"><em style="color: #f58220">"name"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"foobar"</em></strong>
        }
    ]
}</div></div><div class="section" title="C.2.6.2.&nbsp;Manipulating Managed Objects Declaratively"><div class="titlepage"><div><div><h4 class="title"><a name="managed-objects-declarative"></a>C.2.6.2.&nbsp;Manipulating Managed Objects Declaratively</h4></div></div></div><p>By mapping an object to another object, either an external system
    object or another internal managed object, you automatically tie the object
    life cycle and property settings to the other object. See the chapter on
    <a href="../integrators-guide/index.html#chap-synchronization" class="link"><em class="citetitle">Configuring Synchronization</em></a> for
    details.</p></div><div class="section" title="C.2.6.3.&nbsp;Manipulating Managed Objects Programmatically"><div class="titlepage"><div><div><h4 class="title"><a name="managed-objects-programmatic"></a>C.2.6.3.&nbsp;Manipulating Managed Objects Programmatically</h4></div></div></div><p>You can address managed objects as resources using URLs or URIs with
    the <code class="literal">managed/</code> prefix. This works whether you address the
    managed object internally as a script running in OpenIDM or externally
    through the REST interface.</p><p>You can use all resource API functions in script objects for
    create, read, update, delete operations, and also for arbitrary queries on
    the object set, but not currently for arbitrary actions. See the
    <a href="../integrators-guide/index.html#appendix-scripting" class="link"><em class="citetitle">Scripting Reference</em></a> appendix for
    details.</p><p>OpenIDM supports concurrency through a multi version concurrency
    control (MVCC) mechanism. In other words, each time an object changes,
    OpenIDM assigns it a new revision.</p><p>Objects can be arbitrarily complex as long as they use supported
    types, such as maps, lists, numbers, strings, and booleans as defined in
    <a class="link" href="http://www.json.org" target="_blank">JSON</a>.</p><div class="section" title="C.2.6.3.1.&nbsp;Creating Objects"><div class="titlepage"><div><div><h5 class="title"><a name="managed-objects-programmatic-create"></a>C.2.6.3.1.&nbsp;Creating Objects</h5></div></div></div><p>The following script example creates an object type.</p><div class="programlisting">
openidm.create(<strong class="hl-string"><em style="color: #f58220">"managed/foobar/myidentifier"</em></strong>, mymap)</div></div><div class="section" title="C.2.6.3.2.&nbsp;Updating Objects"><div class="titlepage"><div><div><h5 class="title"><a name="managed-objects-programmatic-update"></a>C.2.6.3.2.&nbsp;Updating Objects</h5></div></div></div><p>The following script example updates an object type.</p><div class="programlisting"><strong class="hl-keyword">var</strong> expectedRev = origMap._rev
openidm.update(<strong class="hl-string"><em style="color: #f58220">"managed/foobar/myidentifier"</em></strong>, expectedRev, mymap)</div><p>The MVCC mechanism requires that <code class="literal">expectedRev</code>
     be set to the expected revision of the object to update. You obtain the
     revision from the object's <code class="literal">_rev</code> property. If something
     else changes the object concurrently, OpenIDM rejects the update, and you
     must either retry or inspect the concurrent modification.</p></div><div class="section" title="C.2.6.3.3.&nbsp;Patching Objects"><div class="titlepage"><div><div><h5 class="title"><a name="managed-objects-programmatic-patch"></a>C.2.6.3.3.&nbsp;Patching Objects</h5></div></div></div><p>You can partially update an object using a patch, which changes only
     the specified properties of the object. OpenIDM supports patch by query,
     so the caller need not know the identifier of the object to change.</p><div class="screen" width="90">$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"
 --request POST -d '[{"replace":"/adPassword","value": "Password"}]' 
 http://localhost:8080/openidm/managed/user?_action=patch&amp;_query-id=for-username&amp;uid=DDOE</div><p>For the syntax on how to formulate the query
      <code class="literal">_query-id=for-username&amp;uid=DDOE</code> see
      <a class="xref" href="#managed-objects-programmatic-query" title="C.2.6.3.6.&nbsp;Querying Object Sets">Section&nbsp;C.2.6.3.6, &#8220;Querying Object Sets&#8221;</a>.</p></div><div class="section" title="C.2.6.3.4.&nbsp;Deleting Objects"><div class="titlepage"><div><div><h5 class="title"><a name="managed-objects-programmatic-delete"></a>C.2.6.3.4.&nbsp;Deleting Objects</h5></div></div></div><p>The following script example deletes an object type.</p><div class="programlisting"><strong class="hl-keyword">var</strong> expectedRev = origMap._rev
openidm.<strong class="hl-keyword">delete</strong>(<strong class="hl-string"><em style="color: #f58220">"managed/foobar/myidentifier"</em></strong>, expectedRev)</div><p>The MVCC mechanism requires that <code class="literal">expectedRev</code>
     be set to the expected revision of the object to update. You obtain the
     revision from the object's <code class="literal">_rev</code> property. If something
     else changes the object concurrently, OpenIDM rejects deletion, and you
     must either retry or inspect the concurrent modification.</p></div><div class="section" title="C.2.6.3.5.&nbsp;Reading Objects"><div class="titlepage"><div><div><h5 class="title"><a name="managed-objects-programmatic-read"></a>C.2.6.3.5.&nbsp;Reading Objects</h5></div></div></div><p>The following script example reads an object type.</p><div class="programlisting">
val = openidm.read(<strong class="hl-string"><em style="color: #f58220">"managed/foobar/myidentifier"</em></strong>)</div></div><div class="section" title="C.2.6.3.6.&nbsp;Querying Object Sets"><div class="titlepage"><div><div><h5 class="title"><a name="managed-objects-programmatic-query"></a>C.2.6.3.6.&nbsp;Querying Object Sets</h5></div></div></div><p>The following script example queries object type instances.</p><div class="programlisting">
<strong class="hl-keyword">var</strong> params = {
    <strong class="hl-string"><em style="color: #f58220">"_query-id"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"my-custom-query-id"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"mycustomtoken"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"samplevalue"</em></strong>
};
val = openidm.query(<strong class="hl-string"><em style="color: #f58220">"managed/foobar"</em></strong>, params);</div><p>The example sets up a query with ID
     <code class="literal">my-custom-query-id</code>. The query definition (not shown)
     is found in the repository configuration. The query definition includes
     the parameter <code class="literal">mycustomtoken</code> for token
     substitution.</p><p>An example for a query can be found in chapter <a href="../integrators-guide/index.html#correlation-query-managed-object" class="link">
  <em class="citetitle">Managed Object as Correlation Query Target</em>
</a>.</p></div></div></div><div class="section" title="C.2.7.&nbsp;Accessing Managed Objects Through the REST API"><div class="titlepage"><div><div><h3 class="title"><a name="managed-objects-access-rest"></a>C.2.7.&nbsp;Accessing Managed Objects Through the REST API</h3></div></div></div><p>OpenIDM exposes all managed object functionality through the REST API
   unless you configure a policy to prevent such access. In addition to the
   common REST functionality of create, read, update, delete, patch, and query,
   the REST API also supports patch by query. See the <a href="../integrators-guide/index.html#appendix-rest" class="link"><em class="citetitle">REST
   API Reference</em></a> appendix for details.</p><p>OpenIDM requires authentication to access the REST API. Authentication
   configuration is shown in
   <code class="filename">openidm/conf/authentication.json</code>. The default
   authorization filter script is
   <code class="filename">openidm/script/router-authz.js</code>.</p></div></div><div class="section" title="C.3.&nbsp;Configuration Objects"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="configuration-objects-reference"></a>C.3.&nbsp;Configuration Objects</h2></div></div></div><p>OpenIDM provides an extensible configuration to allow you to leverage
  regular configuration mechanisms.</p><p>Unlike native OpenIDM configuration, which OpenIDM interprets
  automatically and can start new services, OpenIDM stores custom configuration
  objects and makes them available to your code through the API.</p><p>See the chapter on <a href="../integrators-guide/index.html#chap-configuration" class="link"><em class="citetitle">Configuration Options</em></a> for an introduction
  to standard configuration objects.</p><div class="section" title="C.3.1.&nbsp;When To Use Custom Configuration Objects"><div class="titlepage"><div><div><h3 class="title"><a name="configuration-objects-when-to-use"></a>C.3.1.&nbsp;When To Use Custom Configuration Objects</h3></div></div></div><p>Configuration objects are ideal for metadata and settings that need
   not be included in the data to reconcile. In other words, use configuration
   objects for data that does not require audit log, and does not serve
   directly as a target or source for mappings.</p><p>Although you can set and manipulate configuration objects both
   programmatically and also manually, configuration objects are expected to
   change slowly, perhaps through a mix of both manual file updates and also
   programmatic updates. To store temporary values that can change frequently
   and that you do not expect to be updated by configuration file changes,
   custom repository objects can be more appropriate.</p></div><div class="section" title="C.3.2.&nbsp;Custom Configuration Object Naming Conventions"><div class="titlepage"><div><div><h3 class="title"><a name="configuration-objects-naming"></a>C.3.2.&nbsp;Custom Configuration Object Naming Conventions</h3></div></div></div><p>By convention custom configuration objects are added under the
   reserved context, <code class="literal">config/custom</code>.</p><p>You can choose any name under
   <code class="literal">config/<em class="replaceable"><code>context</code></em></code>. Be sure,
   however, to choose a value for <em class="replaceable"><code>context</code></em> that
   does not clash with future OpenIDM configuration names.</p></div><div class="section" title="C.3.3.&nbsp;Mapping Configuration Objects To Configuration Files"><div class="titlepage"><div><div><h3 class="title"><a name="configuration-objects-file-mapping"></a>C.3.3.&nbsp;Mapping Configuration Objects To Configuration Files</h3></div></div></div><p>If you have not disabled the file based view for configuration, you
   can view and edit all configuration including custom configuration in
   <code class="filename">openidm/conf/*.json</code> files. The configuration maps to a
   file named
   <code class="filename"><em class="replaceable"><code>context</code></em>-<em class="replaceable"><code>config-name</code></em>.json</code>,
   where <em class="replaceable"><code>context</code></em> for custom configuration objects
   is <code class="literal">custom</code> by convention, and
   <em class="replaceable"><code>config-name</code></em> is the configuration object name.
   A configuration object named <code class="literal">escalation</code> thus maps to a
   file named <code class="filename">conf/custom-escalation.json</code>.</p><p>OpenIDM detects and automatically picks up changes to the file.</p><p>OpenIDM also applies changes made through APIs to the file.</p><p>By default, OpenIDM stores configuration objects in the repository.
   The file view is an added convenience aimed to help you in the development
   phase of your project.</p></div><div class="section" title="C.3.4.&nbsp;Configuration Objects File &amp; REST Payload Formats"><div class="titlepage"><div><div><h3 class="title"><a name="configuration-objects-formats"></a>C.3.4.&nbsp;Configuration Objects File &amp; REST Payload Formats</h3></div></div></div><p>By default, OpenIDM maps configuration objects to JSON
   representations.</p><p>OpenIDM represents objects internally in plain, native types like
   maps, lists, strings, numbers, booleans, null. OpenIDM constrains the
   object model to simple types so that mapping objects to external
   representations is trivial.</p><p>The following example shows a representation of a configuration
   object with a look-up map.</p><div class="programlisting">{
    <strong class="hl-string"><em style="color: #f58220">"CODE123"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"ALERT"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"CODE889"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"IGNORE"</em></strong>
}</div><p>In the JSON representation, maps are represented with braces
   (<code class="literal">{ }</code>), and lists are represented with brackets
   (<code class="literal">[ ]</code>). Objects can be arbitrarily complex, as in the
   following example.</p><div class="programlisting">{
    <strong class="hl-string"><em style="color: #f58220">"CODE123"</em></strong> : {
        <strong class="hl-string"><em style="color: #f58220">"email"</em></strong> : [<strong class="hl-string"><em style="color: #f58220">"sample@sample.com"</em></strong>, <strong class="hl-string"><em style="color: #f58220">"john.doe@somedomain.com"</em></strong>],
        <strong class="hl-string"><em style="color: #f58220">"sms"</em></strong> : [<strong class="hl-string"><em style="color: #f58220">"555666777"</em></strong>]
    }
    <strong class="hl-string"><em style="color: #f58220">"CODE889"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"IGNORE"</em></strong>
}</div></div><div class="section" title="C.3.5.&nbsp;Accessing Configuration Objects Through the REST API"><div class="titlepage"><div><div><h3 class="title"><a name="configuration-objects-access-rest"></a>C.3.5.&nbsp;Accessing Configuration Objects Through the REST API</h3></div></div></div><p>You can list all available configuration objects, including system
   and custom configurations, using an HTTP GET on
   <code class="literal">/openidm/config</code>.</p><p>The <code class="literal">_id</code> property in the configuration object
   provides the link to the configuration details with an HTTP GET on
   <code class="literal">/openidm/config/<em class="replaceable"><code>id-value</code></em></code>.
   By convention, the <em class="replaceable"><code>id-value</code></em> for a custom
   configuration object called <code class="literal">escalation</code> is
   <code class="literal">custom/escalation</code>.</p><p>OpenIDM supports REST mappings for create, read, update, and delete
   of configuration objects. Currently OpenIDM does not support patch and
   custom query operations for configuration objects.</p></div><div class="section" title="C.3.6.&nbsp;Accessing Configuration Objects Programmatically"><div class="titlepage"><div><div><h3 class="title"><a name="configuration-objects-access-programmatic"></a>C.3.6.&nbsp;Accessing Configuration Objects Programmatically</h3></div></div></div><p>You can address configuration objects as resources using the URL or
   URI <code class="literal">config/</code> prefix both internally and also through
   the REST interface. The resource API provides script object functions for
   create, read, update, and delete operations.</p><p>OpenIDM supports concurrency through a multi version concurrency
   control mechanism. In other words, each time an object changes, OpenIDM
   assigns it a new revision.</p><p>Objects can be arbitrarily complex as long as they use supported
   types, such as maps, lists, numbers, strings, and booleans.</p></div><div class="section" title="C.3.7.&nbsp;Creating Objects"><div class="titlepage"><div><div><h3 class="title"><a name="configuration-objects-programmatic-create"></a>C.3.7.&nbsp;Creating Objects</h3></div></div></div><p>The following script example creates an object type.</p><div class="programlisting">
openidm.create(<strong class="hl-string"><em style="color: #f58220">"config/custom/myconfig"</em></strong>, mymap)</div></div><div class="section" title="C.3.8.&nbsp;"><div class="titlepage"></div><p>The following script example updates an object type.</p><div class="programlisting"><strong class="hl-keyword">var</strong> expectedRev = origMap._rev
openidm.update(<strong class="hl-string"><em style="color: #f58220">"managed/custom/myconfig"</em></strong>, expectedRev, mymap)</div><p>The MVCC mechanism requires that <code class="literal">expectedRev</code>
    be set to the expected revision of the object to update. You obtain the
    revision from the object's <code class="literal">_rev</code> property. If something
    else changes the object concurrently, OpenIDM rejects the update, and you
    must either retry or inspect the concurrent modification.</p></div><div class="section" title="C.3.9.&nbsp;Deleting Objects"><div class="titlepage"><div><div><h3 class="title"><a name="configuration-objects-programmatic-delete"></a>C.3.9.&nbsp;Deleting Objects</h3></div></div></div><p>The following script example deletes an object type.</p><div class="programlisting"><strong class="hl-keyword">var</strong> expectedRev = origMap._rev
openidm.<strong class="hl-keyword">delete</strong>(<strong class="hl-string"><em style="color: #f58220">"config/custom/myconfig"</em></strong>, expectedRev)</div><p>The MVCC mechanism requires that <code class="literal">expectedRev</code>
    be set to the expected revision of the object to update. You obtain the
    revision from the object's <code class="literal">_rev</code> property. If something
    else changes the object concurrently, OpenIDM rejects deletion, and you
    must either retry or inspect the concurrent modification.</p></div><div class="section" title="C.3.10.&nbsp;Reading Objects"><div class="titlepage"><div><div><h3 class="title"><a name="configuration-objects-programmatic-read"></a>C.3.10.&nbsp;Reading Objects</h3></div></div></div><p>The following script example reads an object type.</p><div class="programlisting">
val = openidm.read(<strong class="hl-string"><em style="color: #f58220">"config/custom/myconfig"</em></strong>)</div></div></div><div class="section" title="C.4.&nbsp;System Objects"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="system-objects"></a>C.4.&nbsp;System Objects</h2></div></div></div><a class="indexterm" name="d160e7300"></a><p><em class="firstterm">System objects</em> are pluggable representations of
  objects on external systems. They follow the same RESTful resource based
  design principles as managed objects. There is a default implementation for
  the OpenICF framework, which allows any connector object to be represented
  as a system object.</p></div><div class="section" title="C.5.&nbsp;Audit Objects"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="audit-objects"></a>C.5.&nbsp;Audit Objects</h2></div></div></div><a class="indexterm" name="d160e7312"></a><p>Audit objects house audit data selected for local storage in the
  OpenIDM repository. For details, see the chapter on <a href="../integrators-guide/index.html#chap-auditing" class="link"><em class="citetitle">Using Audit
  Logs</em></a>.</p></div><div class="section" title="C.6.&nbsp;Links"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="links"></a>C.6.&nbsp;Links</h2></div></div></div><a class="indexterm" name="d160e7326"></a><p>Link objects define relations between source objects and a target
  objects, usually relations between managed objects and system objects.
  The link relationship is established by provisioning activity that either
  results in a new account on a target system, or a reconciliation or
  synchronization scenario that takes a <code class="literal">LINK</code> action.</p></div></div><div lang="en" class="appendix" title="Appendix&nbsp;D.&nbsp;Synchronization Reference"><div class="titlepage"><div><div><h2 class="title"><a name="appendix-synchronization"></a>Appendix&nbsp;D.&nbsp;Synchronization Reference</h2></div></div></div><a class="indexterm" name="d160e7340"></a><p>The synchronization engine is one of the core services of OpenIDM. You configure the
 synchronization service through a <code class="literal">mappings</code> property
 that specifies mappings between objects managed by the synchronization
 engine.</p><div class="programlisting">{
  <strong class="hl-string"><em style="color: #f58220">"mappings"</em></strong>: [ <em class="replaceable"><code>object-mapping object</code></em>, ... ]
}</div><div class="section" title="D.1.&nbsp;Object-Mapping Objects"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sync-object-mapping"></a>D.1.&nbsp;Object-Mapping Objects</h2></div></div></div><p>An object-mapping object specifies the configuration for a mapping of
  source objects to target objects.</p><div class="programlisting"> {
  <strong class="hl-string"><em style="color: #f58220">"name"</em></strong>            : <em class="replaceable"><code>string</code></em>,
  <strong class="hl-string"><em style="color: #f58220">"source"</em></strong>          : <em class="replaceable"><code>string</code></em>,
  <strong class="hl-string"><em style="color: #f58220">"target"</em></strong>          : <em class="replaceable"><code>string</code></em>,
  <strong class="hl-string"><em style="color: #f58220">"validSource"</em></strong>     : <em class="replaceable"><code>script object</code></em>,
  <strong class="hl-string"><em style="color: #f58220">"validTarget"</em></strong>     : <em class="replaceable"><code>script object</code></em>,
  <strong class="hl-string"><em style="color: #f58220">"correlationQuery"</em></strong>: <em class="replaceable"><code>script object</code></em>,
  <strong class="hl-string"><em style="color: #f58220">"properties"</em></strong>      : [ <em class="replaceable"><code>property object</code></em>, ... ],
  <strong class="hl-string"><em style="color: #f58220">"policies"</em></strong>        : [ <em class="replaceable"><code>policy object</code></em>, ... ],
  <strong class="hl-string"><em style="color: #f58220">"onCreate"</em></strong>        : <em class="replaceable"><code>script object</code></em>,
  <strong class="hl-string"><em style="color: #f58220">"onUpdate"</em></strong>        : <em class="replaceable"><code>script object</code></em>,
  <strong class="hl-string"><em style="color: #f58220">"onLink"</em></strong>        : <em class="replaceable"><code>script object</code></em>,
  <strong class="hl-string"><em style="color: #f58220">"onUnlink"</em></strong>        : <em class="replaceable"><code>script object</code></em>
}</div><div class="variablelist" title="Mapping Object Properties"><a name="mapping-object-properties"></a><div class="variablelist-title">Mapping Object Properties</div><dl><dt><span class="term">name</span></dt><dd><p>string, required</p><p>Uniquely names the object mapping. Used in the link object
      identifier.</p></dd><dt><span class="term">source</span></dt><dd><p>string, required</p><p>Specifies the path of the source object set. Example:
      <code class="literal">"managed/user"</code>.</p></dd><dt><span class="term">target</span></dt><dd><p>string, required</p><p>Specifies the path of the target object set. Example:
      <code class="literal">"system/ldap/account"</code>.</p></dd><dt><span class="term">validSource</span></dt><dd><p>script object, optional</p><p>A script that determines if a source object is valid to be
      mapped. The script yields a boolean value: <code class="literal">true</code>
      indicates the source object is valid; <code class="literal">false</code> can be
      used to defer mapping until some condition is met. In the root scope,
      the source object is provided in the <code class="literal">"source"</code>
      property. If the script is not specified, then all source objects are
      considered valid.</p></dd><dt><span class="term">validTarget</span></dt><dd><p>script object, optional</p><p>A script used during the target phase of reconciliation that determines if a target
      object is valid to be mapped. The script yields a boolean value:
      <code class="literal">true</code> indicates the target object is valid;
      <code class="literal">false</code> indicates that the target object should not be
      included in reconciliation. In the root scope, the target object is
      provided in the <code class="literal">"target"</code> property. If the script is
      not specified, then all target objects are considered valid for
      mapping.</p></dd><dt><span class="term">correlationQuery</span></dt><dd><p>script object, optional</p><p>A script that yields a query object to query the target object
      set when a source object has no linked target. The syntax for writing the query depends on the target system of the correlation. See chapter <a href="../integrators-guide/index.html#correlation" class="link">
  <em class="citetitle">Correlation</em>
</a> for examples of some common targets. The source object is
      provided in the <code class="literal">"source"</code> property in the script
      scope.</p></dd><dt><span class="term">properties</span></dt><dd><p>array of property-mapping objects, optional</p><p>Specifies mappings between source object properties and target
      object properties, with optional transformation scripts.</p></dd><dt><span class="term">policies</span></dt><dd><p>array of policy objects, optional</p><p>Specifies a set of link conditions and associated actions to
      take in response.</p></dd><dt><span class="term">onCreate</span></dt><dd><p>script object, optional</p><p>A script to execute when a target object is to be created,
      after property mappings have been applied. In the root scope, the
      source object is provided in the <code class="literal">"source"</code> property,
      projected target object in the <code class="literal">"target"</code> property and
      the link situation that led to the create operation in
      <code class="literal">"situation"</code>. The <code class="literal">_id</code> property in
      the target object can be modified, allowing the mapping to select an
      identifier; if not set then the identifier is expected to be set by
      the target object set. If the script throws an exception, then
      target object creation is aborted.</p></dd><dt><span class="term">onUpdate</span></dt><dd><p>script object, optional</p><p>A script to execute when a target object is to be updated,
      after property mappings have been applied. In the root scope, the
      source object is provided in the <code class="literal">"source"</code> property,
      projected target object in the <code class="literal">"target"</code> property,
      link situation that led to the update operation in
      <code class="literal">"situation"</code>. If the script throws an exception,
      then target object update is aborted.</p></dd><dt><span class="term">onLink</span></dt><dd><p>script object, optional</p><p>A script to execute when a source object is to be linked to a target object,
      after property mappings have been applied. In the root scope, the
      source object is provided in the <code class="literal">"source"</code> property,
      projected target object in the <code class="literal">"target"</code> property. If the script throws an exception,
      then target object linking is aborted.</p></dd><dt><span class="term">onUnlink</span></dt><dd><p>script object, optional</p><p>A script to execute when a source and a target object are to be unlinked,
      after property mappings have been applied. In the root scope, the
      source object is provided in the <code class="literal">"source"</code> property,
      projected target object in the <code class="literal">"target"</code> property. If the script throws an exception,
      then target object unlinking is aborted.</p></dd><dt><span class="term">result</span></dt><dd><p>script object, optional</p><p>A script to execute on each mapping event, independent of the nature of the operation. In the root scope, the
      source object is provided in the <code class="literal">"source"</code> property,
      projected target object in the <code class="literal">"target"</code> property. If the script throws an exception,
      then target object unlinking is aborted.</p><p>The "result" script is executed only during reconciliation operations!</p></dd></dl></div><div class="section" title="D.1.1.&nbsp;Property Objects"><div class="titlepage"><div><div><h3 class="title"><a name="sync-property-objects"></a>D.1.1.&nbsp;Property Objects</h3></div></div></div><p>A property object specifies how the value of a target property is
   determined.</p><div class="programlisting"> {
  <strong class="hl-string"><em style="color: #f58220">"target"</em></strong> : <em class="replaceable"><code>string</code></em>,
  <strong class="hl-string"><em style="color: #f58220">"source"</em></strong> : <em class="replaceable"><code>string</code></em>,
  <strong class="hl-string"><em style="color: #f58220">"transform"</em></strong> : <em class="replaceable"><code>script object</code></em>,
  <strong class="hl-string"><em style="color: #f58220">"condition"</em></strong> : <em class="replaceable"><code>script object</code></em>,
  <strong class="hl-string"><em style="color: #f58220">"default"</em></strong>: <em class="replaceable"><code>value</code></em>
}</div><div class="variablelist" title="Property Object Properties"><a name="sync-property-object-properties"></a><div class="variablelist-title">Property Object Properties</div><dl><dt><span class="term">target</span></dt><dd><p>string, required</p><p>Specifies the path of the property in the target object to map
       to.</p></dd><dt><span class="term">source</span></dt><dd><p>string, optional</p><p>Specifies the path of the property in the source object to map
        from. If not specified, then the target property value is derived
        from the script or default value.</p></dd><dt><span class="term">transform</span></dt><dd><p>script object, optional</p><p>A script to determine the target property value. The root
        scope contains the value of the source in the
        <code class="literal">"source"</code> property, if specified. If the <code class="literal">"source"</code> property has a value of <code class="literal">""</code>, then the entire source object of the mapping is contained in the root scope. The resulting
        value yielded by the script is stored in the target property.</p></dd><dt><span class="term">condition</span></dt><dd><p>script object, optional</p><p>A script to determine whether the mapping should be executed or not. The root
        scope contains the value of the source in the
        <code class="literal">"source"</code> property (if specified). The script is considered to return a boolean value.</p></dd><dt><span class="term">default</span></dt><dd><p>any value, optional</p><p>Specifies the value to assign to the target property if a
        non-null value is not established by <code class="literal">"source"</code> or
        <code class="literal">"transform"</code>. If not specified, the default value is
        <code class="literal">null</code>.</p></dd></dl></div></div><div class="section" title="D.1.2.&nbsp;Policy Objects"><div class="titlepage"><div><div><h3 class="title"><a name="sync-policy-objects"></a>D.1.2.&nbsp;Policy Objects</h3></div></div></div><p>A policy object specifies a link condition and the associated actions
   to take in response.</p><div class="programlisting">{
  <strong class="hl-string"><em style="color: #f58220">"situation"</em></strong>: <em class="replaceable"><code>string</code></em>,
  <strong class="hl-string"><em style="color: #f58220">"action"</em></strong>   : <em class="replaceable"><code>string</code></em> or <em class="replaceable"><code>script object</code></em>
}</div><div class="variablelist" title="Policy Object Properties"><a name="sync-policy-object-properties"></a><div class="variablelist-title">Policy Object Properties</div><dl><dt><span class="term">situation</span></dt><dd><p>string, required</p><p>Specifies the situation for which an associated action is to be
      defined.</p></dd><dt><span class="term">action</span></dt><dd><p>string or script object, required</p><p>Specifies the action to perform. If a script is specified, the
       script is executed and is expected to yield a string containing the
       action to perform.</p></dd></dl></div><div class="section" title="D.1.2.1.&nbsp;Script Object"><div class="titlepage"><div><div><h4 class="title"><a name="sync-script-objects"></a>D.1.2.1.&nbsp;Script Object</h4></div></div></div><p>Script objects take the following form.</p><div class="programlisting">{
  <strong class="hl-string"><em style="color: #f58220">"type"</em></strong>  : <strong class="hl-string"><em style="color: #f58220">"text/javascript"</em></strong>,
  <strong class="hl-string"><em style="color: #f58220">"source"</em></strong>: <em class="replaceable"><code>string</code></em>
}</div><div class="variablelist"><dl><dt><span class="term">type</span></dt><dd><p>string, required</p><p>Specifies the type of script to be executed. Currently, OpenIDM
        supports only <code class="literal">"text/javascript"</code>.</p></dd><dt><span class="term">source</span></dt><dd><p>string, required</p><p>Specifies the source code of the script to be executed.</p></dd></dl></div></div></div></div><div class="section" title="D.2.&nbsp;Links"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sync-links"></a>D.2.&nbsp;Links</h2></div></div></div><p>To maintain links between source and target objects in mappings,
  OpenIDM stores an object set in the repository. The object set identifier
  follows this scheme.</p><pre class="literallayout">links/<em class="replaceable"><code>mapping</code></em></pre><p>Here, <em class="replaceable"><code>mapping</code></em> represents the name of the
  mapping for which links are managed.</p><p>Link entries have the following structure.</p><div class="programlisting">{
   <strong class="hl-string"><em style="color: #f58220">"_rev"</em></strong>:<em class="replaceable"><code>string</code></em>,
   <strong class="hl-string"><em style="color: #f58220">"linkType"</em></strong>:<em class="replaceable"><code>string</code></em>,
   <strong class="hl-string"><em style="color: #f58220">"secondId"</em></strong>:<em class="replaceable"><code>string</code></em>,
   <strong class="hl-string"><em style="color: #f58220">"_id"</em></strong>:<em class="replaceable"><code>string</code></em>,
   <strong class="hl-string"><em style="color: #f58220">"reconId"</em></strong>:<em class="replaceable"><code>string</code></em>,
   <strong class="hl-string"><em style="color: #f58220">"firstId"</em></strong>:<em class="replaceable"><code>string</code></em>
}{
  <strong class="hl-string"><em style="color: #f58220">"f"</em></strong>: <em class="replaceable"><code>string</code></em>,
  <strong class="hl-string"><em style="color: #f58220">"targetId"</em></strong>: <em class="replaceable"><code>string</code></em>,
  <strong class="hl-string"><em style="color: #f58220">"reconId"</em></strong> : <em class="replaceable"><code>string</code></em>
}</div><div class="variablelist"><dl><dt><span class="term">_rev</span></dt><dd><p>string, required</p><p>The value of link object's revision.</p></dd><dt><span class="term">linkType</span></dt><dd><p>string, required</p><p>The type of the link. Usually then name of the mapping which created the link.</p></dd><dt><span class="term">firstId</span></dt><dd><p>string, required</p><p>The identifier of the first of the two linked objects.</p></dd><dt><span class="term">_id</span></dt><dd><p>string</p><p>The identifier of the link object.</p></dd><dt><span class="term">reconId</span></dt><dd><p>string or null</p><p>The identifier of the last reconciliation job that processed this
     link. OpenIDM uses this during reconciliation to detect orphan source and
     target objects.</p></dd><dt><span class="term">secondId</span></dt><dd><p>string</p><p>The identifier of the second of the two linked objects.</p></dd></dl></div></div><div class="section" title="D.3.&nbsp;Queries"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sync-queries"></a>D.3.&nbsp;Queries</h2></div></div></div><div class="orderedlist"><p>OpenIDM performs the following queries on a link object set.</p><ol class="orderedlist" type="1"><li class="listitem"><p>Find link(s) for a given firstId object identifier.</p><pre class="literallayout">SELECT * FROM links  WHERE linkType = <em class="replaceable"><code>value</code></em> AND firstId = <em class="replaceable"><code>value</code></em></pre><p>Although a single result makes sense, this query is intended to
    allow multiple results so that this scenario can be handled as an
    exception.</p></li><li class="listitem"><p>Select link(s) for a given second object identifier.</p><pre class="literallayout">SELECT * FROM links  WHERE linkType = <em class="replaceable"><code>value</code></em> AND secondId = <em class="replaceable"><code>value</code></em></pre><p>Although a single result makes sense, this query is intended to
    allow multiple results so that this scenario can be handled as an
    exception.</p></li></ol></div></div><div class="section" title="D.4.&nbsp;Reconciliation"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sync-reconciliation"></a>D.4.&nbsp;Reconciliation</h2></div></div></div><div class="orderedlist"><p>OpenIDM performs reconciliation on a per-mapping basis. The process of
  reconciliation for a given mapping includes these stages.</p><ol class="orderedlist" type="1"><li class="listitem"><p>Iterate through all objects for the object set specified as
    <code class="literal">"source"</code>. For each source object, carry out the
    following steps.</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p>Look for a link to a target object in the link object set, and
      perform a correlation query (if defined).</p></li><li class="listitem"><p>Determine the link condition, as well as whether a target object can be found.</p></li><li class="listitem"><p>Determine the action to perform based on the policy defined for the
      condition.</p></li><li class="listitem"><p>Perform the action.</p></li><li class="listitem"><p>Keep track of the target objects for which a condition and action has already been determined.</p></li><li class="listitem"><p>Write the results.</p></li></ol></div></li><li class="listitem"><p>Iterate through all object identifiers for the object set specified
    as <code class="literal">"target"</code>. For each identifier, carry out the
    following steps.</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p>Find the target in the link object set.</p><p>Determine if target object already was handled in the first phase.</p></li><li class="listitem"><p>Determine the action to perform based on the policy defined for the
      condition.</p></li><li class="listitem"><p>Perform the action.</p></li><li class="listitem"><p>Write the results.</p></li></ol></div></li><li class="listitem"><p>Iterate through all link objects, carrying out the following
    steps.</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p>If the <code class="literal">reconId</code> is <code class="literal">"my"</code>, then
      skip the object.</p><p>If the <code class="literal">reconId</code> is not recognized, then the
      source or the target is missing.</p></li><li class="listitem"><p>Determine the action to perform based on the policy.</p></li><li class="listitem"><p>Perform the action.</p></li><li class="listitem"><p>Store the <code class="literal">reconId</code> identifer in the mapping to
      indicate that it was processed in this run.</p></li></ol></div></li></ol></div></div><div class="section" title="D.5.&nbsp;REST API"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sync-rest-api"></a>D.5.&nbsp;REST API</h2></div></div></div><div class="variablelist"><p>External synchronized objects expose an API to request immediate
   synchronization. This API includes the following requests and
   responses.</p><dl><dt><span class="term">Request</span></dt><dd><p>Example:</p><div class="programlisting">
POST /openidm/system/xml/account/jsmith?action=sync HTTP/1.1</div></dd><dt><span class="term">Response (success)</span></dt><dd><p>Example:</p><div class="programlisting">
HTTP/1.1 204 No Content
...</div></dd><dt><span class="term">Response (synchronization failure)</span></dt><dd><p>Example:</p><div class="programlisting">
HTTP/1.1 409 Conflict
...
<em class="replaceable"><code>[JSON representation of error]</code></em></div></dd></dl></div></div></div><div lang="en" class="appendix" title="Appendix&nbsp;E.&nbsp;REST API Reference"><div class="titlepage"><div><div><h2 class="title"><a name="appendix-rest"></a>Appendix&nbsp;E.&nbsp;REST API Reference</h2></div></div></div><a class="indexterm" name="d160e7970"></a><a class="indexterm" name="d160e7975"></a><p>OpenIDM provides a RESTful API for accessing managed objects.</p><div class="section" title="E.1.&nbsp;URI Scheme"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="rest-uri-scheme"></a>E.1.&nbsp;URI Scheme</h2></div></div></div><p>The URI scheme for accessing a managed object follows this
  convention, assuming the OpenIDM web application was deployed at
  <code class="literal">/openidm</code>.</p><pre class="literallayout">/openidm/managed/<em class="replaceable"><code>type</code></em>/<em class="replaceable"><code>id</code></em></pre></div><div class="section" title="E.2.&nbsp;Object Identifiers"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="rest-object-identifier"></a>E.2.&nbsp;Object Identifiers</h2></div></div></div><a class="indexterm" name="d160e7998"></a><p>Each managed object has an identifier&#8212;expressed as
  <em class="replaceable"><code>id</code></em> in the URI scheme&#8212;which is used to
  address the object through the REST API. The REST API allows for the
  client-generated and server-generated identifiers, through PUT and POST
  methods. The default server-generated identifier type is a UUID. Object
  identifiers that begin with underscore ( <code class="literal">_</code> ) are reserved
  for future use.</p></div><div class="section" title="E.3.&nbsp;Content Negotiation"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="rest-content-negotiation"></a>E.3.&nbsp;Content Negotiation</h2></div></div></div><p>The REST API fully supports negotiation of content representation
  through the <code class="literal">Accept</code> HTTP header. Currently, the supported
  content type is JSON; omitting content-negotiation is equivalent to including
  the following header:</p><pre class="literallayout">Accept: application/json</pre></div><div class="section" title="E.4.&nbsp;Conditional Operations"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="rest-conditional-operations"></a>E.4.&nbsp;Conditional Operations</h2></div></div></div><p>The REST API fully supports conditional operations through the use of
  the <code class="literal">ETag</code>, <code class="literal">If-Match</code> and
  <code class="literal">If-None-Match</code> HTTP headers. The use of HTTP conditional
  operations is the basis of OpenIDM's optimistic concurrency control system.
  Clients should make requests conditional in order to prevent inadvertent
  modification of the wrong version of an object.</p></div><div class="section" title="E.5.&nbsp;Supported Methods"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="rest-supported-methods"></a>E.5.&nbsp;Supported Methods</h2></div></div></div><p>The managed object API uses standard HTTP methods to access managed
  objects.</p><div class="variablelist"><dl><dt><span class="term">GET</span></dt><dd><p>Retrieves a managed object in OpenIDM.</p><p>Example Request</p><div class="programlisting">
GET /openidm/managed/user/bdd793f8 HTTP/1.1
...</div><p>Example Response</p><div class="programlisting">
HTTP/1.1 200 OK
Content-Type: application/json
Content-Length: 123
ETag: "0"
...

[<em class="replaceable"><code>JSON representation of the managed object</code></em>]</div></dd><dt><span class="term">HEAD</span></dt><dd><p>Returns metainformation about a managed object in OpenIDM.</p><p>Example Request</p><div class="programlisting">
HEAD /openidm/managed/user/bdd793f8 HTTP/1.1
...</div><p>Example Response</p><div class="programlisting">
HTTP/1.1 200 OK
Content-Type: application/json
Content-Length: 123
ETag: "0"</div></dd><dt><span class="term">PUT</span></dt><dd><p>Creates or updates a managed object. PUT is the preferred method of
     creating managed objects.</p><p>Example Request: Creating a new object</p><div class="programlisting">
PUT /openidm/managed/user/5752c0fd9509 HTTP/1.1
Content-Type: application/json
Content-Length: 123
If-None-Match: *
...

[<em class="replaceable"><code>JSON representation of the managed object to create</code></em>]</div><p>Example Response: Creating a new object</p><div class="programlisting">
HTTP/1.1 201 Created
Content-Type: application/json
Content-Length: 45
ETag: "0"
...

[<em class="replaceable"><code>JSON representation containing metadata (underscore-prefixed) properties</code></em>]</div><p>Example Request: Updating an existing object</p><div class="programlisting">
PUT /openidm/managed/user/5752c0fd9509 HTTP/1.1
Content-Type: application/json
Content-Length: 123
If-Match: "0"
...

[<em class="replaceable"><code>JSON representation of managed object to update</code></em>]</div><p>Example Response: Updating an existing object (success)</p><div class="programlisting">
HTTP/1.1 204 No Content
ETag: "1"
...</div><p>Example Response: Updating an existing object (version conflict)</p><div class="programlisting">
HTTP/1.1 409 Conflict
Content-Type: application/json
Content-Length: 89
...

[<em class="replaceable"><code>JSON representation of error</code></em>]</div></dd><dt><span class="term">POST</span></dt><dd><p>The POST method allows arbitrary actions to be performed on managed
     objects. The <code class="literal">_action</code> query parameter defines the action
     to be performed.</p><p>The <code class="literal">create</code> action is used to create a managed
     object. Because POST is neither safe nor idempotent, PUT is the preferred
     method of creating managed objects, and should be used if the client know
     what identifier it wants to assign the object. The response contains
     the server-generated <code class="literal">_id</code> of the newly created managed
     object.</p><p>The POST method create optionally accepts an <code class="literal">_id</code>
     query parameter to specify the identifier to give the newly created
     object. If not provided, then the server selects its own identifier.</p><p>Example Request</p><div class="programlisting">
POST /openidm/managed/user?_action=create HTTP/1.1
Content-Type: application/json
Content-Length: 123
...

[<em class="replaceable"><code>JSON representation of the managed object to create</code></em>]</div><p>Example Response</p><div class="programlisting">
HTTP/1.1 201 Created
Content-Type: application/json
Content-Length: 45
ETag: "0"
...

[<em class="replaceable"><code>JSON representation containing metadata (underscore-prefixed) properties</code></em>]</div></dd><dt><span class="term">DELETE</span></dt><dd><p>Deletes a managed object.</p><p>Example Request</p><div class="programlisting">
DELETE /openidm/managed/user/c3471805b60f
If-Match: "0"
...</div><p>Example Response (success)</p><div class="programlisting">
HTTP/1.1 204 No Content
...</div><p>Example Response (version conflict)</p><div class="programlisting">
HTTP/1.1 409 Conflict
Content-Type: application/json
Content-Length: 89
...

[<em class="replaceable"><code>JSON representation of error</code></em>]</div></dd><dt><span class="term">PATCH</span></dt><dd><p>Performs a partial modification of a managed object.</p><p>See the <a class="link" href="http://tools.ietf.org/html/draft-pbryan-json-patch-04" target="_blank">JSON
     Patch Internet-Draft</a> for details.</p><p>Example Request</p><div class="programlisting">
PATCH /openidm/managed/user/5752c0fd9509 HTTP/1.1
Content-Type: application/patch+json
Content-Length: 456
If-Match: "0"
...

[<em class="replaceable"><code>JSON representation of patch document to apply</code></em>]</div><p>Example Response (success)</p><div class="programlisting">
HTTP/1.1 204 No Content
ETag: "1"
...</div><p>Example Response (version conflict)</p><div class="programlisting">
HTTP/1.1 409 Conflict
Content-Type: application/json
Content-Length: 89
...

[<em class="replaceable"><code>JSON representation of error</code></em>]</div></dd><dt><span class="term">X-HTTP-Method-Override</span></dt><dd><p>If an HTTP client or server container does not support a particular
     method, a request can be submitted through POST with the
     <code class="literal">X-HTTP-Method-Override</code> header set to the intended
     method.</p><p>Example Request</p><div class="programlisting">
POST /openidm/managed/user/5752c0fd9509 HTTP/1.1
X-HTTP-Method-Override: PATCH
Content-Type: application/patch+json
Content-Length: 456
If-Match: "0"
...

[<em class="replaceable"><code>JSON representation of patch document to apply</code></em>]</div></dd></dl></div></div></div><div lang="en" class="appendix" title="Appendix&nbsp;F.&nbsp;Scripting Reference"><div class="titlepage"><div><div><h2 class="title"><a name="appendix-scripting"></a>Appendix&nbsp;F.&nbsp;Scripting Reference</h2></div></div></div><a class="indexterm" name="d160e8218"></a><p>Scripting lets you customize how OpenIDM works in various ways, such
  as providing custom logic between source and target mappings, defining
  correlation rules, filters, and triggers.</p><div class="section" title="F.1.&nbsp;Configuration"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="scripting-configuration"></a>F.1.&nbsp;Configuration</h2></div></div></div><p>You define scripts using script objects, which can either include the
  code directly in the configuration, or call an external file containing the
  script.</p><div class="programlisting">{
  <strong class="hl-string"><em style="color: #f58220">"type"</em></strong>  : <strong class="hl-string"><em style="color: #f58220">"text/javascript"</em></strong>,
  <strong class="hl-string"><em style="color: #f58220">"source"</em></strong>: <em class="replaceable"><code>string</code></em>
}</div><p>or</p><div class="programlisting">{
  <strong class="hl-string"><em style="color: #f58220">"type"</em></strong>  : <strong class="hl-string"><em style="color: #f58220">"text/javascript"</em></strong>,
  <strong class="hl-string"><em style="color: #f58220">"file"</em></strong>  : <em class="replaceable"><code>file location</code></em>
}</div><div class="variablelist"><dl><dt><span class="term">type</span></dt><dd><p>string, required</p><p>Specifies the type of script to be executed. Currently, OpenIDM
     supports only <code class="literal">"text/javascript"</code>.</p></dd><dt><span class="term">source</span></dt><dd><p>string, required if file is not specified</p><p>Specifies the source code of the script to be executed.</p></dd><dt><span class="term">file</span></dt><dd><p>string, required if source is not specified</p><p>Specifies the file containing the source code of the script to
     execute.</p></dd></dl></div></div><div class="section" title="F.2.&nbsp;Examples"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="scripting-example"></a>F.2.&nbsp;Examples</h2></div></div></div><p>The following example returns <code class="literal">true</code> if the
  <code class="literal">employeeType</code> is equal to <code class="literal">external</code>,
  otherwise returns <code class="literal">false</code>. This script can be useful during
  reconciliation to establish whether the source object should be a part of
  the reconciliation, or ignored.</p><div class="programlisting">
<strong class="hl-string"><em style="color: #f58220">"validTarget"</em></strong>: {
  <strong class="hl-string"><em style="color: #f58220">"type"</em></strong>  : <strong class="hl-string"><em style="color: #f58220">"text/javascript"</em></strong>,
  <strong class="hl-string"><em style="color: #f58220">"source"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"object.employeeType == 'external'"</em></strong>
}</div><p>The following example sets the <code class="literal">__PASSWORD__</code>
  attribute to <code class="literal">defaultpwd</code> when OpenIDM creates a target
  object.</p><div class="programlisting">
<strong class="hl-string"><em style="color: #f58220">"onCreate"</em></strong> : {
  <strong class="hl-string"><em style="color: #f58220">"type"</em></strong>  : <strong class="hl-string"><em style="color: #f58220">"text/javascript"</em></strong>,
  <strong class="hl-string"><em style="color: #f58220">"source"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"target.__PASSWORD__ = 'defaultpwd'"</em></strong>
}</div><p>The following example shows a trigger to create Solaris home
  directories using a script. The script is located in a file,
  <code class="filename">/path/to/openidm/script/createUnixHomeDir.js</code>.</p><div class="programlisting">
{
  <strong class="hl-string"><em style="color: #f58220">"filters"</em></strong> : [ {
      <strong class="hl-string"><em style="color: #f58220">"pattern"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"^system/solaris/account$"</em></strong>,
      <strong class="hl-string"><em style="color: #f58220">"methods"</em></strong> : [ <strong class="hl-string"><em style="color: #f58220">"create"</em></strong> ],
      <strong class="hl-string"><em style="color: #f58220">"onResponse"</em></strong> : {
        <strong class="hl-string"><em style="color: #f58220">"type"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"text/javascript"</em></strong>,
        <strong class="hl-string"><em style="color: #f58220">"file"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"script/createUnixHomeDir.js"</em></strong>
      }
  } ]
}</div></div><div class="section" title="F.3.&nbsp;Function Reference"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="function-ref"></a>F.3.&nbsp;Function Reference</h2></div></div></div><a class="indexterm" name="d160e8307"></a><a class="indexterm" name="d160e8312"></a><p>Functions (access to managed objects, system objects, configuration
   objects) within OpenIDM are accessible to scripts via the
   <code class="literal">openidm</code> object, which is included in the top-level scope
   provided to each script.</p><div class="section" title="F.3.1.&nbsp;openidm.create(id, value)"><div class="titlepage"><div><div><h3 class="title"><a name="function-create"></a>F.3.1.&nbsp;openidm.create(id, value)</h3></div></div></div><p>This function creates a new resource object.</p><div class="variablelist" title="Parameters"><div class="variablelist-title">Parameters</div><dl><dt><span class="term">id</span></dt><dd><p>string</p><p>The identifier of the object to be created.</p></dd><dt><span class="term">value</span></dt><dd><p>object</p><p>The value of the object to be created.</p></dd></dl></div><div class="itemizedlist" title="Returns"><div class="itemizedlist-title">Returns</div><ul class="itemizedlist" type="disc"><li class="listitem"><p>A <code class="literal">null</code> value if successful.</p></li></ul></div><div class="itemizedlist" title="Throws"><div class="itemizedlist-title">Throws</div><ul class="itemizedlist" type="disc"><li class="listitem"><p>An exception is thrown if the object could not be created for any
     reason.</p></li></ul></div></div><div class="section" title="F.3.2.&nbsp;openidm.read(id)"><div class="titlepage"><div><div><h3 class="title"><a name="function-read"></a>F.3.2.&nbsp;openidm.read(id)</h3></div></div></div><p>This function reads and returns an OpenIDM resource object.</p><div class="variablelist" title="Parameters"><div class="variablelist-title">Parameters</div><dl><dt><span class="term">id</span></dt><dd><p>string</p><p>The identifier of the object to be read.</p></dd></dl></div><div class="itemizedlist" title="Returns"><div class="itemizedlist-title">Returns</div><ul class="itemizedlist" type="disc"><li class="listitem"><p>The read OpenIDM resource object, or <code class="literal">null</code> if not
     found.</p></li></ul></div></div><div class="section" title="F.3.3.&nbsp;openidm.update(id, rev, value)"><div class="titlepage"><div><div><h3 class="title"><a name="function-update"></a>F.3.3.&nbsp;openidm.update(id, rev, value)</h3></div></div></div><p>This function updates a resource object.</p><div class="variablelist" title="Parameters"><div class="variablelist-title">Parameters</div><dl><dt><span class="term">id</span></dt><dd><p>string</p><p>The identifier of the resource object to be updated.</p></dd><dt><span class="term">rev</span></dt><dd><p>string</p><p>The revision of the object to be updated, or <code class="literal">null</code>
      if the object is not subject to revision control.</p></dd><dt><span class="term">value</span></dt><dd><p>object</p><p>The value of the object to be updated.</p></dd></dl></div><div class="itemizedlist" title="Returns"><div class="itemizedlist-title">Returns</div><ul class="itemizedlist" type="disc"><li class="listitem"><p>A <code class="literal">null</code> value if successful.</p></li></ul></div><div class="itemizedlist" title="Throws"><div class="itemizedlist-title">Throws</div><ul class="itemizedlist" type="disc"><li class="listitem"><p>An exception is thrown if the object could not be updated for any
     reason.</p></li></ul></div></div><div class="section" title="F.3.4.&nbsp;openidm.delete(id, rev)"><div class="titlepage"><div><div><h3 class="title"><a name="function-delete"></a>F.3.4.&nbsp;openidm.delete(id, rev)</h3></div></div></div><p>This function deletes a resource object.</p><div class="variablelist" title="Parameters"><div class="variablelist-title">Parameters</div><dl><dt><span class="term">id</span></dt><dd><p>string</p><p>The identifier of the object to be deleted.</p></dd><dt><span class="term">rev</span></dt><dd><p>string</p><p>The revision of the object to be deleted, or <code class="literal">null</code>
      if the object is not subject to revision control.</p></dd></dl></div><div class="itemizedlist" title="Returns"><div class="itemizedlist-title">Returns</div><ul class="itemizedlist" type="disc"><li class="listitem"><p>A <code class="literal">null</code> value if successful.</p></li></ul></div><div class="itemizedlist" title="Throws"><div class="itemizedlist-title">Throws</div><ul class="itemizedlist" type="disc"><li class="listitem"><p>An exception is thrown if the object could not be deleted for any
     reason.</p></li></ul></div></div><div class="section" title="F.3.5.&nbsp;openidm.query(id, params)"><div class="titlepage"><div><div><h3 class="title"><a name="function-query"></a>F.3.5.&nbsp;openidm.query(id, params)</h3></div></div></div><p>This function performs a query on the specified OpenIDM resource
   object.</p><div class="variablelist" title="Parameters"><div class="variablelist-title">Parameters</div><dl><dt><span class="term">id</span></dt><dd><p>string</p><p>The identifier of the object to perform the query on.</p></dd><dt><span class="term">params</span></dt><dd><p>object</p><p>An object containing the parameters to pass to the query.</p></dd></dl></div><div class="itemizedlist" title="Returns"><div class="itemizedlist-title">Returns</div><ul class="itemizedlist" type="disc"><li class="listitem"><p>The result of the query.</p></li></ul></div><div class="itemizedlist" title="Throws"><div class="itemizedlist-title">Throws</div><ul class="itemizedlist" type="disc"><li class="listitem"><p>An exception is thrown if the given query could not be processed for
     any reason.</p></li></ul></div></div><div class="section" title="F.3.6.&nbsp;openidm.action(id, params, value)"><div class="titlepage"><div><div><h3 class="title"><a name="function-action"></a>F.3.6.&nbsp;openidm.action(id, params, value)</h3></div></div></div><p>This function performs an action on the specified OpenIDM resource
   object.</p><div class="variablelist" title="Parameters"><div class="variablelist-title">Parameters</div><dl><dt><span class="term">id</span></dt><dd><p>string</p><p>The identifier of the object to perform the action on.</p></dd><dt><span class="term">params</span></dt><dd><p>object</p><p>An object containing the parameters to pass to the action.</p></dd><dt><span class="term">value</span></dt><dd><p>object</p><p>A value that can be provided to the action for processing.</p></dd></dl></div><div class="itemizedlist" title="Returns"><div class="itemizedlist-title">Returns</div><ul class="itemizedlist" type="disc"><li class="listitem"><p>The result of the action. May be <code class="literal">null</code> if no result
     is provided.</p></li></ul></div><div class="itemizedlist" title="Throws"><div class="itemizedlist-title">Throws</div><ul class="itemizedlist" type="disc"><li class="listitem"><p>An exception is thrown if the given action could not be executed
     for any reason.</p></li></ul></div></div><div class="section" title="F.3.7.&nbsp;openidm.encrypt(value, cipher, alias)"><div class="titlepage"><div><div><h3 class="title"><a name="function-encrypt"></a>F.3.7.&nbsp;openidm.encrypt(value, cipher, alias)</h3></div></div></div><p>This function encrypts a value.</p><div class="variablelist" title="Parameters"><div class="variablelist-title">Parameters</div><dl><dt><span class="term">value</span></dt><dd><p>any</p><p>The value to be encrypted.</p></dd><dt><span class="term">cipher</span></dt><dd><p>string</p><p>The cipher with which to encrypt the value, using the form
      "algorithm/mode/padding" or just "algorithm". Example:
      <code class="literal">AES/ECB/PKCS5Padding</code>.</p></dd><dt><span class="term">alias</span></dt><dd><p>string</p><p>The key alias in the key store with which to encrypt the node.</p></dd></dl></div><div class="itemizedlist" title="Returns"><div class="itemizedlist-title">Returns</div><ul class="itemizedlist" type="disc"><li class="listitem"><p>The value, encrypted with the specified cipher and key.</p></li></ul></div><div class="itemizedlist" title="Throws"><div class="itemizedlist-title">Throws</div><ul class="itemizedlist" type="disc"><li class="listitem"><p>An exception is thrown if the object could not be encrypted for any
     reason.</p></li></ul></div></div><div class="section" title="F.3.8.&nbsp;openidm.decrypt(value)"><div class="titlepage"><div><div><h3 class="title"><a name="function-decrypt"></a>F.3.8.&nbsp;openidm.decrypt(value)</h3></div></div></div><p>This function decrypts a value.</p><div class="variablelist" title="Parameters"><div class="variablelist-title">Parameters</div><dl><dt><span class="term">value</span></dt><dd><p>any</p><p>The value to be decrypted.</p></dd></dl></div><div class="itemizedlist" title="Returns"><div class="itemizedlist-title">Returns</div><ul class="itemizedlist" type="disc"><li class="listitem"><p>A deep copy of the value, with any encrypted value decrypted.</p></li></ul></div><div class="itemizedlist" title="Throws"><div class="itemizedlist-title">Throws</div><ul class="itemizedlist" type="disc"><li class="listitem"><p>An exception is thrown if the object could not be decrypted for any
     reason.</p></li></ul></div></div></div><div class="section" title="F.4.&nbsp;Places to Trigger Scripts"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="script-places"></a>F.4.&nbsp;Places to Trigger Scripts</h2></div></div></div><p>Scripts can be triggered at different places, by different
  events.</p><div class="variablelist"><dl><dt><span class="term">In <code class="filename">openidm/conf/sync.json</code></span></dt><dd><div class="variablelist"><dl><dt><span class="term">Triggered by situation</span></dt><dd><p>onCreate, onUpdate, onDelete, onLink, onUnlink</p></dd><dt><span class="term">Object filter</span></dt><dd><p>vaildSource, validTarget</p></dd><dt><span class="term">Correlating objects</span></dt><dd><p>correlationQuery</p></dd><dt><span class="term">Triggered on any reconciliation</span></dt><dd><p>result</p></dd><dt><span class="term">Scripts inside properties</span></dt><dd><p>condition, transform</p></dd></dl></div></dd><dt><span class="term">In <code class="filename">openidm/conf/managed.json</code></span></dt><dd><p>onRetreive, onValidate</p></dd><dt><span class="term">In <code class="filename">openidm/conf/router.json</code></span></dt><dd><p>onRequest, onResponse</p></dd></dl></div></div><div class="section" title="F.5.&nbsp;Debugging OpenIDM Scripts"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="debugging-scripts"></a>F.5.&nbsp;Debugging OpenIDM Scripts</h2></div></div></div><p>OpenIDM includes Eclipse JSDT libraries so you can use Eclipse to debug
  your OpenIDM scripts during development.</p><div class="procedure" title="Procedure&nbsp;F.1.&nbsp;To Enable Debugging"><a name="enable-debugging"></a><div class="procedure-title">Procedure&nbsp;F.1.&nbsp;To Enable Debugging</div><p>Follow these steps to enable debugging using Eclipse.</p><ol class="procedure" type="1"><li class="step" title="Step 1"><p>Install the environment to support JavaScript development in either
    of the following ways.</p><ul class="stepalternatives">
     <li class="step" title="Step 1.1"><p>Download and install Eclipse IDE for JavaScript Web Developers
      from the <a class="link" href="http://www.eclipse.org/downloads/" target="_blank">Eclipse download page</a>.</p></li>
     <li class="step" title="Step 1.2"><p>Add <a class="link" href="http://wiki.eclipse.org/JSDT" target="_blank">JavaScript Development Tools</a> to your existing
      Eclipse installation.</p></li>
    </ul></li><li class="step" title="Step 2"><p>Create an empty JavaScript project called <code class="literal">External JavaScript
    Source</code> in Eclipse.</p><p>Eclipse then uses the <code class="filename">External JavaScript Source</code>
    directory in the default workspace location to store sources that it
    downloads from OpenIDM.</p></li><li class="step" title="Step 3"><p>Stop OpenIDM.</p></li><li class="step" title="Step 4"><p>Edit <code class="filename">openidm/conf/boot/boot.properties</code> to
    enable debugging.</p><ol type="a" class="substeps"><li class="step" title="Step 4.a"><p>Uncomment and edit the following line.</p><div class="programlisting" width="84">
#openidm.script.javascript.debug=transport=socket,suspend=y,address=9888,trace=true</div><p>Here <code class="literal">suspend=y</code> prevents OpenIDM from starting
      until the remote JavaScript debugger has connected. You might therefore
      choose to set this to <code class="literal">suspend=n</code>.</p></li><li class="step" title="Step 4.b"><p>Uncomment and edit the following line.</p><div class="programlisting" width="81">
#openidm.script.javascript.sources=/Eclipse/workspace/External JavaScript Source/</div><p>Adjust <code class="literal">/Eclipse/workspace/External JavaScript
      Source/</code> to match the absolute path to this folder including the
      trailing <code class="literal">/</code> character. On Windows, also use forward
      slashes, such as <code class="literal">C:/Eclipse/workspace/External JavaScript
      Source/</code>.</p><p>Each time OpenIDM loads a new script, it then creates or overwrites
      the file in the <code class="filename">External JavaScript Source</code> directory.
      Before toggling breakpoints, be sure to refresh the source manually in
      Eclipse so you have the latest version.</p></li></ol></li><li class="step" title="Step 5"><p>Prepare the Eclipse debugger to allow you to set breakpoints.</p><p>In the Eclipse Debug perspective, select the Breakpoints tab, and
    then click the Add Script Load Breakpoint icon to open the list of
    scripts.</p><p>In the Add Script Load Breakpoint window, select your scripts, and
    then click OK.</p></li><li class="step" title="Step 6"><p>Start OpenIDM, and connect the debugger.</p><p>To create a new debug, configuration click Run &gt; Debug
    Configurations... &gt; Remote JavaScript &gt; New button, and then set
    the port to 9888 as shown above.</p></li></ol></div></div></div><div lang="en" class="appendix" title="Appendix&nbsp;G.&nbsp;Scheduler Reference"><div class="titlepage"><div><div><h2 class="title"><a name="appendix-scheduling"></a>Appendix&nbsp;G.&nbsp;Scheduler Reference</h2></div></div></div><a class="indexterm" name="d160e8796"></a><p>OpenIDM lets you schedule many tasks and events including reconciliation
 and synchronization, but also arbitrary events by use of scheduler
 objects.</p><p>OpenIDM supports <span class="command"><strong>cron</strong></span>-like syntax to schedule events
 and tasks, based on expressions supported by the Quartz Scheduler that OpenIDM
 bundles.</p><p>If you use configuration files to schedule tasks and events, then the
 scheduler files are located in the <code class="filename">openidm/conf</code> directory.
 By convention, OpenIDM uses file names of the form
 <code class="filename">scheduler-<em class="replaceable"><code>schedule-name</code></em>.json</code>.
 OpenIDM dynamically picks up changes to scheduled tasks and events both,
 during initialization and also during runtime.</p><div class="variablelist" title="Scheduler Configuration Objects"><a name="scheduler-configuration-objects"></a><div class="variablelist-title">Scheduler Configuration Objects</div><p>Scheduler configuration objects take the following form.</p><div class="programlisting">
{
 <strong class="hl-string"><em style="color: #f58220">"enabled"</em></strong>       : true,
 <strong class="hl-string"><em style="color: #f58220">"type"</em></strong>          : <strong class="hl-string"><em style="color: #f58220">"cron"</em></strong>,
 <strong class="hl-string"><em style="color: #f58220">"startTime"</em></strong>     : <strong class="hl-string"><em style="color: #f58220">"</em></strong><em class="replaceable"><code>optional time</code></em><strong class="hl-string"><em style="color: #f58220">",
</em></strong> <strong class="hl-string"><em style="color: #f58220">"endTime"</em></strong>       : <strong class="hl-string"><em style="color: #f58220">"</em></strong><em class="replaceable"><code>optional time</code></em><strong class="hl-string"><em style="color: #f58220">",
</em></strong> <strong class="hl-string"><em style="color: #f58220">"schedule"</em></strong>      : <strong class="hl-string"><em style="color: #f58220">"</em></strong><em class="replaceable"><code>cron expression</code></em><strong class="hl-string"><em style="color: #f58220">",
</em></strong> <strong class="hl-string"><em style="color: #f58220">"timeZone"</em></strong>      : <strong class="hl-string"><em style="color: #f58220">"</em></strong><em class="replaceable"><code>optional time zone</code></em><strong class="hl-string"><em style="color: #f58220">",
</em></strong> <strong class="hl-string"><em style="color: #f58220">"invokeService"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"</em></strong><em class="replaceable"><code>service identifier</code></em><strong class="hl-string"><em style="color: #f58220">",
</em></strong> <strong class="hl-string"><em style="color: #f58220">"invokeContext"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"</em></strong><em class="replaceable"><code>service specific context info</code></em><strong class="hl-string"><em style="color: #f58220">"
</em></strong>}</div><p>The following simple example prints <code class="literal">Hello World</code> to
  the OpenIDM log, <code class="filename">/openidm/logs/openidm0.log.X</code>,
  each minute.</p><div class="programlisting">
{
    <strong class="hl-string"><em style="color: #f58220">"enabled"</em></strong>: true,
    <strong class="hl-string"><em style="color: #f58220">"type"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"cron"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"schedule"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"0 0/1 * * * ?"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"invokeService"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"script"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"invokeContext"</em></strong>: {
        <strong class="hl-string"><em style="color: #f58220">"script"</em></strong>: {
            <strong class="hl-string"><em style="color: #f58220">"type"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"text/javascript"</em></strong>,
            <strong class="hl-string"><em style="color: #f58220">"source"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"java.lang.System.out.println('Hello World&#8217;);"</em></strong>
        },
        <strong class="hl-string"><em style="color: #f58220">"input"</em></strong>: {
            <strong class="hl-string"><em style="color: #f58220">"edit"</em></strong>: <span class="hl-number">26</span>
        }
    }
}</div><p>Scheduler configuration objects take the following properties.</p><dl><dt><span class="term">enabled</span></dt><dd><p>Set to <code class="literal">true</code> to enable the scheduler. When set to
    <code class="literal">false</code>, OpenIDM considers the scheduler configuration
    object dormant, and therefore does not let it be triggered or
    executed.</p><p>Rather than change the configuration or <span class="command"><strong>cron</strong></span>
    expressions, set <code class="literal">enabled</code> to <code class="literal">false</code>
    for task and event schedulers when you want to retain their configuration,
    but do not want them used.</p></dd><dt><span class="term">type</span></dt><dd><p>Currently OpenIDM supports only <code class="literal">cron</code>.</p></dd><dt><span class="term">startTime (optional)</span></dt><dd><p>Used to start the schedule some time in the future. If omitted or
    set to a time in the past, the task or event is scheduled starting
    immediately.</p></dd><dt><span class="term">endTime (optional)</span></dt><dd><p>Used to plan the end of scheduling.</p></dd><dt><span class="term">schedule</span></dt><dd><p>Takes <span class="command"><strong>cron</strong></span> expression syntax.</p></dd><dt><span class="term">timeZone (optional)</span></dt><dd><p>If not set, OpenIDM uses the system time zone.</p></dd><dt><span class="term">invokeService</span></dt><dd><p>Defines the type of scheduled event or action. OpenIDM accepts the
    following values.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><code class="literal">provisioner</code></p></li><li class="listitem"><p><code class="literal">script</code></p></li><li class="listitem"><p><code class="literal">sync</code></p></li></ul></div></dd><dt><span class="term">invokeContext</span></dt><dd><p>Specifies contextual information, such as the JavaScript to invoke.
    The discovery engine provides two mechanisms, reconciliation and
    synchronization. Both require that you specify the
    <code class="literal">invokeContext</code>.</p><p>The following example invokes reconciliation.</p><div class="programlisting">
{
    <strong class="hl-string"><em style="color: #f58220">"enabled"</em></strong>: true,
    <strong class="hl-string"><em style="color: #f58220">"type"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"cron"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"schedule"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"0 0/1 * * * ?"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"invokeService"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"sync"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"invokeContext"</em></strong>: {
        <strong class="hl-string"><em style="color: #f58220">"action"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"reconcile"</em></strong>,
        <strong class="hl-string"><em style="color: #f58220">"mapping"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"systemLdapAccount_managedUser"</em></strong>
    }
}</div><p>For reconciliation tasks, you can add the mapping definition inline
    rather than define it in <code class="filename">openidm/conf/sync.json</code>.</p><p>The following example shows a scheduler for LiveSync.</p><div class="programlisting">
{
    <strong class="hl-string"><em style="color: #f58220">"enabled"</em></strong>: true,
    <strong class="hl-string"><em style="color: #f58220">"type"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"cron"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"schedule"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"0 0/1 * * * ?"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"invokeService"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"provisioner"</em></strong>,
    <strong class="hl-string"><em style="color: #f58220">"invokeContext"</em></strong>: {
        <strong class="hl-string"><em style="color: #f58220">"action"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"liveSync"</em></strong>,
        <strong class="hl-string"><em style="color: #f58220">"source"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"system/OpenDJ/__ACCOUNT__"</em></strong>
    }
}</div><p>Actual configuration differs from these examples depending on your
    configuration.</p></dd></dl></div><div class="section" title="G.1.&nbsp;Scheduled Task Use Cases"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="scheduled-task-use-cases"></a>G.1.&nbsp;Scheduled Task Use Cases</h2></div></div></div><p>OpenIDM lets you schedule not only reconciliation and synchronization,
  but also lets you use scheduling to trigger scripts, collect and run reports,
  trigger workflows, perform custom logging, and so forth. You can find a
  set of samples in the <code class="filename">openidm/samples/schedules</code>
  directory.</p></div><div class="section" title="G.2.&nbsp;Cron Expressions"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="cron-expressions"></a>G.2.&nbsp;Cron Expressions</h2></div></div></div><p>The Quartz Scheduler accepts expressions like those of the UNIX
  <span class="command"><strong>cron</strong></span> command. The syntax is documented extensively in
  the online Quartz <a class="link" href="http://www.quartz-scheduler.org/documentation/quartz-1.x/tutorials/crontrigger" target="_blank"><em class="citetitle">CronTrigger Tutorial</em></a>.</p></div><div class="section" title="G.3.&nbsp;Checking For Quartz Updates"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="check-quartz-updates"></a>G.3.&nbsp;Checking For Quartz Updates</h2></div></div></div><p>The Quartz Scheduler can check for updates over the Internet on the
  Quartz project website, and report available updates in the OpenIDM log.
  The option is set in <code class="filename">openidm/conf/system.properties</code>
  By default, this option is turned off, and should remain off in
  production.</p><pre class="literallayout">system.properties:org.quartz.scheduler.skipUpdateCheck = true</pre></div><div class="section" title="G.4.&nbsp;Service Implementer Notes"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="scheduler-service-implementations"></a>G.4.&nbsp;Service Implementer Notes</h2></div></div></div><p>Services that can be scheduled implement
  <code class="literal">ScheduledService</code>. The service PID is used as a basis for
  the service identifier in schedule definitions.</p></div></div><div lang="en" class="appendix" title="Appendix&nbsp;H.&nbsp;Router Service Reference"><div class="titlepage"><div><div><h2 class="title"><a name="appendix-router"></a>Appendix&nbsp;H.&nbsp;Router Service Reference</h2></div></div></div><a class="indexterm" name="d160e8998"></a><p>The OpenIDM router service provides the uniform interface to all
  objects in OpenIDM: managed objects, system objects, configuration
  objects, and so on.</p><div class="section" title="H.1.&nbsp;Configuration"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="router-configuration"></a>H.1.&nbsp;Configuration</h2></div></div></div><p>The router object as shown in <code class="filename">conf/router.json</code>
  defines an array of filter objects.</p><div class="programlisting">
{
  <strong class="hl-string"><em style="color: #f58220">"filters"</em></strong>: [ <em class="replaceable"><code>filter object</code></em>, ... ]
}</div><p>The required filters array defines a list of filters to be processed
  on each router request. Filters are processed in the order they are
  specified in this array.</p><div class="section" title="H.1.1.&nbsp;Filter Objects"><div class="titlepage"><div><div><h3 class="title"><a name="filter-object"></a>H.1.1.&nbsp;Filter Objects</h3></div></div></div><p>Filter objects are defined as follows.</p><div class="programlisting">
{
  <strong class="hl-string"><em style="color: #f58220">"pattern"</em></strong>: <em class="replaceable"><code>string</code></em>,
  <strong class="hl-string"><em style="color: #f58220">"methods"</em></strong>: [ <em class="replaceable"><code>string</code></em>, ... ],
  <strong class="hl-string"><em style="color: #f58220">"condition"</em></strong>: <em class="replaceable"><code>script object</code></em>,
  <strong class="hl-string"><em style="color: #f58220">"onRequest"</em></strong>: <em class="replaceable"><code>script object</code></em>,
  <strong class="hl-string"><em style="color: #f58220">"onResponse"</em></strong>: <em class="replaceable"><code>script object</code></em>,
  <strong class="hl-string"><em style="color: #f58220">"onFailure"</em></strong>: <em class="replaceable"><code>script object</code></em>
}</div><div class="variablelist"><dl><dt><span class="term">"pattern"</span></dt><dd><p>string, optional</p><p>Specifies a regular expression pattern matching the JSON pointer of
      the object to trigger scripts. If not specified, all identifiers
      (including <code class="literal">null</code>) match.</p></dd><dt><span class="term">"methods"</span></dt><dd><p>array of strings, optional</p><p>One or more methods for which the script(s) should be triggered.
      Supported methods are: <code class="literal">"create"</code>,
      <code class="literal">"read"</code>, <code class="literal">"update"</code>,
      <code class="literal">"delete"</code>, <code class="literal">"patch"</code>,
      <code class="literal">"query"</code>, <code class="literal">"action"</code>. If not specified,
      then all methods are matched.</p></dd><dt><span class="term">"condition"</span></dt><dd><p>script object, optional</p><p>Specifies a script that is called first to determine if the script
      should be triggered. If the condition yields <code class="literal">"true"</code>,
      then the other script(s) are executed. If not specified, the script(s)
      are called unconditionally.</p></dd><dt><span class="term">"onRequest"</span></dt><dd><p>script object, optional</p><p>Specifies a script to execute before the request is dispatched to
      the resource. If the script throws an exception, the method is is not
      performed, and a client error response is provided.</p></dd><dt><span class="term">"onResponse"</span></dt><dd><p>script object, optional</p><p>Specifies a script to execute after the request is successfully
      dispatched to the resource and a response is returned. Throwing an
      exception from this script does not undo the method already
      performed.</p></dd><dt><span class="term">"onFailure"</span></dt><dd><p>script object, optional</p><p>Specifies a script to execute if the request resulted in an
      exception being thrown. Throwing an exception from this script does not
      undo the method already performed.</p></dd></dl></div></div><div class="section" title="H.1.2.&nbsp;Script Execution Sequence"><div class="titlepage"><div><div><h3 class="title"><a name="script-sequenze"></a>H.1.2.&nbsp;Script Execution Sequence</h3></div></div></div><p>All "onRequest" and "onResponse" scripts are executed in a sorted sequence: first the "onRequest" scripts in a top down manner, then the "onResponse" in a bottom up way!</p><div class="screen">
client -&gt; filter 1 onRequest -&gt; filter 2 onRequest -&gt; resource
client &lt;- filter 1 onResponse &lt;- filter 2 onResponse &lt;- resource
    </div><p>Here is an example of a <code class="filename">router.json</code> file and how the scritps would be executed:</p><div class="programlisting">
{
    <strong class="hl-string"><em style="color: #f58220">"filters"</em></strong> : [
        {
            <strong class="hl-string"><em style="color: #f58220">"onRequest"</em></strong> : {
                <strong class="hl-string"><em style="color: #f58220">"type"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"text/javascript"</em></strong>,
                <strong class="hl-string"><em style="color: #f58220">"file"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"script/router-authz.js"</em></strong>
            }
        },
        {
            <strong class="hl-string"><em style="color: #f58220">"pattern"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"^managed/user/.*"</em></strong>,
            <strong class="hl-string"><em style="color: #f58220">"methods"</em></strong> : [
                <strong class="hl-string"><em style="color: #f58220">"read"</em></strong>
            ],
            <strong class="hl-string"><em style="color: #f58220">"onRequest"</em></strong> : {
                <strong class="hl-string"><em style="color: #f58220">"type"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"text/javascript"</em></strong>,
                <strong class="hl-string"><em style="color: #f58220">"source"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"java.lang.System.out.println('requestFilter 1');"</em></strong>
            }
        },
        {
            <strong class="hl-string"><em style="color: #f58220">"pattern"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"^managed/user/.*"</em></strong>,
            <strong class="hl-string"><em style="color: #f58220">"methods"</em></strong> : [
                <strong class="hl-string"><em style="color: #f58220">"read"</em></strong>
            ],
            <strong class="hl-string"><em style="color: #f58220">"onResponse"</em></strong> : {
                <strong class="hl-string"><em style="color: #f58220">"type"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"text/javascript"</em></strong>,
                <strong class="hl-string"><em style="color: #f58220">"source"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"java.lang.System.out.println('responseFilter 1');"</em></strong>
            }
        },
        {
            <strong class="hl-string"><em style="color: #f58220">"pattern"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"^managed/user/.*"</em></strong>,
            <strong class="hl-string"><em style="color: #f58220">"methods"</em></strong> : [
                <strong class="hl-string"><em style="color: #f58220">"read"</em></strong>
            ],
            <strong class="hl-string"><em style="color: #f58220">"onRequest"</em></strong> : {
                <strong class="hl-string"><em style="color: #f58220">"type"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"text/javascript"</em></strong>,
                <strong class="hl-string"><em style="color: #f58220">"source"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"java.lang.System.out.println('requestFilter 2');"</em></strong>
            }
        },
        {
            <strong class="hl-string"><em style="color: #f58220">"pattern"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"^managed/user/.*"</em></strong>,
            <strong class="hl-string"><em style="color: #f58220">"methods"</em></strong> : [
                <strong class="hl-string"><em style="color: #f58220">"read"</em></strong>
            ],
            <strong class="hl-string"><em style="color: #f58220">"onResponse"</em></strong> : {
                <strong class="hl-string"><em style="color: #f58220">"type"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"text/javascript"</em></strong>,
                <strong class="hl-string"><em style="color: #f58220">"source"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"java.lang.System.out.println('responseFilter 2');"</em></strong>
            }
        }
    ]
}    
    </div><p>Will produce a log like:</p><div class="screen">
requestFilter 1
requestFilter 2
responseFilter 2
responseFilter 1    
    </div></div><div class="section" title="H.1.3.&nbsp;Script Scope"><div class="titlepage"><div><div><h3 class="title"><a name="filter-script-scope"></a>H.1.3.&nbsp;Script Scope</h3></div></div></div><p>Scripts are provided with the following scope.</p><div class="programlisting">
{
  <strong class="hl-string"><em style="color: #f58220">"openidm"</em></strong>: openidm-functions object,
  <strong class="hl-string"><em style="color: #f58220">"request"</em></strong>: resource-request object,
  <strong class="hl-string"><em style="color: #f58220">"response"</em></strong>: resource-response object,
  <strong class="hl-string"><em style="color: #f58220">"exception"</em></strong>: exception object
}</div><div class="variablelist"><dl><dt><span class="term">"openidm"</span></dt><dd><p><a href="../integrators-guide/index.html#function-ref" class="link">openidm-functions</a>
      object</p><p>Provides access to OpenIDM resources.</p></dd><dt><span class="term">"request"</span></dt><dd><p><a class="link" href="https://wikis.forgerock.org/confluence/display/json/resource-request" target="_blank">resource-request</a> object</p><p>The resource-request context, which has one or more parent context.
      Provided in scope of <code class="literal">"condition"</code>,
      <code class="literal">"onRequest"</code>, <code class="literal">"onResponse"</code> and
      <code class="literal">"onException"</code> scripts.</p></dd><dt><span class="term">"response"</span></dt><dd><p><a href="../integrators-guide/index.html#function-ref" class="link">openidm-functions</a>
      object</p><p>The response to the resource-request. Only provided in the scope of
      the <code class="literal">"onResponse"</code> script.</p></dd><dt><span class="term">"exception"</span></dt><dd><p>exception object</p><p>The exception value that was thrown as a result of processing the
      request. Only provided in the scope of the
      <code class="literal">"onException"</code> script.</p></dd></dl></div><p>An exception object is defined as follows.</p><div class="programlisting">
{
  <strong class="hl-string"><em style="color: #f58220">"error"</em></strong>: integer,
  <strong class="hl-string"><em style="color: #f58220">"reason"</em></strong>: string,
  <strong class="hl-string"><em style="color: #f58220">"detail"</em></strong>: string
}</div><div class="variablelist"><dl><dt><span class="term">"error"</span></dt><dd><p>integer</p><p>The numeric code of the exception.</p></dd><dt><span class="term">"reason"</span></dt><dd><p>string</p><p>The short reason phrase of the exception.</p></dd><dt><span class="term">"detail"</span></dt><dd><p>string</p><p>The detailed message for the exception.</p></dd></dl></div></div></div><div class="section" title="H.2.&nbsp;Example"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="router-example"></a>H.2.&nbsp;Example</h2></div></div></div><p>The following example executes a script after a managed user object is
  created or updated.</p><div class="programlisting">
{
    <strong class="hl-string"><em style="color: #f58220">"filters"</em></strong>: [
        {
            <strong class="hl-string"><em style="color: #f58220">"pattern"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"^managed/user/.*"</em></strong>,
            <strong class="hl-string"><em style="color: #f58220">"methods"</em></strong>: [
                <strong class="hl-string"><em style="color: #f58220">"create"</em></strong>,
                <strong class="hl-string"><em style="color: #f58220">"update"</em></strong>
            ],
            <strong class="hl-string"><em style="color: #f58220">"onResponse"</em></strong>: {
                <strong class="hl-string"><em style="color: #f58220">"type"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"text/javascript"</em></strong>,
                <strong class="hl-string"><em style="color: #f58220">"file"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"scripts/afterUpdateUser.js"</em></strong>
            }
        }
    ]
}</div></div></div><div lang="en" class="appendix" title="Appendix&nbsp;I.&nbsp;Embedded Jetty Configuration"><div class="titlepage"><div><div><h2 class="title"><a name="appendix-jetty"></a>Appendix&nbsp;I.&nbsp;Embedded Jetty Configuration</h2></div></div></div><p>OpenIDM 2.0.3 includes an embedded Jetty web
 server.</p><p>To configure the embedded Jetty server, edit
 <code class="filename">openidm/conf/jetty.xml</code>. OpenIDM delegates all connector
 configuration to <code class="filename">jetty.xml</code>. OSGi and PAX web specific
 settings for connector configuration therefore do not have an effect. This
 lets you take advantage of all Jetty capabilities, as the web server is not
 configured through an abstraction that might limit some of the options.</p><p>The Jetty configuration can reference configuration properties from
 OpenIDM, such key store details, from OpenIDM's
 <code class="filename">boot.properties</code> configuration file.</p><div class="section" title="I.1.&nbsp;Using OpenIDM Configuration Properties in the Jetty Configuration"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="access-openidm-config-properties"></a>I.1.&nbsp;Using OpenIDM Configuration Properties in the Jetty Configuration</h2></div></div></div><p>OpenIDM exposes a <code class="literal">Param</code> class that you can use in
  <code class="filename">jetty.xml</code> to include OpenIDM configuration. The
  <code class="literal">Param</code> class exposes Bean properties for common Jetty
  settings and generic property access for other, arbitrary settings.</p><div class="section" title="I.1.1.&nbsp;Accessing Explicit Bean Properties"><div class="titlepage"><div><div><h3 class="title"><a name="jetty-access-bean-properties"></a>I.1.1.&nbsp;Accessing Explicit Bean Properties</h3></div></div></div><p>To retrieve an explicit Bean property, use the following syntax in
   <code class="filename">jetty.xml</code>.</p><div class="programlisting">
<strong class="hl-tag" style="color: #f58220">&lt;Get</strong> <span class="hl-attribute" style="color: #868686">class</span>=<span class="hl-value" style="color: #333">"org.forgerock.openidm.jetty.Param"</span> <span class="hl-attribute" style="color: #868686">name</span>=<span class="hl-value" style="color: #333">"&lt;bean property name&gt;"</span><strong class="hl-tag" style="color: #f58220">/&gt;</strong>
   </div><p>For example, to set a Jetty property for keystore password:</p><div class="programlisting">
<strong class="hl-tag" style="color: #f58220">&lt;Set</strong> <span class="hl-attribute" style="color: #868686">name</span>=<span class="hl-value" style="color: #333">"password"</span><strong class="hl-tag" style="color: #f58220">&gt;</strong>
    <strong class="hl-tag" style="color: #f58220">&lt;Get</strong> <span class="hl-attribute" style="color: #868686">class</span>=<span class="hl-value" style="color: #333">"org.forgerock.openidm.jetty.Param"</span> <span class="hl-attribute" style="color: #868686">name</span>=<span class="hl-value" style="color: #333">"keystorePassword"</span><strong class="hl-tag" style="color: #f58220">/&gt;</strong>
<strong class="hl-tag" style="color: #f58220">&lt;/Set&gt;</strong></div><p>Also see the bundled <code class="filename">jetty.xml</code> for further
   examples.</p><div class="variablelist"><p>The following explicit Bean properties are available.</p><dl><dt><span class="term">keystoreType</span></dt><dd><p>Maps to <code class="literal">openidm.keystore.type</code></p></dd><dt><span class="term">keystoreProvider</span></dt><dd><p>Maps to <code class="literal">openidm.keystore.provider</code></p></dd><dt><span class="term">keystoreLocation</span></dt><dd><p>Maps to <code class="literal">openidm.keystore.location</code></p></dd><dt><span class="term">keystorePassword</span></dt><dd><p>Maps to <code class="literal">openidm.keystore.password</code></p></dd><dt><span class="term">keystoreKeyPassword</span></dt><dd><p>Maps to <code class="literal">openidm.keystore.key.password</code>, or the
      key store password if not set</p></dd><dt><span class="term">truststoreLocation</span></dt><dd><p>Maps to <code class="literal">openidm.truststore.location</code>, or the
      key store location if not set</p></dd><dt><span class="term">truststorePassword</span></dt><dd><p>Maps to <code class="literal">openidm.truststore.password</code>, or the
      key store password if not set</p></dd></dl></div></div><div class="section" title="I.1.2.&nbsp;Accessing Generic Properties"><div class="titlepage"><div><div><h3 class="title"><a name="jetty-access-generic-properties"></a>I.1.2.&nbsp;Accessing Generic Properties</h3></div></div></div><div class="programlisting">
<strong class="hl-tag" style="color: #f58220">&lt;Call</strong> <span class="hl-attribute" style="color: #868686">class</span>=<span class="hl-value" style="color: #333">"org.forgerock.openidm.jetty.Param"</span> <span class="hl-attribute" style="color: #868686">name</span>=<span class="hl-value" style="color: #333">"getProperty"</span><strong class="hl-tag" style="color: #f58220">&gt;</strong>
  <strong class="hl-tag" style="color: #f58220">&lt;Arg&gt;</strong>org.forgerock.openidm.some.sample.property<strong class="hl-tag" style="color: #f58220">&lt;/Arg&gt;</strong>
<strong class="hl-tag" style="color: #f58220">&lt;/Call&gt;</strong>
    </div></div></div><div class="section" title="I.2.&nbsp;Jetty Default Settings"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="default-jetty-settings"></a>I.2.&nbsp;Jetty Default Settings</h2></div></div></div><div class="itemizedlist"><p>By default the embedded Jetty server uses the following
   settings.</p><ul class="itemizedlist" type="disc"><li class="listitem"><p>An HTTP connector, listening on port 8080</p></li><li class="listitem"><p>An SSL connector, listening on port 8443</p></li><li class="listitem"><p>Same key store/trust store settings as OpenIDM</p></li><li class="listitem"><p>Trivial sample realm,
    <code class="filename">openidm/security/realm.properties</code> to add users</p></li></ul></div><p>The default settings are intended for evaluation only. Adjust them
  according to your production requirements.</p></div></div><div class="index" title="Index"><div class="titlepage"><div><div><h2 class="title"><a name="d160e9380"></a>Index</h2></div></div></div><div class="index"><div class="indexdiv"><h3>A</h3><dl><dt>Architecture, <a class="indexterm" href="#chap-overview">Architectural Overview</a></dt><dt>Audit logs, <a class="indexterm" href="#chap-auditing">Using Audit Logs</a></dt><dt>Authentication, <a class="indexterm" href="#chap-auth">Managing Authentication, Authorization &amp; RBAC</a></dt><dd><dl><dt>Internal users, <a class="indexterm" href="#openidm-users">OpenIDM Users</a>, <a class="indexterm" href="#security-messages">Use Message Level Security</a></dt><dt>Managed users, <a class="indexterm" href="#openidm-users">OpenIDM Users</a></dt><dt>Roles, <a class="indexterm" href="#openidm-roles">Roles</a></dt></dl></dd><dt>Authorization, <a class="indexterm" href="#chap-auth">Managing Authentication, Authorization &amp; RBAC</a>, <a class="indexterm" href="#openidm-authorization">Authorization</a></dt></dl></div><div class="indexdiv"><h3>B</h3><dl><dt>Best practices, <a class="indexterm" href="#chap-security">Securing &amp; Hardening OpenIDM</a>, <a class="indexterm" href="#chap-best-practices">OpenIDM Project Best Practices</a></dt><dt>Business processes, <a class="indexterm" href="#chap-workflow">Integrating Business Processes &amp; Workflow</a></dt></dl></div><div class="indexdiv"><h3>C</h3><dl><dt>Configuration</dt><dd><dl><dt>Email, <a class="indexterm" href="#chap-mail">Sending Email</a></dt><dt>Files, <a class="indexterm" href="#appendix-file-layout">File Layout</a></dt><dt>Objects, <a class="indexterm" href="#configuration-objects">About Configuration Objects</a></dt><dt>REST API, <a class="indexterm" href="#configuring-over-rest">Configuring OpenIDM Over REST</a></dt><dt>Validating, <a class="indexterm" href="#command-line-tools">Command-Line Tools</a></dt></dl></dd><dt>Connectors, <a class="indexterm" href="#chap-resource-conf">Connecting to External Resources</a></dt><dd><dl><dt>Examples, <a class="indexterm" href="#connector-examples">Connector Configuration Examples</a></dt><dt>Generating configurations, <a class="indexterm" href="#connector-wiz">Creating Default Connector Configurations</a></dt><dt>Object types, <a class="indexterm" href="#openicf-provisioner-conf">Configuring Connectors</a></dt><dt>Remote, <a class="indexterm" href="#connector-info-provider-conf">Accessing Remote Connectors</a></dt></dl></dd><dt>Correlation queries, <a class="indexterm" href="#correlation">Correlation Queries</a></dt></dl></div><div class="indexdiv"><h3>E</h3><dl><dt>Encryption, <a class="indexterm" href="#command-line-tools">Command-Line Tools</a>, <a class="indexterm" href="#security-encrypt-data">Encrypt Data Internally &amp; Externally</a>, <a class="indexterm" href="#security-replace-defaults">Replace Default Security Settings</a></dt></dl></div><div class="indexdiv"><h3>F</h3><dl><dt>File layout, <a class="indexterm" href="#appendix-file-layout">File Layout</a></dt></dl></div><div class="indexdiv"><h3>L</h3><dl><dt>LiveSync, <a class="indexterm" href="#sync-types">Types of Synchronization</a></dt><dd><dl><dt>Scheduling, <a class="indexterm" href="#chap-scheduler-conf">Scheduling Synchronization</a></dt></dl></dd></dl></div><div class="indexdiv"><h3>M</h3><dl><dt>Mappings, <a class="indexterm" href="#openidm-core-services">Core Services</a>, <a class="indexterm" href="#basic-flow">Basic Data Flow Configuration</a></dt><dd><dl><dt>Hooks for scripting, <a class="indexterm" href="#advanced-dataflow">Advanced Data Flow Configuration</a></dt><dt>Scheduled reconciliation, <a class="indexterm" href="#alternative-mapping">Alternative Mappings</a></dt></dl></dd></dl></div><div class="indexdiv"><h3>O</h3><dl><dt>Objects</dt><dd><dl><dt>Audit objects, <a class="indexterm" href="#audit-objects">Audit Objects</a></dt><dt>Configuration objects, <a class="indexterm" href="#configuration-objects">About Configuration Objects</a></dt><dt>Links, <a class="indexterm" href="#links">Links</a></dt><dt>Managed objects, <a class="indexterm" href="#openidm-core-services">Core Services</a>, <a class="indexterm" href="#sync-flexible-data">Flexible Data Model</a>, <a class="indexterm" href="#managed-users">Managed Users</a>, <a class="indexterm" href="#managed-objects">Managed Objects</a>, <a class="indexterm" href="#appendix-rest">REST API Reference</a></dt><dd><dl><dt>Customizing, <a class="indexterm" href="#custom-managed-objects">Custom Managed Objects</a></dt><dt>Identifiers, <a class="indexterm" href="#rest-object-identifier">Object Identifiers</a></dt><dt>Passwords, <a class="indexterm" href="#enforce-password-policy">Enforcing Password Policy</a></dt></dl></dd><dt>Object types, <a class="indexterm" href="#appendix-objects">Data Models &amp; Objects Reference</a></dt><dt>Script access, <a class="indexterm" href="#objects-resource-api">Accessing Objects</a>, <a class="indexterm" href="#function-ref">Function Reference</a></dt><dt>System objects, <a class="indexterm" href="#openidm-core-services">Core Services</a>, <a class="indexterm" href="#system-objects">System Objects</a></dt></dl></dd><dt>OpenICF, <a class="indexterm" href="#chap-resource-conf">Connecting to External Resources</a></dt></dl></div><div class="indexdiv"><h3>P</h3><dl><dt>Passwords, <a class="indexterm" href="#chap-passwords">Managing Passwords</a>, <a class="indexterm" href="#security-replace-defaults">Replace Default Security Settings</a></dt><dt>Ports</dt><dd><dl><dt>8080, <a class="indexterm" href="#appendix-ports-used">Ports Used</a></dt><dt>8443, <a class="indexterm" href="#appendix-ports-used">Ports Used</a></dt><dt>8444, <a class="indexterm" href="#appendix-ports-used">Ports Used</a></dt><dt>Disabling, <a class="indexterm" href="#security-jetty">Secure Jetty</a></dt></dl></dd></dl></div><div class="indexdiv"><h3>R</h3><dl><dt>Reconciliation, <a class="indexterm" href="#openidm-core-services">Core Services</a>, <a class="indexterm" href="#sync-types">Types of Synchronization</a></dt><dd><dl><dt>Scheduling, <a class="indexterm" href="#chap-scheduler-conf">Scheduling Synchronization</a></dt></dl></dd><dt>Resources, <a class="indexterm" href="#chap-resource-conf">Connecting to External Resources</a></dt><dt>REST API, <a class="indexterm" href="#configuring-over-rest">Configuring OpenIDM Over REST</a>, <a class="indexterm" href="#appendix-rest">REST API Reference</a></dt><dd><dl><dt>Listing configuration objects, <a class="indexterm" href="#configuring-over-rest">Configuring OpenIDM Over REST</a></dt></dl></dd><dt>Roles, <a class="indexterm" href="#openidm-roles">Roles</a></dt><dt>Router service, <a class="indexterm" href="#appendix-router">Router Service Reference</a></dt></dl></div><div class="indexdiv"><h3>S</h3><dl><dt>Scheduler, <a class="indexterm" href="#chap-scheduler-conf">Scheduling Synchronization</a>, <a class="indexterm" href="#appendix-scheduling">Scheduler Reference</a></dt><dd><dl><dt>Configuration, <a class="indexterm" href="#scheduler-configuration-file">Scheduler Configuration</a></dt><dt>Examples, <a class="indexterm" href="#scheduler-examples">Scheduler Examples</a></dt></dl></dd><dt>Scripting, <a class="indexterm" href="#appendix-scripting">Scripting Reference</a></dt><dd><dl><dt>Functions, <a class="indexterm" href="#function-ref">Function Reference</a></dt></dl></dd><dt>Security, <a class="indexterm" href="#chap-security">Securing &amp; Hardening OpenIDM</a></dt><dd><dl><dt>Authentication, <a class="indexterm" href="#security-messages">Use Message Level Security</a></dt><dt>Encryption, <a class="indexterm" href="#security-encrypt-data">Encrypt Data Internally &amp; Externally</a>, <a class="indexterm" href="#security-replace-defaults">Replace Default Security Settings</a></dt><dt>SSL, <a class="indexterm" href="#security-ssl-https">Use SSL and HTTPS</a></dt></dl></dd><dt>Sending mail, <a class="indexterm" href="#chap-mail">Sending Email</a></dt><dt>Server logs, <a class="indexterm" href="#chap-logs">Configuring Server Logs</a></dt><dt>Starting OpenIDM, <a class="indexterm" href="#startup-shutdown">Startup &amp; Shutdown</a></dt><dt>Stopping OpenIDM, <a class="indexterm" href="#startup-shutdown">Startup &amp; Shutdown</a></dt><dt>Synchronization, <a class="indexterm" href="#openidm-core-services">Core Services</a>, <a class="indexterm" href="#chap-synchronization">Configuring Synchronization</a>, <a class="indexterm" href="#appendix-synchronization">Synchronization Reference</a></dt><dd><dl><dt>Actions, <a class="indexterm" href="#handling-sync">Synchronization Situations &amp; Actions</a></dt><dt>Conditions, <a class="indexterm" href="#basic-flow">Basic Data Flow Configuration</a></dt><dt>Connectors, <a class="indexterm" href="#basic-flow">Basic Data Flow Configuration</a></dt><dt>Correlation queries, <a class="indexterm" href="#correlation">Correlation Queries</a></dt><dt>Creating attributes, <a class="indexterm" href="#basic-flow">Basic Data Flow Configuration</a>, <a class="indexterm" href="#constructing-attributes">Constructing &amp; Manipulating Attributes</a></dt><dt>Direct (push), <a class="indexterm" href="#sync-types">Types of Synchronization</a></dt><dt>Encryption, <a class="indexterm" href="#sync-encrypted-values">Using Encrypted Values</a></dt><dt>Filtering, <a class="indexterm" href="#basic-flow">Basic Data Flow Configuration</a></dt><dt>Mappings, <a class="indexterm" href="#basic-flow">Basic Data Flow Configuration</a></dt><dt>Passwords, <a class="indexterm" href="#password-sync">Password Synchronization</a></dt><dd><dl><dt>With Active Directory, <a class="indexterm" href="#password-sync">Password Synchronization</a></dt><dt>With OpenDJ, <a class="indexterm" href="#password-sync">Password Synchronization</a></dt></dl></dd><dt>Reusing links, <a class="indexterm" href="#reusing-links">Reusing Links</a></dt><dt>Scheduling, <a class="indexterm" href="#chap-scheduler-conf">Scheduling Synchronization</a></dt><dt>Situations, <a class="indexterm" href="#handling-sync">Synchronization Situations &amp; Actions</a></dt><dt>Transforming attributes, <a class="indexterm" href="#basic-flow">Basic Data Flow Configuration</a></dt></dl></dd></dl></div><div class="indexdiv"><h3>T</h3><dl><dt>Troubleshooting, <a class="indexterm" href="#chap-troubleshooting">Troubleshooting</a></dt></dl></div><div class="indexdiv"><h3>W</h3><dl><dt>Workflow, <a class="indexterm" href="#chap-workflow">Integrating Business Processes &amp; Workflow</a></dt></dl></div></div></div></div><script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-23412190-14']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</body></html>