<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
   <title>Chapter&nbsp;15.&nbsp;Securing &amp; Hardening OpenIDM</title><link rel="stylesheet" type="text/css" href="coredoc.css"><link rel="stylesheet" type="text/css" href="css/coredoc.css"><link rel="stylesheet" type="text/css" href="sh/shCore.css"><link rel="stylesheet" type="text/css" href="sh/shCoreEclipse.css"><link rel="stylesheet" type="text/css" href="sh/shThemeEclipse.css"><script src="http://code.jquery.com/jquery-1.11.0.min.js" type="text/javascript"></script><script src="uses-jquery.js" type="text/javascript"></script><script src="sh/shCore.js" type="text/javascript"></script><script src="sh/shBrushAci.js" type="text/javascript"></script><script src="sh/shBrushBash.js" type="text/javascript"></script><script src="sh/shBrushCsv.js" type="text/javascript"></script><script src="sh/shBrushHttp.js" type="text/javascript"></script><script src="sh/shBrushJava.js" type="text/javascript"></script><script src="sh/shBrushJScript.js" type="text/javascript"></script><script src="sh/shBrushLDIF.js" type="text/javascript"></script><script src="sh/shBrushPlain.js" type="text/javascript"></script><script src="sh/shBrushProperties.js" type="text/javascript"></script><script src="sh/shBrushXml.js" type="text/javascript"></script><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="OpenIDM Integrator's Guide"><link rel="up" href="index.html" title="OpenIDM Integrator's Guide"><link rel="prev" href="chap-auth.html" title="Chapter&nbsp;14.&nbsp;Managing Authentication, Authorization and Role-Based Access Control"><link rel="next" href="chap-workflow.html" title="Chapter&nbsp;16.&nbsp;Integrating Business Processes and Workflows"><link rel="copyright" href="legalnotice.html" title="Legal Notice"><script type="text/javascript">SyntaxHighlighter.all();</script>
<link rel="shortcut icon" href="http://forgerock.org/favicon.ico">
</head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter&nbsp;15.&nbsp;Securing &amp; Hardening OpenIDM</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="chap-auth.html">Prev</a>&nbsp;</td><th width="60%" align="center">&nbsp;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="chap-workflow.html">Next</a></td></tr></table><hr></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-security"></a>Chapter&nbsp;15.&nbsp;Securing &amp; Hardening OpenIDM</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="section"><a href="chap-security.html#security-management-service">15.1. Accessing the Security Management Service</a></span></dt><dt><span class="section"><a href="chap-security.html#security-precautions">15.2. Security Precautions for a Production Environment</a></span></dt></dl></div><a class="indexterm" name="d0e14062"></a><a class="indexterm" name="d0e14065"></a><p>
  OpenIDM provides a security management service, that manages keystore and
  truststore files. The security service is accessible over the REST interface,
  enabling you to read and import SSL certificates, and to generate certificate
  signing requests.
 </p><p>
  This chapter describes the security management service and its REST interface.
 </p><p>
  In addition, the chapter outlines the specific security procedures that you
  should follow before deploying OpenIDM in a production environment.
 </p><div class="note"><h3 class="title">Note</h3><p>
   In a production environment, we recommend that you avoid the use of:
   communications over insecure HTTP, self-signed certificates, and
   certificates associated with insecure ciphers.
  </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="security-management-service"></a>15.1.&nbsp;Accessing the Security Management Service</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="chap-security.html#csr-over-rest">15.1.1. To Generate a Certificate Signing Request Over REST</a></span></dt><dt><span class="section"><a href="chap-security.html#import-signed-cert-over-rest">15.1.2. To Import a Signed Certificate into the Keystore</a></span></dt><dt><span class="section"><a href="chap-security.html#security-endpoints">15.1.3. Security Management Service Endpoints</a></span></dt></dl></div><p>
   OpenIDM stores keystore and truststore files in a folder named
   <code class="filename">/path/to/openidm/security</code>. These files can be managed by
   using the <span class="command"><strong>keytool</strong></span> command, or over the REST interface, at
   the URL <code class="literal">https://localhost:8443/openidm/security</code>. For
   information about using the <span class="command"><strong>keytool</strong></span> command, see
   <a class="link" href="http://docs.oracle.com/javase/6/docs/technotes/tools/solaris/keytool.html" target="_top">http://docs.oracle.com/javase/6/docs/technotes/tools/solaris/keytool.html</a>.
  </p><p>
   The following sections describe how to manage certificates and keys over REST.
  </p><div class="example"><a name="display-keystore-over-rest"></a><div class="example-title">Example&nbsp;15.1.&nbsp;To Display the Contents of the Keystore</div><div class="example-contents"><p>
    OpenIDM generates a symmetric key and a private key the first time the
    server is started. After startup, display the contents of the keystore over
    REST, as follows:
   </p><div class="screen"><pre>
$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/security/keystore"</strong>
    <em>
{
  "type" : "JCEKS",
  "provider" : {
     "Cipher.Blowfish SupportedKeyFormats" : "RAW",
     "AlgorithmParameters.DESede" : "com.sun.crypto.provider.DESedeParameters",
     "AlgorithmParameters.DES" : "com.sun.crypto.provider.DESParameters",
  ...
  },
  "aliases" : [ "openidm-sym-default", "openidm-localhost" ]
}</em>
   </pre></div><div class="itemizedlist"><p>
     By default, OpenIDM includes the following aliases:
    </p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
      <code class="literal">openidm-sym-default</code> - the default symmetric key that is
      used, for example, to encrypt the configuration.
     </p></li><li class="listitem"><p>
      <code class="literal">openidm-localhost</code> - the default alias that is used by
      the Jetty web server to service SSL requests. This alias references a
      private key and a self-signed certificate. You can use the self-signed
      certificate for testing purposes. When you deploy OpenIDM in a production
      environment, you should replace the self-signed certificate with a
      certificate that has been signed by a certificate authority.
     </p></li></ul></div></div></div><br class="example-break"><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="csr-over-rest"></a>15.1.1.&nbsp;To Generate a Certificate Signing Request Over REST</h3></div></div></div><p>
    To request a signed certificate, generate a certificate signing request
    (CSR) over REST, as described in this section. The details of the CSR are
    specified in JSON format, for example:
   </p><pre class="brush: javascript;">
{
    "DN" : "www.example.com",
    "OU" : "HR",
    "L"  : "Cupertino",
    "C"  : "US"
}
   </pre><p>
    For information about the complete contents of a CSR, see
    <a class="link" href="http://www.sslshopper.com/what-is-a-csr-certificate-signing-request.html" target="_top">http://www.sslshopper.com/what-is-a-csr-certificate-signing-request.html</a>.
   </p><p>
    To generate a CSR over the REST interface, include the private key alias in
    the URL. The following example, uses the default alias
    (<code class="literal">openidm-localhost</code>). If you have created your own private
    key for this request, specify its alias instead of
    <code class="literal">openidm-localhost</code>. Set <code class="literal"> "returnPrivateKey" : true</code>
    to return the private key along with the request.
   </p><div class="screen"><pre>
$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 --data '{"CN" : "www.example.com",
 "OU" : "HR",
 "L"  : "Cupertino",
 "C"  : "US",
 "returnPrivateKey" : true,
 "alias" : "openidm-localhost"}' \
 "https://localhost:8443/openidm/security/keystore?_action=generateCSR"</strong>
    <em>
{
  "_id": "openidm-localhost",
  "csr": "-----BEGIN CERTIFICATE REQUEST-----\n
MIICmzCCAYMCAQAwWDEZMBcGA1UEAwwQd3d3MS5
leGFtcGxlLmNvbTELMAkGA1UE\nCwwCSFIxDTALBgNVBAoMBE5vbmUxEjAQBgNVBAcMCUN1cGVyd
GlubzELMAkGA1UE\nBhMCVVMwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDAjCjTt1b
o0WKH\nP/4PR/Td3A1ElTo4/J/7o7eWflOqs8vW5d76SMcJFKOQ6FhoOcOHRNewch+a0DBK\njKF
aRCE1c0PuXiIlrO7wsF4dFTtTZKAhrpFdM+0hU4LeyCDxQQ5UDga3rmyVIvC8\nL1PvW+sZEcZ9r
T67XOV03cwUpjvG4W58FCUKd6UAI0szfIrFdvJp4q4LkkBNkk9J\nUf+MXsSVuHzZrqvqhX900Is
a19mXD6/P9Cql8KmwEzzbglGFf6uYAK33F71Kx409\nTeS85sjmBbyJwUVwhgQ0R35H3HC6jex4P
jx1rSfPmsi61JBx9kyGu6rnSv5FOQGy\nBQpgQFnJAgMBAAEwDQYJKoZIhvcNAQENBQADggEBAKc
yInfo2d7/12jUrOjL4Bqt\nStuQS/HkO2KAsc/zUnlpJyd3RPI7Gs1C6FxIRVCzi4Via5QzE06n2
F8HHkinqc6m\nBWhIcf5Omk6fSqG0aw7fqn20XWDkRm+I4vtm8P8CuWftUj5qv5kmyUtrcQ3+YPD
O\nL+cK4cfuCkjLQ3h4GIgBJP+gfWX8fTmCHyaHEFjLTMj1hZYEx+3f8awOVFoNmr3/\nB8LIJNH
UiFHO6EED7LDOwa/z32mTRET0nK5DVO60H80JSWxzdWYZQV/IzHzm8ST4\n6j6vuheBZiG5gZR2V
F0x5XoudQrSg7lpVslXBHNeiM85+H08RMQh8Am2bp+Xstw=\n",
     -----END CERTIFICATE REQUEST-----\n",
  "publicKey": {
     "format": "X.509",
     "encoded": "-----BEGIN PUBLIC KEY-----\n
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAr
ALtYU662bNbQZG7JZ3M\noOUmVP9cPP3+DhQ5H0V0qB+9YjE4XUtuwUGqaUmuT+mrXHwGpLAqvUm
NsVyXJj9s\nJhX6PCyXzO3RdKBVC8pphMfKXodjBC57ef0OkWjO5ZRAqCRwS3BXkoCfu6/ZXRpk\
ncc/A1RmLZdPmcuKmN5vQl4E3Z6F4YyG7M0g7TE54dhqPvGNS9cO4r0Vom9373MDh\n+8QSfmLCC
94Ro+VUAF9Q6nk2j0PgTi+QZ0i93jbKAWWX57w6S5i7CpEptKyeP9iG\ncFnJddSICPHkbQJ73gu
lyZYkbcBblNUxIhODZV5bJ0oxn9qgYvzlxJupldYsYkBo\ncwIDAQAB\n
     -----END PUBLIC KEY-----\n",
     "algorithm": "RSA"
  },
  "privateKey": {
     "format": "PKCS#8",
     "encoded": "-----BEGIN RSA PRIVATE KEY-----\n
MIIEpAIBAAKCAQEArALtYU662bNbQZG7JZ3MoOU
VP9cPP3+DhQ5H0V0qB+9YjE4\nXUtuwUGqaUmuT+mrXHwGpLAqvUmNsVyXJj9sJhX6PCyXzO3RdK
BVC8pphMfKXodj\nBC57ef0OkWjO5ZRAqCRwS3BXkoCfu6/ZXRpkcc/A1RmLZdPmcuKmN5vQl4E3
Z0i93jbKAWWX57w6S5i7CpEptKyeP9iGcFnJddSICPHkbQJ73gulyZYkbcBb\nlNUxIhODZV5bJ0
Z6F4\nYyG7M0g7TE54dhqPvGNS9cO4r0Vom9373MDh+8QSfmLCC94Ro+VUAF9Q6nk2j0Pg\nTi+Q
oxn9qgYvzlxJupldYsYkBocwIDAQABAoIBAGmfpopRIPWbaBb8\nWNIBcuz9qSsaX1ZolP+qNWVZ
bgfq7Y0FMlo/frQXEYBzqSETGJHC6wVn0+bF6scV\nVw86dLtyVWVr8I77HdoitfZ2hZLuZ/rh4d
BohpPi63YoyJs7DPTy4y2/v1aLuwoy\nMiQ0l6c3bm6sr+eIVgMH4A9Xk5/jzAHVTCBrvfTYZnh6
qD4Qmiuj8pQn79HQV8NK\nLt/5kmV1+uGj78jg7NR06NjNsa4L3mNZSiqsn2haPXZAnBjKfWApxe
GugURgNBCO\ncmYqCDZLvpMy4S/qoRBu+6qdYGprb+tHshBYNywuDkrgszhwgr5yRm8VQ60T9tM/
\nceKM+TECgYEA2Az2DkpC9TjJHPJG7x4boRRVqV5YRgPf5MrU+7PxDMb+EauXXUXg\nsch9Eeon
30yINqSv6FwATLVlkzQpZLkkJ6GJqAxUmPjRslAuosiSJqKaWamDUDbz\nSu/7iANJWvRGayqZsa
GQqFwM0Xpfp/EiBGe757k0D02u8sAv94A75bsCgYEAy9FQ\nMwDU3CaDzgv0qgR1ojXkSW0dCbv0
QPEkKZ2Ik7JbXzwVGzfdv2VUVrzRKBGReYzn\nGg/s4HbZkYy4O+SJo44n/5iO2pgKG5MEDFHSpw
X54Rm+qabT2fQ2lFJ/myWKsPgJ\n4gZ9bUvcemCcLLzsiAphueulQp49eOLnkzPlQKkCgYEAy7A0
jrZuuDjoStUUET5G\neC/urvZWrPPcMx0TfZZhTVWSlWA8HWDS/WnymGA1ZS4HQdU0TxHl6mwerp
C/8ckn\nEAIZAQlW/L2hHcbAoRIN0ET+1kedmJOl/mGQt+O5Vfn1JfYM3s5ezouyPhBsfK43\nDw
Ypvsb6EO+BYDXXQzVvwx8CgYB9o67LcfTFLNzNFCOi9pLJBm2OMbvXt0wPCFch\nbCG34hdfMntU
RvDjvgPqYASSrZm+kvQW5cBAciMWDOe4y91ovAW+En3lFBoO+2Zg\nbcPr/8wUTblxfQxU660Fa4
GL0u2Wv5/f+94vlLb5nTpIfcFU7wllAXTjBwaf0Uet\nPy1P2QKBgQDPoyJqPi2TdN7ZQYcoXAM4
Gl5Yv9oO16RC917XH6SLvj0ePmdLgBXo\nrR6aAmOjLzFp9jiytWZqVR9DbAWd2YNpvQav4Gude3
lteew02UT+GNv/gC71bXCw\ncFTxnmKjP8YYIBBqZXzuk9wEaHN7OdGybUW0dsBCGxTXwDKe8XiA
6w==\n-----END RSA PRIVATE KEY-----\n",
     "algorithm": "RSA"
} </em>
   </pre></div><p>
    This sample request returns the CSR, the private key associated with the
    request, and the public key. The security management service stores the
    private key in the repository.
    When the signed certificate is returned by the certificate authority and you
    import the certificate into the keystore, you do not need to supply the
    private key. The security management service locates the private key in the
    repository, adds the certificate chain, and loads it into the keystore.
   </p><p>
    If you will be importing the signed certificate into the keystore of an
    OpenIDM instance that is not connected to the repository in which this
    private key was stored, you must include the private key when you import the
    signed certificate. Setting <code class="literal">"returnPrivateKey" : true</code> in
    the CSR enables you to maintain a copy of the private key for this purpose.
   </p><p>Send the output from
    </p><div class="screen"><pre>"csr": "-----BEGIN CERTIFICATE REQUEST-----
     ...
     -----END CERTIFICATE REQUEST-----</pre></div><p>
    to your certificate authority for signature.
   </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="import-signed-cert-over-rest"></a>15.1.2.&nbsp;To Import a Signed Certificate into the Keystore</h3></div></div></div><p>
    When a signed certificate is returned by the certificate authority, import
    it into the keystore by running a RESTful <code class="literal">PUT</code> command on
    the keystore alias. Include the CA root certificate in the command. If you
    are not importing the certificate into the same keystore as the one from
    which the CSR was generated, include the private key in the PUT request.
   </p><div class="screen"><pre>
$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request PUT \
 --data '{
    "alias": "openidm-localhost",
    "fromCSR": true,
    "certs": [
        "-----BEGIN CERTIFICATE-----\n
MIIGcDCCBVigAwIBAgIDC23tMA0GCSqGSIb3DQEBBQUAMIGMMQswCQYDVQQGEwJJ\n
TDEWMBQGA1UEChMNU3RhcnRDb20gTHRkLjErMCkGA1UECxMiU2VjdXJlIERpZ2l0\n
YWwgQ2VydGlmaWNhdGUgU2lnbmluZzE4MDYGA1UEAxMvU3RhcnRDb20gQ2xhc3Mg\n
MSBQcmltYXJ5IEludGVybWVkaWF0ZSBTZXJ2ZXIgQ0EwHhcNMTMwODA3MTMyODAz\n
WhcNMTQwODA4MDY0NTM5WjB2MRkwFwYDVQQNExBwZ3BDaGU4cEJPZnptVE9KMQsw\n
CQYDVQQGEwJHQjEjMCEGA1UEAxMadGVzdC1jb25uZWN0LmZvcmdlcm9jay5jb20x\n
JzAlBgkqhkiG9w0BCQEWGHBvc3RtYXN0ZXJAZm9yZ2Vyb2NrLmNvbTCCASIwDQYJ\n
KoZIhvcNAQEBBQADggEPADCCAQoCggEBAJRWGbnMGs+uGKU6ZrlTaaFdPczLqZnv\n
D37T0FOc/X3XXHxSVH94FDk7N4ansP2o6BsDWttIkM2AXkX3efMRaNpgxg7l4+DL\n
opV6H1RkrRba2Lom6Hp2pgkqvOBfd1ZMOmLbjUHt0jhypnIzu7TVwtTH7Ywsrx9F\n
uR9d4veYdW70IeQ64EhUG3RJBGG++AYJZCOjgEfbCwAYe/NoX/YVu+aMreHMR/+0\n
CV0YXKvHZgytcwZIc5WkQYaSWQA9lDWZzt5XjCErCATfiGEQ0k02QgpEfNTXxwQs\n
kfxh//O/qbfOWmloGwVU/2NY+5z3ZW8/eCksmiL1gGAYQAd+9+WI7BsCAwEAAaOC\n
Au4wggLqMAkGA1UdEwQCMAAwCwYDVR0PBAQDAgOoMBMGA1UdJQQMMAoGCCsGAQUF\n
BwMBMB0GA1UdDgQWBBR2zHzb71ZOHSwDZk28L9It3PvOtzAfBgNVHSMEGDAWgBTr\n
QjTQmLCrn/Qbawj3zGQu7w4sRTA0BgNVHREELTArghp0ZXN0LWNvbm5lY3QuZm9y\n
Z2Vyb2NrLmNvbYINZm9yZ2Vyb2NrLmNvbTCCAVYGA1UdIASCAU0wggFJMAgGBmeB\n
DAECATCCATsGCysGAQQBgbU3AQIDMIIBKjAuBggrBgEFBQcCARYiaHR0cDovL3d3\n
dy5zdGFydHNzbC5jb20vcG9saWN5LnBkZjCB9wYIKwYBBQUHAgIwgeowJxYgU3Rh\n
cnRDb20gQ2VydGlmaWNhdGlvbiBBdXRob3JpdHkwAwIBARqBvlRoaXMgY2VydGlm\n
aWNhdGUgd2FzIGlzc3VlZCBhY2NvcmRpbmcgdG8gdGhlIENsYXNzIDEgVmFsaWRh\n
dGlvbiByZXF1aXJlbWVudHMgb2YgdGhlIFN0YXJ0Q29tIENBIHBvbGljeSwgcmVs\n
aWFuY2Ugb25seSBmb3IgdGhlIGludGVuZGVkIHB1cnBvc2UgaW4gY29tcGxpYW5j\n
ZSBvZiB0aGUgcmVseWluZyBwYXJ0eSBvYmxpZ2F0aW9ucy4wNQYDVR0fBC4wLDAq\n
oCigJoYkaHR0cDovL2NybC5zdGFydHNzbC5jb20vY3J0MS1jcmwuY3JsMIGOBggr\n
BgEFBQcBAQSBgTB/MDkGCCsGAQUFBzABhi1odHRwOi8vb2NzcC5zdGFydHNzbC5j\n
b20vc3ViL2NsYXNzMS9zZXJ2ZXIvY2EwQgYIKwYBBQUHMAKGNmh0dHA6Ly9haWEu\n
c3RhcnRzc2wuY29tL2NlcnRzL3N1Yi5jbGFzczEuc2VydmVyLmNhLmNydDAjBgNV\n
HRIEHDAahhhodHRwOi8vd3d3LnN0YXJ0c3NsLmNvbS8wDQYJKoZIhvcNAQEFBQAD\n
ggEBAKVOAHtXTrgISj7XvE4/lLxAfIP56nlhpoLu8CqVlLK6eK4zCQRyTiFYx3xq\n
VQMSNVgQIdimjEsMz8o5/fDrCrozsT6sqxIPFsdgdskPyz9YyC9Y/AVBuECxabQr\n
B//0STicfdPg8PuDYtI64/INA47d/gtb57RaTFYxKs6bU8vtObinDJCwT33x4tvt\n
ob18DwB3/PeTbWyVUIxB0nvfm89dys0SF2alaA/bLuy0B7rdlppd4dOMpmiD0tnI\n
DORtr5HOD1xGiixZWzA1V2pTmF/hJZbhmEgBUSIyPK5Z9pZPephMf+/KrovbQqKr\n
6SEjgs7dGwpo6fA2mfCH5cCrid0=\n
-----END CERTIFICATE-----",
        "-----BEGIN CERTIFICATE-----\n
MIIDdTCCAl2gAwIBAgILBAAAAAABFUtaw5QwDQYJKoZIhvcNAQEFBQAwVzELMAkG\n
A1UEBhMCQkUxGTAXBgNVBAoTEEdsb2JhbFNpZ24gbnYtc2ExEDAOBgNVBAsTB1Jv\n
b3QgQ0ExGzAZBgNVBAMTEkdsb2JhbFNpZ24gUm9vdCBDQTAeFw05ODA5MDExMjAw\n
MDBaFw0yODAxMjgxMjAwMDBaMFcxCzAJBgNVBAYTAkJFMRkwFwYDVQQKExBHbG9i\n
YWxTaWduIG52LXNhMRAwDgYDVQQLEwdSb290IENBMRswGQYDVQQDExJHbG9iYWxT\n
aWduIFJvb3QgQ0EwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDaDuaZ\n
jc6j40+Kfvvxi4Mla+pIH/EqsLmVEQS98GPR4mdmzxzdzxtIK+6NiY6arymAZavp\n
xy0Sy6scTHAHoT0KMM0VjU/43dSMUBUc71DuxC73/OlS8pF94G3VNTCOXkNz8kHp\n
1Wrjsok6Vjk4bwY8iGlbKk3Fp1S4bInMm/k8yuX9ifUSPJJ4ltbcdG6TRGHRjcdG\n
snUOhugZitVtbNV4FpWi6cgKOOvyJBNPc1STE4U6G7weNLWLBYy5d4ux2x8gkasJ\n
U26Qzns3dLlwR5EiUWMWea6xrkEmCMgZK9FGqkjWZCrXgzT/LCrBbBlDSgeF59N8\n
9iFo7+ryUp9/k5DPAgMBAAGjQjBAMA4GA1UdDwEB/wQEAwIBBjAPBgNVHRMBAf8E\n
BTADAQH/MB0GA1UdDgQWBBRge2YaRQ2XyolQL30EzTSo//z9SzANBgkqhkiG9w0B\n
AQUFAAOCAQEA1nPnfE920I2/7LqivjTFKDK1fPxsnCwrvQmeU79rXqoRSLblCKOz\n
yj1hTdNGCbM+w6DjY1Ub8rrvrTnhQ7k4o+YviiY776BQVvnGCv04zcQLcFGUl5gE\n
38NflNUVyRRBnMRddWQVDf9VMOyGj/8N7yy5Y0b2qvzfvGn9LhJIZJrglfCm7ymP\n
AbEVtQwdpf5pLGkkeB6zpxxxYu7KyJesF12KwvhHhm4qxFYxldBniYUr+WymXUad\n
DKqC5JlR3XC321Y9YeRq4VzW9v493kHMB65jUr9TU/Qr6cf9tveCX4XSQRjbgbME\n
HMUfpIBvFSDJ3gyICh3WZlXi/EjJKSZp4A==\n
-----END CERTIFICATE-----"
    ],
    "privateKey": "-----BEGIN RSA PRIVATE KEY-----\n
zDot5q3vP9YjCihMZMkSa0zT2Zt+8S+mC0EVuYuTVhVpqrVNtkP1mlt+CYqmDffY\n
sGuD6SMrT6+SeAzX2uYFgY4+s8yaRWBcr0C5Z7yihilM6BK+IJ4is9kaW5VFr1Ph\n
wRKvSeFHBGh2wLNpjVSNPzLMDZBtkVi9Ny/xD5C3M1Gah0PGmnrPGCP8tr1Lshv4\n
PxYJwzHzouTdQDkLYlCjMN++NmIYfx7zrbEYV4VzXMxgNq7d3+d5dlVfE8xpAjSR\n
Lqlamib+doe1oWOQ2WiS6baBAH+Gw5rgqfwhJbCY/UlbCpuJ6kl7TLvTrFp8YpvB\n
Iv1GD0yuwSued3a+AxMFuIzTBYd2rC6rHq+eF4eHd/Q/Sbm9+9VuW/h8dW3LGvbE\n
5SUUhNw6uSkOZmZ0z/+FLbwoLPCASukY9biSd+12KJf4N42WZxID+9mJTp1j/Bv7\n
n29oGfZ3vav8PqG+F987hSyWEIdGTMfIxwaUrdYe1fmbUCxv0suMcYTRbAs9g3cm\n
eCNxbZBYC/fL+Nlj5NjZ+gxA/tEXV7wWynPZW3mZny6fQpDTDMslqsoFZR+rAUzH\n
ViePuLbCdxIC5heUyqvDBbeOzgQWOu6SZjX+mAQpo0DPKt1KDP4DKv9EW92sIwW3\n
AnFg98sje0DZ+zfsnevGioQMJrG0JSnqTYADxHaauu7NWndkfMZisfNIKA0u+ajU\n
AbP8xFXIP5JU8O4tWmlbxAbMOYfrZHabFNZx4DH1OVOJqdJIVx0KER0GSZd50D6W\n
QBzCfEbwMlJ17OB0AgWzNrbaak3MCmW1mh7OecjQwge1ajy7ho+JtQ==\n
-----END RSA PRIVATE KEY-----"
 }' \
 "https://localhost:8443/openidm/security/keystore/cert"
    </strong>
    <em>
{
    "_id": "openidm-localhost"
}
    </em>
   </pre></div><p>
    If the import is successful, the command returns the alias of the keystore
    to which the signed certificate was added.
   </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="security-endpoints"></a>15.1.3.&nbsp;Security Management Service Endpoints</h3></div></div></div><p>
     The OpenIDM security management service includes the following endpoints:
     </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="filename">openidm/security/keystore</code></p></li><li class="listitem"><p><code class="filename">openidm/security/truststore</code></p></li></ul></div><p>
    </p><p>
     You can use these endpoints to READ the contents on the keystore and
     truststore.
    </p><p>
     In addition, you can use these endpoints to perform related actions such as
     <code class="literal">generateCert</code> and <code class="literal">generateCSR</code>.
    </p><p>
     When you set up an <code class="literal">_action</code> request on either endpoint,
     you need to include all properties, including <code class="literal">alias</code>,
     in the request data.
    </p><p>
     The alias is not provided in the URL; it is available in the data object.
     For example, you might include <code class="literal">"alias" : "openidm-localhost"</code>
     within a <code class="literal">--data '{ "alias" : "openidm-localhost" }' </code>
     option.
    </p><p>
     Certificates and private keys are associated with the following endpoints:
     <code class="literal">openidm/security/keystore/cert</code>,
     <code class="literal">openidm/security/keystore/privatekey</code>, and
     <code class="literal">openidm/security/truststore/cert</code>.
    </p><p>
     All CRUD requests on such certificates and private/public keys use these
     endpoints.
    </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="security-precautions"></a>15.2.&nbsp;Security Precautions for a Production Environment</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="chap-security.html#security-ssl-https">15.2.1. Use SSL and HTTPS</a></span></dt><dt><span class="section"><a href="chap-security.html#rest-over-https">15.2.2. Restrict REST Access to the HTTPS Port</a></span></dt><dt><span class="section"><a href="chap-security.html#security-encrypt-data">15.2.3. Encrypt Data Internally and Externally</a></span></dt><dt><span class="section"><a href="chap-security.html#security-messages">15.2.4. Use Message Level Security</a></span></dt><dt><span class="section"><a href="chap-security.html#security-replace-defaults">15.2.5. Replace Default Security Settings</a></span></dt><dt><span class="section"><a href="chap-security.html#security-jetty">15.2.6. Secure Jetty</a></span></dt><dt><span class="section"><a href="chap-security.html#security-urls">15.2.7. Protect Sensitive REST Interface URLs</a></span></dt><dt><span class="section"><a href="chap-security.html#security-files">15.2.8. Protect Sensitive Files &amp; Directories</a></span></dt><dt><span class="section"><a href="chap-security.html#security-bootstrap">15.2.9. Obfuscate Bootstrap Information</a></span></dt><dt><span class="section"><a href="chap-security.html#security-remove-dev-tools">15.2.10. Remove or Protect Development &amp; Debug Tools</a></span></dt><dt><span class="section"><a href="chap-security.html#security-protect-repo">15.2.11. Protect the OpenIDM Repository</a></span></dt><dt><span class="section"><a href="chap-security.html#security-adjust-log-levels">15.2.12. Adjust Log Levels</a></span></dt><dt><span class="section"><a href="chap-security.html#security-run-as-service">15.2.13. Set Up Restart At System Boot</a></span></dt></dl></div><p>
   Out of the box, OpenIDM is set up for ease of development and deployment.
   When you deploy OpenIDM in production, there are specific precautions you
   should take to minimize security breaches. After following the guidance in
   this section, make sure that you test your installation to verify that it
   behaves as expected before putting it into production.
  </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="security-ssl-https"></a>15.2.1.&nbsp;Use SSL and HTTPS</h3></div></div></div><a class="indexterm" name="d0e14249"></a><p>We recommend that you disable plain HTTP access, as
  described in the section titled <a href="../../integrators-guide/index/chap-security.html#security-jetty" class="link"><em class="citetitle">Secure
  Jetty</em></a>.</p><p>
   Use TLS/SSL to access OpenIDM, ideally with mutual authentication so that
   only trusted systems can invoke each other. TLS/SSL protects data on the
   network. Mutual authentication with strong certificates, imported into the
   trust and keystores of each application, provides a level of confidence for
   trusting application access.
  </p><p>Augment this protection with message level security where
  appropriate.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="rest-over-https"></a>15.2.2.&nbsp;Restrict REST Access to the HTTPS Port</h3></div></div></div><p>
   When possible, use a certificate to secure REST access, over HTTPS. For
   production, that certificate should be signed by a certificate authority.
  </p><p>
   OpenIDM generates a self-signed certificate when it first starts up. You can
   use this certificate to test secure REST access.
  </p><p>
   While not recommended for production, you can test secure REST access using
   the default self-signed certificate. To do so, you can create a self-signed
   certificate file, <code class="filename">self-signed.crt</code>, using the following
   procedure:
  </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
     Extract the certificate that is generated when OpenIDM starts up.
    </p><div class="screen"><pre>$ openssl s_client -showcerts -connect localhost:8443 &lt;/dev/null</pre></div><p>
     This command outputs the entire certificate to the terminal.
    </p></li><li class="step"><p>
     Using any text editor, create a file named
     <code class="filename">self-signed.crt</code>. Copy the portion of the certificate
     from <code class="literal">-----BEGIN CERTIFICATE-----</code> to
     <code class="literal">----END CERTIFICATE-----</code> and paste it into the
     <code class="filename">self-signed.crt</code> file, which should appear similar to
     the following:
    </p><div class="screen"><pre>
$ <strong>more self-signed.crt</strong>
<em>-----BEGIN CERTIFICATE-----
MIIB8zCCAVygAwIBAgIETkvDjjANBgkqhkiG9w0BAQUFADA+MSgwJgYDVQQKEx9P
cGVuSURNIFNlbGYtU2lnbmVkIENlcnRpZmljYXRlMRIwEAYDVQQDEwlsb2NhbGhv
c3QwHhcNMTEwODE3MTMzNTEwWhcNMjEwODE3MTMzNTEwWjA+MSgwJgYDVQQKEx9P
cGVuSURNIFNlbGYtU2lnbmVkIENlcnRpZmljYXRlMRIwEAYDVQQDEwlsb2NhbGhv
c3QwgZ8wDQYJKoZIhvcNAQEBBQADgY0AMIGJAoGBAKwMkyvHS5yHAnI7+tXUIbfI
nQfhcTChpWNPTHc/cli/+Ta1InTpN8vRScPoBG0BjCaIKnVVl2zZ5ya74UKgwAVe
oJQ0xDZvIyeC9PlvGoqsdtH/Ihi+T+zzZ14oVxn74qWoxZcvkG6rWEOd42QzpVhg
wMBzX98slxkOZhG9IdRxAgMBAAEwDQYJKoZIhvcNAQEFBQADgYEASo4qMI0axEKZ
m0jU4yJejLBHydWoZVZ8fKcHVlD/rTirtVgWsVgvdr3yUr0Idk1rH1nEF47Tzn+V
UCq7qJZ75HnIIeVrZqmfTx8169paAKAaNF/KRhTE6ZII8+awst02L86shSSWqWz3
s5xPB2YTaZHWWdzrPVv90gL8JL/N7/Q=
-----END CERTIFICATE-----</em>
    </pre></div></li><li class="step"><p>
     Test REST access on the HTTPS port, referencing the self-signed certificate
     in the command. For example:
    </p><div class="screen"><pre><strong>$ curl \
 --header "X-OpenIDM-Username:openidm-admin" \
 --header "X-OpenIDM-Password:openidm-admin" \
 --cacert self-signed.crt \
 --request GET \
 "https://localhost:8443/openidm/managed/user/?_queryId=query-all-ids"</strong>
     <em>{
    "result": [],
    "resultCount": 0,
    "pagedResultsCooke": null,
    "remainingPagedResuts": -1
}    </em></pre></div></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="security-encrypt-data"></a>15.2.3.&nbsp;Encrypt Data Internally and Externally</h3></div></div></div><a class="indexterm" name="d0e14319"></a><a class="indexterm" name="d0e14324"></a><p>Beyond relying on end-to-end availability of TLS/SSL to protect
  data, OpenIDM also supports explicit encryption of data that goes on the
  network. This can be important if the TLS/SSL termination happens prior to
  the final endpoint.</p><p>OpenIDM also supports encryption of data stored in the repository,
  using a symmetric key. This protects against some attacks on the data
  store. Explicit table mapping is supported for encrypted string values.</p><p>OpenIDM automatically encrypts sensitive data in configuration files,
  such as passwords. OpenIDM replaces clear text values when the system first
  reads the configuration file. Take care with configuration files having
  clear text values that OpenIDM has not yet read and updated.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="security-messages"></a>15.2.4.&nbsp;Use Message Level Security</h3></div></div></div><a class="indexterm" name="d0e14336"></a><p>OpenIDM supports message level security, forcing authentication before
  granting access. Authentication works by means of a filter-based mechanism
  that lets you use either an HTTP Basic like mechanism or OpenIDM-specific 
  headers, setting a cookie in the response that you can use for subsequent 
  authentication. If you attempt to access OpenIDM URLs without the appropriate 
  headers or session cookie, OpenIDM returns HTTP 401 Unauthorized, or HTTP 403
  Forbidden, depending on the situation. If you use a session cookie, you must
  include an additional header that indicates the origin of the request.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="security-messages-auth"></a>15.2.4.1.&nbsp;Message Level Security with Logins</h4></div></div></div><p>The following examples show successful authentications.</p><div class="screen"><pre>
$ <strong>curl \
 --cacert self-signed.crt \
 --dump-header /dev/stdout \
 --user openidm-admin:openidm-admin \
 "https://localhost:8443/openidm/managed/user?_queryId=query-all-ids"</strong>
   <em>
HTTP/1.1 200 OK
Content-Type: application/json; charset=UTF-8
Cache-Control: no-cache
Set-Cookie: session-jwt=2l0zobpuk6st1b2m7gvhg5zas ...;Path=/
Expires: Thu, 01 Jan 1970 00:00:00 GMT
Vary: Accept-Encoding, User-Agent
Content-Length: 82
Server: Jetty(8.y.z-SNAPSHOT)

{"result":[],"resultCount":"0","pagedResultsCookie":null,"remainingPagedResults":-1}
   </em>

$ <strong>curl \
 --cacert self-signed.crt \
 --dump-header /dev/stdout \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 "https://localhost:8443/openidm/managed/user?_queryId=query-all-ids"</strong>
   <em>
HTTP/1.1 200 OK
Content-Type: application/json; charset=UTF-8
Cache-Control: no-cache
Set-Cookie: session-jwt=2l0zobpuk6st1b2m7gvhg5zas ...;Path=/
Expires: Thu, 01 Jan 1970 00:00:00 GMT
Vary: Accept-Encoding, User-Agent
Content-Length: 82
Server: Jetty(8.y.z-SNAPSHOT)

{"result":[],"resultCount":"0","pagedResultsCookie":null,"remainingPagedResults":-1}
   </em>

$ <strong>curl \
 --dump-header /dev/stdout \
 --cacert self-signed.crt \
 --header "Cookie: session-jwt=2l0zobpuk6st1b2m7gvhg5zas ..." \
 --header "X-Requested-With: OpenIDM Plugin" \
 "https://localhost:8443/openidm/managed/user?_queryId=query-all-ids"</strong>
   <em>
Expires: Thu, 01 Jan 1970 00:00:00 GMT
Content-Type: application/json; charset=UTF-8
Cache-Control: no-cache
Vary: Accept-Encoding, User-Agent
Content-Length: 82
Server: Jetty(8.y.z-SNAPSHOT)
   </em>
  </pre></div><p>Notice that the last example uses the cookie OpenIDM set in the
  response to the previous request, and includes the
  <code class="literal">X-Requested-With</code> header to indicate the origin of the
  request. The value of the header can be any string, but should be informative
  for logging purposes. If you do not include the
  <code class="literal">X-Requested-With</code> header, OpenIDM returns HTTP 403
  Forbidden.</p><div class="note"><h3 class="title">Note</h3><p>
     The careful readers among you may notice that the expiration date of the
     JWT cookie, January 1, 1970, corresponds to the start of UNIX time. Since
     that time is in the past, browsers will not store that cookie after the
     browser is closed.
    </p></div><p>You can also request one-time authentication without a session.</p><div class="screen"><pre>
$ <strong>curl \
 --dump-header /dev/stdout \
 --cacert self-signed.crt \
 --header "X-OpenIDM-NoSession: true" \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 "https://localhost:8443/openidm/managed/user?_queryId=query-all-ids"</strong>
   <em>
HTTP/1.1 200 OK
Content-Type: application/json; charset=UTF-8
Cache-Control: no-cache
Vary: Accept-Encoding, User-Agent
Content-Length: 82
Server: Jetty(8.y.z-SNAPSHOT)

{"result":[],"resultCount":"0","pagedResultsCookie":null,"remainingPagedResults":-1}
   </em>
  </pre></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="security-messages-logout"></a>15.2.4.2.&nbsp;Logout By Removing the JWT Cookie</h4></div></div></div><p>
   OpenIDM maintains sessions with a JWT session cookie, stored in a client
   browser. To log out and destroy the session, you would access and remove that
   cookie from the client browser.
  </p><p>
   The JWT session cookie is based on the <code class="literal">JWT_SESSION</code> module
   documented in <a href="../../integrators-guide/index/chap-auth.html#supported-auth-modules" class="link">
   <em class="citetitle">Supported Authentication Modules</em></a>.
  </p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="security-replace-defaults"></a>15.2.5.&nbsp;Replace Default Security Settings</h3></div></div></div><a class="indexterm" name="d0e14407"></a><p>The default security settings are adequate for evaluation purposes. For 
  production, change the default encryption key, and then replace the default user 
  password.</p><div class="procedure"><a name="security-change-encryption-keys"></a><div class="procedure-title">Procedure&nbsp;15.1.&nbsp;To Change Default Encryption Keys</div><a class="indexterm" name="d0e14415"></a><a class="indexterm" name="d0e14418"></a><p>By default, OpenIDM uses a symmetric encryption key with alias
   <code class="literal">openidm-sym-default</code>. Change this default key before
   deploying OpenIDM in production.</p><p>
    As noted in the section on the<a href="../../integrators-guide/index/chap-cli.html#cli-keytool" class="link">
    <em class="citetitle">keytool</em></a> command, the default keystore
    password is <code class="literal">changeit</code>.
   </p><ol class="procedure" type="1"><li class="step"><p>Add the new key to the keystore.</p><div class="screen"><pre><strong>$ cd /path/to/openidm/
$ keytool \
 -genseckey \
 -alias new-sym-key \
 -keyalg AES \
 -keysize 128 \
 -keystore security/keystore.jceks \
 -storetype JCEKS</strong>
    <em>Enter keystore password:
Enter key password for &lt;new-sym-key&gt;
  (RETURN if same as keystore password):
Re-enter new password:</em></pre></div><p>Additional options associated with the <span class="command"><strong>keytool</strong></span>
     command in OpenIDM are shown in the following file:
    <code class="filename">openidm/samples/security/keystore_readme.txt</code>.</p></li><li class="step"><p>Change the alias used in
    <code class="filename">openidm/conf/boot/boot.properties</code>.</p></li></ol></div><div class="procedure"><a name="security-replace-default-user-password"></a><div class="procedure-title">Procedure&nbsp;15.2.&nbsp;To Replace the Default User &amp; Password</div><p>After changing the default encryption key, change at least the default
   user password.</p><ol class="procedure" type="1"><li class="step"><p>Use the <span class="command"><strong>encrypt</strong></span> command to obtain the encrypted 
    version of the new password.</p><div class="screen"><pre>
$ <strong>cd /path/to/openidm/</strong>
$ <strong>cli.sh encrypt newpwd</strong>
     <em>
...
-----BEGIN ENCRYPTED VALUE-----
{
  "$crypto" : {
    "value" : {
      "iv" : "TCoC/YrmiRmINw6jCPB5LQ==",
      "data" : "nCFvBIApIQ7C6k+UPzosaA==",
      "cipher" : "AES/CBC/PKCS5Padding",
      "key" : "openidm-sym-default"
    },
    "type" : "x-simple-encryption"
  }
}
------END ENCRYPTED VALUE------
     </em>
    </pre></div></li><li class="step"><p>Replace the user object in the
    <code class="filename">openidm/db/scripts/mysql/openidm.sql</code> script before
    setting up MySQL as a repository for OpenIDM.</p><p>Alternatively, replace the user in the internal user table.</p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="security-jetty"></a>15.2.6.&nbsp;Secure Jetty</h3></div></div></div><a class="indexterm" name="d0e14494"></a><p>
   If you do not want to use regular HTTP on a production OpenIDM system, edit
   the <code class="filename">openidm/conf/jetty.xml</code> configuration file. Comment
   out the line that enables regular HTTP.
  </p><p>
   The following excerpt includes the Java comment code that you would add
   around the <code class="literal">openidm.port.http</code> argument. The value of this
   argument (8080 by default) is taken from the
   <code class="filename">conf/boot/boot.properties</code> file and the
   <code class="filename">conf/config.properties</code> file.
  </p><pre class="brush: xml;">
&lt;Call name="addConnector&gt;
  &lt;Arg&gt;
    &lt;New class="org.eclipse.jetty.server.nio.SelectChannelConnector"&gt;
      &lt;Set name="host"&gt;&lt;Property name="jetty.host" /&gt;&lt;/Set&gt;
&lt;!-- &lt;Set name="port"&gt;&lt;Call class="org.forgerock.openidm.jetty.Param"
          name="getProperty"&lt;Arg&gt;openidm.port.http&lt;/Arg&gt;&lt;/Call&gt;&lt;/Set&gt;  --&gt;
        &lt;Set name="maxIdleTime"&gt;300000&lt;/Set&gt;
        &lt;Set name="Acceptors"&gt;2&lt;/Set&gt;
        &lt;Set name="statsOn"&gt;false&lt;/Set&gt;
        &lt;Set name="confidentialPort"&gt;
          &lt;Call class="org.forgerock.openidm.jetty.Param" name="getProperty"&gt;
            &lt;Arg&gt;openidm.port.https&lt;/Arg&gt;
          &lt;/Call&gt;
        &lt;/Set&gt;
      &lt;/New&gt;
   &lt;/Arg&gt;
&lt;/Call&gt;</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="security-urls"></a>15.2.7.&nbsp;Protect Sensitive REST Interface URLs</h3></div></div></div><p>
   Anything attached to the router is accessible with the default policy,
   including the repository. If you do not need such access,
   deny it in the authorization policy to reduce the attack surface.
  </p><p>
   In addition, you can deny direct HTTP access to system objects in production,
   particularly access to <code class="literal">action</code>. As a rule of thumb, do not
   expose anything that is not used in production. The main public interfaces
   over HTTP are <code class="literal">/openidm/managed/</code> and
   <code class="literal">/openidm/config/</code>. Other URIs are triggered indirectly,
   or are used for internal consumption.
  </p><p>OpenIDM supports native query expressions on the repository, and it is
   possible to enable these over HTTP, for example, the following query should
   identify managed users in an OrientDB repository:</p><div class="screen"><pre>
$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 "https://localhost:8443/openidm/managed/user?_queryExpression=select+*+from+managed_user"</strong></pre></div><p>
   By default, direct HTTP access to native queries is disallowed, and should
   remain so in production systems.
  </p><p>
   For testing or development purposes, it can be helpful to enable native
   queries on the repository over HTTP. To do so, edit the access
   control configuration file (<code class="filename">access.js</code>). In that file,
   remove any instances of <code class="literal">"disallowQueryExpression()"</code>
   such as the following:
  </p><pre class="brush: javascript;">
{
    "pattern"   : "*",
    "roles"     : "openidm-admin",
    "methods"   : "*", // default to all methods allowed
    "actions"   : "*", // default to all actions allowed
 // "customAuthz" : "disallowQueryExpression()",
    "excludePatterns": "system/*"
},
...
{
    "pattern"   : "system/*",
    "roles"     : "openidm-admin",
    "methods"   : "create,read,update,delete,patch,query", // restrictions on 'action'
    "actions"   : ""
 // "customAuthz" : "disallowQueryExpression()"
},
...
 "customAuthz" : "ownDataOnly() &amp;&amp;
    managedUserRestrictedToAllowedProperties('"+allowedPropertiesForManagedUser+"')",
    // &amp;&amp; disallowQueryExpression()"


  </pre><p>See the chapter on <a href="../../integrators-guide/index/chap-auth.html" class="link"><em class="citetitle">Managing
  Authentication, Authorization &amp; RBAC</em></a> for an example
  showing how to protect sensitive URLs.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="security-files"></a>15.2.8.&nbsp;Protect Sensitive Files &amp; Directories</h3></div></div></div><p>Protect OpenIDM files from access by unauthorized users.</p><p>In particular, prevent other users from reading files in at least the
  <code class="filename">openidm/conf/boot/</code> and
  <code class="filename">openidm/security/</code> directories.</p><p>
   The objective is to limit access to the user that is running the service.
   Depending on the operating system and configuration, that user might be
   <code class="filename">root</code>, <code class="filename">Administrator</code>,
   <code class="filename">openidm</code>, or something similar.
  </p><div class="procedure"><a name="security-files-unix"></a><div class="procedure-title">Procedure&nbsp;15.3.&nbsp;Protecting key files in Unix</div><ol class="procedure" type="1"><li class="step"><p>
      For the target directory, and the files therein, make sure user and
      group ownership is limited to the user that is running the OpenIDM
      service.
     </p></li><li class="step"><p>
      Disable access of any sort for <code class="literal">other</code>
      users. One simple command for that purpose, from the
      <code class="filename">/path/to/openidm</code> directory, is:
     </p><div class="screen"><pre># chmod -R o-rwx .</pre></div></li></ol></div><div class="procedure"><a name="security-files-windows"></a><div class="procedure-title">Procedure&nbsp;15.4.&nbsp;Protecting key files in Windows</div><ol class="procedure" type="1"><li class="step"><p>
     The OpenIDM process in Windows is normally run by the
     <code class="literal">Administrator</code> user.
    </p></li><li class="step"><p>
     If you are concerned about the security of the administrative account,
     you can <code class="literal">Deny</code> permissions on the noted directories to
     existing users, or alternatively the <code class="literal">Users</code> group.
    </p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="security-bootstrap"></a>15.2.9.&nbsp;Obfuscate Bootstrap Information</h3></div></div></div><p>
   OpenIDM uses the information in <code class="filename">conf/boot/boot.properties</code>,
   including the keystore password, to start up. The keystore password is
   <code class="literal">changeit</code> by default, and is stored in clear text in the
   <code class="filename">boot.properties</code> file. To set an obfuscated version of
   the keystore password in the <code class="filename">boot.properties</code> file,
   follow these steps.
  </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
     Generate an obfuscated version of the password, by using the crypto bundle
     provided with OpenIDM:
    </p><div class="screen"><pre>
     <strong>
$ java -jar /path/to/openidm/bundle/openidm-crypto-3.1.0-SNAPSHOT.jar
     </strong>
     <em>
This utility helps obfuscate passwords to prevent casual observation.
It is not securely encrypted and needs further measures to prevent disclosure.
Please enter the password:
OBF:1vn21ugu1saj1v9i1v941sar1ugw1vo0
CRYPT:a8b5a01ba48a306f300b62a1541734c7
     </em>
    </pre></div></li><li class="listitem"><p>
     Paste the obfuscated password (<code class="literal">OBF:xxxxxxx</code>) and the
     cryptographic key (<code class="literal">CRYPT:xxxxxxx</code>) into the
     <code class="filename">conf/boot/boot.properties</code> file. Comment out the
     regular keystore password and remove the comment tags from the lines that
     contain the obfuscated password and the cryptographic key:
    </p><div class="screen"><pre>
$ <strong>more conf/boot/boot.properties</strong>
     <em>
...
# Keystore password, adjust to match your keystore and protect this file
# openidm.keystore.password=changeit
openidm.truststore.password=changeit

# optionally use the cli encrypt to obfuscate the password and set
openidm.keystore.password=OBF:1vn21ugu1saj1v9i1v941sar1ugw1vo0
openidm.keystore.password=CRYPT:a8b5a01ba48a306f300b62a1541734c7
...  </em>
    </pre></div></li><li class="listitem"><p>
     Restart OpenIDM.
    </p><div class="screen"><pre>$ ./startup.sh</pre></div></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="security-remove-dev-tools"></a>15.2.10.&nbsp;Remove or Protect Development &amp; Debug Tools</h3></div></div></div><p>Before deploying OpenIDM in production, remove or protect development
  and debug tools, including the OSGi console exposed under
  <code class="literal">/system/console</code>. Authentication for this console is not
  integrated with authentication for OpenIDM.</p><p>To remove the OSGi console, remove the web console bundle,
  <code class="filename">org.apache.felix.webconsole-<em class="replaceable"><code>version</code></em>.jar</code>.</p><p>If you cannot remove the OSGi console, then protect it by overriding
  the default <code class="literal">admin:admin</code> credentials. Create a file called
  <code class="filename">openidm/conf/org.apache.felix.webconsole.internal.servlet.OsgiManager.cfg</code>
  containing the user name and password to access the console in Java
  properties file format.</p><pre class="brush: ini;">
username=user-name
password=password</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="security-protect-repo"></a>15.2.11.&nbsp;Protect the OpenIDM Repository</h3></div></div></div><p>Use the JDBC or MSSQL repositories. OrientDB is not yet supported for
  production use.</p><p>Use a strong password for the JDBC connection. Do not rely on default
  passwords.</p><p>Use a case sensitive database, particularly if you work with systems
  with different identifiers that match except for case. Otherwise correlation
  queries can pick up identifiers that should not be considered the same.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="security-adjust-log-levels"></a>15.2.12.&nbsp;Adjust Log Levels</h3></div></div></div><p>Leave log levels at <code class="literal">INFO</code> in production to ensure
  that you capture enough information to help diagnose issues. See the chapter
  on <a href="../../integrators-guide/index/chap-logs.html" class="link"><em class="citetitle">Configuring Server
  Logs</em> for more information.</a>
  </p><p>At start up and shut down, <code class="literal">INFO</code> can produce many
  messages. Yet, during stable operation, <code class="literal">INFO</code> generally
  results in log messages only when coarse-grain operations such as
  scheduled reconciliation start or stop.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="security-run-as-service"></a>15.2.13.&nbsp;Set Up Restart At System Boot</h3></div></div></div><p>You can run OpenIDM in the background as a service (daemon), and
  add startup and shutdown scripts to manage the service at system boot
  and shutdown. For more information, see <a href="../../integrators-guide/index/chap-services.html" class="link"><em class="citetitle">Starting and 
  Stopping OpenIDM</em></a>.</p><p>See your operating system documentation for details on adding a
  service such as OpenIDM to be started at boot and shut down at system
  shutdown.</p></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="chap-auth.html">Prev</a>&nbsp;</td><td width="20%" align="center">&nbsp;</td><td width="40%" align="right">&nbsp;<a accesskey="n" href="chap-workflow.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter&nbsp;14.&nbsp;Managing Authentication, Authorization and Role-Based Access Control&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;16.&nbsp;Integrating Business Processes and Workflows</td></tr></table></div><p>&nbsp;</p><div id="footer"><p>Something wrong on this page? <a href="https://bugster.forgerock.org/jira/secure/CreateIssueDetails!init.jspa?pid=10020&components=10164&issuetype=1">Log a documentation bug.</a></p></div>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-23412190-9']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</body></html>