<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
   <title>Chapter&nbsp;14.&nbsp;Managing Authentication, Authorization and Role-Based Access Control</title><link rel="stylesheet" type="text/css" href="coredoc.css"><link rel="stylesheet" type="text/css" href="css/coredoc.css"><link rel="stylesheet" type="text/css" href="sh/shCore.css"><link rel="stylesheet" type="text/css" href="sh/shCoreEclipse.css"><link rel="stylesheet" type="text/css" href="sh/shThemeEclipse.css"><script src="http://code.jquery.com/jquery-1.11.0.min.js" type="text/javascript"></script><script src="uses-jquery.js" type="text/javascript"></script><script src="sh/shCore.js" type="text/javascript"></script><script src="sh/shBrushAci.js" type="text/javascript"></script><script src="sh/shBrushBash.js" type="text/javascript"></script><script src="sh/shBrushCsv.js" type="text/javascript"></script><script src="sh/shBrushHttp.js" type="text/javascript"></script><script src="sh/shBrushJava.js" type="text/javascript"></script><script src="sh/shBrushJScript.js" type="text/javascript"></script><script src="sh/shBrushLDIF.js" type="text/javascript"></script><script src="sh/shBrushPlain.js" type="text/javascript"></script><script src="sh/shBrushProperties.js" type="text/javascript"></script><script src="sh/shBrushXml.js" type="text/javascript"></script><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="OpenIDM Integrator's Guide"><link rel="up" href="index.html" title="OpenIDM Integrator's Guide"><link rel="prev" href="chap-passwords.html" title="Chapter&nbsp;13.&nbsp;Managing Passwords"><link rel="next" href="chap-security.html" title="Chapter&nbsp;15.&nbsp;Securing &amp; Hardening OpenIDM"><link rel="copyright" href="legalnotice.html" title="Legal Notice"><script type="text/javascript">SyntaxHighlighter.all();</script>
<link rel="shortcut icon" href="http://forgerock.org/favicon.ico">
</head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter&nbsp;14.&nbsp;Managing Authentication, Authorization and Role-Based Access Control</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="chap-passwords.html">Prev</a>&nbsp;</td><th width="60%" align="center">&nbsp;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="chap-security.html">Next</a></td></tr></table><hr></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-auth"></a>Chapter&nbsp;14.&nbsp;Managing Authentication, Authorization and Role-Based Access Control</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="section"><a href="chap-auth.html#openidm-users">14.1. OpenIDM Users</a></span></dt><dt><span class="section"><a href="chap-auth.html#openidm-authentication">14.2. Authentication</a></span></dt><dt><span class="section"><a href="chap-auth.html#passthrough-auth">14.3. Using Delegated Authentication</a></span></dt><dt><span class="section"><a href="chap-auth.html#supported-auth-modules">14.4. Supported Authentication Modules</a></span></dt><dt><span class="section"><a href="chap-auth.html#openidm-roles">14.5. Roles and Authentication</a></span></dt><dt><span class="section"><a href="chap-auth.html#openidm-authorization">14.6. Authorization</a></span></dt><dt><span class="section"><a href="chap-auth.html#user-group-role-auth-assignment">14.7. Building Role-Based Access Control (RBAC)</a></span></dt></dl></div><a class="indexterm" name="d0e12769"></a><a class="indexterm" name="d0e12772"></a><p>
  OpenIDM provides a flexible authentication and authorization mechanism, based
  on REST interface URLs and on roles which may be stored in the repository.
 </p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="openidm-users"></a>14.1.&nbsp;OpenIDM Users</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="chap-auth.html#internal-users">14.1.1. Internal Users</a></span></dt><dt><span class="section"><a href="chap-auth.html#managed-users">14.1.2. Managed Users</a></span></dt></dl></div><a class="indexterm" name="d0e12780"></a><a class="indexterm" name="d0e12785"></a><p>
   While OpenIDM authenticates internal and managed users with the
   <code class="literal">DELEGATED</code> module, there are differences between these
   two types of users.
  </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="internal-users"></a>14.1.1.&nbsp;Internal Users</h3></div></div></div><p>
    OpenIDM creates two internal users by default: <code class="literal">anonymous</code>
    and <code class="literal">openidm-admin</code>. These accounts are separated from
    other user accounts to protect them from any reconciliation or
    synchronization processes.
   </p><p>
    OpenIDM stores internal users and their role membership in a table in the
    repository. For the way internal users are mapped, see the discussion on
    the <code class="literal">explicitMapping</code> property to
    <code class="literal">"internal/user</code> described in <span class="olink"><em class="citetitle">Using Explicit
    Mappings</em></span>.
   </p><p>
    For more information on storage mechanisms for managed users in OrientDB
    and JDBC, see <a href="../../integrators-guide/index/chap-users-groups-roles.html#working-with-managed-users" class="link">
    <em class="citetitle">Working With Managed Users</em></a>.
   </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">anonymous</span></dt><dd><p>
       This user enables anonymous access to OpenIDM, for users who do not have
       their own accounts. The anonymous user, configured by default with the
       <code class="literal">openidm-reg</code> role, has limited rights within OpenIDM.
       It can be used to allow self-registration. For more information on the
       process, see <a href="../../integrators-guide/index/chap-ui.html#ui-self-registration" class="link">
       <em class="citetitle">Enabling Self-Registration</em></a>.
      </p></dd><dt><span class="term">openidm-admin</span></dt><dd><p>
       This user serves as the top-level administrator. After installation, the
       <code class="literal">openidm-admin</code> user has full access, and provides a
       fallback mechanism in case other users are locked out. Do not use
       <code class="literal">openidm-admin</code> for regular tasks. Under normal
       circumstances, the <code class="literal">openidm-admin</code> account does not
       represent a regular user, so any audit log records for this account do
       not represent the actions of any real person.
      </p><p>
       OpenIDM encrypts the default administrative password,
       <code class="literal">openidm-admin</code>. Change the password immediately after
       installation. For instructions, see
       <a href="../../integrators-guide/index/chap-security.html#security-replace-default-user-password" class="link">
       <em class="citetitle">To Replace the Default User and Password</em></a>.
      </p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="managed-users"></a>14.1.2.&nbsp;Managed Users</h3></div></div></div><a class="indexterm" name="d0e12868"></a><p>
    External users managed by OpenIDM are known as managed users.
   </p><p>
    The location of managed users depends on the type of repository. For
    JDBC repositories, OpenIDM stores managed users in the managed objects
    table, named <code class="literal">managedobjects</code>. OpenIDM may access an index
    table <code class="literal">managedobjectproperties</code> as well.
   </p><p>
    For the OrientDB repository, managed objects are stored in the table
    <code class="literal">managed_user</code>.
   </p><p>
    By default, the attribute names for managed user login and password are
    <code class="literal">userName</code> and <code class="literal">password</code>, respectively.
   </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="openidm-authentication"></a>14.2.&nbsp;Authentication</h2></div></div></div><p>
   OpenIDM does not allow access to the REST interface without authentication.
  </p><p>
   User self-registration requires anonymous access. For that purpose, OpenIDM
   includes an <code class="literal">anonymous</code> user, with the following password:
   <code class="literal">anonymous</code>. For more information, see
   <a class="xref" href="chap-auth.html#internal-users" title="14.1.1.&nbsp;Internal Users">Section&nbsp;14.1.1, &#8220;Internal Users&#8221;</a>.
  </p><p>
   In production, only applications are expected to access the REST interface.
  </p><div class="variablelist"><p>
    OpenIDM supports an improved authentication mechanism on the REST
    interface. Unlike basic authentication or form-based authentication, the
    OpenIDM authentication mechanism is compatible with the AJAX framework. You
    can configure authentication with standard or OpenIDM-specific header
    fields, as follows:
   </p><dl class="variablelist"><dt><span class="term">OpenIDM authentication with standard header fields</span></dt><dd><div class="screen"><pre>$ curl --user userName:password</pre></div><p>
      This method uses standard basic authentication. However, it does not
      prompt for missing credentials.
     </p></dd><dt><span class="term">OpenIDM authentication with OpenIDM header fields</span></dt><dd><div class="screen"><pre>$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"</pre></div></dd></dl></div><div class="note"><h3 class="title">Note</h3><p>
    This document uses the OpenIDM authentication options for all REST calls.
    Where no OpenIDM-specific options exist, the "long-form" option such as
    <span class="command"><strong>--data</strong></span> is used. In contrast, the README files that
    accompany OpenIDM generally use "short-form" options such as
    <span class="command"><strong>-X</strong></span> (instead of <span class="command"><strong>--request</strong></span>) and
    <span class="command"><strong>-H</strong></span> (instead of <span class="command"><strong>--header</strong></span>).
   </p></div><p>For more information about the OpenIDM authentication mechanism, see
   <a href="../../integrators-guide/index/chap-security.html#security-messages" class="link">
   <em class="citetitle">Use Message Level Security</em></a>.</p><p>
   You can change the attributes used by OpenIDM to store user login and
   password values. Attribute names are shown in a database query listed in
   <code class="filename">openidm/conf/repo.<em class="replaceable"><code>repo-type</code></em>.json</code>.
  </p><div class="variablelist"><p>Two queries are defined by default.</p><dl class="variablelist"><dt><span class="term"><code class="literal">credential-internaluser-query</code></span></dt><dd><p>Uses the <code class="literal">_openidm_id</code> attribute for login</p></dd><dt><span class="term"><code class="literal">credential-query</code></span></dt><dd><p>Uses the <code class="literal">userName</code> attribute for login</p></dd></dl></div><p>
   The <code class="filename">openidm/conf/authentication.json</code> file defines
   the active query with the <code class="literal">queryId</code> property. In the
   following example, <code class="literal">credential-query</code> is the
   <code class="literal">queryId</code> identifier used in a <code class="literal">queryRequest</code>
   to validate credentials.
  </p><pre class="brush: javascript;">
{
    "queryId" : "credential-query",
    "queryOnResource" : "managed/user",
...
}</pre><p>
  You can explicitly define the properties that constitute passwords or roles
  with the <code class="literal">propertyMapping</code> object in the
  <code class="filename">conf/authentication.json</code> file. The default property
  mapping is shown here:
 </p><pre class="brush: javascript;">
 ...
    "propertyMapping" : {
        "authenticationId" : "username",
        "userCredential" : "password",
        "userRoles" : "roles"
    },
 ... 
 </pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="passthrough-auth"></a>14.3.&nbsp;Using Delegated Authentication</h2></div></div></div><p>
   In addition to the internal and managed user authentication modules, OpenIDM
   3.0.0 supports a delegated authentication mechanism.
   With delegated authentication, the username and password included with the
   REST request are validated against those stored in a remote system, such as
   an LDAP server.
  </p><p>
   Delegated authentication for OpenIDM 3.0.0 includes the
   functionality associated with the <code class="literal">PASSTHROUGH</code>,
   <code class="literal">MANAGED_USER</code>, and <code class="literal">INTERNAL_USER</code>
   modules. OpenIDM 3.0.0 includes those modules as aliases
   for the <code class="literal">DELEGATED</code> module.
  </p><p>
   The samples listed in the <a href="../../install-guide/index/chap-samples.html" class="link"><em class="citetitle">OpenIDM
   Installation Guide</em></a> include multiple options for
   authentication mechanisms.
  </p><p>
   You can add the delegated authentication module to the
   <code class="filename">conf/authentication.json</code> file. For example, the
   following excerpt illustrates one way to implement the
   <code class="literal">DELEGATED</code> configuration object. For descriptive purposes,
   you can substitute the <code class="literal">PASSTHROUGH</code> alias for
   <code class="literal">DELEGATED</code>.
  </p><pre class="brush: javascript;">
"authModules" : [
   {
      "name" : "DELEGATED",
      "properties" : {
         "augmentSecurityContext": {
            "type" : "text/javascript",
            "file" : "auth/populateAsManagedUser.js"
         },
         "queryOnResource" : "system/ldap/account",
         "propertyMapping" : {
            "authenticationId" : "uid",
            "groupMembership" : "memberOf"
         },
         "groupRoleMapping" : {
            "openidm-admin" : ["cn=admins"]
         },
         "managedUserLink" : "systemLdapAccounts_managedUser",
         "defaultUserRoles" : [
            "openidm-authorized"
         ]
      },
      "enabled" : true
   },
   ...
]
  </pre><p>
   The properties shown from this excerpt are defined in
   <a class="xref" href="chap-auth.html#roles-auth-prop" title="14.6.3.&nbsp;Properties for Authentication and Roles">Section&nbsp;14.6.3, &#8220;Properties for Authentication and Roles&#8221;</a>
  </p><p>
   The content of the delegated authentication object varies. Samples
   2/2b/2c/2d, 3, 5, and 6 include slightly different versions of the
   <code class="filename">conf/authentication.json</code> file.
  </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Samples 2, 2b, 2c, 2d (LDAP)</span></dt><dd><p>
      Samples 2, 2b, 2c, and 2d relate to connections from an LDAP server.
      Samples 5 and 5b  are quite similar, as they uses XML information to
      masquerade as an LDAP server. The <code class="filename">authentication.json</code>
      file is identical in each of these samples.
     </p><p>
      In the common <code class="filename">authentication.json</code> file, the
      <code class="literal">queryOnResource</code> endpoint is
      <code class="literal">system/ldap/account</code>. The
      <code class="literal">managedUserLink</code> is
      <code class="literal">systemLdapAccounts_managedUser</code>.
     </p></dd><dt><span class="term">Sample 3 (Scripted SQL)</span></dt><dd><p>
      Sample 3 relates to a connection to a scripted SQL database. As such, the
      <code class="literal">queryOnResource</code> endpoint is
      <code class="literal">system/scriptedsql/account</code>. The
      <code class="literal">managedUserLink</code> is
      <code class="literal">systemHrdb_managedUser</code>.
     </p></dd><dt><span class="term">Sample 5, 5b (Synchronization of two resources)</span></dt><dd><p>
      The XML files used in samples 5 and 5b simulate a connection between LDAP
      servers. For that reason, the <code class="filename">conf/authentication.json</code>
      file used in these samples are identical to that for sample 2/2b/2c/2d.
     </p></dd><dt><span class="term">Sample 6 (LiveSync)</span></dt><dd><p>
      The <code class="literal">queryOnResource</code> endpoint is
      <code class="literal">system/ad/account</code>. The <code class="literal">autheticationId</code>
      matches the AD attribute used for account names. The associated
      <code class="literal">managedUserLink</code> is
      <code class="literal">systemAdAccounts_managedUser</code>.
     </p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="supported-auth-modules"></a>14.4.&nbsp;Supported Authentication Modules</h2></div></div></div><div class="variablelist"><p>
    OpenIDM supports a variety of modules, including those available from the
    Common Authentication Framework. OpenIDM also provides
    two additional authentication modules, <code class="literal">DELEGATED</code> and
    <code class="literal">CLIENT_CERT</code>.
   </p><dl class="variablelist"><dt><span class="term">JWT_SESSION</span></dt><dd><p>
      The JSON Web Token session authentication module. For more information
      on this common authentication module, see the <a class="link" href="http://commons.forgerock.org/forgerock-auth-filters/forgerock-authn-filter/forgerock-jaspi-modules/forgerock-jaspi-jwt-session-module/apidocs/org/forgerock/jaspi/modules/session/jwt/JwtSessionModule.html" target="_blank">
      <em class="citetitle">Class JwtSessionModule</em></a> Javadoc.
     </p></dd><dt><span class="term">CLIENT_CERT</span></dt><dd><p>
      Module for users who authenticate with a client certificate.
     </p></dd><dt><span class="term">DELEGATED</span></dt><dd><p>
      Module that validates client requests by passing through to an OpenICF
      connector. For OpenIDM 3.0.0, this is an alias for
      <code class="literal">MANAGED_USER</code>, <code class="literal">INTERNAL_USER</code>, and
      <code class="literal">PASSTHROUGH</code>.
     </p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="openidm-roles"></a>14.5.&nbsp;Roles and Authentication</h2></div></div></div><a class="indexterm" name="d0e13187"></a><a class="indexterm" name="d0e13192"></a><p>
   OpenIDM includes a number of default roles, and supports the configuration of
   managed roles, enabling you to customize the roles mechanism as needed.
  </p><div class="variablelist"><p>The following roles are configured by default:</p><dl class="variablelist"><dt><span class="term">openidm-reg</span></dt><dd><p>
      Role assigned to users who access OpenIDM with the default anonymous
      account.
     </p><p>
      The <code class="literal">openidm-reg</code> role is excluded from the
      reauthorization required policy definition by default.
     </p></dd><dt><span class="term">openidm-admin</span></dt><dd><p>
      OpenIDM administrator role, excluded from the reauthorization required
      policy definition by default.
     </p></dd><dt><span class="term">openidm-authorized</span></dt><dd><p>
      Default role for any user who has authenticated with a user name and
      password.
     </p></dd><dt><span class="term">openidm-cert</span></dt><dd><p>
      Default role for any user authenticated with mutual SSL authentication.
     </p><p>
      This role applies only for mutual authentication. Furthermore,
      the shared secret (certificate) must be adequately protected. The
      <code class="literal">openidm-cert</code> role is excluded from the reauthorization
      required policy definition by default.
     </p></dd></dl></div><p>
   OpenIDM begins the process of assigning the roles of a user with the
   <code class="literal">roles</code> property. OpenIDM then proceeds in the
   following sequence to define user roles:
  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
     If the <code class="literal">defaultRoles</code> property is set, OpenIDM assigns
     those roles to the given user. The <code class="literal">defaultRoles</code> property
     must be configured in an array.
    </p></li><li class="listitem"><p>
     The <code class="literal">userRoles</code> property is a string that defines the
     attribute. The value of the attribute may be either a comma-delimited
     string or a list of strings. You can identify the list with a REST call to
     a <code class="literal">queryOnResource</code> endpoint such as
     <code class="literal">system/ldap/account</code>
    </p></li><li class="listitem"><p>
     If the <code class="literal">groupRoleMapping</code> and
     <code class="literal">groupMembership</code> properties are defined, OpenIDM
     assigns additional roles to users depending on any existing group
     membership.
    </p></li></ul></div><p>
   The roles calculated in sequence are cumulative. In other words, if all of
   the above properties are defined, OpenIDM would assign roles from
   <code class="literal">defaultRoles</code> and <code class="literal">userRoles</code>. It would
   also use a <code class="literal">MappingRoleCalculator</code> to define roles from the
   <code class="literal">groupRoleMapping</code> and <code class="literal">groupMembership</code>
   properties.
  </p><p>
   For users who have authenticated with mutual SSL authentication, the module
   is <code class="literal">CLIENT_CERT</code> and the default role for such users is
   <code class="literal">openidm-cert</code>.
  </p><pre class="brush: javascript;">
{   "name" : "CLIENT_CERT",
    "properties" : {
        "queryOnResource": "managed/user",
        "defaultUserRoles": [  "openidm-cert" ],
        "allowedAuthenticationPatterns" : [ ]
    },
    "enabled" : "true"
}</pre><p>
    Access control for such users is configured in the
    <code class="filename">access.js</code> file. For more information, see
    <a class="xref" href="chap-auth.html#openidm-authorization" title="14.6.&nbsp;Authorization">Section&nbsp;14.6, &#8220;Authorization&#8221;</a>.
   </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="openidm-authorization"></a>14.6.&nbsp;Authorization</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="chap-auth.html#router-authz-js">14.6.1. <code class="literal">router-authz.js</code></a></span></dt><dt><span class="section"><a href="chap-auth.html#access-js">14.6.2. <code class="literal">access.js</code></a></span></dt><dt><span class="section"><a href="chap-auth.html#roles-auth-prop">14.6.3. Properties for Authentication and Roles</a></span></dt><dt><span class="section"><a href="chap-auth.html#authorization-extending">14.6.4. Extending the Authorization Mechanism</a></span></dt></dl></div><a class="indexterm" name="d0e13307"></a><p>
   OpenIDM provides role-based authorization that restricts direct HTTP access
   to REST interface URLs. The default authorization configuration grants
   different access rights to users that are assigned the roles
   <code class="literal">"openidm-admin"</code>, <code class="literal">"openidm-cert"</code>,
   <code class="literal">"openidm-authorized"</code>, and <code class="literal">"openidm-reg"</code>.
  </p><p>
   Note that this access control applies to direct HTTP calls only. Access for
   internal calls (for example, calls from scripts) is not affected by this
   mechanism.
  </p><div class="itemizedlist"><p>Authorization is configured in two script files:</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
       <code class="filename">openidm/bin/defaults/script/router-authz.js</code>
      </p></li><li class="listitem"><p><code class="filename">openidm/script/access.js</code></p></li></ul></div><p>
   OpenIDM calls these scripts for each request, via the
   <code class="literal">onRequest</code> hook that is defined in the default
   <code class="filename">router.json</code> file. The scripts either throw the string
   <code class="literal">Access denied</code>, or nothing. If
   <code class="literal">Access denied</code> is thrown, OpenIDM denies the request.
  </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="router-authz-js"></a>14.6.1.&nbsp;<code class="literal">router-authz.js</code></h3></div></div></div><p>
    This file provides the functions that enforce access rules. For example, the
    following function controls whether users with a certain role can start a
    specified process.
   </p><pre class="brush: javascript;">
...
function isAllowedToStartProcess() {
var processDefinitionId = request.content._processDefinitionId;
return isProcessOnUsersList(processDefinitionId);
}
...
   </pre><p>
    There are certain authorization-related functions in
    <code class="filename">router-authz.js</code> that should <span class="emphasis"><em>not</em></span> be
    altered, as described in a comment in the file.
   </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="access-js"></a>14.6.2.&nbsp;<code class="literal">access.js</code></h3></div></div></div><p>
    This file defines the access configuration for HTTP requests and
    references the methods defined in <code class="filename">router-authz.js</code>. Each 
    entry in the configuration contains a pattern to match against the incoming 
    request ID, and the associated roles, methods, and actions that are allowed 
    for requests on that pattern.
   </p><p>
    The options shown in the default version of the file do not include all of
    the actions available at each endpoint.
   </p><p>
    The following sample configuration entry indicates the configurable
    parameters and their purpose.
   </p><pre class="brush: javascript;">
        {  
            "pattern"   : "*",
            "roles"     : "openidm-admin",
            "methods"   : "*", // default to all methods allowed
            "actions"   : "*", // default to all actions allowed
            "customAuthz" : "disallowQueryExpression()",
            "excludePatterns": "system/*"
        },    
   </pre><p>
    As shown, this entry affects users with the <code class="literal">openidm-admin</code>
    role. Such users have HTTP access to all but <code class="literal">system</code>
    endpoints. The parameters are as follows:
   </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
      <code class="literal">"pattern"</code> - the REST endpoint to which access is being
      controlled. <code class="literal">"*"</code> indicates access to all endpoints.
      <code class="literal">"managed/user/*"</code> would indicate access to all managed
      user objects.
     </p></li><li class="listitem"><p>
      <code class="literal">"roles"</code> - a list of the roles to which this access
      configuration applies.
     </p></li><li class="listitem"><p>
      <code class="literal">"methods"</code> - a comma separated list of the methods to
      which access is being granted. The method can be one or more of
      <code class="literal">create, read, update, delete, patch, action, query</code>. A
      value of <code class="literal">"*"</code> indicates that all methods are allowed. A
      value of <code class="literal">""</code> indicates that no methods are allowed.
     </p></li><li class="listitem"><p>
      <code class="literal">"actions"</code> - a comma separated list of the allowed
      actions. The possible values depend on the service (URL) that is being
      exposed. The following list indicates the possible actions for each
      service.
     </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
       <code class="literal">openidm/info/*</code> - <code class="literal">(no action parameter
       applies)</code>
      </td></tr><tr><td>
       <code class="literal">openidm/authentication</code> -
       <code class="literal">reauthenticate</code>
      </td></tr><tr><td>
       <code class="literal">openidm/config/ui/*</code> - <code class="literal">(no action
       parameter applies)</code>
      </td></tr><tr><td>
       <code class="literal">openidm/endpoint/securityQA</code> -
       <code class="literal">securityQuestionForUserName, checkSecurityAnswerForUserName,
       setNewPasswordForUserName
       </code>
      </td></tr><tr><td>
       <code class="literal">openidm/endpoint/getprocessforuser</code> -
       <code class="literal">create, complete</code>
      </td></tr><tr><td>
       <code class="literal">openidm/endpoint/gettaskview</code> -
       <code class="literal">create, complete</code>
      </td></tr><tr><td>
       <code class="literal">openidm/external/email</code> - <code class="literal">send</code>
      </td></tr><tr><td>
       <code class="literal">openidm/external/rest</code> - <code class="literal">(no action parameter
       applies)</code>
      </td></tr><tr><td>
       <code class="literal">openidm/managed</code> - <code class="literal">patch,
       triggerSyncCheck</code>
      </td></tr><tr><td>
       <code class="literal">openidm/managed/user</code> - <code class="literal">validateObject,
       validateProperty</code>
      </td></tr><tr><td>
       <code class="literal">openidm/policy</code> - <code class="literal">validateObject,
       validateProperty</code>
      </td></tr><tr><td>
       <code class="literal">openidm/recon</code> - <code class="literal">recon, reconByQuery,
       reconById, cancel</code>
      </td></tr><tr><td>
       <code class="literal">openidm/repo</code> - <code class="literal">updateDbCredentials</code>
      </td></tr><tr><td>
       <code class="literal">openidm/script/*</code> - <code class="literal">eval</code>
      </td></tr><tr><td>
       <code class="literal">openidm/security/keystore</code> -
       <code class="literal">generateCert, generateCSR</code>
      </td></tr><tr><td>
       <code class="literal">openidm/security/truststore</code> -
       <code class="literal">generateCert, generateCSR</code>
      </td></tr><tr><td>
       <code class="literal">openidm/sync</code> - <code class="literal">notifyCreate, notifyUpdate,
       notifyDelete, recon, performAction</code>
      </td></tr><tr><td>
       <code class="literal">openidm/system</code> - <code class="literal">test, testConfig,
       CREATECONFIGURATION, liveSync, authenticate</code>
      </td></tr><tr><td>
       <code class="literal">openidm/system/&lt;name&gt;</code> - <code class="literal">script,
       test, liveSync</code>
      </td></tr><tr><td>
       <code class="literal">openidm/system/&lt;name&gt;/{id}</code> -
       <code class="literal">authenticate, liveSync</code>
      </td></tr><tr><td>
       <code class="literal">openidm/taskscanner</code> - <code class="literal">execute,
       cancel</code>
      </td></tr><tr><td>
       <code class="literal">openidm/workflow/processdefinition</code> - <code class="literal">
       create, complete</code>
      </td></tr><tr><td>
       <code class="literal">openidm/workflow/processinstance</code> - <code class="literal">create,
       complete</code>
      </td></tr><tr><td>
       <code class="literal">openidm/workflow/taskinstance</code> -
       <code class="literal">claim, create, complete</code>
      </td></tr></table><p>
      A value of <code class="literal">"*"</code> indicates that all actions exposed for
      that service are allowed. A value of <code class="literal">""</code> indicates that
      no actions are allowed.
     </p></li><li class="listitem"><p>
      <code class="literal">"customAuthz"</code> - an optional parameter that enables you
      to specify a custom function for additional authorization checks. These
      functions are defined in <code class="filename">router-authz.js</code>.
     </p><p>
      The <code class="literal">allowedPropertiesForManagedUser</code> variable, declared
      at the beginning of the file, enables you to create a white list of
      attributes that users are able to modify on their own accounts.
     </p></li><li class="listitem"><p>
      <code class="literal">"excludePatterns"</code> - an optional parameter that enables
      you to specify particular endpoints to which access should not be given.
     </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="roles-auth-prop"></a>14.6.3.&nbsp;Properties for Authentication and Roles</h3></div></div></div><p>
    The properties in this section define how users and groups may be associated
    with roles and certain authentication mechanisms. Some of these properties
    are included in the excerpt of the <code class="filename">authentication.json</code>
    file shown in <a class="xref" href="chap-auth.html#passthrough-auth" title="14.3.&nbsp;Using Delegated Authentication">Section&nbsp;14.3, &#8220;Using Delegated Authentication&#8221;</a>.
   </p><p>
    Different authentication modules may apply. In files such as
    <code class="filename">authentication.json</code>, you may assign an authentication
    module to the <code class="literal">name</code> property. Just be sure to include
    <code class="literal">enabled=true</code> or <code class="literal">enabled=false</code> for
    the configured module(s). For a list of available modules, see
    <a class="xref" href="chap-auth.html#supported-auth-modules" title="14.4.&nbsp;Supported Authentication Modules">Section&nbsp;14.4, &#8220;Supported Authentication Modules&#8221;</a>.
   </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">queryOnResource</code></span></dt><dd><p>
       The system endpoint against which the user authenticates, such as
       <code class="literal">system/ldap/account</code>,
       <code class="literal">system/scriptedsql/account</code>,
       <code class="literal">system/ad/account</code>,
       <code class="literal">managed/user</code>, and
       <code class="literal">repo/internal/user</code>.
      </p></dd><dt><span class="term"><code class="literal">augmentSecurityContext</code> (optional)</span></dt><dd><p>
       This parameter points to a script, executed only after a successful
       authentication request to provide additional information, based on the
       security context.
      </p><p>
       For delegated (pass-through authentication), OpenIDM uses the
       <code class="filename">populateAsManagedUser.js</code> script. This script uses
       authentication details returned from the pass-through authentication
       module. Those details can point to a linked managed user record.
       If a linked record is found, the script adjusts the details of the
       security context to match that managed user object. The
       adjusted security context enables additional operations for the
       authenticated user, such as the ability to access the default user
       interface.
      </p><p>
       The script must be either JavaScript
       (<code class="literal">"type":"text/javascript"</code>) or Groovy
       (<code class="literal">"type":"groovy"</code>), and can be provided inline
       (<code class="literal">"source":"script source"</code>) or in a file
       (<code class="literal">"file":"filename"</code>).
      </p></dd><dt><span class="term"><code class="literal">propertyMapping</code> (optional)</span></dt><dd><p>
       A list that enables you to map the following OpenIDM properties to fields
       in the system resource used for the authentication.
      </p></dd><dt><span class="term">
      <code class="literal">authenticationId</code>
     </span></dt><dd><p>
       Specifies the authentication property, such as <code class="literal">"uid"</code>,
       <code class="literal">"sAMAccountName"</code>, and <code class="literal">"username"</code>
      </p></dd><dt><span class="term"><code class="literal">groupMembership</code></span></dt><dd><p>
       Specifies the name of the property in the remote system that contains
       the list of groups of which the authenticated user is a member, such as
       <code class="literal">memberOf</code>, or <code class="literal">ldapGroups</code>.
      </p></dd><dt><span class="term"><code class="literal">groupRoleMapping</code> (optional)</span></dt><dd><p>
       Enables you to assign roles to users, based on their group membership in
       the system resource. In this example, users who are members
       of the <code class="literal">"cn=admins"</code> group in the LDAP directory
       automatically acquire the <code class="literal">"openidm-admin"</code> role. Group
       membership is determined, based on the
       <code class="literal">groupMembership</code> property, described previously.
      </p></dd><dt><span class="term"><code class="literal">managedUserLink</code> (optional)</span></dt><dd><p>
       Used by the script specified in <code class="literal">"augmentSecurityContext"</code>
       to switch the context of an authenticated user from their original
       security context to a context that is based on the related
       <code class="literal">managed/user</code> account. The value is based on the
       <code class="literal">name</code> of the mapping in the associated
       <code class="filename">sync.json</code> file.
      </p><p>
       The value of this property is the <code class="literal">"links"</code> entry
       (usually the mapping name defined in <code class="literal">sync.json</code>) that
       was used to relate the remote system users with the managed users.
      </p></dd><dt><span class="term"><code class="literal">defaultUserRoles</code> (optional)</span></dt><dd><p>
       Can be defined for any authentication module. OpenIDM assigns such roles
       (or an empty set) to the security context of a user.
      </p></dd><dt><span class="term"><code class="literal">enabled</code></span></dt><dd><p>
       Specifies whether the given authentication module is enabled
       (<code class="literal">true</code>) or disabled (<code class="literal">false</code>).
      </p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="authorization-extending"></a>14.6.4.&nbsp;Extending the Authorization Mechanism</h3></div></div></div><p>
    You can extend the default authorization mechanism by defining additional
    functions in <code class="filename">router-authz.js</code> and by creating new access
    control configuration definitions in <code class="filename">access.js</code>.
   </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="user-group-role-auth-assignment"></a>14.7.&nbsp;Building Role-Based Access Control (RBAC)</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="chap-auth.html#auth-security-context">14.7.1. Roles, Authentication, and the Security Context</a></span></dt></dl></div><p>
   In OpenIDM, role assignments can be configured with different authentication
   options. Roles can be assigned in a number of ways. The roles assigned to
   specific users are cumulative.
  </p><p>
   The roles for each user are calculated based on the process depicted here:
  </p><div class="mediaobject" align="center"><a name="figure-roles-auth"></a><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/roles-auth.png" align="middle" height="360" alt="The Role-Based Access Control Configuration Process"></td></tr></table><div class="longdesc-link" align="right"><br clear="all"><span class="longdesc-link">[<a href="figure-roles-auth.html" target="longdesc">D</a>]</span></div></div><p>
   In OpenIDM, RBAC incorporates authentication and authorization options from
   roles configured for clients, for managed / internal users, as well as for
   group memberships.
  </p><p>
   For information on the properties listed in this section, see <a class="xref" href="chap-auth.html#roles-auth-prop" title="14.6.3.&nbsp;Properties for Authentication and Roles">Section&nbsp;14.6.3, &#8220;Properties for Authentication and Roles&#8221;</a>.
  </p><p>
   Roles and authentication options can be configured for users in three stages:
  </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Client Controlled</span></dt><dd><p>
      The <code class="literal">defaultUserRoles</code> may be added to authentication
      modules configured in the applicable
      <code class="filename">authentication.json</code> file. Default roles are listed in
      <a class="xref" href="chap-auth.html#openidm-roles" title="14.5.&nbsp;Roles and Authentication">Section&nbsp;14.5, &#8220;Roles and Authentication&#8221;</a>.
     </p><p>
      If you see the following entry in <code class="filename">authentication.json</code>,
      the cited authentication property applies to all authenticated users:
     </p><div class="screen"><pre>"defaultUserRoles" : [ ] </pre></div></dd><dt><span class="term">Managed / Internal</span></dt><dd><p>
      Accumulated roles for users are collected in the <code class="literal">userRoles</code>
      property.
     </p><p>
      For a definition of managed and internal users, see
      <a class="xref" href="chap-auth.html#openidm-users" title="14.1.&nbsp;OpenIDM Users">Section&nbsp;14.1, &#8220;OpenIDM Users&#8221;</a>.
     </p></dd><dt><span class="term">Group roles</span></dt><dd><p>
      OpenIDM also uses group roles as input. Options include
      <code class="literal">groupMembership</code>, <code class="literal">groupRoleMapping</code>,
      and <code class="literal">groupComparison</code>
     </p></dd><dt><span class="term">context.security</span></dt><dd><p>
      Once OpenIDM assigns roles and authentication modules to a user,
      OpenIDM then evaluates the result based on the
      <code class="literal">context.security</code> map, based on the scripts in the
      <code class="filename">policy.js</code> file. Details require an extended
      discussion in the next section.
     </p></dd></dl></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="auth-security-context"></a>14.7.1.&nbsp;Roles, Authentication, and the Security Context</h3></div></div></div><p>
   The Security Context, written into the code as
   <code class="literal">context.security</code>, consists of a principal defined by the
   <code class="literal">authenticationId</code>, along with access control defined
   through the <code class="literal">authorizationId</code>.
  </p><p>
   If authentication is successful, Common Authentication Framework (CAF)
   modules set a principal. OpenIDM stores that principal as the
   <code class="literal">authenticationId</code>. For more information, see the
   authentication components defined in <a class="xref" href="chap-auth.html#supported-auth-modules" title="14.4.&nbsp;Supported Authentication Modules">Section&nbsp;14.4, &#8220;Supported Authentication Modules&#8221;</a>.
  </p><p>
   The <code class="literal">authorizationId</code> includes two roles-related components,
   generated by OpenIDM:
  </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">roles</span></dt><dd><p>
      Discussed in <a class="xref" href="chap-auth.html#openidm-roles" title="14.5.&nbsp;Roles and Authentication">Section&nbsp;14.5, &#8220;Roles and Authentication&#8221;</a>
     </p></dd><dt><span class="term">component</span></dt><dd><p>
      Resources defined through properties defined in
      <a class="xref" href="chap-auth.html#roles-auth-prop" title="14.6.3.&nbsp;Properties for Authentication and Roles">Section&nbsp;14.6.3, &#8220;Properties for Authentication and Roles&#8221;</a>. The <code class="literal">authorizationId</code>
      component is set to the value references in the
      <code class="literal">queryOnResource</code> property.
     </p></dd></dl></div></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="chap-passwords.html">Prev</a>&nbsp;</td><td width="20%" align="center">&nbsp;</td><td width="40%" align="right">&nbsp;<a accesskey="n" href="chap-security.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter&nbsp;13.&nbsp;Managing Passwords&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;15.&nbsp;Securing &amp; Hardening OpenIDM</td></tr></table></div><p>&nbsp;</p><div id="footer"><p>Something wrong on this page? <a href="https://bugster.forgerock.org/jira/secure/CreateIssueDetails!init.jspa?pid=10020&components=10164&issuetype=1">Log a documentation bug.</a></p></div>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-23412190-9']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</body></html>