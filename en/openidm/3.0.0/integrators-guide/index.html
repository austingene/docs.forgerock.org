<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
   <title>OpenIDM Integrator's Guide</title><link rel="stylesheet" type="text/css" href="coredoc.css"><link rel="stylesheet" type="text/css" href="css/coredoc.css"><link rel="stylesheet" type="text/css" href="sh/shCore.css"><link rel="stylesheet" type="text/css" href="sh/shCoreEclipse.css"><link rel="stylesheet" type="text/css" href="sh/shThemeEclipse.css"><script src="http://code.jquery.com/jquery-1.11.0.min.js" type="text/javascript"></script><script src="uses-jquery.js" type="text/javascript"></script><script src="sh/shCore.js" type="text/javascript"></script><script src="sh/shBrushAci.js" type="text/javascript"></script><script src="sh/shBrushBash.js" type="text/javascript"></script><script src="sh/shBrushCsv.js" type="text/javascript"></script><script src="sh/shBrushHttp.js" type="text/javascript"></script><script src="sh/shBrushJava.js" type="text/javascript"></script><script src="sh/shBrushJScript.js" type="text/javascript"></script><script src="sh/shBrushLDIF.js" type="text/javascript"></script><script src="sh/shBrushPlain.js" type="text/javascript"></script><script src="sh/shBrushProperties.js" type="text/javascript"></script><script src="sh/shBrushXml.js" type="text/javascript"></script><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><meta name="description" content="Guide to configuring and integrating OpenIDM into identity management solutions. The OpenIDM project offers flexible, open source services for automating management of the identity life cycle."><script type="text/javascript">SyntaxHighlighter.all();</script>
<link rel="shortcut icon" href="http://forgerock.org/favicon.ico">
</head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div lang="en" class="book"><div class="titlepage"><div><div><h1 class="title"><a name="integrators-guide"></a>OpenIDM Integrator's Guide</h1></div><div><h2 class="subtitle">Version 3.0.0</h2></div><div><div class="authorgroup"><div class="author"><h3 class="author"><span class="firstname">Anders </span> <span class="surname">Ask&aring;sen</span></h3></div><div class="author"><h3 class="author"><span class="firstname">Paul </span> <span class="surname">Bryan</span></h3></div><div class="author"><h3 class="author"><span class="firstname">Mark </span> <span class="surname">Craig</span></h3></div><div class="author"><h3 class="author"><span class="firstname">Andi </span> <span class="surname">Egloff</span></h3></div><div class="author"><h3 class="author"><span class="firstname">Laszlo </span> <span class="surname">Hordos</span></h3></div><div class="author"><h3 class="author"><span class="firstname">Matthias </span> <span class="surname">Tristl</span></h3></div><div class="author"><h3 class="author"><span class="firstname">Lana </span> <span class="surname">Frost</span></h3></div><div class="author"><h3 class="author"><span class="firstname">Mike </span> <span class="surname">Jang</span></h3></div><div class="author"><h3 class="author"><span class="firstname">Daly </span> <span class="surname">Chikhaoui</span></h3><div lang="en" class="affiliation"><span class="orgname">ForgeRock AS<br></span><div class="address"><p><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="street">33&nbsp;New&nbsp;Montgomery&nbsp;St.</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="otheraddr">Suite&nbsp;1500</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="city">San&nbsp;Francisco</span>,&nbsp;<span class="state">CA</span>&nbsp;<span class="postcode">94105</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="country">USA</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="phone">+1&nbsp;415-523-0772</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<code class="uri">www.forgerock.com</code><br>
&nbsp;&nbsp;&nbsp;</p></div></div></div></div></div><div><p class="releaseinfo">Software release date: July 30, 2014</p></div><div><p class="copyright">Copyright &copy; 2011-2014 ForgeRock AS</p></div><div><a href="legalnotice.html">Legal Notice</a></div><div><p class="pubdate">Publication date: July&nbsp;30,&nbsp;2014</p></div><div><div class="abstract"><div class="abstract-title">Abstract</div><p>Guide to configuring and integrating OpenIDM into identity
   management solutions. The OpenIDM project offers flexible, open source
   services for automating management of the identity life cycle.</p></div></div></div><hr></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="preface"><a href="#preface">Preface</a></span></dt><dt><span class="chapter"><a href="#chap-overview">1. Architectural Overview</a></span></dt><dt><span class="chapter"><a href="#chap-services">2. Starting and Stopping OpenIDM</a></span></dt><dt><span class="chapter"><a href="#chap-cli">3. OpenIDM Command-Line Interface</a></span></dt><dt><span class="chapter"><a href="#chap-ui">4. OpenIDM User Interface</a></span></dt><dt><span class="chapter"><a href="#chap-configuration">5. Configuring OpenIDM</a></span></dt><dt><span class="chapter"><a href="#chap-data">6. Accessing Data Objects</a></span></dt><dt><span class="chapter"><a href="#chap-users-groups-roles">7. Managing Users, Groups, and Roles</a></span></dt><dt><span class="chapter"><a href="#chap-policies">8. Using Policies to Validate Data</a></span></dt><dt><span class="chapter"><a href="#chap-logs">9. Configuring Server Logs</a></span></dt><dt><span class="chapter"><a href="#chap-resource-conf">10. Connecting to External Resources</a></span></dt><dt><span class="chapter"><a href="#chap-synchronization">11. Configuring Synchronization</a></span></dt><dt><span class="chapter"><a href="#chap-scheduler-conf">12. Scheduling Tasks and Events</a></span></dt><dt><span class="chapter"><a href="#chap-passwords">13. Managing Passwords</a></span></dt><dt><span class="chapter"><a href="#chap-auth">14. Managing Authentication, Authorization and Role-Based Access Control</a></span></dt><dt><span class="chapter"><a href="#chap-security">15. Securing &amp; Hardening OpenIDM</a></span></dt><dt><span class="chapter"><a href="#chap-workflow">16. Integrating Business Processes and Workflows</a></span></dt><dt><span class="chapter"><a href="#chap-auditing">17. Using Audit Logs</a></span></dt><dt><span class="chapter"><a href="#chap-cluster">18. Configuring OpenIDM to Work in a Cluster</a></span></dt><dt><span class="chapter"><a href="#chap-mail">19. Sending Email</a></span></dt><dt><span class="chapter"><a href="#chap-external-rest">20. Accessing External REST Services</a></span></dt><dt><span class="chapter"><a href="#chap-best-practices">21. OpenIDM Project Best Practices</a></span></dt><dt><span class="chapter"><a href="#chap-troubleshooting">22. Troubleshooting</a></span></dt><dt><span class="chapter"><a href="#chap-advanced">23. Advanced Configuration</a></span></dt><dt><span class="appendix"><a href="#appendix-file-layout">A. File Layout</a></span></dt><dt><span class="appendix"><a href="#appendix-ports-used">B. Ports Used</a></span></dt><dt><span class="appendix"><a href="#appendix-objects">C. Data Models and Objects Reference</a></span></dt><dt><span class="appendix"><a href="#appendix-synchronization">D. Synchronization Reference</a></span></dt><dt><span class="appendix"><a href="#appendix-rest">E. REST API Reference</a></span></dt><dt><span class="appendix"><a href="#appendix-scripting">F. Scripting Reference</a></span></dt><dt><span class="appendix"><a href="#appendix-router">G. Router Service Reference</a></span></dt><dt><span class="appendix"><a href="#appendix-jetty">H. Embedded Jetty Configuration</a></span></dt><dt><span class="appendix"><a href="#appendix-interface-stability">I. Release Levels &amp; Interface Stability</a></span></dt><dt><span class="glossary"><a href="#openidm-glossary">OpenIDM Glossary</a></span></dt><dt><span class="index"><a href="#d505e24886">Index</a></span></dt></dl></div><div lang="en" class="preface"><div class="titlepage"><div><div><h1 class="title"><a name="preface"></a>Preface</h1></div></div></div><p>This guide shows you how to integrate OpenIDM as part of a complete
 identity management solution.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d505e199"></a>1.&nbsp;Who Should Use this Guide</h2></div></div></div><p>This guide is written for systems integrators building identity
  management solutions based on OpenIDM services. This guide describes
  OpenIDM, and shows you how to set up OpenIDM as part of your identity
  management solution.</p><p>You do not need to be an OpenIDM wizard to learn something from
  this guide, though a background in identity management and building
  identity management solutions can help.</p></div><div lang="en" class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="formatting-conventions"></a>2.&nbsp;Formatting Conventions</h2></div></div></div><p>
  Most examples in the documentation are created on GNU/Linux or Mac OS X.

  Where it is helpful to make a distinction between operating environments,
  examples for UNIX, GNU/Linux, Mac OS X, and so forth are labeled (UNIX).
  Mac OS X specific examples can be labeled (Mac OS X).
  Examples for Microsoft Windows can be labeled (Windows).

  To avoid repetition, however, file system directory names are
  often given only in UNIX format as in <code class="filename">/path/to/server</code>,
  even if the text applies to <code class="filename">C:\path\to\server</code> as well.
 </p><p>
  Absolute path names usually begin with the placeholder
  <code class="filename">/path/to/</code>.

  This path might translate to <code class="filename">/opt/</code>,
  <code class="filename">C:\Program Files\</code>, or somewhere else on your system.
 </p><p>
  Command line, terminal sessions are formatted as follows.
 </p><div class="screen"><pre>$ <strong>echo $JAVA_HOME</strong>
<em>/path/to/jdk</em></pre></div><p>
  Command output is sometimes formatted for narrower, more readable output
  even though formatting parameters are not shown in the command.
  In the following example, the query string parameter
  <code class="literal">_prettyPrint=true</code> is omitted.
 </p><div class="screen"><pre>
$ <strong>curl https://bjensen:hifalutin@opendj.example.com:8443/users/newuser</strong>
<em>{
  "_rev" : "000000005b337348",
  "schemas" : [ "urn:scim:schemas:core:1.0" ],
  "contactInformation" : {
    "telephoneNumber" : "+1 408 555 1212",
    "emailAddress" : "newuser@example.com"
  },
  "_id" : "newuser",
  "name" : {
    "familyName" : "New",
    "givenName" : "User"
  },
  "userName" : "newuser@example.com",
  "displayName" : "New User",
  "meta" : {
    "created" : "2014-06-03T09:58:27Z"
  },
  "manager" : [ {
    "_id" : "kvaughan",
    "displayName" : "Kirsten Vaughan"
  } ]
}</em>
 </pre></div><p>
  Program listings are formatted as follows.
 </p><pre class="brush: java;">class Test {
    public static void main(String [] args)  {
        System.out.println("This is a program listing.");
    }
}</pre></div><div lang="en" class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="accessing-doc-online"></a>3.&nbsp;Accessing Documentation Online</h2></div></div></div><p>
  ForgeRock core documentation, such as what you are now reading, aims to be
  technically accurate and complete with respect to the software documented.
 </p><div class="itemizedlist"><p>
   Core documentation therefore follows a three-phase review process
   designed to eliminate errors.
  </p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
    Product managers and software architects review project documentation design
    with respect to the users' software lifecycle needs.
   </p></li><li class="listitem"><p>
    Subject matter experts review proposed documentation changes for
    technical accuracy and completeness
    with respect to the corresponding software.
   </p></li><li class="listitem"><p>
    Quality experts validate implemented documentation changes for
    technical validity with respect to the software,
    technical completeness with respect to the scope of the document,
    and usability for the expected audience.
   </p></li></ul></div><p>
  The review process helps to ensure that documentation published for
  a ForgeRock release is technically accurate and complete.
 </p><p>
  Fully reviewed, published core documentation is available at
  <a class="link" href="http://docs.forgerock.org/" target="_blank">http://docs.forgerock.org/</a>.

  Use this documentation when working with a ForgeRock Enterprise release.
 </p><p>
  In-progress documentation can be found at each project site under the
  <a class="link" href="http://forgerock.org" target="_blank">Developer Community</a> projects page.

  Use this documentation when trying a nightly build.
 </p><p>
  The ForgeRock <a class="link" href="https://wikis.forgerock.org/" target="_blank">Community Wikis</a> and provide additional, user-created information.

  We encourage you to
  <a class="link" href="https://sso.forgerock.com/openam/UI/Login" target="_blank">join the community</a>, so that you can update the Wikis, too.
 </p></div><div lang="en" class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="joining-the-community"></a>4.&nbsp;Joining the ForgeRock Community</h2></div></div></div><p>
  After you
  <a class="link" href="https://backstage.forgerock.com/#/account/register" target="_blank">sign up</a> to join the ForgeRock community,
  you can edit the
  <a class="link" href="https://wikis.forgerock.org/" target="_blank">Community Wikis</a>,
  and also log bugs and feature requests in the
  <a class="link" href="https://bugster.forgerock.org/" target="_blank">issue tracker</a>.
 </p><p>
  If you have a question regarding a project but cannot find an answer
  in the project documentation or Wiki, browse to the
  <a class="link" href="http://forgerock.org" target="_blank">Developer Community</a> page for the project,
  where you can find details on joining the project mailing lists,
  and find links to mailing list archives.

  You can also suggest updates to documentation through the
  <a class="link" href="https://lists.forgerock.org/mailman/listinfo/docs" target="_blank">ForgeRock docs mailing list</a>.
 </p><p>
  The Community Wikis describe how to check out and build source code.

  Should you want to contribute a patch, test, or feature,
  or want to author part of the core documentation,
  first have a look on the ForgeRock site at
  <a class="link" href="http://forgerock.org/get_involved.html" target="_blank">how to get involved</a>.
 </p></div></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-overview"></a>Chapter&nbsp;1.&nbsp;Architectural Overview</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="section"><a href="#openidm-modular-framework">1.1. OpenIDM Modular Framework</a></span></dt><dt><span class="section"><a href="#openidm-infrastructure-modules">1.2. Infrastructure Modules</a></span></dt><dt><span class="section"><a href="#openidm-core-services">1.3. Core Services</a></span></dt><dt><span class="section"><a href="#commons-rest-commands">1.4. Secure Commons REST Commands</a></span></dt><dt><span class="section"><a href="#openidm-access-layer">1.5. Access Layer</a></span></dt></dl></div><a class="indexterm" name="d505e324"></a><p>The following figure provides an overview of the OpenIDM architecture,
  which is covered in more detail in subsequent sections of this chapter.</p><div class="mediaobject" align="center"><a name="figure-openidm2-architecture"></a><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/openidm2-architecture.png" align="middle" height="360" alt="OpenIDM architecture"></td></tr></table><div class="longdesc-link" align="right"><br clear="all"><span class="longdesc-link">[<a href="figure-openidm2-architecture.html" target="longdesc">D</a>]</span></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="openidm-modular-framework"></a>1.1.&nbsp;OpenIDM Modular Framework</h2></div></div></div><div class="variablelist"><p>The OpenIDM framework is based on OSGi.</p><dl class="variablelist"><dt><span class="term">OSGi</span></dt><dd><p>OSGi is a module system and service platform for the Java
       programming language that implements a complete and dynamic component
       model. For a good introduction, see the <a class="link" href="http://www.osgi.org/About/WhyOSGi" target="_blank">OSGi</a> site.
       While OpenIDM services are designed to run in any OSGi container,
       OpenIDM currently runs in <a class="link" href="http://felix.apache.org/site/index.html" target="_blank">Apache
       Felix</a>.</p></dd><dt><span class="term">Servlet</span></dt><dd><p>The optional Servlet layer provides RESTful HTTP access to the
       managed objects and services. While the Servlet layer can be provided by
       many different engines, OpenIDM embeds Jetty by default.</p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="openidm-infrastructure-modules"></a>1.2.&nbsp;Infrastructure Modules</h2></div></div></div><div class="variablelist"><p>OpenIDM infrastructure modules provide the underlying features
     needed for core services.</p><dl class="variablelist"><dt><span class="term">BPMN 2.0 Workflow Engine</span></dt><dd><p>OpenIDM provides an embedded workflow and business process engine 
        based on Activiti and the Business Process Model and Notation (BPMN) 
        2.0 standard.</p><p>For more information, see <a href="../integrators-guide/index.html#chap-workflow" class="link">
       <em class="citetitle">Integrating Business Processes and Workflows</em></a>.
       </p></dd><dt><span class="term">Task Scanner</span></dt><dd><p>OpenIDM provides a task scanning mechanism that enables you to 
       perform a batch scan for a specified date in OpenIDM data, on a 
       scheduled interval, and then to execute a task when this date is 
       reached.</p><p>For more information, see <a href="../integrators-guide/index.html#task-scanner" class="link"><em class="citetitle">Scanning Data to Trigger Tasks</em></a>.</p></dd><dt><span class="term">Scheduler</span></dt><dd><p>The scheduler provides a <span class="command"><strong>cron</strong></span>-like scheduling
       component implemented using the <a class="link" href="http://www.quartz-scheduler.org" target="_blank">Quartz library</a>. Use
       the scheduler, for example, to enable regular synchronizations and
       reconciliations.</p><p>See the <a href="../integrators-guide/index.html#chap-scheduler-conf" class="link"><em class="citetitle">Scheduling Synchronization</em></a> chapter
       for details.</p></dd><dt><span class="term">Script Engine</span></dt><dd><p>
        The script engine is a pluggable module that provides the triggers and
        plugin points for OpenIDM. OpenIDM currently supports JavaScript and
        Groovy.
       </p></dd><dt><span class="term">Policy Service</span></dt><dd><p>OpenIDM provides an extensible policy service that enables you to 
       apply specific validation requirements to various components and 
       properties.</p><p>For more information, see <a href="../integrators-guide/index.html#chap-policies" class="link"><em class="citetitle">Using Policies to Validate Data</em></a>.</p></dd><dt><span class="term">Audit Logging</span></dt><dd><p>Auditing logs all relevant system activity to the configured
       log stores. This includes the data from reconciliation as a basis for
       reporting, as well as detailed activity logs to capture operations on
       the internal (managed) and external (system) objects.</p><p>See the <a href="../integrators-guide/index.html#chap-auditing" class="link"><em class="citetitle">Using Audit
       Logs</em></a> chapter for details.</p></dd><dt><span class="term">Repository</span></dt><dd><p>The repository provides a common abstraction for a pluggable
       persistence layer. OpenIDM 3.0.0 supports use
       of MySQL to back the repository. Yet, plugin repositories can include
       NoSQL and relational databases, LDAP, and even flat files. The
       repository API operates using a JSON-based object model with RESTful
       principles consistent with the other OpenIDM services. The default,
       embedded implementation for the repository is the NoSQL database
       OrientDB, making it easy to evaluate OpenIDM out of the box before
       using MySQL in your production environment.</p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="openidm-core-services"></a>1.3.&nbsp;Core Services</h2></div></div></div><div class="variablelist"><p>The core services are the heart of the OpenIDM resource oriented
     unified object model and architecture.</p><dl class="variablelist"><dt><span class="term">Object Model</span></dt><dd><p>Artifacts handled by OpenIDM are Java object representations of
       the JavaScript object model as defined by JSON. The object model supports
       interoperability and potential integration with many applications,
       services and programming languages. As OpenIDM is a Java-based product,
       these representations are instances of classes: <code class="literal">Map</code>,
       <code class="literal">List</code>, <code class="literal">String</code>,
       <code class="literal">Number</code>, <code class="literal">Boolean</code>, and
       <code class="literal">null</code>.</p><p>
        OpenIDM can serialize and deserialize these structures to and from JSON
        as required. OpenIDM also exposes a set of triggers and functions that
        system administrators can define, in either JavaScript or Groovy, which
        can natively read and modify these JSON-based object model structures.
        OpenIDM is designed to support other scripting and programming languages.
       </p></dd><dt><span class="term">Managed Objects</span></dt><dd><a class="indexterm" name="d505e482"></a><p>A <em class="firstterm">managed object</em> is an object that
       represents the identity-related data managed by OpenIDM. Managed objects
       are configurable, JSON-based data structures that OpenIDM stores in its
       pluggable repository. The default configuration of a managed object is 
       that of a user, but you can define any kind of managed object, for 
       example, groups or roles.</p><p>You can access managed objects over the REST interface with a query 
       similar to the following:</p><div class="screen"><pre>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/managed/..."</pre></div></dd><dt><span class="term">System Objects</span></dt><dd><a class="indexterm" name="d505e500"></a><p><em class="firstterm">System objects</em> are pluggable representations
       of objects on external systems. For example, a user entry that is stored 
       in an external LDAP directory is represented as a system object in 
       OpenIDM.</p><p>System objects follow the same RESTful resource-based design 
       principles as managed objects. They can be accessed over the REST 
       interface with a query similar to the following:</p><div class="screen"><pre>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/system/..."
       </pre></div><p>There is a default implementation for the OpenICF framework, that 
       allows any connector object to be represented as a system object.</p></dd><dt><span class="term">Mappings</span></dt><dd><a class="indexterm" name="d505e519"></a><p><em class="firstterm">Mappings</em>
       define policies between source and target objects and their attributes
       during synchronization and reconciliation. Mappings can also define
       triggers for validation, customization, filtering, and transformation
       of source and target objects.</p><p>See the <a href="../integrators-guide/index.html#chap-synchronization" class="link"><em class="citetitle">Configuring Synchronization</em></a> chapter for
       details.</p></dd><dt><span class="term">Synchronization &amp; Reconciliation</span></dt><dd><a class="indexterm" name="d505e536"></a><a class="indexterm" name="d505e539"></a><p>
        <em class="firstterm">Reconciliation</em> enables on-demand and scheduled
        resource comparisons between the OpenIDM managed object repository and
        source or target systems. Comparisons can result in different actions,
        depending on the mappings defined between the systems.
       </p><p>
        <em class="firstterm">Synchronization</em> enables creating, updating, and
        deleting resources from a source to a target system, either on demand or
        according to a schedule.
       </p><p>See the <a href="../integrators-guide/index.html#chap-synchronization" class="link"><em class="citetitle">Configuring Synchronization</em></a> chapter for
       details.</p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="commons-rest-commands"></a>1.4.&nbsp;Secure Commons REST Commands</h2></div></div></div><p>
    As noted in the <a href="../integrators-guide/index.html#appendix-rest" class="link"><em class="citetitle">REST API
    Reference</em>, </a> Representational State Transfer (REST) is a
    software architecture style for exposing resources, using the technologies
    and protocols of the World Wide Web.
   </p><p>
    REST interfaces are commonly tested with a <span class="command"><strong>curl</strong></span> command.
    Many of these commands are used in this document. They work with the
    standard ports associated with Java EE communications, 8080 and 8443.
   </p><p>
    To run <span class="command"><strong>curl</strong></span> over the secure port, 8443, you must include
    either the <span class="command"><strong>--insecure</strong></span> option, or follow the instructions
    shown in <a href="../integrators-guide/index.html#rest-over-https" class="link"><em class="citetitle">Restrict
    REST Access to the HTTPS Port</em></a>. You can use those
    instructions with the self-signed certificate generated when OpenIDM
    starts, or with a <code class="filename">*.crt</code> file provided by a
    certificate authority.
   </p><p>
     In many cases in this guide, <span class="command"><strong>curl</strong></span> commands to the secure
     port are depicted with a <code class="literal">--cacert self-signed.crt</code> option.
     Instructions for creating that <code class="filename">self-signed.crt</code> file
     are shown in the aforementioned section on <a href="../integrators-guide/index.html#rest-over-https" class="link"><em class="citetitle">Restrict
     REST Access to the HTTPS Port</em></a>.
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="openidm-access-layer"></a>1.5.&nbsp;Access Layer</h2></div></div></div><div class="variablelist"><p>The access layer provides the user interfaces and public APIs for
     accessing and managing the OpenIDM repository and its functions.</p><dl class="variablelist"><dt><span class="term">RESTful Interfaces</span></dt><dd><p>OpenIDM provides REST APIs for CRUD operations and invoking
       synchronization and reconciliation for both HTTP and Java.</p><p>See the <a href="../integrators-guide/index.html#appendix-rest" class="link"><em class="citetitle">REST
       API Reference</em></a> appendix for details.</p></dd><dt><span class="term">User Interfaces</span></dt><dd><p>User interfaces provide password management, registration,
       self-service, and workflow services.</p></dd></dl></div></div></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-services"></a>Chapter&nbsp;2.&nbsp;Starting and Stopping OpenIDM</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="section"><a href="#starting-and-stopping">2.1. To Start and Stop OpenIDM</a></span></dt><dt><span class="section"><a href="#startup-configuration">2.2. Specifying the OpenIDM Startup Configuration</a></span></dt><dt><span class="section"><a href="#info-service">2.3. Obtaining Information About an OpenIDM Instance</a></span></dt><dt><span class="section"><a href="#system-healthcheck">2.4. Verifying the Health of an OpenIDM System</a></span></dt><dt><span class="section"><a href="#installed-modules">2.5. Displaying Information About Installed Modules</a></span></dt><dt><span class="section"><a href="#starting-in-debug-mode">2.6. Starting OpenIDM in Debug Mode</a></span></dt></dl></div><p>This chapter covers the scripts provided for starting and stopping 
 OpenIDM, and describes how to verify the <span class="emphasis"><em>health</em></span> of a 
 system, that is, that all requirements are met for a successful system 
 startup.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="starting-and-stopping"></a>2.1.&nbsp;To Start and Stop OpenIDM</h2></div></div></div><a class="indexterm" name="d505e639"></a><a class="indexterm" name="d505e642"></a><p>By default you start and stop OpenIDM in interactive mode.</p><div class="itemizedlist"><p>To start OpenIDM interactively, open a terminal or command window,
   change to the <code class="filename">openidm</code> directory, and run the startup
   script:</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="command"><strong>startup.sh</strong></span> (UNIX)</p></li><li class="listitem"><p><span class="command"><strong>startup.bat</strong></span> (Windows)</p></li></ul></div><p>The startup script starts OpenIDM, and opens an OSGi console with a
  <code class="literal">-&gt;</code> prompt where you can issue console commands.</p><p>To stop OpenIDM interactively in the OSGi console, enter the
  <span class="command"><strong>shutdown</strong></span> command.</p><div class="screen"><pre>-&gt; shutdown</pre></div><div class="orderedlist"><p>You can also start OpenIDM as a background process on UNIX, Linux, and
   Mac OS X. Follow these steps <span class="emphasis"><em>before starting OpenIDM for the first
   time</em></span>.</p><ol class="orderedlist" type="1"><li class="listitem"><p>If you have already started OpenIDM, then shut down OpenIDM and
    remove the Felix cache files under <code class="filename">openidm/felix-cache/</code>.
    </p><div class="screen"><pre>-&gt; shutdown
...
$ rm -rf felix-cache/*</pre></div></li><li class="listitem"><p>Disable <code class="literal">ConsoleHandler</code> logging before starting
    OpenIDM by editing <code class="filename">openidm/conf/logging.properties</code>
    to set <code class="literal">java.util.logging.ConsoleHandler.level = OFF</code>,
    and to comment out other references to <code class="literal">ConsoleHandler</code>,
    as shown in the following excerpt.</p><pre class="brush: ini;">
# ConsoleHandler: A simple handler for writing formatted records to System.err
#handlers=java.util.logging.FileHandler, java.util.logging.ConsoleHandler
handlers=java.util.logging.FileHandler
...
# --- ConsoleHandler ---
# Default: java.util.logging.ConsoleHandler.level = INFO
java.util.logging.ConsoleHandler.level = OFF
#java.util.logging.ConsoleHandler.formatter = ...
#java.util.logging.ConsoleHandler.filter=...</pre></li><li class="listitem"><p>Remove the text-based OSGi console bundle,
    <code class="filename">bundle/org.apache.felix.shell.tui-<em class="replaceable"><code>version</code></em>.jar</code>.</p></li><li class="listitem"><p>Start OpenIDM in the background.</p><div class="screen"><pre>$ ./startup.sh &amp;
</pre></div><p>Alternatively, use the <span class="command"><strong>nohup</strong></span> command to keep
    OpenIDM running after you log out.</p><div class="screen"><pre>$ nohup ./startup.sh &amp;
[2] 394
$ appending output to nohup.out
$</pre></div></li></ol></div><p>To stop OpenIDM running as a background process, use the
  <span class="command"><strong>shutdown.sh</strong></span> script.</p><div class="screen"><pre>$ ./shutdown.sh
./shutdown.sh
Stopping OpenIDM (454)</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="startup-configuration"></a>2.2.&nbsp;Specifying the OpenIDM Startup Configuration</h2></div></div></div><p>By default, OpenIDM starts up with the configuration and script files 
  that are located in the <code class="filename">openidm/conf</code> and 
  <code class="filename">openidm/script</code> directories, and with the binaries that 
  are in the default install location. You can launch OpenIDM with a different 
  configuration and set of script files, and even with a different set of 
  binaries, in order to test a new configuration, manage multiple different
  OpenIDM projects, or to run one of the included samples.</p><p>The <code class="literal">startup.sh</code> script enables you to specify the 
  following elements of a running OpenIDM instance.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>project location (<code class="literal">-p</code>)</p><p>The project location specifies the configuration and default 
       scripts with which OpenIDM will run.
       </p><p>If you specify the project location, OpenIDM does not try to 
       locate configuration objects in the default location. All configuration 
       objects and any artifacts that are not in the bundled defaults (such as 
       custom scripts) <span class="emphasis"><em>must</em></span> be provided in the project 
       location. This includes everything that is in the default 
       <code class="literal">openidm/conf</code> and <code class="literal">openidm/script</code> 
       directories.</p><p>The following command starts OpenIDM with the configuration of 
       sample 1:</p><div class="screen"><pre>$ ./startup.sh -p /path/to/openidm/samples/sample1</pre></div><p>If an absolute path is not provided, the path is relative to the 
       system property, <code class="literal">user.dir</code>. If no project location is 
       specified, OpenIDM is launched with the default configuration in 
       <code class="literal">/path/to/openidm/conf</code>.</p></li><li class="listitem"><p>working location (<code class="literal">-w</code>)</p><p>The working location specifies the directory to which OpenIDM 
       writes its cache. Specifying a working location separates the project 
       from the cached data that the system needs to store. The working 
       location includes everything that is in the default 
       <code class="literal">db</code>, <code class="literal">audit</code>,
       <code class="literal">felix-cache</code>, and <code class="literal">logs</code>
       directories.</p><p>The following command specifies that OpenIDM writes its cached 
       data to <code class="filename">/Users/admin/openidm/storage</code>:</p><div class="screen"><pre>$ ./startup.sh -w /Users/admin/openidm/storage</pre></div><p>If an absolute path is not provided, the path is relative to the 
       system property, <code class="literal">user.dir</code>. If no working location is 
       specified, OpenIDM writes its cached data to the
       <code class="literal">openidm/db</code>, <code class="literal">openidm/audit</code>,
       <code class="literal">openidm/felix-cache</code> and <code class="literal">openidm/logs</code>
       directories.</p></li><li class="listitem"><p>startup configuration file (<code class="literal">-c</code>)</p><p>A customizable startup configuration file (named 
       <code class="filename">launcher.json</code>) enables you to specify how the OSGi 
       Framework is started.</p><p>Unless you are working with a highly customized deployment, you
       should not modify the default framework configuration. This option is
       therefore described in more detail in the chapter on
       <a href="../integrators-guide/index.html#chap-advanced" class="link"><em class="citetitle">Advanced
       Administration</em></a>.
       </p></li></ul></div><p>By default, properties files are loaded in the following order,
     and property values are resolved in the reverse order:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><code class="literal">system.properties</code></p></li><li class="listitem"><p><code class="literal">config.properties</code></p></li><li class="listitem"><p><code class="literal">boot.properties</code></p></li></ol></div><p>If both system and boot properties define the same attribute, the
     property substitution process locates the attribute in
     <code class="literal">boot.properties</code> and does not attempt to locate the
     property in <code class="literal">system.properties</code>.</p><p>You can use variable substitution in any <code class="literal">.json</code>
     configuration file with the install, working and project locations
     described previously. The following properties can be substituted:</p><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="literal">install.location</code></td></tr><tr><td><code class="literal">install.url</code></td></tr><tr><td><code class="literal">working.location</code></td></tr><tr><td><code class="literal">working.url</code></td></tr><tr><td><code class="literal">project.location</code></td></tr><tr><td><code class="literal">project.url</code></td></tr></table><p>Property substitution takes the following syntax:</p><div class="screen"><pre>&amp;{launcher.<em><strong>property</strong></em>}</pre></div><p>For example, to specify the location of the OrientDB database, you
     can set the <code class="literal">dbUrl</code> property in <code class="filename">repo.orientdb.json</code>
     as follows:</p><pre class="brush: javascript;">
"dbUrl" : "local:&amp;{launcher.working.location}/db/openidm",
     </pre><p>The database location is then relative to a working location
     defined in the startup configuration.</p><p>
   Note that property substitution does not work for connector reference
   properties. So, for example, the following configuration would not be valid:
  </p><pre class="brush: javascript;">"connectorRef" : {
    "connectorName" : "&amp;{connectorName}",
    "bundleName" : "org.forgerock.openicf.connectors.ldap-connector",
    "bundleVersion" : "&amp;{LDAP.BundleVersion}"
    ...
  </pre><p>
   The <code class="literal">"connectorName"</code> must be the precise string from the
   connector configuration. If you need to specify multiple connector version
   numbers, use a range instead, for example:
  </p><pre class="brush: javascript;">"connectorRef" : {
    "connectorName" : "org.identityconnectors.ldap.LdapConnector",
    "bundleName" : "org.forgerock.openicf.connectors.ldap-connector",
    "bundleVersion" : "[1.1.0.1,1.1.2.0)",
    ...
  </pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="info-service"></a>2.3.&nbsp;Obtaining Information About an OpenIDM Instance</h2></div></div></div><p>
   OpenIDM includes a customizable information service that provides detailed
   information about a running OpenIDM instance. The information can be accessed
   over the REST interface, under the context
   <code class="literal">https://localhost:8443/openidm/info</code>.
  </p><p>By default, OpenIDM provides the following information:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
     Basic information about the health of the system.
    </p><p>
     This information can be accessed over REST at
     <code class="literal">https://localhost:8443/openidm/info/ping</code>. For example:
    </p><div class="screen"><pre>
 $ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/info/ping"</strong>

   <em>
 {"state":"ACTIVE_READY","shortDesc":"OpenIDM ready"}
    </em></pre></div><p>
     The information is provided by the script
     <code class="filename">openidm/bin/defaults/script/info/ping.js</code>.
    </p></li><li class="listitem"><p>
     Information about the current OpenIDM session.
    </p><p>
     This information can be accessed over REST at
     <code class="literal">https://localhost:8443/openidm/info/login</code>. For example:
    </p><div class="screen"><pre>
 $ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/info/login" </strong>

    <em>
{
  "authenticationId": "openidm-admin",
  "class": "org.forgerock.json.resource.SecurityContext",
  "parent": {
    "class": "org.forgerock.json.resource.RootContext",
    "parent": null,
    "id": "6f1709ce-75bd-4f9b-b1ad-d4592be37361"
  },
  "authorizationId": {
    "roles": [
      "openidm-admin",
      "openidm-authorized"
    ],
    "component": "repo/internal/user",
    "id": "openidm-admin"
  }
}</em></pre></div><p>
     The information is provided by the script
     <code class="filename">openidm/bin/defaults/script/info/login.js</code>.
    </p></li></ul></div><p>
   You can extend or override the default information that is provided by
   creating your own script file and its corresponding configuration file in
   <code class="filename">openidm/conf/info-<em class="replaceable"><code>name</code></em>.json</code>.
   Custom script files can be located anywhere, although a best practice is to
   place them in <code class="filename">openidm/script/info</code>. A sample customized
   script file for extending the default ping service is provided in
   <code class="filename">openidm/samples/infoservice/script/info/customping.js</code>.
   The corresponding configuration file is provided in
   <code class="filename">openidm/samples/infoservice/conf/info-customping.json</code>.
  </p><p>
   The configuration file has the following syntax:
  </p><pre class="brush: plain;">
{
    "infocontext" : "ping",
    "type" : "text/javascript",
    "file" : "script/info/customping.js"
} 
  </pre><p>
   The parameters in the configuration file are as follows:
  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
     <code class="literal">"infocontext"</code> specifies the relative name of the info
     endpoint under the info context. The information can be accessed over REST
     at this endpoint, for example, setting <code class="literal">"infocontext"</code> to
     <code class="literal">"mycontext/myendpoint"</code> would make the information
     accessible over REST at
     <code class="literal">https://localhost:8443/openidm/info/mycontext/myendpoint</code>.
    </p></li><li class="listitem"><p>
     <code class="literal">"type"</code> specifies the type of the information source.
     Javascript (<code class="literal">"type" : "text/javascript"</code>) and Groovy
     (<code class="literal">"type" : "groovy"</code>) are supported.
    </p></li><li class="listitem"><p>
     <code class="literal">"file"</code> specifies the path to the Javascript or Groovy
     file, if you do not provide a <code class="literal">"source"</code> parameter.
    </p></li><li class="listitem"><p>
     <code class="literal">"source"</code> specifies the actual Javascript or Groovy
     script, if you have not provided a <code class="literal">"file"</code> parameter.
    </p></li></ul></div><p>
   Additional properties can be passed to the script as depicted in this
   configuration file
   (<code class="filename">openidm/samples/infoservice/conf/info-<em class="replaceable"><code>name</code></em>.json</code>).
  </p><p>
   Script files in <code class="filename">openidm/samples/infoservice/script/info/</code>
   have access to the following objects:
  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">request</code> - the request details, including the 
      method called and any parameters passed.</p></li><li class="listitem"><p><code class="literal">healthinfo</code> - the current health status of the 
      system.</p></li><li class="listitem"><p><code class="literal">openidm</code> - access to the JSON resource API.</p></li><li class="listitem"><p>Any additional properties that are depicted in the configuration
      file (
      <code class="filename">openidm/samples/infoservice/conf/info-<em class="replaceable"><code>name</code></em>.json</code>.)
      </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="system-healthcheck"></a>2.4.&nbsp;Verifying the Health of an OpenIDM System</h2></div></div></div><a class="indexterm" name="d505e1082"></a><p>Due to the highly modular, configurable nature of OpenIDM, it is often 
  difficult to assess whether a system has started up successfully, or whether 
  the system is ready and stable after dynamic configuration changes have been 
  made.</p><p>OpenIDM provides a configurable health check service that verifies 
  that the required modules and services for an operational system are up and 
  running. During system startup, OpenIDM checks that these modules and 
  services are available and reports on whether any requirements for an 
  operational system have not been met. If dynamic configuration changes are 
  made, OpenIDM rechecks that the required modules and services are functioning 
  so that system operation is monitored on an ongoing basis.</p><p>The health check service reports on the state of the OpenIDM system and 
  outputs this state to the console and to the log files. The system can be in 
  one of the following states:</p><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="literal">STARTING</code> - OpenIDM is starting up</td></tr><tr><td><code class="literal">ACTIVE_READY</code> - all of the specified requirements 
   have been met to consider the OpenIDM system ready</td></tr><tr><td><code class="literal">ACTIVE_NOT_READY</code> - one or more of the specified 
   requirements have not been met and the OpenIDM system is not considered ready
   </td></tr><tr><td><code class="literal">STOPPING</code> - OpenIDM is shutting down</td></tr></table><p>OpenIDM checks all required modules and services. Examples of those
  services are shown here.</p><p><span class="bold"><strong>Required Modules</strong></span> (examples)</p><div class="screen"><pre>
"org.forgerock.openicf.framework.connector-framework"
"org.forgerock.openicf.framework.connector-framework-internal"
"org.forgerock.openicf.framework.connector-framework-osgi"
"org.forgerock.openidm.audit"
"org.forgerock.openidm.core"
"org.forgerock.openidm.enhanced-config"
"org.forgerock.openidm.external-email"

   ...

"org.forgerock.openidm.system"
"org.forgerock.openidm.ui"
"org.forgerock.openidm.util"
"org.forgerock.commons.org.forgerock.json.resource"
"org.forgerock.commons.org.forgerock.json.resource.restlet"
"org.forgerock.commons.org.forgerock.restlet"
"org.forgerock.commons.org.forgerock.util"
"org.forgerock.openidm.security-jetty"
"org.forgerock.openidm.jetty-fragment"
"org.forgerock.openidm.quartz-fragment"
"org.ops4j.pax.web.pax-web-extender-whiteboard"
"org.forgerock.openidm.scheduler"
"org.ops4j.pax.web.pax-web-jetty-bundle"
"org.forgerock.openidm.repo-jdbc"
"org.forgerock.openidm.repo-orientdb"
"org.forgerock.openidm.config"
"org.forgerock.openidm.crypto"  
  </pre></div><p><span class="bold"><strong>Required Services</strong></span> (examples)</p><div class="screen"><pre>
"org.forgerock.openidm.config"
"org.forgerock.openidm.provisioner"
"org.forgerock.openidm.provisioner.openicf.connectorinfoprovider"
"org.forgerock.openidm.external.rest"
"org.forgerock.openidm.audit"
"org.forgerock.openidm.policy"
"org.forgerock.openidm.managed"
"org.forgerock.openidm.script"
"org.forgerock.openidm.crypto"
"org.forgerock.openidm.recon"
"org.forgerock.openidm.info"
"org.forgerock.openidm.router"
"org.forgerock.openidm.scheduler"
"org.forgerock.openidm.scope"
"org.forgerock.openidm.taskscanner"
     </pre></div><p>You can replace this list, or add to it, by adding the following lines 
  to the <code class="filename">openidm/conf/boot/boot.properties</code> file:</p><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="literal">"openidm.healthservice.reqbundles"</code> - overrides 
   the default required bundles. Bundles are specified as a list of symbolic 
   names, separated by commas.</td></tr><tr><td><code class="literal">"openidm.healthservice.reqservices"</code> - overrides 
   the default required services. Services are specified as a list of symolic 
   names, separated by commas.</td></tr><tr><td><code class="literal">"openidm.healthservice.additionalreqbundles"</code> - 
   specifies required bundles (in addition to the default list). Bundles are 
   specified as a list of symbolic names, separated by commas.</td></tr><tr><td><code class="literal">"openidm.healthservice.additionalreqservices"</code> - 
   specifies required services (in addition to the default list). Services are 
   specified as a list of symbolic names, separated by commas.</td></tr></table><p>By default, OpenIDM gives the system ten seconds to start up all 
  the required bundles and services, before the system readiness is assessed. 
  Note that this is not the total start time, but the time required to complete 
  the service startup after the framework has started. You can change this 
  default by setting the value of the <code class="literal">servicestartmax</code> 
  property (in miliseconds) in the 
  <code class="filename">openidm/conf/boot/boot.properties</code> file. This example 
  sets the startup time to five seconds.</p><div class="screen"><pre>openidm.healthservice.servicestartmax=5000</pre></div><p>
   The health check service works in tandem with the scriptable information
   service. For more information see <a class="xref" href="#info-service" title="2.3.&nbsp;Obtaining Information About an OpenIDM Instance">Section&nbsp;2.3, &#8220;Obtaining Information About an OpenIDM Instance&#8221;</a>.
  </p><p>
   Do not use the health check service to monitor the status of external
   resources, such as LDAP servers, or external databases. Rather, monitor these
   resources over the REST interface, as described in <a href="../integrators-guide/index.html#systems-over-rest" class="link"><em class="citetitle">Checking the
   Status of External Systems Over REST</em></a>.
  </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="installed-modules"></a>2.5.&nbsp;Displaying Information About Installed Modules</h2></div></div></div><p>On a running OpenIDM instance, you can list the installed modules
     and their states by typing the following command in the Felix
     administration console. (The output will vary by configuration.)</p><div class="screen"><pre>-&gt; <strong>scr list </strong>
      <em>
   Id   State          Name
[  12] [active       ] org.forgerock.openidm.endpoint
[  13] [active       ] org.forgerock.openidm.endpoint
[  14] [active       ] org.forgerock.openidm.endpoint
[  15] [active       ] org.forgerock.openidm.endpoint
[  16] [active       ] org.forgerock.openidm.endpoint

      ...

[  34] [active       ] org.forgerock.openidm.taskscanner
[  20] [active       ] org.forgerock.openidm.external.rest
[   6] [active       ] org.forgerock.openidm.router
[  33] [active       ] org.forgerock.openidm.scheduler
[  19] [unsatisfied  ] org.forgerock.openidm.external.email
[  11] [active       ] org.forgerock.openidm.sync
[  25] [active       ] org.forgerock.openidm.policy
[   8] [active       ] org.forgerock.openidm.script
[  10] [active       ] org.forgerock.openidm.recon
[   4] [active       ] org.forgerock.openidm.http.contextregistrator
[   1] [active       ] org.forgerock.openidm.config
[  18] [active       ] org.forgerock.openidm.endpointservice
[  30] [unsatisfied  ] org.forgerock.openidm.servletfilter
[  24] [active       ] org.forgerock.openidm.infoservice
[  21] [active       ] org.forgerock.openidm.authentication
</em>-&gt;</pre></div><p>To display additional information about a particular module or
     service, run the following command, substituting the <code class="literal">Id</code>
     of that module from the preceding list.</p><div class="screen"><pre>-&gt; scr info <em><strong>Id</strong></em></pre></div><p>The following example displays additional information about the
     router service:</p><div class="screen"><pre>-&gt; <strong>scr info 6 </strong>
      <em>
ID: 6
Name: org.forgerock.openidm.router
Bundle: org.forgerock.openidm.core (41)
State: active
Default State: enabled
Activation: immediate
Configuration Policy: optional
Activate Method: activate (declared in the descriptor)
Deactivate Method: deactivate (declared in the descriptor)
Modified Method: modified
Services: org.forgerock.json.resource.JsonResource
Service Type: service
Reference: ref_JsonResourceRouterService_ScopeFactory
    Satisfied: satisfied
    Service Name: org.forgerock.openidm.scope.ScopeFactory
    Multiple: single
    Optional: mandatory
    Policy: dynamic
Properties:
    component.id = 6
    component.name = org.forgerock.openidm.router
    felix.fileinstall.filename = file:/openidm/samples/sample1/conf/router.json
    jsonconfig = {
    "filters" : [
        {
            "onRequest" : {
                "type" : "text/javascript",
                "file" : "bin/defaults/script/router-authz.js"
            }
        },
        {
            "onRequest" : {
                "type" : "text/javascript",
                "file" : "bin/defaults/script/policyFilter.js"
            },
            "methods" : [
                "create",
                "update"
            ]
        }
    ]
}
    openidm.restlet.path = /
    service.description = OpenIDM internal JSON resource router
    service.pid = org.forgerock.openidm.router
    service.vendor = ForgeRock AS </em>
-&gt;</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="starting-in-debug-mode"></a>2.6.&nbsp;Starting OpenIDM in Debug Mode</h2></div></div></div><p>
   To debug custom libraries, you can start OpenIDM with the option to use the
   Java Platform Debugger Architecture (JPDA).
  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
     Start OpenIDM with the <code class="literal">jpda</code> option:
    </p><div class="screen"><pre>
$ <strong>cd /path/to/openidm
$ ./startup.sh jpda</strong>
<em>
Executing ./startup.sh...
Using OPENIDM_HOME:   /path/to/openidm
Using OPENIDM_OPTS:   -Xmx1024m -Xms1024m -Denvironment=PROD -Djava.compiler=NONE
   -Xnoagent -Xdebug -Xrunjdwp:transport=dt_socket,address=5005,server=y,suspend=n
Using LOGGING_CONFIG:
   -Djava.util.logging.config.file=/path/to/openidm/conf/logging.properties
Listening for transport dt_socket at address: 5005
Using boot properties at /path/to/openidm/conf/boot/boot.properties
-&gt; OpenIDM version "3.1.0-SNAPSHOT" (revision: xxxx)
OpenIDM ready
</em>
    </pre></div><p>
     The relevant JPDA options are outlined in the startup script
     (<code class="literal">startup.sh</code>).
    </p></li><li class="listitem"><p>
     In your IDE, attach a Java debugger to the JVM via socket, on port 5005.
    </p></li></ul></div><div class="caution"><h3 class="title">Caution</h3><p>
    This interface is internal and subject to change. If you depend on this
    interface, contact ForgeRock support.
   </p></div></div></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-cli"></a>Chapter&nbsp;3.&nbsp;OpenIDM Command-Line Interface</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="section"><a href="#cli-configexport">3.1. configexport</a></span></dt><dt><span class="section"><a href="#cli-configimport">3.2. configimport</a></span></dt><dt><span class="section"><a href="#cli-configureconnector">3.3. configureconnector</a></span></dt><dt><span class="section"><a href="#cli-encrypt">3.4. encrypt</a></span></dt><dt><span class="section"><a href="#cli-keytool">3.5. keytool</a></span></dt><dt><span class="section"><a href="#cli-validate">3.6. validate</a></span></dt></dl></div><p>OpenIDM includes a basic command-line interface that provides a number 
 of utilities for managing the OpenIDM instance.</p><p>All of the utilities are subcommands of the <code class="literal">cli.sh</code> 
 (UNIX) or <code class="literal">cli.bat</code> (Windows) scripts. To use the utilities, 
 you can either run them as subcommands, or launch the <span class="command"><strong>cli</strong></span> 
 script first, and then run the utility. For example, to run the 
 <span class="command"><strong>encrypt</strong></span> utility on a UNIX system:</p><div class="screen"><pre>
$ <strong>cd /path/to/openidm </strong>
$ <strong>./cli.sh </strong>
  <em>
Using boot properties at /path/to/openidm/conf/boot/boot.properties
openidm# encrypt ....</em>
 </pre></div><p>or</p><div class="screen"><pre>
$ <strong>cd /path/to/openidm</strong>
$ <strong>./cli.sh encrypt ... </strong>
 </pre></div><p>By default, the command-line utilities run with the properties defined 
 in <code class="filename">/path/to/openidm/conf/boot/boot.properties</code>.</p><p>
  If you run the <span class="command"><strong>cli.sh</strong></span> command by itself, it opens an
  OpenIDM-specific shell prompt:
 </p><div class="screen"><pre>openidm#</pre></div><p>The startup and shutdown scripts are not discussed in this chapter. For 
 information about these scripts, see <a href="../integrators-guide/index.html#chap-services" class="link"><em class="citetitle">Starting and 
 Stopping OpenIDM</em></a>.</p><p>The following sections describe the subcommands and their use. Examples 
 assume that you are running the commands on a UNIX system. For Windows 
 systems, use <span class="command"><strong>cli.bat</strong></span> instead of <span class="command"><strong>cli.sh</strong></span>.
 </p><p>
  For a list of subcommands available from the <code class="literal">openidm#</code>
  prompt, run the <span class="command"><strong>cli.sh help</strong></span> command. The
  <span class="command"><strong>help</strong></span> and <span class="command"><strong>exit</strong></span> options shown below are
  self-explanatory. The other subcommands are explained in the subsections
  that follow.
 </p><div class="screen"><pre>local:keytool  Export or import a SecretKeyEntry. 
	   The Java Keytool does not allow for exporting or importing SecretKeyEntries.
local:encrypt    Encrypt the input string.
local:validate   Validates all json configuration files in the configuration
    (default: /conf) folder.
basic:help   Displays available commands.
basic:exit   Exit from the console.
remote:configureconnector   Generate connector configuration.
remote:configexport         Exports all configurations.
remote:configimport         Imports the configuration set from local file/directory.</pre></div><p>
   The <span class="command"><strong>configexport</strong></span>, <span class="command"><strong>configimport</strong></span>, and
   <span class="command"><strong>configconnector</strong></span> subcommands support up to four options:
  </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">-u or --user USER[:PASSWORD]</span></dt><dd><p>
      Allows you to specify the server user and password. Specifying a username
      is mandatory. If you do not specify a username, the following error is
      output to the console:
      <code class="literal">Remote operation failed: Unauthorized</code>. If you do
      not specify a password, you are prompted for one. This option is used by
      all three subcommands.
     </p></dd><dt><span class="term">--url URL</span></dt><dd><p>
       The URL of the OpenIDM REST service. The default URL is
       <code class="literal">http://localhost:8080/openidm/</code>. This can
       be used to import configuration files from a remote running
       instance of OpenIDM. This option is used by all three subcommands.
       commands.
      </p></dd><dt><span class="term">-P or --port PORT</span></dt><dd><p>
       The port number associated with the OpenIDM REST service. If specified,
       this option overrides any port number specified with the
       <span class="command"><strong>--url</strong></span> option. The default port is 8080. This option is
       used by all three subcommands.
      </p></dd><dt><span class="term">-r or --replaceall or --replaceAll</span></dt><dd><p>
      Replaces the entire list of configuration files with the files in the
      specified backup directory. This option is used with only the
      <span class="command"><strong>configimport</strong></span> command.
     </p></dd></dl></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="cli-configexport"></a>3.1.&nbsp;configexport</h2></div></div></div><p>The <span class="command"><strong>configexport</strong></span> subcommand exports all 
  configuration objects to a specified location, enabling you to reuse a 
  system configuration in another environment. For example, you can test a 
  configuration in a development environment, then export it and import it 
  into a production environment. This subcommand also enables you to inspect 
  the active configuration of an OpenIDM instance.</p><p>OpenIDM must be running when you execute this command.</p><p>Usage is as follows:</p><div class="screen"><pre>
$ ./cli.sh configexport --user username:passsword <em><strong>export-location</strong></em>
  </pre></div><p>For example:</p><div class="screen"><pre>
$ ./cli.sh configexport --user openidm-admin:openidm-admin /tmp/conf</pre></div><p>Configuration objects are exported, as <code class="filename">.json</code>
   files, to the specified directory. The command creates the directory if
   needed. Configuration files that are present in this directory are renamed as
   backup files, with a timestamp, for example,
   <code class="filename">audit.json.2014-02-19T12-00-28.bkp</code>, and are not
   overwritten. The following configuration objects are exported:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The internal repository configuration (<code class="filename">repo.orientdb.json
      </code> or <code class="filename">repo.jdbc.json</code>)</p></li><li class="listitem"><p>Default and custom configuration directories (<code class="filename">script.json
     </code>)</p></li><li class="listitem"><p>The log configuration (<code class="filename">audit.json</code>)</p></li><li class="listitem"><p>The authentication configuration (<code class="filename">authentication.json
      </code>)</p></li><li class="listitem"><p>The cluster configuration (<code class="filename">cluster.json</code>)</p></li><li class="listitem"><p>The configuration of a connected SMTP email server
     (<code class="filename">external.email.json)</code></p></li><li class="listitem"><p>Custom configuration information
      (<code class="filename">info-<em class="replaceable"><code>name</code></em>.json</code>)
     </p></li><li class="listitem"><p>The managed object configuration (<code class="filename">managed.json</code>)
      </p></li><li class="listitem"><p>The connector configuration (<code class="filename">provisioner.openicf-*.json
      </code>)</p></li><li class="listitem"><p>The router service configuration (<code class="filename">router.json</code>)
      </p></li><li class="listitem"><p>The scheduler service configuration (<code class="filename">scheduler.json</code>)
      </p></li><li class="listitem"><p>Any configured schedules (<code class="filename">schedule-*.json</code>)
      </p></li><li class="listitem"><p>The synchronization mapping configuration (<code class="filename">sync.json
      </code>)</p></li><li class="listitem"><p>If workflows are defined, the configuration of the workflow engine 
      (<code class="filename">workflow.json</code>) and the workflow access 
      configuration (<code class="filename">process-access.json</code>)</p></li><li class="listitem"><p>Any configuration files related to the user interface 
     (<code class="filename">ui-*.json</code>)</p></li><li class="listitem"><p>The configuration of any custom endpoints 
      (<code class="filename">endpoint-*.json</code>)</p></li><li class="listitem"><p>The configuration of servlet filters
     (<code class="filename">servletfilter-*.json</code>)</p></li><li class="listitem"><p>The policy configuration (<code class="filename">policy.json</code>)</p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="cli-configimport"></a>3.2.&nbsp;configimport</h2></div></div></div><p>The <span class="command"><strong>configimport</strong></span> subcommand imports configuration 
  objects from the specified directory, enabling you to reuse a system 
  configuration from another environment. For example, you can test a 
  configuration in a development environment, then export it and import it 
  into a production environment.</p><p>The command updates the existing configuration from the 
  <em class="replaceable"><code>import-location</code></em> over the OpenIDM REST interface. 
  By default, if configuration objects are present in the 
  <em class="replaceable"><code>import-location</code></em> and not in the existing 
  configuration, these objects are added. If configuration objects are present 
  in the existing location but not in the 
  <em class="replaceable"><code>import-location</code></em>, these objects are left untouched 
  in the existing configuration.</p><p>If you include the <code class="literal">--replaceAll</code> parameter, the 
  command wipes out the existing configuration and replaces it with the 
  configuration in the <em class="replaceable"><code>import-location</code></em>. Objects in 
  the existing configuration that are not present in the 
  <em class="replaceable"><code>import-location</code></em> are deleted.</p><p>Usage is as follows:</p><div class="screen"><pre>
$ ./cli.sh configimport --user username:password [--replaceAll] <em><strong>import-location</strong></em>
  </pre></div><p>For example:</p><div class="screen"><pre>
$ ./cli.sh configimport --user openidm-admin:openidm-admin --replaceAll /tmp/conf
  </pre></div><p>Configuration objects are imported, as <code class="literal">.json</code> files, 
  from the specified directory to the <code class="filename">conf</code> directory. The 
  configuration objects that are imported are outlined in the corresponding 
  export command, described in the previous section.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="cli-configureconnector"></a>3.3.&nbsp;configureconnector</h2></div></div></div><p>The <span class="command"><strong>configureconnector</strong></span> subcommand generates a 
  configuration for an OpenICF connector.</p><p>Usage is as follows:</p><div class="screen"><pre>$ ./cli.sh configureconnector --user username:password <em><strong>connector-name</strong></em>
  </pre></div><p>Select the type of connector that you want to configure. The following 
  example configures a new XML connector.
  </p><div class="screen"><pre>$ <strong>./cli.sh configureconnector --user openidm-admin:openidm-admin myXmlConnector</strong>
 <em>Starting shell in /path/to/openidm
Using boot properties at /path/to/openidm/conf/boot/boot.properties
0. Scripted SQL Connector version 1.1.0.1
1. XML Connector version 1.1.0.1
2. Database Table Connector version 1.1.0.0
3. CSV File Connector version 1.1.0.1
4. LDAP Connector version 1.1.1.2
5. Exit
Select [0..5]: 1
Edit the configuration file and run the command again. The configuration was 
saved to /openidm/temp/provisioner.openicf-myXmlConnector.json</em></pre></div><p>The basic configuration is saved in a file named 
  <code class="filename">/openidm/temp/provisioner.openicf-<em class="replaceable"><code>connector-name</code></em>.json</code>.
  Edit the <code class="literal">configurationProperties</code> parameter in this file to 
  complete the connector configuration. For an XML connector, you can use the 
  schema definitions in sample 1 for an example configuration.</p><pre class="brush: javascript;">
  "configurationProperties" : {
    "xmlFilePath" : "samples/sample1/data/resource-schema-1.xsd",
    "createFileIfNotExists" : false,
    "xsdFilePath" : "samples/sample1/data/resource-schema-extension.xsd",
    "xsdIcfFilePath" : "samples/sample1/data/xmlConnectorData.xml"
  },  
  </pre><p>For more information about the connector configuration properties, see 
  <a href="../integrators-guide/index.html#openicf-provisioner-conf" class="link"><em class="citetitle">Configuring Connectors</em></a>.</p><p>When you have modified the file, run the 
  <span class="command"><strong>configureconnector</strong></span> command again so that OpenIDM can pick 
  up the new connector configuration.</p><div class="screen"><pre><strong>$ ./cli.sh configureconnector --user openidm-admin:openidm-admin myXmlConnector</strong>
<em>Executing ./cli.sh...
Starting shell in /path/to/openidm
Using boot properties at /path/to/openidm/conf/boot/boot.properties
Configuration was found and read from: /path/to/openidm/temp/provisioner.openicf-myXmlConnector.json</em>
  </pre></div><p>
   You can now copy the new
   <code class="filename">provisioner.openicf-myXmlConnector.json</code> file
   to the <code class="filename">conf/</code> subdirectory.
  </p><p>You can also configure connectors over the REST interface. For more 
  information, see <a href="../integrators-guide/index.html#connector-wiz" class="link"><em class="citetitle">Creating Default Connector Configurations</em></a>.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="cli-encrypt"></a>3.4.&nbsp;encrypt</h2></div></div></div><p>The <span class="command"><strong>encrypt</strong></span> subcommand encrypts an input string, or 
  JSON object, provided at the command line. This subcommand can be used to 
  encrypt passwords, or other sensitive data, to be stored in the OpenIDM 
  repository. The encrypted value is output to standard output and provides 
  details of the cryptography key that is used to encrypt the data.</p><p>Usage is as follows:</p><div class="screen"><pre>
$ ./cli.sh encrypt [-j] <em><strong>string</strong></em>
  </pre></div><p>The <code class="literal">-j</code> option specifies that the string to be 
  encrypted is a JSON object. If you do not enter the string as part of the 
  command, the command prompts for the string to be encrypted. If you enter 
  the string as part of the command, any special characters, for example 
  quotation marks, must be escaped.</p><p>The following example encrypts a normal string value:</p><div class="screen"><pre>
$ <strong>./cli.sh encrypt mypassword  </strong>
  <em>
Executing ./cli.sh
Starting shell in /path/to/openidm
Using boot properties at /path/to/openidm/conf/boot/boot.properties
Activating cryptography service of type: JCEKS provider:  location: security/keystore.jceks
Available cryptography key: openidm-sym-default
Available cryptography key: openidm-localhost
CryptoService is initialized with 2 keys.
-----BEGIN ENCRYPTED VALUE-----
{
  "$crypto" : {
    "value" : {
      "iv" : "M2913T5ZADlC2ip2imeOyg==",
      "data" : "DZAAAM1nKjQM1qpLwh3BgA==",
      "cipher" : "AES/CBC/PKCS5Padding",
      "key" : "openidm-sym-default"
    },
    "type" : "x-simple-encryption"
  }
}
------END ENCRYPTED VALUE------ </em>
  </pre></div><p>The following example encrypts a JSON object. The input string must be 
  a valid JSON object.</p><div class="screen"><pre>
$ <strong>./cli.sh encrypt -j {\"password\":\"myPassw0rd\"}</strong>
<em>
Starting shell in /path/to/openidm
Using boot properties at /path/to/openidm/conf/boot/boot.properties
Activating cryptography service of type: JCEKS provider:  location: security/keystore.jceks
Available cryptography key: openidm-sym-default
Available cryptography key: openidm-localhost
CryptoService is initialized with 2 keys.
-----BEGIN ENCRYPTED VALUE-----
{
  "$crypto" : {
    "value" : {
      "iv" : "M2913T5ZADlC2ip2imeOyg==",
      "data" : "DZAAAM1nKjQM1qpLwh3BgA==",
      "cipher" : "AES/CBC/PKCS5Padding",
      "key" : "openidm-sym-default"
    },
    "type" : "x-simple-encryption"
  }
}
------END ENCRYPTED VALUE------  </em>
  </pre></div><p>The following example prompts for a JSON object to be encrypted. In 
  this case, you need not escape the special characters.</p><div class="screen"><pre>
$ <strong>./cli.sh encrypt -j</strong>
<em>
Using boot properties at /path/to/openidm/conf/boot/boot.properties
Enter the Json value

&gt; Press ctrl-D to finish input
Start data input:</em>
<strong>{"password":"myPassw0rd"}
^D        </strong>
<em>
Activating cryptography service of type: JCEKS provider:  location: security/keystore.jceks
Available cryptography key: openidm-sym-default
Available cryptography key: openidm-localhost
CryptoService is initialized with 2 keys.
-----BEGIN ENCRYPTED VALUE-----
{
  "$crypto" : {
    "value" : {
      "iv" : "6e0RK8/4F1EK5FzSZHwNYQ==",
      "data" : "gwHSdDTmzmUXeD6Gtfn6JFC8cAUiksiAGfvzTsdnAqQ=",
      "cipher" : "AES/CBC/PKCS5Padding",
      "key" : "openidm-sym-default"
    },
    "type" : "x-simple-encryption"
  }
}
------END ENCRYPTED VALUE------</em>
  </pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="cli-keytool"></a>3.5.&nbsp;keytool</h2></div></div></div><a class="indexterm" name="d505e1682"></a><p>
    The <span class="command"><strong>keytool</strong></span> subcommand exports or imports secret key
    values.
   </p><p>
    The Java <span class="command"><strong>keytool</strong></span> command enables you to export and import
    public keys and certificates, but not secret or symmetric keys. The OpenIDM
    <span class="command"><strong>keytool</strong></span> subcommand provides this functionality.
   </p><p>Usage is as follows:</p><div class="screen"><pre>./cli.sh keytool [--export, --import] <em><strong>alias</strong></em>
  </pre></div><p>
   For example, to export the default OpenIDM symmetric key, run the following
   command:
  </p><div class="screen"><pre>
$ <strong>./cli.sh keytool --export openidm-sym-default</strong>
   <em>
Using boot properties at /openidm/conf/boot/boot.properties
Use KeyStore from: /openidm/security/keystore.jceks
Please enter the password: 
[OK] Secret key entry with algorithm AES
AES:606d80ae316be58e94439f91ad8ce1c0  </em>
  </pre></div><p>The default keystore password is <code class="literal">changeit</code>. You 
  should change this password after installation.</p><p>To import a new secret key named <em class="replaceable"><code>my-new-key</code></em>, 
  run the following command:</p><div class="screen"><pre>
$ <strong>./cli.sh keytool --import my-new-key   </strong>
   <em>
Using boot properties at /openidm/conf/boot/boot.properties
Use KeyStore from: /openidm/security/keystore.jceks
Please enter the password: 
Enter the key: 
AES:606d80ae316be58e94439f91ad8ce1c0 </em>
  </pre></div><p>If a secret key of that name already exists, OpenIDM returns the 
  following error:</p><div class="screen"><pre>"KeyStore contains a key with this alias"</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="cli-validate"></a>3.6.&nbsp;validate</h2></div></div></div><a class="indexterm" name="d505e1740"></a><p>The <span class="command"><strong>validate</strong></span> subcommand validates all .json 
  configuration files in the <code class="filename">openidm/conf/</code> directory.</p><p>Usage is as follows:</p><div class="screen"><pre>
$ <strong>./cli.sh validate   </strong>
   <em>
Executing ./cli.sh
Starting shell in /path/to/openidm
Using boot properties at /path/to/openidm/conf/boot/boot.properties
...................................................................
[Validating] Load JSON configuration files from:
[Validating] 	/path/to/openidm/conf
[Validating] audit.json .................................. SUCCESS
[Validating] authentication.json ......................... SUCCESS

    ...

[Validating] sync.json ................................... SUCCESS
[Validating] ui-configuration.json ....................... SUCCESS
[Validating] ui-countries.json ........................... SUCCESS
[Validating] ui-secquestions.json ........................ SUCCESS
[Validating] workflow.json ............................... SUCCESS
  </em></pre></div></div></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-ui"></a>Chapter&nbsp;4.&nbsp;OpenIDM User Interface</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="section"><a href="#ui-overview">4.1. Overview of the Default User Interface</a></span></dt><dt><span class="section"><a href="#ui-configuring">4.2. Configuring the Default User Interface</a></span></dt><dt><span class="section"><a href="#ui-managing-users">4.3. Managing User Accounts With the User Interface</a></span></dt><dt><span class="section"><a href="#ui-managing-workflows">4.4. Managing Workflows From the User Interface</a></span></dt><dt><span class="section"><a href="#ui-customizing">4.5. Changing the UI Theme</a></span></dt><dt><span class="section"><a href="#ui-external-password-reset">4.6. Using an External System for Password Reset</a></span></dt><dt><span class="section"><a href="#ui-external-logout">4.7. Providing a Logout URL to External Applications</a></span></dt><dt><span class="section"><a href="#ui-path">4.8. Changing the UI Path</a></span></dt><dt><span class="section"><a href="#ui-disabling">4.9. Disabling the UI</a></span></dt></dl></div><p>
  OpenIDM provides a customizable, browser-based user interface. The default
  user interface enables administrative users to create, modify and delete user
  accounts. It provides role-based access to tasks based on BPMN2 workflows, and
  allows users to manage certain aspects of their own accounts, including
  configurable self-service registration.
 </p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ui-overview"></a>4.1.&nbsp;Overview of the Default User Interface</h2></div></div></div><p>
   The default user interface is provided as a reference implementation that
   demonstrates the capabilities of the REST API. You can modify certain aspects
   of the default user interface according to the requirements of your
   deployment.
  </p><p>
   To access the user interface, install and start OpenIDM, then point your
   browser to <a class="link" href="https://localhost:8443/openidmui" target="_top">https://localhost:8443/openidmui</a>. If you
   have not installed a certificate that is trusted by a certificate authority,
   you are prompted with an "Untrusted Connection" warning the first time you
   log in to the UI.
  </p><p>
   Log in as the default administrative user (Login: openidm-admin, Password:
   openidm-admin) or as an existing user in the repository. The display differs,
   depending on the role of the user that has logged in.
  </p><p>
   For an administrative user (role <code class="literal">openidm-admin</code>), two tabs
   are displayed - Dashboard and Users. The Dashboard tab lists any tasks
   assigned to the user who has logged in, processes available to be invoked,
   and any notifications for that user.
  </p><p>
   The following image shows the Dashboard tab for the administrative user when
   no tasks, processes, or notifications are available.
  </p><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/ui-admin-view.png" align="middle" height="360" alt="OpenIDM UI Administrator View - Dashboard"></td></tr></table></div><p>
   The Users tab is only available to administrative users and provides an
   interface to manage user entries (OpenIDM managed objects under
   <code class="literal">managed/user</code>).
  </p><p>
   The following image shows the Users tab after with the two sample users
   created after a reconciliation process from Sample 2b.
  </p><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/ui-users-tab.png" align="middle" height="360" alt="OpenIDM UI Administrator View - Users"></td></tr></table></div><p>
   You can sort the list of users alphabetically, by any of the column values.
   Click on the column title to sort.
  </p><p>
   The <code class="literal">Profile</code> link enables the user to modify his username
   or password. The <code class="literal">Change Security Data</code> link, accessed from
   the top of the screen, or from the user's Profile page enables the user to
   change his password and, if this functionality has been enabled, to select a
   new security question.
  </p><p>
   Password changes are subject to the default password policy, as shown in the
   following password update screen.
  </p><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/ui-password-change.png" align="middle" height="360" alt="OpenIDM UI - Password Change"></td></tr></table></div><p>
   For a regular user (role <code class="literal">openidm-authorized</code>), the Users
   tab is not displayed. By default, regular users cannot manage user accounts,
   except for certain aspects of their own accounts.
  </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ui-configuring"></a>4.2.&nbsp;Configuring the Default User Interface</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#ui-self-registration">4.2.1. Enabling Self-Registration</a></span></dt><dt><span class="section"><a href="#ui-security-questions">4.2.2. Configuring Security Questions</a></span></dt><dt><span class="section"><a href="#ui-minimum-length">4.2.3. Minimum Length Security Answers</a></span></dt><dt><span class="section"><a href="#ui-site-identification">4.2.4. Enabling Site Identification</a></span></dt><dt><span class="section"><a href="#ui-country-list">4.2.5. Configuring the Country List</a></span></dt></dl></div><p>
   The following sections outline the configurable aspects of the default user
   interface.
  </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="ui-self-registration"></a>4.2.1.&nbsp;Enabling Self-Registration</h3></div></div></div><p>
    Self-registration (the ability for new users to create their own accounts)
    is disabled by default. To enable self-registration, set
    <code class="literal">"selfRegistration"</code> to <code class="literal">true</code> in the UI
    configuration file (<code class="filename">conf/ui-configuration.json</code>).
   </p><pre class="brush: javascript;">
{
    "configuration" : {
        "selfRegistration" : true,
...    
    </pre><p>
     When self-registration is enabled, a "Register your account" link is
     provided on the login page. When a user creates an account on the account
     registration page, a managed object is created in the OpenIDM repository.
     The default policies for managed objects are applied during account
     creation.
    </p><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/ui-register-account.png" align="middle" height="360" alt="OpenIDM UI - Self Registration"></td></tr></table></div><p>
     User objects created using self-registration automatically have the role
     <code class="literal">openidm-authorized</code>.
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="ui-security-questions"></a>4.2.2.&nbsp;Configuring Security Questions</h3></div></div></div><p>
    In the event that a user forgets his password, a password reset function
    enables registered users to reset their own passwords. To guard against
    unauthorized access, you can specify that users be prompted with one or
    more security questions when they request a password reset.
   </p><p>
    Security questions are disabled by default. To enable them, set
    <code class="literal">"securityQuestions"</code> to <code class="literal">true</code> in the UI
    configuration file (<code class="filename">conf/ui-configuration.json</code>).
   </p><pre class="brush: javascript;">
{
    "configuration" : {
        "securityQuestions" : true,
...    
   </pre><p>
    A default set of questions is provided, but you can add to these, or
    overwrite them. Specify the list of questions to be asked in the
    <code class="filename">conf/ui-secquestions.json</code> file.
   </p><p>
    Refresh your browser after this configuration change for the change to be
    picked up by the UI.
   </p><p>
    When security questions are enabled, the following panel is included on the
    self registration page.
   </p><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/ui-security-questions.png" align="middle" height="360" alt="OpenIDM UI - Security Questions"></td></tr></table></div><p>
    In addition, a "Reset your password" link is provided on the login page.
    When a user attempts to reset her password, she is prompted for the
    response to the security question that she set up during registration.
   </p><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/ui-reset-password.png" align="middle" height="360" alt="OpenIDM UI - Reset Password"></td></tr></table></div><div class="note"><h3 class="title">Note</h3><p>
     If security questions are enabled <span class="emphasis"><em>after</em></span> a specific
     user has registered, that particular user will be unable to use the
     password reset functionality.
    </p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="ui-minimum-length"></a>4.2.3.&nbsp;Minimum Length Security Answers</h3></div></div></div><p>
    The password, passphrase, and security answer are all associated with
    some minimum length. To change that minimum, edit the
    <code class="filename">conf/policy.json</code> file.
    Navigate to the appropriate section. Set the <code class="literal">minLength</code>
    option to the desired number.
   </p><p>
    For example, the following excerpt from the
    <code class="filename">conf/policy.json</code> file shows a default
    <code class="literal">minLength</code> of 16 associated with the security answer.
   </p><pre class="brush: javascript;">
{
    "policyId" : "minimum-length",
    "params" : {
        "minLength" : 16
    }
},</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="ui-site-identification"></a>4.2.4.&nbsp;Enabling Site Identification</h3></div></div></div><p>
    To ensure that users are entering their details onto the correct site, you
    can enable site identification. Site identification provides a preventative
    measure against phishing.
   </p><p>
    With site identification enabled, a user is presented with a range of images
    from which he can select when he registers his account, and prompted to
    specify his own <span class="emphasis"><em>site phrase</em></span>. The selected site image
    and phrase are displayed on login, to confirm that the user is logging in to
    the legitimate site.
   </p><p>
    To enable site identification, set <code class="literal">"siteIdentification"</code>
    to <code class="literal">true</code> in the UI configuration file
    (<code class="filename">conf/ui-configuration.json</code>).
   </p><pre class="brush: javascript;">
{
    "configuration" : {
        "siteIdentification" : true,
...    
    </pre><p>
     Refresh your browser after this configuration change for the change to be
     picked up by the UI.
    </p><p>
    When site identification is enabled, the following panel is included on the
    self registration page.
   </p><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/ui-site-identification.png" align="middle" height="360" alt="OpenIDM UI - Site Identification"></td></tr></table></div><p>
    A default list of four images is presented for site identification. The
    images are defined in the <code class="literal">siteImages</code> property in the
   <code class="filename">conf/ui-configuration.json</code> file:
   </p><pre class="brush: javascript;">
"siteImages" : [
"images/passphrase/mail.png",
"images/passphrase/user.png",
"images/passphrase/report.png",
"images/passphrase/twitter.png"
],
...    
   </pre><p>
    You can change the default images, and include additional images, by
    placing image files in the <code class="filename">ui/extension/images</code> folder
    and modifying the <code class="literal">siteImages</code> property in the
    <code class="filename">ui-configuration.json</code> file to point to the new images.
    Refresh your browser for the change to take effect.
   </p><p>
    The following example assumes an image file named
    <code class="filename">my-new-image.jpg</code>, located in
    <code class="filename">ui/extension/images</code>.
   </p><pre class="brush: javascript;">
"siteImages" : [
"images/passphrase/mail.png",
"images/passphrase/user.png",
"images/passphrase/report.png",
"images/passphrase/twitter.png",
"images/my-new-image.jpg"
],
...
   </pre><p>
    Note that the default image files are located in
    <code class="filename">ui/default/enduser/public/images/passphrase</code>.
   </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="ui-country-list"></a>4.2.5.&nbsp;Configuring the Country List</h3></div></div></div><p>
    The default user profile includes the ability to select the user's country
    and state or province. To specify the countries, and the associated states
    or provinces, that appear in these drop down lists,  edit the
    <code class="filename">conf/ui-countries.json</code> file. For example, to add 
    Norway to the list of countries, you would add the following to the 
    <code class="filename">conf/ui-countries.json</code> file:
   </p><pre class="brush: javascript;">
{
    "key" : "norway",
    "value" : "Norway",
    "states" : [
        {
            "key" : "akershus",
            "value" : "Akershus"
        },
        {
            "key" : "aust-agder",
            "value" : "Aust-Agder"
        },
        {
            "key" : "buskerud",
            "value" : "Buskerud"
        },
...
   </pre><p>
    Refresh your browser after this configuration change for the change to be
    picked up by the UI.
   </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ui-managing-users"></a>4.3.&nbsp;Managing User Accounts With the User Interface</h2></div></div></div><p>
   Only administrative users (with the role <code class="literal">openidm-admin</code>)
   can add, modify, and delete user accounts. Regular users can modify certain
   aspects of their own accounts.
  </p><div class="procedure"><a name="add-user-account"></a><div class="procedure-title">Procedure&nbsp;4.1.&nbsp;To Add a User Account</div><ol class="procedure" type="1"><li class="step"><p>
     Log into the user interface as an administrative user.
    </p></li><li class="step"><p>
     Select the Users tab.
    </p></li><li class="step"><p>
     Click Add User.
    </p></li><li class="step"><p>
     Complete the fields on the Create new account page.
    </p><p>
     Most of these fields are self-explanatory. Be aware that the user interface
     is subject to policy validation, as described in <a href="../integrators-guide/index.html#chap-policies" class="link">
     <em class="citetitle">Using Policies to Validate Data</em></a>. So, for
     example, the Email address must be of valid email address format, and the
     Password must comply with the password validation settings that are
     indicated in the panel to the right.
    </p><p>
     The Admin Role field reflects the roles that are defined in the
     <code class="filename">ui-configuration.json</code> file, as well as any managed
     roles that have been added. By default, the roles are mapped as follows:
    </p><pre class="brush: javascript;">
"roles" : {
    "openidm-admin" : "Administrator",
    "openidm-authorized" : "User",
    "openidm-tasks-manager" : "Tasks Manager"
},  </pre><p>
     A user can be assigned more than one role. Only users with the
     <code class="literal">tasks-manager</code> role can assign tasks to any candidate
     user for that task.
    </p></li></ol></div><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/ui-create-account.png" align="middle" height="360" alt="OpenIDM UI - Create User Account"></td></tr></table></div><div class="procedure"><a name="ui-update-account"></a><div class="procedure-title">Procedure&nbsp;4.2.&nbsp;To Update a User Account</div><ol class="procedure" type="1"><li class="step"><p>
     Log into the user interface as an administrative user.
    </p></li><li class="step"><p>
     Select the Users tab.
    </p></li><li class="step"><p>
     Click the Username of the user that you want to update.
    </p></li><li class="step"><p>
     On the user's profile page, modify the fields you want to change and click
     Update.
    </p><p>
     The user account is updated in the OpenIDM repository.
    </p></li></ol></div><div class="procedure"><a name="deactivate-account"></a><div class="procedure-title">Procedure&nbsp;4.3.&nbsp;To Deactivate a User Account</div><ol class="procedure" type="1"><li class="step"><p>
     Follow steps 1-3 in <a class="xref" href="#ui-update-account" title="Procedure&nbsp;4.2.&nbsp;To Update a User Account">Procedure&nbsp;4.2, &#8220;To Update a User Account&#8221;</a>.
    </p></li><li class="step"><p>
     On the user's profile page, select Inactive from the Account status list.
    </p></li><li class="step"><p>
     Click Update.
    </p><p>
     The user account is deactivated and the user can no longer log in to the
     system.
    </p><p>
     Inactive users are indicated with a X icon in the Status column of the
     Users page. The following image shows that Steven Carter's account has been
     deactivated.
    </p></li></ol></div><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/ui-deactivate-account.png" align="middle" height="360" alt="OpenIDM UI - Deactivate User Account"></td></tr></table></div><div class="procedure"><a name="reset-user-password"></a><div class="procedure-title">Procedure&nbsp;4.4.&nbsp;To Reset a User's Password</div><p>
    Users can change their own passwords by following the Change Security Data
    link in their profiles. This process requires that users know their existing
    passwords.
   </p><p>
    In a situation where a user forgets his password, an administrator can reset
    the password of that user without knowing the user's existing password.
   </p><ol class="procedure" type="1"><li class="step"><p>
     Follow steps 1-3 in <a class="xref" href="#ui-update-account" title="Procedure&nbsp;4.2.&nbsp;To Update a User Account">Procedure&nbsp;4.2, &#8220;To Update a User Account&#8221;</a>.
    </p></li><li class="step"><p>
     On the user's profile page, click Change password.
    </p></li><li class="step"><p>
     Enter a new password that conforms to the password policy and click Update.
    </p><p>
     The user password is updated in the repository.
    </p></li></ol></div><div class="procedure"><a name="delete-user-account"></a><div class="procedure-title">Procedure&nbsp;4.5.&nbsp;To Delete a User Account</div><ol class="procedure" type="1"><li class="step"><p>
     Log into the user interface as an administrative user.
    </p></li><li class="step"><p>
     Select the Users tab.
    </p></li><li class="step"><p>
     Click the Username of the user that you want to delete.
    </p></li><li class="step"><p>
     On the user's profile page, click Delete.
    </p></li><li class="step"><p>
     Click OK to confirm the deletion.
    </p><p>
     The user is deleted from the internal repository.
    </p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ui-managing-workflows"></a>4.4.&nbsp;Managing Workflows From the User Interface</h2></div></div></div><p>
   The UI is integrated with the embedded Activiti worfklow engine, enabling
   users to interact with workflows. Available workflows are displayed under the
   Processes item on the Dashboard. In order for a workflow to be displayed
   here, the workflow definition file must be present in the
   <code class="filename">openidm/workflow</code> directory.
  </p><p>
   A sample workflow integration with the user interface is provided in
   <code class="filename">openidm/samples/workflow</code>, and documented in <a href="../integrators-guide/index.html#example-provisioning-workflow" class="link"><em class="citetitle">Sample Workflow -
   Provisioning User Accounts</em></a>. Follow the steps in that
   sample for an understanding of how the workflow integration works.
  </p><p>
   Access to workflows is based on OpenIDM roles, and is configured in the file
   <code class="filename">conf/process-access.json</code>. By default all users with the
   role <code class="literal">openidm-authorized</code> or
   <code class="literal">openidm-admin</code> can invoke any available workflow. The
   default <code class="filename">process-access.json</code> file is as follows:
  </p><pre class="brush: javascript;">
{
    "workflowAccess" : [
        {
            "propertiesCheck" : {
                "property" : "_id",
                "matches" : ".*",
                "requiresRole" : "openidm-authorized"
            }
        },
        {
            "propertiesCheck" : {
                "property" : "_id",
                "matches" : ".*",
                "requiresRole" : "openidm-admin"
            }
        }
    ]
}  
  </pre><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">"property"</code></span></dt><dd><p>
      Specifies the property used to identify the process definition. By default,
      process definitions are identified by their <code class="literal">_id</code>.
     </p></dd><dt><span class="term"><code class="literal">"matches"</code></span></dt><dd><p>
      A regular expression match is performed on the process definitions,
      according to the specified property. The default
      (<code class="literal">"matches" : ".*"</code>) implies that all process definition
      IDs match.
     </p></dd><dt><span class="term"><code class="literal">"requiresRole"</code></span></dt><dd><p>
      Specifies the OpenIDM role that is required for users to have access to
      the matched process definition IDs. In the default file, users with the
      role <code class="literal">openidm-authorized</code> or
      <code class="literal">openidm-admin</code> have access.
     </p></dd></dl></div><p>
   To extend the process action definition file, identify the processes to which
   users should have access, and specify the qualifying user roles. For example,
   if you wanted to restrict access to a process definition whose ID was
   <code class="literal">567</code>, to users with the role <code class="literal">ldap</code> you
   would add the following to the <code class="filename">process-access.json</code> file:
  </p><pre class="brush: plain;">
{
    "propertiesCheck" : {
        "property" : "_id",
        "matches" : "567",
        "requiresRole" : "ldap"
    }
}
  </pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ui-customizing"></a>4.5.&nbsp;Changing the UI Theme</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#ui-style">4.5.1. Changing the Default Stylesheet</a></span></dt><dt><span class="section"><a href="#ui-logo">4.5.2. Changing the Default Logo</a></span></dt><dt><span class="section"><a href="#ui-locale">4.5.3. Changing the Language of the UI</a></span></dt><dt><span class="section"><a href="#ui-project-config">4.5.4. Creating a Project-Specific UI Theme</a></span></dt></dl></div><p>
   You can customize the theme of the default user interface to apply your own
   branding. The easiest way to adjust the UI theme, is to edit the properties
   in the UI theme configuration file
   (<code class="filename">/path/to/openidm/conf/ui-themeconfig.json</code>). This file
   stores detailed color values, background image paths, and a number of other
   common styling options. Because the UI theme configuration file is part of
   the configuration store, it is shared by all nodes in a cluster. Changes made
   to this file do not have to be replicated manually across nodes.
  </p><p>
   To change theme elements that are not included in the UI theme configuration
   file, you can create a custom theme in the
   <code class="filename">openidm/ui/extension</code> directory. By default the user
   interface reads the stylesheets and images from the
   <code class="filename">openidm/ui/default</code> directory. Do not modify the files in
   this default directory as there is no guarantee that your changes will not be
   overwritten in the next OpenIDM release. Modifications made in the
   <code class="filename">openidm/ui/extension</code> directory can be maintained across
   product upgrades. The UI searches the <code class="literal">extension</code> directory
   first and applies any styles or images located in this directory. Note that
   files added to the <code class="literal">extension</code> directory must be manually
   copied between every node in a cluster.
  </p><p>
   If you want to update the view logic of the UI, you cannot simply add files
   to the extensions folder. It is assumed that if your deployment requires that
   level of control of the user interface, you are no longer going to want to be
   automatically upgraded with subsequent releases. As such, you need to take on
   the task of maintaining a fork of the UI.
  </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="ui-style"></a>4.5.1.&nbsp;Changing the Default Stylesheet</h3></div></div></div><p>
    Most changes to the UI stylesheets can be made in the UI theme configuration
    file (<code class="filename">conf/ui-themeconfig.json</code>).
   </p><p>
    With the following modification made to that file, the background color of
    the UI is changed to dark grey.
   </p><div class="screen"><pre><strong>$ grep "background-color" /path/to/openidm/conf/ui-themeconfig.json</strong>
<em>"background-color" : "#ababab",</em>
   </pre></div><p>
      Refresh your browser window for the change to appear.
     </p><p>
    The default stylesheets are located in the
    <code class="filename">openidm/ui/default/enduser/public/css</code> directory. To
    customize the stylesheets beyond the properties available in the UI theme
    configuration file, copy the default stylesheets to
    <code class="filename">openidm/ui/extension/css</code>, and edit them according to
    your requirements.
   </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="ui-logo"></a>4.5.2.&nbsp;Changing the Default Logo</h3></div></div></div><p>
    The default logo is located in the
    <code class="filename">openidm/ui/default/enduser/public/images</code> directory.
    Any file named <code class="filename">logo.png</code>, added to the directory
    <code class="filename">openidm/ui/extension/images</code>, will replace the default
    logo when the browser is refreshed.
   </p><p>
    To specify a different file name, or to control the size, and other
    properties of the image file that is used for the logo, adjust the
    <code class="literal">logo</code> property in the UI theme configuration file
    (<code class="filename">conf/themeconfig.json</code>).
   </p><p>
    The following change to the UI theme configuration file points to an image
    file named <code class="filename">example-logo.png</code>, in the
    <code class="filename">openidm/ui/extension/images</code> directory.
   </p><pre class="brush: javascript;">...
   "logo" : {
       "src" : "images/example-logo.png",
       "title" : "Example.com",
       "alt" : "Example.com",
       "height" : "80",
       "width" : "120"
   },
...</pre><p>
    Refresh your browser window for the new logo to appear.
   </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="ui-locale"></a>4.5.3.&nbsp;Changing the Language of the UI</h3></div></div></div><p>
    Currently, the UI is provided only in US English. You can translate the UI
    and specify that your own locale is used. The following example shows how to
    translate the UI into French.
   </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
      Copy the default locale to a new folder in the same location
      (<code class="filename">openidm/ui/default/enduser/public/locales</code>):
     </p><div class="screen"><pre>$ cd /path/to/openidm/ui/default/enduser/public/locales
$ cp -R en/ fr/</pre></div><p>
      The new locale (<code class="literal">fr</code>) now contains the default
      <code class="filename">translation.json</code> file.
     </p><div class="screen"><pre><strong>$ ls fr/</strong>
<em>translation.json</em></pre></div></li><li class="step"><p>
      Translate the values of the properties in the
      <code class="filename">fr/translate.json</code> file. Do <span class="emphasis"><em>not</em></span>
      translate the property names. For example:
     </p><pre class="brush: javascript;">...
"UserMessages" : {
    "changedPassword" : "Mot de passe a &eacute;t&eacute; modifi&eacute;",
    "profileUpdateFailed" : "Probl&egrave;me lors de la mise &agrave; jour du profil",
    "profileUpdateSuccessful" : "Profil a &eacute;t&eacute; mis &agrave; jour",
    "userNameUpdated" : "Nom d'utilisateur a &eacute;t&eacute; modifi&eacute;",
.... </pre></li><li class="step"><p>
      Change the UI configuration to use the new locale by setting the value of
      the <code class="literal">lang</code> property in the
      <code class="filename">/path/to/openidm/conf/ui-configuration.json</code> file, as
      follows:
     </p><div class="screen"><pre>"lang" : "fr",</pre></div></li><li class="step"><p>
      Refresh your browser window for the modification to be applied.
     </p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="ui-project-config"></a>4.5.4.&nbsp;Creating a Project-Specific UI Theme</h3></div></div></div><p>
    You can create specific UI themes for different projects and then point a
    particular UI instance to use a defined theme on startup. To create a
    complete custom theme, follow these steps:
   </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
      Shut down the OpenIDM instance, if it is running. In the Felix
      administration console, type:
     </p><div class="screen"><pre>shutdown
-&gt;</pre></div></li><li class="step"><p>
      Clear the <code class="literal">felix-cache</code> directory.
     </p><div class="screen"><pre>$ rm -rf felix-cache</pre></div></li><li class="step"><p>
      Copy the entire default UI theme to an accessible location. For example:
     </p><div class="screen"><pre>$ cd /path/to/openidm/ui
$ cp -r default ../new-project-theme</pre></div></li><li class="step"><p>
      In the copied theme, modify the required elements, as described in the
      previous sections. Note that nothing is copied to the extension folder in
      this case - changes are made in the copied theme.
     </p></li><li class="step"><p>
      In the <code class="literal">openidm/conf/boot/boot.properties</code> file, add the
      following line, specifying the location of the new theme. The path is
      relative to the installation root of the OpenIDM instance.
     </p><div class="screen"><pre>openidm.ui.fileinstall.dir=new-project-theme</pre></div></li><li class="step"><p>
      Restart OpenIDM.
     </p><div class="screen"><pre>$ cd /path/to/openidm
$ ./startup.sh</pre></div></li><li class="step"><p>
      Relaunch the UI in your browser. The UI is displayed with the new custom
      theme.
     </p></li></ol></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ui-external-password-reset"></a>4.6.&nbsp;Using an External System for Password Reset</h2></div></div></div><p>
   By default, the password reset mechanism is handled internally, in OpenIDM.
   You can reroute password reset in the event that a user has forgotten his
   password, by specifying an external URL to which password reset requests are
   sent. Note that this URL applies to the password reset link on the login page
   only, not to the security data change facility that is available after a user
   has logged in.
  </p><p>
   To set an external URL to handle password reset, set the
   <code class="literal">passwordResetLink</code> parameter in the UI configuration file
   (<code class="filename">conf/ui-configuration.json</code>) file. The following example
   sets the <code class="literal">passwordResetLink</code> to
   <code class="literal">https://accounts.example.com/account/reset-password</code>.
  </p><div class="screen"><pre>passwordResetLink: "https://accounts.example.com/reset-password"</pre></div><p>
   The <code class="literal">passwordResetLink</code> parameter takes either an empty
   string as a value (which indicates that no external link is used) or a full
   URL to the external system that handles password reset requests.
  </p><div class="note"><h3 class="title">Note</h3><p>
    External password reset and security questions for internal password reset
    are mutually exclusive. Therefore, if you set a value for the
    <code class="literal">passwordResetLink</code> parameter, users will not be prompted
    with any security questions, regardless of the setting of the
    <code class="literal">securityQuestions</code> parameter.
   </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ui-external-logout"></a>4.7.&nbsp;Providing a Logout URL to External Applications</h2></div></div></div><p>
   By default, a UI session is invalidated when a user clicks on the Log out
   link. In certain situations your external applications might require a
   distinct logout URL to which users can be routed, to terminate their UI
   session.
  </p><p>
   The logout URL is <code class="literal">#logout</code>, appended to the UI URL, for
   example, <code class="literal">https://localhost:8443/openidmui/index.html#logout/</code>.
  </p><p>
   The logout URL effectively performs the same action as clicking on the Log
   out link of the UI.
  </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ui-path"></a>4.8.&nbsp;Changing the UI Path</h2></div></div></div><p>
   By default, the UI is registered at a specific URL
   (<code class="literal"><em class="replaceable"><code>context-root</code></em>/openidmui</code>). To
   override the default URL and specify your own path, edit the
   <code class="filename">openidm/conf/ui.context-enduser.json</code> file, setting the
   <code class="literal">urlContextRoot</code> property to the new URL. For example, to
   change the path to
   <code class="literal"><em class="replaceable"><code>context-root</code></em>/exampleui</code>, edit
   the file as follows:
  </p><div class="screen"><pre>"urlContextRoot" : "/exampleui",</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ui-disabling"></a>4.9.&nbsp;Disabling the UI</h2></div></div></div><p>
   The UI is packaged as a separate bundle that can be disabled in the
   configuration before server startup. To disable the registration of the UI
   servlet, edit the <code class="filename">openidm/conf/ui.context-enduser.json</code>
   file, setting the <code class="literal">enabled</code> property to false:
  </p><div class="screen"><pre>"enabled" : false,</pre></div></div></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-configuration"></a>Chapter&nbsp;5.&nbsp;Configuring OpenIDM</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="section"><a href="#configuration-objects">5.1. OpenIDM Configuration Objects</a></span></dt><dt><span class="section"><a href="#changing-configuration">5.2. Changing the Default Configuration</a></span></dt><dt><span class="section"><a href="#configuring-for-production">5.3. Configuring an OpenIDM System for Production</a></span></dt><dt><span class="section"><a href="#configuring-over-rest">5.4. Configuring OpenIDM Over REST</a></span></dt><dt><span class="section"><a href="#using-property-substitution">5.5. Using Property Value Substitution in the Configuration</a></span></dt><dt><span class="section"><a href="#adding-custom-endpoints">5.6. Adding Custom Endpoints</a></span></dt><dt><span class="section"><a href="#config-default-directories">5.7. Default and Custom Configuration Directories</a></span></dt></dl></div><p>OpenIDM configuration is split between <code class="filename">.properties</code> and container
 configuration files, and also dynamic configuration objects. The majority
 of OpenIDM configuration files are stored under
 <code class="filename">openidm/conf/</code>, as described in the appendix listing the
 <a href="../integrators-guide/index.html#appendix-file-layout" class="link"><em class="citetitle">File
 Layout</em></a>.</p><p>OpenIDM stores configuration objects in its internal repository.
 You can manage the configuration by using either the REST access to the
 configuration objects, or by using the JSON file based views.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="configuration-objects"></a>5.1.&nbsp;OpenIDM Configuration Objects</h2></div></div></div><a class="indexterm" name="d505e2506"></a><a class="indexterm" name="d505e2511"></a><p>OpenIDM exposes internal configuration objects in JSON format.
      Configuration elements can be either single instance or multiple
      instance for an OpenIDM installation.</p><div class="itemizedlist"><a name="single-instance-configuration-objects"></a><div class="itemizedlist-title">Single Instance Configuration Objects</div><p>Single instance configuration objects correspond to services that have
   at most one instance per installation.</p><p>JSON file views of these configuration objects are named
   <code class="filename"><em class="replaceable"><code>object-name</code></em>.json</code>.</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The <code class="literal">audit</code> configuration specifies how audit
    events are logged.</p></li><li class="listitem"><p>The <code class="literal">authentication</code> configuration controls
    REST access.</p></li><li class="listitem"><p>The <code class="literal">cluster</code> configuration defines how one
    OpenIDM instance can be configured in a cluster.</p></li><li class="listitem"><p>The <code class="literal">endpoint</code> configuration controls any custom
    REST endpoints.</p></li><li class="listitem"><p>The <code class="literal">info</code> configuration points to script files for
    the customizable information service.</p></li><li class="listitem"><p>The <code class="literal">managed</code> configuration defines managed
          objects and their schemas.</p></li><li class="listitem"><p>The <code class="literal">policy</code> configuration defines the policy
      validation service.</p></li><li class="listitem"><p>The <code class="literal">process access</code> configuration defines access
      to any configured workflows.</p></li><li class="listitem"><p>The <code class="literal">repo.<em class="replaceable"><code>repo-type</code></em></code>
    configuration such as <code class="literal">repo.orientdb</code> or
    <code class="literal">repo.jdbc</code> configures the internal repository.</p></li><li class="listitem"><p>The <code class="literal">router</code> configuration specifies filters to
    apply for specific operations.</p></li><li class="listitem"><p>The <code class="literal">script</code> configuration defines default
    and custom configuration directories.</p></li><li class="listitem"><p>The <code class="literal">sync</code> configuration defines the mappings that
    OpenIDM uses when synchronizing and reconciling managed objects.</p></li><li class="listitem"><p>The <code class="literal">ui</code> configuration defines the configurable
       aspects of the default user interface.</p></li><li class="listitem"><p>The <code class="literal">workflow</code> configuration defines the
       configuration of the workflow engine.</p></li></ul></div><div class="itemizedlist"><a name="multiple-instance-configuration-objects"></a><div class="itemizedlist-title">Multiple Instance Configuration Objects</div><p>Multiple instance configuration objects correspond to services that
   can have many instances per installation. Configuration objects are named
   <code class="literal"><em class="replaceable"><code>objectname</code></em>/<em class="replaceable"><code>instancename</code></em></code>,
   for example, <code class="filename">provisioner.openicf/xml</code>.</p><p><span class="emphasis"><em>JSON file</em></span> views of these configuration objects 
   are named <code class="filename"><em class="replaceable"><code>objectname</code></em>-<em class="replaceable"><code>instancename</code></em>.json</code>, for example,
   <code class="filename">provisioner.openicf-xml.json.</code></p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Multiple <code class="literal">schedule</code> configurations can run
    reconciliations and other tasks on different schedules.</p></li><li class="listitem"><p>Multiple <code class="literal">provisioner.openicf</code> configurations
    correspond to the resources connected to OpenIDM.</p></li><li class="listitem"><p>Multiple <code class="literal">servletfilter</code> configurations can
    be used for different servlet filters such as the Cross Origin and GZip
    filters.</p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="changing-configuration"></a>5.2.&nbsp;Changing the Default Configuration</h2></div></div></div><div class="itemizedlist"><p>When you change OpenIDM's configuration objects, take the following
         points into account.</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>OpenIDM's authoritative configuration source is the internal
             repository. JSON files provide a view of the configuration objects,
             but do not represent the authoritative source.</p><p>OpenIDM updates JSON files after making configuration changes,
             whether those changes are made through REST access to configuration
             objects, or through edits to the JSON files.</p></li><li class="listitem"><p>OpenIDM recognizes changes to JSON files when it is running. OpenIDM
             <span class="emphasis"><em>must</em></span> be running when you delete configuration
             objects, even if you do so by editing the JSON files.</p></li><li class="listitem"><p>Avoid editing configuration objects directly in the internal
               repository. Rather edit the configuration over the REST API, or
               in the configuration JSON files to ensure consistent behavior
               and that operations are logged.</p></li><li class="listitem"><p>OpenIDM stores its configuration in the internal database by
               default. If you remove an OpenIDM instance and do not specifically
               drop the repository, the configuration remains in effect for a
               new OpenIDM instance that uses that repository. For testing or
               evaluation purposes, you can disable this <span class="emphasis"><em>persistent
               configuration</em></span> in the <code class="filename">conf/system.properties</code>
               file by uncommenting the following line:</p><pre class="brush: plain;">
# openidm.config.repo.enabled=false
             </pre><p>Disabling persistent configuration means that OpenIDM will
                 store its configuration in memory only. You should not disable
                 persistent configuration in a production environment.</p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="configuring-for-production"></a>5.3.&nbsp;Configuring an OpenIDM System for Production</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#configuring-production-repo">5.3.1. Configuring a Production Repository</a></span></dt><dt><span class="section"><a href="#disabling-auto-config-updates">5.3.2. Disabling Automatic Configuration Updates</a></span></dt></dl></div><p>
   Out of the box, OpenIDM is configured to make it easy to install and
   evaluate. Specific configuration changes are required before you deploy
   OpenIDM in a production environment.
  </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="configuring-production-repo"></a>5.3.1.&nbsp;Configuring a Production Repository</h3></div></div></div><p>
    By default, OpenIDM uses OrientDB for its internal repository so that you do
    not have to install a database in order to evaluate OpenIDM. Before you use
    OpenIDM in production, you must replace OrientDB with a supported
    repository.
   </p><p>
    For more information, see <a href="../install-guide/index.html#chap-repository" class="link"><em class="citetitle">Installing a
    Repository for Production</em></a> in the <em class="citetitle">Installation
    Guide</em>.
   </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="disabling-auto-config-updates"></a>5.3.2.&nbsp;Disabling Automatic Configuration Updates</h3></div></div></div><p>
    By default, OpenIDM polls the JSON files in the <code class="literal">conf</code>
    directory periodically for any changes to the configuration. In a production
    system, it is recommended that you disable automatic polling for updates to
    prevent untested configuration changes from disrupting your identity service.
   </p><p>
    To disable automatic polling for configuration changes, edit the
    <code class="filename">conf/system.properties</code> file by uncommenting the
    following line:
   </p><pre class="brush: plain;"># openidm.fileinstall.enabled=false</pre><p>
    This setting also disables the file-based configuration view, which means
    that OpenIDM reads its configuration only from the repository.
   </p><p>
    Before you disable automatic polling, you must have started the OpenIDM
    instance at least once to ensure that the configuration has been loaded into
    the repository.
   </p><p>
    Note if automatic polling is enabled, changes to scripts that are  called
    from a JSON configuration file are taken into account immediately.
   </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="configuring-over-rest"></a>5.4.&nbsp;Configuring OpenIDM Over REST</h2></div></div></div><a class="indexterm" name="d505e2746"></a><a class="indexterm" name="d505e2749"></a><p>OpenIDM exposes configuration objects under the
  <code class="literal">/openidm/config</code> context path.</p><a class="indexterm" name="d505e2759"></a><p>You can list the configuration on the local host by performing a GET
  <code class="literal">https://localhost:8443/openidm/config</code>. The following
  example shows excerpts of the default configuration for an OpenIDM instance
  started with Sample 1.</p><div class="screen"><pre><strong>$ curl \
 --request GET \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --cacert self-signed.crt \
 https://localhost:8443/openidm/config</strong>
   <em>{
   "configurations": [
      {
         "factoryPid": "servletfilter",
         "pid": "servletfilter.ec099f08-bfd4-4ab4-8537-78e5b956c7cc",
         "_id": "servletfilter/gzip"
      },
      {
         "factoryPid": null,
         "pid": "router",
         "_id": "router"
      },

   ...

      {
         "factoryPid": "endpoint",
         "pid": "endpoint.7e9ec068-bb4a-4fa0-ae15-1706bb4a3a07",
         "_id": "endpoint/jqgrid"
      },
      {
         "factoryPid": "endpoint",
         "pid": "endpoint.47978983-0411-425d-8f53-4022175e146a",
         "_id": "endpoint/gettasksview"
      },

   ...

      {
         "factoryPid": "ui",
         "pid": "ui.b10eb4cb-83e3-4a4b-9d29-d91d90eb3053",
         "_id": "ui/countries"
      },
      {
         "factoryPid": "process",
         "pid": "process.9863529c-60e0-42e3-b5d5-c5c704016e95",
         "_id": "process/access"
      }
   ]
}</em></pre></div><p>Single instance configuration objects are located under
  <code class="literal">openidm/config/<em class="replaceable"><code>object-name</code></em></code>.
  The following example shows the default <code class="literal">audit</code>
  configuration.</p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 "https://localhost:8443/openidm/config/audit"</strong>
<em>{
   "eventTypes": {
     "recon": {},
     "activity": {
       "filter": {
         "actions": [
           "create",
           "update",
           "delete",
           "patch",
           "action"
         ]
       },
       "passwordFields": [
         "password"
       ],
       "watchedFields": []
     }
   },
   "exceptionFormatter": {
     "file": "bin/defaults/script/audit/stacktraceFormatter.js",
     "type": "text/javascript"
   },
   "logTo": [
     {
       "recordDelimiter": ";",
       "logType": "csv",
       "location": "audit"
     },
     {
       "useForQueries": true,
       "logType": "repository"
     }
   ]
} </em>  </pre></div><p>Multiple instance configuration objects are found under
  <code class="literal">openidm/config/<em class="replaceable"><code>object-name</code></em>/<em class="replaceable"><code>instance-name</code></em></code>.
  </p><p>The following example shows the configuration for the XML connector
    provisioner, based on the first IDM sample described in the
    <a href="../install-guide/index.html#chap-sample" class="link"><em class="citetitle">
    First IDM Sample</em></a> of the OpenIDM Installation Guide.</p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 "https://localhost:8443/openidm/config/provisioner.openicf/xml"</strong>
<em>{
    "operationTimeout": {
      "SCRIPT_ON_CONNECTOR": -1,
      "VALIDATE": -1,
      "SYNC": -1,
      "DELETE": -1,
      "TEST": -1,
      "UPDATE": -1,
      "CREATE": -1,
      "AUTHENTICATE": -1,
      "SEARCH": -1,
      "GET": -1,
      "SCRIPT_ON_RESOURCE": -1,
      "SCHEMA": -1
    },
    "connectorRef": {
      "connectorName": "org.forgerock.openicf.connectors.xml.XMLConnector",
      "bundleVersion": "1.1.0.1",
      "bundleName": "org.forgerock.openicf.connectors.xml-connector"
    },
    "connectorPoolingSupported": true,
    "syncFailureHandler": {
      "maxRetries": 5,
      "postRetryAction": "logged-ignore"
    },
    "configurationProperties": {
      "xsdFilePath": "samples/sample1/data/resource-schema-extension.xsd",
      "xsdIcfFilePath": "samples/sample1/data/resource-schema-1.xsd",
      "xmlFilePath": "samples/sample1/data/xmlConnectorData.xml"
    },
    "objectTypes": {
      "account": {
        "nativeType": "__ACCOUNT__",
        "$schema": "http://json-schema.org/draft-03/schema",
        "type": "object",
        "properties": {
          "securityAnswer": {
            "nativeType": "string",
            "nativeName": "securityAnswer",
            "required": true,
            "type": "string"
          },
          "securityQuestion": {
            "nativeType": "string",
            "nativeName": "securityQuestion",
            "required": true,
            "type": "string"
          },
          "password": {
            "nativeType": "string",
            "nativeName": "password",
            "type": "string"
          },
          "mobileTelephoneNumber": {
            "nativeType": "string",
            "nativeName": "mobileTelephoneNumber",
            "required": true,
            "type": "string"
          },
          "_id": {
            "nativeName": "__UID__",
            "type": "string"
          },
          "email": {
            "nativeType": "string",
            "nativeName": "email",
            "type": "string"
          },
          "description": {
            "nativeType": "string",
            "nativeName": "__DESCRIPTION__",
            "type": "string"
          },
          "name": {
            "nativeType": "string",
            "nativeName": "__NAME__",
            "required": true,
            "type": "string"
          },
          "roles": {
            "nativeType": "string",
            "nativeName": "roles",
            "required": false,
            "type": "string"
          },
          "lastname": {
            "nativeType": "string",
            "nativeName": "lastname",
            "required": true,
            "type": "string"
          },
          "firstname": {
            "nativeType": "string",
            "nativeName": "firstname",
            "type": "string"
          }
        },
        "id": "__ACCOUNT__"
      }
    },
    "operationOptions": {},
    "name": "xmlfile",
    "producerBufferSize": 100,
    "poolConfigOption": {
      "maxObjects": 10,
      "minEvictableIdleTimeMillis": 120000,
      "maxIdle": 10,
      "minIdle": 1,
      "maxWait": 150000
    }
  }
</em>
  </pre></div><p>
   You can change the configuration over REST by using an HTTP PUT request to
   modify the required configuration object. Note that HTTP PATCH is not
   supported on the <code class="literal">/config</code> endpoint.
  </p><p>
   The following example modifies the <code class="filename">router.json</code> file to
   remove all filters, effectively bypassing any policy validation.
  </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request PUT \
 --data '{
   "filters" : [
     {
       "onRequest" : {
         "type" : "text/javascript",
         "file" : "bin/defaults/script/router-authz.js"
       }
     }
   ]
   }' \
 "https://localhost:8443/openidm/config/router"</strong>
<em>{
  "filters": [
    {
      "onRequest": {
        "file": "bin/defaults/script/router-authz.js",
        "type": "text/javascript"
      }
    }
  ]
} </em></pre></div><p>
   For more information about using the REST API to update objects, see the
   <a href="../integrators-guide/index.html#appendix-rest" class="link"><em class="citetitle">REST API
   Reference</em></a>.
  </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="using-property-substitution"></a>5.5.&nbsp;Using Property Value Substitution in the Configuration</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#property-substitution-system">5.5.1. Using Property Value Substitution With System Properties</a></span></dt><dt><span class="section"><a href="#property-substitution-limitations">5.5.2. Limitations of Property Value Substitution</a></span></dt></dl></div><p>
   In an environment where you have more than one OpenIDM instance, you might
   require a configuration that is similar, but not identical, across the
   different OpenIDM hosts. OpenIDM supports variable replacement in its
   configuration which means that you can modify the effective configuration
   according to the requirements of a specific environment or OpenIDM instance.
  </p><div class="itemizedlist"><p>
    Property substitution enables you to achieve the following:
   </p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
     Define a configuration that is specific to a single OpenIDM instance, for
     example, setting the location of the keystore on a particular host.
    </p></li><li class="listitem"><p>
     Define a configuration whose parameters vary between different
     environments, for example, the URLs and passwords for test, development,
     and production environments.
    </p></li><li class="listitem"><p>
     Disable certain capabilities on specific nodes. For example, you might want
     to disable the workflow engine on specific instances.
    </p></li></ul></div><p>
   When OpenIDM starts up, it combines the system configuration, which might
   contain specific environment variables, with the defined OpenIDM
   configuration properties. This combination makes up the effective
   configuration for that OpenIDM instance. By varying the environment
   properties, you can change specific configuration items that vary between
   OpenIDM instances or environments.
  </p><p>
   Property references are contained within the construct
   <code class="literal">&amp;{ }</code>. When such references are found, OpenIDM replaces
   them with the appropriate property value, defined in the
   <code class="filename">boot.properties</code> file.
  </p><div class="example"><a name="d505e2864"></a><div class="example-title">Example&nbsp;5.1.&nbsp;</div><div class="example-contents"><p>The following example defines two separate OpenIDM environments - 
   a development environment and a production environment. You can specify the 
   environment at startup time and, depending on the environment, the database 
   URL is set accordingly.</p><p>The environments are defined by adding the following lines to the 
   <code class="filename">conf/boot.properties</code> file:</p><pre class="brush: javascript;">PROD.location=production
DEV.location=development</pre><p>
    The database URL is then specified as follows in the
    <code class="filename">repo.orientdb.json</code> file:
   </p><pre class="brush: javascript;">{
    "dbUrl" : "plocal:./db/&amp;{&amp;{environment}.location}-openidm",
    ...
}   </pre><p>
    The effective database URL is determined by setting the
    <code class="literal">OPENIDM_OPTS</code> environment variable when you start OpenIDM.
    To use the production environment, start OpenIDM as follows:
   </p><div class="screen"><pre>$ export OPENIDM_OPTS="-Xmx1024m -Xms1024m -Denvironment=PROD"
$ ./startup.sh</pre></div><p>
    To use the development environment, start OpenIDM as follows:
   </p><div class="screen"><pre>$ export OPENIDM_OPTS="-Xmx1024m -Xms1024m -Denvironment=DEV"
$ ./startup.sh</pre></div></div></div><br class="example-break"><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="property-substitution-system"></a>5.5.1.&nbsp;Using Property Value Substitution With System Properties</h3></div></div></div><p>You can use property value substitution in conjunction with the system 
  properties, to modify the configuration according to the system on which 
  the OpenIDM instance runs.</p><div class="example"><a name="custom-audit-log-location"></a><div class="example-title">Example&nbsp;5.2.&nbsp;Custom Audit Log Location</div><div class="example-contents"><p>The following example modifies the <code class="literal">audit.json</code> file so 
   that the log file is written to the user's directory. The 
   <code class="literal">user.home</code> property is a default Java System property.</p><pre class="brush: javascript;">{
    "logTo" : [
        {
            "logType" : "csv",
            "location" : "&amp;{user.home}/audit",
            "recordDelimiter" : ";"
        }
    ]
}
   </pre></div></div><br class="example-break"><p>You can define <span class="emphasis"><em>nested</em></span> properties (that is a property 
 definition within another property definition) and you can combine system 
 properties and boot properties.</p><div class="example"><a name="d505e2915"></a><div class="example-title">Example&nbsp;5.3.&nbsp;</div><div class="example-contents"><p>
   The following example uses the <code class="literal">user.country</code> property, a
   default Java System property. The example defines specific LDAP ports,
   depending on the country (identified by the country code) in the 
   <code class="literal">boot.properties</code> file. The value of the LDAP port (set in 
   the <code class="literal">provisioner.openicf-ldap.json</code> file) depends on the 
   value of the <code class="literal">user.country</code> System property.
  </p><p>
   The port numbers are defined in the <code class="literal">boot.properties</code>
   file as follows:
  </p><pre class="brush: javascript;">openidm.NO.ldap.port=2389
openidm.EN.ldap.port=3389
openidm.US.ldap.port=1389</pre><p>
   The following extract from the <code class="literal">provisioner.openicf-ldap.json</code>
   file shows how the value of the LDAP port is eventually determined, based on
   the System property:
  </p><pre class="brush: javascript;">"configurationProperties" :
   {
      "credentials" : "Passw0rd",
      "port" : "&amp;{openidm.&amp;{user.country}.ldap.port}",
      "principal" : "cn=Directory Manager",
      "baseContexts" :
         [
            "dc=example,dc=com"
         ],
      "host" : "localhost"
   }</pre></div></div><br class="example-break"></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="property-substitution-limitations"></a>5.5.2.&nbsp;Limitations of Property Value Substitution</h3></div></div></div><div class="itemizedlist"><p>
     Note the following limitations when you use property value substitution:
    </p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
      You cannot reference complex objects or properties with syntaxes other
      than String. Property values are resolved from the
      <code class="literal">boot.properties</code> file or from the System properties and
      the value of these properties is always in String format.
     </p><p>
      Property substitution of boolean values is currently only supported in
      stringified format, that is, resulting in <code class="literal">"true"</code> or
      <code class="literal">"false"</code>.
     </p></li><li class="listitem"><p>
      Substitution of encrypted property values is currently not supported.
     </p></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="adding-custom-endpoints"></a>5.6.&nbsp;Adding Custom Endpoints</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#adding-custom-endpoints-structure">5.6.1. The Components of an Endpoint Configuration File</a></span></dt><dt><span class="section"><a href="#adding-custom-endpoints-context-components">5.6.2. Context Component Access Methods</a></span></dt><dt><span class="section"><a href="#adding-custom-endpoints-request">5.6.3. Custom Endpoints and <code class="literal">request</code> Objects</a></span></dt><dt><span class="section"><a href="#adding-custom-endpoints-chains">5.6.4. Custom Endpoints, Contexts, and Chains</a></span></dt><dt><span class="section"><a href="#adding-custom-endpoints-more">5.6.5. Additional Custom Endpoint Parameters</a></span></dt><dt><span class="section"><a href="#adding-custom-endpoints-example">5.6.6. Custom Endpoint Example</a></span></dt></dl></div><p>
    You can customize OpenIDM to meet the specific requirements of your
    deployment by adding your own RESTful endpoints. Endpoints are configured
    in files named
    <code class="filename">conf/endpoint-<em class="replaceable"><code>name</code></em>.json</code>,
    where <em class="replaceable"><code>name</code></em> generally describes the purpose of the
    endpoint.
   </p><p>
    A sample custom endpoint configuration is provided in the
    <code class="filename">openidm/samples/customendpoint</code> directory. The use
    of this sample is described in
    <a class="xref" href="#adding-custom-endpoints-example" title="5.6.6.&nbsp;Custom Endpoint Example">Section&nbsp;5.6.6, &#8220;Custom Endpoint Example&#8221;</a>. Custom endpoints in
    OpenIDM can be written either in JavaScript or Groovy. The sample includes
    three files:
   </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">conf/endpoint-echo.json</span></dt><dd><p>
       Provides the configuration for the endpoint.
      </p></dd><dt><span class="term">script/echo.js</span></dt><dd><p>
       Supports an endpoint script written in JavaScript.
      </p></dd><dt><span class="term">script/echo.groovy</span></dt><dd><p>
       Supports an endpoint script written in Groovy.
      </p></dd></dl></div><p>
    Endpoint configuration files have a certain structure. They may cite scripts
    written in JavaScript or Groovy.
   </p><p>
    The cited scripts include defined <code class="literal">request</code> and
    <code class="literal">context</code> global variables.
   </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="adding-custom-endpoints-structure"></a>5.6.1.&nbsp;The Components of an Endpoint Configuration File</h3></div></div></div><p>
     The sample custom endpoint configuration
     (<code class="filename">/path/to/openidm/samples/customendpoint/conf/endpoint-echo.json</code>)
     depicts a typical endpoint, configured to use a Groovy script that is
     specified in the <code class="filename">script/echo.groovy</code> file. The
     structure of the sample configuration is as follows:
    </p><pre class="brush: javascript;">{
  "file" : "echo.groovy",
  "type" : "groovy",
  "_file" : "echo.js",
  "_type" : "text/javascript"
}    </pre><p>
      The <code class="literal">"_file"</code> and <code class="literal">"_type"</code> properties
      are comments, which you can change to accommodate an endpoint written in
      JavaScript.
     </p><p>
      If appropriate, you can also include a <code class="literal">context</code> property
      in this file. The following example shows how the
      <code class="literal">context</code> is used to display routing to an endpoint.
     </p><pre class="brush: javascript;">
  "context" : "endpoint/echo",
     </pre><p>
      The endpoint configuration can specify the route on which the endpoint is
      available. For an example, look at the
      <code class="filename">conf/endpoint-linkedView.json</code> file. The code shown
      declares the route on which the endpoint is available.
     </p><pre class="brush: javascript;">
{
  "context": "endpoint/linkedView/*",
  "type" : "text/javascript",
  "source" : "require('linkedView').fetch(request.resourceName);"
}
     </pre><p>
      The following list describes each property in the custom endpoint
      configuration file:
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">"type"</code></span></dt><dd><p>
            string, required
           </p><p>
            Specifies the type of script to be executed. Supported types include
            <code class="literal">"text/javascript"</code> and <code class="literal">"groovy"</code>.
           </p></dd><dt><span class="term"><code class="literal">"file"</code> or <code class="literal">"source"</code></span></dt><dd><p>
            The actual script, inline, or a path to the file that
            contains the script. The script files associated with this sample,
            <code class="filename">echo.js</code> and <code class="filename">echo.groovy</code>,
            support requests using all ForgeRock RESTful CRUD operations
            (including PATCH, ACTION, and QUERY).
           </p></dd><dt><span class="term"><code class="literal">context</code></span></dt><dd><p>
          Requests are dispatched, routed, handled, processed, and more, in a
          <code class="literal">context</code>.
         </p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="adding-custom-endpoints-context-components"></a>5.6.2.&nbsp;Context Component Access Methods</h3></div></div></div><p>
      For both JavaScript and Groovy, the context consists of a chain of
      structures that provide different levels of detail. The detail varies
      depending on the context type:
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">security</code></span></dt><dd><p>
         Provides authentication / authorization data.
        </p></dd><dt><span class="term"><code class="literal">http</code></span></dt><dd><p>
         Provides data from the HTTP request.
        </p></dd><dt><span class="term">
        <code class="literal">router</code>
       </span></dt><dd><p>
         Provides data on where the information is sent.
        </p></dd></dl></div><p>
      JavaScript and Groovy access these context structures in different ways.
      The term shown is the JavaScript access method; the definition includes
      the Groovy access method.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">context.current</code></span></dt><dd><p>
         In Groovy, known simply as <code class="literal">context</code>
        </p><p>
         The current context in which the request is handled by a script or a
         script-hook.
        </p></dd><dt><span class="term">
        <code class="literal">context.http</code>
       </span></dt><dd><p>
         In Groovy, known as one of the following:
         </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
           <code class="literal">
            context.asContext(org.forgerock.json.resource.servlet.HttpContext.class)
           </code>
          </td></tr><tr><td>
           <code class="literal">
            context.getContext("http")
           </code>
          </td></tr></table><p>
        </p><p>
         The HTTP context.
        </p></dd><dt><span class="term"><code class="literal">context.security</code></span></dt><dd><p>
         In Groovy, known as one of the following:
         </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
           <code class="literal">
            context.asContext(org.forgerock.json.resource.SecurityContext.class)
           </code>
          </td></tr><tr><td>
           <code class="literal">
            context.getContext("security")
           </code>
          </td></tr></table><p>
        </p><p>
         The security context.
        </p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="adding-custom-endpoints-request"></a>5.6.3.&nbsp;Custom Endpoints and <code class="literal">request</code> Objects</h3></div></div></div><p>
      The endpoint configuration file specifies a script (either inline with the
      <code class="literal">"source"</code> property, or in a referenced file with the
      <code class="literal">"file"</code> property). The script is invoked with a global
      <code class="literal">request</code> variable in its scope.
     </p><p>
      All processes within OpenIDM are initiated with a request. Requests can
      come either from the REST API, as shown in the <a href="../integrators-guide/index.html#appendix-rest" class="link"><em class="citetitle">REST API
      Reference</em></a>) or internally, from a script, using the
      <code class="literal">openidm</code> router object, as defined in the
      <a href="../integrators-guide/index.html#appendix-router" class="link"><em class="citetitle">Router Service
      Reference</em></a>.
      Regardless of how the process is initiated, the details of the request are
      represented in the same way - within an object named <code class="literal">request</code>.
     </p><p>
      Most request types include a complex object that stores the details
      required for that particular request. For example, when you start an
      <code class="literal">action</code> process over the REST interface, you might want
      to include certain detailed information for that action. You include this
      information as a JSON string in the POST body. The HTTP request header
      <code class="literal">Content-type</code> describes this string as
      <code class="literal">application/json</code>.
     </p><p>
      Consider the following REST request:
     </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "Content-Type: application/json" \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request POST \
 --data { "name": "bob"} \
 "https://localhost:8443/openidm/endpoint/test?_action=myAction"</strong></pre></div><p>
      This request includes the string <code class="literal">'{ "name": "bob"}'</code>
      as the HTTP post body. OpenIDM expects this to be a JSON string, and will
      deserialize it into an object. The object is accessed using
      <code class="literal">request.content</code>.
     </p><p>
      Depending on the type of <code class="literal">request</code>,
      the associated content may include the following
      properties:
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">method</code></span></dt><dd><p>The requested operation, which may be <code class="literal">create</code>,
         <code class="literal">read</code>, <code class="literal">update</code>,
         <code class="literal">delete</code>, <code class="literal">patch</code>,
         <code class="literal">query</code> or <code class="literal">action</code>.</p></dd><dt><span class="term"><code class="literal">resourceName</code></span></dt><dd><p>The local identifier, without the <code class="literal">endpoint/</code>
         prefix, such as <code class="literal">echo</code>.</p></dd><dt><span class="term"><code class="literal">newResourceId</code></span></dt><dd><p>
         An identifier associated with a new resource, associated with
         the <code class="literal">create</code> method.
        </p></dd><dt><span class="term"><code class="literal">additionalParameters</code></span></dt><dd><p>The sample code returns request parameters from an HTTP GET
         with <code class="literal">?param=x</code>, as
         <code class="literal">"params":{"param":"x"}</code>.</p></dd><dt><span class="term"><code class="literal">revision</code></span></dt><dd><p>
         The revision level associated with the method used, relative to
         a <code class="literal">newResourceId</code>.
        </p></dd><dt><span class="term"><code class="literal">content</code></span></dt><dd><p>
         Content based on the latest version of the object, using
         <code class="literal">getObject</code>.
        </p></dd><dt><span class="term"><code class="literal">context</code></span></dt><dd><p>
         Based on a JSON object that contains nested attributes. The object
         with the attributes, defines the request, based on ForgeRock REST
         <a href="../integrators-guide/index.html#rest-supported-operations" class="link"><em class="citetitle">
         Supported Operations</em></a>.
        </p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="adding-custom-endpoints-chains"></a>5.6.4.&nbsp;Custom Endpoints, Contexts, and Chains</h3></div></div></div><p>
     Custom endpoints include contexts that may be wrapped in various layers,
     analogous to the way network packets can be wrapped at ascending network
     levels.
    </p><p>
     As an example, start with a request such as the following:
    </p><div class="screen"><pre>GET https://localhost:8443/openidm/endpoint/echo?queryId=query-all-ids&amp;_para=foo</pre></div><p>
     A request at an endpoint starts with a root context, associated with a
     specific context ID, and the
     <code class="literal">org.forgerock.json.resource.RootContext</code> context.
    </p><p>
     The root context is wrapped in the security context that holds the
     authentication and authorization detail for the request. The associated
     class is <code class="literal">org.forgerock.json.resource.SecurityContext</code>,
     with an <code class="literal">authenticationId</code> user name such as
     <code class="literal">openidm-admin</code>, and associated roles such as
     <code class="literal">openidm-authorized</code>.
    </p><p>
     That security context is further wrapped by the HTTP context, with the
     target URI. The class is
     <code class="literal">org.forgerock.json.resource.HttpContext</code>, and it is
     associated with the normal parameters of a REST call, including a user
     agent, authorization token, and method.
    </p><p>
     The HTTP context is then further wrapped by one or more server / router
     context(s). That class is
     <code class="literal">org.forgerock.json.resource.RouterContext</code>,
     with an endpoint URI. You may see several layers of server and router
     contexts.
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="adding-custom-endpoints-more"></a>5.6.5.&nbsp;Additional Custom Endpoint Parameters</h3></div></div></div><p>
      A couple of additional parameters are shown with the
      <code class="literal">query</code> request method. You can review how this works
      in the following section of the OpenIDM Installation Guide:
      <a href="../install-guide/index.html#more-sample2c" class="link"><em class="citetitle">Sample 2c -
      Synchronizing LDAP Group Membership</em></a>.
     </p><p>
      The final statement in the script is the return value. In the following
      example, there is no <code class="literal">return</code> keyword, and the value of
      the last statement (<code class="literal">x</code>) is returned.
     </p><pre class="brush: javascript;">var x = "Sample return";
functioncall();
x   </pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="adding-custom-endpoints-example"></a>5.6.6.&nbsp;Custom Endpoint Example</h3></div></div></div><p>The following example uses the sample provided in the
      <code class="filename">openidm/samples/customendpoint</code> directory, copied to
      the <code class="filename">openidm/conf</code> and
      <code class="filename">openidm/script</code> directories. The output from the query
      shows the complete request structure.
     </p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/endpoint/echo?_queryId=query-all-ids"
     </strong>
     <em>{
 "result" : [ {
     "method" : "query",
     "resourceName" : "",
     "pagedResultsCookie" : null,
     "pagedResultsOffset" : 0,
     "pageSize" : 0,
     "queryExpression" : null,
     "queryId" : "query-all-ids",
     "queryFilter" : "null",
     "parameters" : { },
     "context" : {
       "parent" : {
         "parent" : {
           "parent" : {
             "parent" : {
               "parent" : {
                 "parent" : null,
                 "contextName" : "root",
                 "rootContext" : true,
                 "id" : "43576021-fe54-4468-8d10-09b14af2a36d"
               },
               "contextName" : "security",
               "authenticationId" : "openidm-admin",
               "authorizationId" : {
                 "id" : "openidm-admin",
                 "component" : "repo/internal/user",
                 "roles" : [ "openidm-admin", "openidm-authorized" ]
               },
               "rootContext" : false,
               "id" : "43576021-fe54-4468-8d10-09b14af2a36d"
             },
             "headers" : {
               "X-OpenIDM-Username" : [ "openidm-admin" ],
               "Host" : [ "localhost:8443" ],
               "Accept" : [ "*/*" ],
               "X-OpenIDM-Password" : [ "openidm-admin" ],
               "User-Agent" : [ "curl/7.19.7 (x86_64-redhat-linux-gnu)
                 libcurl/7.19.7 NSS/3.14.0.0 zlib/1.2.3 libidn/1.18
                 libssh2/1.4.2" ]
             },
             "parameters" : {
               "_queryId" : [ "query-all-ids" ],
               "_prettyPrint" : [ "true" ]
             },
             "external" : true,
             "contextName" : "http",
             "method" : "GET",
             "path" : "https://localhost:8443/openidm/endpoint/echo",
             "rootContext" : false,
             "id" : "43576021-fe54-4468-8d10-09b14af2a36d"
           },
           "contextName" : "apiInfo",
           "apiVersion" : "2.3.1-SNAPSHOT",
           "apiName" : "org.forgerock.commons.json-resource-servlet",
           "rootContext" : false,
           "id" : "43576021-fe54-4468-8d10-09b14af2a36d"
         },
         "contextName" : "server",
         "rootContext" : false,
         "id" : "43576021-fe54-4468-8d10-09b14af2a36d"
       },
       "uriTemplateVariables" : { },
       "contextName" : "router",
       "matchedUri" : "endpoint/echo",
       "baseUri" : "endpoint/echo",
       "rootContext" : false,
       "id" : "43576021-fe54-4468-8d10-09b14af2a36d"
     }
 } ],
 "resultCount" : 1,
 "pagedResultsCookie" : null,
 "remainingPagedResults" : -1
} </em> </pre></div><p>You must protect access to any custom endpoints by configuring the 
    appropriate authorization for those contexts. For more information, see 
    the <a href="../integrators-guide/index.html#openidm-authorization" class="link">
    <em class="citetitle">Authorization</em></a> section.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="config-default-directories"></a>5.7.&nbsp;Default and Custom Configuration Directories</h2></div></div></div><p>
    You can set up custom configuration files in directories as
    defined in the <code class="filename">openidm/conf/script.json</code> file.
   </p><p>
    The following portion of the <code class="filename">script.json</code> file
    points to sources in installation and project directories. As implied in the
    section on
    <a href="../integrators-guide/index.html#startup-configuration" class="link">
     <em class="citetitle">Specifying the OpenIDM Startup Configuration</em>
    </a>, the <code class="literal">launcher.project.location</code> is the directory
    cited if you start OpenIDM with a specific project directory.</p><pre class="brush: plain;">...
"sources" : {
  "default" : {
    "directory" : "&amp;{launcher.install.location}/bin/defaults/script"
  },
  "install" : {
    "directory" : "&amp;{launcher.install.location}"
  },
  "project" : {
    "directory" : "&amp;{launcher.project.location}"
  },
  "project-script" : {
    "directory" : "&amp;{launcher.project.location}/script"
  }
...</pre><p>
    For example, if you start OpenIDM from the <code class="filename">/path/to/openidm</code>
    directory with the following command:
   </p><div class="screen"><pre>$ ./startup.sh -p /path/to/openidm/customconfig
   </pre></div><p>
    The <code class="literal">launcher.project.location</code> directory would be
    <code class="filename">/path/to/openidm/customconfig</code>.
   </p><p>
    The <code class="filename">script.json</code> file also refers to a
    <code class="literal">launcher.install.location</code> directory, which is
    <code class="filename">/path/to/openidm</code>.
   </p><p>Thus, based on the way the <code class="filename">script.json</code> file
    is configured for <code class="literal">project</code>
    and <code class="literal">project-script</code>, you can add custom
    configuration and script files to the
    <code class="filename">/path/to/openidm/customconfig</code> and the
    <code class="filename">/path/to/openidm/customconfig/script</code> directories.
   </p></div></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-data"></a>Chapter&nbsp;6.&nbsp;Accessing Data Objects</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="section"><a href="#data-scripts">6.1. Accessing Data Objects by Using Scripts</a></span></dt><dt><span class="section"><a href="#data-rest">6.2. Accessing Data Objects by Using the REST API</a></span></dt><dt><span class="section"><a href="#queries">6.3. Defining and Calling Queries</a></span></dt></dl></div><a class="indexterm" name="d505e3507"></a><p>
  OpenIDM supports a variety of objects that can be addressed via a URL or URI.
  You can access data objects by using scripts (through the Resource API) or by
  using direct HTTP calls (through the REST API).
 </p><p>
  The following sections describe these two methods of accessing data objects,
  and provide information on constructing and calling data queries.
 </p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="data-scripts"></a>6.1.&nbsp;Accessing Data Objects by Using Scripts</h2></div></div></div><a class="indexterm" name="d505e3519"></a><p>
   OpenIDM's uniform programming model means that all objects are queried and
   manipulated in the same way, using the Resource API. The URL or URI that is
   used to identify the target object for an operation depends on the object
   type. For an explanation of object types, see the
   <span class="olink"><em class="citetitle">Data Models and
   Objects Reference</em></span>. For more information about scripts and
   the objects available to scripts, see the
   <a href="../integrators-guide/index.html#appendix-scripting" class="link"><em class="citetitle">Scripting
   Reference</em></a>.
  </p><p>
   You can use the Resource API to obtain managed objects, configuration
   objects, and repository objects, as follows:
  </p><pre class="brush: javascript;">
val = openidm.read("managed/organization/mysampleorg")
val = openidm.read("config/custom/mylookuptable")
val = openidm.read("repo/custom/mylookuptable")
  </pre><p>
   For information about constructing an object ID, see <a href="../integrators-guide/index.html#rest-uri-scheme" class="link"><em class="citetitle">URI Scheme</em></a>
   in the <em class="citetitle">REST API Reference</em>.
  </p><p>
   You can update entire objects with the <code class="literal">update()</code> function,
   as follows.
  </p><pre class="brush: javascript;">
openidm.update("managed/organization/mysampleorg", mymap)
openidm.update("config/custom/mylookuptable", mymap)
openidm.update("repo/custom/mylookuptable", mymap)
  </pre><p>
   For managed objects, you can partially update an object with the
   <code class="literal">patch()</code> function.
  </p><pre class="brush: javascript;">
openidm.patch("managed/organization/mysampleorg", rev, value)
  </pre><p>
   The <code class="literal">create()</code>, <code class="literal">delete()</code>, and
   <code class="literal">query()</code> functions work the same way.
  </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="data-rest"></a>6.2.&nbsp;Accessing Data Objects by Using the REST API</h2></div></div></div><p>
   OpenIDM provides RESTful access to data objects via a REST API. To access
   objects over REST, you can use a browser-based REST client, such as the
   <a class="link" href="https://chrome.google.com/webstore/detail/simple-rest-client/fhjcajmcbmldlhcimfajhfbgofnpcjmb" target="_top">
   Simple REST Client</a> for Chrome, or <a class="link" href="https://addons.mozilla.org/en-US/firefox/addon/restclient/" target="_top">
   RESTClient</a> for Firefox. Alternatively you can use the <a class="link" href="http://curl.haxx.se/" target="_blank"><span class="command"><strong>curl</strong></span>
   </a> command-line utility.
  </p><p>
   For a comprehensive overview of the REST API, see the <a href="../integrators-guide/index.html#appendix-rest" class="link"><em class="citetitle">REST API
   Reference</em></a> appendix.
  </p><p>
   To obtain a managed object through the REST API, depending on your security
   settings and authentication configuration, perform an HTTP GET on the
   corresponding URL, for example
   <code class="literal">https://localhost:8443/openidm/managed/organization/mysampleorg</code>.
  </p><p>
   By default, the HTTP GET returns a JSON representation of the object.
  </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="queries"></a>6.3.&nbsp;Defining and Calling Queries</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#parameterized-queries">6.3.1. Parameterized Queries</a></span></dt><dt><span class="section"><a href="#native-queries">6.3.2. Native Query Expressions</a></span></dt><dt><span class="section"><a href="#constructing-queries">6.3.3. Constructing Queries</a></span></dt></dl></div><p>
   OpenIDM supports an advanced query model that enables you to define queries,
   and to call them over the REST or Resource API.
  </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="parameterized-queries"></a>6.3.1.&nbsp;Parameterized Queries</h3></div></div></div><p>
    Managed objects in the supported OpenIDM repositories can be accessed using
    a parameterized query mechanism. Parameterized queries on repositories are
    defined in the repository configuration (<code class="filename">repo.*.json</code>)
    and are called by their <code class="literal">_queryId</code>.
   </p><p>
    Parameterized queries provide security and portability for the query call
    signature, regardless of the back-end implementation. Queries that are
    exposed over the REST interface <span class="emphasis"><em>must</em></span> be parameterized
    queries to guard against injection attacks and other misuse. Queries on the
    officially supported repositories have been reviewed and hardened against
    injection attacks.
   </p><p>
    For system objects, support for parameterized queries is restricted to
    <code class="literal">_queryId=query-all-ids</code>. There is currently no support for
    user-defined parameterized queries on system objects. Typically,
    parameterized queries on system objects are not called directly over the
    REST interface, but are issued from internal calls, such as correlation
    queries.
   </p><p>
    A typical query definition is as follows:
   </p><pre class="brush: plain;">
"query-all-ids" : "select _openidm_id from ${unquoted:_resource}"
   </pre><p>
    To call this query, you would reference its ID, as follows:
   </p><pre class="brush: plain;">
?_queryId=query-all-ids
   </pre><p>
    The following example calls <code class="literal">query-all-ids</code> over the REST
    interface:
   </p><div class="screen"><pre>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 "https://localhost:8443/openidm/managed/user?_queryId=query-all-ids"</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="native-queries"></a>6.3.2.&nbsp;Native Query Expressions</h3></div></div></div><p>
    Native query expressions are supported for all managed objects and system
    objects, and can be called directly over the REST interface, rather than
    being defined in the repository configuration.
   </p><p>
    Native queries are intended specifically for internal callers, such as
    custom scripts, in situations where the parameterized query facility is
    insufficient. For example, native queries are useful if the query needs to
    be generated dynamically.
   </p><p>
    The query expression is specific to the target resource. For repositories,
    queries use the native language of the underlying data store. For system
    objects that are backed by OpenICF connectors, queries use the applicable
    query language of the system resource.
   </p><p>
    Native queries on the repository are made using the
    <code class="literal">_queryExpression</code> keyword. For example:
   </p><div class="screen"><pre>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 "https://localhost:8443/openidm/managed/user?_queryExpression=select+from+managed_user"
   </pre></div><p>
    Unless you have specifically enabled native queries, the previous command
    returns a 403 access denied error message. Native queries should not be
    enabled in production environments, as they are not portable and do not
    guard against injection attacks.
   </p><p>
    Such query expressions should therefore not be used or made accessible over
    the REST interface or over HTTP, other than for development, and should be
    used only via the internal Resource API. If you want to enable such
    native queries for development, see the section on
    <a href="../integrators-guide/index.html#security-urls" class="link"><em class="citetitle">Protecting
    Sensitive REST Interface URLs</em></a>.
   </p><p>
    Alternatively, if you really need to expose native queries over HTTP, in a
    selective manner, you can design a custom endpoint to wrap such access.
   </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="constructing-queries"></a>6.3.3.&nbsp;Constructing Queries</h3></div></div></div><p>
    The <code class="literal">openidm.query</code> function enables you to query OpenIDM
    resource objects for reconciliation processes and workflows. The query
    syntax is <code class="literal">openidm.query(id, params)</code>, where
    <code class="literal">id</code> specifies the object on which the query should be
    performed and <code class="literal">params</code> provides the parameters that are
    passed to the query, either <code class="literal">_queryFilter</code> or
    <code class="literal">_queryID</code>. For example:
   </p><pre class="brush: javascript;">
var params = {
    '_queryFilter' : 'givenName co "' + sourceCriteria + '" or ' + 'sn co "'
                     + sourceCriteria + '"'
};
var results = openidm.query("system/ScriptedSQL/account", params)
   </pre><p>
    The query filter is specified in common filter notation, with the following
    operations.
   </p><h4><a name="d505e3695"></a>Attribute Operations</h4><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">Equals</code> Filter</span></dt><dd><p>
        Determines whether the resource contains an attribute that matches a
        specific attribute value.
       </p><p>
        Returns <code class="literal">true</code> if the object satisfies all selection
        criteria of the filter, otherwise returns <code class="literal">false</code>.
       </p><p>
        For example:
       </p><pre class="brush: javascript;">
"_queryFilter" : "employeeType eq \"Permanent\""
       </pre></dd></dl></div><h4><a name="d505e3718"></a>Comparable Attribute Operations</h4><p>
     Compares single-value attributes to a given filter.
    </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">GreaterThan</code> Filter</span></dt><dd><p>
        Determines whether the attribute value of the resource object is greater
        than the one provided in the filter.
       </p><p>
        Returns <code class="literal">true</code> if the attribute value is greater,
        otherwise returns <code class="literal">false</code>.
       </p><p>
        For example:
       </p><pre class="brush: javascript;">
"_queryFilter" : "employeeNumber gt \"50000\""
       </pre></dd><dt><span class="term"><code class="literal">GreaterThanOrEqual</code> Filter</span></dt><dd><p>
        Determines whether the attribute value of the resource object is greater
        than or equal to the one provided in the filter.
       </p><p>
        Returns <code class="literal">true</code> if the attribute value is greater than
        or equal, otherwise returns <code class="literal">false</code>.
       </p><p>
        For example:
       </p><pre class="brush: javascript;">
"_queryFilter" : "employeeNumber ge \"50000\""
       </pre></dd><dt><span class="term"><code class="literal">LessThan</code> Filter</span></dt><dd><p>
        Determines whether the attribute value of the resource object is less
        than the one provided in the filter.
       </p><p>
        Returns <code class="literal">true</code> if the attribute value is less,
        otherwise returns <code class="literal">false</code>.
       </p><p>
        For example:
       </p><pre class="brush: javascript;">
"_queryFilter" : "employeeNumber lt \"50000\""
       </pre></dd><dt><span class="term"><code class="literal">LessThanOrEqual</code> Filter</span></dt><dd><p>
        Determines whether the attribute value of the resource object is less
        than or equal to the one provided in the filter.
       </p><p>
        Returns <code class="literal">true</code> if the attribute value is less than or
        equal, otherwise returns <code class="literal">false</code>.
       </p><p>
        For example:
       </p><pre class="brush: javascript;">
"_queryFilter" : "employeeNumber le \"50000\""
       </pre></dd></dl></div><h4><a name="d505e3803"></a>String Attribute Operations</h4><p>
     Compares string values to a given filter.
    </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">StartsWith</code> Filter</span></dt><dd><p>Returns attributes whose value starts with the string specified in
        the filter.
       </p><p>
        For example:
       </p><pre class="brush: javascript;">
"_queryFilter" : "lastName sw \"smi\""
       </pre></dd><dt><span class="term"><code class="literal">Contains</code> Filter</span></dt><dd><p>
        Returns attributes whose value contains the string specified in the
        filter.
       </p><p>
        For example:
       </p><pre class="brush: javascript;">
"_queryFilter" : "lastName co \"smi\""
       </pre></dd><dt><span class="term"><code class="literal">EndsWith</code> Filter</span></dt><dd><p>
        Returns attributes whose value ends with the string specified in the
        filter.
       </p><p>
        For example:
       </p><pre class="brush: javascript;">
"_queryFilter" : "lastName ew \"ith\""
       </pre></dd></dl></div><h4><a name="d505e3844"></a>Filter Operations</h4><p>
     Filter operations are used to construct more complex filters by comparing
     two filters from the preceding section or negating filters defined in the
     previous section.
    </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">AND Filter</code></span></dt><dd><p>
        A filter that matches entries using the AND boolean operator on two
        filters.
       </p><p>
        For example:
       </p><pre class="brush: javascript;">
"_queryFilter": "(lastName eq \"Smith\") and (givenName eq \"John\")"
       </pre></dd><dt><span class="term"><code class="literal">OR Filter</code></span></dt><dd><p>
        A filter that matches entries using the OR boolean operator on two
        filters.
       </p><p>
        For example:
       </p><pre class="brush: javascript;">
"_queryFilter": "(lastName eq \"Smith\") or (lastName eq \"Smythe\")"
       </pre></dd><dt><span class="term"><code class="literal">NOT Filter</code></span></dt><dd><p>
        A filter that filters out matched entries by using a query. Syntax is
        <code class="literal">"! (expression)"</code>.
       </p><p>
        For example:
       </p><pre class="brush: javascript;">
"_queryFilter": "! (employeeType eq \"Contractor\")"
       </pre></dd></dl></div></div></div></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-users-groups-roles"></a>Chapter&nbsp;7.&nbsp;Managing Users, Groups, and Roles</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="section"><a href="#working-with-managed-users">7.1. Working with Managed Users</a></span></dt><dt><span class="section"><a href="#working-with-groups">7.2. Working With Managed Groups</a></span></dt><dt><span class="section"><a href="#configuring-custom-roles">7.3. Configuring Custom Roles</a></span></dt></dl></div><p>
  OpenIDM does not control the structure of objects that are stored in its
  repository. You can define any kind of managed object, but a definition for
  users, groups and roles is provided by default.
 </p><p>
  This chapter describes how to work with these default managed objects. More
  information about the OpenIDM object model is provided in the <a href="../integrators-guide/index.html#appendix-objects" class="link"><em class="citetitle">Data Models and
  Objects Reference</em></a>.
 </p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="working-with-managed-users"></a>7.1.&nbsp;Working with Managed Users</h2></div></div></div><p>
   External users that are stored in OpenIDM's repository are referred to as
   <em class="firstterm">managed users</em>. For a JDBC repository, OpenIDM stores
   managed users in the <code class="literal">managedobjects</code> table. A second table,
   <code class="literal">managedobjectproperties</code>, serves as the index table. For an
   OrientDB repository, managed users are stored in the
   <code class="literal">managed_user</code> table.
  </p><p>
   OpenIDM provides RESTful access to managed users, at the context path
   <code class="literal">/openidm/managed/user</code>. For more information, see
   <a href="../install-guide/index.html#first-steps-with-rest" class="link"><em class="citetitle">To Get Started
   With the OpenIDM REST Interface</em></a> in the
   <em class="citetitle">Installation Guide</em>.
  </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="working-with-groups"></a>7.2.&nbsp;Working With Managed Groups</h2></div></div></div><p>
   OpenIDM provides support for a managed <code class="literal">"group"</code> object. For
   a JDBC repository, OpenIDM stores managed groups with all other managed
   objects, in the <code class="literal">managedobjects</code> table, and uses the
   <code class="literal">managedobjectproperties</code> for indexing. For an OrientDB
   repository, managed groups are stored in the <code class="literal">managed_group</code>
   table.
  </p><p>
   The managed group object is not provided by default. To use managed groups,
   add an object similar to the following to your
   <code class="filename">conf/managed.json</code> file:
  </p><pre class="brush: plain;">{
    "name" : "group"
},
  </pre><p>
   With this addition, OpenIDM provides RESTful access to managed groups, at the
   context path <code class="literal">/openidm/managed/group</code>.
  </p><p>
   For an example of a deployment that uses managed groups, see <a href="../install-guide/index.html#more-sample2d" class="link"><em class="citetitle">Sample 2d -
   Synchronizing LDAP Groups</em></a> in the <em class="citetitle">Installation
   Guide</em>.
  </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="configuring-custom-roles"></a>7.3.&nbsp;Configuring Custom Roles</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#roles-creating-assigning-deleting">7.3.1. Creating, Assigning, and Deleting Roles</a></span></dt><dt><span class="section"><a href="#effective-roles-and-assignments">7.3.2. Understanding Effective Roles and Effective Assignments</a></span></dt><dt><span class="section"><a href="#role-mapping">7.3.3. Setting up the Role Mapping</a></span></dt></dl></div><p>
   The default managed object model includes a managed <code class="literal">role</code>
   object that can be manipulated in the same way as any other managed object.
  </p><p>
   This section refers to two distinct types of roles - direct (static) and
   indirect (dynamic) roles. Direct roles refer to roles that are specifically
   added to the user's <code class="literal">"roles"</code> attribute by an administrator
   operation. Indirect roles might be added to the user entry as a result of a
   script or rule that assigns the role. For example, a user might acquire a
   <code class="literal">"sales-role"</code> as a result of being in the
   <code class="literal">"sales"</code> organization.
  </p><p>
   A managed user's <code class="literal">"roles"</code> attribute takes an array as a
   value. Currently, only flat strings are supported in this array.
  </p><p>
   The <code class="literal">"roles"</code> attribute includes any specifically assigned
   roles, and any roles assigned internally by OpenIDM. So, the
   <code class="literal">"roles"</code> attribute of a particular user entry might
   appear as follows:
  </p><pre class="brush: java;">
"roles" : [
    "name" : "managed/role/sample-role",
    "name" : "openidm-authorized"
]
  </pre><p>
   A role value that includes a <code class="literal">/</code> character is considered to
   be a URL that points to the role details on the router, for example,
   <code class="literal">managed/role/sample-role</code>.
  </p><p>
   The following sections describe basic role manipulation - how roles are
   defined, assigned to users, and deleted. The entitlements or assignments
   supplied by roles are described in the subsequent section.
  </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="roles-creating-assigning-deleting"></a>7.3.1.&nbsp;Creating, Assigning, and Deleting Roles</h3></div></div></div><p>
    Role definitions are stored in the repository and are accessible at the
    <code class="literal">/openidm/managed/role</code> context path. This section
    describes how to manipulate roles over the REST interface.
   </p><p>
    The examples in this section assume that OpenIDM has been started with the
    configuration of Sample 2b, and refers to the managed user objects created
    in that sample. For more information, see <a href="../install-guide/index.html#more-sample2b" class="link"><em class="citetitle">Sample 2b - LDAP Two Way</em></a> in the
    <em class="citetitle">Installation Guide</em>.
   </p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="create-role-definition"></a>7.3.1.1.&nbsp;To Create a Role Definition</h4></div></div></div><p>
     The following REST call creates a relatively complex role:
    </p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --header "If-None-Match: *" \
 --request PUT \
 --data '{
 "properties":{"description":"an example role"},
 "assignments":{"ldap":{"attributes":[
 {"name":"cns",
 "assignmentOperation":"mergeWithTarget",
 "unassignmentOperation":"removeFromTarget",
 "value":["CN=employees,O=corp"]}],
 "onAssignment": {"file":"roles/onAssignment_ldap.js","type":"text/javascript"},
 "onUnassignment":{"file":"roles/onUnassignment_ldap.js",
 "type":"text/javascript"}}}}' \
 "https://localhost:8443/openidm/managed/role/newrole"</strong>
 <em>
 {
   "assignments": {
     "ldap": {
       "attributes": [
         {
           "name": "cns",
           "unassignmentOperation": "removeFromTarget",
           "assignmentOperation": "mergeWithTarget",
           "value": [
             "CN=employees,O=corp"
           ]
         }
       ],
       "onAssignment": {
         "file": "roles/onAssignment_ldap.js",
         "type": "text/javascript"
       },
       "onUnassignment": {
         "file": "roles/onUnassignment_ldap.js",
         "type": "text/javascript"
       }
     }
   },
   "_id": "newrole",
   "properties": {
     "description": "an example role"
   },
   "_rev": "1"
 }</em>
    </pre></div><p>
     For the definitions of each of these attributes, see
     <a class="xref" href="#sample-role-definition" title="7.3.2.1.&nbsp;A Sample Role Definition for Two Remote Systems">Section&nbsp;7.3.2.1, &#8220;A Sample Role Definition for Two Remote Systems&#8221;</a>
    </p><p>
      Most of the examples in this guide use client-assigned IDs when creating
      resources, as it makes the examples easier to read. In general,
      server-assigned UUIDs are better in production, as they can be generated
      easily in clustered environments.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="listing-defined-roles"></a>7.3.1.2.&nbsp;To List the Defined Roles</h4></div></div></div><p>
     To obtain a list of all defined managed roles, query the
     <code class="literal">/openidm/managed/role</code> context path, as follows.
    </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/managed/role/?_queryId=query-all-ids"</strong>
     <em>
{
  "remainingPagedResults": -1,
  "pagedResultsCookie": null,
  "resultCount": 1,
  "result": [
    {
      "_rev": "0",
      "_id": "newrole"
    }
  ]
}     </em>
    </pre></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="assign-role-to-user"></a>7.3.1.3.&nbsp;To Assign a Role to a User</h4></div></div></div><p>
     To assign a direct role to a user, you can update the user's entry over
     REST, adding <code class="literal">managed/role/<em class="replaceable"><code>role ID</code></em></code>
     to the user's <code class="literal">"roles"</code> attribute. The following example
     adds the <code class="literal">ldap</code> role, created previously, to user
     <code class="literal">bjensen</code>.
    </p><div class="screen"><pre><strong>
$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --header "If-Match: *" \
 --request PATCH \
 --data '[
    {
        "operation": "add",
        "field": "/roles/-",
        "value": "managed/role/newrole"

    }
]' \
 "https://localhost:8443/openidm/managed/user/bjensen"
    </strong>
    <em>
{
    "mail": "bjensen@example.com",
    "sn": "Jensen",
    "passwordAttempts": "0",
    "address2": "",
    "lastPasswordAttempt": "Thu Apr 10 2014 12:49:32 GMT+0200 (SAST)",
    "givenName": "Barbara",
    "city": "",
    "country": "",
    "_rev": "2",
    "lastPasswordSet": "",
    "postalCode": "",
    "_id": "bjensen",
    "description": "Created for OpenIDM",
    "accountStatus": "active",
    "telephoneNumber": "1-503-334-2546",
    "roles": [ "openidm-authorized", "managed/role/newrole" ],
    "effectiveAssignments" : {
      "ldap" : {
        "onUnassignment" : {
          "type" : "text/javascript",
          "file" : "roles/onUnassignment_ldap.js"
        },
        "onAssignment" : {
          "type" : "text/javascript",
          "file" : "roles/onAssignment_ldap.js"
        },
        "attributes" : [ {
          "value" : [ "CN=employees,O=corp" ],
          "assignedThrough" : "managed/role/newrole",
          "assignmentOperation" : "mergeWithTarget",
          "unassignmentOperation" : "removeFromTarget",
          "name" : "cns"
        } ]
      }
    },
    "postalAddress": "",
    "userName": "bjensen",
    "stateProvince": "",
    "displayName": "Babara Jensen"
}</em>
    </pre></div><p>
     Note the dash (<code class="literal">-</code>) character appended to the field name,
     within the <span class="command"><strong>-data</strong></span> option. This character specifies that
     the command appends the role that you add to the existing roles for that
     user. If you do not include the dash character, the request overwrites all
     current values of the <code class="literal">"roles"</code> attribute.
    </p><p>
     If you see a message such as "Object bjensen not found in managed/user",
     you may need to substitute the <code class="literal">_id</code>, as output from the
     <code class="literal">query-all-ids</code> query described in the
     <a class="link" href="install-guide#run-sample2b" target="_blank"><em class="citetitle">Running the Sample
     </em></a> section associated with Sample 2b. Take care when
     configuring that sample, as it assumes that you have set up a running
     instance of OpenDJ with specific data.
    </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="remove-role-assignment"></a>7.3.1.4.&nbsp;To Remove a Role Assignment</h4></div></div></div><p>
     To remove a role assignment from a user, simply replace that user's
     <code class="literal">"roles"</code> attribute with the array of roles that the user
     should have. The following example removes the <code class="literal">newrole</code>
     role from user <code class="literal">bjensen</code>.
    </p><div class="screen"><pre>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --header "If-Match: *" \
 --request PATCH \
 --data '[
    {
        "operation": "replace",
        "field": "/roles",
        "value": [
            "openidm-authorized"
        ]
    }
]' \
 "https://localhost:8443/openidm/managed/user/bjensen"</pre></div><p>
     In the role definition, you can specify what should happen when an
     assignment of that role is removed.
    </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="query-role-membership"></a>7.3.1.5.&nbsp;To Query Role Membership</h4></div></div></div><p>
     To return a list of all users who have a specific directly assigned role,
     specify the role ID in the query on the <code class="literal">managed/user</code>
     context path. It is not currently possible to query role membership for
     indirect roles.
    </p><p>
     The following query returns all members of the <code class="literal">"newrole"</code>
     role created previously. Currently that role has only one member,
     <code class="literal">bjensen</code>.
    </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/managed/user?_queryId=get-users-of-direct-role&amp;role=managed/role/newrole"
     </strong>
     <em>{
  "remainingPagedResults": -1,
  "pagedResultsCookie": null,
  "resultCount": 1,
  "result": [
    {
      "_rev": "0",
      "_id": "bjensen"
    }
  ]
}</em>
    </pre></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="delete-role-definition"></a>7.3.1.6.&nbsp;To Delete a Managed Role Definition</h4></div></div></div><p>
     When a role definition is removed, an "unassignment" operation is triggered
     for any attributes that have been assigned to a user indirectly through
     that role.
    </p><p>
     The following sample command deletes the <code class="literal">newrole</code> role,
     created previously.
    </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request DELETE \
 "https://localhost:8443/openidm/managed/role/newrole"</strong>
     <em>
 {
   "_id" : "newrole",
   "_rev" : "2",
   "assignments" : {
     "ldap" : {
       "onUnassignment" : {
         "type" : "text/javascript",
         "file" : "roles/onUnassignment_ldap.js"
       },
       "onAssignment" : {
         "type" : "text/javascript",
         "file" : "roles/onAssignment_ldap.js"
       },
       "attributes" : [ {
         "value" : [ "CN=employees,O=corp" ],
         "assignmentOperation" : "mergeWithTarget",
         "unassignmentOperation" : "removeFromTarget",
         "name" : "cns"
       } ]
     }
   },
   "properties" : {
     "description" : "an example role"
   }
 }
</em>
    </pre></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="effective-roles-and-assignments"></a>7.3.2.&nbsp;Understanding Effective Roles and Effective Assignments</h3></div></div></div><p>
    The primary purpose of roles is the management of user access to system
    resources. User access is controlled by the
    <em class="firstterm">assignments</em> or entitlements provided by the role.
   </p><p>
    The previous section described how to create a basic role definition and to
    assign that role to a user. However, the main functionality of roles is
    provided in the assignments that are specified for that role.
   </p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="sample-role-definition"></a>7.3.2.1.&nbsp;A Sample Role Definition for Two Remote Systems</h4></div></div></div><p>
     The following sample role definition shows how assignments are configured
     for two remote systems - an LDAP server (<code class="literal">ldap</code>), and an
     Active Directory Server (<code class="literal">ad</code>).
    </p><p>
     Do remember to include the <code class="literal">assignments</code> field name.
     OpenIDM uses it to keep assigned roles up to date.
    </p><pre class="brush: java;">{
     "name": "samplerole",
     "_id": "samplerole",
     "assignments": {
         "ad": {
             "attributes": [
                 {
                     "name": "cns",
                     "value": [
                         "CN=fileshare,O=corp",
                         "CN=desktop,O=corp",
                         "CN=terminal,O=corp",
                         "CN=intranet,O=corp"
                     ],
                     "assignmentOperation": "mergeWithTarget"
                 }
             ]
         },
         "ldap": {
             "attributes": [
                 {
                     "name": "cns",
                     "value": [
                         "CN=employees,O=corp"
                     ],
                     "operation": "mergeWithTarget"
                 },
                 {
                     "name": "employeeType",
                     "value": "employee"
                 }
             ]
         }
     }
}</pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
       <code class="literal">"name"</code> is the name of the role, and should be unique.
       Avoid using special characters in the role name.
      </p></li><li class="listitem"><p>
       <code class="literal">"_id"</code> is the object identifier of the role, by which it
       is accessed over REST. These examples use a client-assigned ID, for ease
       of reference, however, in production it is recommended that you use a
       server-assigned UUID.
      </p></li><li class="listitem"><p>
       <code class="literal">"assignments"</code> provide the list of assignments
       (or entitlements) that this role will create on the specified system.
      </p><p>
       Each assignment includes the name of the external system, such as
       <code class="literal">ad</code> and <code class="literal">ldap</code>, the
       attribute or attributes whose values will be generated, on the external
       system, and the value or values that will be applied to each attribute.
      </p></li><li class="listitem"><p>
       When you update a role by adding, updating, or removing an attribute,
       that action triggers either an <code class="literal">"assignmentOperation"</code>
       or an <code class="literal">"unassignmentOperation"</code>.
      </p><p>
       If you assign or unassign a role to a user, that action will also trigger
       either an <code class="literal">"assignmentOperation"</code> or an
       <code class="literal">"unassignmentOperation"</code>.
      </p><p>
       The <code class="literal">"assignmentOperation"</code> specifies the way in which
       the value is applied. You can set this option to
       <code class="literal">"mergeWithTarget"</code> or to the default,
       <code class="literal">"replaceTarget"</code>.
      </p><p>
       In contrast, the <code class="literal">"unassignmentOperation"</code> specifies the
       way in which the value is removed. You can set this option to
       <code class="literal">"removeFromTarget"</code>.
      </p><p>
       The <code class="literal">"mergeWithTarget"</code> operation first merges the source
       value with the existing target value, then adds the value or values from
       the role assignment. In the event that duplicate values are found (for
       attributes that take a list as a value), each value is included only once
       in the resulting target value.
      </p><p>
       The <code class="literal">"replaceTarget"</code> operation replaces the entire
       target attribute value with whatever is specified in the role definition.
       When this operation is specified, the value from the role assignments
       becomes the only authoritative source for the attribute.
      </p><p>
       The <code class="literal">"mergeWithTarget"</code>, <code class="literal">"replaceTarget"</code>
       and <code class="literal">"removeFromTarget"</code> operations are aliases, as
       defined in the <code class="filename">defaultMapping.js</code> file.
      </p></li><li class="listitem"><p>
       The <code class="literal">"onAssignment"</code> and
       <code class="literal">"onUnassignment"</code> scripts are assignment-specific.
       Either option supports further customization.
      </p><p>
       When you create, assign, or delete a role from a specific user entry,
       OpenIDM triggers either an <code class="literal">"onAssignment"</code> or an
       <code class="literal">"onUnassignment"</code> script.
      </p><p>
       Every sync operation triggers an <code class="literal">"onAssignment"</code> script.
       In contrast, an <code class="literal">"onUnassignment"</code> script is triggered
       only when an assignment is removed from a role, or when a role is
       unassigned from a user.
      </p><p>
       If you customize an <code class="literal">"onAssignment"</code> or an
       <code class="literal">"onUnassignment"</code> script, make sure the script returns
       a <code class="literal">"targetObject"</code>. Otherwise, the script operation may
       fail.
      </p></li></ul></div><p>
     Once a role has been defined, and assigned to a user, check that the
     expected effective roles and effective assignments have been generated for
     that user.
     </p><p>
      Then add a default mapping to your synchronization configuration to apply
      the effective assignments to the target resource.
     </p><p>
      OpenIDM logs any changes to a managed role definition in the audit log.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="managed-role-script-hooks"></a>7.3.2.2.&nbsp;Managed Role Object Script Hooks</h4></div></div></div><p>
      In addition to the functionality provided by the assignments, a managed
      role object has script hooks that allow you to determine what should happen
      when a role is created, updated or deleted. The managed role object has the
      following structure in the managed objects configuration file
      (<code class="filename">managed.json</code>):
     </p><pre class="brush: javascript;">{
     "name" : "role",
     "postCreate" : {
         "type" : "text/javascript",
         "file" : "roles/update-users-of-role.js"
     },
     "postUpdate" : {
         "type" : "text/javascript",
         "file" : "roles/update-users-of-role.js"
     },
     "postDelete" : {
         "type" : "text/javascript",
         "file" : "roles/update-users-of-role.js"
     }
}</pre><p>
     The <code class="literal">"postCreate"</code>, <code class="literal">"postUpdate"</code>, and
     <code class="literal">"postDelete"</code> properties enable you to specify what should
     happen when a role definition is created, updated, or deleted. By default,
     the <code class="filename">update-users-of-role.js</code> script runs in each of
     these cases.
    </p><p>
     The <code class="filename">update-users-of-role.js</code> script includes a
     <code class="literal">triggerSyncCheck</code> attribute, which reviews the
     <code class="literal">effectiveRoles</code> and <code class="literal">effectiveAssignments</code>
     virtual attributes, so see whether OpenIDM should run a sync operation on
     them.
    </p><p>
     This script iterates over all managed users, locates the users who have been
     assigned this role, and regenerates their effective assignments on the
     target resource. So, for example, if the role <code class="literal">"ldap"</code>
     gives a user an assignment on the resource "Active Directory", when, that
     role definition is deleted, a reconciliation operation runs to remove the
     assignment for that user on the "Active Directory" resource.
    </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="roles-virtual-attributes"></a>7.3.2.3.&nbsp;Virtual Role Attributes</h4></div></div></div><p>
     Based on the set of role definitions that are assigned to a specific user,
     the roles mechanism generates two virtual attributes on the user entry -
     <code class="literal">effectiveRoles</code> and
     <code class="literal">effectiveAssignments</code>.
    </p><p>
     The logic that calculates the <code class="literal">effectiveRoles</code> and
     <code class="literal">effectiveAssignments</code> attribute values is located in two
     scripts:
     <code class="filename">/path/to/openidm/bin/defaults/script/roles/effectiveRoles.js</code>
     and
     <code class="filename">/path/to/openidm/bin/defaults/script/roles/effectiveAssignments.js</code>.
     You should not alter these scripts. If you need to modify how roles and
     assignments are handled, create your own custom script and reference it in
     the <code class="filename">conf/managed.json</code> file. For information about using
     custom scripts, see the
     <a href="../integrators-guide/index.html#appendix-scripting" class="link"><em class="citetitle">Scripting
     Reference</em></a>.
    </p><p>
     The <code class="literal">effectiveRoles</code> attribute lists the specific role
     definitions that are applied to a user entry. By default, the effective
     roles script supports direct role assignments only. Dynamic role assignment
     is not provided out of the box, but can be added with a custom script that
     overrides the default <code class="filename">effectiveRoles.js</code> script. For
     more information, see <a class="xref" href="#dynamic-role-assignments" title="Procedure&nbsp;7.2.&nbsp;To Add Support for Dynamic Assignments">Procedure&nbsp;7.2, &#8220;To Add Support for Dynamic Assignments&#8221;</a>.
    </p><p>
     Based on the effective roles, the <code class="literal">effectiveAssignments</code>
     attribute provides the calculated resource assignments, that is the
     amalgamated set of entitlements for a specific user.
    </p><p>The value of the <code class="literal">effectiveAssignments</code> attribute
     provides the information required for the provisioner to apply the effective
     assignments, and provides a reference to the source of the assignment. In
     reading this attribute, it is therefore possible to find and change the root
     source of an assignment.
    </p><p>
     Effective assignments can merge attribute operations on the same system from
     multiple roles. For example, role A might add group A to a user's group
     membership list, and role B might add group B to the same group membership
     property on the same assigned system.
    </p><p>
     The effective roles and effective assignments attributes are configured in
    <code class="filename">conf/managed.json</code> as follows:
    </p><pre class="brush: java;">
 {
     "name" : "effectiveRoles",
     "type" : "virtual",
     "onRetrieve" : {
         "type" : "text/javascript",
         "file" : "roles/effectiveRoles.js",
         "rolesPropName" : "roles"
     }
 },
 {
     "name" : "effectiveAssignments",
     "type" : "virtual",
     "onRetrieve" : {
         "type" : "text/javascript",
         "file" : "roles/effectiveAssignments.js",
         "effectiveRolesPropName" : "effectiveRoles"
     }
 }
   </pre><p>
     By default, the <code class="filename">effectiveRoles.js</code> script uses the
     <code class="literal">"roles"</code> attribute of a user entry to determine the
     direct roles assigned to the user. The
     <code class="filename">effectiveAssignments.js</code> script uses the virtual
     <code class="literal">"effectiveRoles"</code> attribute of the user entry to calculate
     the user's effective assignments. If your deployment uses different
     attributes to store this information, change the
     <code class="literal">"rolesPropName"</code> and the
     <code class="literal">"effectiveRolesPropName"</code> properties of the virtual
     attribute definitions accordingly.
    </p><p>
     When a user entry is assigned a role, the <code class="literal">effectiveRoles</code>
     and <code class="literal">effectiveAssignments</code> of that entry are calculated
     according to the role definition. A managed user entry, whose roles have
     been generated based on the role definition illustrated previously, might
     appear as follows:
    </p><pre class="brush: javascript;">
 {
    "_id":"i",
    "_rev":"1",
    "roles":[
       "openidm-authorized",
       "managed/role/sample-role"
    ],
    "effectiveRoles":[
       "openidm-authorized",
       "managed/role/sample-role"
    ],
    "effectiveAssignments":{
       "ldap":{
          "attributes":[
             {
                "value":[
                   "CN=employees,O=corp"
                ],
                "operation":"replaceTarget",
                "name":"cns",
                "assignedThrough":"managed/role/sample-role"
             },
             {
                "value":"employee",
                "name":"employeeType",
                "assignedThrough":"managed/role/sample-role"
             }
          ]
       },
       "ad":{
          "attributes":[
             {
                "value":[
                   "CN=fileshare,O=corp",
                   "CN=desktop,O=corp",
                   "CN=terminal,O=corp",
                   "CN=intranet,O=corp"
                ],
                "operation":"replaceTarget",
                "name":"cns",
                "assignedThrough":"managed/role/sample-role"
             }
          ]
       }
    }
 }</pre><p>
    Note that the value of the <code class="literal">"assignedThrough"</code> property
    of the virtual <code class="literal">"effectiveAssignments"</code> attribute indicates
    how each assignment has been generated.
   </p><div class="procedure"><a name="test-effective-roles"></a><div class="procedure-title">Procedure&nbsp;7.1.&nbsp;To Test Effective Roles and Assignments</div><p>
     The following sample procedure creates a new role (<code class="literal">"ad"</code>)
     that includes assignments, adds that role to the user entry
     <code class="literal">bjensen</code> and then shows how bjensen's effective
     assignments have been generated.
    </p><ol class="procedure" type="1"><li class="step"><p>
      Create the role definition over REST.
     </p><p>
      This example uses a PUT request to create the role definition, so that we
      can specify role <code class="literal">_id</code>. The <code class="literal">_id</code> will
      be used to assign the role directly to user entries.
     </p><p>
      The example adds a role definition with the _id <code class="literal">ldap</code>.
     </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --header "If-None-Match: *" \
 --request PUT \
 --data '{
  "assignments": {
    "ldap": {
      "attributes": [
        {
          "name": "cns",
          "value": [
            "cn=printers,ou=Groups,dc=example,dc=com",
            "cn=intranet,ou=Groups,dc=example,dc=com"
          ],
          "operation": "replaceTarget"
        }
      ]
    }
  }
}' \
 "https://localhost:8443/openidm/managed/role/ldap"</strong>
     <em>{
  "assignments": {
    "ldap": {
      "attributes": [
        {
          "name": "cns",
          "operation": "replaceTarget",
          "value": [
            "cn=printers,ou=Groups,dc=example,dc=com",
            "cn=intranet,ou=Groups,dc=example,dc=com"
          ]
        }
      ]
    }
  },
  "_id": "ldap",
  "_rev": "0"
}</em>
     </pre></div></li><li class="step"><p>
     Add a mapping for the role to assign to your <code class="filename">sync.json</code>
     file. For this example, the following assignment add the following lines to
     <code class="literal">sync.json</code>:
    </p><pre class="brush: javascript;">
    "mappings":[
        "assignmentsToMap":[
            "ldap"
        ],
    ]</pre><p>
      OpenIDM addresses any change in role assignments with the
      <code class="literal">onAssignment</code> and <code class="literal">onUnassignment</code>
      attributes in the <code class="filename">defaultMapping.js</code> file.
     </p></li><li class="step"><p>
      Assign the role to user <code class="literal">bjensen</code>.
     </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --header "If-Match: *" \
 --request PATCH \
 --data '[
    {
        "operation": "replace",
        "field": "/roles",
        "value": [
            "openidm-authorized",
            "managed/role/ldap"
        ]
    }
]' \
 "https://localhost:8443/openidm/managed/user/bjensen"</strong>
     <em>{
    "mail": "bjensen@example.com",
    "sn": "Jensen",
    "passwordAttempts": "0",
    "address2": "",
    "lastPasswordAttempt": "Thu Apr 10 2014 12:49:32 GMT+0200 (SAST)",
    "givenName": "Barbara",
    "city": "",
    "country": "",
    "_rev": "2",
    "lastPasswordSet": "",
    "postalCode": "",
    "_id": "bjensen",
    "accountStatus": "active",
    "description": "Created for OpenIDM",
    "roles": [
        "openidm-authorized",
        "managed/role/ldap"
    ],
    "telephoneNumber": "1-503-334-2546",
    "postalAddress": "",
    "userName": "bjensen",
    "stateProvince": "",
    "displayName": "Babara Jensen"
}</em>
     </pre></div></li><li class="step"><p>
      Query <code class="literal">bjensen's</code> user entry again.
     </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/managed/user/bjensen"</strong>
      <em>...
{
  "effectiveAssignments": {
    "ldap": {
      "attributes": [
        {
          "assignedThrough": "managed/role/ldap",
          "name": "cns",
          "operation": "replaceTarget",
          "value": [
            "cn=printers,ou=Groups,dc=example,dc=com",
            "cn=intranet,ou=Groups,dc=example,dc=com"
          ]
        }
      ]
    }
  },
  ...</em>
     </pre></div><p>
      Note that bjensen's effective assignments have been updated to include the
      assignments provided by the <code class="literal">ldap</code> role.
     </p></li></ol></div><div class="procedure"><a name="dynamic-role-assignments"></a><div class="procedure-title">Procedure&nbsp;7.2.&nbsp;To Add Support for Dynamic Assignments</div><p>
      Although support for dynamic role assignments is not provided by default,
      it can easily be added with a custom script, as follows.
     </p><ol class="procedure" type="1"><li class="step"><p>
       Copy the default effective roles script to your project's
       <code class="literal">script/roles</code> directory.
      </p><div class="screen"><pre>
$ cp /path/to/openidm/bin/defaults/script/roles/effectiveRoles.js \
      <em><strong>project-dir</strong></em>/script/roles/
     </pre></div><p>
       The new script will override the default effective roles script.
      </p></li><li class="step"><p>
       Modify the effective roles script to include the dynamic role assignment
       logic.
      </p><p>
       For example, to enable dynamic role assignment for the
       <code class="literal">example</code> organization, you might add the following
       extract after the section:
      </p><pre class="brush: java;">
 // This is the location to expand to dynamic roles,
 // project role script return values can then be added via
 // effectiveRoles = effectiveRoles.concat(dynamicRolesArray);
     </pre><pre class="brush: java;">
 if (object.org === 'example') {
     effectiveRoles = effectiveRoles.concat(['dynamic-role1', 'dynamic-role2']);
 }
     </pre></li><li class="step"><p>
       To apply changes to the dynamic assignment rules to existing users, run a
       reconciliation operation on those users.
      </p></li></ol></div><p>
     Note that changes to dynamic role assignments for existing users require a
     manual reconciliation of the affected group of users for those changes to
     take effect. So, if a new dynamic role definition is created, if an existing
     dynamic role definition is changed, or if changes are made to the dynamic
     assignment rule, the group of users affected by that assignment rule must be
     reconciled manually. and changes to the assigned roles.
    </p><p>
     When a user entry is changed or synchronized, however, all dynamic role
     assignments are reassessed automatically.
    </p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="role-mapping"></a>7.3.3.&nbsp;Setting up the Role Mapping</h3></div></div></div><p>
    After the role has been defined, and the effective assignments checked, you
    must set up mapping for the role and, optionally, restrict provisioning
    based on the effective assignments.
   </p><p>
    This section describes these two steps.
   </p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="roles-default-mapping"></a>7.3.3.1.&nbsp;Creating a Mapping For Effective Assignments</h4></div></div></div><p>
    After the effective assignments have been calculated, OpenIDM applies these
    assignments to the target resources.
   </p><p>
    The following sample extract of a <code class="filename">sync.json</code> file
    applies the <code class="literal">ldap</code> assignment, illustrated in the previous
    section, on the target resource (<code class="literal">system/ldap/account</code>) for
    all entries that have <code class="literal">"effectiveAssignments" : "ldap"</code> in
    the source.
   </p><pre class="brush: javascript;">
{
    "name" : "managedUser_systemLdapAccounts",
    "source" : "managed/user",
    "target" : "system/ldap/account",
    "links" : "systemLdapAccounts_managedUser",
    },
    "assignmentsToMap": [
        "ldap"
    ],
    ...
}   </pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="conditional-mapping"></a>7.3.3.2.&nbsp;Using Roles For Conditional Mapping</h4></div></div></div><p>
    The roles mechanism provides the ability to restrict provisioning based on
    a user's effective assignments. For example, you might want to prevent users
    from being provisioned to an Active Directory system, if they do not have
    specific access to that system.
   </p><p>
    Based on the <code class="literal">"effectiveAssignments"</code> virtual attribute,
    described in the previous section, you could configure a conditional mapping
    for this example, as follows:
   </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
      Create a role definition that gives the user the Active Directory
      assignment, for example:
     </p><pre class="brush: javascript;">
 "_id": "ad-role",
     "assignments": {
         "ad": {
             "attributes": [
                 {
                     "name": "cns",
                     "value": [
                         "CN=fileshare,O=corp",
                         "CN=desktop,O=corp",
                         "CN=terminal,O=corp",
                         "CN=intranet,O=corp"
                     ],
                     "assignmentOperation": "replaceTarget"
                 }
             ]
         }
     </pre></li><li class="listitem"><p>Add the role directly as a value of the user's
      <code class="literal">"roles"</code> attribute.</p><pre class="brush: plain;">
"roles" : [
    "name" : "managed/role/ad-role",
    "name" : "openidm-authorized"
]
     </pre></li><li class="listitem"><p>
      Add a condition in the mapping that restricts provisioning to users who
      have the <code class="literal">"ad-role"</code> as an effective role. The effective
      roles are calculated from the values in the user's
      <code class="literal">"roles"</code> attribute.
     </p><pre class="brush: java;">
{
    "mappings": [
        {
            "name": "managedUser_systemAdAccounts",
            "source": "managed/user",
            "sourceCondition": {
                "effectiveRoles": "managed/role/ad-role"
            },
            "target": "system/ad/account"
            ...
        }
    ]
}
     </pre></li></ol></div></div></div></div></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-policies"></a>Chapter&nbsp;8.&nbsp;Using Policies to Validate Data</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="section"><a href="#configuring-default-policy">8.1. Configuring the Default Policy</a></span></dt><dt><span class="section"><a href="#extending-policies">8.2. Extending the Policy Service</a></span></dt><dt><span class="section"><a href="#disabling-policies">8.3. Disabling Policy Enforcement</a></span></dt><dt><span class="section"><a href="#policies-over-REST">8.4. Managing Policies Over REST</a></span></dt></dl></div><a class="indexterm" name="d505e4656"></a><p>OpenIDM provides an extensible policy service that enables you to 
  apply specific validation requirements to various components and properties. 
  The policy service provides a REST interface for reading policy requirements 
  and validating the properties of components against configured policies. 
  Objects and properties are validated automatically when they are created, 
  updated, or patched. Policies can be applied to user passwords, but also to 
  any kind of managed object.</p><p>The policy service enables you to do the following:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Read the configured policy requirements of a specific component.
     </p></li><li class="listitem"><p>Read the configured policy requirements of all components.</p></li><li class="listitem"><p>Validate a component object against the configured policies.</p></li><li class="listitem"><p>Validate the properties of a component against the configured 
     policies.</p></li></ul></div><p>A default policy applies to all managed objects. You can configure the 
  default policy to suit your requirements, or you can extend the policy 
  service by supplying your own scripted policies.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="configuring-default-policy"></a>8.1.&nbsp;Configuring the Default Policy</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#policy-script-file">8.1.1. Policy Script File</a></span></dt><dt><span class="section"><a href="#policy-config-file">8.1.2. Policy Configuration File</a></span></dt></dl></div><p>The default policy is configured in two files:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>A policy script file 
        (<code class="filename">openidm/bin/defaults/script/policy.js</code>) which 
        defines each policy and specifies how policy validation is performed.
        </p></li><li class="listitem"><p>A policy configuration file 
        (<code class="filename">openidm/conf/policy.json</code>) which specifies which 
        policies are applicable to each resource.
        </p></li></ul></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="policy-script-file"></a>8.1.1.&nbsp;Policy Script File</h3></div></div></div><p>
       The policy script file defines policy configuration in two parts:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
         A policy configuration object, which defines each element of the policy.
        </p></li><li class="listitem"><p>
         A policy implementation function, which describes the requirements that
         are enforced by that policy.
        </p></li></ul></div><p>Together, the configuration object and the implementation function 
      determine whether an object is valid in terms of the policy. The following 
      extract from the policy script file configures a policy that specifies 
      that the value of a property must contain a certain number of capital 
      letters.</p><pre class="brush: javascript;">...
{   "policyId" : "at-least-X-capitals",
    "policyExec" : "atLeastXCapitalLetters",
    "clientValidation": true,
    "validateOnlyIfPresent":true,
    "policyRequirements" : ["AT_LEAST_X_CAPITAL_LETTERS"]
},
...

policyFunctions.atLeastXCapitalLetters = function(fullObject, value, params, property) {
  var isRequired = _.find(this.failedPolicyRequirements, function (fpr) {
      return fpr.policyRequirement === "REQUIRED";
    }),
    isNonEmptyString = (typeof(value) === "string" &amp;&amp; value.length),
    valuePassesRegexp = (function (v) {
      var test = isNonEmptyString ? v.match(/[(A-Z)]/g) : null;
      return test !== null &amp;&amp; test.length &gt;= params.numCaps;
    }(value));

  if ((isRequired || isNonEmptyString) &amp;&amp; !valuePassesRegexp) {
    return [ { "policyRequirement" : "AT_LEAST_X_CAPITAL_LETTERS", "params" : {"numCaps": params.numCaps} } ];
  }

  return [];
}     
...     
      </pre><p>To enforce user passwords that contain at least one capital letter, 
      the previous policy ID is applied to the appropriate resource and the 
      required number of capital letters is defined in the policy configuration 
      file, as described in <a class="xref" href="#policy-config-file" title="8.1.2.&nbsp;Policy Configuration File">Section&nbsp;8.1.2, &#8220;Policy Configuration File&#8221;</a>.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="policy-config-object"></a>8.1.1.1.&nbsp;Policy Configuration Object</h4></div></div></div><p>Each element of the policy is defined in a policy configuration 
        object. The structure of a policy configuration object is as follows:
        </p><pre class="brush: javascript;">
{   "policyId" : "minimum-length",
    "policyExec" : "propertyMinLength",
    "clientValidation": true,
    "validateOnlyIfPresent": true,
    "policyRequirements" : ["MIN_LENGTH"]
}
      </pre><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="literal">"policyId"</code> - a unique ID that enables the 
        policy to be referenced by component objects.</td></tr><tr><td><code class="literal">"policyExec"</code> - the name of the function that
        contains the policy implementation. For more information, see
        <a class="xref" href="#policy-function" title="8.1.1.2.&nbsp;Policy Implementation Function">Section&nbsp;8.1.1.2, &#8220;Policy Implementation Function&#8221;</a>.</td></tr><tr><td><code class="literal">"clientValidation"</code> - indicates whether the
        policy decision can be made on the client. When 
        <code class="literal">"clientValidation": true</code>, the source code for the 
        policy decision function is returned when the client requests the 
        requirements for a property.</td></tr><tr><td><code class="literal">"validateOnlyIfPresent"</code> - notes that the
        policy is to be validated only if it exists.</td></tr><tr><td><code class="literal">"policyRequirements"</code> - an array containing 
        the policy requirement ID of each requirement that is associated with 
        the policy. Typically, a policy will validate only one requirement, 
        but it can validate more than one.</td></tr></table></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="policy-function"></a>8.1.1.2.&nbsp;Policy Implementation Function</h4></div></div></div><p>Each policy ID has a corresponding policy implementation 
        function that performs the validation. Functions take the following 
        form:</p><pre class="brush: javascript;">
function &lt;name&gt;(fullObject, value, params, propName) {	
	&lt;implementation_logic&gt;
}
        </pre><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="literal">fullObject</code> is the full resource object 
          that is supplied with the request.</td></tr><tr><td><code class="literal">value</code> is the value of the property that 
          is being validated.</td></tr><tr><td><code class="literal">params</code> refers to the 
          <code class="literal">"params"</code> array that is specified in the property's 
          policy configuration.</td></tr><tr><td><code class="literal">propName</code> is the name of the property that 
          is being validated.</td></tr></table><p>The following example shows the implementation function for the 
        <code class="literal">"required"</code> policy.</p><pre class="brush: javascript;">
function required(fullObject, value, params, propName) {
    if (value === undefined) {
        return [ { "policyRequirement" : "REQUIRED" } ];
    }
    return [];
}          
        </pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="policy-config-file"></a>8.1.2.&nbsp;Policy Configuration File</h3></div></div></div><p>
       The policy configuration file includes a pointer to the policy
       script, and the configured policies for each component resource.
       The following includes three sample extracts from the
       <code class="filename">policy.js</code> file, illustrating policies for
       passwords, roles, and mobile telephone numbers.
      </p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="policy-config-file-password"></a>8.1.2.1.&nbsp;Sample Password Policy Extract</h4></div></div></div><p>
        The following extract of the default policy configuration file shows how
        the <code class="literal">at-least-X-capitals</code> policy is applied to user
        passwords. In this case, the configuration file requires users to
        include at least one upper case (capital) letter in their passwords.
       </p><pre class="brush: javascript;">
{
    "type" : "text/javascript",
    "file" : "bin/defaults/script/policy.js",
    "resources" : [
        {
            "resource" : "managed/user/*",
            "properties" : [
...
                {
                    "name" : "password",
                    "policies" : [
                        {
                            "policyId" : "required"
                        },
                        {
                            "policyId" : "not-empty"
                        },
                        {
                            "policyId" : "at-least-X-capitals",
                            "params" : {
                                "numCaps" : 1
                            }
                        },
                ...
           }
       ]
}     
       </pre><p>The configuration file includes the following properties:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
         <code class="literal">"type"</code> - specifies the type of policy service.
         Supported types include <code class="literal">"text/javascript"</code> and
         <code class="literal">"groovy"</code>.
        </p></li><li class="listitem"><p><code class="literal">"file"</code> - provides the path to the policy 
          script file, relative to the OpenIDM installation directory.</p></li><li class="listitem"><p><code class="literal">"resources"</code> provides an array of resource 
          objects, in JSON format, that are subject to the policy service. 
          Resource objects are identified by the <code class="literal">"resource"</code> 
          parameter, which indicates the URI and supports wildcard syntax. For 
          example, <code class="literal">"managed/user/*"</code> indicates that the 
          policy applies to all objects under <code class="literal">/managed/user</code>. 
          Each resource has the following properties:</p><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="literal">"name"</code> - the name of the property to 
              which the policy is applied.</td></tr><tr><td><code class="literal">"policyId"</code> - the ID of the policy that
              is applied to that property.</td></tr><tr><td><code class="literal">"params"</code> - any specific parameters 
              that apply to that policy ID.</td></tr></table></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="policy-config-file-array"></a>8.1.2.2.&nbsp;Sample Array Policy Extract</h4></div></div></div><p>
        Some users may choose to include multiple cellular telephone numbers.
        In OpenIDM, multiple values for an object can be organized in an array.
        The following excerpt from a sample <code class="filename">policy.json</code> file
        requires an entry for <code class="literal">mobilePhones</code>, and includes two
        separate policies.
       </p><p>
        The first policy suggests that the <code class="literal">mobilePhones</code>
        policy must be present in the object, and there must be at least one
        element within that object (array).
       </p><p>
        The second policy suggests that for any given element of the
        <code class="literal">mobilePhones</code> object must not be an empty string.
       </p><pre class="brush: javascript;">
...
    {
        "name" : "mobilePhones",
        "policies" : [
            {
                "policyId" : "required"
            },
            {
                "policyId" : "not-empty"
            }
        ]
    },
    {
        "name" : "mobilePhones[*]",
        "policies" : [
            {
                "policyId" : "not-empty"
            }
        ]
    }
...
       </pre></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="extending-policies"></a>8.2.&nbsp;Extending the Policy Service</h2></div></div></div><p>You can extend the policy service by adding your own scripted 
    policies in <code class="filename">openidm/script</code> and referencing them in 
    the policy configuration file (<code class="filename">conf/policy.json</code>). 
    Avoid manipulating the default policy script file (in 
    <code class="literal">bin/defaults/script</code>) as doing so might result in 
    interoperability issues in a future release. To reference additional 
    policy scripts, set the <code class="literal">"additionalFiles"</code> property in 
    <code class="filename">conf/policy.json</code>.</p><p>The following example creates a custom policy that rejects 
    properties with null values. The policy is defined in a script named 
    <code class="literal">mypolicy.js</code>.</p><pre class="brush: javascript;">
var policy = {   "policyId" : "notNull",
       "policyExec" : "notNull",  
       "policyRequirements" : ["NOT_NULL"]
}

addPolicy(policy);

function notNull(fullObject, value, params, property) {
   if (value == null) {
       return [ {"policyRequirement": "NOT_NULL"}];
   }
   return [];
} 
    </pre><p>The <code class="filename">mypolicy.js</code> policy is referenced in the
     <code class="filename">policy.json</code> configuration file as follows:
    </p><pre class="brush: javascript;">
{
    "type" : "text/javascript",
    "file" : "bin/defaults/script/policy.js",
    "additionalFiles" : ["script/mypolicy.js"],
    "resources" : [
        {
...
    </pre><p>You can also configure policies for managed object properties as
    part of the property definition in the <code class="filename">conf/managed.json</code>
    file. For example, the following extract of a managed.json file shows a
    policy configuration for the <code class="literal">password</code> property.</p><pre class="brush: javascript;">
...
"properties" : [
    {
        "name" : "password",
        "encryption" : {
            "key" : "openidm-sym-default"
        },
        "scope" : "private"
        "policies" : [
            {
                "policyId" : "required"
            },
            {
                "policyId" : "not-empty"
            },
            {
                "policyId" : "at-least-X-capitals",
                "params" : {
                "numCaps" : 1
                }
            }
        ]
    },
...
   </pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="disabling-policies"></a>8.3.&nbsp;Disabling Policy Enforcement</h2></div></div></div><p>Policy enforcement refers to the automatic validation of data in 
     the repository when it is created, updated, or patched. In certain 
     situations you might want to disable policy enforcement temporarily. You 
     might, for example, want to import existing data that does not meet the 
     validation requirements with the intention of cleaning up this data at a 
     later stage.</p><p>You can disable policy enforcement by setting 
     <code class="literal">openidm.policy.enforcement.enabled</code> to 
     <code class="literal">false</code> in the <code class="filename">conf/boot/boot.properties</code> 
     file. This setting disables policy enforcement in the back-end only, and 
     has no impact on direct policy validation calls to the Policy Service 
     (which the user interface makes to validate input fields). So, with policy 
     enforcement disabled, data added directly over REST is not subject to 
     validation, but data added with the UI is still subject to validation.
     </p><p>Disabling policy enforcement permanently in a production system is 
     not recommended.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="policies-over-REST"></a>8.4.&nbsp;Managing Policies Over REST</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#listing-policies">8.4.1. Listing the Defined Policies</a></span></dt><dt><span class="section"><a href="#policy-validate">8.4.2. Validating Objects and Properties Over REST</a></span></dt></dl></div><p>You can manage the policy service over the REST interface, by calling 
    the REST endpoint <code class="literal">https://localhost:8443/openidm/policy</code>, as
    shown in the following examples.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="listing-policies"></a>8.4.1.&nbsp;Listing the Defined Policies</h3></div></div></div><p>The following REST call displays a list of all the defined 
      policies. The policy objects are returned in JSON format, with one object
      for each defined policy ID.
      </p><div class="screen"><pre>
$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/policy"</strong>
<em>
{
  "resources": [
    {
      "properties": [
      {
        "name": "_id",
        "policies": [
          {
            "policyFunction":
...</em>
      </pre></div><p>To display the policies that apply to a specific component, include 
      the component name in the URL. For example, the following REST call 
      displays the policies that apply to managed users.
      </p><div class="screen"><pre>
$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/policy/managed/user/*"</strong>
<em>
{
   "properties": [
     {
        "name": "_id",
        "policies": [
            {
            "policyFunction": "
               "\n  function (fullObject, value, params, property) {
               \n    var i, join = function (arr, d) {

...
}</em></pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="policy-validate"></a>8.4.2.&nbsp;Validating Objects and Properties Over REST</h3></div></div></div><p>Use the <code class="literal">validateObject</code> action to verify that 
      an object adheres to the requirements of a policy.</p><p>The following example verifies that a new managed user object is 
      acceptable in terms of the policy requirements.</p><div class="screen"><pre>
$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 --data '{
  "sn":"Jones",
  "givenName":"Bob",
  "_id":"bjones",
  "telephoneNumber":"0827878921",
  "passPhrase":null,
  "mail":"bjones@example.com",
  "accountStatus":"active",
  "roles":"admin",
  "userName":"bjones@example.com",
  "password":"123"}' \
 "https://localhost:8443/openidm/policy/managed/user/bjones?_action=validateObject"
       </strong>
       <em>
 {
   "failedPolicyRequirements": [
     {
       "property": "password",
       "policyRequirements": [
         {
           "params": {
             "numCaps": 1
           },
           "policyRequirement": "AT_LEAST_X_CAPITAL_LETTERS"
         }
       ]
     },
     {
       "property": "password",
       "policyRequirements": [
         {
           "params": {
             "minLength": 8
           },
           "policyRequirement": "MIN_LENGTH"
         }
       ]
     },
     {
       "property": "passPhrase",
       "policyRequirements": [
         {
           "params": {
             "minLength": 4
           },
           "policyRequirement": "MIN_LENGTH"
         }
       ]
     }
   ],
   "result": false
 }</em>
      </pre></div><p>The result (<code class="literal">false</code>) indicates that the object 
      is not valid. The unfulfilled policy requirements are provided as part 
      of the response - in this case, the user password does not meet the 
      validation requirements.</p><p>Use the <code class="literal">validateProperty</code> action to verify that 
      a specific property adheres to the requirements of a policy.</p><p>The following example checks whether Barbara Jensen's new password 
      (<code class="literal">12345</code>) is acceptable.</p><div class="screen"><pre>$ <strong>curl \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 --data '{ "password" : "12345" }' \
 "http://localhost:8080/openidm/policy/managed/user/bjensen?_action=validateProperty"
       </strong>
       <em>
{
    "result": false,
    "failedPolicyRequirements": [
        {
            "policyRequirements": [
                {
                    "policyRequirement": "AT_LEAST_X_CAPITAL_LETTERS",
                    "params": {
                        "numCaps": 1
                    }
                },
                {
                    "policyRequirement": "MIN_LENGTH",
                    "params": {
                        "minLength": 8
                    }
                }
            ],
            "property": "password"
        }
    ]
}                  </em>
      </pre></div><p>The result (<code class="literal">false</code>) indicates that the password 
      is not valid. The unfulfilled policy requirements are provided as part 
      of the response - in this case, the minimum length and the minimum 
      number of capital letters.</p><p>Validating a property that does fulfil the policy requirements 
      returns a <code class="literal">true</code> result, for example:</p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 --data '{ "password" : "1NewPassword" }' \
 "https://localhost:8443/openidm/policy/managed/user/bjensen?_action=validateProperty"
       </strong>
       <em>
{
    "failedPolicyRequirements": []
    "result": true,
}                      </em>
      </pre></div></div></div></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-logs"></a>Chapter&nbsp;9.&nbsp;Configuring Server Logs</h1></div></div></div><a class="indexterm" name="d505e5031"></a><p>
  This chapter briefly describes server logging. For audit information, see the
  chapter on <a href="../integrators-guide/index.html#chap-auditing" class="link"><em class="citetitle">Using Audit
  Logs</em></a>.
 </p><p>
  To configure logging, edit the
  <code class="filename">openidm/conf/logging.properties</code> file.
 </p><p>
  The default configuration writes log messages in simple format to
  <code class="filename">openidm/logs/openidm*.log</code> files, rotating files when the
  size reaches 5 MB, and retaining up to 5 files. Also by default, OpenIDM
  writes all system and custom log messages to the files.
 </p><p>
  You can update the configuration to attach loggers to individual packages,
  setting the log level to one of the following values.
 </p><pre class="brush: plain;">
SEVERE (highest value)
WARNING
INFO
CONFIG
FINE
FINER
FINEST (lowest value)</pre><p>
  If you use <code class="literal">logger</code> functions in your JavaScript scripts, you
  can set the log level for the scripts as follows:
 </p><pre class="literallayout">org.forgerock.script.javascript.JavaScript.level=<em class="replaceable"><code>level</code></em></pre><p>
  You can override the log level settings per script by using
 </p><pre class="literallayout">org.forgerock.script.javascript.JavaScript.<em class="replaceable"><code>script-name</code></em>.level</pre></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-resource-conf"></a>Chapter&nbsp;10.&nbsp;Connecting to External Resources</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="section"><a href="#openidm-openicf">10.1. About OpenIDM and OpenICF</a></span></dt><dt><span class="section"><a href="#connector-info-provider-conf">10.2. Accessing Remote Connectors</a></span></dt><dt><span class="section"><a href="#openicf-provisioner-conf">10.3. Configuring Connectors</a></span></dt><dt><span class="section"><a href="#installing-connector-servers">10.4. Installing and Configuring Remote Connector Servers</a></span></dt><dt><span class="section"><a href="#connectors-with-openidm">10.5. Connectors Supported With OpenIDM 3.0.0</a></span></dt><dt><span class="section"><a href="#connector-wiz">10.6. Creating Default Connector Configurations</a></span></dt><dt><span class="section"><a href="#systems-over-rest">10.7. Checking the Status of External Systems Over REST</a></span></dt><dt><span class="section"><a href="#adding-to-connector-config">10.8. Adding Attributes to Connectors</a></span></dt></dl></div><a class="indexterm" name="d505e5074"></a><a class="indexterm" name="d505e5077"></a><a class="indexterm" name="d505e5080"></a><p>
  This chapter describes how to connect to external resources such as LDAP,
  Active Directory, flat files, and others. Configurations shown here are
  simplified to show essential aspects. Not all resources support all OpenIDM
  operations, however the resources shown here support most of the CRUD
  operations, and also reconciliation and LiveSync.
 </p><p>
  In OpenIDM, <em class="firstterm">resources</em> are external systems, databases,
  directory servers, and other sources of identity data to be managed and
  audited by the identity management system. To connect to resources, OpenIDM
  loads the Identity Connector Framework, <a class="link" href="http://openicf.forgerock.org/" target="_blank">OpenICF</a>. OpenICF aims to
  avoid the need to install agents to access resources, instead using the
  resources' native protocols. For example, OpenICF connects to database
  resources using the database's Java connection libraries or JDBC driver. It
  connects to directory servers over LDAP. It connects to UNIX systems by using
  <span class="command"><strong>ssh</strong></span>.
 </p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="openidm-openicf"></a>10.1.&nbsp;About OpenIDM and OpenICF</h2></div></div></div><p>
   OpenICF provides a common interface to allow identity services access to the
   resources that contain user information. OpenIDM loads the OpenICF API as one
   of its OSGi modules. OpenICF uses <em class="firstterm">connectors</em> to
   separate the OpenIDM implementation from the dependencies of the resource to
   which OpenIDM is connecting. A specific connector is required for each remote
   resource. Connectors can run either locally or remotely.
  </p><p>
   <em class="firstterm">Local</em> connectors are loaded by OpenICF as regular
   bundles in the OSGi container. Remote connectors must be executed on a remote
   <em class="firstterm">connector server</em>. Most connectors can be run locally.
   However, a remote connector server is required when access libraries that
   cannot be included as part of the OpenIDM process are needed. If a resource,
   such as Microsoft Active Directory, does not provide a connection library
   that can be included inside the Java Virtual Machine, OpenICF can use the
   native .dll with a remote .NET connector server. In other words, OpenICF
   connects to Active Directory through a remote connector server that is
   implemented as a .NET service.
  </p><p>
   Connections to remote connector servers are configured in a single
   <em class="firstterm">connector info provider</em> configuration file, located in
   <code class="filename">/path/to/openidm/conf</code>.
  </p><p>
   Connectors themselves are configured through
   <em class="firstterm">provisioner</em> files. One provisioner file must exist for
   each connector. Provisioner files are named
   <code class="filename">provisioner.openicf-<em class="replaceable"><code>name</code></em></code> where
   <em class="replaceable"><code>name</code></em> corresponds to the name of the connector,
   and are also located in the <code class="filename">/path/to/openidm/conf</code>
   directory.
  </p><p>
   A number of sample connector configurations are available in the
   <code class="filename">openidm/samples/provisioners</code> directory. To use these
   connectors, edit the configuration files as required, and copy them to the
   <code class="filename">openidm/conf</code> directory.
  </p><p>
   The following figure shows how OpenIDM connects to resources by using
   connectors and remote connector servers. The figure shows one local connector
   (LDAP) and two remote connectors (Scripted SQL and PowerShell). In this
   example, the remote Scripted SQL connector uses a remote Java connector
   server. The remote PowerShell connector always requires a remote .NET
   connector server.
  </p><div class="mediaobject" align="center"><a name="figure-openicfarch"></a><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/OpenICFArch.png" align="middle" height="360" alt="OpenICF architecture"></td></tr></table><div class="longdesc-link" align="right"><br clear="all"><span class="longdesc-link">[<a href="figure-openicfarch.html" target="longdesc">D</a>]</span></div></div><div class="tip"><h3 class="title">Tip</h3><p>
    Connectors that use the .NET framework <span class="emphasis"><em>must</em></span> run
    remotely. Java connectors can be run locally or remotely. Run them as remote
    services for scalability, or to have the service run in the cloud.
   </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="connector-info-provider-conf"></a>10.2.&nbsp;Accessing Remote Connectors</h2></div></div></div><a class="indexterm" name="d505e5163"></a><p>
   When you configure a remote connector, you use the <em class="firstterm">connector info
   provider service</em> to connect through a remote connector server.
   The connector info provider service configuration is stored in the file
   <code class="filename">openidm/conf/provisioner.openicf.connectorinfoprovider.json</code>.
   A sample configuration file is provided in the
   <code class="filename">openidm/samples/provisioners/</code> directory. To use this
   sample configuration, edit the file as required, and copy it to the
   <code class="filename">openidm/conf</code> directory.
  </p><p>
   The connector info provider service takes the following configuration:
  </p><pre class="brush: javascript;">
{
  "connectorsLocation"     : string,
  "remoteConnectorServers" : [remoteConnectorServer objects]
}</pre><div class="variablelist"><div class="variablelist-title">Connector Info Provider Properties</div><dl class="variablelist"><dt><span class="term">connectorsLocation</span></dt><dd><p>string, optional</p><p>
      Specifies the directory in which the OpenICF connectors are located,
      relative to the OpenIDM installation directory. The default location is
      <code class="filename">openidm/connectors</code>.
     </p></dd><dt><span class="term"><a class="link" href="#remote-connector-server-object-properties" title="Remote Connector Server Properties">remoteConnectorServers</a></span></dt><dd><p>array of RemoteConnectorServer objects, optional</p><p>
      An array of remote connector servers that are managed by this service.
     </p></dd></dl></div><div class="variablelist"><a name="remote-connector-server-object-properties"></a><div class="variablelist-title">Remote Connector Server Properties</div><p>
   The following example shows a <code class="literal">remoteConnectorServer</code> object
   configuration.
  </p><pre class="brush: javascript;">
{
  "name"               : "dotnet",
  "host"               : "127.0.0.1",
  "port"               : 8759,
  "heartbeatInterval"  : 60,
  "useSSL"             : false,
  "timeout"            : 0,
  "key"                : "Passw0rd"
}</pre><p>
   You can configure the following remote connector server object properties.
  </p><dl class="variablelist"><dt><span class="term">name</span></dt><dd><p>string, required</p><p>
     The name of the remote connector server object. This name is used to
     identify the remote connector server in the list of connector reference
     objects.
    </p></dd><dt><span class="term">host</span></dt><dd><p>string, required</p><p>
     The remote host to connect to.
    </p></dd><dt><span class="term">port</span></dt><dd><p>string, optional</p><p>
     The remote port to connect to. The default remote port is 8759.
    </p></dd><dt><span class="term">heartbeatInterval</span></dt><dd><p>integer, optional</p><p>
     The interval, in seconds, at which heartbeat packets are transmitted. If
     the connector server is unreachable, based on this heartbeat interval, all
     services that use the connector server are made unavailable until the
     connector server can be reached again. The default interval is 60 seconds.
    </p></dd><dt><span class="term">useSSL</span></dt><dd><p>boolean, optional</p><p>
     Specifies whether to connect to the connector server over SSL. The default
     value is <code class="literal">false</code>.
    </p></dd><dt><span class="term">timeout</span></dt><dd><p>integer, optional</p><p>
     Specifies the timeout (in milliseconds) to use for the connection. The
     default value is <code class="literal">0</code>, which means that there is no
     timeout.
    </p></dd><dt><span class="term">key</span></dt><dd><p>string, required</p><p>
     The secret key, or password, to use to authenticate to the remote connector
     server.
    </p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="openicf-provisioner-conf"></a>10.3.&nbsp;Configuring Connectors</h2></div></div></div><p>
   Connectors are configured through the OpenICF provisioner service. Each
   connector configuration is stored in a file in the
   <code class="filename">openidm/conf/</code> folder, and accessible over REST at the
   <code class="literal">openidm/conf</code> endpoint. Configuration files are named
   <code class="filename">openidm/conf/provisioner.openicf-<em class="replaceable"><code>name</code></em></code>
   where <em class="replaceable"><code>name</code></em> corresponds to the name of the
   connector. A number of sample connectors are available in the
   <code class="filename">openidm/samples/provisioners</code> directory. To use these
   connectors, edit the configuration files as required, and copy them to the
   <code class="filename">openidm/conf</code> directory.
  </p><p>
   If you are creating your own connector configuration files, <span class="emphasis"><em>do
   not include additional dash characters ( <code class="literal">-</code> ) in the
   connector <em class="replaceable"><code>name</code></em></em></span>, as this might cause
   problems with the OSGi parser. For example, the name
   <code class="filename">provisioner.openicf-hrdb.json</code> is fine. The name
   <code class="filename">provisioner.openicf-hr-db.json</code> is not.
  </p><p>
   The following example shows a connector configuration for an XML file
   resource.
  </p><pre class="brush: javascript;">{
 "name"                    : "xml",
 "connectorRef"            : connector-ref-object,
 "poolConfigOption"        : pool-config-option-object,
 "operationTimeout"        : operation-timeout-object,
 "configurationProperties" : configuration-properties-object,
 "objectTypes"             : object-types-object,
 "operationOptions"        : operation-options-object
}</pre><p>
   The <code class="literal">"name"</code> property specifies the name of the system to
   which you are connecting. This name <span class="emphasis"><em>must</em></span> be
   alphanumeric.
  </p><div class="variablelist"><a name="connector-reference"></a><div class="variablelist-title">Connector Reference</div><p>
    The following example shows a connector reference object.
   </p><pre class="brush: javascript;">
{
  "bundleName"       : "org.forgerock.openicf.connectors.xml-connector",
  "bundleVersion"    : "[1.1,1.5]",
  "connectorName"    : "org.forgerock.openicf.connectors.xml.XMLConnector",
  "connectorHostRef" : "host"
}</pre><dl class="variablelist"><dt><span class="term">bundleName</span></dt><dd><p>string, required</p><p>
      The <em class="replaceable"><code>ConnectorBundle-Name</code></em> of the OpenICF
      connector.
     </p></dd><dt><span class="term">bundleVersion</span></dt><dd><p>string, required</p><p>
      The <em class="replaceable"><code>ConnectorBundle-Version</code></em> of the OpenICF
      connector. The value can be a single version (such as
      <code class="literal">1.4.0.0</code>) or a range of versions, which enables you to
      support multiple connector versions in a single project.
     </p><p>
      You can specify a range of versions as follows:
     </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        <code class="literal">[1.1.0.0,1.4.0.0]</code> indicates that all connector
        versions from 1.1 to 1.4, inclusive, are supported.
       </p></li><li class="listitem"><p>
        <code class="literal">[1.1.0.0,1.4.0.0)</code> indicates that all connector
        versions from 1.1 to 1.4, including 1.1 but excluding 1.4, are
        supported.
       </p></li><li class="listitem"><p>
        <code class="literal">(1.1.0.0,1.4.0.0]</code> indicates that all connector
        versions from 1.1 to 1.4, excluding 1.1 but including 1.4, are
        supported.
       </p></li><li class="listitem"><p>
        <code class="literal">(1.1.0.0,1.4.0.0)</code> indicates that all connector
        versions from 1.1 to 1.4, exclusive, are supported.
       </p></li></ul></div></dd><dt><span class="term">connectorName</span></dt><dd><p>string, required</p><p>
      The Connector implementation class name.
     </p></dd><dt><span class="term">connectorHostRef</span></dt><dd><p>string, optional</p><p>
       If the connector runs remotely, the value of this field must match the
        <code class="literal">name</code> field of the
       <code class="literal">RemoteConnectorServers</code> object in the connector server
       configuration file
       (<code class="filename">provisioner.openicf.connectorinfoprovider.json</code>).
       For example:
     </p><pre class="brush: plain;">...
         "remoteConnectorServers" :
      [
         {
            "name" : "dotnet",
      ...</pre><div class="itemizedlist"><p>
       If the connector runs locally, the value of this field can be one of
       the following:
      </p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        If the connector .jar is installed in
        <code class="filename">openidm/connectors/</code>, the value must be
        <code class="literal">"#LOCAL"</code>. This is currently the default, and
        recommended location.
       </p></li><li class="listitem"><p>
        If the connector .jar is installed in <code class="filename">openidm/bundle/</code>
        (not recommended), the value must be
        <code class="literal">"osgi:service/org.forgerock.openicf.framework.api.osgi.ConnectorManager"</code>.
       </p></li></ul></div></dd></dl></div><div class="variablelist"><a name="pool-configuration-option"></a><div class="variablelist-title">Pool Configuration Option</div><p>
    The Pool Configuration Option (<code class="literal">"poolConfigOption"</code>)
    specifies the pool configuration for poolable connectors only. Non-poolable
    connectors ignore this parameter.
   </p><p>
    The following example shows a pool configuration option object for a
    poolable connector.
   </p><pre class="brush: javascript;">{
  "maxObjects"                 : 10,
  "maxIdle"                    : 10,
  "maxWait"                    : 150000,
  "minEvictableIdleTimeMillis" : 120000,
  "minIdle"                    : 1
}</pre><dl class="variablelist"><dt><span class="term">maxObjects</span></dt><dd><p>
      The maximum number of idle and active instances of the connector.
     </p></dd><dt><span class="term">maxIdle</span></dt><dd><p>
      The maximum number of idle instances of the connector.
     </p></dd><dt><span class="term">maxWait</span></dt><dd><p>
      The maximum time, in milliseconds, that the pool waits for an object
      before timing out. A value of <code class="literal">0</code> means that there is no
      timeout.
     </p></dd><dt><span class="term">minEvictableIdleTimeMillis</span></dt><dd><p>
      The maximum time, in milliseconds, that an object can be idle before it is
      removed. A value of <code class="literal">0</code> means that there is no idle
      timeout.</p></dd><dt><span class="term">minIdle</span></dt><dd><p>
      The minimum number of idle instances of the connector.
     </p></dd></dl></div><div class="variablelist"><a name="operation-timeout"></a><div class="variablelist-title">Operation Timeout</div><p>
    The operation timeout enables you to configure timeout values per operation
    type. By default, there is no timeout configured for any operation type.
    A sample configuration follows:
   </p><pre class="brush: javascript;">
{
  "CREATE"              : -1,
  "TEST"                : -1,
  "AUTHENTICATE"        : -1,
  "SEARCH"              : -1,
  "VALIDATE"            : -1,
  "GET"                 : -1,
  "UPDATE"              : -1,
  "DELETE"              : -1,
  "SCRIPT_ON_CONNECTOR" : -1,
  "SCRIPT_ON_RESOURCE"  : -1,
  "SYNC"                : -1,
  "SCHEMA"              : -1
}</pre><dl class="variablelist"><dt><span class="term"><em class="replaceable"><code>operation-name</code></em></span></dt><dd><p>Timeout in milliseconds</p><p>
      A value of <code class="literal">-1</code> disables the timeout.
     </p></dd></dl></div><div class="variablelist"><a name="configuration-properties"></a><div class="variablelist-title">Configuration Properties</div><p>
    This object contains the configuration for the connection between the
    connector and the resource, and is therefore resource specific.
   </p><p>
    The following example shows a configuration properties object for the
    default XML sample resource connector.
   </p><pre class="brush: javascript;">
"configurationProperties" : {
    "xsdIcfFilePath" : "&amp;{launcher.project.location}/data/resource-schema-1.xsd",
    "xsdFilePath" : "&amp;{launcher.project.location}/data/resource-schema-extension.xsd",
    "xmlFilePath" : "&amp;{launcher.project.location}/data/xmlConnectorData.xml"
}</pre><dl class="variablelist"><dt><span class="term"><em class="replaceable"><code>property</code></em></span></dt><dd><p>Individual properties depend on the type of connector.</p></dd></dl></div><div class="variablelist"><a name="object-types"></a><div class="variablelist-title">Object Types</div><a class="indexterm" name="d505e5553"></a><p>
    This configuration object specifies the object types (user, group, and so
    on) that are supported by the connector. The property name defines the
    <code class="literal">objectType</code>, used in the URI:
   </p><pre class="brush: plain;">system/$systemName/$objectType</pre><p>
    The configuration is based on the <a class="link" href="http://tools.ietf.org/html/draft-zyp-json-schema-03" target="_blank">JSON
    Schema</a> with the extensions described in the following section.
   </p><p>
    Attribute names that start or end with <code class="literal">__</code> are specific to
    the resource type and are used by OpenICF for particular purposes, such as
    <code class="literal">__NAME__</code>, used as the naming attribute for objects on a
    resource.
   </p><p>
    The following extract shows the configuration of an
    <code class="literal">account</code> object type.
   </p><pre class="brush: javascript;">{
  "account" :
  {
    "$schema" : "http://json-schema.org/draft-03/schema",
    "id" : "__ACCOUNT__",
    "type" : "object",
    "nativeType" : "__ACCOUNT__",
    "properties" :
    {
      "name" :
      {
        "type" : "string",
        "nativeName" : "__NAME__",
        "nativeType" : "JAVA_TYPE_PRIMITIVE_LONG",
        "flags" :
        [
          "NOT_CREATABLE",
          "NOT_UPDATEABLE",
          "NOT_READABLE",
          "NOT_RETURNED_BY_DEFAULT"
        ]
      },
      "groups" :
      {
        "type" : "array",
        "items" :
        {
          "type" : "string",
          "nativeType" : "string"
        },
        "nativeName" : "__GROUPS__",
        "nativeType" : "string",
        "flags" :
        [
          "NOT_RETURNED_BY_DEFAULT"
        ]
      },                
      "givenName" : {
         "type" : "string",
         "nativeName" : "givenName",
         "nativeType" : "string"
         },
    }
  }
}</pre><dl class="variablelist"><dt><span class="term">Object Level Extensions</span></dt><dd><div class="variablelist"><dl class="variablelist"><dt><span class="term">nativeType</span></dt><dd><p>string, optional</p><p>
         The native OpenICF object type.
        </p><p>
         The list of supported native object types is dependent on the resource,
         or on the connector. For example, an LDAP connector might have object
         types such as <code class="literal">__ACCOUNT__</code> and
         <code class="literal">__GROUP__</code>.
        </p></dd></dl></div></dd><dt><span class="term"><a name="property-level-extensions"></a>Property Level Extensions</span></dt><dd><div class="variablelist"><dl class="variablelist"><dt><span class="term">nativeType</span></dt><dd><p>string, optional</p><p>
         The native OpenICF attribute type.
        </p><p>
         The following native types are supported:
        </p><div class="screen"><pre>JAVA_TYPE_BIGDECIMAL
JAVA_TYPE_BIGINTEGER
JAVA_TYPE_BYTE
JAVA_TYPE_BYTE_ARRAY
JAVA_TYPE_CHAR
JAVA_TYPE_CHARACTER
JAVA_TYPE_DATE
JAVA_TYPE_DOUBLE
JAVA_TYPE_FILE
JAVA_TYPE_FLOAT
JAVA_TYPE_GUARDEDBYTEARRAY
JAVA_TYPE_GUARDEDSTRING
JAVA_TYPE_INT
JAVA_TYPE_INTEGER
JAVA_TYPE_LONG
JAVA_TYPE_OBJECT
JAVA_TYPE_PRIMITIVE_BOOLEAN
JAVA_TYPE_PRIMITIVE_BYTE
JAVA_TYPE_PRIMITIVE_DOUBLE
JAVA_TYPE_PRIMITIVE_FLOAT
JAVA_TYPE_PRIMITIVE_LONG
JAVA_TYPE_STRING</pre></div></dd><dt><span class="term">nativeName</span></dt><dd><p>string, optional</p><p>
         The native OpenICF attribute name.
        </p></dd><dt><span class="term">flags</span></dt><dd><p>string, optional</p><p>
         The native OpenICF attribute flags. The
         <em class="replaceable"><code>required</code></em> and
         <em class="replaceable"><code>multivalued</code></em> flags are defined by the JSON
         schema.
        </p><pre class="literallayout"><em class="replaceable"><code>required</code></em> = <code class="literal">"required" : true</code></pre><pre class="literallayout"><em class="replaceable"><code>multivalued</code></em> = <code class="literal">"type" : "array"</code></pre><p>
         If the type is <code class="literal">array</code>, an additional
         <code class="literal">"items"</code> field specifies the supported type for the
         objects in the array. For example:
        </p><pre class="brush: plain;">"groups" :
    {
        "type" : "array",
        "items" :
        {
          "type" : "string",
          "nativeType" : "string"
        },
    ....</pre></dd></dl></div></dd></dl></div><div class="note"><h3 class="title">Note</h3><p>
    Avoid using the dash character ( <code class="literal">-</code> ) in property names,
    like <code class="literal">last-name</code>, as dashes in names make JavaScript syntax
    more complex. If you cannot avoid the dash, then write
    <code class="literal">source['last-name']</code> instead of
    <code class="literal">source.last-name</code> in the JavaScripts.
   </p></div><div class="variablelist"><a name="operation-options"></a><div class="variablelist-title">Operation Options</div><p>
    Operation options (specified with the <code class="literal">"operationOptions"</code>
    property) define how to act on specified operations. You can, for example
    deny operations on specific resources to avoid OpenIDM accidentally updating
    a read-only resource during a synchronization operation.
   </p><p>
    The following example defines the options for the <code class="literal">"SYNC"</code>
    operation.
   </p><pre class="brush: javascript;">"operationOptions" : {
  {
    "SYNC" :
    {
      "denied" : true,
      "onDeny" : "DO_NOTHING",
      "objectFeatures" :
      {
        "__ACCOUNT__" :
        {
          "denied" : true,
          "onDeny" : "THROW_EXCEPTION",
          "operationOptionInfo" :
          {
            "$schema" : "http://json-schema.org/draft-03/schema",
            "id" : "FIX_ME",
            "type" : "object",
            "properties" :
            {
              "_OperationOption-float" :
              {
                 "type" : "number",
                 "nativeType" : "JAVA_TYPE_PRIMITIVE_FLOAT"
              }
            }
          }
        },
        "__GROUP__" :
        {
          "denied" : false,
          "onDeny" : "DO_NOTHING"
        }
      }
    }
  }
...</pre><div class="itemizedlist"><p>
     The OpenICF Framework supports the following operations:
    </p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
      <code class="literal">AUTHENTICATE</code>: <a class="link" href="http://openicf.forgerock.org/connector-framework/apidocs/org/identityconnectors/framework/api/operations/AuthenticationApiOp.html" target="_blank">AuthenticationApiOp</a>
     </p></li><li class="listitem"><p><code class="literal">CREATE</code>: <a class="link" href="http://openicf.forgerock.org/connector-framework/apidocs/org/identityconnectors/framework/api/operations/CreateApiOp.html" target="_blank">CreateApiOp</a></p></li><li class="listitem"><p><code class="literal">DELETE</code>: <a class="link" href="http://openicf.forgerock.org/connector-framework/apidocs/org/identityconnectors/framework/api/operations/DeleteApiOp.html" target="_blank">DeleteApiOp</a></p></li><li class="listitem"><p><code class="literal">GET</code>: <a class="link" href="http://openicf.forgerock.org/connector-framework/apidocs/org/identityconnectors/framework/api/operations/GetApiOp.html" target="_blank">GetApiOp</a></p></li><li class="listitem"><p><code class="literal">RESOLVEUSERNAME</code>: <a class="link" href="http://openicf.forgerock.org/connector-framework/apidocs/org/identityconnectors/framework/api/operations/ResolveUsernameApiOp.html" target="_blank">ResolveUsernameApiOp</a></p></li><li class="listitem"><p><code class="literal">SCHEMA</code>: <a class="link" href="http://openicf.forgerock.org/connector-framework/apidocs/org/identityconnectors/framework/api/operations/SchemaApiOp.html" target="_blank">SchemaApiOp</a></p></li><li class="listitem"><p><code class="literal">SCRIPT_ON_CONNECTOR</code>: <a class="link" href="http://openicf.forgerock.org/connector-framework/apidocs/org/identityconnectors/framework/api/operations/ScriptOnConnectorApiOp.html" target="_blank">ScriptOnConnectorApiOp</a></p></li><li class="listitem"><p><code class="literal">SCRIPT_ON_RESOURCE</code>: <a class="link" href="http://openicf.forgerock.org/connector-framework/apidocs/org/identityconnectors/framework/api/operations/ScriptOnResourceApiOp.html" target="_blank">ScriptOnResourceApiOp</a></p></li><li class="listitem"><p><code class="literal">SEARCH</code>: <a class="link" href="http://openicf.forgerock.org/connector-framework/apidocs/org/identityconnectors/framework/api/operations/SearchApiOp.html" target="_blank">SearchApiOp</a></p></li><li class="listitem"><p><code class="literal">SYNC</code>: <a class="link" href="http://openicf.forgerock.org/connector-framework/apidocs/org/identityconnectors/framework/api/operations/SyncApiOp.html" target="_blank">SyncApiOp</a></p></li><li class="listitem"><p><code class="literal">TEST</code>: <a class="link" href="http://openicf.forgerock.org/connector-framework/apidocs/org/identityconnectors/framework/api/operations/TestApiOp.html" target="_blank">TestApiOp</a></p></li><li class="listitem"><p><code class="literal">UPDATE</code>: <a class="link" href="http://openicf.forgerock.org/connector-framework/apidocs/org/identityconnectors/framework/api/operations/UpdateApiOp.html" target="_blank">UpdateApiOp</a></p></li><li class="listitem"><p><code class="literal">VALIDATE</code>: <a class="link" href="http://openicf.forgerock.org/connector-framework/apidocs/org/identityconnectors/framework/api/operations/ValidateApiOp.html" target="_blank">ValidateApiOp</a></p></li></ul></div><dl class="variablelist"><dt><span class="term">denied</span></dt><dd><p>boolean, optional</p><p>This property prevents operation execution if the value is
     <code class="literal">true</code>.</p></dd><dt><span class="term">onDeny</span></dt><dd><p>string, optional</p><p>If <code class="literal">denied</code> is <code class="literal">true</code>, then the
     service uses this value. Default value:
     <code class="literal">DO_NOTHING</code>.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">DO_NOTHING</code>: On operation the service does
       nothing.</p></li><li class="listitem"><p><code class="literal">THROW_EXCEPTION</code>: On operation the service
       throws a  <code class="literal">ForbiddenException</code> exception.</p></li></ul></div></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="installing-connector-servers"></a>10.4.&nbsp;Installing and Configuring Remote Connector Servers</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#install-.net-connector">10.4.1. Installing and Configuring a .NET Connector Server</a></span></dt><dt><span class="section"><a href="#install-standalone-connector">10.4.2. Installing and Configuring a Remote Java Connector Server</a></span></dt></dl></div><p>
   Connectors that use the .NET framework <span class="emphasis"><em>must</em></span> run
   remotely. Java connectors can run locally or remotely. Connectors that run
   remotely require a connector server to enable OpenIDM to access the
   connector.
  </p><div class="note"><h3 class="title">Note</h3><p>
    OpenIDM 3.0.0 supports version 1.4.0.0
    of the OpenICF Framework. Therefore, you must use version
    1.4.0.0 of the .NET Connector Server, or the Java Connector
    Server. The 1.4.0.0 Java Connector Server is backward
    compatible with the version 1.1.x connectors. The 1.4.0.0
    .NET Connector Server is compatible only with the 1.4.x connectors.
   </p></div><p>
   This section describes the steps to install a .NET connector server and a
   remote Java Connector Server.
  </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="install-.net-connector"></a>10.4.1.&nbsp;Installing and Configuring a .NET Connector Server</h3></div></div></div><p>
     A .NET connector server is useful when an application is written in Java,
     but a connector bundle is written using C#. Because a Java application
     (for example, a J2EE application) cannot load C# classes, you must deploy
     the C# bundles under a .NET connector server. The Java application can
     communicate with the C# connector server over the network, and the C#
     connector server acts as a proxy to provide access to the C# bundles that
     are deployed within the C# connector server, to any authenticated
     application.
    </p><p>
     The .NET connector server requires the .NET framework (version 4.0.30319
     or later) and is supported on Windows Server 2008 and 2008 R2.
    </p><p>
     By default, the connector server outputs log messages to a file named
     <code class="filename">connectorserver.log</code>, in the
     <code class="literal">C:\path\to\openicf</code> directory. To change the location of
     the log file, set the <code class="literal">initializeData</code> parameter in the
     configuration file, before you install the connector server. For example,
     the following excerpt sets the log directory to
     <code class="literal">C:\openicf\logs\connectorserver.log</code>.
    </p><pre class="brush: xml;">&lt;add name="file"
    type="System.Diagnostics.TextWriterTraceListener"
    initializeData="C:\openicf\logs\connectorserver.log"
    traceOutputOptions="DateTime"&gt;
      &lt;filter type="System.Diagnostics.EventTypeFilter" initializeData="Information"/&gt;
  &lt;/add&gt;</pre><div class="procedure"><a name="net-connector-install"></a><div class="procedure-title">Procedure&nbsp;10.1.&nbsp;Installing the .NET Connector Server</div><ol class="procedure" type="1"><li class="step"><p>
      Download the OpenICF .NET Connector Server from the <a class="link" href="http://forgerock.com/download-stack/" target="_blank">Open Stack download page</a>.
     </p><p>
      Click on the OpenIDM Download link on that page, and scroll down to
      "Connector Servers".
     </p><p>
      The .NET Connector Server is distributed in two formats. The
      <code class="literal">.msi</code> file is a wizard that installs the Connector
      Server as a Windows Service. The <code class="literal">.zip</code> file is simply a
      bundle of all the files required to run the Connector Server.
     </p><p>
      If you do not want to run the Connector Server as a Windows service,
      download and extract the <code class="literal">.zip</code> file, and move on to
      <a class="xref" href="#net-connector-configure" title="Procedure&nbsp;10.2.&nbsp;Configuring the .NET Connector Server">Procedure&nbsp;10.2, &#8220;Configuring the .NET Connector Server&#8221;</a>. Otherwise, follow the steps in
      this section.
     </p></li><li class="step"><p>
      Execute the <code class="literal">openicf-zip-1.4.0.0-dotnet.msi</code>
      installation file and complete the wizard.
     </p><p>
      When the wizard has completed, the Connector Server is installed as a
      Windows Service.
     </p></li><li class="step"><p>
      Open the Services console and make sure that the Connector Server
      is listed there.
     </p><p>
      The name of the service is <code class="literal">OpenICF Connector Server</code>, by
      default.
     </p><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/dotnet-service.png" align="middle" height="360" alt=".Net Connector Server as Windows Service"></td></tr></table></div></li></ol></div><div class="procedure"><a name="net-connector-configure"></a><div class="procedure-title">Procedure&nbsp;10.2.&nbsp;Configuring the .NET Connector Server</div><p>
     After you have installed the .NET Connector Server, as described in the
     previous section, follow these steps to configure the Connector Server.
    </p><ol class="procedure" type="1"><li class="step"><p>
      Make sure that the Connector Server is not currently running. If it is
      running, use the Services console to stop it.
     </p></li><li class="step"><p>
      At the command prompt, change to the directory where the Connector Server
      was installed.
     </p><div class="screen"><pre>c:\&gt; cd "c:\Program Files (x86)\Identity Connectors\Connector Server"</pre></div></li><li class="step"><a name="key-step"></a><p>
      Run the <span class="command"><strong>ConnectorServer /setkey</strong></span> command to set a secret
      key for the Connector Server. The key can be any string value. This
      example sets the secret key to <code class="literal">Passw0rd</code>.
     </p><div class="screen"><pre><strong>ConnectorServer /setkey Passw0rd</strong>
<em>Key Updated.</em></pre></div><p>
      This key is used by clients connecting to the Connector Server. The key
      that you set here must also be set in the OpenIDM connector info provider
      configuration file
      (<code class="literal">conf/provisioner.openicf.connectorinfoprovider.json</code>).
      For more information, see <a class="xref" href="#net-connector-openidm" title="Procedure&nbsp;10.4.&nbsp;Configuring OpenIDM to Connect to the .NET Connector Server">Procedure&nbsp;10.4, &#8220;Configuring OpenIDM to Connect to the .NET Connector Server&#8221;</a>.
     </p></li><li class="step"><p>
      Edit the Connector Server connection settings.
     </p><p>
      The Connector Server configuration is saved in a file named
      <code class="filename">ConnectorServer.exe.Config</code> (in the directory in which
      the Connector Server is installed).
     </p><p>
      Check and edit this file, as necessary, to reflect your installation. In
      particular, check the connection properties, under the
      <code class="literal">&lt;appsettings&gt;</code> item.
     </p><div class="screen"><pre>&lt;add key="connectorserver.port" value="8759" /&gt;
&lt;add key="connectorserver.usessl" value="false" /&gt;
&lt;add key="connectorserver.certificatestorename" value="ConnectorServerSSLCertificate" /&gt;
&lt;add key="connectorserver.ifaddress" value="0.0.0.0" /&gt;
&lt;add key="connectorserver.key" value="xOS4IeeE6eb/AhMbhxZEC37PgtE=" /&gt;
     </pre></div><div class="variablelist"><p>
       The following connection properties are set by default.
      </p><dl class="variablelist"><dt><span class="term"><code class="literal">connectorserver.port</code></span></dt><dd><p>
         Specifies the port on which the Connector Server listens.
        </p><div class="note"><h3 class="title">Note</h3><p>
          If Windows firewall is enabled, you must create an inbound port rule
          to open the TCP port for the connector server (8759 by default). If
          you do not open the TCP port, OpenIDM will be unable to contact the
          Connector Server. For more information, see the Microsoft
          documentation on
          <a class="link" href="http://technet.microsoft.com/en-us/library/cc947814(v=ws.10).aspx" target="_blank">creating an inbound port rule</a>.
         </p></div></dd><dt><span class="term"><code class="literal">connectorserver.usessl</code></span></dt><dd><p>
         Indicates whether client connections to the Connector Server should be
         over SSL. This property is set to <code class="literal">false</code> by default.
        </p><p>
         To secure connections to the Connector Server, set this property to
         <code class="literal">true</code> and store the server certificate in your
         certificate store, using the following command:
        </p><div class="screen"><pre>
ConnectorServer /storeCertificate /storeName &lt;certificate-store-name&gt; /certificateFile &lt;certificate&gt;</pre></div></dd><dt><span class="term"><code class="literal">connectorserver.certificatestorename</code></span></dt><dd><p>
         Specifies the name of the certificate store, into which your server
         certificate has been installed.
        </p></dd><dt><span class="term"><code class="literal">connectorserver.ifaddress</code></span></dt><dd><p>
         Specifies a single IP address from which connections will be accepted.
        </p><p>
         If you set a value here (other than the default
         <code class="literal">0.0.0.0</code>) connections from all IP addresses other
         than the one specified are denied.
        </p></dd></dl></div></li><li class="step"><p>
      Check the trace settings, in the same configuration file, under the
      <code class="literal">&lt;system.diagnostics&gt;</code> item.
     </p><div class="screen"><pre>&lt;system.diagnostics&gt;
  &lt;trace autoflush="true" indentsize="4"&gt;
    &lt;listeners&gt;
      &lt;remove name="Default" /&gt;
      &lt;add
          name="myListener"
          type="System.Diagnostics.TextWriterTraceListener"
          initializeData="c:\connectorserver.log"
          traceOutputOptions="DateTime"&gt;
          &lt;filter
            type="System.Diagnostics.EventTypeFilter"
            initializeData="Information" /&gt;
      &lt;/add&gt;
    &lt;/listeners&gt;
  &lt;/trace&gt;
&lt;/system.diagnostics&gt;
     </pre></div><p>
      The Connector Server uses the standard .NET trace mechanism. For more
      information about tracing options, see <a class="link" href="http://msdn.microsoft.com/en-us/library/15t15zda(v=vs.71).aspx" target="_blank">Microsoft's .NET documentation</a> for <code class="literal">System.Diagnostics</code>.
     </p><p>
      The default trace settings are a good starting point. For less tracing,
      you can change the EventTypeFilter's initializeData to "Warning" or
      "Error". For very verbose logging you can set the value to "Verbose" or
      "All". The level of logging performed has a direct effect on the
      performance of the Connector Servers, so take care when setting this
      level.
     </p></li></ol></div><div class="procedure"><a name="net-connector-start"></a><div class="procedure-title">Procedure&nbsp;10.3.&nbsp;Starting the .NET Connector Server</div><p>
     Start the .NET Connector Server in one of the following ways.
    </p><ol class="procedure" type="1"><li class="step"><p>
      Start the server as a Windows service, by using the Microsoft Services
      Console.
     </p><p>
      Locate the connector server service
      (<code class="literal">OpenICF Connector Server</code>), and click <code class="literal">Start
      the service</code> or <code class="literal">Restart the service</code>.
     </p><p>
      The service is executed with the credentials of the "run as" user
      (<code class="literal">System</code>, by default).
     </p></li><li class="step"><p>
      Start the server as a Windows service, by using the command line.
     </p><p>
      In the Windows Command Prompt, run the following command:
     </p><div class="screen"><pre>net start ConnectorServerService</pre></div><p>
      To stop the service in this manner, run the following command:
     </p><div class="screen"><pre>net stop ConnectorServerService</pre></div></li><li class="step"><p>
      Start the server without using Windows services.
     </p><p>
      In the Windows Command Prompt, change directory to the location where the
      Connector Server was installed. The default location is
      <code class="literal">c:\Program Files (x86)\Identity Connectors\Connector Server</code>.
     </p><p>
      Start the server with the following command:
     </p><div class="screen"><pre>ConnectorServer.exe /run</pre></div><p>
      Note that this command starts the Connector Server with the credentials of
      the current user. It does not start the server as a Windows service.
     </p></li></ol></div><div class="procedure"><a name="net-connector-openidm"></a><div class="procedure-title">Procedure&nbsp;10.4.&nbsp;Configuring OpenIDM to Connect to the .NET Connector Server</div><p>
     The connector info provider service enables you to configure one or more
     remote connector servers to which OpenIDM can connect. The connector info
     provider configuration is stored in a file named
     <code class="filename">openidm/conf/provisioner.openicf.connectorinfoprovider.json</code>.
     A sample connector info provider configuration file is located in
     <code class="literal">openidm/samples/provisioners/</code>.
    </p><p>
     To configure OpenIDM to use the remote .NET connector server, follow these
     steps:
    </p><ol class="procedure" type="1"><li class="step"><p>
      Start OpenIDM, if it is not already running.
     </p></li><li class="step"><p>
      Copy the sample connector info provider configuration file to the
      <code class="filename">path/to/openidm/conf</code> directory.
     </p><div class="screen"><pre>$ cd /path/to/openidm
$ cp samples/provisioners/provisioner.openicf.connectorinfoprovider.json conf/</pre></div></li><li class="step"><p>
      Edit the connector info provider configuration, specifying the details of
      the remote connector server.
     </p><pre class="brush: javascript;">"remoteConnectorServers" : [
        {
            "name" : "dotnet",
            "host" : "192.0.2.0",
            "port" : 8759,
            "useSSL" : false,
            "timeout" : 0,
            "key" : "Passw0rd"
        }
    ]
</pre><p>
      Configurable properties are as follows:
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">name</code></span></dt><dd><p>
         Specifies the name of the connection to the .NET connector server. The
         name can be any string. This property is referenced in the connector
         configuration file (<code class="filename">provisioner.openicf-ad.json</code>
         with the <code class="literal">"connectorHostRef"</code> property.
        </p></dd><dt><span class="term"><code class="literal">host</code></span></dt><dd><p>
         Specifies the IP address of the host on which the Connector Server is
         installed.
        </p></dd><dt><span class="term"><code class="literal">port</code></span></dt><dd><p>
         Specifies the port on which the Connector Server listens. This property
         matches the <code class="literal">connectorserver.port</code> property in the
         <code class="filename">ConnectorServer.exe.config</code> file.
        </p><p>
         For more information, see <a class="xref" href="#net-connector-configure" title="Procedure&nbsp;10.2.&nbsp;Configuring the .NET Connector Server">Procedure&nbsp;10.2, &#8220;Configuring the .NET Connector Server&#8221;</a>.
        </p></dd><dt><span class="term"><code class="literal">useSSL</code></span></dt><dd><p>
         Specifies whether the connection to the Connector Server should be
         secured. This property matches the
         <code class="literal">"connectorserver.usessl"</code> property in the
         <code class="filename">ConnectorServer.exe.config</code> file.
        </p></dd><dt><span class="term"><code class="literal">timeout</code></span></dt><dd><p>
         Specifies the length of time, in seconds, that OpenIDM should attempt
         to connect to the Connector Server before abandoning the attempt. To
         disable the timeout, set the value of this property to
         <code class="literal">0</code>.
        </p></dd><dt><span class="term"><code class="literal">key</code></span></dt><dd><p>
         Specifies the connector server key. This property matches the
         <code class="literal">key</code> property in the
         <code class="filename">ConnectorServer.exe.config</code> file. For more
         information, see <a class="xref" href="#net-connector-configure" title="Procedure&nbsp;10.2.&nbsp;Configuring the .NET Connector Server">Procedure&nbsp;10.2, &#8220;Configuring the .NET Connector Server&#8221;</a>.
        </p><p>
         The string value that you enter here is encrypted as soon as the file
         is saved.
        </p></dd></dl></div></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="install-standalone-connector"></a>10.4.2.&nbsp;Installing and Configuring a Remote Java Connector Server</h3></div></div></div><p>
    In certain situations, it might be necessary to set up a remote Java
    Connector Server. This section provides instructions for setting up a remote
    Java Connector Server on Unix/Linux and Windows.
   </p><div class="procedure"><a name="java-connector-server-unix"></a><div class="procedure-title">Procedure&nbsp;10.5.&nbsp;Installing a Remote Java Connector Server for Unix/Linux</div><ol class="procedure" type="1"><li class="step"><p>
      Download the OpenICF Java Connector Server from the <a class="link" href="http://forgerock.com/download-stack/" target="_blank">Open Stack download page</a>.
      </p><p>
       Click on the OpenIDM Download link on that page, and scroll down to
       "Connector Servers".
      </p></li><li class="step"><p>
       Change to the appropriate directory and unpack the zip file. The
       following command unzips the file in the current folder.
      </p><div class="screen"><pre>$ unzip openicf-zip-1.4.0.0.zip</pre></div></li><li class="step"><p>
        Change to the <code class="literal">openicf</code> directory:
       </p><div class="screen"><pre>$ cd path/to/openicf</pre></div></li><li class="step"><p>
        The Java Connector Server uses a <code class="literal">key</code> property to
        authenticate the connection. The default key value is
        <code class="literal">changeit</code>. To change the value of the secret key, run
        a command similar to the following. This example sets the key value to
        <code class="literal">Passw0rd</code>:
       </p><div class="screen"><pre><strong>$ cd /path/to/openicf
$ java \
 -cp "./lib/framework/*" \
 org.identityconnectors.framework.server.Main \
 -setKey
 -key Passw0rd
 -properties ./conf/ConnectorServer.properties</strong></pre></div></li><li class="step"><p>
        Review the <code class="filename">ConnectorServer.properties</code> file in the
        <code class="filename">/path/to/openicf/conf</code> directory, and make any
        required changes. By default, the configuration file has the following
        properties:
       </p><pre class="brush: plain;">connectorserver.port=8759
connectorserver.libDir=lib
connectorserver.usessl=false
connectorserver.bundleDir=bundles
connectorserver.loggerClass=org.forgerock.openicf.common.logging.slf4j.SLF4JLog
connectorserver.key=xOS4IeeE6eb/AhMbhxZEC37PgtE\=</pre><p>
        Indicates whether client connections to the connector server should be
        over SSL. This property is set to <code class="literal">false</code> by default.
        </p><p>
         To secure connections to the connector server, set this property to
         <code class="literal">true</code> and set the following properties before you
         start the connector server:
        </p><div class="screen"><pre>java -Djavax.net.ssl.keyStore=mySrvKeystore -Djavax.net.ssl.keyStorePassword=Passw0rd</pre></div></li><li class="step"><p>
        Start the Java Connector Server.
       </p><div class="screen"><pre><strong>$ java -cp "./lib/framework/*" \
 org.identityconnectors.framework.server.Main \
 -run \
 -properties ./conf/ConnectorServer.properties</strong></pre></div><p>
        The connector server is now running, and listening on port 8759, by
        default.
       </p><p>
        Log files are available in the <code class="literal">/path/to/openicf/logs</code>
        directory.
       </p><div class="screen"><pre><strong>$ ls logs/</strong>
<em>Connector.log  ConnectorServer.log  ConnectorServerTrace.log</em></pre></div></li><li class="step"><p>
        If required, stop the Java Connector Server by pressing CTRL-C.
       </p></li></ol></div><div class="procedure"><a name="java-connector-server-windows"></a><div class="procedure-title">Procedure&nbsp;10.6.&nbsp;Installing a Remote Java Connector Server for Windows</div><ol class="procedure" type="1"><li class="step"><p>
      Download the OpenICF Java Connector Server from the <a class="link" href="http://forgerock.com/download-stack/" target="_blank">Open Stack download page</a>.
      </p><p>
       Click on the OpenIDM Download link on that page, and scroll down to
       "Connector Servers".
      </p></li><li class="step"><p>
       Change to the appropriate directory and unpack the zip file.
     </p></li><li class="step"><p>
      In a Command Prompt window, change to the <code class="literal">openicf</code>
      directory:
     </p><div class="screen"><pre>C:\&gt;cd C:\path\to\openicf\bin</pre></div></li><li class="step"><p>
      If required, secure the communication between OpenIDM and the Java
      Connector Server. The Java Connector Server uses a
      <code class="literal">key</code> property to authenticate the connection. The
      default key value is <code class="literal">changeit</code>.
     </p><p>
      To change the value of the secret key, use the
      <code class="literal">bin\ConnectorServer.bat /setkey</code> command. The following
      example sets the key to <code class="literal">Passw0rd</code>:
     </p><div class="screen"><pre>c:\path\to\openicf&gt;<strong>bin\ConnectorServer.bat /setkey Passw0rd</strong>
<em>lib\framework\connector-framework.jar;lib\framework\connector-framework-internal
.jar;lib\framework\groovy-all.jar;lib\framework\icfl-over-slf4j.jar;lib\framewor
k\slf4j-api.jar;lib\framework\logback-core.jar;lib\framework\logback-classic.jar</em></pre></div></li><li class="step"><p>
        Review the <code class="filename">ConnectorServer.properties</code> file in the
        <code class="filename">path\to\openicf\conf</code> directory, and make any
        required changes. By default, the configuration file has the following
        properties:
       </p><pre class="brush: plain;">connectorserver.port=8759
connectorserver.libDir=lib
connectorserver.usessl=false
connectorserver.bundleDir=bundles
connectorserver.loggerClass=org.forgerock.openicf.common.logging.slf4j.SLF4JLog
connectorserver.key=xOS4IeeE6eb/AhMbhxZEC37PgtE\=</pre></li><li class="step"><p>
        You can either run the Java Connector Server as a Windows service, or
        just start and stop it from the command line.
       </p><ul class="stepalternatives">
        <li class="step"><p>
          To install the Java Connector Server as a Windows service, run the
          following command.
         </p><div class="screen"><pre>c:\path\to\openicf&gt;<strong>bin\ConnectorServer.bat /install</strong></pre></div><p>
          If you install the connector server as a Windows service you can use
          the Microsoft Service Console to start, stop and restart the service.
          The Java Connector Service is named
          <code class="literal">OpenICFConnectorServerJava</code>.
         </p><p>
          To uninstall the Java Connector Server as a Windows service, run the
          following command.
         </p><div class="screen"><pre>c:\path\to\openicf&gt;<strong>bin\ConnectorServer.bat /uninstall</strong></pre></div></li>
       </ul></li><li class="step"><p>
        To start the Java Connector Server from the command line, enter the
        following command:
       </p><div class="screen"><pre>c:\path\to\openicf&gt;<strong>bin\ConnectorServer.bat /run</strong>
<em>lib\framework\connector-framework.jar;lib\framework\connector-framework-internal
.jar;lib\framework\groovy-all.jar;lib\framework\icfl-over-slf4j.jar;lib\framework
\slf4j-api.jar;lib\framework\logback-core.jar;lib\framework\logback-classic.jar</em></pre></div><p>
        The connector server is now running, and listening on port 8759, by
        default.
       </p><p>
        Log files are available in the <code class="literal">\path\to\openicf\logs</code>
        directory.
       </p></li><li class="step"><p>
        If required, stop the Java Connector Server by pressing <code class="literal">^C</code>.
       </p></li></ol></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="connectors-with-openidm"></a>10.5.&nbsp;Connectors Supported With OpenIDM 3.0.0</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#xml-file-connector">10.5.1. XML File Connector</a></span></dt><dt><span class="section"><a href="#ldap-connector">10.5.2. Generic LDAP Connector</a></span></dt><dt><span class="section"><a href="#active-directory-connector">10.5.3. Active Directory Connector</a></span></dt><dt><span class="section"><a href="#csv-file-connector">10.5.4. CSV File Connector</a></span></dt><dt><span class="section"><a href="#scripted-sql-connector">10.5.5. Scripted SQL Connector</a></span></dt><dt><span class="section"><a href="#database-table-connector">10.5.6. Database Table Connector</a></span></dt><dt><span class="section"><a href="#groovy-connector">10.5.7. Groovy Connector</a></span></dt><dt><span class="section"><a href="#powershell-connector">10.5.8. Powershell Connector</a></span></dt></dl></div><p>
   OpenIDM 3.0.0 provides several connectors by default, in
   the <code class="literal">path/to/openidm/connectors</code> directory. Additional
   connectors can be downloaded from the <a class="link" href="http://forgerock.com/download-stack/" target="_blank">Open Stack download page</a>.
  </p><p>
   This section describes the connectors that are supported for use with OpenIDM
   3.0.0, and provides instructions for installing and
   configuring these connectors. For instructions on building connector
   configurations interactively, see <a class="xref" href="#connector-wiz" title="10.6.&nbsp;Creating Default Connector Configurations">Section&nbsp;10.6, &#8220;Creating Default Connector Configurations&#8221;</a>.
  </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="xml-file-connector"></a>10.5.1.&nbsp;XML File Connector</h3></div></div></div><p>
    A sample XML connector configuration is provided in
    <code class="filename">path/to/openidm/samples/provisioners/provisioner.openicf-xml.json</code>.
    The following extract of the provisioner configuration shows the main
    configurable properties.
   </p><pre class="brush: javascript;">
{
    "connectorRef": {
        "connectorHostRef": "#LOCAL",
        "bundleName": "org.forgerock.openicf.connectors.xml-connector",
        "bundleVersion": "[1.1,1.5]",
        "connectorName": "org.forgerock.openicf.connectors.xml.XMLConnector"
    }
}</pre><p>
    The <code class="literal">connectorHostRef</code> is optional if the connector server
    is local.
   </p><p>
    The configuration properties for the XML file connector set the relative
    path to the file containing the identity data, and also the paths to the
    required XML schemas.
   </p><pre class="brush: javascript;">{
    "configurationProperties": {
        "xsdIcfFilePath" : "&amp;{launcher.project.location}/data/resource-schema-1.xsd",
        "xsdFilePath" : "&amp;{launcher.project.location}/data/resource-schema-extension.xsd",
        "xmlFilePath" : "&amp;{launcher.project.location}/data/xmlConnectorData.xml"
    }
}</pre><p>
    <code class="literal">&amp;{launcher.project.location}</code> refers to the project
    directory of your OpenIDM instance. For more information, see <a href="../integrators-guide/index.html#config-default-directories" class="link"><em class="citetitle">Default and
    Custom Configuration Directories</em></a>. Note that
    relative paths such as these work only if your connector server runs
    locally. For remote connector servers, you must specify the absolute path to
    the schema and data files.
   </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">xsdIcfFilePath</span></dt><dd><p>
       References the XSD file defining schema common to all XML file resources.
       Do not change the schema defined in this file.
      </p></dd><dt><span class="term">xsdFilePath</span></dt><dd><p>
       References custom schema defining attributes specific to your project.
      </p></dd><dt><span class="term">xmlFilePath</span></dt><dd><p>
       References the XML file containing account entries.
      </p></dd></dl></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="example-xml-connector"></a>10.5.1.1.&nbsp;Example : Using the XML Connector to Reconcile Users in a Remote
    XML Data Store</h4></div></div></div><p>
     This sample demonstrates reconciliation of users stored in an XML file on a
     remote machine. The remote Java Connector Server enables OpenIDM to
     synchronize the internal OpenIDM repository with the remote XML repository.
    </p><h5><a name="d505e6461"></a>Before You Start</h5><p>
     This sample assumes that a remote Java Connector Server is installed and
     running on a host named <code class="literal">remote-host</code>. For instructions on
     setting up the remote Java Connector Server, see
     <a class="xref" href="#java-connector-server-unix" title="Procedure&nbsp;10.5.&nbsp;Installing a Remote Java Connector Server for Unix/Linux">Procedure&nbsp;10.5, &#8220;Installing a Remote Java Connector Server for Unix/Linux&#8221;</a> or
     <a class="xref" href="#java-connector-server-windows" title="Procedure&nbsp;10.6.&nbsp;Installing a Remote Java Connector Server for Windows">Procedure&nbsp;10.6, &#8220;Installing a Remote Java Connector Server for Windows&#8221;</a>.
    </p><p>
     The sample uses the XML data that is provided in the basic XML
     reconciliation sample (Sample 1). Before you start, copy the XML data from
     that sample to an accessible location on the machine that hosts the remote
     Java Connector Server. For example:
    </p><div class="screen"><pre><strong>$ cd path/to/openidm
 $ scp -r samples/sample1/data testuser@remote-host:/home/testuser/xml-sample</strong>
 <em>testuser@remote-host's password:
 resource-schema-1.xsd                    100% 4083     4.0KB/s   00:00
 resource-schema-extension.xsd            100% 1351     1.3KB/s   00:00
 xmlConnectorData.xml                     100% 1648     1.6KB/s   00:00</em></pre></div><p>
     The XML connector runs as a <span class="emphasis"><em>remote connector</em></span>, that is,
     on the remote host on which the Java Connector Server is installed. Copy
     the XML connector .jar from the OpenIDM installation to the
     <code class="literal">openicf/bundles</code> directory on the remote host.
    </p><div class="screen"><pre><strong>$ cd path/to/openidm
 $ scp connectors/xml-connector-1.4.0.0.jar testuser@remote-host:/path/to/openicf/bundles</strong>
 <em>testuser@172.16.203.97's password:
 xml-connector-1.4.0.0.jar                100% 4379KB   4.3MB/s   00:00</em></pre></div><div class="procedure"><a name="d505e6494"></a><div class="procedure-title">Procedure&nbsp;10.7.&nbsp;Configuring OpenIDM for the XML Connector Example</div><p>
      This example uses the configuration of Sample 1, which is effectively
      your OpenIDM project location. Any configuration changes that you make
      must therefore be made in the <code class="literal">conf</code> directory of
      <code class="literal">sample1</code>.
     </p><ol class="procedure" type="1"><li class="step"><p>
       Copy the remote connector configuration file
       (<code class="filename">provisioner.openicf.connectorinfoprovider.json</code>) from
       the provisioner samples directory to the configuration directory of your
       OpenIDM project (sample 1).
      </p><div class="screen"><pre>$ cd path/to/openidm/samples/
 $ cp provisioners/provisioner.openicf.connectorinfoprovider.json sample1/conf</pre></div></li><li class="step"><p>
       Edit the remote connector configuration file
       (<code class="literal">provisioner.openicf.connectorinfoprovider.json</code>) to
       match your network setup. Also, change the value of the
       <code class="literal">"connectorsLocation"</code> property to
       <code class="literal">"bundles"</code>, as this is where the connector will be
       installed on the remote host.
      </p><p>
       The following example indicates that the remote Java Connector server is
       running on the host <code class="literal">remote-host</code>, listening on the default
       port, and configured with a secret key of <code class="literal">Passw0rd</code>.
      </p><pre class="brush: plain;">{
     "connectorsLocation" : "bundles",
     "remoteConnectorServers" : [
         {
             "name" : "xml",
             "host" : "remote-host",
             "port" : 8759,
             "useSSL" : false,
             "timeout" : 0,
             "key" : "Passw0rd"
         }
     ]
 }</pre></li><li class="step"><p>
       Edit the XML connector configuration file
       (<code class="literal">provisioner.openicf-xml.json</code>) in the
       <code class="literal">sample1/conf</code> directory as follows.
      </p><pre class="brush: plain;">{
     "name" : "xmlfile",
     "connectorRef" : {
         "connectorHostRef" : "xml",
         "bundleName" : "org.forgerock.openicf.connectors.file.openicf-xml-connector",
         "bundleVersion" : "[1.1,1.5]",
         "connectorName" : "org.forgerock.openicf.connectors.xml.XMLConnector"
     },
     "configurationProperties" : {
         "xsdIcfFilePath" : "/home/testuser/xml-sample/data/resource-schema-1.xsd",
         "xsdFilePath" : "/home/testuser/xml-sample/data/resource-schema-extension.xsd",
         "xmlFilePath" : "/home/testuser/xml-sample/data/xmlConnectorData.xml"
     },
 }</pre></li><li class="step"><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
         The <code class="literal">"connectorHostRef"</code> property indicates which
         remote connector server to use, and refers to the
         <code class="literal">"name"</code> property defined in the
         <code class="filename">provisioner.openicf.connectorinfoprovider.json</code> file.
        </p></li><li class="listitem"><p>
         The <code class="filename">bundleVersion : [1.1,1.5]</code>
         must be exactly the same as the version of the XML connector that you
         are using. If you specify a range here, the XML connector version must
         be included in this range.
        </p></li><li class="listitem"><p>
         The <code class="literal">"configurationProperties"</code> must specify the
         absolute path to the data files that you copied to the server on which
         the Java Connector Server is running.
        </p></li></ul></div></li><li class="step"><p>
       Start OpenIDM with the configuration for Sample 1.
      </p><div class="screen"><pre>$ ./startup.sh -p samples/sample1/</pre></div></li><li class="step"><p>
       In the Felix console, run the following command to show the state of the
       remote connector:
      </p><div class="screen"><pre><strong>-&gt; scr list</strong>
 <em>...
 [22] [active] org.forgerock.openidm.provisioner.openicf
 ...</em></pre></div><p>
       The connector module (<code class="literal">org.forgerock.openidm.provisioner.openicf</code>)
       should be <code class="literal">active</code>, indicating that the remote connector
       has been installed correctly. If the connector state is not
       <code class="literal">active</code>, check the configuration, following the
       preceding steps.
      </p><p>
       The number of the connector module might differ. Make a note of the number
       returned.
      </p></li><li class="step"><p>
       View the configuration of the remote connector, by running the following
       command, substituting the number of the provisioner module returned in the
       previous step:
      </p><div class="screen"><pre>-&gt; scr info 22</pre></div></li><li class="step"><p>
       To test that the connector has been configured correctly, run a
       reconciliation operation as follows:
      </p><div class="screen"><pre>$ curl \
  --cacert self-signed.crt \
  --header "X-OpenIDM-Username: openidm-admin" \
  --header "X-OpenIDM-Password: openidm-admin" \
  --header "Content-Type: application/json" \
  --request POST \
  "https://localhost:8443/openidm/recon?_action=recon&amp;mapping=systemXmlfileAccounts_managedUser"</pre></div><p>
       If successful, the operation returns a reconciliation ID, similar to the
       following:
      </p><div class="screen"><pre>{"_id":"a5346543-db9a-4f8b-ba25-af2a1b576a54"}</pre></div></li><li class="step"><p>
       To verify that the users from the remote XML files have been created in
       the OpenIDM repository, run the following command:
      </p><div class="screen"><pre><strong>$ curl \
  --cacert self-signed.crt \
  --header "X-OpenIDM-Username: openidm-admin" \
  --header "X-OpenIDM-Password: openidm-admin" \
  --request GET \
  "https://localhost:8443/openidm/managed/user/?_queryId=query-all-ids"</strong>
 <em>{
   "remainingPagedResults": -1,
   "pagedResultsCookie": null,
   "resultCount": 2,
   "result": [
     {
       "_rev": "0",
       "_id": "bjensen"
     },
     {
       "_rev": "0",
       "_id": "scarter"
     }
   ]
 }</em>
      </pre></div></li></ol></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="ldap-connector"></a>10.5.2.&nbsp;Generic LDAP Connector</h3></div></div></div><p>
    A sample LDAP connector configuration is provided in
    <code class="filename">path/to/openidm/samples/provisioners/provisioner.openicf-ldap.json</code>.
    The following extract of the provisioner configuration shows the main
    configurable properties.
   </p><p>
    The following excerpt shows the <code class="literal">connectorRef</code>
    configuration property for connection to an LDAP server. The
    <code class="literal">connectorHostRef</code> property is optional, if you use the
    connector .jar provided in <code class="filename">openidm/connectors</code>, and you
    use a local connector server.
   </p><pre class="brush: javascript;">
{
    "connectorRef": {
        "connectorHostRef": "#LOCAL",
        "connectorName": "org.identityconnectors.ldap.LdapConnector",
        "bundleName": "org.forgerock.openicf.connectors.ldap-connector",
        "bundleVersion": "[1.1,1.5]"
    }
}</pre><p>
    The following excerpt shows the settings for the connector configuration
    properties in the sample LDAP connector.
   </p><pre class="brush: javascript;">
"configurationProperties" : {
    "host" : "localhost",
    "port" : 1389,
    "ssl" : false,
    "principal" : "cn=Directory Manager",
    "credentials" : "password",
    "baseContexts" : [
        "dc=example,dc=com"
    ],
    "baseContextsToSynchronize" : [
        "dc=example,dc=com"
    ],
    "accountSearchFilter" : null,
    "accountSynchronizationFilter" : null,
    "groupSearchFilter" : null,
    "groupSynchronizationFilter" : null,
    "passwordAttributeToSynchronize" : null,
    "synchronizePasswords" : false,
    "removeLogEntryObjectClassFromFilter" : true,
    "modifiersNamesToFilterOut" : [ ],
    "passwordDecryptionKey" : null,
    "changeLogBlockSize" : 100,
    "attributesToSynchronize" : [ ],
    "changeNumberAttribute" : "changeNumber",
    "passwordDecryptionInitializationVector" : null,
    "filterWithOrInsteadOfAnd" : false,
    "objectClassesToSynchronize" : [
        "inetOrgPerson"
    ],
    "vlvSortAttribute" : "uid",
    "passwordAttribute" : "userPassword",
    "useBlocks" : false,
    "maintainPosixGroupMembership" : false,
    "failover" : [ ],
    "readSchema" : true,
    "accountObjectClasses" : [
        "top",
        "person",
        "organizationalPerson",
        "inetOrgPerson"
    ],
    "accountUserNameAttributes" : [
        "uid"
    ],
    "groupMemberAttribute" : "uniqueMember",
    "passwordHashAlgorithm" : null,
    "usePagedResultControl" : false,
    "blockSize" : 100,
    "uidAttribute" : "dn",
    "maintainLdapGroupMembership" : false,
    "respectResourcePasswordPolicyChangeAfterReset" : false
},</pre><div class="variablelist"><dl class="variablelist"><dt><span class="term">host</span></dt><dd><p>
       The host name or IP address of the server on which the LDAP instance is
       running.
      </p></dd><dt><span class="term">port</span></dt><dd><p>
       The port on which the LDAP server listens for LDAP requests. The sample
       configuration specifies a default port of 1389.
      </p></dd><dt><span class="term">ssl</span></dt><dd><p>
       If <code class="literal">true</code>, the specified port listens for LDAPS
       connections.
      </p></dd><dt><span class="term">principal</span></dt><dd><p>
       The bind DN that is used to connect to the LDAP server.
      </p></dd><dt><span class="term">credentials</span></dt><dd><p>
       The password of the <code class="literal">principal</code> that is used to connect
       to the LDAP server.
      </p></dd><dt><span class="term">baseContexts</span></dt><dd><p>
       One or more starting points in the LDAP tree that will be used when
       searching the tree. Searches are performed when discovering users from
       the LDAP server or when looking for the groups of which a user is a
       member.
      </p></dd><dt><span class="term">baseContextsToSynchronize</span></dt><dd><p>
       One or more starting points in the LDAP tree that will be used to
       determine if a change should be synchronized. The base contexts attribute
       will be used to synchronize a change if this property is not set.
      </p></dd><dt><span class="term">accountSynchronizationFilter</span></dt><dd><p>Used during synchronization actions to filter out LDAP
      accounts</p></dd><dt><span class="term">accountObjectClasses</span></dt><dd><p>The object classes used when creating new LDAP user objects.
      When specifying more than one object class, add each object class as its
      own property. For object classes that inherit from parents other than
      <code class="literal">top</code>, such as <code class="literal">inetOrgPerson</code>, specify
      all object classes in the class hierarchy.</p></dd><dt><span class="term">accountSearchFilter</span></dt><dd><p>Search filter that accounts must match</p></dd><dt><span class="term">accountUserNameAttributes</span></dt><dd><p>Attributes holding the account's user name. Used during
      authentication to find the LDAP entry matching the user name.</p></dd><dt><span class="term">attributesToSynchronize</span></dt><dd><p>List of attributes used during object synchronization. OpenIDM
      ignores change log updates that do not include any of the specified
      attributes. If empty, OpenIDM considers all changes.</p></dd><dt><span class="term">blockSize</span></dt><dd><p>Block size for simple paged results and VLV index searches,
      reflecting the maximum number of accounts retrieved at any one time</p></dd><dt><span class="term">changeLogBlockSize</span></dt><dd><p>Block size used when fetching change log entries</p></dd><dt><span class="term">changeNumberAttribute</span></dt><dd><p>Change log attribute containing the last change number</p></dd><dt><span class="term">failover</span></dt><dd><p>LDAP URLs specifying alternative LDAP servers to connect to if
      OpenIDM cannot connect to the primary LDAP server specified in the
      <code class="literal">host</code> and <code class="literal">port</code> properties</p></dd><dt><span class="term">filterWithOrInsteadOfAnd</span></dt><dd><p>In most cases, the filter to fetch change log entries is AND-based.
      If this property is set, the filter ORs the required change numbers
      instead.</p></dd><dt><span class="term">groupMemberAttribute</span></dt><dd><p>LDAP attribute holding members for non-POSIX static groups</p></dd><dt><span class="term">maintainLdapGroupMembership</span></dt><dd><p>If <code class="literal">true</code>, OpenIDM modifies group membership when
      entries are renamed or deleted.</p><p>In the sample LDAP connector configuration file provided with
      OpenIDM, this property is set to <code class="literal">false</code>. This means
      that LDAP group membership is not modified when entries are renamed or
      deleted in OpenIDM. To ensure that entries are removed from LDAP groups
      when the entries are deleted, set this property to <code class="literal">true</code>
      or enable referential integrity on the LDAP server. For OpenDJ, see
      <a class="link" href="http://docs.forgerock.org/en/opendj/2.6.0/admin-guide/index.html#referential-integrity" target="_top">
      <em class="citetitle">Configuring Referential Integrity</em></a> for more
      information.</p></dd><dt><span class="term">maintainPosixGroupMembership</span></dt><dd><p>If <code class="literal">true</code>, OpenIDM modifies POSIX group membership
      when entries are renamed or deleted.</p></dd><dt><span class="term">modifiersNamesToFilterOut</span></dt><dd><p>Use to avoid loops caused by OpenIDM's own changes</p></dd><dt><span class="term">objectClassesToSynchronize</span></dt><dd><p>OpenIDM synchronizes only entries having these object
      classes.</p></dd><dt><span class="term">passwordAttribute</span></dt><dd><p>Attribute to which OpenIDM writes the predefined PASSWORD
      attribute</p></dd><dt><span class="term">passwordAttributeToSynchronize</span></dt><dd><p>OpenIDM synchronizes password values on this attribute.</p></dd><dt><span class="term">passwordDecryptionInitializationVector</span></dt><dd><p>Initialization vector used to decrypt passwords when performing
      password synchronization</p></dd><dt><span class="term">passwordDecryptionKey</span></dt><dd><p>Key used to decrypt passwords when performing password
      synchronization</p></dd><dt><span class="term">passwordHashAlgorithm</span></dt><dd><p>
       Hash password values with the specified algorithm, if the LDAP server
       stores them in clear text.
      </p><div class="itemizedlist"><p>
        The hash algorithm can be one of the following:
       </p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
         <code class="literal">NONE</code> - Clear text
        </p></li><li class="listitem"><p>
         <code class="literal">WIN-AD</code> - Used for password changes to Active
         Directory
        </p></li><li class="listitem"><p>
         <code class="literal">SHA</code> - Secure Hash Algorithm
        </p></li><li class="listitem"><p>
         <code class="literal">SHA-1</code> - A 160-bit hash algorithm that resembles the
         MD5 algorithm
        </p></li><li class="listitem"><p>
         <code class="literal">SSHA</code> - Salted SHA
        </p></li><li class="listitem"><p>
         <code class="literal">MD5</code> - A 128-bit message-digest algorithm
        </p></li><li class="listitem"><p>
         <code class="literal">SMD5</code> - Salted MD5
        </p></li></ul></div></dd><dt><span class="term">readSchema</span></dt><dd><p>If <code class="literal">true</code>, read LDAP schema from the LDAP
      server.</p></dd><dt><span class="term">removeLogEntryObjectClassFromFilter</span></dt><dd><p>If <code class="literal">true</code>, the filter to fetch change log entries
      does not contain the <code class="literal">changeLogEntry</code> object class, and
      OpenIDM expects no entries with other object types in the change log.
      Default: <code class="literal">true</code></p></dd><dt><span class="term">respectResourcePasswordPolicyChangeAfterReset</span></dt><dd><p>If <code class="literal">true</code>, bind with the Password Expired and
      Password Policy controls, and throw
      <code class="literal">PasswordExpiredException</code> and other exceptions
      appropriately.</p></dd><dt><span class="term">synchronizePasswords</span></dt><dd><p>If <code class="literal">true</code>, synchronize passwords.</p></dd><dt><span class="term">uidAttribute</span></dt><dd><p>
       Specifies the LDAP attribute that should be used as the immutable ID
       (<code class="literal">_UID_</code>) for the entry. For an OpenDJ resource, you
       should use the <code class="literal">entryUUID</code>. You can use the
       <code class="literal">DN</code> as the UID attribute but note that this is
       <span class="emphasis"><em>not</em></span> immutable.
      </p></dd><dt><span class="term">useBlocks</span></dt><dd><p>If <code class="literal">true</code>, use block-based LDAP controls like
      simple paged results and virtual list view.</p></dd><dt><span class="term">usePagedResultControl</span></dt><dd><p>If <code class="literal">true</code>, use simple paged results rather than
      virtual list view when both are available.</p></dd><dt><span class="term">useTimestampsForSync</span></dt><dd><p>
       If <code class="literal">true</code>, use timestamps for LiveSync operations,
       instead of the change log.
      </p><p>
       By default, the LDAP connector has a change log strategy for LDAP servers
       that support a change log (such as OpenDJ and Oracle Directory Server
       Enterprise Edition). If the LDAP server does not support a change log,
       or if the change log is disabled, LiveSync for create and modify
       operations can still occur, based on the timestamps of modifications.
      </p></dd><dt><span class="term">vlvSortAttribute</span></dt><dd><p>Attribute used as the sort key for virtual list view</p></dd></dl></div><p>
    If you use the LDAP connector over SSL, you must set the
    <code class="literal">ssl</code> property to <code class="literal">true</code> in the provisioner
    configuration file. You must also specify the path to a truststore in the
    <code class="filename">system.properties</code> file. A truststore is provided by
    default at <code class="filename">openidm/security/truststore</code>. Add the
    following line to the <code class="filename">system.properties</code> file,
    substituting the path to your own truststore if you do not want to use the
    default.
   </p><pre class="brush: plain;">
# Set the truststore
javax.net.ssl.trustStore=/path/to/openidm/security/truststore
   </pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="active-directory-connector"></a>10.5.3.&nbsp;Active Directory Connector</h3></div></div></div><p>
    Unlike most other connectors, the Active Directory connector is written not
    in Java, but in C# for the .Net platform. OpenICF should connect to Active
    Directory over ADSI, the native connection protocol for Active Directory.
    The connector therefore requires a connector server that has access to the
    ADSI .dll files.
   </p><p>
    Before you configure the Active Directory Connector, make sure that the
    .NET Connector Server is installed, configured and started, and that OpenIDM
    has been configured to use the Connector Server. For more information, see
    <a class="xref" href="#install-.net-connector" title="10.4.1.&nbsp;Installing and Configuring a .NET Connector Server">Section&nbsp;10.4.1, &#8220;Installing and Configuring a .NET Connector Server&#8221;</a>.
   </p><div class="procedure"><a name="d505e7018"></a><div class="procedure-title">Procedure&nbsp;10.8.&nbsp;Setting Up the Active Directory Connector</div><ol class="procedure" type="1"><li class="step"><p>
      Download the Active Directory Connector from the OpenIDM download
      page under the ForgeRock <a class="link" href="http://forgerock.com/download-stack/" target="_blank">Open Stack download page</a>.
      </p></li><li class="step"><p>
       Extract the contents of the AD Connector zip file into the directory in
       which you installed the Connector Server (by default
       <code class="literal">c:\Program Files (x86)\Identity Connectors\Connector Server&gt;</code>).
      </p><p>
       Note that the files, specifically the connector itself
       (<code class="filename">ActiveDirectory.Connector.dll</code>) must be directly
       under the <code class="literal">path\to\Identity Connectors\Connector Server</code>
       folder, and <span class="emphasis"><em>not</em></span> in a subfolder.
      </p><div class="note"><h3 class="title">Note</h3><p>
        If the account that is used to install the Active Directory connector is
        different from the account under which the Connector Server runs, you
        must give the Connector Server runtime account the rights to access the
        Active Directory connector log files.
       </p></div></li><li class="step"><p>
       A sample Active Directory Connector configuration file is provided in
       <code class="filename">path/to/opendim/samples/provisioners/provisioner.openicf-ad.json</code>.
       On the OpenIDM host, copy the sample Active Directory connector
       configuration file to the <code class="filename">openidm/conf</code> directory.
      </p><div class="screen"><pre>$ cd /path/to/openidm
$ cp samples/provisioners/provisioner.openicf-ad.json conf/</pre></div></li><li class="step"><p>
       Edit the Active Directory connector configuration to match your Active
       Directory deployment.
      </p><p>
       Specifically, check and edit the
       <code class="literal">"configurationProperties"</code> that define the connection
       details to the Active Directory server.
      </p><p>
       Also, check that the <code class="literal">bundleVersion</code> of the connector
       matches the version of the <code class="filename">ActiveDirectory.Connector.dll</code>
       in the Connector Server directory. The bundle version can be a range that
       includes the version of the connector bundle. To check the .dll version:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
         Right click on the <code class="literal">ActiveDirectory.Connector.dll</code>
         file and select Properties.
        </p></li><li class="listitem"><p>
         Select the Details tab and note the Product Version.
        </p><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/bundle-version.png" align="middle" height="360" alt="Bundle version of the Active Directory Connector"></td></tr></table></div></li></ul></div><p>
       The following configuration extract shows sample values for the
       <code class="literal">"connectorRef"</code> and
       <code class="literal">"configurationProperties"</code>:
      </p><pre class="brush: plain;">...
"connectorRef" :
   {
      "connectorHostRef" : "dotnet",
      "connectorName" : "Org.IdentityConnectors.ActiveDirectory.ActiveDirectoryConnector",
      "bundleName" : "ActiveDirectory.Connector",
      "bundleVersion" : "1.4.0.0"
   },          ...
"configurationProperties" :
   {
      "DirectoryAdminName" : "EXAMPLE\\Administrator",
      "DirectoryAdminPassword" : "Passw0rd",
      "ObjectClass" : "User",
      "Container" : "dc=example,dc=com",
      "CreateHomeDirectory" : true,
      "LDAPHostName" : "192.0.2.0",
      "SearchChildDomains" : false,
      "DomainName" : "example",
      "SyncGlobalCatalogServer" : null,
      "SyncDomainController" : null,
      "SearchContext" : ""
   },
      </pre><p>
       The main configurable properties are as follows:
      </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">"connectorHostRef"</code></span></dt><dd><p>
          Must point to an existing connector info provider configuration in
          <code class="filename">openidm/conf/provisioner.openicf.connectorinfoprovider.json</code>.
          The <code class="literal">"connectorHostRef"</code> property is required because
          the Active Directory connector must be installed on a .NET connector
          server, which is always "remote", relative to OpenIDM.
         </p></dd><dt><span class="term"><code class="literal">"DirectoryAdminName"</code> and <code class="literal">"DirectoryAdminPassword"</code></span></dt><dd><p>
         Specify the credentials of an administrator account in Active Directory,
         that the connector will use to bind to the server.
        </p><p>
         The <code class="literal">"DirectoryAdminName"</code> can be specified as a
         bindDN, or in the format
         <code class="literal"><em class="replaceable"><code>DomainName</code></em>\\<em class="replaceable"><code>samaccountname</code></em></code>.
        </p></dd><dt><span class="term"><code class="literal">"SearchChildDomains"</code> boolean, false by default</span></dt><dd><p>
         Specifies if a Global Catalog (GC) should be used. This parameter is
         used in search and query operations. A Global Catalog is a read-only,
         partial copy of the entire forest, and is never be used for create,
         update or delete operations.
        </p></dd><dt><span class="term"><code class="literal">"LDAPHostName"</code></span></dt><dd><p>
         Specifies a particular Domain Controller (DC) or Global Catalog (GC),
         using its hostname. This parameter is used for query, create, update,
         and delete operations.
        </p><p>
         If <code class="literal">"SearchChildDomains"</code> is set to
         <code class="literal">true</code>, this specific GC will be used for search and
         query operations. If the <code class="literal">"LDAPHostName"</code> is null (as
         it is by default), the connector will allow the ADSI libraries to pick
         up a valid DC or GC each time it needs to perform a query, create,
         update, or delete operation.
        </p></dd><dt><span class="term"><code class="literal">"SyncGlobalCatalogServer"</code></span></dt><dd><p>
         Specifies a Global Catalog server name for sync operations. This
         property is used in combination with the
         <code class="literal">"SearchChildDomains"</code> property.
        </p><p>
         If a value for <code class="literal">"SyncGlobalCatalogServer"</code> is set
         (that is, the value is not <code class="literal">null</code>) and
         <code class="literal">"SearchChildDomains"</code> is set to
         <code class="literal">true</code>, this GC server is used
         for sync operations. If no value for
         <code class="literal">"SyncGlobalCatalogServer"</code> is set and
         <code class="literal">"SearchChildDomains"</code> is set to
         <code class="literal">true</code>, the connector allows the ADSI libraries to
         pick up a valid GC.
        </p></dd><dt><span class="term"><code class="literal">"SyncDomainController"</code></span></dt><dd><p>
         Specifies a particular DC server for sync operations. If no DC is
         specified, the connector picks up the first available DC and retains
         this DC in future sync operations.
        </p></dd></dl></div><p>
       For a complete list of all the configuration properties, and their
       meanings, see the <em class="citetitle">OpenICF Connectors Configuration
       Reference</em>.
      </p><p>The updated configuration is applied immediately.</p></li><li class="step"><p>
       Check that the connector has been configured correctly by running the
       following command in the OSGi console:
      </p><div class="screen"><pre>scr list</pre></div><p>
       This command returns all of the installed modules. The openicf
       provisioner module should be active, as follows:
      </p><div class="screen"><pre>[32] [active] org.forgerock.openidm.provisioner.openicf.connectorinfoprovider</pre></div><p>
       The number of the module may differ. Make a note of the module number,
       as it is referenced in the commands that follow.
      </p></li><li class="step"><p>
       Review the contents of the connector by running the following command in
       the OSGi console (substituting the module number returned in the previous
       step):
      </p><div class="screen"><pre><strong>scr info 32</strong>
<em>ID: 32
Name: org.forgerock.openidm.provisioner.openicf.connectorinfoprovider
Bundle: org.forgerock.openidm.provisioner-openicf (82)
State: active
Default State: enabled
Activation: immediate
Configuration Policy: optional
Activate Method: activate (declared in the descriptor)
Deactivate Method: deactivate (declared in the descriptor)
Modified Method: -
Services: org.forgerock.openidm.provisioner.openicf.ConnectorInfoProvider
          org.forgerock.openidm.metadata.MetaDataProvider
          org.forgerock.openidm.provisioner.ConfigurationService
Service Type: service
Reference: osgiConnectorEventPublisher
    Satisfied: satisfied
    Service Name: org.identityconnectors.common.event.ConnectorEventPublisher
    Multiple: multiple
    Optional: optional
    Policy: dynamic
Reference: connectorInfoManager
    Satisfied: satisfied
    Service Name: org.identityconnectors.framework.api.ConnectorInfoManager
    Multiple: single
    Optional: optional
    Policy: static
Reference: connectorFacadeFactory
    Satisfied: satisfied
    Service Name: org.identityconnectors.framework.api.ConnectorFacadeFactory
    Multiple: single
    Optional: optional
    Policy: static
Properties:
    component.id = 32
    component.name = org.forgerock.openidm.provisioner.openicf.connectorinfoprovider
    felix.fileinstall.filename = file:/openidm/conf/provisioner.openicf.connectorinfoprovider.json
    jsonconfig = {
    "connectorsLocation" : "connectors",
    "remoteConnectorServers" : [
        {
            "name" : "dotnet",
            "host" : "192.0.2.0",
            "port" : 8759,
            "useSSL" : false,
            "timeout" : 0,
            "key" : {
                "$crypto" : {
                    "value" : {
                        "iv" : "3XpjsLV1YNP034Rt/6BZgg==",
                        "data" : "8JXxpoRJjYGFkRVHvTwGTA==",
                        "cipher" : "AES/CBC/PKCS5Padding",
                        "key" : "openidm-sym-default"
                    },
                    "type" : "x-simple-encryption"
                }
            }
        }
    ]
}
    service.description = OpenICF Connector Info Service
    service.pid = org.forgerock.openidm.provisioner.openicf.connectorinfoprovider
    service.vendor = ForgeRock AS.</em>
      </pre></div></li><li class="step"><p>
       The connector is now configured. To verify the configuration, perform a
       RESTful GET request on the remote system URL, for example:
      </p><div class="screen"><pre>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/system/ActiveDirectory/account?_queryId=query-all-ids"</pre></div><p>
       This request should return the user accounts in the Active Directory
       server.
      </p></li><li class="step"><p>
       To configure reconciliation or liveSync between OpenIDM and Active
       Directory, create a synchronization configuration file
       (<code class="filename">sync.json</code>) in the <code class="literal">openidm/conf</code>
       directory.
      </p><p>
       The synchronization configuration file defines the attribute mappings and
       policies that are used during reconciliation.
      </p><p>
       The following is a simple example of a <code class="filename">sync.json</code>
       file for Active Directory.
      </p><div class="screen"><pre>{
    "mappings" : [
        {
            "name" : "systemADAccounts_managedUser",
            "source" : "system/ActiveDirectory/account",
            "target" : "managed/user",
            "properties" : [
                { "source" : "cn", "target" : "displayName" },
                { "source" : "description", "target" : "description" },
                { "source" : "givenName", "target" : "givenName" },
                { "source" : "mail", "target" : "email" },
                { "source" : "sn", "target" : "familyName" },
                { "source" : "sAMAccountName", "target" : "userName" }
            ],
            "policies" : [
                { "situation" : "CONFIRMED", "action" : "UPDATE" },
                { "situation" : "FOUND", "action" : "UPDATE" },
                { "situation" : "ABSENT", "action" : "CREATE" },
                { "situation" : "AMBIGUOUS", "action" : "EXCEPTION" },
                { "situation" : "MISSING", "action" : "UNLINK" },
                { "situation" : "SOURCE_MISSING", "action" : "DELETE" },
                { "situation" : "UNQUALIFIED", "action" : "DELETE" },
                { "situation" : "UNASSIGNED", "action" : "DELETE" }
            ]
        }
    ]
}</pre></div></li><li class="step"><p>
       To test the synchronization, run a reconciliation operation by running
       the following command.
      </p><div class="screen"><pre>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 "https://localhost:8443/openidm/recon?_action=recon&amp;mapping=systemADAccounts_managedUser"</pre></div><p>
       If reconciliation is successful, the command returns a reconciliation run
       ID, similar to the following:
      </p><div class="screen"><pre>{"_id":"0629d920-e29f-4650-889f-4423632481ad"}</pre></div></li><li class="step"><p>
       Query the internal repository, using either a <span class="command"><strong>curl</strong></span>
       command, or the OpenIDM UI, to make sure that the users in your Active
       Directory server were provisioned into the repository.
      </p></li></ol></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="ad-powershell"></a>10.5.3.1.&nbsp;Using PowerShell Scripts With the Active Directory Connector</h4></div></div></div><p>
      The Active Directory connector supports PowerShell scripting. The
      following example shows a simple PowerShell script that is referenced in
      the connector configuration and can be called over the REST interface.
     </p><p>
      This PowerShell script creates a new MS SQL user with a username that is
      specified when the script is called. The script sets the user's password
      to <code class="literal">Passw0rd</code> and, optionally, gives the user a role.
      Save this script as <code class="filename">openidm/script/createUser.ps1</code>.
     </p><div class="note"><h3 class="title">Note</h3><p>
       External script execution is disabled on system endpoints by default. For
       testing purposes, you can enable script execution over REST, on system
       endpoints by adding the <code class="literal">script</code> action to the system
       object, in the <code class="filename">access.js</code> file. For example:
      </p><div class="screen"><pre><strong>$ more /path/to/openidm/script/access.js</strong>
       <em>...
{
    "pattern"   : "system/ActiveDirectory",
    "roles"     : "openidm-admin",
    "methods" : "action",
    "actions"   : "script"
},     </em></pre></div><p>
       Be aware that scripts passed to clients imply a security risk in
       production environments. If you need to expose a script for direct
       external invocation, it might be better to write a custom authorization
       function to constrain the script ID that is permitted. Alternatively, do
       not expose the script action for external invocation, and instead,
       expose a custom endpoint that can make only the desired script calls. For
       more information on using custom endpoints, see <a href="../integrators-guide/index.html#adding-custom-endpoints" class="link"><em class="citetitle">Adding Custom
       Endpoints</em></a>.
      </p></div><pre class="brush: plain;">
     if ($loginName -ne $NULL) {
  [System.Reflection.Assembly]::LoadWithPartialName('Microsoft.SqlServer.SMO') | Out-Null
  $sqlSrv = New-Object ('Microsoft.SqlServer.Management.Smo.Server') ('WIN-C2MSQ8G1TCA')

  $login = New-Object -TypeName ('Microsoft.SqlServer.Management.Smo.Login') ($sqlSrv, $loginName)
  $login.LoginType = 'SqlLogin'
  $login.PasswordExpirationEnabled = $false
  $login.Create('Passw0rd')
  #  The next two lines are optional, and to give the new login a server role, optional
  $login.AddToRole('sysadmin')
  $login.Alter()
 } else {
  $Error_Message = [string]"Required variables 'loginName' is missing!"
     Write-Error $Error_Message
     throw $Error_Message
 }
     </pre><p>
      Now edit the Active Directory connector configuration to reference the
      script. Add the following section to the connector configuration file
      (<code class="filename">opendim/conf/provisioner.openicf-ad.json</code>).
     </p><pre class="brush: javascript;">
 "systemActions" : [
     {
         "_scriptId" : "ConnectorScriptName",
         "actions" : [
             {
                 "systemType" : ".*ActiveDirectoryConnector",
                 "actionType" : "Shell",
                 "actionSource" : "@echo off \r\n echo %loginName%\r\n"
             },
             {
                 "systemType" : ".*ActiveDirectoryConnector",
                 "actionType" : "PowerShell",
                 "actionFile" : "script/createUser.ps1"
             }
         ]
     }
 ]
     </pre><p>
      To call the PowerShell script over the REST interface, use the following
      request, specifying the userName as input:
     </p><div class="screen"><pre>$ curl \
  --cacert self-signed.crt \
  --header "X-OpenIDM-Username: openidm-admin" \
  --header "X-OpenIDM-Password: openidm-admin" \
  --header "Content-Type: application/json" \
  --request POST \
  "https://localhost:8443/openidm/system/ActiveDirectory/?_action=script&amp;scriptId=ConnectorScriptName&amp;scriptExecuteMode=resource&amp;loginName=myUser"</pre></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="csv-file-connector"></a>10.5.4.&nbsp;CSV File Connector</h3></div></div></div><p>
    The CSV file connector is often useful when importing users, either for
    initial provisioning or for ongoing updates. When used continuously in
    production, a CSV file serves as a change log, often containing only user
    records that changed.
   </p><p>
    A sample CSV file connector configuration is provided in
    <code class="filename">openidm/samples/provisioners/provisioner.openicf-csv.json</code>.
   </p><p>
    The following example shows an excerpt of the provisioner configuration.
    The default location of the connector .jar is
    <code class="filename">openidm/connectors</code>. Therefore the value of the
    <code class="literal">connectorHostRef</code> property must be
    <code class="literal">"#LOCAL"</code>.
   </p><pre class="brush: javascript;">{
  "connectorRef": {
    "connectorHostRef": "#LOCAL",
    "connectorName": "org.forgerock.openicf.csvfile.CSVFileConnector",
    "bundleName": "org.forgerock.openicf.connectors.csvfile-connector",
    "bundleVersion": "[1.1,1.5]"
  }
}</pre><p>The following excerpt shows required configuration properties.</p><pre class="brush: javascript;">{
    "configurationProperties": {
        "filePath": "data/hr.csv",
        "uniqueAttribute": "uid"
    }
}</pre><div class="variablelist"><p>
     The CSV file connector also supports a number of optional configuration
     properties, in addition to the required properties.
    </p><dl class="variablelist"><dt><span class="term">encoding (optional)</span></dt><dd><p>Default: <code class="literal">"utf-8"</code></p></dd><dt><span class="term">fieldDelimiter (optional)</span></dt><dd><p>Default: <code class="literal">","</code></p></dd><dt><span class="term">filePath (required)</span></dt><dd><p>References the CSV file containing account entries</p></dd><dt><span class="term">multivalueDelimiter (optional)</span></dt><dd><p>Used with multi-valued attributes. Default:
      <code class="literal">";"</code></p></dd><dt><span class="term">passwordAttribute (optional)</span></dt><dd><p>Attribute containing the password. Use when password-based
      authentication is required.</p></dd><dt><span class="term">uniqueAttribute (required)</span></dt><dd><p>Primary key used for the CSV file</p></dd><dt><span class="term">usingMultivalue (optional)</span></dt><dd><p>Whether attributes can have multiple values. Default:
      <code class="literal">false</code></p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="scripted-sql-connector"></a>10.5.5.&nbsp;Scripted SQL Connector</h3></div></div></div><p>
    The Scripted SQL Connector uses customizable Groovy scripts to interact with
    the database.
   </p><div class="itemizedlist"><p>
     The connector uses one script for each of the following actions on the
     external database.
    </p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
      Create
     </p></li><li class="listitem"><p>
      Delete
     </p></li><li class="listitem"><p>
      Search
     </p></li><li class="listitem"><p>
      Sync
     </p></li><li class="listitem"><p>
      Test
     </p></li><li class="listitem"><p>
      Update
     </p></li></ul></div><p>
    Example groovy scripts are provided in the
    <code class="filename">openidm/samples/sample3/tools/</code> directory.
   </p><p>
    For a sample configuration that uses the scripted SQL connector, see <a href="../install-guide/index.html#more-sample3" class="link"><em class="citetitle">Sample 3 -
    Scripted SQL</em></a> in the <em class="citetitle">Installation
    Guide</em>.
   </p><p>
    The scripted SQL connector runs with autocommit mode enabled by default. As
    soon as a statement is executed that modifies a table, the update is stored
    on disk and the change cannot be rolled back. This setting applies to all
    database actions (search, create, delete, test, synch, and update). You can
    disable autocommit in the connector configuration file
    (<code class="literal">conf/provisioner.openicf-scriptedsql.json</code>) by adding the
    <code class="literal">autocommit</code> property and setting it to
    <code class="literal">false</code>, for example:
   </p><pre class="brush: javascript;">
"configurationProperties" : {
    "host" : "localhost",
    "port" : "3306",
    ...
    "database" : "HRDB",
    "autoCommit" : false,
    "reloadScriptOnExecution" : true,
    "createScriptFileName" : "&amp;{launcher.project.location}/tools/CreateScript.groovy",
    ...
   </pre><p>
    If you require a traditional transaction with a manual commit for a specific
    script, you can disable autocommit mode in the script or scripts for each
    action that requires a manual commit. For more information on disabling
    autocommit, see the corresponding <a class="link" href="http://http://dev.mysql.com/doc/refman/5.6/en/commit.html" target="_blank">MySQL
    documentation</a>.
   </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="database-table-connector"></a>10.5.6.&nbsp;Database Table Connector</h3></div></div></div><p>
    The Database Table connector enables provisioning to a single table in a
    JDBC database. A sample connector configuration for the Database Table
    connector is provided in
    <code class="filename">samples/provisioners/provisioner.openicf-contractordb.json</code>.
    The corresponding data definition language file is provided in
    <code class="filename">samples/provisioners/provisioner.openicf-contractordb.sql</code>.
   </p><p>
    The following excerpt shows the settings for the connector configuration
    properties in the sample Database Table connector:
   </p><pre class="brush: javascript;">
"configurationProperties" :
    {
       "quoting" : "",
       "host" : "localhost",
       "port" : "3306",
       "user" : "root",
       "password" : "",
       "database" : "contractordb",
       "table" : "people",
       "keyColumn" : "UNIQUE_ID",
       "passwordColumn" : "",
       "jdbcDriver" : "com.mysql.jdbc.Driver",
       "jdbcUrlTemplate" : "jdbc:mysql://%h:%p/%d",
       "enableEmptyString" : false,
       "rethrowAllSQLExceptions" : true,
       "nativeTimestamps" : true,
       "allNative" : false,
       "validConnectionQuery" : null,
       "changeLogColumn" : "CHANGE_TIMESTEMP",
       "datasource" : "",
       "jndiProperties" : null
    },</pre><p>
    The mandatory configurable properties are as follows:
   </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">database</span></dt><dd><p>
       The JDBC database that contains the table to which you are provisioning.
      </p></dd><dt><span class="term">table</span></dt><dd><p>
       The name of the table in the JDBC database that contains the user
       accounts.
      </p></dd><dt><span class="term">keyColumn</span></dt><dd><p>
       The column value that is used as the unique identifier for rows in the
       table.
      </p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="groovy-connector"></a>10.5.7.&nbsp;Groovy Connector</h3></div></div></div><p>
    The Groovy connector is a generic scripted connector that enables you to
    run Groovy scripts on any external resource.
   </p><p>
    The Groovy connector is bundled with OpenIDM 3.0.0, in
    the JAR <code class="filename">openidm/connectors/groovy-connector-1.4.0.0.jar</code>.
    Sample scripted connector implementations are included in the JAR.
   </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="powershell-connector"></a>10.5.8.&nbsp;Powershell Connector</h3></div></div></div><p>
    The PowerShell connector is a generic scripted connector that enables you to
    run PowerShell scripts to provision, synchronize, and deprovision user
    accounts in Active Directory.
   </p><p>
    The PowerShell connector runs on the .NET platform and requires the
    installation of a .NET connector server on the Active Directory server. To
    install the .NET connector, follow the instructions in <a class="xref" href="#install-.net-connector" title="10.4.1.&nbsp;Installing and Configuring a .NET Connector Server">Section&nbsp;10.4.1, &#8220;Installing and Configuring a .NET Connector Server&#8221;</a>.
   </p><p>
    The PowerShell connector is not bundled with OpenIDM, and must be downloaded
    separately. 
   </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="connector-wiz"></a>10.6.&nbsp;Creating Default Connector Configurations</h2></div></div></div><a class="indexterm" name="d505e7520"></a><p>
   Rather than creating provisioner files by hand, use the service that OpenIDM
   exposes through the REST interface to create basic connector configuration
   files, or use the <span class="command"><strong>cli.sh</strong></span> or <span class="command"><strong>cli.bat</strong></span>
   scripts to generate a basic connector configuration.
  </p><p>
   This section describes how to create connector configurations over the REST
   interface. For instructions on using the CLI to create connector
   configurations, see the <a href="../integrators-guide/index.html#cli-configureconnector" class="link"><em class="citetitle">configureconnector</em></a> section of the <em class="citetitle">CLI
   Interface</em> chapter.
  </p><div class="orderedlist"><p>
    You create a new connector configuration file in three stages:
   </p><ol class="orderedlist" type="1"><li class="listitem"><p>
     List available connectors.
    </p></li><li class="listitem"><p>
     Generate the core configuration.
    </p></li><li class="listitem"><p>
     Connect to the target system and generate the final configuration.
    </p></li></ol></div><p>
   List available connectors using the following command.
  </p><div class="screen"><pre>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 "https://localhost:8443/openidm/system?_action=CREATECONFIGURATION"</pre></div><div class="itemizedlist"><p>Available connectors are installed in
   <code class="filename">openidm/connectors</code>. OpenIDM bundles the following
   connectors.</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>csv file</p></li><li class="listitem"><p>database table</p></li><li class="listitem"><p>ldap</p></li><li class="listitem"><p>scripted groovy</p></li><li class="listitem"><p>scripted sql</p></li><li class="listitem"><p>xml</p></li></ul></div><p>The command above therefore should return the following output.</p><pre class="brush: javascript;">{
  "connectorRef": [
    {
      "bundleVersion": "1.1.0.1",
      "bundleName": "org.forgerock.openicf.connectors.csvfile-connector",
      "displayName": "CSV File Connector",
      "connectorName": "org.forgerock.openicf.csvfile.CSVFileConnector"
    },
    {
      "bundleVersion": "1.1.0.0",
      "bundleName": "org.forgerock.openicf.connectors.databasetable-connector",
      "displayName": "Database Table Connector",
      "connectorName": "org.identityconnectors.databasetable.DatabaseTableConnector"
    },
    {
      "bundleVersion": "1.4.0.0",
      "bundleName": "org.forgerock.openicf.connectors.groovy-connector",
      "displayName": "Scripted Poolable Groovy Connector",
      "connectorName": "org.forgerock.openicf.connectors.groovy.ScriptedPoolableConnector"
    },
    {
      "bundleVersion": "1.4.0.0",
      "bundleName": "org.forgerock.openicf.connectors.groovy-connector",
      "displayName": "Scripted Groovy Connector",
      "connectorName": "org.forgerock.openicf.connectors.groovy.ScriptedConnector"
    },
    {
      "bundleVersion": "1.1.1.3",
      "bundleName": "org.forgerock.openicf.connectors.ldap-connector",
      "displayName": "LDAP Connector",
      "connectorName": "org.identityconnectors.ldap.LdapConnector"
    },
    {
      "bundleVersion": "1.1.1.0",
      "bundleName": "org.forgerock.openicf.connectors.scriptedsql-connector",
      "displayName": "Scripted SQL",
      "connectorName": "org.forgerock.openicf.connectors.scriptedsql.ScriptedSQLConnector"
    },
    {
      "bundleVersion": "1.1.0.1",
      "bundleName": "org.forgerock.openicf.connectors.xml-connector",
      "displayName": "XML Connector",
      "connectorName": "org.forgerock.openicf.connectors.xml.XMLConnector"
    }
  ]
}</pre><p>
   To generate the core configuration, choose one of the available connectors by
   copying one of the JSON objects from the generated list into the body of the
   REST command, as shown below for the XML connector.
  </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 --data '{"connectorRef":
 {"connectorName": "org.forgerock.openicf.connectors.xml.XMLConnector",
 "displayName": "XML Connector",
 "bundleName": "org.forgerock.openicf.connectors.xml-connector",
 "bundleVersion": "1.1.0.1"}
 }' \
 "https://localhost:8443/openidm/system?_action=CREATECONFIGURATION"</strong></pre></div><p>
   This command returns a core connector configuration, similar to the
   following:
  </p><pre class="brush: javascript;">{
   "poolConfigOption": {
   "minIdle": 1,
   "minEvictableIdleTimeMillis": 120000,
   "maxWait": 150000,
   "maxIdle": 10,
   "maxObjects": 10
  },
   "resultsHandlerConfig": {
   "enableAttributesToGetSearchResultsHandler": true,
   "enableFilteredResultsHandler": true,
   "enableNormalizingResultsHandler": true
  },
  "operationTimeout": {
    "SCHEMA": -1,
    "SYNC": -1,
    "VALIDATE": -1,
    "SEARCH": -1,
    "AUTHENTICATE": -1,
    "CREATE": -1,
    "UPDATE": -1,
    "DELETE": -1,
    "TEST": -1,
    "SCRIPT_ON_CONNECTOR": -1,
    "SCRIPT_ON_RESOURCE": -1,
    "GET": -1,
    "RESOLVEUSERNAME": -1
  },
  "configurationProperties": {
   "xsdIcfFilePath": null,
   "xsdFilePath": null,
   "createFileIfNotExists": false,
   "xmlFilePath": null
  },
  "connectorRef": {
    "bundleVersion": "1.1.0.1",
    "bundleName": "org.forgerock.openicf.connectors.xml-connector",
    "displayName": "XML Connector",
    "connectorName": "org.forgerock.openicf.connectors.xml.XMLConnector"
  }
}</pre><p>
    The configuration that is returned is not yet functional. Notice that
    it does not contain the required system-specific
    <code class="literal">"configurationProperties"</code>, such as the host name and port
    for web based connectors, or the "xmlFilePath" for the XML file-based
    connectors. In addition, the configuration does not include the complete
    list of <code class="literal">"objectTypes"</code> and
    <code class="literal">"operationOptions"</code>.
  </p><p>
   To generate the final configuration, add values for the
   "configurationProperties" to the core configuration, and use the updated
   configuration as the body for the next command.
  </p><div class="screen"><pre>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 --data '{
  "configurationProperties":
    {
      "xsdIcfFilePath" : "samples/sample1/data/resource-schema-1.xsd",
      "xsdFilePath" : "samples/sample1/data/resource-schema-extension.xsd",
      "xmlFilePath" : "samples/sample1/data/xmlConnectorData.xml",
      "createFileIfNotExists": false
  },
  "operationTimeout": {
    "SCHEMA": -1,
    "SYNC": -1,
    "VALIDATE": -1,
    "SEARCH": -1,
    "AUTHENTICATE": -1,
    "CREATE": -1,
    "UPDATE": -1,
    "DELETE": -1,
    "TEST": -1,
    "SCRIPT_ON_CONNECTOR": -1,
    "SCRIPT_ON_RESOURCE": -1,
    "GET": -1,
    "RESOLVEUSERNAME": -1
  },
  "resultsHandlerConfig": {
    "enableAttributesToGetSearchResultsHandler": true,
    "enableFilteredResultsHandler": true,
    "enableNormalizingResultsHandler": true
  },
  "poolConfigOption": {
    "minIdle": 1,
    "minEvictableIdleTimeMillis": 120000,
    "maxWait": 150000,
    "maxIdle": 10,
    "maxObjects": 10
  },
  "connectorRef": {
    "bundleVersion": "1.1.0.1",
    "bundleName": "org.forgerock.openicf.connectors.xml-connector",
    "displayName": "XML Connector",
    "connectorName": "org.forgerock.openicf.connectors.xml.XMLConnector"
  }
}' \
 "https://localhost:8443/openidm/system?_action=CREATECONFIGURATION"</pre></div><div class="note"><h3 class="title">Note</h3><p>
    Notice the single quotes around the argument to the <code class="option">--data</code>
    option in the preceding command. For most UNIX shells, single quotes around
    a string prevent the shell from executing the command when encountering a
    newline in the content. You can therefore pass the
    <code class="option">--data '...'</code> option on a single line, or including line
    feeds.
   </p></div><p>OpenIDM attempts to read the schema, if available, from the external
  resource in order to generate output. OpenIDM then iterates through schema
  objects and attributes, creating JSON representations for "objectTypes" and
  "operationOptions" for supported objects and operations.</p><p>
   The output includes the basic <code class="literal">--data</code> input, along with
   <code class="literal">operationOptions</code> and <code class="literal">objectTypes</code>.
  </p><p>
   Because OpenIDM produces a full property set for all attributes and all
   object types in the schema from the external resource, the resulting
   configuration can be large. For an LDAP server, OpenIDM can generate a
   configuration containing several tens of thousands of lines, for example.
   You might therefore want to reduce the schema to a minimum on the external
   resource before you run the final command.
  </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="systems-over-rest"></a>10.7.&nbsp;Checking the Status of External Systems Over REST</h2></div></div></div><p>
   After a connection has been configured, external systems are accessible over
   the REST interface at the URL
   <code class="literal">https://localhost:8443/openidm/system/<em class="replaceable"><code>connector-name</code></em></code>.
   Aside from accessing the data objects within the external systems, you can
   test the availability of the systems themselves.
  </p><p>
   To list the external systems that are connected to an OpenIDM instance, use
   the <code class="literal">test</code> action on the URL
   <code class="literal">https://localhost:8443/openidm/system/</code>. The following
   example shows two external LDAP servers connected to OpenIDM:
  </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 "https://localhost:8443/openidm/system?_action=test"</strong>
   <em>
[
  {
    "ok": true,
    "name": "ldap1"
  },
  {
    "ok": true,
    "name": "ldap2"
  }
]</em></pre></div><p>
   The status of the system is provided by the <code class="literal">ok</code> parameter.
   If the connection is available, the value of this parameter is
   <code class="literal">true</code>.
  </p><p>
   To obtain the status for a single system, include the name of the connector
   in the URL, for example:
  </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "Content-Type: application/json" \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request POST \
 "https://localhost:8443/openidm/system/ldap1?_action=test"</strong>
   <em>
{
  "ok": true,
  "name": "ldap1"
}</em></pre></div><p>
   If there is a problem with the connection, the request returns an error
   message. In the following example, the LDAP server named
   <code class="literal">ldap1</code> is down.
  </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 "https://localhost:8443/openidm/system/ldap1?_action=test"</strong>
   <em>{
  "error": "javax.naming.CommunicationException: localhost:1389
            [Root exception is java.net.ConnectException: Connection refused]",
  "name": "ldap"
}</em></pre></div><p>
   To test the validity of a connector configuration, use the
   <code class="literal">testConfig</code> action and include the configuration in the
   command. For example:
  </p><div class="screen"><pre>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --data '{
    "name" : "xmlfile",
    "connectorRef" : {
        "bundleName" : "org.forgerock.openicf.connectors.xml-connector",
        "bundleVersion" : "1.1.0.1",
        "connectorName" : "org.forgerock.openicf.connectors.xml.XMLConnector"
    },
    "producerBufferSize" : 100,
    "connectorPoolingSupported" : true,
    "poolConfigOption" : {
        "maxObjects" : 10,
        "maxIdle" : 10,
        "maxWait" : 150000,
        "minEvictableIdleTimeMillis" : 120000,
        "minIdle" : 1
    },
    "operationTimeout" : {
        "CREATE" : -1,
        "TEST" : -1,
        "AUTHENTICATE" : -1,
        "SEARCH" : -1,
        "VALIDATE" : -1,
        "GET" : -1,
        "UPDATE" : -1,
        "DELETE" : -1,
        "SCRIPT_ON_CONNECTOR" : -1,
        "SCRIPT_ON_RESOURCE" : -1,
        "SYNC" : -1,
        "SCHEMA" : -1
    },
    "configurationProperties" : {
        "xsdIcfFilePath" : "samples/sample1/data/resource-schema-1.xsd",
        "xsdFilePath" : "samples/sample1/data/resource-schema-extension.xsd",
        "xmlFilePath" : "samples/sample1/data/xmlConnectorData.xml"
    },
    "syncFailureHandler" : {
        "maxRetries" : 5,
        "postRetryAction" : "logged-ignore"
    },
    "objectTypes" : {
        "account" : {
            "$schema" : "http://json-schema.org/draft-03/schema",
            "id" : "__ACCOUNT__",
            "type" : "object",
            "nativeType" : "__ACCOUNT__",
            "properties" : {
                "description" : {
                    "type" : "string",
                    "nativeName" : "__DESCRIPTION__",
                    "nativeType" : "string"
                },
                "firstname" : {
                    "type" : "string",
                    "nativeName" : "firstname",
                    "nativeType" : "string"
                },
                "email" : {
                    "type" : "string",
                    "nativeName" : "email",
                    "nativeType" : "string"
                },
                "_id" : {
                    "type" : "string",
                    "nativeName" : "__UID__"
                },
                "password" : {
                    "type" : "string",
                    "nativeName" : "password",
                    "nativeType" : "string"
                },
                "name" : {
                    "type" : "string",
                    "required" : true,
                    "nativeName" : "__NAME__",
                    "nativeType" : "string"
                },
                "lastname" : {
                    "type" : "string",
                    "required" : true,
                    "nativeName" : "lastname",
                    "nativeType" : "string"
                },
                "mobileTelephoneNumber" : {
                    "type" : "string",
                    "required" : true,
                    "nativeName" : "mobileTelephoneNumber",
                    "nativeType" : "string"
                },
                "securityQuestion" : {
                    "type" : "string",
                    "required" : true,
                    "nativeName" : "securityQuestion",
                    "nativeType" : "string"
                },
                "securityAnswer" : {
                    "type" : "string",
                    "required" : true,
                    "nativeName" : "securityAnswer",
                    "nativeType" : "string"
                },
                "roles" : {
                    "type" : "string",
                    "required" : false,
                    "nativeName" : "roles",
                    "nativeType" : "string"
                }
            }
        }
    },
    "operationOptions" : { }
}' \
 --request POST \
 "https://localhost:8443/openidm/system?_action=testConfig"
  </pre></div><p>
   If the configuration is valid, the command returns
   <code class="literal">"ok": true</code>, for example:
  </p><div class="screen"><pre>{
   "ok": true,
   "name": "xmlfile"
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="adding-to-connector-config"></a>10.8.&nbsp;Adding Attributes to Connectors</h2></div></div></div><p>
    You can add the attributes of your choice to a connector configuration file.
    Specifically, if you want to set up
    <a class="xref" href="#property-level-extensions">Property Level Extensions</a> to one of the
    <code class="literal">objectTypes</code> such as <code class="literal">account</code>, use the
    format shown under <a class="xref" href="#object-types" title="Object Types">Object Types</a>.
   </p><p>
    You can configure connectors to enable provisioning of arbitrary property
    level extensions (such as image files) to system resources. For example, if
    you want to set up image files such as account avatars, open the appropriate
    provisioner file. Look for an <code class="literal">account</code> section similar to:
   </p><pre class="brush: javascript;">
"account" : {
    "$schema" : "http://json-schema.org/draft-03/schema",
    "id" : "__ACCOUNT__",
    "type" : "object",
    "nativeType" : "__ACCOUNT__",
    "properties" : {
   </pre><p>
    Under <code class="literal">"properties"</code>, add one of the following code blocks.
    The first block works for a single photo encoded as a base64 string. The
    second block would address multiple photos encoded in the same way.
   </p><pre class="brush: javascript;">
"attributeByteArray" : {
    "type" : "string",
    "nativeName" : "attributeByteArray",
    "nativeType" : "JAVA_TYPE_BYTE_ARRAY"
},
   </pre><pre class="brush: javascript;">
"attributeByteArrayMultivalue": {
    "type": "array",
    "items": {
        "type": "string",
        "nativeType": "JAVA_TYPE_BYTE_ARRAY"
    },
    "nativeName": "attributeByteArrayMultivalue"
},
   </pre></div></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-synchronization"></a>Chapter&nbsp;11.&nbsp;Configuring Synchronization</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="section"><a href="#sync-types">11.1. Types of Synchronization</a></span></dt><dt><span class="section"><a href="#sync-flexible-data">11.2. Flexible Data Model</a></span></dt><dt><span class="section"><a href="#basic-flow">11.3. Basic Data Flow Configuration</a></span></dt><dt><span class="section"><a href="#recon-over-rest">11.4. Managing Reconciliation Over REST</a></span></dt><dt><span class="section"><a href="#recon-by-query">11.5. Restricting Reconciliation by Using Queries</a></span></dt><dt><span class="section"><a href="#recon-by-id">11.6. Restricting Reconciliation to a Specific ID</a></span></dt><dt><span class="section"><a href="#querying-recon-logs">11.7. Querying the Reconciliation Audit Log</a></span></dt><dt><span class="section"><a href="#livesync-retry-strategy">11.8. Configuring the LiveSync Retry Policy</a></span></dt><dt><span class="section"><a href="#handling-sync">11.9. Synchronization Situations and Actions</a></span></dt><dt><span class="section"><a href="#asynchronous-reconciliation">11.10. Asynchronous Reconciliation</a></span></dt><dt><span class="section"><a href="#case-sensitivity">11.11. Configuring Case Sensitivity for Data Stores</a></span></dt><dt><span class="section"><a href="#reconciliation-optimization">11.12. Reconciliation Optimization</a></span></dt><dt><span class="section"><a href="#correlation">11.13. Correlation Queries</a></span></dt><dt><span class="section"><a href="#advanced-dataflow">11.14. Advanced Data Flow Configuration</a></span></dt><dt><span class="section"><a href="#scheduling-synchronization">11.15. Scheduling Synchronization</a></span></dt></dl></div><a class="indexterm" name="d505e7734"></a><p>
  One of the core services of OpenIDM is synchronizing identity data from
  different resources. This chapter explains what you must know to get started
  configuring OpenIDM's flexible synchronization mechanism, and illustrates the
  concepts with examples.
 </p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sync-types"></a>11.1.&nbsp;Types of Synchronization</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#sync-types-automatic">11.1.1. How Automatic Sync works with <code class="literal">onSync</code></a></span></dt></dl></div><a class="indexterm" name="d505e7742"></a><p>
   Synchronization happens either when OpenIDM receives a change directly, or
   when OpenIDM discovers a change on an external resource.
  </p><p>
   For direct changes to OpenIDM, OpenIDM immediately pushes updates to all
   external resources configured to receive the updates. A direct change can
   originate not only as a write request through the REST interface, but also as
   an update resulting from reconciliation with another resource.
  </p><div class="variablelist"><p>
    OpenIDM discovers and synchronizes changes from external resources
    through reconciliation and LiveSync.
   </p><p>
    In contrast, OpenIDM synchronizes changes from internal resources to
    external targets using automatic sync.
   </p><dl class="variablelist"><dt><span class="term">Reconciliation</span></dt><dd><a class="indexterm" name="d505e7760"></a><p>
      In identity management, <em class="firstterm">reconciliation</em> is the
      process of bidirectional synchronization of objects between different data
      stores. Reconciliation applies mainly to user objects, although OpenIDM
      can reconcile any objects, including groups and roles.
     </p><p>
      To perform reconciliation, OpenIDM analyzes both source and target systems
      to uncover the differences that it must reconcile. Reconciliation can
      therefore be a heavyweight process. When working with large data sets,
      finding all changes can be more work than processing the changes.
     </p><p>
      Reconciliation is, however, thorough. It recognizes system error
      conditions and catches changes that might be missed by the more
      lightweight LiveSync mechanism. Reconciliation therefore serves as the
      basis for compliance and reporting functionality.
     </p></dd><dt><span class="term">LiveSync</span></dt><dd><a class="indexterm" name="d505e7776"></a><p>
      <em class="firstterm">LiveSync</em> captures the changes that occur on a
      remote system, then pushes those changes to OpenIDM. OpenIDM uses the
      defined mappings to replay the changes where they are required - either in
      the OpenIDM repository, or on another remote system, or both. Unlike
      reconciliation, LiveSync uses a polling system, and is intended to react
      quickly to changes as they happen.
     </p><p>
      To perform this polling, LiveSync relies on a change detection mechanism
      on the external resource to determine which objects have changed. The
      change detection mechanism is specific to the external resource, and can
      be a time stamp, a sequence number, a change vector or other any method of
      recording changes that have occurred on the system. For example, OpenDJ
      implements a change log that provides OpenIDM with a list of objects that
      have changed since the last request. Active Directory implements a change
      sequence number, and certain databases might have a
      <code class="literal">lastChange</code> attribute.
     </p></dd><dt><span class="term">Automatic sync</span></dt><dd><p>
      <em class="firstterm">Automatic sync</em> automatically pushes changes made in
      the OpenIDM internal repository to external systems.
     </p><p>
      In other words, automatic sync pushes data in the opposite direction to
      LiveSync. The section that follows describes additional features that
      can be included with automatic sync.
     </p></dd></dl></div><p>
   To determine what to synchronize, and how to carry out synchronization,
   OpenIDM relies on mappings configured in the
   <code class="literal">/path/to/conf/sync.json</code> file. LiveSync and automatic sync
   rely on the mappings configured once per OpenIDM server.
  </p><p>
   For reconciliation or LiveSync, you can schedule changes as described in
   <a href="../integrators-guide/index.html#chap-scheduler-conf" class="link"><em class="citetitle">Scheduling
    Tasks and Events</em></a>.
  </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="sync-types-automatic"></a>11.1.1.&nbsp;How Automatic Sync works with <code class="literal">onSync</code></h3></div></div></div><p>
     When automatic sync is used to push a large number of changes to external
     databases, that process takes time. Problems such as lost connections
     could happen, resulting in partial synchronization.
    </p><p>
     For example, if a Human Resources manager adds a group of new employees in
     one database, a partial synchronization may mean that some of those
     employees do not have access to their email or other systems.
    </p><p>
     Automatic sync assumes that the external data sources include all data
     currently in the internal OpenIDM repository. If that does not reflect
     your configuration, you should start either with an initial reconciliation,
     or with LiveSync as described in the Installation Guide,
     <a href="../install-guide/index.html#more-sample6" class="link"><em class="citetitle">Sample 6 - LiveSync
     with an AD Server</em></a>.
    </p><p>
     An example of automatic sync is depicted in the OpenIDM Installation Guide,
     <a href="../install-guide/index.html#more-sample5b" class="link"><em class="citetitle">Sample 5b - Compensated
     Synchronization with <code class="literal">onSync</code></em></a>. That
     sample demonstrates how OpenIDM compensates for the failure of an external
     resource.
    </p><p>
     OpenIDM includes an optional <code class="literal">onSync</code> hook, which you
     can include in the <code class="filename">/path/to/conf/managed.json</code> file.
     A sample excerpt is shown here:
    </p><pre class="brush: javascript;">
...
"onDelete" : {
    "type" : "text/javascript",
    "file" : "ui/onDelete-user-cleanup.js"
    },
"onSync" : {
    "type" : "text/javascript",
    "file" : "compensate.js"
    },
"properties" : [
    ...
    </pre><p>
     Note the reference from <code class="literal">onSync</code> to
     <code class="filename">compensate.js</code>. You can find that file in the
     <code class="filename">/path/to/openidm/bin/defaults/script</code> directory.
    </p><p>
     When a change to a user is made, either in the UI or through a REST call,
     a change is made to the managed object for that user.
    </p><p>
     The automatic sync feature of OpenIDM attempts to synchronize the change
     (and any other pending changes) to the external data store(s). The
     automatic sync process is configured in the associated
     <code class="filename">sync.json</code> configuration file.
    </p><p>
     Look at the contents of the <code class="filename">sync.json</code> file. It might
     start with source and target mappings similar to:
    </p><pre class="brush: javascript;">
   ...
   "mappings" : [
     {
       "name" : "managedUser_systemAdAccounts",
       "source" : "managed/user",
       "target" : "system/ad/account",
     ...
    </pre><p>
     Based on this excerpt, automatic synchronization takes information from the
     internal OpenIDM managed user data store, and synchronizes that information
     to the AD data store. Once complete, it proceeds down the file to the
     next <code class="literal">source</code> and <code class="literal">target</code> to be
     synchronized.
    </p><p>
     The <code class="filename">compensate.js</code> script is designed to avoid
     partial synchronization. If synchronization proceeds to completion, OpenIDM
     exits from the script, based on some of the first active entries in the file:
    </p><pre class="brush: javascript;">
if (syncResults.success) {
     logger.debug("sync was a success; no compensation necessary");
     return;
}</pre><p>
     If synchronization does not complete, OpenIDM proceeds through the
     remainder of the <code class="filename">compensate.js</code> script, with warning
     messages related to the sync action (<code class="literal">notifyCreate, notifyUpdate,
     notifyDelete</code>, along with the error that caused the sync failure,
     which should be available in the standard OpenIDM log file.
    </p><p>
     Without the <code class="filename">compensate.js</code> script, any issues with
     connections to an external resource can lead to data stores that are
     out of sync, such as the example cited earlier where some new employees
     do not have access to their corporate email accounts.
    </p><p>
     With the <code class="filename">compensate.js</code> script, any such errors will
     result in each data store using the information it had before
     automatic synchronization started. OpenIDM stores that information,
     temporarily, in properties such as <code class="literal">oldObject</code> and
     <code class="literal">oldTarget</code>.
    </p><p>
     In this particular example, human resource managers should see that
     new employees are not shown in their database. Then, the administrators
     of the OpenIDM system can check log files for errors, address them, and
     then restart automatic synchronization with a new REST call.
    </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sync-flexible-data"></a>11.2.&nbsp;Flexible Data Model</h2></div></div></div><a class="indexterm" name="d505e7913"></a><p>
   Identity management software tends to favor either a meta-directory data
   model, where all data are mirrored in a central repository, or a virtual data
   model, where only a minimum set of attributes are stored centrally, and most
   are loaded on demand from the external resources in which they are stored.
   The meta-directory model offers fast access at the risk of getting outdated
   data. The virtual model guarantees fresh data, but pays for that guarantee in
   terms of performance.
  </p><p>
   OpenIDM leaves the data model choice up to you. You determine the right trade
   offs for a particular deployment. OpenIDM does not hard code any particular
   schema or set of attributes stored in the repository. Instead, you define how
   external system objects map onto managed objects, and OpenIDM dynamically
   updates the repository to store the managed object attributes that you
   configure.
  </p><p>
   You can, for example, choose to follow the data model defined in the Simple
   Cloud Identity Management (<a class="link" href="http://www.simplecloud.info/specs/draft-scim-core-schema-00.html" target="_blank">SCIM</a>) specification. The following object represents a SCIM user.
  </p><pre class="brush: javascript;">
{
    "userName": "james1",
    "familyName": "Berg",
    "givenName": "James",
    "email": [
        "james1@example.com"
    ],
    "description": "Created by OpenIDM REST.",
    "password": "asdfkj23",
    "displayName": "James Berg",
    "phoneNumber": "12345",
    "employeeNumber": "12345",
    "userType": "Contractor",
    "title": "Vice President",
    "active": true
}</pre><div class="note"><h3 class="title">Note</h3><p>
    Avoid using the dash character ( <code class="literal">-</code> ) in property names,
    like <code class="literal">last-name</code>, as dashes in names make JavaScript syntax
    more complex. If you cannot avoid the dash, then write
    <code class="literal">source['last-name']</code> instead of
    <code class="literal">source.last-name</code> in your JavaScript.
   </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="basic-flow"></a>11.3.&nbsp;Basic Data Flow Configuration</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#connector-config-files">11.3.1. Connector Configuration Files</a></span></dt><dt><span class="section"><a href="#synchronization-mappings-file">11.3.2. Synchronization Mappings File</a></span></dt><dt><span class="section"><a href="#sync-encrypted-values">11.3.3. Using Encrypted Values</a></span></dt><dt><span class="section"><a href="#restricting-http-access">11.3.4. Restricting HTTP Access to Sensitive Data</a></span></dt><dt><span class="section"><a href="#constructing-attributes">11.3.5. Constructing and Manipulating Attributes</a></span></dt><dt><span class="section"><a href="#reusing-links">11.3.6. Reusing Links</a></span></dt></dl></div><p>Data flow for synchronization involves the following elements:
  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Connector configuration files
  (<code class="filename">conf/provisioner-*.json</code>), with one file per external
  resource.</p></li><li class="listitem"><p>Synchronization mappings file
  (<code class="filename">conf/sync.json</code>), with one file per OpenIDM instance.
  </p></li><li class="listitem"><p>A links table that OpenIDM maintains in its repository.</p></li><li class="listitem"><p>The scripts required to check objects and manipulate attributes.</p></li></ul></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="connector-config-files"></a>11.3.1.&nbsp;Connector Configuration Files</h3></div></div></div><a class="indexterm" name="d505e7971"></a><p>Connector configuration files map external resource objects to OpenIDM
     objects, and are described in detail in the chapter on <a href="../integrators-guide/index.html#chap-resource-conf" class="link"><em class="citetitle">Connecting to
     External Resources</em></a>. Connector configuration files are
     named <code class="filename">openidm/conf/provisioner.<em class="replaceable"><code>resource-name</code></em>.json</code>,
     where <em class="replaceable"><code>resource-name</code></em> reflects the connector
     technology and external resource, such as
     <code class="literal">openicf-xml</code>.</p><p>An excerpt from an example connector configuration follows. The
     example shows the name for the connector and two attributes of an account
     object type. In the attribute mapping definitions, the attribute name is
     mapped from the <code class="literal">nativeName</code>, the attribute name used on
     the external resource, to the attribute name used in OpenIDM. Thus the
     example shows that the <code class="literal">sn</code> attribute in LDAP is mapped to
     <code class="literal">lastName</code> in OpenIDM. The <code class="literal">homePhone</code>
     attribute can have multiple values.</p><pre class="brush: javascript;">
{
    "name": "MyLDAP",
    "objectTypes": {
        "account": {
            "lastName": {
                "type": "string",
                "required": true,
                "nativeName": "sn",
                "nativeType": "string"
            },
            "homePhone": {
                "type": "array",
                "items": {
                    "type": "string",
                    "nativeType": "string"
                },
                "nativeName": "homePhone",
                "nativeType": "string"
            }
        }
    }
}</pre><p>In order for OpenIDM to access external resource objects and
    attributes, the object and its attributes must match the connector
    configuration. Note that the connector file only maps external resource
    objects to OpenIDM objects. To construct attributes and to manipulate
    their values, you use the synchronization mappings file.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="synchronization-mappings-file"></a>11.3.2.&nbsp;Synchronization Mappings File</h3></div></div></div><a class="indexterm" name="d505e8015"></a><a class="indexterm" name="d505e8020"></a><p>
     The synchronization mappings file (<code class="filename">openidm/conf/sync.json</code>)
     represents the core configuration for OpenIDM synchronization.
     </p><p>The <code class="filename">sync.json</code> file describes a set of mappings.
     Each mapping specifies how attributes from source objects correspond to
     attributes on target objects. The source and target indicate the direction
     for the data flow, so you must define a separate mapping for each data
     flow. For example, if you want data flows from an LDAP server to the
     repository and also from the repository to the LDAP server, you must
     define two separate mappings.</p><p>You identify external resource sources and targets as
     <code class="literal">system/<em class="replaceable"><code>name</code></em>/<em class="replaceable"><code>object-type</code></em></code>, where
     <em class="replaceable"><code>name</code></em> is the name used in the connector
     configuration file, and <em class="replaceable"><code>object-type</code></em> is the
     object defined in the connector configuration file list of object types.
     For objects in OpenIDM's internal repository, you use
     <code class="literal">managed/<em class="replaceable"><code>object-type</code></em></code>, where
     <em class="replaceable"><code>object-type</code></em> is defined in
     <code class="filename">openidm/conf/managed.json</code>. The name for the mapping
     by convention is set to a string of the form
     <code class="literal"><em class="replaceable"><code>source</code></em>_<em class="replaceable"><code>target</code></em></code>, as shown in the following example.</p><pre class="brush: javascript;">
{
    "mappings": [
        {
            "name": "systemLdapAccounts_managedUser",
            "source": "system/MyLDAP/account",
            "target": "managed/user",
            "properties": [
                {
                    "target": "sn",
                    "source": "lastName"
                },
                {
                    "target": "telephoneNumber",
                    "source": "homePhone"
                },
                {
                    "target": "phoneExtension",
                    "default": "0047"
                },
                {
                    "target": "mail",
                    "comment": "Set mail if non-empty.",
                    "source": "email",
                    "condition": {
                        "type": "text/javascript",
                        "source": "(object.email != null)"
                    }
                },
                {
                    "target": "displayName",
                    "source": "",
                    "transform": {
                        "type": "text/javascript",
                        "source": "source.lastName +', ' + source.firstName;"
                    }
                }
            ]
        }
    ]
}</pre><p>In this example, the source is the external resource,
     <code class="literal">MyLDAP</code>, and the target is OpenIDM's repository,
     specifically the managed user objects. The <code class="literal">properties</code>
     reflect OpenIDM attribute names. For example, the mapping has the
     attribute <code class="literal">lastName</code> defined in the
     <code class="literal">MyLDAP</code> connector configuration file mapped to
     <code class="literal">sn</code> in the OpenIDM managed user object. Notice
     that the attribute names come from the connector configuration, rather
     than the external resource itself.</p><a class="indexterm" name="d505e8086"></a><p>You can create attributes on the target as part of the mapping. In
     the preceding example, a <code class="literal">phoneExtension</code> attribute with
     a default value of <code class="literal">0047</code> is created on the target. The
     <code class="literal">"default"</code> property can also be used to specify the
     value to assign to the target property if the <code class="literal">"source"</code>
     property and the <code class="literal">"transform"</code> script yield a null value.
     If no value is specified, the default value is null.
     </p><a class="indexterm" name="d505e8108"></a><p>You can also set up conditions under which OpenIDM maps attributes
     as shown for the email attribute in the example. By default, OpenIDM
     synchronizes all attributes. In the example, the mail attribute is set
     only if the script for the condition returns <code class="literal">true</code>.
     </p><a class="indexterm" name="d505e8118"></a><p>OpenIDM also enables you to transform attributes. In the example,
     the value of the <code class="literal">displayName</code> attribute is set using a
     combination of the <code class="literal">lastName</code> and
     <code class="literal">firstName</code> attribute values from the source. For
     transformations, the <code class="literal">source</code> property is optional.
     However, the source object is only available when you specify the
     <code class="literal">source</code> property. Therefore, in order to use
     <code class="literal">source.lastName</code> and <code class="literal">source.firstName</code>
     to calculate the <code class="literal">displayName</code>, the example specifies
     <code class="literal">"source" : ""</code>.</p><p>To add a flow from the repository to <code class="literal">MyLDAP</code>,
     you would define a mapping with source <code class="literal">managed/user</code>
     and target <code class="literal">system/MyLDAP/account</code>, named for example
     <code class="literal">managedUser_systemLdapAccounts</code>.</p><p>The following image shows the paths to objects in the OpenIDM
     namespace.</p><div class="mediaobject" align="center"><a name="figure-service-tree"></a><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/ServiceTree.png" align="middle" height="360" alt="OpenIDM namespace and object paths"></td></tr></table><div class="longdesc-link" align="right"><br clear="all"><span class="longdesc-link">[<a href="figure-service-tree.html" target="longdesc">D</a>]</span></div><div class="caption"><p>OpenIDM stores managed objects in the repository, and exposes
       them under <code class="literal">/openidm/managed</code>. System objects on
       external resources are exposed under
       <code class="literal">/openidm/system</code>.</p></div></div><div class="variablelist"><a class="indexterm" name="d505e8187"></a><p>
       By default, OpenIDM synchronizes all objects that match those defined in
       the connector configuration for the resource. Many connectors allow you
       to limit the scope of objects that the connector accesses. For example,
       the LDAP connector allows you to specify base DNs and LDAP filters so
       that you do not need to access every entry in the directory. OpenIDM also
       allows you to filter what is considered a valid source or valid target
       for synchronization by using scripts. To apply these filters, use the
       <code class="literal">validSource</code>, and <code class="literal">validTarget</code>
       properties in your mapping.
      </p><dl class="variablelist"><dt><span class="term">validSource</span></dt><dd><p>A script that determines if a source object is valid to be
         mapped. The script yields a boolean value: <code class="literal">true</code>
         indicates that the source object is valid; <code class="literal">false</code>
         can be used to defer mapping until some condition is met. In the root
         scope, the source object is provided in the <code class="literal">"source"</code>
         property. If the script is not specified, then all source objects are
         considered valid.</p><pre class="brush: javascript;">
{
    "validSource": {
        "type": "text/javascript",
        "source": "source.ldapPassword != null"
    }
}
</pre></dd><dt><span class="term">validTarget</span></dt><dd><p>A script, used during reconciliation's second phase, that
        determines if a target object is valid to be mapped. The script yields
        a boolean value: <code class="literal">true</code> indicates that the target
        object is valid; <code class="literal">false</code> indicates that the target
        object should not be included in reconciliation. In the root scope, the
        source object is provided in the <code class="literal">"target"</code> property.
        If the script is not specified, then all target objects are considered
        valid for mapping.</p><pre class="brush: javascript;">
{
    "validTarget": {
        "type": "text/javascript",
        "source": "target.employeeType == 'internal'"
    }
}
</pre></dd></dl></div><p>During synchronization, your scripts always have access to a
     <code class="literal">source</code> object and a <code class="literal">target</code> object.
     Examples already shown in this section use <code class="literal">source.<em class="replaceable"><code>attributeName</code></em></code> to retrieve attributes from the
     source objects. Your scripts can also write to target attributes using
     <code class="literal">target.<em class="replaceable"><code>attributeName</code></em></code>
     syntax.</p><pre class="brush: javascript;">
{
    "onUpdate": {
        "type": "text/javascript",
        "source": "if (source.email != null) {target.mail = source.email;}"
    }
}</pre><p>See the <a href="../integrators-guide/index.html#appendix-scripting" class="link"><em class="citetitle">Scripting
     Reference</em></a> appendix for more on scripting.</p><p>By default, all mappings participate in automatic synchronization
   operations. You can prevent a specific mapping from participating in
   automatic synchronization by setting the <code class="literal">"enableSync"</code>
   property of that mapping to false. In the following example, automatic
   synchronization is disabled. This means that changes to objects in the internal
   repository are not automatically propagated to the LDAP directory. To
   propagate changes to the LDAP directory, reconciliation must be launched
   manually.</p><pre class="brush: javascript;">
{
    "mappings" : [
        {
            "name" : "managedUser_systemLdapAccounts",
            "source" : "managed/user",
            "target" : "system/ldap/account",
            "enableSync" : false,
             ....
}
   </pre><p>
    Note that if <code class="literal">enableSync</code> is set to <code class="literal">false</code>
    for a system to managed user mapping (for example
    <code class="literal">"systemLdapAccounts_managedUser"</code>), LiveSync is disabled
    for that mapping.
   </p><p>
    If a source resource is empty, the default behavior is for a reconciliation
    operation to exit, without failure, and to log a warning, similar to the
    following:
   </p><div class="screen"><pre>
2014-03-20 10:41:18:918 WARN Cannot perform reconciliation with an empty source
    object set, unless explicitly configured to allow it.
   </pre></div><p>
    The reconciliation summary is also logged in the reconciliation audit log.
   </p><p>
    This behavior prevents reconciliation operations from accidentally deleting
    everything in a target resource. For example, in the event that a source
    system is unavailable but erroneously reporting its status as "up", the
    absence of source objects should not result in objects being removed on the
    target resource.
   </p><p>
    There might be situations in which you do want reconciliations of an empty
    source resource to proceed. In this case, you can override the default
    behavior by setting the <code class="literal">"allowEmptySourceSet"</code> property to
    <code class="literal">true</code> in the mapping. For example:
   </p><pre class="brush: plain;">
{
    "mappings" : [
        {
        "name" : "systemXmlfileAccounts_managedUser",
        "source" : "system/xmlfile/account",
        "allowEmptySourceSet" : true,
        ...
   </pre><p>
    Reconciliation of an empty source effectively wipes out the target.
   </p><p>
    You can update mappings in the synchronization configuration file
    (<code class="filename">sync.json</code>) while the server is running, provided you
    do not update a mapping that is currently in use by a reconciliation
    process.
   </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="sync-encrypted-values"></a>11.3.3.&nbsp;Using Encrypted Values</h3></div></div></div><a class="indexterm" name="d505e8306"></a><p>OpenIDM supports reversible encryption of attribute values for
   managed objects. Attribute values to encrypt include passwords,
   authentication questions, credit card numbers, and social security numbers.
   If passwords are already encrypted on the external resource, they are
   generally excluded from the synchronization process. For more information,
   see <a href="../integrators-guide/index.html#chap-passwords" class="link">
           <em class="citetitle">Managing Passwords</em></a>.</p><p>You configure encryption in the managed object configuration (in the
   <code class="filename">openidm/conf/managed.json</code> file). The following extract
   of that file shows a managed object configuration that encrypts and decrypts
   <code class="literal">securityAnswer</code>, <code class="literal">ssn</code>, and
   <code class="literal">password</code> attributes using the default symmetric
   key, and additional scripts for extra passwords.</p><pre class="brush: javascript;">
{
    "objects": [
        {
            "name": "user",
            ...
            "properties": [
                {
                    "name": "securityAnswer",
                    "encryption": {
                        "key": "openidm-sym-default"
                    }
                },
                {
                    "name": "ssn",
                    "encryption": {
                        "key": "openidm-sym-default"
                    }
                },
                {
                    "name": "password",
                    "encryption": {
                        "key": "openidm-sym-default"
                    }
                }
            ],
            ...
          }
    ]
}</pre><p>Do not use the default symmetric key,
   <code class="literal">openidm-sym-default</code>, in production. See the chapter on
   <a href="../integrators-guide/index.html#chap-security" class="link"><em class="citetitle">Securing
   and Hardening OpenIDM</em></a> for instructions on adding your
   own symmetric key.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="restricting-http-access"></a>11.3.4.&nbsp;Restricting HTTP Access to Sensitive Data</h3></div></div></div><p>You can protect specific sensitive data stored in the repository by
   marking the corresponding properties as "private". Private data, whether it
   is encrypted or not, is not accessible over the REST interface. Properties
   that are marked as private are removed from an object when that object is
   retrieved over REST.</p><p>To mark a property as private, set its <code class="literal">"scope"</code> to
   <code class="literal">"private"</code> in the <code class="filename">conf/managed.json</code>
   file.</p><p>The following extract of the <code class="filename">managed.json</code> file
   shows how HTTP access is prevented on the <code class="literal">password</code> and
   <code class="literal">securityAnswer</code> properties.</p><pre class="brush: javascript;">
       "properties" : [
           {
               "name" : "securityAnswer",
               "encryption" : {
                   "key" : "openidm-sym-default"
               },
               "scope" : "private"
           },
           {
               "name" : "password",
               "encryption" : {
                   "key" : "openidm-sym-default"
               },
               "scope" : "private"
   </pre><p>A potential caveat with using private properties is that such
   properties are <span class="emphasis"><em>removed</em></span> if an object is updated by
   using an HTTP <code class="literal">PUT</code> request. A <code class="literal">PUT</code>
   request replaces the entire object in the repository. Because properties
   that are marked as private are ignored in HTTP requests, these properties
   are effectively removed from the object when the update is done. To work
   around this limitation, do not use <code class="literal">PUT</code> requests if you
   have configured private properties. Instead, use a <code class="literal">PATCH</code>
   request to update only those properties that need to be changed.
   </p><p>For example, to update the <code class="literal">givenName</code> of user jdoe,
    you could run the following command:</p><div class="screen"><pre>
$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 --data '[
    {
    "operation":"replace",
    "field":"/givenName",
    "value":"Jon"
    }
 ]' \
 "https://localhost:8443/openidm/managed/user?_action=patch&amp;_queryId=for-userName&amp;uid=jdoe"</strong>
   </pre></div><div class="note"><h3 class="title">Note</h3><p>The filtering of private data applies only to direct HTTP read
    and query calls on managed objects. No automatic filtering is done for
    internal callers, and the data that these callers choose to expose.</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="constructing-attributes"></a>11.3.5.&nbsp;Constructing and Manipulating Attributes</h3></div></div></div><a class="indexterm" name="d505e8405"></a><p>
    OpenIDM enables you to construct and manipulate attributes using scripts
    that are triggered when an object is created (onCreate), updated (onUpdate),
    retrieved (onRetrieve), or deleted (onDelete). Additional scripts are
    available when a managed object requires validation (onValidate), and when
    an object is about to be stored in the repository (onStore). Similar scripts
    are available for when a link is created (onLink) or removed (onUnlink).
   </p><p>The following example derives a DN for an LDAP entry when the entry
   is created in the internal repository.</p><pre class="brush: javascript;">
{
    "onCreate": {
        "type": "text/javascript",
        "source":
            "target.dn = 'uid=' + source.uid + ',ou=people,dc=example,dc=com'"
    }
}</pre><p>
    In addition, OpenIDM supports the use of post-action scripts, including
    after the creation of an object is complete (postCreate), after the update
    of an object is complete (postUpdate), and after the deletion of an object
    (postDelete).
   </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="reusing-links"></a>11.3.6.&nbsp;Reusing Links</h3></div></div></div><a class="indexterm" name="d505e8421"></a><p>When two mappings exist to synchronize the same objects bidirectionally,
   you can use the <code class="literal">links</code> property in one mapping to have
   OpenIDM use the same internally managed link for both mappings. Otherwise,
   if no <code class="literal">links</code> property is specified, OpenIDM maintains a
   link for each mapping.</p><p>The following excerpt shows two mappings, one from MyLDAP accounts
   to managed users, and another from managed users to MyLDAP accounts. In
   the second mapping, the <code class="literal">link</code> property tells OpenIDM
   to reuse the links created in the first mapping, rather than create new
   links.</p><pre class="brush: javascript;">
{
    "mappings": [
        {
            "name": "systemMyLDAPAccounts_managedUser",
            "source": "system/MyLDAP/account",
            "target": "managed/user"
        },
        {
            "name": "managedUser_systemMyLDAPAccounts",
            "source": "managed/user",
            "target": "system/MyLDAP/account",
            "links": "systemMyLDAPAccounts_managedUser"
        }
    ]
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="recon-over-rest"></a>11.4.&nbsp;Managing Reconciliation Over REST</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#triggering-recons">11.4.1. Triggering a Reconciliation Run</a></span></dt><dt><span class="section"><a href="#recon-details">11.4.2. Obtaining the Details of a Reconciliation Run</a></span></dt><dt><span class="section"><a href="#canceling-recons">11.4.3. Canceling a Reconciliation Run</a></span></dt><dt><span class="section"><a href="#listing-recons">11.4.4. Listing Reconciliation Runs</a></span></dt><dt><span class="section"><a href="#livesync-over-rest">11.4.5. Triggering LiveSync Over REST</a></span></dt></dl></div><p>
   You can trigger, cancel, and monitor reconciliation operations over REST,
   using the REST endpoint
   <code class="literal">https://localhost:8443/openidm/recon</code>.
  </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="triggering-recons"></a>11.4.1.&nbsp;Triggering a Reconciliation Run</h3></div></div></div><p>
    The following example triggers a reconciliation operation based on the
    <code class="literal">systemLdapAccounts_managedUser</code> mapping. The mapping is
    defined in the file <code class="filename">conf/sync.json</code>.
   </p><div class="screen"><pre>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 "https://localhost:8443/openidm/recon?_action=recon&amp;mapping=systemLdapAccounts_managedUser"</pre></div><p>
    By default, an assigned reconciliation run ID is returned immediately when
    the reconciliation operation is initiated. Clients can make subsequent calls
    to the reconciliation service, using this reconciliation run ID to query its
    state and to call operations on it.
   </p><p>
    For example, the reconciliation run initiated previously would return
    something similar to the following:
   </p><div class="screen"><pre>{"_id":"0890ad62-4738-4a3f-8b8e-f3c83bbf212e"}</pre></div><p>
    To have the entire reconciliation run complete before the reconciliation
    run ID is returned, set the <code class="literal">waitForCompletion</code> property to
    <code class="literal">true</code> when the reconciliation is initiated. For example:
   </p><div class="screen"><pre>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 "https://localhost:8443/openidm/recon?_action=recon&amp;mapping=systemLdapAccounts_managedUser&amp;waitForCompletion=true"
   </pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="recon-details"></a>11.4.2.&nbsp;Obtaining the Details of a Reconciliation Run</h3></div></div></div><p>
     You can display the details of a particular reconciliation run over REST by
     specifying the reconciliation run ID in the URL. For example, the following
     call shows the details of the reconciliation run initiated in the previous
     section:
    </p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/recon/0890ad62-4738-4a3f-8b8e-f3c83bbf212e"</strong>
     <em>{
  "ended": "2014-03-06T07:00:32.094Z",
  "_id": "7a07c100-4f11-4d7e-bf8e-fa4594f99d58",
  "mapping": "systemLdapAccounts_managedUser",
  "state": "SUCCESS",
  "stage": "COMPLETED_SUCCESS",
  "stageDescription": "reconciliation completed.",
  "progress": {
     "links": {
       "created": 0,
       "existing": {
         "total": "1",
         "processed": 1
       }
     },
     "target": {
       "created": 0,
       "existing": {
         "total": "3",
         "processed": 3
       }
     },
     "source": {
       "existing": {
         "total": "1",
         "processed": 1
       }
     }
  },
  "situationSummary": {
     "UNASSIGNED": 2,
     "TARGET_IGNORED": 0,
     "SOURCE_IGNORED": 0,
     "MISSING": 0,
     "FOUND": 0,
     "AMBIGUOUS": 0,
     "UNQUALIFIED": 0,
     "CONFIRMED": 1,
     "SOURCE_MISSING": 0,
     "ABSENT": 0
  },
  "started": "2014-03-06T07:00:31.907Z"</em>
}</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="canceling-recons"></a>11.4.3.&nbsp;Canceling a Reconciliation Run</h3></div></div></div><p>
     You can cancel a reconciliation run by sending a REST call with the
     <code class="literal">cancel</code> action, specifying the reconciliation run ID. For
     example, the following call cancels the reconciliation run initiated in the
     previous section:
    </p><div class="screen"><pre>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 "https://localhost:8443/openidm/recon/0890ad62-4738-4a3f-8b8e-f3c83bbf212e?_action=cancel"</pre></div><p>
     The output for a reconciliation cancellation request is similar to the
     following:
    </p><div class="screen"><pre>{
     "status":"SUCCESS",
     "action":"cancel",
     "_id":"0890ad62-4738-4a3f-8b8e-f3c83bbf212e"
}</pre></div><p>
     If you specified that the call should wait for completion before the ID is
     returned, you can obtain the reconciliation run ID from the list of active
     reconciliations, as described in the following section.
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="listing-recons"></a>11.4.4.&nbsp;Listing Reconciliation Runs</h3></div></div></div><p>
     You can display a list of reconciliation processes that have completed, and
     those that are in progress, by running a RESTful GET on
     <code class="literal">"https://localhost:8443/openidm/recon"</code>. The following
     example displays all reconciliation runs.
    </p><div class="screen"><pre>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/recon"
    </pre></div><p>
     The output of such a request is similar to the following, with one item for
     each reconciliation run.
    </p><div class="screen"><pre>{
   "reconciliations": [
     {
       "ended": "2014-03-06T06:14:11.845Z",
       "_id": "4286510e-986a-4521-bfa4-8cd1e039a7f5",
       "mapping": "systemLdapAccounts_managedUser",
       "state": "SUCCESS",
       "stage": "COMPLETED_SUCCESS",
       "stageDescription": "reconciliation completed.",
       "progress": {
         "links": {
           "created": 1,
           "existing": {
           "total": "0",
           "processed": 0
         }
       },
       "target": {
         "created": 1,
         "existing": {
           "total": "2",
           "processed": 2
         }
       },
       "source": {
         "existing": {
           "total": "1",
           "processed": 1
         }
       }
     },
     "situationSummary": {
       "UNASSIGNED": 2,
       "TARGET_IGNORED": 0,
       "SOURCE_IGNORED": 0,
       "MISSING": 0,
       "FOUND": 0,
       "AMBIGUOUS": 0,
       "UNQUALIFIED": 0,
       "CONFIRMED": 0,
       "SOURCE_MISSING": 0,
       "ABSENT": 1
     },
     "started": "2014-03-06T06:14:04.722Z"
   },
 ]
}</pre></div><div class="variablelist"><p>
      Each reconciliation run has the following properties:
     </p><dl class="variablelist"><dt><span class="term"><code class="literal">_id</code></span></dt><dd><p>
        The ID of the reconciliation run.
       </p></dd><dt><span class="term"><code class="literal">mapping</code></span></dt><dd><p>
        The name of the mapping, defined in the <code class="filename">conf/sync.json</code>
        file.
       </p></dd><dt><span class="term"><code class="literal">state</code></span></dt><dd><p>
        The high level state of the reconciliation run. Values can be as follows:
       </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">ACTIVE</code>
         </p><p>
          The reconciliation run is in progress.
         </p></li><li class="listitem"><p>
          <code class="literal">CANCELED</code>
         </p><p>
          The reconciliation run was successfully canceled.
         </p></li><li class="listitem"><p>
          <code class="literal">FAILED</code>
         </p><p>
          The reconciliation run was terminated because of failure.
         </p></li><li class="listitem"><p>
          <code class="literal">SUCCESS</code>
         </p><p>
          The reconciliation run completed successfully.
         </p></li></ul></div></dd><dt><span class="term"><code class="literal">stage</code></span></dt><dd><p>
        The current stage of the reconciliation run's progress. Values can be as
        follows:
       </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">ACTIVE_INITIALIZED</code>
         </p><p>
          The initial stage, when a reconciliation run is first created.
         </p></li><li class="listitem"><p>
          <code class="literal">ACTIVE_QUERY_ENTRIES</code>
         </p><p>
          Querying the source, target and possibly link sets to reconcile.
         </p></li><li class="listitem"><p>
          <code class="literal">ACTIVE_RECONCILING_SOURCE</code>
         </p><p>
          Reconciling the set of IDs retrieved from the mapping source.
         </p></li><li class="listitem"><p>
          <code class="literal">ACTIVE_RECONCILING_TARGET</code>
         </p><p>
          Reconciling any remaining entries from the set of IDs retrieved from
          the mapping target, that were not matched or processed during the
          source phase.
         </p></li><li class="listitem"><p>
          <code class="literal">ACTIVE_LINK_CLEANUP</code>
         </p><p>
          Checking whether any links are now unused and should be cleaned up.
         </p></li><li class="listitem"><p>
          <code class="literal">ACTIVE_PROCESSING_RESULTS</code>
         </p><p>
          Post-processing of reconciliation results.
         </p></li><li class="listitem"><p>
          <code class="literal">ACTIVE_CANCELING</code>
         </p><p>
          Attempting to abort a reconciliation run in progress.
         </p></li><li class="listitem"><p>
          <code class="literal">COMPLETED_SUCCESS</code>
         </p><p>
          Successfully completed processing the reconciliation run.
         </p></li><li class="listitem"><p>
          <code class="literal">COMPLETED_CANCELED</code>
         </p><p>
          Completed processing because the reconciliation run was aborted.
         </p></li><li class="listitem"><p>
          <code class="literal">COMPLETED_FAILED</code>
         </p><p>
          Completed processing because of a failure.
         </p></li></ul></div></dd><dt><span class="term"><code class="literal">stageDescription</code></span></dt><dd><p>
        A description of the stages described previously.
       </p></dd><dt><span class="term"><code class="literal">progress</code></span></dt><dd><p>
        The progress object has the following structure (annotated here with
        comments):
       </p><pre class="brush: javascript;">
"progress":{
  "source":{             // Progress on set of existing entries in the mapping source
    "existing":{
      "processed":1001,
        "total":"1001"   // Total number of entries in source set, if known, &#8220;?&#8221; otherwise
    }
  },
  "target":{             // Progress on set of existing entries in the mapping target
    "existing":{
      "processed":1001,
      "total":"1001"     // Total number of entries in target set, if known, &#8220;?&#8221; otherwise
    },
    "created":0          // New entries that were created
  },
  "links":{              // Progress on set of existing links between source and target
    "existing":{
      "processed":1001,
      "total":"1001"     // Total number of existing links, if known, &#8220;?&#8221; otherwise
    },
  "created":0            // Denotes new links that were created
  }
},
       </pre></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="livesync-over-rest"></a>11.4.5.&nbsp;Triggering LiveSync Over REST</h3></div></div></div><p>
    The ability to trigger LiveSync operations over REST, or by using the
    resource API, enables you to use an external scheduler to trigger a LiveSync
    operation, rather than using the OpenIDM scheduling mechanism.
   </p><div class="itemizedlist"><p>
     There are two ways in which to trigger a LiveSync operation over REST.
    </p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
      Use the <code class="literal">_action=liveSync</code> parameter directly on the
      resource. This is the recommended method. The following example calls a
      LiveSync operation on the user accounts in an external LDAP system.
     </p><div class="screen"><pre>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 "https://localhost:8443/openidm/system/ldap/account?_action=liveSync"</pre></div></li><li class="listitem"><p>
      Target the <code class="literal">system</code> endpoint and supply a
      <code class="literal">source</code> parameter to identify the object that should be
      synchronized. This method matches the scheduler configuration and can
      therefore be used to test schedules before they are implemented.
     </p><p>
      The following example calls the same LiveSync operation as the previous
      example.
     </p><div class="screen"><pre>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 "https://localhost:8443/openidm/system?_action=liveSync&amp;source=system/ldap/account"</pre></div></li></ul></div><p>
    A successful LiveSync operation returns the following response:
   </p><div class="screen"><pre>{
    "_rev": "4",
    "_id": "SYSTEMLDAPACCOUNT",
    "connectorData": {
        "nativeType": "integer",
        "syncToken": 1
    }
}</pre></div><p>
    Do not run two identical LiveSync operations simultaneously - rather, ensure
    that the first operation has completed before a second similar operation is
    launched.
   </p><p>
    To troubleshoot a LiveSync operation that has not succeeded, you can include
    an optional parameter (<code class="literal">detailedFailure</code>) to return
    additional information. For example:
   </p><div class="screen"><pre>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 "https://localhost:8443/openidm/system/ldap/account?_action=liveSync&amp;detailedFailure=true"</pre></div><div class="note"><h3 class="title">Note</h3><p>
     The first time that a LiveSync operation is called, no synchronization
     token exists in the database to establish which changes have already been
     processed. The default LiveSync behavior is to locate the last existing
     entry in the change log, and to store that entry in the database as the
     current starting position from which changes should be applied. This
     behavior prevents LiveSync from processing changes that might already have
     been processed during an initial data load. Subsequent LiveSync operations
     will pick up and process any new changes.
    </p><p>
     Typically, in setting up LiveSync on a new system, you would load the data
     initially (by using reconciliation, for example) and then enable LiveSync,
     starting from that base point.
    </p></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="recon-by-query"></a>11.5.&nbsp;Restricting Reconciliation by Using Queries</h2></div></div></div><p>
   Every reconciliation operation performs a query on the source, and on the
   target resource, to determine which records should be reconciled. The default
   source and target queries are <code class="literal">query-all-ids</code>, which means
   that all records in both the source and the target are considered candidates
   for that reconciliation operation.
  </p><p>
   You can restrict reconciliation to specific entries by defining explicit
   source or target queries in the mapping configuration.
  </p><p>
   For example, to restrict reconciliation to only those records whose
   <code class="literal">employeeType</code> on the source resource is
   <code class="literal">Permanent</code>, you might specify a source query as follows:
  </p><pre class="brush: javascript;">
"mappings" : [
     {
         "name" : "managedUser_systemLdapAccounts",
         "source" : "managed/user",
         "target" : "system/ldap/account",
         "sourceQuery" : : {
                "queryFilter" : "employeeType eq \"Permanent\""
            },
...
  </pre><p>
   The format of the query can be any query type that is supported by the
   resource, and can include additional parameters, if applicable. OpenIDM
   3.0.0 supports the following query types.
  </p><div class="itemizedlist"><p>
    For queries on managed objects:
   </p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
     <code class="literal">_queryId</code> for arbitrary predefined, parameterized
     queries
    </p></li><li class="listitem"><p>
     <code class="literal">_queryExpression</code> for client-supplied queries, in native
     query format
    </p></li></ul></div><div class="itemizedlist"><p>
    For queries on system objects:
   </p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
     <code class="literal">_queryId=query-all-ids</code> (the only supported predefined
     query)
    </p></li><li class="listitem"><p>
     <code class="literal">_queryFilter</code> for arbitrary filters, in common filter
     notation
    </p></li></ul></div><p>
   The source and target queries send the query to the resource that is defined
   for that source or target, by default. You can override the resource to which
   the query is sent by specifying a <code class="literal">resourceName</code> in the
   query. For example, to query a specific endpoint instead of the source
   resource, you might modify the preceding source query as follows:
  </p><pre class="brush: javascript;">
"mappings" : [
    {
        "name" : "managedUser_systemLdapAccounts",
        "source" : "managed/user",
        "target" : "system/ldap/account",
        "sourceQuery" : {
            "resourceName" : "endpoint/scriptedQuery"
            "queryFilter" : "employeeType eq \"Permanent\""
        },
...
  </pre><p>
   To override a source or target query that is defined in the mapping, you can
   specify the query when you call the reconciliation operation. For example, if
   you wanted to reconcile all employee entries, and not just the permanent
   employees, you would run the reconciliation operation as follows:
  </p><div class="screen"><pre>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 --data '{"sourceQuery": {"_queryId" : "query-all-ids"}}' \
 "https://localhost:8443/openidm/recon?_action=recon&amp;mapping=managedUser_systemLdapAccounts"</pre></div><p>
   By default, a reconciliation operation runs both the source and target phase,
   that is both the source and the target resources are queried. To specify that
   either the source or target resource is not queried, set
   <code class="literal">runSourcePhase</code> or <code class="literal">runTargetPhase</code> to
   <code class="literal">false</code> in the mapping configuration
   (<code class="filename">conf/sync.json</code> file). For example, to prevent the
   target resource from being queried during the reconciliation operation
   configured in the previous example, you would amend the mapping configuration
   as follows:
  </p><pre class="brush: plain;">
{
    "mappings" : [
        {
            "name" : "systemLdapAccounts_managedUser",
            "source" : "system/ldap/account",
            "target" : "managed/user",
            "sourceQuery" : {
                "queryFilter" : "employeeType eq \"Permanent\""
            },
            "runTargetPhase" : false,
   ...
  </pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="recon-by-id"></a>11.6.&nbsp;Restricting Reconciliation to a Specific ID</h2></div></div></div><p>
   In the same way that you can restrict reconciliation operations to specific
   records by using queries, you can specify an ID to restrict a reconciliation
   operation to a particular record.
  </p><p>
   To restrict reconciliation to a specific ID, use the
   <code class="literal">reconById</code> action, instead of the <code class="literal">recon</code>
   action when you call the reconciliation operation. Specify the ID with the
   <code class="literal">ids</code> parameter. Currently reconciling more than one ID with
   the <code class="literal">reconById</code> action is not supported.
  </p><p>
   The following example is based on the data from Sample 2b, which maps an
   LDAP server with the OpenIDM repository. The example reconciles only the user
   <code class="literal">bjensen</code>, using the
   <code class="literal">managedUser_systemLdapAccounts</code> mapping to update the user
   account in LDAP with the data from the OpenIDM repository. The
   <code class="literal">_id</code> for <code class="literal">bjensen</code> in this example is
   <code class="literal">b3c2f414-e7b3-46aa-8ce6-f4ab1e89288c</code>.
   The example assumes that automatic synchronization has been disabled and that
   a reconciliation operation is required to copy changes made in the repository
   to the LDAP system.
  </p><div class="screen"><pre>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 "https://localhost:8443/openidm/recon?_action=reconById&amp;mapping=managedUser_systemLdapAccounts&amp;ids=b3c2f414-e7b3-46aa-8ce6-f4ab1e89288c"</pre></div><p>
   A reconciliation by ID takes the default reconciliation options that are
   specified in the mapping, so the source and target queries, and source and
   target phases described in the previous section apply equally to
   reconciliation by ID.
  </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="querying-recon-logs"></a>11.7.&nbsp;Querying the Reconciliation Audit Log</h2></div></div></div><p>
     Reconciliation operations are logged in the file
     <code class="filename">/path/to/openidm/audit/recon.csv</code> and in the
     repository. You can read and query the reconciliation audit logs over the
     REST interface, as outlined in the following examples.
  </p><p>
     By default all <code class="literal">audit/recon</code> query responses are formatted
     based on the <code class="literal">entryType</code> of the entry. Fields that are not
     required for the specific entry type are stripped away from the response.
     For example, a <code class="literal">summary</code> entry would not need to include a
     null <code class="literal">targetObjectId</code> field, as this would not add
     information to a summary. You can specify that this auto-formatting be
     disabled and return the full entry for all entry types. To disable entry
     formatting, include <code class="literal">formatted=false</code> as a query parameter
     in the request.
    </p><p>
     To return all reconciliation operations logged in the audit log, run a
     RESTful GET on the <code class="literal">audit/recon</code> endpoint. For example:
    </p><div class="screen"><pre>
$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/audit/recon"</strong></pre></div><p>
     The following code sample shows an extract of the audit log after the first
     reconciliation operation in Sample 1.
    </p><pre class="brush: javascript;">{
  "entries": [
    {
      "rootActionId": "d0578abf-f38e-4ede-a7dc-5ee9eaa8ce53",
      "messageDetail": null,
      "message": "Reconciliation initiated by openidm-admin",
      "timestamp": "2013-05-08T07:58:33.296Z",
      "reconId": "5cf09dfa-e85c-4d52-ab6c-8ba7c2e3d34f",
      "entryType": "start",
      "_id": "11381e20-3679-469d-a71c-c557c2bd091e",
      "status": "SUCCESS",
      "exception": "",
      "mapping": "systemXmlfileAccounts_managedUser"
    },
    {
      "messageDetail": null,
      "rootActionId": "d0578abf-f38e-4ede-a7dc-5ee9eaa8ce53",
      "situation": "ABSENT",
      "actionId": "86995423-8a43-4fc7-9c3c-9e450e0234cb",
      "targetObjectId": "managed/user/scarter",
      "action": "CREATE",
      "entryType": "",
      "_id": "9f59bb8a-31c6-41af-8f27-02094391ba0c",
      "reconId": "5cf09dfa-e85c-4d52-ab6c-8ba7c2e3d34f",
      "status": "SUCCESS",
      "exception": "",
      "reconciling": "source",
      "ambiguousTargetObjectIds": "",
      "timestamp": "2013-05-08T07:58:33.791Z",
      "message": null,
      "sourceObjectId": "system/xmlfile/account/scarter"
    },
    {
      "messageDetail": null,
      "rootActionId": "d0578abf-f38e-4ede-a7dc-5ee9eaa8ce53",
      "situation": "ABSENT",
      "actionId": "dea9b5c5-7a75-4cab-b8e4-176bea0a94a6",
      "targetObjectId": "managed/user/bjensen",
      "action": "CREATE",
      "entryType": "",
      "_id": "4fd285ef-a409-4875-abd0-5d70965fe172",
      "reconId": "5cf09dfa-e85c-4d52-ab6c-8ba7c2e3d34f",
      "status": "SUCCESS",
      "exception": "",
      "reconciling": "source",
      "ambiguousTargetObjectIds": "",
      "timestamp": "2013-05-08T07:58:33.793Z",
      "message": null,
      "sourceObjectId": "system/xmlfile/account/bjensen"
      },
      {
        "rootActionId": "d0578abf-f38e-4ede-a7dc-5ee9eaa8ce53",
        "messageDetail": {
          "ended": "2013-05-08T07:58:33.813Z",
          "started": "2013-05-08T07:58:33.294Z",
          "situationSummary": {
            "SOURCE_MISSING": 0,
            "FOUND": 0,
            "SOURCE_IGNORED": 0,
            "UNQUALIFIED": 0,
            "UNASSIGNED": 0,
            "TARGET_IGNORED": 0,
            "CONFIRMED": 0,
            "AMBIGUOUS": 0,
            "ABSENT": 2,
            "MISSING": 0
          },
          "progress": {
            "links": {
              "created": 2,
              "existing": {
                "total": "0",
                "processed": 0
              }
            },
            "target": {
              "created": 2,
              "existing": {
                "total": "0",
                "processed": 0
              }
            },
            "source": {
              "existing": {
                "total": "2",
                "processed": 2
              }
            }
          },
          "stageDescription": "reconciling target entries",
          "stage": "ACTIVE_RECONCILING_TARGET",
          "state": "ACTIVE",
          "mapping": "systemXmlfileAccounts_managedUser"
        },
        "message": "SOURCE_IGNORED: 0 MISSING: 0 FOUND: 0 AMBIGUOUS: 0 UNQUALIFIED: 0
           CONFIRMED: 0 SOURCE_MISSING: 0 ABSENT: 2 TARGET_IGNORED: 0 UNASSIGNED: 0 ",
        "timestamp": "2013-05-08T07:58:33.813Z",
        "reconId": "5cf09dfa-e85c-4d52-ab6c-8ba7c2e3d34f",
        "entryType": "summary",
        "_id": "a8a81f9f-fa8f-49f4-a0d6-c88b5fc4be2a",
        "status": "SUCCESS",
        "exception": "",
        "mapping": "systemXmlfileAccounts_managedUser"
      }
    ]
}    </pre><p>
     Most of the fields in this audit log are self-explanatory. Each distinct
     reconciliation operation is identified by its <code class="literal">reconId</code>.
     Each entry in the log is identified by a unique <code class="literal">_id</code>. The
     first log entry indicates the status for the complete reconciliation
     operation. Successive entries indicate the status for each record affected
     by the reconciliation.
    </p><p>
     To obtain information on a specific audit log entry, include its entry
     <code class="literal">_id</code> in the URL. For example:
    </p><div class="screen"><pre>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/audit/recon/9f59bb8a-31c6-41af-8f27-02094391ba0c"</pre></div><p>
     The following sample output shows the results of a read operation on a
     specific reconciliation audit entry.
    </p><pre class="brush: javascript;">{
 "targetObjectId": "managed/user/5b9b75e8-2667-4040-a50d-7a644922f072",
 "sourceObjectId": "system/ldap/account/uid=jdoe,ou=People,dc=example,dc=com",
 "situation": "CONFIRMED",
 "reconciling": "source",
 "ambiguousTargetObjectIds": "",
 "action": "UPDATE",
 "actionId": "a0c8ea66-8798-451d-a55c-9d4b95f0941e",
 "exception": "",
 "_id": "88802a56-8be9-43bf-aaf9-d861820f3e39",
 "entryType": "",
 "timestamp": "2014-03-06T06:59:14.637Z",
 "reconId": "a0c8ea66-8798-451d-a55c-9d4b95f0941e",
 "rootActionId": "a0c8ea66-8798-451d-a55c-9d4b95f0941e",
 "status": "SUCCESS",
 "message": null,
 "messageDetail": null
}   </pre><p>
     To query the audit log for a particular reconciliation operation, use the
     <code class="literal">audit-by-recon-id</code> keyword, specifying the reconciliation
     ID, as follows:
    </p><div class="screen"><pre>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/audit/recon?_queryId=audit-by-recon-id&amp;reconId=&lt;reconID&gt;"</pre></div><p>
     Output similar to the following is returned, for the specified
     reconciliation operation:
    </p><pre class="brush: javascript;">{
 "remainingPagedResults": -1,
 "pagedResultsCookie": null,
 "resultCount": 5,
 "result": [
   {
     "mapping": "systemLdapAccounts_managedUser",
     "exception": "",
     "_id": "e8932aef-31ad-43e8-ab5a-c997b247ab9d",
     "entryType": "summary",
     "timestamp": "2014-03-06T06:59:14.691Z",
     "reconId": "a0c8ea66-8798-451d-a55c-9d4b95f0941e",
     "rootActionId": "a0c8ea66-8798-451d-a55c-9d4b95f0941e",
     "status": "SUCCESS",
     "message": "SOURCE_IGNORED: 0 MISSING: 0 FOUND: 0 AMBIGUOUS: 0 UNQUALIFIED: 0
         CONFIRMED: 1 SOURCE_MISSING: 0 ABSENT: 0 TARGET_IGNORED: 0 UNASSIGNED: 2 ",
     "messageDetail": {
       "stage": "ACTIVE_RECONCILING_TARGET",
       "stageDescription": "reconciling target entries",
       "ended": "2014-03-06T06:59:14.691Z",
       "started": "2014-03-06T06:59:14.353Z",
       "mapping": "systemLdapAccounts_managedUser",
       "state": "ACTIVE",
       "situationSummary": {
         "SOURCE_MISSING": 0,
         "FOUND": 0,
         "SOURCE_IGNORED": 0,
         "UNQUALIFIED": 0,
         "UNASSIGNED": 2,
         "TARGET_IGNORED": 0,
         "CONFIRMED": 1,
         "AMBIGUOUS": 0,
         "ABSENT": 0,
         "MISSING": 0
       },
       "progress": {
         "links": {
           "created": 0,
           "existing": {
             "processed": 1,
             "total": "1"
           }
         },
       "source": {
         "existing": {
           "processed": 1,
           "total": "1"
         }
       },
       "target": {
         "created": 0,
         "existing": {
           "processed": 3,
           "total": "3"
         }
       }
     }
   }
 },
 {
   "targetObjectId": "managed/user/e8b93d84-5295-4286-b951-cea07550a331",
   "sourceObjectId": null,
   "situation": "UNASSIGNED",
   "reconciling": "target",
   "ambiguousTargetObjectIds": null,
   "action": "IGNORE",
   "actionId": null,
   "exception": "",
   "_id": "7878e924-0aa6-46a9-8d42-716eae098121",
   "entryType": "",
   "timestamp": "2014-03-06T06:59:14.674Z",
   "reconId": "a0c8ea66-8798-451d-a55c-9d4b95f0941e",
   "rootActionId": "a0c8ea66-8798-451d-a55c-9d4b95f0941e",
   "status": "SUCCESS",
   "message": null,
   "messageDetail": null
 },
 {
   "targetObjectId": "managed/user/0e4cfe5e-3d9d-4d74-acf4-596f610eda5a",
   "sourceObjectId": null,
   "situation": "UNASSIGNED",
   "reconciling": "target",
   "ambiguousTargetObjectIds": null,
   "action": "IGNORE",
   "actionId": null,
   "exception": "",
   "_id": "795d1616-9ec7-44c7-80f5-bc7c566bd2fe",
   "entryType": "",
   "timestamp": "2014-03-06T06:59:14.653Z",
   "reconId": "a0c8ea66-8798-451d-a55c-9d4b95f0941e",
   "rootActionId": "a0c8ea66-8798-451d-a55c-9d4b95f0941e",
   "status": "SUCCESS",
   "message": null,
   "messageDetail": null
 },
 {
   "targetObjectId": "managed/user/5b9b75e8-2667-4040-a50d-7a644922f072",
   "sourceObjectId": "system/ldap/account/uid=jdoe,ou=People,dc=example,dc=com",
   "situation": "CONFIRMED",
   "reconciling": "source",
   "ambiguousTargetObjectIds": "",
   "action": "UPDATE",
   "actionId": "a0c8ea66-8798-451d-a55c-9d4b95f0941e",
   "exception": "",
   "_id": "88802a56-8be9-43bf-aaf9-d861820f3e39",
   "entryType": "",
   "timestamp": "2014-03-06T06:59:14.637Z",
   "reconId": "a0c8ea66-8798-451d-a55c-9d4b95f0941e",
   "rootActionId": "a0c8ea66-8798-451d-a55c-9d4b95f0941e",
   "status": "SUCCESS",
   "message": null,
   "messageDetail": null
 },
 {
   "mapping": "systemLdapAccounts_managedUser",
   "exception": "",
   "_id": "91c00e7f-1975-4f68-bfba-7740e8f05ec5",
   "entryType": "start",
   "timestamp": "2014-03-06T06:59:14.354Z",
   "reconId": "a0c8ea66-8798-451d-a55c-9d4b95f0941e",
   "rootActionId": "a0c8ea66-8798-451d-a55c-9d4b95f0941e",
   "status": "SUCCESS",
   "message": "Reconciliation initiated by openidm-admin",
   "messageDetail": null
 }
]
}</pre><p>
     To query the audit log for a specific reconciliation situation, use the
     <code class="literal">audit-by-recon-id-situation</code> keyword, specifying the
     reconciliation ID and the situation that you want to query. For example,
     the following query returns all ABSENT records found during the specified
     reconciliation operation:
    </p><div class="screen"><pre>
$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/audit/recon?_queryId=audit-by-recon-id-situation&amp;situation=ABSENT&amp;reconId=fd2a59df-1fcd-444d-97ca-2c8a7ec6dc6c"</strong>
    </pre></div><p>
     Output similar to the following is returned, with one entry for each record
     that matches the situation queried:
    </p><pre class="brush: javascript;">{
  "result": [
    {
      "messageDetail": null,
      "rootActionId": "3c098d6f-a5e5-483c-a8ce-82911a10b0a9",
      "situation": "ABSENT",
      "actionId": "1a391fe8-201b-4f59-ad05-92ee804488a8",
      "targetObjectId": "managed/user/scarter",
      "action": "CREATE",
      "entryType": "",
      "_id": "6dc0a18a-826d-487d-a29f-5cd8d2f55465",
      "reconId": "1ef8e7b6-33dc-4f92-810a-b51913508a68",
      "status": "SUCCESS",
      "exception": "",
      "reconciling": "source",
      "ambiguousTargetObjectIds": "",
      "timestamp": "2013-05-14T08:20:41.763Z",
      "message": null,
      "sourceObjectId": "system/xmlfile/account/scarter"
    },
    {
      "messageDetail": null,
      "rootActionId": "3c098d6f-a5e5-483c-a8ce-82911a10b0a9",
      "situation": "ABSENT",
      "actionId": "0aaba292-1dd3-4e98-a0e2-04bec9ae5209",
      "targetObjectId": "managed/user/bjensen",
      "action": "CREATE",
      "entryType": "",
      "_id": "1cda457e-54e2-451b-8a40-ef93dec7e60c",
      "reconId": "1ef8e7b6-33dc-4f92-810a-b51913508a68",
      "status": "SUCCESS",
      "exception": "",
      "reconciling": "source",
      "ambiguousTargetObjectIds": "",
      "timestamp": "2013-05-14T08:20:41.760Z",
      "message": null,
      "sourceObjectId": "system/xmlfile/account/bjensen"
    }
  ]
}   </pre><p>
     The activity logs track all operations on internal (managed) and external
     (system) objects. Entries in the activity log contain identifiers for the
     reconciliation or synchronization action that triggered the activity, and
     for the original caller and the relationships between related actions.
    </p><p>
     You can access the activity logs over REST with the following call:
    </p><div class="screen"><pre>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/audit/activity"</pre></div><p>
     The following extract of the activity log shows the last entry in the log,
     which was a password change for user bjensen.
    </p><pre class="brush: javascript;">{
   "entries": [
   ...
   },
     "before": null,
     "requester": "openidm-admin",
     "parentActionId": "c2c102bc-7b32-4020-b5aa-9a7d63652cb6",
     "_id": "bbaff1e0-923b-48f0-b053-b1614cbb3647",
     "activityId": "c2c102bc-7b32-4020-b5aa-9a7d63652cb6",
     "timestamp": "2014-03-13T16:20:54.811Z",
     "action": "CREATE",
     "message": "create",
     "objectId": "managed/user/4f2f5eea-918a-4ef1-9244-be41dcf128a4",
     "rev": "1",
     "rootActionId": "c2c102bc-7b32-4020-b5aa-9a7d63652cb6"
   },
   {
     "passwordChanged": true,
     "changedFields": [
     "/password"
   ],
     "status": "SUCCESS",
     "after": {
       "securityAnswer": {
         "$crypto": {
           "value": {
             "key": "openidm-sym-default",
             "iv": "8CvlA6rWN03MAhLSKJmbvw==",
             "cipher": "AES/CBC/PKCS5Padding",
             "data": "oJBTrrX+wFAygFZkLuGPrhB/jAIICcdIBuCX1eEbpS0="
           },
           "type": "x-simple-encryption"
         }
       },
   ...
  </pre><p>
     To return activity information for a specific action, include the
     <code class="literal">_id</code> of the action in the endpoint, for example:
    </p><div class="screen"><pre>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/audit/activity/22ef6d20-bd84-4267-9db8-745825a46ad1"</pre></div><p>
     Results similar to the following are returned:
    </p><pre class="brush: javascript;">{
  "passwordChanged": true,
  "changedFields": [
    "/password"
  ],
  "status": "SUCCESS",
  "after": {
    "securityAnswer": {
      "$crypto": {
      "value": {
        "key": "openidm-sym-default",
        "iv": "HpsyTtTXc2pfNrXlYbro7Q==",
        "cipher": "AES/CBC/PKCS5Padding",
        "data": "0M6O7geNjalJ7e0EGSG9B90eaeF8zJuogdL74hcAIRg="
      },
      "type": "x-simple-encryption"
    }
  },
  "userName": "bjensen@example.com",
  "stateProvince": "",
  "postalAddress": "",
  "effectiveAssignments": {},
  "roles": "openidm-authorized",
  "telephoneNumber": "1234567",
  "accountStatus": "active",
  "password": {
    "$crypto": {
      "value": {
        "key": "openidm-sym-default",
        "iv": "dkRjURz761HaObBuLl+EkA==",
        "cipher": "AES/CBC/PKCS5Padding",
        "data": "9chNPUlXotHy195ERj6vlg=="
      },
      "type": "x-simple-encryption"
    }
  },
  "effectiveRoles": [
    "openidm-authorized"
  ],
  "givenName": "Barbara",
  "lastPasswordAttempt": "Thu Mar 13 2014 07:23:12 GMT-0800 (GMT-08:00)",
  "address2": "",
  "passwordAttempts": "0",
  "sn": "Jensen",
  "mail": "bjensen@example.com",
  "securityQuestion": "1",
  "city": "",
  "country": "",
  "_rev": "7",
  "lastPasswordSet": "",
  "postalCode": "",
  "_id": "bjensen",
  "description": "Created By XML1"
},
  "before": {
  "securityAnswer": "Some security answer",
  "userName": "bjensen@example.com",
  "stateProvince": "",
  "postalAddress": "",
  "roles": "openidm-authorized",
  "telephoneNumber": "1234567",
  "password": {
    "$crypto": {
      "value": {
        "key": "openidm-sym-default",
        "iv": "bqhRyLW1lI+KZROcpgyukg==",
        "cipher": "AES/CBC/PKCS5Padding",
        "data": "qO8A76GqNqftVVwOlasyPw=="
      },
      "type": "x-simple-encryption",
    "securityQuestion": "1",
  "givenName": "Barbara",
  "address2": "",
  "lastPasswordAttempt": "Thu Mar 13 2014 07:23:12 GMT-0800 (GMT-08:00)",
  "passwordAttempts": "0",
  "sn": "Jensen",
  "mail": "bjensen@example.com",
  "country": "",
  "city": "",
  "_rev": "7",
  "lastPasswordSet": "",
  "postalCode": "",
  "_id": "bjensen",
  "description": "Created By XML1",
  "accountStatus": "active"
},
"requester": "openidm-admin",
"parentActionId": "71ddeed8-9006-4578-b869-13e15a3ce6b5",
"_id": "ee88adb8-3329-4f81-a8f2-d9c8e0fbf72b",
"activityId": "71ddeed8-9006-4578-b869-13e15a3ce6b5",
"timestamp": "2014-03-13T16:21:27.086Z",
"action": "UPDATE",
"message": "update",
"objectId": "managed/user/bjensen",
"rev": "7",
"rootActionId": "71ddeed8-9006-4578-b869-13e15a3ce6b5"
}    </pre><p>
     Each action in the activity log has a <code class="literal">rootActionId</code> and a
     <code class="literal">parentActionId</code>. The <code class="literal">rootActionId</code> is
     the ID that was assigned to the incoming or initiating request. The
     <code class="literal">parentActionId</code> is the ID that is associated with the
     overall action. So, for example, if an HTTP request invokes a script that
     changes a user's password, the HTTP request is assigned the
     <code class="literal">rootActionId</code> and the action taken by the script is
     assigned the <code class="literal">parentActionId</code>. You can query the activity
     log for the details of a specific action by including the
     <code class="literal">parentActionId</code> in the query. For example:
    </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/audit/activity?_queryId=audit-by-activity-parent-action&amp;parentActionId=0aaba292-1dd3-4e98-a0e2-04bec9ae5209"</strong></pre></div><p>
     The following sample output shows the result of a query that requests
     details of the password change for bjensen.
    </p><pre class="brush: javascript;">{
  "remainingPagedResults": -1,
  "pagedResultsCookie": null,
  "resultCount": 2,
  "result": [
    {
      "rootActionId": "71ddeed8-9006-4578-b869-13e15a3ce6b5",
      "changedFields": [
        "/password"
    ],
      "action": "UPDATE",
      "objectId": "managed/user/bjensen",
      "before": {
        "securityAnswer": "Some security answer",
        "userName": "bjensen@example.com",
        "stateProvince": "",
        "postalAddress": "",
        "roles": "openidm-authorized",
        "telephoneNumber": "1234567",
        "password": "CAngetin1",
        "securityQuestion": "1",
        "givenName": "Barbara",
        "address2": "",
        "lastPasswordAttempt": "Thu Mar 13 2014 07:23:12 GMT-0800 (GMT-08:00)",
        "passwordAttempts": "0",
        "sn": "Jensen",
        "mail": "bjensen@example.com",
        "country": "",
        "city": "",
        "_rev": "7",
        "lastPasswordSet": "",
        "postalCode": "",
        "_id": "bjensen",
        "description": "Created By XML1",
        "accountStatus": "active"
      },
      "status": "SUCCESS",
      "_rev": "1",
      "_id": "ee88adb8-3329-4f81-a8f2-d9c8e0fbf72b",
      "parentActionId": "71ddeed8-9006-4578-b869-13e15a3ce6b5",
      "timestamp": "2014-03-13T16:21:27.086Z",
      "message": "update",
      "activityId": "71ddeed8-9006-4578-b869-13e15a3ce6b5",
      "after": {
        "securityAnswer": {
          "$crypto": {
            "value": {
              "key": "openidm-sym-default",
              "iv": "HpsyTtTXc2pfNrXlYbro7Q==",
              "cipher": "AES/CBC/PKCS5Padding",
              "data": "0M6O7geNjalJ7e0EGSG9B90eaeF8zJuogdL74hcAIRg="
            },
            "type": "x-simple-encryption"
          }
        },
        "userName": "bjensen@example.com",
        "stateProvince": "",
        "postalAddress": "",
        "effectiveAssignments": {},
        "roles": "openidm-authorized",
        "telephoneNumber": "1234567",
        "accountStatus": "active",
        "password": {
          "$crypto": {
            "value": {
              "key": "openidm-sym-default",
              "iv": "dkRjURz761HaObBuLl+EkA==",
              "cipher": "AES/CBC/PKCS5Padding",
              "data": "9chNPUlXotHy195ERj6vlg=="
          },
        "type": "x-simple-encryption"
      }
    },
    "effectiveRoles": [
       "openidm-authorized"
    ],
    "givenName": "Barbara",
    "lastPasswordAttempt": "Thu Mar 13 2014 07:23:12 GMT-0800 (GMT-08:00)",
    "address2": "",
    "passwordAttempts": "0",
    "sn": "Jensen",
    "mail": "bjensen@example.com",
    "securityQuestion": "1",
    "city": "",
    "country": "",
    "_rev": "7",
    "lastPasswordSet": "",
    "postalCode": "",
    "_id": "bjensen",
    "description": "Created By XML1"
  },
  "rev": "7",
  "requester": "openidm-admin",
  "passwordChanged": true
  }
 ]
}</pre><div class="note"><h3 class="title">Note</h3><p>
      For audit logs in the repository, you can define custom queries using the
      parameterized query mechanism. For more information, see the section on
      <a href="../integrators-guide/index.html#parameterized-queries" class="link"><em class="citetitle">Parameterized
      Queries</em></a>.
     </p></div><p>
     For more information about the entries in these logs, see the chapter that
     covers <a href="../integrators-guide/index.html#chap-auditing" class="link"><em class="citetitle">Using Audit
     Logs</em></a>.
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="livesync-retry-strategy"></a>11.8.&nbsp;Configuring the LiveSync Retry Policy</h2></div></div></div><p>
    OpenIDM enables you to specify what should happen if a LiveSync operation
    reports a failure for an operation. By configuring the LiveSync retry
    policy, you can specify how many times a failed modification should be
    reattempted and what should happen in the event that the modification is
    unsuccessful after the specified number of attempts. If no retry policy is
    configured, OpenIDM reattempts the change an infinite number of times, until
    the change is successful. This behavior can increase data consistency in the
    case of transient failures (for example, when the connection to the database
    is temporarily lost). However, in situations where the cause of the failure
    is permanent (for example, if the change does not meet certain policy
    requirements) the change will never succeed, regardless of the number of
    attempts. In this case, the infinite retry behavior can effectively block
    subsequent LiveSync operations from starting.
   </p><p>
    Generally, a scheduled reconciliation operation will eventually force
    consistency. However, to prevent repeated retries that block the LiveSync
    mechanism, you should restrict the number of times OpenIDM reattempts the
    same modification. You can then specify what OpenIDM does with failed
    LiveSync changes. The failed modification can be stored in a "dead letter
    queue", discarded, or reapplied. Alternatively, an administrator can be
    notified of the failure by email or by some other means. This behavior can
    be scripted. The default configuration, in the samples provided with
    OpenIDM, is to retry a failed modification five times, and then to log and
    ignore the failure.
   </p><p>
    The LiveSync retry policy is configured in the connector configuration file
    (<code class="filename">provisioner.openicf-*.json</code>). The sample connector
    configuration files have a retry policy defined as follows:
   </p><pre class="brush: javascript;">
"syncFailureHandler" : {
  "maxRetries" : 5,
  "postRetryAction" : "logged-ignore"
},
   </pre><p>
    The <code class="literal">maxRetries</code> field specifies the number of attempts
    that OpenIDM should make to process the failed modification. The value of
    this property must be a positive integer, or <code class="literal">-1</code>. A value
    of zero indicates that failed modifications should not be reattempted. In
    this case, the post retry action is executed immediately when a LiveSync
    operation fails. A value of <code class="literal">-1</code> (or omitting the
    <code class="literal">maxRetries</code> property, or the entire
    <code class="literal">syncFailureHandler</code> from the configuration) indicates that
    failed modifications should be retried an infinite number of times. In this
    case, no post retry action is executed.
   </p><p>
    The default retry policy relies on the scheduler, or whatever invokes the
    LiveSync operation. Therefore, if retries are enabled and a LiveSync
    modification fails, OpenIDM will retry the modification the next time that
    LiveSync is invoked.
   </p><p>
    The <code class="literal">postRetryAction</code> field indicates what action OpenIDM
    should take in the event that the maximum number of retries has been reached
    (or if <code class="literal">maxRetries</code> has been set to zero). The post retry
    action can be one of the following:
   </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
      <code class="literal">logged-ignore</code> indicates that OpenIDM should ignore the
      failed modification, and log its occurrence.
     </p></li><li class="listitem"><p>
      <code class="literal">dead-letter-queue</code> indicates that OpenIDM should save
      the details of the failed modification in a table in the repository
      (accessible over REST at
      <code class="literal">repo/synchronisation/deadLetterQueue/<em class="replaceable"><code>provisioner-name</code></em></code>).
     </p></li><li class="listitem"><p>
      <code class="literal">script</code> specifies a custom script that should be
      executed when the maximum number of retries has been reached. For
      information about using custom scripts in the configuration, see the
      <a href="../integrators-guide/index.html#appendix-scripting" class="link"><em class="citetitle">Scripting
      Reference</em></a>.
     </p><p>
      In addition to the regular objects described in the Scripting Reference,
      the following objects are available in the script scope:
     </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
        <code class="literal">syncFailure</code>
       </p><p>
        Provides details about the failed record. The structure of the
        <code class="literal">syncFailure</code> object is as follows:
       </p><pre class="brush: javascript;">
"syncFailure" :
  {
    "token" : the ID of the token,
    "systemIdentifier" : a string identifier that matches the "name" property in
                         provisioner.openicf.json,
    "objectType" : the object type being synced, one of the keys in the
                   "objectTypes" property in provisioner.openicf.json,
    "uid" : the UID of the object (for example uid=joe,ou=People,dc=example,dc=com),
    "failedRecord", the record that failed to synchronize
  },
       </pre><p>
        To access these fields, include
        <code class="literal">syncFailure.<em class="replaceable"><code>fieldname</code></em></code> in
        your script.
       </p></li><li class="listitem"><p>
        <code class="literal">failureCause</code>
       </p><p>
        Provides the exception that caused the original LiveSync failure.
       </p></li><li class="listitem"><p>
        <code class="literal">failureHandlers</code>
       </p><p>
        OpenIDM currently provides two synchronization failure handlers "out of
        the box". <code class="literal">loggedIgnore</code> indicates that the failure
        should be logged, after which no further action should be taken.
        <code class="literal">deadLetterQueue</code> indicates that the failed record
        should be written to a specific table in the repository, where further
        action can be taken. To invoke one of the internal failure handlers from
        your script, use a call similar to the following (shown here for
        JavaScript):
       </p><div class="screen"><pre>failureHandlers.deadLetterQueue.invoke(syncFailure, failureCause);</pre></div></li></ul></div><p>
      Two sample scripts are provided in
      <code class="filename">path/to/openidm/samples/syncfailure/script</code>, one that
      logs failures, and one that sends them to the dead letter queue in the
      repository.</p></li></ul></div><p>
     The following sample provisioner configuration file extract shows a
     LiveSync retry policy that specifies a maximum of four retries before the
     failed modification is sent to the dead letter queue.
    </p><pre class="brush: javascript;">
...
"connectorName" : "org.identityconnectors.ldap.LdapConnector"
    },
    "syncFailureHandler" : {
        "maxRetries" : 4,
        "postRetryAction" : dead-letter-queue
    },
    "poolConfigOption" : {
...
    </pre><p>
     In the case of a failed modification, a message similar to the following is
     output to the log file:
    </p><div class="screen"><pre>INFO: sync retries = 1/4, retrying</pre></div><p>
     OpenIDM reattempts the modification, the specified number of times. If the
     modification is still unsuccessful, a message similar to the following is
     logged:
    </p><div class="screen"><pre>INFO: sync retries = 4/4, retries exhausted
Jul 19, 2013 11:59:30 AM
    org.forgerock.openidm.provisioner.openicf.syncfailure.DeadLetterQueueHandler invoke
INFO: uid=jdoe,ou=people,dc=example,dc=com saved to dead letter queue
    </pre></div><p>
     The log message indicates the entry for which the modification failed
     (<code class="literal">uid=jdoe</code>, in this example).
    </p><p>You can view the failed modification in the dead letter queue, over
     the REST interface, as follows:
    </p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/repo/synchronisation/deadLetterQueue/ldap?_queryId=query-all-ids"</strong>
     <em>{
       "query-time-ms": 2,
       "result":
       [
           {
               "_id": "4",
               "_rev": "0"
           }
       ],
       "conversion-time-ms": 0
    }</em></pre></div><p>
     To view the details of a specific failed modification, include its ID in
     the URL:
    </p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/repo/synchronisation/deadLetterQueue/ldap/4"</strong>
     <em>{
  "objectType": "account",
  "systemIdentifier": "ldap",
  "failureCause": "org.forgerock.openidm.sync.SynchronizationException:
            org.forgerock.openidm.objset.ConflictException:
            org.forgerock.openidm.sync.SynchronizationException:
            org.forgerock.openidm.script.ScriptException:
            ReferenceError: \"bad\" is not defined.
            (PropertyMapping/mappings/0/properties/3/condition#1)",
  "token": 4,
  "failedRecord": "<em><strong>complete record, in xml format</strong></em>"
  "uid": "uid=jdoe,ou=people,dc=example,dc=com",
  "_rev": "0",
  "_id": "4"
}   </em></pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="handling-sync"></a>11.9.&nbsp;Synchronization Situations and Actions</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#sync-situations">11.9.1. Synchronization Situations</a></span></dt><dt><span class="section"><a href="#source-reconciliation">11.9.2. Source Reconciliation</a></span></dt><dt><span class="section"><a href="#target-reconciliation">11.9.3. Target Reconciliation</a></span></dt><dt><span class="section"><a href="#autosync-and-livesync">11.9.4. Situations Specific to Automatic Synchronization and LiveSync</a></span></dt><dt><span class="section"><a href="#sync-actions">11.9.5. Synchronization Actions</a></span></dt><dt><span class="section"><a href="#script-actions">11.9.6. Providing a Script as an Action</a></span></dt></dl></div><a class="indexterm" name="d505e9186"></a><a class="indexterm" name="d505e9191"></a><p>
   During synchronization, OpenIDM categorizes objects according to their
   <em class="firstterm">situation</em>. Situations are characterized by whether an
   object exists on a source or target system, whether OpenIDM has registered a
   link between the source object and the target object, and whether the object
   is considered <em class="firstterm">valid</em>, as assessed by the
   <code class="literal">validSource</code> and <code class="literal">validTarget</code> scripts.
   OpenIDM then takes a specific action, depending on the situation.
  </p><p>
   You can define actions for particular situations in the
   <code class="literal">policies</code> section of a synchronization mapping, as shown in
   the following excerpt.
  </p><pre class="brush: javascript;">
{
    "policies": [
        {
            "situation": "CONFIRMED",
            "action": "UPDATE"
        },
        {
            "situation": "FOUND",
            "action": "UPDATE"
        },
        {
            "situation": "ABSENT",
            "action": "CREATE"
        },
        {
            "situation": "AMBIGUOUS",
            "action": "EXCEPTION"
        },
        {
            "situation": "MISSING",
            "action": "EXCEPTION"
        },
        {
            "situation": "UNQUALIFIED",
            "action": "DELETE"
        },
        {
            "situation": "UNASSIGNED",
            "action": "EXCEPTION"
        }
    ]
}</pre><p>
   If you do not define a policy for a particular situation, OpenIDM takes the
   <em class="firstterm">default action</em> for the situation.
  </p><p>
   The following sections describe the possible situations and their default
   corresponding actions.
  </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="sync-situations"></a>11.9.1.&nbsp;Synchronization Situations</h3></div></div></div><div class="orderedlist"><p>
     OpenIDM performs a reconciliation operation in two phases:
    </p><ol class="orderedlist" type="1"><li class="listitem"><p>
      <em class="firstterm">Source reconciliation</em>, where OpenIDM accounts for
      source objects and associated links, based on the configured mapping.
     </p></li><li class="listitem"><p>
      <em class="firstterm">Target reconciliation</em>, where OpenIDM iterates over
      the target objects that were not processed in the first phase.
     </p></li></ol></div><div class="orderedlist"><p>
     During the source reconciliation phase, OpenIDM builds three lists,
     assigning values to the objects to reconcile.
    </p><ol class="orderedlist" type="1"><li class="listitem"><p>
      All valid objects from the source
     </p><p>
      OpenIDM assigns valid source objects <code class="literal">qualifies=1</code>.
      Invalid objects, including those that were not found in the source system,
      and those that were filtered out by the script specified in the
      <code class="literal">validSource</code> property, are assigned
      <code class="literal">qualifies=0</code>.
     </p></li><li class="listitem"><p>
      All records from the appropriate links table
     </p><p>
      Objects that have a corresponding link in the links table of the
      repository are assigned <code class="literal">link=1</code>. Objects that do not
      have a corresponding link are assigned <code class="literal">link=0</code>.
     </p></li><li class="listitem"><p>
      All valid objects on the target system
     </p><p>
      Objects that are found in the target system are assigned
      <code class="literal">target=1</code>. Objects that are not found in the target
      system are assigned <code class="literal">target=0</code>.
     </p></li></ol></div><div class="variablelist"><p>
     Based on the values assigned to objects during source reconciliation,
     OpenIDM assigns situations, listed here with default and appropriate
     alternative actions.
    </p><dl class="variablelist"><dt><span class="term">"CONFIRMED" (qualifies=1, link=1, target=1)</span></dt><dd><p>
       The source object qualifies for a target object, and a link to an
       existing target object was found. This situation is detected during
       change events and during reconciliation.
      </p><p>
       Default action: <code class="literal">UPDATE</code> the target object.
      </p><p>
       Other valid actions: <code class="literal">IGNORE, REPORT, NOREPORT, ASYNC</code>
      </p></dd><dt><span class="term">"FOUND" (qualifies=1, link=0, target=1)</span></dt><dd><p>
       The source object qualifies for a target object and there is no link to
       an existing target object. There is a single target object, that
       correlates with this source object, according to the logic in the
       correlation query. This situation is detected during change events and
       reconciliation.
      </p><p>
       Default action: <code class="literal">UPDATE</code> the target object.
      </p><p>
       Other valid actions: <code class="literal">EXCEPTION, IGNORE, REPORT,
       NOREPORT, ASYNC</code>
      </p></dd><dt><span class="term">"FOUND_ALREADY_LINKED" (qualifies=1, link=1, target=1)</span></dt><dd><p>
       The source object qualifies for a target object and there is no link from
       that source object to an existing target object. There is a single target
       object, that correlates with this source object, according to the logic
       in the correlation query, but that target object is already linked to a
       different source object. This situation is detected during change events
       and reconciliation.
      </p><p>
       Default action: log an <code class="literal">EXCEPTION</code>.
      </p><p>
       Other valid actions: <code class="literal">IGNORE, REPORT, NOREPORT, ASYNC</code>
      </p></dd><dt><span class="term">"ABSENT" (qualifies=1, link=0, target=0)</span></dt><dd><p>
       The source object qualifies for a target object, there is no link to an
       existing target object, and there is no correlated target object found.
       This situation is detected during change events and reconciliation.
      </p><p>
       Default action: <code class="literal">CREATE</code> a target object.
      </p><p>
       Other valid actions: <code class="literal">EXCEPTION, IGNORE, REPORT, NOREPORT, ASYNC
      </code>
      </p></dd><dt><span class="term">"AMBIGUOUS" (qualifies=1, link=0, target&gt;1)</span></dt><dd><p>
       The source object qualifies for a target object, there is no link to an
       existing target object, but there is more than one correlated target
       object (that is, more than one possible match on the target system). This
       situation is detected during source object changes and reconciliation.
      </p><p>
       Default action: log an <code class="literal">EXCEPTION</code>.
      </p><p>
       Other valid actions: <code class="literal">IGNORE, REPORT, NOREPORT, ASYNC</code>
      </p></dd><dt><span class="term">"MISSING" (qualifies=1, link=1, target=0)</span></dt><dd><p>
       The source object qualifies for a target object, and there is a link to a
       target object, but the target object is missing. This situation is
       detected during reconciliation operations and during source object changes.
      </p><p>
       Default action: log an <code class="literal">EXCEPTION</code>.
      </p><p>
       Other valid actions: <code class="literal">CREATE, UNLINK, IGNORE, REPORT, NOREPORT.
      ASYNC</code>
      </p></dd><dt><span class="term">"UNQUALIFIED" (qualifies=0, link=0 or 1, target=1 or &gt;1)</span></dt><dd><p>
       The source object is unqualified (by the "validSource" script). One or
       more target objects are found through the correlation logic. This
       situation is detected during change events and reconciliation.
      </p><p>
       Default action: <code class="literal">DELETE</code> the target object or objects.
      </p><p>
       Other valid actions: <code class="literal">EXCEPTION, IGNORE, REPORT, NOREPORT,
      ASYNC</code>
      </p></dd><dt><span class="term">"TARGET_IGNORED" (qualifies=0, link=0 or 1, target=1)</span></dt><dd><p>
       The source object is unqualified (by the "validSource" script). One or
       more target objects are found through the correlation logic. This
       situation is detected only during source object changes.
      </p><p>
       It is different from "UNQUALIFIED", based on the status of the link and
       target. If there is a link, the target is not valid. If there is no link
       and exactly one target, that target is not valid.
      </p><p>
       Default action: <code class="literal">IGNORE</code> the target object until the
       next full reconciliation operation.
      </p><p>
       Other valid actions: <code class="literal">DELETE, UNLINK, EXCEPTION, REPORT,
       NOREPORT, ASYNC</code>
      </p></dd><dt><span class="term">"SOURCE_IGNORED" (qualifies=0, link=0, target=0)</span></dt><dd><p>
       The source object is unqualified (by the "validSource" script), no link
       is found, and no correlated target exists. This situation is detected
       during source object changes and reconciliation.
      </p><p>
       Default action: <code class="literal">IGNORE</code> the source object.
      </p><p>
       Other valid actions: <code class="literal">EXCEPTION, REPORT, NOREPORT, ASYNC</code>
      </p></dd><dt><span class="term">"LINK_ONLY" (qualifies=n/a, link=1, target=0)</span></dt><dd><p>
       The source may or may not be qualified, a link is found, but no target
       object is found. This situation is detected only during source object
       changes.
      </p><p>
       Default action: Log an <code class="literal">EXCEPTION</code>.
      </p><p>
       Other valid actions: <code class="literal">UNLINK, IGNORE, REPORT, NOREPORT,
       ASYNC</code>
      </p></dd><dt><span class="term">"ALL_GONE" (qualifies=n/a, link=0, cannot-correlate)</span></dt><dd><p>
       The source object has been removed. No link is found. Correlation is not
       possible, for one of the following reasons:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
         No previous source value can be found
        </p></li><li class="listitem"><p>
         There is no correlation query
        </p></li><li class="listitem"><p>
         A previous value was found, and a correlation query exists, but no
         corresponding target was found
        </p></li></ul></div><p>This situation is detected only during source object changes.
      </p><p>
       Default action: "IGNORE" the source object.
      </p><p>
       Other valid actions: <code class="literal">EXCEPTION, REPORT, NOREPORT,
      ASYNC</code>
      </p></dd></dl></div><div class="orderedlist"><p>
     During the target reconciliation phase, OpenIDM assigns the following
     values as it iterates through the target objects that were not accounted
     for during the source reconciliation.
    </p><ol class="orderedlist" type="1"><li class="listitem"><p>
      Valid objects from the target
     </p><p>
      OpenIDM assigns valid target objects <code class="literal">qualifies=1</code>.
      Invalid objects, including those that are filtered out by the script
      specified in the <code class="literal">validTarget</code> property, are assigned
      <code class="literal">qualifies=0</code>.
     </p></li><li class="listitem"><p>
      All records from the appropriate links table
     </p><p>
      Objects that have a corresponding link in the links table of the
      repository are assigned <code class="literal">link=1</code>. Objects that do not
      have a corresponding link are assigned <code class="literal">link=0</code>.
     </p></li><li class="listitem"><p>
      All valid objects on the source system
     </p><p>
      Objects that are found in the source system are assigned
      <code class="literal">source=1</code>. Objects that are not found in the source
      system are assigned <code class="literal">source=0</code>.
     </p></li></ol></div><p>
     Based on the values that are assigned to objects during the target
     reconciliation phase, OpenIDM assigns situations, listed here with their
     default actions.
    </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">"TARGET_IGNORED" (qualifies=0)</span></dt><dd><p>
       During target reconciliation, the target becomes unqualified by the
      "validTarget" script. This situation is detected only during
       reconciliation operations.
      </p><p>
       Default action: <code class="literal">IGNORE</code> the target object.
      </p><p>
       Other valid actions: <code class="literal">DELETE, UNLINK, REPORT, NOREPORT,
      ASYNC</code>
      </p></dd><dt><span class="term">"UNASSIGNED" (qualifies=1, link=0)</span></dt><dd><p>
       A valid target object exists, for which there is no link. This situation
       is detected only during reconciliation operations.
      </p><p>
       Default action: log an <code class="literal">EXCEPTION</code>.
      </p><p>
       Other valid actions: <code class="literal">IGNORE, REPORT, NOREPORT, ASYNC</code>
      </p></dd><dt><span class="term">"CONFIRMED" (qualifies=1, link=1, source=1)</span></dt><dd><p>
       The target object qualifies, and a link to a source object exists. This
       situation is detected only during reconciliation operations.
      </p><p>
       Default action: <code class="literal">UPDATE</code> the target object.
      </p><p>
       Other valid actions: <code class="literal">IGNORE, REPORT, NOREPORT</code>
      </p></dd><dt><span class="term">"UNQUALIFIED" (qualifies=0, link=1, source=1, but source does not
     qualify)</span></dt><dd><p>
       The target object is unqualified, (by the "validTarget" script), but
       there is a link to an existing source object, which is also unqualified.
       This situation is detected during change events and reconciliation.
      </p><p>
       Default action: <code class="literal">DELETE</code> the target object.
      </p><p>
       Other valid actions: <code class="literal">UNLINK, EXCEPTION, IGNORE, REPORT,
       NOREPORT, ASYNC</code>
      </p></dd><dt><span class="term">SOURCE_MISSING (qualifies=1, link=1, source=0)</span></dt><dd><p>
       The target object qualifies and a link is found. But the source object is
       missing. This situation is detected during change events and
       reconciliation.
      </p><p>
       Default action: log an "EXCEPTION".
      </p><p>
       Other valid actions: <code class="literal">DELETE, UNLINK, IGNORE, REPORT,
       NOREPORT, ASYNC</code>
      </p></dd></dl></div><p>
    The following sections reiterate in detail how OpenIDM assigns situations
    during each of the two synchronization phases.
   </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="source-reconciliation"></a>11.9.2.&nbsp;Source Reconciliation</h3></div></div></div><p>
    OpenIDM starts reconciliation and LiveSync by reading a list of objects from
    the resource. For reconciliation, the list includes all objects that are
    available through the connector. For LiveSync, the list contains only
    changed objects. The connector can filter objects out of the list, too, by
    using the script specified in the <code class="literal">validSource</code> property.
   </p><p>
    OpenIDM then iterates over the list, checking each entry against the
    <code class="literal">validSource</code> filter, and classifying objects according to
    their situations as described in <a class="xref" href="#sync-situations" title="11.9.1.&nbsp;Synchronization Situations">Section&nbsp;11.9.1, &#8220;Synchronization Situations&#8221;</a>. OpenIDM
    uses the list of links for the current mapping to classify objects. Finally,
    OpenIDM executes the action that is configured for each situation.
   </p><p>
    The following table shows how OpenIDM assigns the appropriate situation
    during source reconciliation, depending on whether a valid source exists
    (Source Qualifies), whether a link exists in the repository (Link Exists),
    and how many target objects are found, based either on links or on the
    results of the correlation query.
   </p><div class="table"><a name="d505e9609"></a><div class="table-title">Table&nbsp;11.1.&nbsp;Resolving Source Reconciliation Situations</div><div class="table-contents"><table summary="Resolving Source Reconciliation Situations" width="100%" border="0"><colgroup><col width="11%" class="c1"><col width="11%" class="c2"><col width="11%" class="c3"><col width="11%" class="c4"><col width="11%" class="c5"><col width="11%" class="c6"><col width="11%" class="c7"><col width="23%" class="c8"></colgroup><thead><tr><th colspan="2" align="left">Source Qualifies?</th><th colspan="2" align="left">Link Exists?</th><th colspan="3" align="left">Target Objects
       Found<a href="#ftn.d505e9629" class="footnote" name="d505e9629"><sup class="footnote">[a]</sup></a></th><th rowspan="2" align="left" valign="top">Situation</th></tr><tr><th>Yes</th><th>No</th><th>Yes</th><th>No</th><th>0</th><th>1</th><th>&gt; 1</th></tr></thead><tbody><tr><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>SOURCE_MISSING</td></tr><tr><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>&nbsp;</td><td>X</td><td>UNQUALIFIED</td></tr><tr><td>&nbsp;</td><td>X</td><td>X</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>&nbsp;</td><td>UNQUALIFIED</td></tr><tr><td>&nbsp;</td><td>X</td><td>X</td><td>&nbsp;</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>TARGET_IGNORED</td></tr><tr><td>&nbsp;</td><td>X</td><td>X</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>X</td><td>UNQUALIFIED</td></tr><tr><td>X</td><td>&nbsp;</td><td>&nbsp;</td><td>X</td><td>X</td><td>&nbsp;</td><td>&nbsp;</td><td>ABSENT</td></tr><tr><td>X</td><td>&nbsp;</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>FOUND</td></tr><tr><td>X</td><td>&nbsp;</td><td>&nbsp;</td><td>X<a href="#ftn.d505e9778" class="footnote" name="d505e9778"><sup class="footnote">[b]</sup></a></td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>FOUND_ALREADY_LINKED</td></tr><tr><td>X</td><td>&nbsp;</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>&nbsp;</td><td>X</td><td>AMBIGUOUS</td></tr><tr><td>X</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>&nbsp;</td><td>MISSING</td></tr><tr><td>X</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>CONFIRMED</td></tr></tbody><tbody class="footnotes"><tr><td colspan="8"><div id="ftn.d505e9629" class="footnote"><p><a href="#d505e9629" class="para"><sup class="para">[a] </sup></a>If no link exists for the source object, then
       OpenIDM executes a correlation query. If no previous object is available,
       OpenIDM cannot correlate.</p></div><div id="ftn.d505e9778" class="footnote"><p><a href="#d505e9778" class="para"><sup class="para">[b] </sup></a>A link does exist from the target object but it
        not for this specific source object.</p></div></td></tr></tbody></table></div></div><br class="table-break"></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="target-reconciliation"></a>11.9.3.&nbsp;Target Reconciliation</h3></div></div></div><p>
    During source reconciliation, OpenIDM cannot detect situations where no
    source object exists, such as the UNASSIGNED situation. When no source
    object exists, OpenIDM detects the situation during the second
    reconciliation phase, target reconciliation. During target reconciliation,
    OpenIDM iterates over all target objects that do not have a representation
    on the source, checking each object against the
    <code class="literal">validTarget</code> filter, determining the appropriate situation,
    and executing the action configured for the situation.
   </p><p>
    The following table shows how OpenIDM assigns the appropriate situation
    during target reconciliation, depending on whether a valid target exists
    (Target Qualifies), whether a link with an appropriate type exists in the
    repository (Link Exists), whether a source object exists (Source Exists),
    and whether the source object qualifies (Source Qualifies). Not all
    situations assigned during source reconciliation are assigned during target
    reconciliation.
   </p><div class="table"><a name="d505e9850"></a><div class="table-title">Table&nbsp;11.2.&nbsp;Resolving Target Reconciliation Situations</div><div class="table-contents"><table summary="Resolving Target Reconciliation Situations" width="100%" border="0"><colgroup><col width="10%" class="c1"><col width="10%" class="c2"><col width="10%" class="c3"><col width="10%" class="c4"><col width="10%" class="c5"><col width="10%" class="c6"><col width="10%" class="c7"><col width="10%" class="c8"><col width="20%" class="c9"></colgroup><thead><tr><th colspan="2" align="left">Target Qualifies?</th><th colspan="2" align="left">Link Exists?</th><th colspan="2" align="left">Source Exists?</th><th colspan="2" align="left">Source Qualifies?</th><th rowspan="2" align="left" valign="top">Situation</th></tr><tr><th>Yes</th><th>No</th><th>Yes</th><th>No</th><th>Yes</th><th>No</th><th>Yes</th><th>No</th></tr></thead><tbody><tr><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>TARGET_IGNORED</td></tr><tr><td>X</td><td>&nbsp;</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>&nbsp;</td><td>UNASSIGNED</td></tr><tr><td>X</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>CONFIRMED</td></tr><tr><td>X</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>&nbsp;</td><td>X</td><td>UNQUALIFIED</td></tr><tr><td>X</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>&nbsp;</td><td>SOURCE_MISSING</td></tr></tbody></table></div></div><br class="table-break"></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="autosync-and-livesync"></a>11.9.4.&nbsp;Situations Specific to Automatic Synchronization and LiveSync</h3></div></div></div><p>
    Certain situations occur only during automatic synchronization (when OpenIDM
    pushes changes made in the repository out to external systems) and LiveSync
    (when OpenIDM polls external system change logs for changes and updates the
    repository).
   </p><p>
    The following table shows the situations that pertain only to automatic sync
    and LiveSync, when records are <span class="emphasis"><em>deleted</em></span> from the source
    or target resource.
   </p><div class="table"><a name="d505e9998"></a><div class="table-title">Table&nbsp;11.3.&nbsp;Resolving Automatic Sync and LiveSync Delete Situations</div><div class="table-contents"><table summary="Resolving Automatic Sync and LiveSync Delete Situations" width="100%" border="0"><colgroup><col width="11%" class="c1"><col width="11%" class="c2"><col width="11%" class="c3"><col width="11%" class="c4"><col width="11%" class="c5"><col width="11%" class="c6"><col width="11%" class="c7"><col width="23%" class="c8"></colgroup><thead><tr><th colspan="2" align="left">Source Qualifies?</th><th colspan="2" align="left">Link Exists?</th><th colspan="3" align="left">Target Objects Found
        <a href="#ftn.d505e10018" class="footnote" name="d505e10018"><sup class="footnote">[a]</sup></a>
       </th><th rowspan="2" align="left" valign="top">Situation</th></tr><tr><th>Yes</th><th>No</th><th>Yes</th><th>No</th><th>0</th><th>1</th><th>&gt; 1</th></tr></thead><tbody><tr><td>N/A</td><td>N/A</td><td>X</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>&nbsp;</td><td>LINK_ONLY</td></tr><tr><td>N/A</td><td>N/A</td><td>&nbsp;</td><td>X</td><td>X</td><td>&nbsp;</td><td>&nbsp;</td><td>ALL_GONE</td></tr><tr><td>X</td><td>&nbsp;</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>&nbsp;</td><td>X</td><td>AMBIGUOUS</td></tr><tr><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>X</td><td>&nbsp;</td><td>&nbsp;</td><td>X</td><td>UNQUALIFIED</td></tr></tbody><tbody class="footnotes"><tr><td colspan="8"><div id="ftn.d505e10018" class="footnote"><p><a href="#d505e10018" class="para"><sup class="para">[a] </sup></a>
          If no link exists for the source object, then OpenIDM executes a
          correlation query. If no previous object is available, OpenIDM cannot
          correlate.
         </p></div></td></tr></tbody></table></div></div><br class="table-break"></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="sync-actions"></a>11.9.5.&nbsp;Synchronization Actions</h3></div></div></div><div class="variablelist"><p>Once OpenIDM has assigned a situation to an object, OpenIDM takes
    the actions configured in the mapping. If no action is configured, then
    OpenIDM takes the default action for the situation. OpenIDM supports the
    following actions.</p><dl class="variablelist"><dt><span class="term">"CREATE"</span></dt><dd><p>Create and link a target object.</p></dd><dt><span class="term">"UPDATE"</span></dt><dd><p>Link and update a target object.</p></dd><dt><span class="term">"DELETE"</span></dt><dd><p>Delete and unlink the target object.</p></dd><dt><span class="term">"LINK"</span></dt><dd><p>Link the correlated target object.</p></dd><dt><span class="term">"UNLINK"</span></dt><dd><p>Unlink the linked target object.</p></dd><dt><span class="term">"EXCEPTION"</span></dt><dd><p>Flag the link situation as an exception.</p><p>You should not use this action for LiveSync mappings.</p></dd><dt><span class="term">"IGNORE"</span></dt><dd><p>Do not change the link or target object state.</p></dd><dt><span class="term">"REPORT"</span></dt><dd><p>
       Do not perform any action but report on what would happen if the default
       action were performed.
      </p></dd><dt><span class="term">"NOREPORT"</span></dt><dd><p>
       Do not perform any action or generate any report.
      </p></dd><dt><span class="term">"ASYNC"</span></dt><dd><p>
       An asynchronous process has been started so do not perform any action or
       generate any report. 
      </p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="script-actions"></a>11.9.6.&nbsp;Providing a Script as an Action</h3></div></div></div><p>
    In addition to the static synchronization actions described in the previous
    section, you can provide a script that is run in specific synchronization
    situations. The following extract of a sample <code class="filename">sync.json</code>
    file specifies that when a synchronization operation assesses an entry as
    <code class="literal">ABSENT</code>, the workflow named
    <code class="literal">managedUserApproval</code> is invoked. The parameters for the
    workflow are passed in as properties of the <code class="literal">action</code>
    parameter.
   </p><pre class="brush: javascript;">
{
    "situation" : "ABSENT",
    "action" : {
        "workflowName" : "managedUserApproval",
        "type" : "text/javascript",
        "file" : "workflow/triggerWorkflowFromSync.js"
    }
}
   </pre><p>
    The variables available to these scripts are described in
    <a href="../integrators-guide/index.html#appendix-scripting" class="link"><em class="citetitle">Variables
     Available in Scripts</em></a> in the <em class="citetitle">Scripting
    Appendix</em>.
   </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="asynchronous-reconciliation"></a>11.10.&nbsp;Asynchronous Reconciliation</h2></div></div></div><p>Reconciliation can work in tandem with workflows to provide
   additional business logic to the reconciliation process. You can define
   scripts to determine the action that should be taken for a particular
   reconciliation situation. A reconciliation process can launch a workflow
   after it has assessed a situation, and then perform the reconciliation, or
   some other action.</p><p>For example, you might want a reconciliation process to assess new user
   accounts that need to be created on a target resource. However, new user
   account creation might require some kind of approval from a manager before
   the accounts are actually created. The initial reconciliation process can
   assess the accounts that need to be created, launch a workflow to request
   management approval for those accounts, and then relaunch the reconciliation
   process to create the accounts, once the management approval has been
   received.</p><p>In this scenario, the defined script returns <code class="literal">IGNORE</code>
   for new accounts and the reconciliation engine does not continue processing
   the given object. The script then initiates an asynchronous process which
   calls back and completes the reconciliation process at a later stage.</p><p>A sample configuration for this scenario is available in
   <code class="filename">openidm/samples/sample9</code>, and described in <a href="../install-guide/index.html#more-sample9" class="link"><em class="citetitle">Sample 9 -
   Asynchronous Reconciliation Using Workflows</em></a> in the
   <em class="citetitle">Installation Guide</em>.</p><div class="orderedlist"><p>Configuring asynchronous reconciliation involves the following
     steps:</p><ol class="orderedlist" type="1"><li class="listitem"><p>Create the workflow definition file (<code class="literal">.xml or .bar</code> file)
       and place it in the <code class="filename">openidm/workflow</code> directory.
       For more information about creating workflows, see <a href="../integrators-guide/index.html#chap-workflow" class="link">
       <em class="citetitle">Integrating Business Processes and Workflows</em></a>.
       </p></li><li class="listitem"><p>Modify the <code class="filename">conf/sync.json</code> file for the
       situation or situations that should call the workflow. Reference the
       workflow name in the configuration for that situation.</p><p>For example, the following <code class="filename">sync.json</code> extract
       calls the <code class="literal">managedUserApproval</code> workflow if the
       situation is assessed as <code class="literal">ABSENT</code>:</p><pre class="brush: javascript;">
{
    "situation" : "ABSENT",
    "action" : {
        "workflowName" : "managedUserApproval",
        "type" : "text/javascript",
        "file" : "workflow/triggerWorkflowFromSync.js"
    }
},    </pre></li><li class="listitem"><p>
       In the sample configuration, the workflow calls a second, explicit
       reconciliation process as a final step. This reconciliation process is
       called on the <code class="literal">sync</code> context path, with the
       <code class="literal">performAction</code> action
       (<code class="literal">openidm.action('sync', 'performAction', params)</code>).
      </p><p>
       You can also use this kind of explicit reconciliation to perform a
       specific action on a source or target record, regardless of the assessed
       situation.
      </p><p>
       You can call such an operation over the REST interface, specifying the
       source, and/or target IDs, the mapping, and the action to be taken. The
       action can be any one of the supported reconciliation actions, that is,
       <code class="literal">CREATE, UPDATE, DELETE, LINK, UNLINK, EXCEPTION, REPORT,
       NOREPORT, ASYNC, IGNORE</code>. In addition, if you specify a
       <code class="literal">reconId</code>, the action that is taken is logged in the
       <code class="literal">audit/recon</code> log, along with the the other audit data
       for that reconciliation run.
      </p><p>
       The following sample command calls the DELETE action on user
       <code class="literal">bjensen</code>, whose <code class="literal">_id</code> in the LDAP
       directory is <code class="literal">uid=bjensen,ou=People,dc=example,dc=com</code>.
       The user is deleted in the target resource, in this case, the
       OpenIDM repository.
      </p><p>
       Note that the <code class="literal">_id</code> must be URL-encoded in the REST
       call.
      </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 "https://localhost:8443/openidm/sync?_action=performAction&amp;sourceId=uid%3Dbjensen%2Cou%3DPeople%2Cdc%3Dexample%2Cdc%3Dcom&amp;mapping=
 systemLdapAccounts_ManagedUser&amp;action=DELETE"</strong>
<em>{}</em></pre></div></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="case-sensitivity"></a>11.11.&nbsp;Configuring Case Sensitivity for Data Stores</h2></div></div></div><p>By default, OpenIDM is case-sensitive, which means that case is taken
   into account when comparing IDs during reconciliation. For data stores that
   are case-insensitive, such as OpenDJ, IDs and links that are created by a
   reconciliation process may be stored with a different case to the way in
   which they are stored in the OpenIDM repository. Such a situation can cause
   problems during a reconciliation operation, as the links for these IDs may
   not match.</p><p>For such data stores, you can configure OpenIDM to ignore case during
   reconciliation operations. With case sensitivity turned off in OpenIDM, for
   those specific mappings, comparisons are done without regard to case.</p><p>To specify that data stores are not case-sensitive, set the
   <code class="literal">"sourceIdsCaseSensitive"</code> or <code class="literal">"targetIdsCaseSensitive"</code>
   property to <code class="literal">false</code> in the mapping for those links. For
   example, if the LDAP data store is case-insensitive, set the mapping from
   the LDAP store to the managed user repository as follows:</p><pre class="brush: javascript;">
"mappings" : [
{
"name" : "systemLdapAccounts_managedUser",
"source" : "system/ldap/account",
"sourceIdsCaseSensitive" : false,
"target" : "managed/user",
"properties" : [
...
   </pre><p>If a mapping inherits links by using the <code class="literal">"links"</code>
   property, it is not necessary to set case sensitivity, because the mapping
   uses the setting of the referred links.</p><p>
    Note that configuring OpenIDM to be case-insensitive when comparing links
    does not make the OpenICF provisioner case-insensitive when it requests
    data. For example, if a user entry is stored with the ID
    <code class="literal">testuser</code> and you make a request for
    <code class="literal">https://localhost:8443/openidm/managed/TESTuser</code>, most
    provisioners will filter out the match because of the difference in case,
    and will indicate that the record is not found. To prevent the provisioner
    from performing this secondary filtering, set the
    <code class="literal">enableFilteredResultsHandler</code> property to
    <code class="literal">false</code> in the provisioner configuration. For example:
   </p><div class="screen"><pre>"resultsHandlerConfig" :
{
    "enableFilteredResultsHandler":false,
}, </pre></div><div class="caution"><h3 class="title">Caution</h3><p>Do not disable the filtered results handler for the CSV file
     connector. The CSV file connector does not perform filtering so if you
     disable the filtered results handler for this connector, the full CSV
     file will be returned for every request.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="reconciliation-optimization"></a>11.12.&nbsp;Reconciliation Optimization</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#correlate-target-set">11.12.1. Correlating Empty Target Sets</a></span></dt><dt><span class="section"><a href="#prefetching-links">11.12.2. Prefetching Links</a></span></dt><dt><span class="section"><a href="#parallel-recon-tasks">11.12.3. Parallel Reconciliation Threads</a></span></dt></dl></div><p>By default, reconciliation is configured to function in an optimized
  way. Some of these optimizations might, however, be unsuitable for your
  environment. The following sections describe the optimizations and how they
  can be configured.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="correlate-target-set"></a>11.12.1.&nbsp;Correlating Empty Target Sets</h3></div></div></div><p>To optimize a reconciliation operation, the reconciliation process does
  not attempt to correlate source objects to target objects if the set of
  target objects is empty when the correlation is started. This considerably
  speeds up the process the first time the reconciliation is run. You can change
  this behavior for a specific mapping by adding the
  <code class="literal">correlateEmptyTargetSet</code> property to the mapping definition
  and setting it to <code class="literal">true</code>. For example:</p><pre class="brush: javascript;">
{
    "mappings": [
        {
            "name"                     : "systemMyLDAPAccounts_managedUser",
            "source"                   : "system/MyLDAP/account",
            "target"                   : "managed/user",
            "correlateEmptyTargetSet"  : true
        },
    ]
}</pre><p>Be aware that this setting will have a performance impact on the
   reconciliation process.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="prefetching-links"></a>11.12.2.&nbsp;Prefetching Links</h3></div></div></div><p>All links are queried at the start of a correlation and the results of
   that query are used. You can disable the prefetching of links, so that the
   correlation process looks up each link in the database as it processes each
   source or target object. You can disable the prefetching of links by adding
   the <code class="literal">prefetchLinks</code> property to the mapping, and setting it
   to <code class="literal">false</code>, for example:</p><pre class="brush: javascript;">
{
    "mappings": [
        {
            "name": "systemMyLDAPAccounts_managedUser",
            "source": "system/MyLDAP/account",
            "target": "managed/user"
            "prefetchLinks" : false
        }
    ]
}</pre><p>Be aware that this setting will have a performance impact on the
   reconciliation process.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="parallel-recon-tasks"></a>11.12.3.&nbsp;Parallel Reconciliation Threads</h3></div></div></div><p>By default, reconciliation is executed in a multi-threaded manner,
    that is, numerous threads are dedicated to the same reconciliation run.
    Multithreading generally improves reconciliation run performance. The
    default number of threads for a single reconciliation run is ten (plus the
    main reconciliation thread). Under normal circumstances, you should not
    need to change this number, however the default might not be appropriate
    in the following situations:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The hardware has many cores and supports more concurrent threads.
        As a rule of thumb for performance tuning, start with setting the
        thread number to two times the number of cores.</p></li><li class="listitem"><p>The source or target is an external system with high latency or
       slow response times. Threads may then spend considerable time waiting
       for a response from the external system. Increasing the available
       threads enables the system to prepare or continue with additional
       objects.</p></li></ul></div><p>To change the number of threads, set the <code class="literal">taskThreads</code>
    property in the <code class="filename">conf/sync.json</code> file, for example:</p><pre class="brush: javascript;">
    "mappings" : [
        {
            "name" : "systemXmlfileAccounts_managedUser",
            "source" : "system/xmlfile/account",
            "target" : "managed/user",
            "taskThreads" : 20
            ...
         }
    ]
}</pre><p>A value of <code class="literal">0</code> specifies that reconciliation is run
    on the main reconciliation thread, that is, in a serial manner.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="correlation"></a>11.13.&nbsp;Correlation Queries</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#correlation-query-managed-object">11.13.1. Managed Objects as Correlation Query Targets</a></span></dt><dt><span class="section"><a href="#correlation-query-system-object">11.13.2. System Objects as Correlation Query Targets</a></span></dt></dl></div><a class="indexterm" name="d505e10422"></a><a class="indexterm" name="d505e10427"></a><p>Every time OpenIDM creates an object through synchronization, it
  creates a link between the source and target objects. OpenIDM then uses the
  link to determine the object's situation during later synchronization
  operations.</p><p>Initial, bulk synchronization operations can involve correlating
  many objects that exist both on source and target systems. In this case,
  OpenIDM uses correlation queries to find target objects that already exist,
  and that correspond to source objects. For the target objects that match
  a correlation query, OpenIDM needs only to create a link, rather than a
  new target object.</p><p>Correlation queries run against target resources. The query syntax
  therefore depends on the target system, and is either specific to the data
  store underlying the OpenIDM repository, or to OpenICF query capabilities.
  </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="correlation-query-managed-object"></a>11.13.1.&nbsp;Managed Objects as Correlation Query Targets</h3></div></div></div><p>Queries on managed objects in the repository must be defined in the
   configuration file for the repository, which is either
   <code class="filename">openidm/conf/repo.orientdb.json</code>, or
   <code class="filename">openidm/conf/repo.jdbc.json</code>.</p><p>The following example shows a correlation query defined in
   <code class="filename">openidm/conf/repo.orientdb.json</code>.</p><pre class="brush: javascript;">
"for-userName" : "SELECT * FROM ${unquoted:_resource} WHERE userName = ${uid}"
</pre><p>By default, a <code class="literal">${value}</code> token replacement is
   assumed to be a quoted string. If the value is not a quoted string, use the
   <code class="literal">unquoted:</code> prefix, as shown above.</p><p>The following correlation query example shows the JavaScript to call
   the query defined for OrientDB. The <code class="literal">_queryId</code> property
   value matches the name of the query specified in
   <code class="filename">openidm/conf/repo.orientdb.json</code>,
   <code class="literal">for-userName</code>. The <code class="literal">source.name</code> value
   replaces <code class="literal">${uid}</code> in the query. OpenIDM replaces
   <code class="literal">${unquoted:_resource}</code> in the query with the name of the
   table that holds managed objects.</p><pre class="brush: javascript;">
{
  "correlationQuery": {
    "type": "text/javascript",
    "source":
      "var query = {'_queryId' : 'for-userName', 'uid' : source.name}; query;"
  }
}</pre><p>The query can return zero or more objects, so the situation OpenIDM
   assigns to the source object depends on the number of target objects
   returned.</p><p>With a JDBC-based repository, the query defined in
   <code class="filename">openidm/conf/repo.jdbc.json</code> is more complex due
   to how the tables are indexed. The correlation query you define in
   <code class="filename">openidm/conf/sync.json</code> is the same, however.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="correlation-query-system-object"></a>11.13.2.&nbsp;System Objects as Correlation Query Targets</h3></div></div></div><p>
    Correlation queries on system objects access the connector. The connector
    then executes the query on the external resource.
   </p><p>
    Your correlation query JavaScript must return a map that holds a generic
    query with the following elements:
   </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
      A condition, such as "Equals"
     </p></li><li class="listitem"><p>
      The naming attribute to compare on the system object. In the example that
      follows, the naming attribute is <code class="literal">uid</code>.
     </p></li><li class="listitem"><p>
      The value from the source object to use in the search filter. You set this
      as the value of the <code class="literal">value</code> property, which takes an
      array. In the example that follows, the value to use in the search filter
      is <code class="literal">source.userName</code>.
     </p></li></ul></div><pre class="brush: javascript;">
var map = {"_queryFilter": 'uid eq "' + source.userName + '"'};
map;
   </pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="advanced-dataflow"></a>11.14.&nbsp;Advanced Data Flow Configuration</h2></div></div></div><a class="indexterm" name="d505e10525"></a><p><a class="xref" href="#basic-flow" title="11.3.&nbsp;Basic Data Flow Configuration">Section&nbsp;11.3, &#8220;Basic Data Flow Configuration&#8221;</a> shows how to trigger scripts when objects
  are created and updated. Other situations require you to trigger scripts
  in response to other synchronization actions. For example, you might not
  want OpenIDM to delete a managed user directly when an external account is
  deleted, but instead unlink the objects and deactivate the user in another
  resource. (Alternatively, you might delete the object in OpenIDM but
  nevertheless execute a script.) The following example shows a more advanced
  mapping configuration.</p><pre class="brush: javascript;">{
    "mappings": [
        {
            "name": "systemLdapAccount_managedUser",
            "source": "system/ldap/account",
            "target": "managed/user",
            "validSource": {
                "type": "text/javascript",
                "file": "script/isValid.js"
            },
            "correlationQuery" : {
                "type" : "text/javascript",
                "source" : "var map = {'_queryFilter': 'uid eq \"' +
                     source.userName + '\"'}; map;"
            },
            "properties": [
                {
                    "source": "uid",
                    "transform": {
                        "type": "text/javascript",
                        "source": "source.toLowerCase()"
                    },
                    "target": "userName"
                },
                {
                    "source": "",
                    "transform": {
                        "type": "text/javascript",
                        "source": "if (source.myGivenName)
                            {source.myGivenName;} else {source.givenName;}"
                    },
                    "target": "givenName"
                },
                {
                    "source": "",
                    "transform": {
                        "type": "text/javascript",
                        "source": "if (source.mySn)
                            {source.mySn;} else {source.sn;}"
                    },
                    "target": "familyName"
                },
                {
                    "source": "cn",
                    "target": "fullname"
                },
                {
                    "comment": "Multi-valued in LDAP, single-valued in AD.
                        Retrieve first non-empty value.",
                    "source": "title",
                    "transform": {
                        "type": "text/javascript",
                        "file": "script/getFirstNonEmpty.js"
                    },
                    "target": "title"
                },
                {
                    "condition": {
                        "type": "text/javascript",
                        "source": "var clearObj = openidm.decrypt(object);
                            ((clearObj.password != null) &amp;&amp;
                            (clearObj.ldapPassword != clearObj.password))"
                    },
                    "transform": {
                        "type": "text/javascript",
                        "source": "source.password"
                    },
                    "target": "__PASSWORD__"
                }
            ],
            "onCreate": {
                "type": "text/javascript",
                "source": "target.ldapPassword = null;
                    target.adPassword = null;
                    target.password = null;
                    target.ldapStatus = 'New Account'"
            },
            "onUpdate": {
                "type": "text/javascript",
                "source": "target.ldapStatus = 'OLD'"
            },
            "onUnlink": {
                "type": "text/javascript",
                "file": "script/triggerAdDisable.js"
            },
            "policies": [
                {
                    "situation": "CONFIRMED",
                    "action": "UPDATE"
                },
                {
                    "situation": "FOUND",
                    "action": "UPDATE"
                },
                {
                    "situation": "ABSENT",
                    "action": "CREATE"
                },
                {
                    "situation": "AMBIGUOUS",
                    "action": "EXCEPTION"
                },
                {
                    "situation": "MISSING",
                    "action": "EXCEPTION"
                },
                {
                    "situation": "UNQUALIFIED",
                    "action": "UNLINK"
                },
                {
                    "situation": "UNASSIGNED",
                    "action": "EXCEPTION"
                }
            ]
        }
    ]
}</pre><div class="variablelist"><p>The following list shows all the properties that you can use as hooks
   in mapping configurations to call scripts.</p><dl class="variablelist"><dt><span class="term">Triggered by Situation</span></dt><dd><p>onCreate, onRead, onUpdate, onDelete, onValidate, onRetrieve,
      onStore, onLink, onUnlink, postCreate, postUpdate, postDelete</p></dd><dt><span class="term">Object Filter</span></dt><dd><p>vaildSource, validTarget</p></dd><dt><span class="term">Correlating Objects</span></dt><dd><p>correlationQuery</p></dd><dt><span class="term">Triggered on Reconciliation</span></dt><dd><p>result</p></dd><dt><span class="term">Scripts Inside Properties</span></dt><dd><p>condition, transform</p></dd></dl></div><p>Your scripts can get data from any connected system at any time by
  using the <code class="literal">openidm.read(id)</code> function, where
  <code class="literal">id</code> is the identifier of the object to read.</p><p>The following example reads a managed user object from the
  repository.</p><pre class="brush: javascript;">
repoUser = openidm.read("managed/user/ddoe");</pre><p>The following example reads an account from an external LDAP
  resource.</p><pre class="brush: javascript;">
externalAccount = openidm.read("system/ldap/account/uid=ddoe,ou=People,dc=example,dc=com");</pre><p>Note that the query targets a DN rather than a UID, as it did in the
  previous example. The attribute that is used for the <code class="literal">_id</code>
  is defined in the connector configuration file and, in this example, is set
  to <code class="literal">"uidAttribute" : "dn"</code>. Although it is possible to use
  a DN (or any unique attribute) for the <code class="literal">_id</code>, as a best
  practice, you should use an attribute that is both unique and immutable.
  </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="scheduling-synchronization"></a>11.15.&nbsp;Scheduling Synchronization</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#configuring-sync-schedule">11.15.1. Configuring Scheduled Synchronization</a></span></dt><dt><span class="section"><a href="#alternative-mapping">11.15.2. Alternative Mappings</a></span></dt></dl></div><a class="indexterm" name="d505e10599"></a><a class="indexterm" name="d505e10602"></a><a class="indexterm" name="d505e10607"></a><a class="indexterm" name="d505e10612"></a><p>You can schedule synchronization operations, such as LiveSync and
  reconciliation, using <span class="command"><strong>cron</strong></span>-like syntax.</p><p>This section describes scheduling for reconciliation and LiveSync,
  however, you can also use OpenIDM's scheduler service to schedule any other
  event by supplying a link to a script file, in which that event is defined.
  For information about scheduling other events, and for a deeper understanding
  of the OpenIDM scheduler service, see
  <a href="../integrators-guide/index.html#chap-scheduler-conf" class="link"><em class="citetitle">Scheduling Tasks
  and Events</em></a>.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="configuring-sync-schedule"></a>11.15.1.&nbsp;Configuring Scheduled Synchronization</h3></div></div></div><p>
    Each scheduled reconciliation and LiveSync task requires a schedule
    configuration file in <code class="filename">openidm/conf</code>. By convention,
    files are named
    <code class="filename">openidm/conf/schedule-<em class="replaceable"><code>schedule-name</code></em>
    .json</code>, where <em class="replaceable"><code>schedule-name</code></em> is a
    logical name for the scheduled synchronization operation, such as
    <code class="literal">reconcile_systemXmlAccounts_managedUser</code>.
   </p><p>
    Schedule configuration files have the following format:
   </p><pre class="brush: javascript;">
{
 "enabled"       : true,
 "persisted"     : false,
 "type"          : "cron",
 "startTime"     : "(optional) time",
 "endTime"       : "(optional) time",
 "schedule"      : "cron expression",
 "misfirePolicy" : "optional, string",
 "timeZone"      : "(optional) time zone",
 "invokeService" : "service identifier",
 "invokeContext" : "service specific context info"
}
   </pre><p>
    For an explanation of each of these properties, see
    <a href="../integrators-guide/index.html#chap-scheduler-conf" class="link"><em class="citetitle">Scheduling Tasks
    and Events</em></a>.
   </p><p>
    To schedule a reconciliation or LiveSync task, set the
    <code class="literal">invokeService</code> property to either
    <code class="literal">"sync"</code> (for reconciliation) or
    <code class="literal">"provisioner"</code> for LiveSync.
   </p><p>
    The value of the <code class="literal">invokeContext</code> property depends on the
    type of scheduled event. For reconciliation, the properties are set as
    follows:
   </p><pre class="brush: javascript;">
{
    "invokeService": "sync",
    "invokeContext": {
        "action": "reconcile",
        "mapping": "systemLdapAccount_managedUser"
    }
}
   </pre><p>
    The <code class="literal">"mapping"</code> is either referenced by its name in the
    <code class="filename">openidm/conf/sync.json</code> file, or defined inline by using
    the <code class="literal">"mapping"</code> property, as shown in the example in
    <a href="../integrators-guide/index.html#alternative-mapping" class="link"><em class="citetitle">Alternative
    Mappings</em></a>.
   </p><p>
    For LiveSync, the properties are set as follows:
   </p><pre class="brush: javascript;">
{
    "invokeService": "provisioner",
    "invokeContext": {
        "action": "liveSync",
        "source": "system/OpenDJ/__ACCOUNT__"
    }
}
   </pre><p>
    The <code class="literal">"source"</code> property follows OpenIDM's convention for a
    pointer to an external resource object and takes the form
    <code class="literal">system/<em class="replaceable"><code>resource-name/object-type</code></em></code>.
   </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="alternative-mapping"></a>11.15.2.&nbsp;Alternative Mappings</h3></div></div></div><a class="indexterm" name="d505e10729"></a><p>
    Mappings for synchronization are usually stored in
    <code class="filename">openidm/conf/sync.json</code> for reconciliation, LiveSync,
    and for pushing changes made to managed objects to external resources. You
    can, however, provide alternative mappings for scheduled reconciliation by
    adding the mapping to the schedule configuration instead of referencing a
    mapping in <code class="filename">sync.json</code>.
   </p><pre class="brush: javascript;">
{
    "enabled": true,
    "type": "cron",
    "schedule": "0 08 16 * * ?",
    "invokeService": "sync",
    "invokeContext": {
        "action": "reconcile",
        "mapping": {
            "name": "CSV_XML",
            "source": "system/Ldap/account",
            "target": "managed/user",
            "properties": [
                {
                    "source": "firstname",
                    "target": "firstname"
                },
                ...
            ],
            "policies": [...]
        }
    }
}
   </pre></div></div></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-scheduler-conf"></a>Chapter&nbsp;12.&nbsp;Scheduling Tasks and Events</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="section"><a href="#scheduler-configuration-file">12.1. Scheduler Configuration</a></span></dt><dt><span class="section"><a href="#persistent-schedules">12.2. Configuring Persistent Schedules</a></span></dt><dt><span class="section"><a href="#scheduler-examples">12.3. Schedule Examples</a></span></dt><dt><span class="section"><a href="#schedules-over-rest">12.4. Managing Schedules Over REST</a></span></dt><dt><span class="section"><a href="#task-scanner">12.5. Scanning Data to Trigger Tasks</a></span></dt></dl></div><a class="indexterm" name="d505e10751"></a><a class="indexterm" name="d505e10754"></a><p>OpenIDM enables you to schedule reconciliation and synchronization 
  tasks. You can also use scheduling to trigger scripts, collect and run 
  reports, trigger workflows, perform custom logging, and so forth.</p><p>OpenIDM supports <span class="command"><strong>cron</strong></span>-like syntax to schedule events
 and tasks, based on expressions supported by the Quartz Scheduler (bundled 
 with OpenIDM).</p><p>If you use configuration files to schedule tasks and events, you must 
 place the schedule files in the <code class="filename">openidm/conf</code> directory.
 By convention, OpenIDM uses file names of the form
 <code class="filename">schedule-<em class="replaceable"><code>schedule-name</code></em>.json</code>, 
 where <em class="replaceable"><code>schedule-name</code></em> is a logical name for the 
 scheduled operation, for example, 
 <code class="filename">schedule-reconcile_systemXmlAccounts_managedUser.json</code>. 
 There are several example schedule configuration files in the 
 <code class="filename">openidm/samples/schedules</code> directory.</p><p>You can configure OpenIDM to pick up changes to scheduled tasks and 
 events dynamically, during initialization and also at runtime. For more 
 information, see <a href="../integrators-guide/index.html#changing-configuration" class="link"><em class="citetitle">Changing the 
 Configuration</em></a>.</p><p>In addition to the fine-grained scheduling facility, you can perform a 
 scheduled batch scan for a specified date in OpenIDM data, and then 
 automatically execute a task when this date is reached. For more information, 
 see <a class="xref" href="#task-scanner" title="12.5.&nbsp;Scanning Data to Trigger Tasks">Section&nbsp;12.5, &#8220;Scanning Data to Trigger Tasks&#8221;</a>.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="scheduler-configuration-file"></a>12.1.&nbsp;Scheduler Configuration</h2></div></div></div><a class="indexterm" name="d505e10797"></a><div class="itemizedlist"><p>
    Schedules are configured through JSON objects. The schedule configuration
    involves three files:
   </p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
     The <code class="filename">openidm/conf/boot/boot.properties</code> file, where you
     can enable the execution of persistent schedules
    </p></li><li class="listitem"><p>
     The <code class="filename">openidm/conf/scheduler.json</code> file, that configures
     the overall scheduler service
    </p></li><li class="listitem"><p>
     One <code class="filename">openidm/conf/schedule-<em class="replaceable"><code>schedule-name</code></em>.json</code>
     file for each configured schedule
    </p></li></ul></div><p>
   In the boot properties configuration file
   (<code class="filename">openidm/conf/boot/boot.properties</code>),
   the instance type is standalone and persistent schedules are enabled by
   default:
  </p><pre class="brush: plain;">
# valid instance types for node include standalone, clustered-first, and clustered-additional
openidm.instance.type=standalone

# enables the execution of persistent schedulers
openidm.scheduler.execute.persistent.schedules=true
  </pre><p>
   The scheduler service configuration file
   (<code class="filename">openidm/conf/scheduler.json</code>) governs the configuration
   for a specific scheduler instance, and has the following format:
  </p><pre class="brush: javascript;">
{
 "threadPool" : {
     "threadCount" : "10"
 },
 "scheduler" : {
     "executePersistentSchedules" : "&amp;{openidm.scheduler.execute.persistent.schedules}"
 }
}
  </pre><div class="itemizedlist"><p>The properties in the <code class="filename">scheduler.json</code> file relate 
   to the configuration of the Quartz Scheduler.</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">threadCount</code> specifies the maximum number of 
     threads that are available for the concurrent execution of scheduled 
     tasks.</p></li><li class="listitem"><p><code class="literal">executePersistentSchedules</code> allows you to disable 
     persistent schedule execution for a specific node. If this parameter is 
     set to <code class="literal">false</code>, the Scheduler Service will support the 
     management of persistent schedules (CRUD operations) but it will not 
     execute any persistent schedules. The value of this property can be a 
     string or boolean and is <code class="literal">true</code> by default.</p></li><li class="listitem"><p><code class="literal">advancedProperties</code> (optional) enables you to 
     configure additional properties for the Quartz Scheduler.</p></li></ul></div><div class="note"><h3 class="title">Note</h3><p>
    In clustered environments, the scheduler service obtains an
    <code class="literal">instanceID</code> and checkin and timeout settings from the
    cluster management service (defined in the
    <code class="filename">openidm/conf/cluster.json</code> file). This
    behavior differs from OpenIDM 2.1.0 (in which the scheduler service
    specified the instance ID and checkin and timeout settings). Therefore, if
    you used the scheduler service in OpenIDM 2.1.0, you will need to migrate
    any reference to assigned instance IDs, allowing them to be provided by the
    cluster management service.
   </p></div><p>For details of all the configurable properties for the Quartz Scheduler, 
  see the <a class="link" href="http://www.quartz-scheduler.org/documentation/quartz-2.1.x/configuration/ConfigMain" target="_blank"><em class="citetitle">Quartz Scheduler Configuration Reference</em></a>.</p><p>Each schedule configuration file, <code class="filename">openidm/conf/schedule-
  <em class="replaceable"><code>schedule-name</code></em>.json</code> has the following 
  format:</p><pre class="brush: javascript;">
{
 "enabled"             : true,
 "persisted"           : false,
 "concurrentExecution" : false,
 "type"                : "cron",
 "startTime"           : "(optional) time",
 "endTime"             : "(optional) time",
 "schedule"            : "cron expression",
 "misfirePolicy"       : "optional, string",
 "timeZone"            : "(optional) time zone",
 "invokeService"       : "service identifier",
 "invokeContext"       : "service specific context info",
 "invokeLogLevel"      : "(optional) debug"
}</pre><div class="variablelist"><p>The schedule configuration properties are defined as follows:</p><dl class="variablelist"><dt><span class="term">enabled</span></dt><dd><p>Set to <code class="literal">true</code> to enable the schedule. When this 
    property is set to <code class="literal">false</code>, OpenIDM considers the 
    schedule configuration dormant, and does not allow it to be triggered or
    executed.</p><p>If you want to retain a schedule configuration, but do not want it 
    used, set <code class="literal">enabled</code> to <code class="literal">false</code> for task 
    and event schedulers, instead of changing the configuration or 
    <span class="command"><strong>cron</strong></span> expressions.</p></dd><dt><span class="term">persisted (optional)</span></dt><dd><p>
     Specifies whether the schedule state should be persisted or stored in RAM.
     Boolean (<code class="literal">true</code> or <code class="literal">false</code>),
     <code class="literal">false</code> by default.
    </p><p>
     In a clustered environment, this property must be set to <code class="literal">true</code>
     to have the schedule fire only once across the cluster. For more
     information, see <a class="xref" href="#persistent-schedules" title="12.2.&nbsp;Configuring Persistent Schedules">Section&nbsp;12.2, &#8220;Configuring Persistent Schedules&#8221;</a>.
    </p></dd><dt><span class="term">concurrentExecution</span></dt><dd><p>Specifies whether multiple instances of the same schedule can run
      concurrently. Boolean (<code class="literal">true</code> or <code class="literal">false</code>),
      <code class="literal">false</code> by default. Multiple instances of the same
      schedule cannot run concurrently by default. This setting prevents a new
      scheduled task from being launched before the same previously launched
      task has completed. For example, under normal circumstances you would
      want a liveSync operation to complete its execution before the same
      operation was launched again. To enable concurrent execution of multiple
      schedules, set this parameter to <code class="literal">true</code>. The behavior of
      "missed" scheduled tasks is governed by the <a class="xref" href="#misfire-policy">misfirePolicy</a>.</p></dd><dt><span class="term">type</span></dt><dd><p>Currently OpenIDM supports only <code class="literal">cron</code>.</p></dd><dt><span class="term">startTime (optional)</span></dt><dd><p>Used to start the schedule at some time in the future. If this 
    parameter is omitted, empty, or set to a time in the past, the task or 
    event is scheduled to start immediately.</p><p>Use ISO 8601 format to specify times and dates (<code class="literal"><em class="replaceable"><code>
    YYYY</code></em>-<em class="replaceable"><code>MM</code></em>-<em class="replaceable"><code>DD
    </code></em>T<em class="replaceable"><code>hh</code></em>:<em class="replaceable"><code>mm
    </code></em>:<em class="replaceable"><code>ss</code></em></code>).</p></dd><dt><span class="term">endTime (optional)</span></dt><dd><p>Used to plan the end of scheduling.</p></dd><dt><span class="term">schedule</span></dt><dd><p>Takes <span class="command"><strong>cron</strong></span> expression syntax. For more information, 
    see the <a class="link" href="http://www.quartz-scheduler.org/docs/tutorials/crontrigger.html" target="_blank"><em class="citetitle">CronTrigger Tutorial</em></a> and <a class="link" href="http://www.quartz-scheduler.org/docs/tutorial/TutorialLesson06.html" target="_blank"><em class="citetitle">Lesson 6: CronTrigger</em></a>.</p></dd><dt><span class="term"><a name="misfire-policy"></a>misfirePolicy</span></dt><dd><p>For persistent schedules, this optional parameter specifies the
    behavior if the scheduled task is missed, for some reason. Possible values
    are as follows:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">fireAndProceed</code>. The first execution 
     of a missed schedule is immediately executed when the server is back 
     online. Subsequent executions are discarded. After this, the normal 
     schedule is resumed.</p></li><li class="listitem"><p><code class="literal">doNothing</code>, all missed schedules are 
     discarded and the normal schedule is resumed when the server is back 
     online.</p></li></ul></div></dd><dt><span class="term">timeZone (optional)</span></dt><dd><p>If not set, OpenIDM uses the system time zone.</p></dd><dt><span class="term">invokeService</span></dt><dd><p>Defines the type of scheduled event or action. The value of this 
    parameter can be one of the following:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">"sync"</code> for reconciliation</p></li><li class="listitem"><p><code class="literal">"provisioner"</code> for LiveSync</p></li><li class="listitem"><p><code class="literal">"script"</code> to call some other scheduled 
       operation defined in a script</p></li></ul></div></dd><dt><span class="term">invokeContext</span></dt><dd><p>Specifies contextual information, depending on the type of scheduled 
    event (the value of the <code class="literal">invokeService</code> parameter).
    </p><p>The following example invokes reconciliation.</p><pre class="brush: javascript;">
{
    "invokeService": "sync",
    "invokeContext": {
        "action": "reconcile",
        "mapping": "systemLdapAccount_managedUser"
    }
}</pre><div class="itemizedlist"><p>For a scheduled reconciliation task, you can define the mapping 
   in one of two ways:</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Reference a mapping by its name in <code class="filename">sync.json</code>,
    as shown in the previous example. The mapping must exist in the
    <code class="filename">openidm/conf/sync.json</code> file.</p></li><li class="listitem"><p>Add the mapping definition inline by using the
    <code class="literal">"mapping"</code> property, as shown in the example in
    <a href="../integrators-guide/index.html#alternative-mapping" class="link"><em class="citetitle">Alternative
    Mappings</em></a>.</p></li></ul></div><p>The following example invokes a LiveSync action.</p><pre class="brush: javascript;">
{
    "invokeService": "provisioner",
    "invokeContext": {
        "action": "liveSync",
        "source": "system/OpenDJ/__ACCOUNT__"
    }
}</pre><p>For scheduled LiveSync tasks, the <code class="literal">"source"</code> property 
  follows OpenIDM's convention for a pointer to an external resource object 
  and takes the form <code class="literal">system/<em class="replaceable"><code>resource-name</code></em>
  /<em class="replaceable"><code>object-type</code></em></code>.</p><p>The following example invokes a script, which prints the string 
  <code class="literal">Hello World</code> to the OpenIDM log 
  (<code class="filename">/openidm/logs/openidm0.log.X</code>).</p><pre class="brush: javascript;">
{
    "invokeService": "script",
    "invokeContext": {
        "script": {
            "type": "text/javascript",
            "source": "java.lang.System.out.println('Hello World');"
        }
    }
}</pre><p>Note that these are sample configurations only. Your own schedule 
    configuration will differ according to your specific requirements.</p></dd><dt><span class="term">invokeLogLevel (optional)</span></dt><dd><p>Specifies the level at which the invocation will be logged. 
    Particularly for schedules that run very frequently, such as LiveSync, the 
    scheduled task can generate significant output to the log file, and the log 
    level should be adjusted accordingly. The default schedule log level is 
    <code class="literal">info</code>. The value can be set to any one of the <a class="link" href="http://www.slf4j.org/apidocs/org/apache/commons/logging/Log.html" target="_top">SLF4J</a> 
    log levels:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">"trace"</code></p></li><li class="listitem"><p><code class="literal">"debug"</code></p></li><li class="listitem"><p><code class="literal">"info"</code></p></li><li class="listitem"><p><code class="literal">"warn"</code></p></li><li class="listitem"><p><code class="literal">"error"</code></p></li><li class="listitem"><p><code class="literal">"fatal"</code></p></li></ul></div></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="persistent-schedules"></a>12.2.&nbsp;Configuring Persistent Schedules</h2></div></div></div><p>By default, scheduling information, such as schedule state and details 
  of the schedule execution, is stored in RAM. This means that such 
  information is lost when OpenIDM is rebooted. The schedule configuration 
  itself (defined in the <code class="filename">openidm/conf/schedule-
  <em class="replaceable"><code>schedule-name</code></em>.json</code> file) is not lost 
  when OpenIDM is shut down, and normal scheduling continues when the server is 
  restarted. However, there are no details of missed schedule executions that 
  should have occurred during the period the server was unavailable.</p><p>You can configure schedules to be persistent, which means that the 
  scheduling information is stored in the internal repository rather than in 
  RAM. With persistent schedules, scheduling information is retained when OpenIDM 
  is shut down. Any previously scheduled jobs can be rescheduled automatically 
  when OpenIDM is restarted.</p><p>Persistent schedules also enable you to manage scheduling across a 
  cluster (multiple OpenIDM instances). When scheduling is persistent, a 
  particular schedule will be executed only once across the cluster, rather than 
  once on every OpenIDM instance. For example, if your deployment includes a 
  cluster of OpenIDM nodes for high availability, you can use persistent 
  scheduling to start a reconciliation action on only one node in the cluster, 
  instead of starting several competing reconciliation actions on each node.</p><p>You can use persistent schedules with the default OrientDB repository, 
  or with the MySQL repository (see <a href="../install-guide/index.html#chap-repository" class="link"><em class="citetitle">Installing a 
    Repository For Production</em></a>).
  </p><p>To configure persistent schedules, set the <code class="literal">"persisted"</code> 
  property to <code class="literal">true</code> in the schedule configuration file 
  (<code class="filename">schedule-<em class="replaceable"><code>schedule-name</code></em>.json)</code>.
  </p><p>If OpenIDM is down when a scheduled task was set to occur, one or more 
  executions of that schedule might be missed. To specify what action should be 
  taken if schedules are missed, set the <code class="literal">misfirePolicy</code> in the 
  schedule configuration file. The <code class="literal">misfirePolicy</code> determines 
  what OpenIDM should do if scheduled tasks are missed. Possible values are as 
  follows:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">fireAndProceed</code>. The first execution of 
     a missed schedule is immediately executed when the server is back online. 
     Subsequent executions are discarded. After this, the normal schedule is 
     resumed.</p></li><li class="listitem"><p><code class="literal">doNothing</code>. All missed schedules are 
     discarded and the normal schedule is resumed when the server is back 
     online.</p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="scheduler-examples"></a>12.3.&nbsp;Schedule Examples</h2></div></div></div><a class="indexterm" name="d505e11246"></a><p>The following example shows a schedule for reconciliation that
  is not enabled. When enabled (<code class="literal">"enabled" : true,</code>),
  reconciliation runs every 30 minutes, starting on the hour.</p><pre class="brush: javascript;">
{
    "enabled": false,
    "persisted": false,
    "type": "cron",
    "schedule": "0 0/30 * * * ?",
    "invokeService": "sync",
    "invokeContext": {
        "action": "reconcile",
        "mapping": "systemLdapAccounts_managedUser"
    }
}</pre><p>The following example shows a schedule for LiveSync enabled to run 
  every 15 seconds, starting at the beginning of the minute. The schedule is 
  persisted, that is, stored in the internal repository rather than in memory. 
  If one or more LiveSync executions are missed, as a result of OpenIDM being 
  unavailable, the first execution of the LiveSync action is executed when the 
  server is back online. Subsequent executions are discarded. After this, the 
  normal schedule is resumed.</p><pre class="brush: javascript;">{
    "enabled": false,
    "persisted": true,
    "misfirePolicy" : "fireAndProceed",
    "type": "cron",
    "schedule": "0/15 * * * * ?",
    "invokeService": "provisioner",
    "invokeContext": {
        "action": "liveSync",
        "source": "system/ldap/account"
    }
}</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="schedules-over-rest"></a>12.4.&nbsp;Managing Schedules Over REST</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#creating-schedules">12.4.1. Creating a Schedule</a></span></dt><dt><span class="section"><a href="#schedule-details">12.4.2. Obtaining the Details of a Schedule</a></span></dt><dt><span class="section"><a href="#updating-schedules">12.4.3. Updating a Schedule</a></span></dt><dt><span class="section"><a href="#listing-schedules">12.4.4. Listing Configured Schedules</a></span></dt><dt><span class="section"><a href="#deleting-schedules">12.4.5. Deleting a Schedule</a></span></dt></dl></div><p>
   OpenIDM exposes the scheduler service under the
   <code class="literal">/openidm/scheduler</code> context path. The following examples
   show how schedules can be created, read, updated, and deleted, over REST,
   like any other object.
  </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="creating-schedules"></a>12.4.1.&nbsp;Creating a Schedule</h3></div></div></div><p>
    You can create a schedule with a PUT request, which allows you to specify
    the ID of the schedule, or with a POST request, in which case the server
    assigns an ID automatically.
   </p><p>
    The following example uses a PUT request to create a schedule that fires a
    script (<code class="filename">script/testlog.js</code>) every second. The schedule
    configuration is as described in <a class="xref" href="#scheduler-configuration-file" title="12.1.&nbsp;Scheduler Configuration">Section&nbsp;12.1, &#8220;Scheduler Configuration&#8221;</a>.
   </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request PUT \
 --data '{
    "enabled":true,
    "type":"cron",
    "schedule":"0/1 * * * * ?",
    "persisted":true,
    "misfirePolicy":"fireAndProceed",
    "invokeService":"script",
    "invokeContext": {
        "script": {
            "type":"text/javascript",
            "file":"script/testlog.js"
        }
    }
 }' \
 "https://localhost:8443/openidm/scheduler/testlog-schedule"</strong>
<em>{
  "type": "cron",
  "invokeService": "script",
  "persisted": true,
  "_id": "testlog-schedule",
  "schedule": "0/1 * * * * ?",
  "misfirePolicy": "fireAndProceed",
  "enabled": true,
  "invokeContext": {
    "script": {
      "file": "script/testlog.js",
      "type": "text/javascript"
    }
  }
}</em></pre></div><p>
    The following example uses a POST request to create an identical schedule to
    the one created in the previous example, but with a server-assigned ID.
   </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 --data '{
    "enabled":true,
    "type":"cron",
    "schedule":"0/1 * * * * ?",
    "persisted":true,
    "misfirePolicy":"fireAndProceed",
    "invokeService":"script",
    "invokeContext": {
        "script": {
            "type":"text/javascript",
            "file":"script/testlog.js"
        }
    }
 }' \
 "https://localhost:8443/openidm/scheduler?_action=create"</strong>
<em>{
  "type": "cron",
  "invokeService": "script",
  "persisted": true,
  "_id": "d6d1b256-7e46-486e-af88-169b4b1ad57a",
  "schedule": "0/1 * * * * ?",
  "misfirePolicy": "fireAndProceed",
  "enabled": true,
  "invokeContext": {
    "script": {
      "file": "script/testlog.js",
      "type": "text/javascript"
    }
  }
}</em></pre></div><p>
    The output includes the <code class="literal">_id</code> of the schedule, in this case
    <code class="literal">"_id": "d6d1b256-7e46-486e-af88-169b4b1ad57a"</code>.
   </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="schedule-details"></a>12.4.2.&nbsp;Obtaining the Details of a Schedule</h3></div></div></div><p>
    The following example displays the details of the schedule created in the
    previous section. Specify the schedule ID in the URL.
   </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/scheduler/d6d1b256-7e46-486e-af88-169b4b1ad57a"</strong>
<em>{
  "_id": "d6d1b256-7e46-486e-af88-169b4b1ad57a",
  "schedule": "0/1 * * * * ?",
  "misfirePolicy": "fireAndProceed",
  "startTime": null,
  "invokeContext": {
    "script": {
      "file": "script/testlog.js",
      "type": "text/javascript"
    }
  },
  "enabled": true,
  "concurrentExecution": false,
  "persisted": true,
  "timeZone": null,
  "type": "cron",
  "invokeService": "org.forgerock.openidm.script",
  "endTime": null,
  "invokeLogLevel": "info"
}</em></pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="updating-schedules"></a>12.4.3.&nbsp;Updating a Schedule</h3></div></div></div><p>
    To update a schedule definition, use a PUT request and update all properties
    of the object. Note that PATCH requests are currently supported only for
    managed objects. The following example disables the schedule created in the
    previous section.
   </p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request PUT \
 --data '{
    "enabled":false,
    "type":"cron",
    "schedule":"0/1 * * * * ?",
    "persisted":true,
    "misfirePolicy":"fireAndProceed",
    "invokeService":"script",
    "invokeContext": {
        "script": {
            "type":"text/javascript",
            "file":"script/testlog.js"
        }
    }
 }' \
 "https://localhost:8443/openidm/scheduler/d6d1b256-7e46-486e-af88-169b4b1ad57a"</strong>
   <em>null</em></pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="listing-schedules"></a>12.4.4.&nbsp;Listing Configured Schedules</h3></div></div></div><p>
    To display a list of all configured schedules, query the
    <code class="literal">openidm/scheduler</code> context path as shown in the following
    example:
   </p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/scheduler?_queryId=query-all-ids"</strong>
<em>{
  "remainingPagedResults": -1,
  "pagedResultsCookie": null,
  "resultCount": 2,
  "result": [
    {
      "_id": "d6d1b256-7e46-486e-af88-169b4b1ad57a"
    },
    {
      "_id": "recon"
    }
  ]
}</em></pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="deleting-schedules"></a>12.4.5.&nbsp;Deleting a Schedule</h3></div></div></div><p>
    To deleted a configured schedule, call a DELETE request on the schedule ID.
    For example:
   </p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request DELETE \
 "https://localhost:8443/openidm/scheduler/d6d1b256-7e46-486e-af88-169b4b1ad57a"</strong>
<em>null</em></pre></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="task-scanner"></a>12.5.&nbsp;Scanning Data to Trigger Tasks</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#task-scanner-config">12.5.1. Configuring the Task Scanner</a></span></dt><dt><span class="section"><a href="#task-scanner-rest">12.5.2. Managing Scanning Tasks Over REST</a></span></dt></dl></div><p>
   In addition to the fine-grained scheduling facility described previously,
   OpenIDM provides a task scanning mechanism. The task scanner enables you to
   perform a batch scan on a specified property in OpenIDM, at a scheduled
   interval, and then to execute a task when the value of that property matches
   a specified value.
  </p><p>
   When the task scanner identifies a condition that should trigger the task, it
   can invoke a script created specifically to handle the task.
  </p><p>
   For example, the task scanner can scan all <code class="literal">managed/user</code>
   objects for a "sunset date" and can invoke a script that executes a "sunset
   task" on the user object when this date is reached.
  </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="task-scanner-config"></a>12.5.1.&nbsp;Configuring the Task Scanner</h3></div></div></div><p>
   The task scanner is essentially a scheduled task that queries a set of
   managed users. The task scanner is configured in the same way as a regular
   scheduled task, in a schedule configuration file named
   (<code class="filename">schedule-<em class="replaceable"><code>task-name</code></em>.json)</code>,
   with the <code class="literal">"invokeService"</code> parameter set to
   <code class="literal">"taskscanner</code>. The <code class="literal">"invokeContext"</code>
   parameter defines the details of the scan, and the task that should be
   executed when the specified condition is triggered.
  </p><p>
   The following example defines a scheduled scanning task that triggers a
   sunset script. This sample configuration file is provided in the OpenIDM
   delivery as
   <code class="filename">openidm/samples/taskscanner/conf/schedule-taskscan_sunset.json</code>.
   To use this sample file, copy it to the <code class="filename">openidm/conf</code>
   directory. The sample file calls a script (<code class="filename">script/sunset.js</code>)
   which must be copied from <code class="filename">openidm/samples/taskscanner/script/sunset.js</code>
   to the <code class="filename">openidm/script</code> directory.
  </p><pre class="brush: javascript;">
{
    "enabled" : true,
    "type" : "cron",
    "schedule" : "0 0 * * * ?",
    "concurrentExecution" : false,
    "invokeService" : "taskscanner",
    "invokeContext" : {
        "waitForCompletion" : false,
        "maxRecords" : 2000,
        "numberOfThreads" : 5,
        "scan" : {
            "_queryId" : "scan-tasks",
            "property" : "sunset/date",
            "condition" : {
                "before" : "${Time.now}"
            },
            "taskState" : {
                "started" : "sunset/task-started",
                "completed" : "sunset/task-completed"
            },
            "recovery" : {
                "timeout" : "10m"
            }
        },
        "task" : {
            "script" : {
                "type" : "text/javascript",
                "file" : "script/sunset.js"
            }
        }
    }
}</pre><div class="variablelist"><p>
   The <code class="literal">"invokeContext"</code> parameter takes the following
   properties:
  </p><dl class="variablelist"><dt><span class="term"><code class="literal">"waitForCompletion"</code> (optional)</span></dt><dd><p>
     This property specifies whether the task should be performed synchronously.
     Tasks are performed asynchronously by default (with
     <code class="literal">waitForCompletion</code> set to false). A task ID (such as
     <code class="literal">{"_id":"354ec41f-c781-4b61-85ac-93c28c180e46"}</code>) is
     returned immediately. If this property is set to true, tasks are performed
     synchronously and the ID is not returned until all tasks have completed.
    </p></dd><dt><span class="term"><code class="literal">"maxRecords"</code> (optional)</span></dt><dd><p>
     The maximum number of records that can be processed. This property is not
     set by default so the number of records is unlimited. If a maximum number
     of records is specified, that number will be spread evenly over the number
     of threads.
    </p></dd><dt><span class="term"><code class="literal">"numberOfThreads"</code> (optional)</span></dt><dd><p>
     By default, the task scanner runs in a multi-threaded manner, that is,
     numerous threads are dedicated to the same scanning task run.
     Multithreading generally improves the performance of the task scanner. The
     default number of threads for a single scanning task is ten. To change this
     default, set the <code class="literal">"numberOfThreads"</code> property.
    </p></dd><dt><span class="term"><code class="literal">"scan"</code></span></dt><dd><p>
     Defines the details of the scan. The following properties are defined:
    </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">"object"</code></span></dt><dd><p>
        Defines the object type against which the query should be performed.
       </p></dd><dt><span class="term"><code class="literal">"_queryId"</code></span></dt><dd><p>
        Specifies the query that is performed. The queries that can be set here
        are defined in the database configuration file (either
        <code class="filename">conf/repo.orientdb.json</code> or
        <code class="filename">conf/repo.jdbc.json</code>).
       </p></dd><dt><span class="term"><code class="literal">"property"</code></span></dt><dd><p>
        Defines the property against which the query is performed.
       </p><p>
        If you are using a JDBC repository, with a generic mapping, you must
        explicitly set this property as searchable so that it can be queried by
        the task scanner. For more information, see <a href="../install-guide/index.html#generic-mappings" class="link"><em class="citetitle">Using
        Generic Mappings</em></a> in the <em class="citetitle">Installation
        Guide</em>.
       </p></dd><dt><span class="term"><code class="literal">"condition"</code> (optional)</span></dt><dd><p>Indicates the conditions that must be matched for the defined 
       property.</p><p>In the previous example, the scanner scans for users for whom the 
       property <code class="literal">sunset/date</code> is set to a value prior to the 
       current timestamp at the time the script is executed.</p><p>You can use these fields to define any condition. For example, if 
       you wanted to limit the scanned objects to a specified location, say, 
       London, you could formulate a query to compare against object locations 
       and then set the condition to be:</p><pre class="brush: javascript;">
            "condition" : {
                "location" : "London"
            },</pre><p>For time-based conditions, the <code class="literal">"condition"</code> 
        property supports macro syntax, based on the <code class="literal">Time.now</code> 
        object (which fetches the current time). You can specify any date/time 
        in relation to the current time, using the <code class="literal">+</code> or 
        <code class="literal">-</code> operator, and a duration modifier. For example: 
        <code class="literal">"before": "${Time.now + 1d}"</code> would return all user 
        objects whose <code class="literal">sunset/date</code> is before tomorrow 
        (current time plus one day). You must include space characters around the 
        operator (<code class="literal">+</code> or <code class="literal">-</code>). The duration 
        modifier supports the following unit specifiers:</p><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="literal">s</code> - second</td></tr><tr><td><code class="literal">m</code> - minute</td></tr><tr><td><code class="literal">h</code> - hour</td></tr><tr><td><code class="literal">d</code> - day</td></tr><tr><td><code class="literal">M</code> - month</td></tr><tr><td><code class="literal">y</code> - year</td></tr></table></dd><dt><span class="term"><code class="literal">"taskState"</code></span></dt><dd><p>Indicates the fields that are used to track the status of the 
       task.</p><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="literal">"started"</code> specifies the field that stores 
        the timestamp for when the task begins.</td></tr><tr><td><code class="literal">"completed"</code> specifies the field that stores 
        the timestamp for when the task completes its operation. The
        <code class="literal">"completed"</code> field is present as soon as the task has
        started, but its value is <code class="literal">null</code> until the task has
        completed.</td></tr></table></dd><dt><span class="term"><code class="literal">"recovery"</code> (optional)</span></dt><dd><p>Specifies a configurable timeout, after which the task scanner 
        process ends. In a scenario with clustered OpenIDM instances, there 
        might be more than one task scanner running at a time. A task 
        cannot be executed by two task scanners at the same time. When one 
        task scanner "claims" a task, it indicates that the task has been 
        started. That task is then unavailable to be claimed by another task 
        scanner and remains unavailable until the end of the task is indicated. 
        In the event that the first task scanner does not complete the task by 
        the specified timeout, for whatever reason, a second task scanner can 
        pick up the task.</p></dd></dl></div></dd><dt><span class="term"><code class="literal">"task"</code></span></dt><dd><p>Provides details of the task that is performed. Usually, 
   the task is invoked by a script, whose details are defined in the 
   <code class="literal">"script"</code> property:</p><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="literal">"type"</code> - the type of script. Currently, only 
     JavaScript is supported.</td></tr><tr><td><code class="literal">"file"</code> - the path to the script file. The script 
     file takes at least two objects (in addition to the default objects that 
     are provided to all OpenIDM scripts): <code class="literal">"input"</code> which is 
     the individual object that is retrieved from the query (in the example, 
     this is the individual user object) and <code class="literal">"objectID"</code> 
     which is a string that contains the full identifier of the object. The 
     objectID is useful for performing updates with the script as it allows you 
     to target the object directly, for example: 
     <code class="literal">openidm.update(objectID, input['_rev'], input);</code>. A sample 
     script file is provided in <code class="filename">openidm/samples/taskscanner/script/sunset.js</code>. 
     To use this sample file, you must copy it to the <code class="filename">openidm/script</code> 
     directory. The sample script marks all user objects that match the 
     specified conditions as "inactive". You can use this sample script to 
     trigger a specific workflow, or any other task associated with the sunset 
     process. For more information about using scripts in OpenIDM, see the 
     <a href="../integrators-guide/index.html#appendix-scripting" class="link">
     <em class="citetitle">Scripting Reference</em></a>.</td></tr></table></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="task-scanner-rest"></a>12.5.2.&nbsp;Managing Scanning Tasks Over REST</h3></div></div></div><p>You can trigger, cancel, and monitor scanning tasks over the REST 
   interface, using the REST endpoint 
   <code class="literal">https://localhost:8443/openidm/taskscanner</code>.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="triggering-task-scanner"></a>12.5.2.1.&nbsp;Triggering a Scanning Task</h4></div></div></div><p>The following REST command executes a task named "taskscan_sunrise". 
    The task itself is defined in a file named 
    <code class="filename">openidm/conf/schedule-taskscan_sunset.json</code>.</p><div class="screen"><pre>
$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 "https://localhost:8443/openidm/taskscanner?_action=execute&amp;name=schedule/taskscan_sunset"</strong>
   </pre></div><p>By default, a scanning task ID is returned immediately when the task 
   is initiated. Clients can make subsequent calls to the task scanner service, 
   using this task ID to query its state and to call operations on it.</p><p>For example, the scanning task initiated previously would return
    something similar to the following, as soon as it was initiated:</p><div class="screen"><pre>{"_id":"edfaf59c-aad1-442a-adf6-3620b24f8385"}</pre></div><p>To have the scanning task complete before the ID is returned, set the 
    <code class="literal">waitForCompletion</code> property to <code class="literal">true</code> 
    in the task definition file (<code class="filename">schedule-taskscan_sunset.json</code>). 
    You can also set the property directly over the REST interface when the task is 
    initiated. For example:</p><div class="screen"><pre>
$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 "https://localhost:8443/openidm/taskscanner?_action=execute&amp;name=schedule/taskscan_sunset&amp;waitForCompletion=true"</strong>
    </pre></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="canceling-task-scanner"></a>12.5.2.2.&nbsp;Canceling a Scanning Task</h4></div></div></div><p>You can cancel a scanning task by sending a REST call with the 
    <code class="literal">cancel</code> action, specifying the task ID. For example, the 
    following call cancels the scanning task initiated in the previous section.
    </p><div class="screen"><pre>
$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 "https://localhost:8443/openidm/taskscanner/edfaf59c-aad1-442a-adf6-3620b24f8385?_action=cancel"</strong>
    </pre></div><p>The output for a scanning task cancellation request is similar to the
    following:</p><div class="screen"><pre>
    {"_id":"edfaf59c-aad1-442a-adf6-3620b24f8385",
     "action":"cancel",
     "status":"SUCCESS"}
    </pre></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="listing-task-scanner"></a>12.5.2.3.&nbsp;Listing Scanning Tasks</h4></div></div></div><p>
     You can display a list of scanning tasks that have completed, and
    those that are in progress, by running a RESTful GET on the
    <code class="literal">openidm/taskscanner"</code> context. The following example
     displays all scanning tasks.</p><div class="screen"><pre>
$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/taskscanner"</strong>
    </pre></div><p>The output of such a request is similar to the following, with one 
    item for each scanning task.</p><div class="screen"><pre>{
 "tasks": [
    {
      "ended": 1352455546182
      "started": 1352455546149,
      "progress": {
        "failures": 0
        "successes": 2400,
        "total": 2400,
        "processed": 2400,
        "state": "COMPLETED",
      },
      "_id": "edfaf59c-aad1-442a-adf6-3620b24f8385",
    }
  ]
}
    </pre></div><div class="variablelist"><p>Each scanning task has the following properties:</p><dl class="variablelist"><dt><span class="term"><code class="literal">ended</code></span></dt><dd><p>The time at which the scanning task ended.</p></dd><dt><span class="term"><code class="literal">started</code></span></dt><dd><p>The time at which the scanning task started.</p></dd><dt><span class="term"><code class="literal">progress</code></span></dt><dd><p>The progress of the scanning task, summarised in the following 
       fields:</p><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="literal">failures</code> - the number of records not able
        to be processed</td></tr><tr><td><code class="literal">successes</code> - the number of records processed
         successfully</td></tr><tr><td><code class="literal">total</code> - the total number of records</td></tr><tr><td><code class="literal">processed</code> - the number of processed records
        </td></tr><tr><td><code class="literal">state</code> - the overall state of the task,
         <code class="literal">INITIALIZED</code>, <code class="literal">ACTIVE</code>, <code class="literal">
          COMPLETED</code>, <code class="literal">CANCELLED</code>, or <code class="literal">
          ERROR</code>
        </td></tr></table></dd><dt><span class="term"><code class="literal">_id</code></span></dt><dd><p>The ID of the scanning task.</p></dd></dl></div><p>The number of processed tasks whose details are retained is governed 
    by the <code class="literal">"openidm.taskscanner.maxcompletedruns"</code> property 
    in the <code class="filename">conf/system.properties</code> file. By default, the 
    last one hundred completed tasks are retained.</p></div></div></div></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-passwords"></a>Chapter&nbsp;13.&nbsp;Managing Passwords</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="section"><a href="#enforce-password-policy">13.1. Enforcing Password Policy</a></span></dt><dt><span class="section"><a href="#password-sync">13.2. Password Synchronization</a></span></dt></dl></div><a class="indexterm" name="d505e11781"></a><p>OpenIDM provides password management features that help you enforce
 password policies, limit the number of passwords users must remember, and
 let users reset and change their passwords.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="enforce-password-policy"></a>13.1.&nbsp;Enforcing Password Policy</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#password-history">13.1.1. Creating a Password History Policy</a></span></dt></dl></div><p>A password policy is a set of rules defining what sequence of
  characters constitutes an acceptable password. Acceptable passwords generally
  are too complex for users or automated programs to generate or guess.</p><p>Password policies set requirements for password length, character sets
  that passwords must contain, dictionary words and other values that passwords
  must not contain. Password policies also require that users not reuse old
  passwords, and that users change their passwords on a regular basis.</p><a class="indexterm" name="d505e11793"></a><p>OpenIDM enforces password policy rules as part of the general policy 
  service. For more information about the policy service, see 
  <a href="../integrators-guide/index.html#chap-policies" class="link">
  <em class="citetitle">Using Policies to Validate Data</em></a>. The default 
  password policy applies the following rules to passwords as they are created 
  and updated:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>A password property is required for any user object.</p></li><li class="listitem"><p>The value of a password cannot be empty.</p></li><li class="listitem"><p>The password must include at least one capital letter.
    </p></li><li class="listitem"><p>The password must include at least one number.</p></li><li class="listitem"><p>The minimum length of a password is 8 characters.</p></li><li class="listitem"><p>The password cannot contain the user name, given name, or 
    family name.</p></li></ul></div><p>You can remove these validation requirements, or include additional 
  requirements, by configuring the policy for passwords. For more information, 
  see <a href="../integrators-guide/index.html#configuring-default-policy" class="link">
  <em class="citetitle">Configuring the Default Policy</em></a>.</p><div class="variablelist"><p>The password validation mechanism can apply in many situations.</p><dl class="variablelist"><dt><span class="term">Password change and password reset</span></dt><dd><p>Password change involves changing a user or account password
     in accordance with password policy. Password reset involves setting a
     new user or account password on behalf of a user.</p><p>By default, OpenIDM controls password values as they are
     provisioned.</p><p>To change the default administrative user password,
     <code class="literal">openidm-admin</code>, see the procedure, <a href="../integrators-guide/index.html#security-replace-default-user-password" class="link"><em class="citetitle">To Replace the Default User and Password</em></a>,
     for instructions.</p></dd><dt><span class="term">Password recovery</span></dt><dd><p>Password recovery involves recovering a password or setting a new
     password when the password has been forgotten.</p><p>OpenIDM provides a self-service end user interface for password
     changes, password recovery, and password reset. For more information, see 
     <span class="olink">
     <em class="citetitle">Managing Passwords With the UI</em></span>.</p></dd><dt><span class="term">Password comparisons with dictionary words</span></dt><dd><p>You can add dictionary lookups to prevent use of password values
     that match dictionary words.</p></dd><dt><span class="term">Password history</span></dt><dd><p>
      You can add checks to prevent reuse of previous password values. For more
      information, see <a class="xref" href="#password-history" title="13.1.1.&nbsp;Creating a Password History Policy">Section&nbsp;13.1.1, &#8220;Creating a Password History Policy&#8221;</a>.
     </p></dd><dt><span class="term">Password expiration</span></dt><dd><p>You can configure OpenIDM to call a workflow that ensures users
     are able to change expiring or to reset expired passwords.</p></dd></dl></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="password-history"></a>13.1.1.&nbsp;Creating a Password History Policy</h3></div></div></div><a class="indexterm" name="d505e11891"></a><p>
     To minimize password reuse, you can set up a password history policy.
     One way to do so is with a custom javascript file for the
     <code class="literal">onCreate</code> trigger. You can then add a reference
     to that javascript file in the <code class="filename">conf/managed.json</code> file.
    </p><p>
     You would then add a scripted policy in a custom javascript file,
     ready to be called out in appropriate JSON configuration files.
    </p><p>
     The following procedure retains a record of the last four passwords for
     each user. Any attempt to reuse one of those passwords is rejected.
    </p><p>
     This procedure takes advantage of the directories configured in
     the <code class="filename">conf/script.json</code> file. If you started
     OpenIDM with files in some <code class="filename">customconfig</code>
     subdirectory, you would need to make sure such files exist in
     that directory tree. For more information, see the section on <a href="../integrators-guide/index.html#config-default-directories" class="link">
     <em class="citetitle">Default and Custom Configuration Directories</em>.
     </a>
    </p><div class="procedure"><a name="create-password-array"></a><div class="procedure-title">Procedure&nbsp;13.1.&nbsp;Configuring Limits on Password History</div><ol class="procedure" type="1"><li class="step"><p>
      Create a custom <code class="literal">onCreate</code> javascript file. One
      way to do so is with a copy of the
      <code class="filename">onCreate-user-set-default-files.js</code> file in the
      <code class="filename">bin/defaults/script/ui</code> directory.
      You can save the custom file in the
      <code class="filename">script</code> directory. For example,
      the following commands create an
      <code class="filename">onCreate-user-custom.js</code> file in the default
      script directory defined in <code class="filename">conf/script.json</code>:
     </p><div class="screen"><pre>$ cd /path/to/openidm/bin/defaults/script/ui
$ cp onCreate-user-set-default-fields.js /path/to/openidm/script/onCreate-user-custom.js</pre></div></li><li class="step"><p>
      In the newly created custom Javascript file, include the cipher for
      password encryption:
     </p><div class="screen"><pre>var cipher = "AES/CBC/PKCS5Padding",
     alias = identityServer.getProperty("openidm.config.crypto.alias", "true", true);</pre></div></li><li class="step"><p>
      Next, declare a new
      <code class="literal">lastPass</code> attribute. For example, to prevent
      reuse of the last four passwords, you would add the following line:
     </p><div class="screen"><pre>object.lastPass = new Array(4);</pre></div></li><li class="step"><p>
      After the new array is declared, the following lines would increment
      the previous password:
     </p><div class="screen"><pre>if (object.password) {
    object.lastPass.shift();
    object.lastPass.push(object.password);
}</pre></div></li><li class="step"><p>
      Now create a new file with a script that increments passwords in the
      array with each new password. This procedure uses the following file name:
      <code class="filename">onUpdate-user-pwpolicy.js</code>, written to the same
      directory as the <code class="filename">onCreate-user-custom.js</code> file,
      in this case, <code class="filename">script</code>.
     </p></li><li class="step"><p>
      Add the following content to the newly created
      <code class="filename">onUpdate-user-pwpolicy.js</code> file:
     </p><div class="screen"><pre>/*global newObject, oldObject */
var cipher = "AES/CBC/PKCS5Padding",
  alias = identityServer.getProperty("openidm.config.crypto.alias", "true", true);

if (openidm.isEncrypted(newObject.lastPass)) {
  newObject.lastPass = openidm.decrypt(newObject.lastPass);
}

if (typeof newObject.lastPass === "undefined") {
  newObject.lastPass = new Array(4);
}

if (newObject.password !== oldObject.password) {
  newObject.lastPass.shift();
  newObject.lastPass.push(newObject.password);
}

newObject.lastPass = openidm.encrypt(newObject.lastPass, cipher, alias);
}</pre></div></li><li class="step"><p>
      In the existing <code class="filename">conf/managed.json</code> file, add
      appropriate lines that point to the files just created in the
      <code class="filename">script</code> directory. Given the
      default directories previously described in the <code class="filename">
      conf/script.json</code> file, you do not need to add a
      directory path to the newly created files. The following is
      an excerpt of the modified <code class="filename">conf/managed.json</code> file:
     </p><div class="screen"><pre>{
      "objects" : [
           "name" : "user"
           "onCreate" : {
                "type" : "text/javascript",
                "file" : "onCreate-user-custom.js"
           },
           "onUpdate" : {
                "type" : "text/javascript",
                "file" : "onUpdate-user-pwpolicy.js"
           },
           "onDelete" : {
                "type" : "text/javascript",
                "file" : "ui/onDelete-user-cleanup.js"
           },</pre></div></li><li class="step"><p>
      Now extend the policy service to all users by adding a scripted
      policy. One way to do so is by adding the following information to
      a custom javascript file. For this procedure, call that file
      <code class="filename">pwpolicy.js</code>, also in the <code class="filename">script</code>
      subdirectory.
     </p><p>
      As you can see from the comments to the file, it is designed to ignore new
      users, users without a password history, and users for whom passwords
      have not changed.
     </p><p>
      The last part of the file decrypts encrypted passwords prior to making
      the comparison, and makes sure the password has a non-zero length.
     </p><div class="screen"><pre>/*global addPolicy, request, openidm */

addPolicy({
  "policyId" : "is-new",
  "policyExec" : "isNew",
  "policyRequirements" : ["IS_NEW"]
});

function isNew(fullObject, value, params, property) {
  var currentObject, lastPass, i;

  // don't do a read if the resource ends with "/*", which indicates that
  // this is a create with a server-supplied id
  if (!request.resourceName || request.resourceName.match('/\\*$')) {
    return [];
  }

  currentObject = openidm.read(request.resourceName);

  // don't try this policy if the resource being evaluated wasn't found. Happens in the
  // case of a create with a client-supplied id.
  if (currentObject === null) {
    return [];
  }

  // don't try this policy is there is no history object available
  if (currentObject.lastPass === null || currentObject.lastPass === undefined) {
     return [];
  }

  if (currentObject[property] !== null &amp;&amp; currentObject[property] !== undefined &amp;&amp;
     openidm.isEncrypted(currentObject[property])) {
     currentObject[property] = openidm.decrypt(currentObject[property]);
  }

  // if the password hasn't changed, then we aren't interested in checking the history
  if (currentObject[property] === value) {
     return [];
  }

  if (openidm.isEncrypted(currentObject.lastPass)) {
     lastPass = openidm.decrypt(currentObject.lastPass);
  } else {
     lastPass = currentObject.lastPass;
  }

  for(i=0; i &lt; lastPass.length; i++) {
    if (lastPass[i] === value) {
      return [{"policyRequirement": "IS_NEW"}];
    }
  }
  return [];

}</pre></div></li><li class="step"><p>
      Now open the <code class="filename">conf/policy.json</code> file. Add
      the following lines to call the newly created
      <code class="filename">pwpolicy.js</code> script, right after
      the existing line that calls the <code class="filename">policy.js</code>
      script:
     </p><div class="screen"><pre>...
      "file" : "policy.js",
      "additionalFiles" :  [
          "script/pwpolicy.js"],
...</pre></div></li><li class="step"><p>
      Later in the same <code class="filename">conf/policy.json</code> file, in the
      <code class="literal">password</code> configuration block, add the newly created
      <code class="literal">is-new</code> <code class="literal">policyId</code>:
     </p><div class="screen"><pre>...
     {
          "name" : "password",
          "policies" : [
              {
                  "policyId" : "not-empty"
              },
              {
                  "policyId" : "is-new"
              },
...</pre></div></li><li class="step"><p>
      Reopen the <code class="filename">conf/managed.json</code> file. Add the following
      code to the <code class="literal">properties</code> section to encrypt the
      new <code class="literal">lastPass</code> attribute, and
      to prevent REST retrievals of such passwords:
     </p><div class="screen"><pre>...
      "properties" : [
          {
              "name" : "lastPass",
              "encryption" : {
                  "key" : "openidm-sym-default"
              },
              "scope" : "private"
          }
      ...</pre></div></li></ol></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="password-sync"></a>13.2.&nbsp;Password Synchronization</h2></div></div></div><a class="indexterm" name="d505e12066"></a><p>
   Password synchronization intercepts user password changes, and ensures
   uniform password changes across resources that store the password. Following
   password synchronization, the user authenticates using the same password on
   each resource. No centralized directory or authentication server is required
   for performing authentication. Password synchronization reduces the number of
   passwords users need to remember, so they can use fewer, stronger passwords.
  </p><p>
   OpenIDM can propagate passwords to the resources that store a user's
   password, and can intercept and synchronize passwords that are changed
   natively in OpenDJ and Active Directory.
  </p><p>
   When you use password synchronization, set up password policy enforcement on
   OpenDJ or Active Directory rather than on OpenIDM. Alternatively, ensure that
   all password policies that are enforced are identical to prevent password
   updates on one resource from being rejected by OpenIDM or by another
   resource.
  </p><p>
   The password synchronization plugins intercept password changes on the
   resource before the passwords are stored in encrypted form. The plugins then
   send intercepted password values to OpenIDM over an encrypted channel.
  </p><p>
   In the event that the OpenIDM instance is unavailable when a password is
   changed, the plugin intercepts the change, encrypts the password, and stores
   the encrypted password in a JSON file. The plugin then checks whether the
   OpenIDM instance is available, at a predefined interval. When OpenIDM becomes
   available, the plugin performs a PATCH on the user record, to replace the
   password with the encrypted password stored in the JSON file.
  </p><p>
   To be able to synchronize the passwords, the plugin requires that the
   <code class="literal">managed/user</code> object exist in the OpenIDM repository. Users
   have typically been created by a reconciliation or liveSync process.
  </p><p>
   The OpenDJ password sync plugin is supported for OpenDJ versions 2.4.6, 2.5,
   and 2.6. The Active Directory password sync plugin is supported on Windows
   2008 RC 2, Active Directory version 47.
  </p><p>
   The sample provided in
   <code class="filename">/path/to/openidm/samples/misc/managed.json</code> shows
   password synchronization between three systems - OpenIDM, OpenDJ, and Active
   Directory. The sample assumes that the following steps have been performed:
  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
     You have set up OpenDJ and Active Directory.
    </p></li><li class="listitem"><p>
     The password attributes for the three systems are as follows:
    </p><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="literal">ldapPassword</code> for OpenDJ</td></tr><tr><td><code class="literal">adPassword</code> for Active Directory</td></tr><tr><td><code class="literal">password</code> for the internal OpenIDM password</td></tr></table></li><li class="listitem"><p>
     You have installed the password synchronization plugins, as described in
     the following sections.
    </p></li></ul></div><div class="procedure"><a name="install-opendj-password-sync-plugin"></a><div class="procedure-title">Procedure&nbsp;13.2.&nbsp;To Install the OpenDJ Password Synchronization Plugin</div><a class="indexterm" name="d505e12119"></a><div class="itemizedlist"><p>
      Before you start:
     </p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
       Make sure that OpenDJ is configured to communicate over LDAPS as
       described in the <a class="link" href="http://opendj.forgerock.org/doc/admin-guide/#chap-listeners" target="_blank">OpenDJ documentation</a>.
      </p></li><li class="listitem"><p>
       OpenIDM must be running.
      </p></li></ul></div><p>
    The following steps install the plugin on an OpenDJ directory server that is
    running on the same host as OpenIDM. If you run OpenDJ on a different host,
    use the fully qualified domain name rather than
    <code class="literal">localhost</code>, and use your certificates rather than the
    generated OpenIDM certificate.
   </p><ol class="procedure" type="1"><li class="step"><p>
     OpenIDM generates a self-signed certificate the first time it starts up.
     You must import this self-signed certificate into OpenDJ's truststore so
     that the OpenDJ agent can make SSL requests to the OpenIDM endpoints.
    </p><ol type="a" class="substeps"><li class="step"><p>
       Export OpenIDM's generated self-signed certificate to a file, as follows:
      </p><div class="screen"><pre>$ cd /path/to/openidm/security
$ keytool
 -export
 -alias openidm-localhost
 -file openidm-localhost.crt
 -keystore keystore.jceks
 -storetype jceks
Enter keystore password: &lt;changeit&gt;
Certificate stored in file &lt;openidm-localhost.crt&gt;</pre></div></li><li class="step"><p>
       Import the self-signed certificate into the trust store for OpenDJ.
      </p><div class="screen"><pre>$ cd /path/to/OpenDJ/config
$ keytool
 -import
 -alias openidm-localhost
 -keystore truststore
 -storepass `cat keystore.pin`
 -file /path/to/openidm/security/openidm-localhost.crt
Owner: C=None, L=None, O=OpenIDM Self-Signed Certificate, OU=None, CN=localhost
Issuer: C=None, L=None, O=OpenIDM Self-Signed Certificate, OU=None, CN=localhost
Serial number: 1544a7b975ed50a7
Valid from: Sat Oct 19 16:04:41 SAST 2013 until: Thu Nov 16 16:04:41 SAST 2023
Certificate fingerprints:
	 MD5:  0C:BF:08:06:F0:69:E8:E6:6F:39:38:B8:CC:9A:C1:60
	 SHA1: B0:40:17:0A:6E:3A:3B:BB:82:39:A1:97:04:00:BC:7C:94:63:76:E7
	 Signature algorithm name: SHA512withRSA
	 Version: 3
Trust this certificate? [no]:  yes
Certificate was added to keystore
      </pre></div></li></ol></li><li class="step"><p>
     Download the OpenDJ password synchronization plugin (OpenIDM Agents-OpenDJ)
     from the OpenIDM download page under the ForgeRock <a class="link" href="http://forgerock.com/download-stack/" target="_blank">Open Stack download page</a>.
    </p></li><li class="step"><p>
     Unzip the module delivery.
    </p><div class="screen"><pre>
$ unzip ~/Downloads/opendj-accountchange-handler-1.0.0.zip
   creating: opendj/
   creating: opendj/config/
   creating: opendj/config/schema/
...</pre></div></li><li class="step"><p>
     Copy the files to the directory where OpenDJ is installed.
    </p><div class="screen"><pre>$ cd opendj
$ cp -r * /path/to/OpenDJ/</pre></div></li><li class="step"><p>
     Workaround for <code class="literal">OPENIDM-1380</code>:
    </p><p>
     Edit the file
     <code class="filename">/path/to/OpenDJ/config/schema/90-openidm-pwsync-plugin.ldif</code>
     to remove the attributes <code class="literal">ds-cfg-sql-user</code> and
     <code class="literal">ds-cfg-sql-passwd</code>.
    </p></li><li class="step"><p>
     Workaround for <code class="literal">OPENIDM-1379</code>:
    </p><p>
     Move the following nine jar files from the <code class="literal">opendj/lib</code>
     folder into the <code class="literal">opendj/lib/extensions</code> folder:
    </p><div class="screen"><pre>
$ cd /path/to/opendj/lib
$ mv json-fluent-1.1.0.jar extensions/
$ mv org.forgerock.util-1.0.0.jar extensions/
$ mv json-crypto-core-1.1.0.jar extensions/
$ mv jackson-core-asl-1.9.3.jar extensions/
$ mv jackson-mapper-asl-1.9.3.jar extensions/
$ mv org.restlet-2.0.10.jar extensions/
$ mv org.restlet.ext.jackson-2.0.10.jar extensions/
$ mv org.restlet.ext.net-2.0.10.jar extensions/
$ mv commons-codec-1.5.jar extensions/
       </pre></div></li><li class="step"><p>
     Restart OpenDJ to load the additional schema from the module.
    </p><div class="screen"><pre>$ cd /path/to/OpenDJ/bin
$ ./stop-ds --restart</pre></div></li><li class="step"><p>
     Workaround for <code class="literal">OPENIDM-1523</code>:
    </p><p>
     Edit the plugin config with a subjectDN that matches the generated OpenIDM
     certificate.
    </p><div class="screen"><pre>$ cd /path/to/OpenDJ/config</pre></div><p>
     Edit <code class="filename">openidm-pwsync-plugin-config.ldif</code>, changing the
     value of <code class="literal">ds-certificate-subject-dn</code> to
     <code class="literal">C=None, L=None, O=OpenIDM Self-Signed Certificate, OU=None,
      CN=localhost</code>.
    </p></li><li class="step"><p>
     Add the plugin configuration to OpenDJ's configuration.
    </p><div class="screen"><pre>$ ./ldapmodify
 --port 1389
 --hostname `hostname`
 --bindDN "cn=Directory Manager"
 --bindPassword "password"
 --defaultAdd
 --filename ../config/openidm-pwsync-plugin-config.ldif
Processing ADD request for cn=OpenIDM Notification Handler,
        cn=Account Status Notification Handlers,cn=config
ADD operation successful for DN cn=OpenIDM Notification Handler,
        cn=Account Status Notification Handlers,cn=config
</pre></div></li><li class="step"><p>
     Restart OpenDJ.
    </p><div class="screen"><pre>$ ./stop-ds --restart
...
[20/Nov/2013:08:55:47 +0100] category=EXTENSIONS severity=INFORMATION
 msgID=1049147 msg=Loaded extension from file '/path/to/OpenDJ/lib/extensions
 /opendj-accountchange-handler-1.0.0.jar' (build &lt;unknown&gt;,
 revision &lt;unknown&gt;)
...
[20/Nov/2013:08:55:51 +0100] category=CORE severity=NOTICE msgID=458891
 msg=The Directory Server has sent an alert notification generated by class
 org.opends.server.core.DirectoryServer (alert type
 org.opends.server.DirectoryServerStarted, alert ID 458887):
 The Directory Server has started successfully</pre></div></li><li class="step"><p>
     Enable the plugin for the appropriate password policy.
    </p><p>
     The following command enables the plugin for the default password policy.
    </p><div class="screen"><pre><strong>$ ./dsconfig \
 set-password-policy-prop \
 --port 4444 \
 --hostname `hostname` \
 --bindDN "cn=Directory Manager" \
 --bindPassword password \
 --policy-name "Default Password Policy" \
 --set account-status-notification-handler:"OpenIDM Notification Handler" \
 --trustStorePath ../config/admin-truststore \
 --no-prompt</strong></pre></div></li><li class="step"><p>
     
     If the <code class="literal">password</code> attribute does not exist in the
     <code class="literal">managed/user</code> object on OpenIDM, the password sync
     service will return an error when the password is updated in OpenDJ. To
     prevent this, add the following <code class="literal">onCreate</code> script to the
     OpenDJ &gt; Managed Users mapping in the <code class="filename">sync.json</code>
     file:
    </p><pre class="brush: javascript;">
"mappings" : [
 {
  "name" : "systemLdapAccounts_managedUser",
  "source" : "system/ldap/account",
  "target" : "managed/user",
  "properties" : [
   {
    "source" : "uid",
    "target" : "userName"
   }
  ],
  "onCreate" : {
   "type" : "text/javascript",
   "source" : "target.password=''"
  },
...
    </pre><p>
     The onCreate script creates an empty password in the
     <code class="literal">managed/user</code> object, so that the attribute exists and
     can be patched.
    </p></li></ol></div><div class="procedure"><a name="install-ad-password-sync-plugin"></a><div class="procedure-title">Procedure&nbsp;13.3.&nbsp;To Install the Active Directory Password Synchronization Plugin</div><a class="indexterm" name="d505e12281"></a><p>
    Use the Active Directory password synchronization plugin to synchronize
    passwords between OpenIDM and Active Directory (on systems running at least
    Microsoft Windows Server 2008 R2).
   </p><p>
    Install the plugin on Active Directory primary domain controllers (PDCs) to
    intercept password changes, and send the password values to OpenIDM over an
    encrypted channel. You must have Administrator privileges to install the
    plugin. In a clustered Active Directory environment, you must install the
    plugin on all PDCs.
   </p><ol class="procedure" type="1"><li class="step"><p>
     Download the Active Directory password synchronization plugin,
     OpenIDM Agents-AD, from the OpenIDM download page under the ForgeRock
     <a class="link" href="http://forgerock.com/download-stack/" target="_blank">Open Stack download page</a>.
    </p></li><li class="step"><p>
     Double-click the setup file (<code class="filename">setup.exe</code>) to launch the
     installation wizard.
    </p></li><li class="step"><p>
     Provide the following information during the installation. You must accept
     the Common Development and Distribution License (CDDL) license agreement to
     proceed with the installation.
    </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">OpenIDM Connection information</span></dt><dd><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <span class="emphasis"><em>OpenIDM URL.</em></span> Enter the URL where OpenIDM is
          deployed, including the query that targets each user account. For
          example:
         </p><div class="screen"><pre>http://localhost:8080/openidm/managed/user?_action=patch&amp;_queryId=for-userName&amp;uid=${samaccountname}
         </pre></div><p>
          For mutual authentication, the default URL is
         </p><div class="screen"><pre>https://localhost:8444/openidm/managed/user?_action=patch&amp;_queryId=for-userName&amp;uid=${samaccountname}
         </pre></div><p>
         </p><p>
          For this query to work, you must set a mapping from
          <code class="literal">samaccountname</code> to <code class="literal">username</code> in
          the <code class="filename">/path/to/openidm/conf/sync.json</code> file, for
          example:
         </p><pre class="brush: javascript;">{
    "mappings" : [
        {
            "name" : "systemADAccounts_managedUser",
            "source" : "system/ad/account",
            "target" : "managed/user",
            "properties" : [
                ...
                {
                    "source" : "samaccountname",
                    "target" : "userName"
                },
                ...
          }
    ]
}        </pre></li><li class="listitem"><p>
          <span class="emphasis"><em>OpenIDM User Password attribute.</em></span> The password
          attribute for the <code class="literal">managed/user</code> object, for example
          <code class="literal">password</code>.
         </p><p>
          If the <code class="literal">password</code> attribute does not exist in the
          <code class="literal">managed/user</code> object, the password sync service will
          return an error when the password is updated in Active Directory. To
          prevent this, add the following script to the Active Directory &gt;
          Managed Users mapping in the <code class="filename">sync.json</code> file:
         </p><pre class="brush: javascript;">"onCreate" : {
    "type" : "text/javascript",
    "source" : "target.password=''; target.adPassword='';"
},       </pre><p>
          The onCreate script creates an empty password in the
          <code class="literal">managed/user</code> object, so that the attribute exists
          and can be patched.
         </p></li></ul></div></dd><dt><span class="term">OpenIDM Authentication Parameters</span></dt><dd><p>
        Provide the following information:
       </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <span class="emphasis"><em>User name.</em></span> Enter the user name that is used to
          authenticate to OpenIDM, for example, <code class="literal">openidm-admin</code>.
         </p></li><li class="listitem"><p>
          <span class="emphasis"><em>Password.</em></span> Enter the password of the user that
          authenticates to OpenIDM, for example, <code class="literal">openidm-admin</code>.
         </p></li><li class="listitem"><p>
         <span class="emphasis"><em>Select authentication type.</em></span> Select the type of
         authentication that Active Directory will use to authenticate to
         OpenIDM.
        </p><p>
         For plain HTTP authentication, select <code class="literal">OpenIDM Header</code>.
         For mutual authentication, select <code class="literal">Certificate</code>.
        </p></li></ul></div></dd><dt><span class="term">Certificate authentication settings</span></dt><dd><p>If you selected <code class="literal">Certificate</code> as the authentication
       type on the previous screen, specify the details of the certificate that
       will be used for authentication.
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
         <span class="emphasis"><em>Select Certificate file.</em></span> Browse to select the
         certificate file that Active Directory will use to authenticate to
         OpenIDM. The certificate file must be in PKCS12 format.
        </p><p>
         For production purposes, you should use a certificate that has been
         issued by a Certificate Authority. For testing purposes, you can
         generate a self-signed certificate. Whichever certificate you use, the
         certificate must be imported into OpenIDM's trust store.
        </p><p>
         To generate a self-signed certificate for Active Directory, follow
         these steps:
        </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
           On the Active Directory host, generate a self-signed certificate with
           the alias <code class="literal">ad-pwd-plugin-localhost</code>.
          </p><div class="screen"><pre>&gt; keytool
 -genkey
 -alias ad-pwd-plugin-localhost
 -keyalg rsa
 -dname "CN=localhost, O=AD-pwd-plugin Self-Signed Certificate"
 -keystore keystore.jceks
 -storetype JCEKS
Enter keystore password: <em><strong>changeit</strong></em>
Re-enter new password: changeit
Enter key password for &lt;ad-pwd-plugin-localhost&gt;
      &lt;RETURN if same as keystore password&gt;
          </pre></div></li><li class="step"><p>
           Self-sign the certificate.
          </p><div class="screen"><pre>&gt; keytool
 -selfcert
 -alias ad-pwd-plugin-localhost
 -validity 365
 -keystore keystore.jceks
 -storetype JCEKS
 -storepass changeit
          </pre></div></li><li class="step"><p>
           Export the certificate as a PKCS12 certificate.
          </p><div class="screen"><pre>&gt; keytool
 -importkeystore
 -srckeystore keystore.jceks
 -srcstoretype jceks
 -srcstorepass changeit
 -srckeypass changeit
 -srcalias ad-pwd-plugin-localhost
 -destkeystore ad-pwd-plugin-localhost.p12
 -deststoretype PKCS12
 -deststorepass changeit
 -destkeypass changeit
 -destalias ad-pwd-plugin-localhost
 -noprompt
          </pre></div><p>
           This command generates a PKCS12 certificate file, named
           <code class="filename">ad-pwd-plugin-localhost.p12</code>. Copy this
           certificate file to the machine that hosts OpenIDM, and import the
           certificate into the OpenIDM truststore.
          </p><div class="screen"><pre>$ keytool
 -importkeystore
 -srckeystore /path/to/ad-pwd-plugin-localhost.p12
 -srcstoretype PKCS12
 -destkeystore truststore
 -deststoretype JKS
          </pre></div></li></ol></div></li><li class="listitem"><p>
         <span class="emphasis"><em>Password to open certificate file.</em></span> Specify the
         keystore password (<code class="literal">changeit</code>, in the previous
         example).</p></li></ul></div></dd><dt><span class="term">Password Encryption settings</span></dt><dd><p>
        Provide the details of the certificate that will be used to encrypt
        password values.
       </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <span class="emphasis"><em>Certificate file.</em></span> Browse to select the
          certificate file that will be used for password encryption. The
          certificate file must be in PKCS12 format.
         </p><p>For evaluation purposes, you can use a self-signed certificate,
          as described in the previous step. For production purposes, you should
          use a certificate that has been issued by a Certificate Authority.
         </p><p>
          Whichever certificate you use, the certificate must be imported into
          OpenIDM's keystore, so that OpenIDM can locate the key with which to
          decrypt the data. To import the certificate into OpenIDM's keystore,
          run the following command on the OpenIDM host:
         </p><div class="screen"><pre>
$ keytool
 -importkeystore
 -srckeystore /path/to/ad-pwd-plugin-localhost.p12
 -srcstoretype PKCS12
 -destkeystore /path/to/openidm/security/keystore.jceks
 -deststoretype jceks
         </pre></div></li><li class="listitem"><p>
          <span class="emphasis"><em>Private key alias.</em></span> Specify the certificate alias
          for the certificate, such as <code class="literal">ad-pwd-plugin-localhost</code>,
          from the previous self-signed certificate example.
         </p></li><li class="listitem"><p>
          <span class="emphasis"><em>Password to open certificate file.</em></span> Specify the
          password to access the PFX keystore file, such as
          <code class="literal">changeit</code>, from the previous example.
         </p></li><li class="listitem"><p>
          <span class="emphasis"><em>Select encryption key type.</em></span> Specify the
          encryption key type that will be used when encrypting the password
          value (AES-128, AES-192, or AES-256).
         </p></li></ul></div></dd><dt><span class="term">Data storage</span></dt><dd><p>
        Provide the details for the storage of encrypted passwords in the event
        that OpenIDM is not available when a password modification is made.
       </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Select a secure directory in which the JSON files that contain
          encrypted passwords are queued. The server should prevent access to
          this folder, except access by the <code class="literal">Password Sync
          service</code>. The path name cannot include spaces.
         </p></li><li class="listitem"><p>
          <span class="emphasis"><em>Directory poll interval (seconds).</em></span> Enter the
          number of seconds between calls to check whether OpenIDM is available,
          for example, <code class="literal">60</code>, to poll OpenIDM every minute.
         </p></li></ul></div></dd><dt><span class="term">Log storage</span></dt><dd><p>
        Provide the details of the messages that should be logged by the plugin.
       </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          Select the location to which messages should be logged. The path name
          cannot include spaces.
         </p></li><li class="listitem"><p><span class="emphasis"><em>Select logging level.</em></span> Select the severity of
          messages that should be logged, either <code class="literal">error</code>,
          <code class="literal">info</code>, <code class="literal">warning</code>,
          <code class="literal">fatal</code>, or <code class="literal">debug</code>.
         </p></li></ul></div></dd><dt><span class="term">Select Destination Location</span></dt><dd><p>
        Setup installs the plugin in the location you select, by default
        <code class="filename">C:\Program Files\OpenIDM Password Sync</code>.
       </p></dd></dl></div></li><li class="step"><p>
     After running the installation wizard, restart the computer.
    </p></li><li class="step"><p>
     If you need to change any settings after installation, access the
     settings using the Registry Editor under HKEY_LOCAL_MACHINE &gt; SOFTWARE
     &gt; ForgeRock &gt; OpenIDM &gt; PasswordSync.</p></li><li class="step"><p>
     If you selected to authenticate over plain HTTP in the previous step, your
     setup is now complete.
    </p><p>
     If you selected to authenticate with mutual authentication, complete this
     step.
    </p><ol type="a" class="substeps"><li class="step"><p>
       The Password Sync Service uses Windows certificate stores to verify
       OpenIDM's identity. The certificate that OpenIDM uses must therefore
       be added to the list of trusted certificates on the Windows machine.
      </p><p>
       For production purposes, you should use a certificate that has been
       issued by a certificate authority. For test purposes, you can use the
       self-signed certificate that is generated by OpenIDM on first startup.
      </p><p>
       To add the OpenIDM certificate to the list of trusted certificates, use
       the Microsoft Management Console.
      </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
         Select Start and type <code class="literal">mmc</code> in the Search field.
        </p></li><li class="listitem"><p>
         In the Console window, select File &gt; Add/Remove Snap-in.
        </p></li><li class="listitem"><p>
         From the left hand column, select Certificates and click Add.
        </p></li><li class="listitem"><p>
         Select My user account, and click Finish.
        </p></li><li class="listitem"><p>
         Repeat the previous two steps for Service account and Computer account.
        </p><p>
         For Service account, select Local computer, then select OpenIDM
         Password Sync Service.
        </p><div class="mediaobject" align="center"><a name="password-sync-service"></a><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/service-acct.png" align="middle" height="360" alt="OpenIDM architecture"></td></tr></table></div><p>
         For Computer account, select Local computer.
        </p></li><li class="listitem"><p>
         Click Finish when you have added the three certificate snap-ins.
        </p></li><li class="listitem"><p>
         Still in the mmc Console, expand Certificates - Current User &gt;
         Personal and select Certificates.
        </p></li><li class="listitem"><p>
         Select Action &gt; All Tasks &gt; Import to open the Certificate Import
         Wizard.
        </p></li><li class="listitem"><p>
         Browse for the OpenIDM certificate (<code class="literal">openidm-localhost</code>
         by default, if you use OpenIDM's self-signed certificate).
        </p></li><li class="listitem"><p>
         Enter the Password for the certificate (<code class="literal">changeit</code> by
         default, if you use OpenIDM's self-signed certificate).
        </p></li><li class="listitem"><p>
         Accept the default for the Certificate Store.
        </p></li><li class="listitem"><p>
         Click Finish to complete the import.
        </p></li><li class="listitem"><p>
         Repeat the previous five steps to import the certificate for:
        </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
          <code class="literal">Current User &gt; Trusted Root Certification
           Authorities</code>
         </td></tr><tr><td>
          <code class="literal">Service &gt; OpenIDM Password Sync\Personal</code>
         </td></tr><tr><td>
          <code class="literal">Service &gt; OpenIDM Password Sync\Trusted Root Certification
           Authorities</code>
         </td></tr><tr><td>
          <code class="literal">Local Computer &gt; Personal</code>
         </td></tr><tr><td>
          <code class="literal">Local Computer &gt; Trusted Root Certification
           Authorities</code>
         </td></tr></table></li></ol></div></li></ol></li></ol></div><div class="procedure"><a name="setup-openidm-for-password-sync"></a><div class="procedure-title">Procedure&nbsp;13.4.&nbsp;To Set Up OpenIDM to Handle Password Changes</div><p>
    Follow these steps to configure OpenIDM to access password changes from
    OpenDJ and Active Directory.</p><ol class="procedure" type="1"><li class="step"><p>
     You must add the OpenDJ/Active Directory server certificates that you have
     used to OpenIDM's trust store so that OpenIDM knows to trust OpenDJ/Active
     Directory during mutual authentication.
    </p><p>
     Use the Java <span class="command"><strong>keytool</strong></span> command to import the certificate
     into the OpenIDM trust store.
    </p></li><li class="step"><p>
     Add the configuration to managed objects to handle password
     synchronization.
    </p><p>
     An example for synchronization with both OpenDJ and Active Directory is
     provided in the <code class="filename">samples/misc/managed.json</code> file,
     JavaScript lines folded for readability:</p><pre class="brush: javascript;">
{
    "objects": [
        {
            "name": "user",
            "properties": [
                {
                    "name": "ldapPassword",
                    "encryption": {
                        "key": "openidm-sym-default"
                    }
                },
                {
                    "name": "adPassword",
                    "encryption": {
                        "key": "openidm-sym-default"
                    }
                },
                {
                    "name": "password",
                    "encryption": {
                        "key": "openidm-sym-default"
                    }
                }
            ],
            "onUpdate": {
                "type": "text/javascript",
                "source":
                 "if (newObject.ldapPassword != oldObject.ldapPassword) {
                     newObject.password = newObject.ldapPassword
                  } else if (newObject.adPassword != oldObject.adPassword) {
                      newObject.password = newObject.adPassword
                  }"
            }
        }
    ]
}</pre><p>This sample assumes you define the password as
    <code class="literal">ldapPassword</code> for OpenDJ, and
    <code class="literal">adPassword</code> for Active Directory.</p></li><li class="step"><p>
     Update the connector configuration files to add the password property to
     the <code class="literal">account</code> object type.
    </p><p>
     For OpenDJ, update <code class="filename">provisioner.openicf-ldap.json</code>, as
     follows:
    </p><pre class="brush: javascript;">
   "objectTypes" :
      {
         "account" :
            {
               "$schema" : "http://json-schema.org/draft-03/schema",
               "id" : "__ACCOUNT__",
               "type" : "object",
               "nativeType" : "__ACCOUNT__",
               "properties" :
                  {
                     "cn" :
                        {
                           "type" : "string",
                           "nativeName" : "cn",
                           "nativeType" : "string"
                        },
                      ...
                     "ldapPassword" :
                        {
                           "type" : "string",
                           "nativeName" : "userpassword",
                           "nativeType" : "string"
                        },
     ...
    </pre><p>
     For Active Directory, update
     <code class="filename">provisioner.openicf-ad.json</code>, as follows:
    </p><pre class="brush: javascript;">
   "objectTypes" :
      {
         "account" :
            {
               "$schema" : "http://json-schema.org/draft-03/schema",
               "id" : "__ACCOUNT__",
               "type" : "object",
               "nativeType" : "__ACCOUNT__",
               "properties" :
                  {
                     "cn" :
                        {
                           "type" : "string",
                           "nativeName" : "cn",
                           "nativeType" : "string"
                        },
                      ...
                     "adPassword" :
                        {
                           "type" : "string",
                           "nativeName" : "_PASSWORD_",
                           "nativeType" : "JAVA_TYPE_GUARDEDSTRING"
                        },
     ...
    </pre></li><li class="step"><p>When you change a password in OpenDJ, you will notice that the value 
    changes in OpenIDM.</p><div class="screen"><pre>$ tail -f openidm/audit/activity.csv | grep bjensen
...userName=bjensen, ... password={$crypto={...data=tEsy7ZXo6nZtEqzW/uVE/A==...
...userName=bjensen, ... password={$crypto={...data=BReT79lnQEPcvfQG3ibLpg==...</pre></div><p>
     Be aware that the plugin is patching the password value of the
    managed user in OpenIDM. The target <code class="literal">password</code> property 
    must exist for the patch to work.
    </p><p>
     To configure automatic synchronization, that is the password is updated in
     Active Directory automatically when it is changed in OpenIDM, you must
     complete the following three steps:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
       Define a mapping from <code class="literal">managed/user</code> to
       <code class="literal">system/ad/account</code> in your
       <code class="filename">/path/to/openidm/conf/sync.json</code> file.
      </p></li><li class="listitem"><p>
       Specify the <code class="literal">{"source" : "password", "target" : "adPassword"}</code>
       property as part of this mapping.
      </p></li><li class="listitem"><p>
       Make sure that automatic synchronization is enabled for that mapping. By
       default, all mappings participate in automatic synchronization operations
       so you should not have to enable this operation manually unless you have
       specifically set the <code class="literal">"enableSync"</code> property of the
       mapping to <code class="literal">false</code>.
      </p></li></ul></div></li></ol></div></div></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-auth"></a>Chapter&nbsp;14.&nbsp;Managing Authentication, Authorization and Role-Based Access Control</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="section"><a href="#openidm-users">14.1. OpenIDM Users</a></span></dt><dt><span class="section"><a href="#openidm-authentication">14.2. Authentication</a></span></dt><dt><span class="section"><a href="#passthrough-auth">14.3. Using Delegated Authentication</a></span></dt><dt><span class="section"><a href="#supported-auth-modules">14.4. Supported Authentication Modules</a></span></dt><dt><span class="section"><a href="#openidm-roles">14.5. Roles and Authentication</a></span></dt><dt><span class="section"><a href="#openidm-authorization">14.6. Authorization</a></span></dt><dt><span class="section"><a href="#user-group-role-auth-assignment">14.7. Building Role-Based Access Control (RBAC)</a></span></dt></dl></div><a class="indexterm" name="d505e12769"></a><a class="indexterm" name="d505e12772"></a><p>
  OpenIDM provides a flexible authentication and authorization mechanism, based
  on REST interface URLs and on roles which may be stored in the repository.
 </p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="openidm-users"></a>14.1.&nbsp;OpenIDM Users</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#internal-users">14.1.1. Internal Users</a></span></dt><dt><span class="section"><a href="#managed-users">14.1.2. Managed Users</a></span></dt></dl></div><a class="indexterm" name="d505e12780"></a><a class="indexterm" name="d505e12785"></a><p>
   While OpenIDM authenticates internal and managed users with the
   <code class="literal">DELEGATED</code> module, there are differences between these
   two types of users.
  </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="internal-users"></a>14.1.1.&nbsp;Internal Users</h3></div></div></div><p>
    OpenIDM creates two internal users by default: <code class="literal">anonymous</code>
    and <code class="literal">openidm-admin</code>. These accounts are separated from
    other user accounts to protect them from any reconciliation or
    synchronization processes.
   </p><p>
    OpenIDM stores internal users and their role membership in a table in the
    repository. For the way internal users are mapped, see the discussion on
    the <code class="literal">explicitMapping</code> property to
    <code class="literal">"internal/user</code> described in <span class="olink"><em class="citetitle">Using Explicit
    Mappings</em></span>.
   </p><p>
    For more information on storage mechanisms for managed users in OrientDB
    and JDBC, see <a href="../integrators-guide/index.html#working-with-managed-users" class="link">
    <em class="citetitle">Working With Managed Users</em></a>.
   </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">anonymous</span></dt><dd><p>
       This user enables anonymous access to OpenIDM, for users who do not have
       their own accounts. The anonymous user, configured by default with the
       <code class="literal">openidm-reg</code> role, has limited rights within OpenIDM.
       It can be used to allow self-registration. For more information on the
       process, see <a href="../integrators-guide/index.html#ui-self-registration" class="link">
       <em class="citetitle">Enabling Self-Registration</em></a>.
      </p></dd><dt><span class="term">openidm-admin</span></dt><dd><p>
       This user serves as the top-level administrator. After installation, the
       <code class="literal">openidm-admin</code> user has full access, and provides a
       fallback mechanism in case other users are locked out. Do not use
       <code class="literal">openidm-admin</code> for regular tasks. Under normal
       circumstances, the <code class="literal">openidm-admin</code> account does not
       represent a regular user, so any audit log records for this account do
       not represent the actions of any real person.
      </p><p>
       OpenIDM encrypts the default administrative password,
       <code class="literal">openidm-admin</code>. Change the password immediately after
       installation. For instructions, see
       <a href="../integrators-guide/index.html#security-replace-default-user-password" class="link">
       <em class="citetitle">To Replace the Default User and Password</em></a>.
      </p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="managed-users"></a>14.1.2.&nbsp;Managed Users</h3></div></div></div><a class="indexterm" name="d505e12868"></a><p>
    External users managed by OpenIDM are known as managed users.
   </p><p>
    The location of managed users depends on the type of repository. For
    JDBC repositories, OpenIDM stores managed users in the managed objects
    table, named <code class="literal">managedobjects</code>. OpenIDM may access an index
    table <code class="literal">managedobjectproperties</code> as well.
   </p><p>
    For the OrientDB repository, managed objects are stored in the table
    <code class="literal">managed_user</code>.
   </p><p>
    By default, the attribute names for managed user login and password are
    <code class="literal">userName</code> and <code class="literal">password</code>, respectively.
   </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="openidm-authentication"></a>14.2.&nbsp;Authentication</h2></div></div></div><p>
   OpenIDM does not allow access to the REST interface without authentication.
  </p><p>
   User self-registration requires anonymous access. For that purpose, OpenIDM
   includes an <code class="literal">anonymous</code> user, with the following password:
   <code class="literal">anonymous</code>. For more information, see
   <a class="xref" href="#internal-users" title="14.1.1.&nbsp;Internal Users">Section&nbsp;14.1.1, &#8220;Internal Users&#8221;</a>.
  </p><p>
   In production, only applications are expected to access the REST interface.
  </p><div class="variablelist"><p>
    OpenIDM supports an improved authentication mechanism on the REST
    interface. Unlike basic authentication or form-based authentication, the
    OpenIDM authentication mechanism is compatible with the AJAX framework. You
    can configure authentication with standard or OpenIDM-specific header
    fields, as follows:
   </p><dl class="variablelist"><dt><span class="term">OpenIDM authentication with standard header fields</span></dt><dd><div class="screen"><pre>$ curl --user userName:password</pre></div><p>
      This method uses standard basic authentication. However, it does not
      prompt for missing credentials.
     </p></dd><dt><span class="term">OpenIDM authentication with OpenIDM header fields</span></dt><dd><div class="screen"><pre>$ curl
 --header "X-OpenIDM-Username: openidm-admin"
 --header "X-OpenIDM-Password: openidm-admin"</pre></div></dd></dl></div><div class="note"><h3 class="title">Note</h3><p>
    This document uses the OpenIDM authentication options for all REST calls.
    Where no OpenIDM-specific options exist, the "long-form" option such as
    <span class="command"><strong>--data</strong></span> is used. In contrast, the README files that
    accompany OpenIDM generally use "short-form" options such as
    <span class="command"><strong>-X</strong></span> (instead of <span class="command"><strong>--request</strong></span>) and
    <span class="command"><strong>-H</strong></span> (instead of <span class="command"><strong>--header</strong></span>).
   </p></div><p>For more information about the OpenIDM authentication mechanism, see
   <a href="../integrators-guide/index.html#security-messages" class="link">
   <em class="citetitle">Use Message Level Security</em></a>.</p><p>
   You can change the attributes used by OpenIDM to store user login and
   password values. Attribute names are shown in a database query listed in
   <code class="filename">openidm/conf/repo.<em class="replaceable"><code>repo-type</code></em>.json</code>.
  </p><div class="variablelist"><p>Two queries are defined by default.</p><dl class="variablelist"><dt><span class="term"><code class="literal">credential-internaluser-query</code></span></dt><dd><p>Uses the <code class="literal">_openidm_id</code> attribute for login</p></dd><dt><span class="term"><code class="literal">credential-query</code></span></dt><dd><p>Uses the <code class="literal">userName</code> attribute for login</p></dd></dl></div><p>
   The <code class="filename">openidm/conf/authentication.json</code> file defines
   the active query with the <code class="literal">queryId</code> property. In the
   following example, <code class="literal">credential-query</code> is the
   <code class="literal">queryId</code> identifier used in a <code class="literal">queryRequest</code>
   to validate credentials.
  </p><pre class="brush: javascript;">
{
    "queryId" : "credential-query",
    "queryOnResource" : "managed/user",
...
}</pre><p>
  You can explicitly define the properties that constitute passwords or roles
  with the <code class="literal">propertyMapping</code> object in the
  <code class="filename">conf/authentication.json</code> file. The default property
  mapping is shown here:
 </p><pre class="brush: javascript;">
 ...
    "propertyMapping" : {
        "authenticationId" : "username",
        "userCredential" : "password",
        "userRoles" : "roles"
    },
 ... 
 </pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="passthrough-auth"></a>14.3.&nbsp;Using Delegated Authentication</h2></div></div></div><p>
   In addition to the internal and managed user authentication modules, OpenIDM
   3.0.0 supports a delegated authentication mechanism.
   With delegated authentication, the username and password included with the
   REST request are validated against those stored in a remote system, such as
   an LDAP server.
  </p><p>
   Delegated authentication for OpenIDM 3.0.0 includes the
   functionality associated with the <code class="literal">PASSTHROUGH</code>,
   <code class="literal">MANAGED_USER</code>, and <code class="literal">INTERNAL_USER</code>
   modules. OpenIDM 3.0.0 includes those modules as aliases
   for the <code class="literal">DELEGATED</code> module.
  </p><p>
   The samples listed in the <a href="../install-guide/index.html#chap-samples" class="link"><em class="citetitle">OpenIDM
   Installation Guide</em></a> include multiple options for
   authentication mechanisms.
  </p><p>
   You can add the delegated authentication module to the
   <code class="filename">conf/authentication.json</code> file. For example, the
   following excerpt illustrates one way to implement the
   <code class="literal">DELEGATED</code> configuration object. For descriptive purposes,
   you can substitute the <code class="literal">PASSTHROUGH</code> alias for
   <code class="literal">DELEGATED</code>.
  </p><pre class="brush: javascript;">
"authModules" : [
   {
      "name" : "DELEGATED",
      "properties" : {
         "augmentSecurityContext": {
            "type" : "text/javascript",
            "file" : "auth/populateAsManagedUser.js"
         },
         "queryOnResource" : "system/ldap/account",
         "propertyMapping" : {
            "authenticationId" : "uid",
            "groupMembership" : "memberOf"
         },
         "groupRoleMapping" : {
            "openidm-admin" : ["cn=admins"]
         },
         "managedUserLink" : "systemLdapAccounts_managedUser",
         "defaultUserRoles" : [
            "openidm-authorized"
         ]
      },
      "enabled" : true
   },
   ...
]
  </pre><p>
   The properties shown from this excerpt are defined in
   <a class="xref" href="#roles-auth-prop" title="14.6.3.&nbsp;Properties for Authentication and Roles">Section&nbsp;14.6.3, &#8220;Properties for Authentication and Roles&#8221;</a>
  </p><p>
   The content of the delegated authentication object varies. Samples
   2/2b/2c/2d, 3, 5, and 6 include slightly different versions of the
   <code class="filename">conf/authentication.json</code> file.
  </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Samples 2, 2b, 2c, 2d (LDAP)</span></dt><dd><p>
      Samples 2, 2b, 2c, and 2d relate to connections from an LDAP server.
      Samples 5 and 5b  are quite similar, as they uses XML information to
      masquerade as an LDAP server. The <code class="filename">authentication.json</code>
      file is identical in each of these samples.
     </p><p>
      In the common <code class="filename">authentication.json</code> file, the
      <code class="literal">queryOnResource</code> endpoint is
      <code class="literal">system/ldap/account</code>. The
      <code class="literal">managedUserLink</code> is
      <code class="literal">systemLdapAccounts_managedUser</code>.
     </p></dd><dt><span class="term">Sample 3 (Scripted SQL)</span></dt><dd><p>
      Sample 3 relates to a connection to a scripted SQL database. As such, the
      <code class="literal">queryOnResource</code> endpoint is
      <code class="literal">system/scriptedsql/account</code>. The
      <code class="literal">managedUserLink</code> is
      <code class="literal">systemHrdb_managedUser</code>.
     </p></dd><dt><span class="term">Sample 5, 5b (Synchronization of two resources)</span></dt><dd><p>
      The XML files used in samples 5 and 5b simulate a connection between LDAP
      servers. For that reason, the <code class="filename">conf/authentication.json</code>
      file used in these samples are identical to that for sample 2/2b/2c/2d.
     </p></dd><dt><span class="term">Sample 6 (LiveSync)</span></dt><dd><p>
      The <code class="literal">queryOnResource</code> endpoint is
      <code class="literal">system/ad/account</code>. The <code class="literal">autheticationId</code>
      matches the AD attribute used for account names. The associated
      <code class="literal">managedUserLink</code> is
      <code class="literal">systemAdAccounts_managedUser</code>.
     </p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="supported-auth-modules"></a>14.4.&nbsp;Supported Authentication Modules</h2></div></div></div><div class="variablelist"><p>
    OpenIDM supports a variety of modules, including those available from the
    Common Authentication Framework. OpenIDM also provides
    two additional authentication modules, <code class="literal">DELEGATED</code> and
    <code class="literal">CLIENT_CERT</code>.
   </p><dl class="variablelist"><dt><span class="term">JWT_SESSION</span></dt><dd><p>
      The JSON Web Token session authentication module. For more information
      on this common authentication module, see the <a class="link" href="http://commons.forgerock.org/forgerock-auth-filters/forgerock-authn-filter/forgerock-jaspi-modules/forgerock-jaspi-jwt-session-module/apidocs/org/forgerock/jaspi/modules/session/jwt/JwtSessionModule.html" target="_blank">
      <em class="citetitle">Class JwtSessionModule</em></a> Javadoc.
     </p></dd><dt><span class="term">CLIENT_CERT</span></dt><dd><p>
      Module for users who authenticate with a client certificate.
     </p></dd><dt><span class="term">DELEGATED</span></dt><dd><p>
      Module that validates client requests by passing through to an OpenICF
      connector. For OpenIDM 3.0.0, this is an alias for
      <code class="literal">MANAGED_USER</code>, <code class="literal">INTERNAL_USER</code>, and
      <code class="literal">PASSTHROUGH</code>.
     </p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="openidm-roles"></a>14.5.&nbsp;Roles and Authentication</h2></div></div></div><a class="indexterm" name="d505e13187"></a><a class="indexterm" name="d505e13192"></a><p>
   OpenIDM includes a number of default roles, and supports the configuration of
   managed roles, enabling you to customize the roles mechanism as needed.
  </p><div class="variablelist"><p>The following roles are configured by default:</p><dl class="variablelist"><dt><span class="term">openidm-reg</span></dt><dd><p>
      Role assigned to users who access OpenIDM with the default anonymous
      account.
     </p><p>
      The <code class="literal">openidm-reg</code> role is excluded from the
      reauthorization required policy definition by default.
     </p></dd><dt><span class="term">openidm-admin</span></dt><dd><p>
      OpenIDM administrator role, excluded from the reauthorization required
      policy definition by default.
     </p></dd><dt><span class="term">openidm-authorized</span></dt><dd><p>
      Default role for any user who has authenticated with a user name and
      password.
     </p></dd><dt><span class="term">openidm-cert</span></dt><dd><p>
      Default role for any user authenticated with mutual SSL authentication.
     </p><p>
      This role applies only for mutual authentication. Furthermore,
      the shared secret (certificate) must be adequately protected. The
      <code class="literal">openidm-cert</code> role is excluded from the reauthorization
      required policy definition by default.
     </p></dd></dl></div><p>
   OpenIDM begins the process of assigning the roles of a user with the
   <code class="literal">roles</code> property. OpenIDM then proceeds in the
   following sequence to define user roles:
  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
     If the <code class="literal">defaultRoles</code> property is set, OpenIDM assigns
     those roles to the given user. The <code class="literal">defaultRoles</code> property
     must be configured in an array.
    </p></li><li class="listitem"><p>
     The <code class="literal">userRoles</code> property is a string that defines the
     attribute. The value of the attribute may be either a comma-delimited
     string or a list of strings. You can identify the list with a REST call to
     a <code class="literal">queryOnResource</code> endpoint such as
     <code class="literal">system/ldap/account</code>
    </p></li><li class="listitem"><p>
     If the <code class="literal">groupRoleMapping</code> and
     <code class="literal">groupMembership</code> properties are defined, OpenIDM
     assigns additional roles to users depending on any existing group
     membership.
    </p></li></ul></div><p>
   The roles calculated in sequence are cumulative. In other words, if all of
   the above properties are defined, OpenIDM would assign roles from
   <code class="literal">defaultRoles</code> and <code class="literal">userRoles</code>. It would
   also use a <code class="literal">MappingRoleCalculator</code> to define roles from the
   <code class="literal">groupRoleMapping</code> and <code class="literal">groupMembership</code>
   properties.
  </p><p>
   For users who have authenticated with mutual SSL authentication, the module
   is <code class="literal">CLIENT_CERT</code> and the default role for such users is
   <code class="literal">openidm-cert</code>.
  </p><pre class="brush: javascript;">
{   "name" : "CLIENT_CERT",
    "properties" : {
        "queryOnResource": "managed/user",
        "defaultUserRoles": [  "openidm-cert" ],
        "allowedAuthenticationPatterns" : [ ]
    },
    "enabled" : "true"
}</pre><p>
    Access control for such users is configured in the
    <code class="filename">access.js</code> file. For more information, see
    <a class="xref" href="#openidm-authorization" title="14.6.&nbsp;Authorization">Section&nbsp;14.6, &#8220;Authorization&#8221;</a>.
   </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="openidm-authorization"></a>14.6.&nbsp;Authorization</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#router-authz-js">14.6.1. <code class="literal">router-authz.js</code></a></span></dt><dt><span class="section"><a href="#access-js">14.6.2. <code class="literal">access.js</code></a></span></dt><dt><span class="section"><a href="#roles-auth-prop">14.6.3. Properties for Authentication and Roles</a></span></dt><dt><span class="section"><a href="#authorization-extending">14.6.4. Extending the Authorization Mechanism</a></span></dt></dl></div><a class="indexterm" name="d505e13307"></a><p>
   OpenIDM provides role-based authorization that restricts direct HTTP access
   to REST interface URLs. The default authorization configuration grants
   different access rights to users that are assigned the roles
   <code class="literal">"openidm-admin"</code>, <code class="literal">"openidm-cert"</code>,
   <code class="literal">"openidm-authorized"</code>, and <code class="literal">"openidm-reg"</code>.
  </p><p>
   Note that this access control applies to direct HTTP calls only. Access for
   internal calls (for example, calls from scripts) is not affected by this
   mechanism.
  </p><div class="itemizedlist"><p>Authorization is configured in two script files:</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
       <code class="filename">openidm/bin/defaults/script/router-authz.js</code>
      </p></li><li class="listitem"><p><code class="filename">openidm/script/access.js</code></p></li></ul></div><p>
   OpenIDM calls these scripts for each request, via the
   <code class="literal">onRequest</code> hook that is defined in the default
   <code class="filename">router.json</code> file. The scripts either throw the string
   <code class="literal">Access denied</code>, or nothing. If
   <code class="literal">Access denied</code> is thrown, OpenIDM denies the request.
  </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="router-authz-js"></a>14.6.1.&nbsp;<code class="literal">router-authz.js</code></h3></div></div></div><p>
    This file provides the functions that enforce access rules. For example, the
    following function controls whether users with a certain role can start a
    specified process.
   </p><pre class="brush: javascript;">
...
function isAllowedToStartProcess() {
var processDefinitionId = request.content._processDefinitionId;
return isProcessOnUsersList(processDefinitionId);
}
...
   </pre><p>
    There are certain authorization-related functions in
    <code class="filename">router-authz.js</code> that should <span class="emphasis"><em>not</em></span> be
    altered, as described in a comment in the file.
   </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="access-js"></a>14.6.2.&nbsp;<code class="literal">access.js</code></h3></div></div></div><p>
    This file defines the access configuration for HTTP requests and
    references the methods defined in <code class="filename">router-authz.js</code>. Each 
    entry in the configuration contains a pattern to match against the incoming 
    request ID, and the associated roles, methods, and actions that are allowed 
    for requests on that pattern.
   </p><p>
    The options shown in the default version of the file do not include all of
    the actions available at each endpoint.
   </p><p>
    The following sample configuration entry indicates the configurable
    parameters and their purpose.
   </p><pre class="brush: javascript;">
        {  
            "pattern"   : "*",
            "roles"     : "openidm-admin",
            "methods"   : "*", // default to all methods allowed
            "actions"   : "*", // default to all actions allowed
            "customAuthz" : "disallowQueryExpression()",
            "excludePatterns": "system/*"
        },    
   </pre><p>
    As shown, this entry affects users with the <code class="literal">openidm-admin</code>
    role. Such users have HTTP access to all but <code class="literal">system</code>
    endpoints. The parameters are as follows:
   </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
      <code class="literal">"pattern"</code> - the REST endpoint to which access is being
      controlled. <code class="literal">"*"</code> indicates access to all endpoints.
      <code class="literal">"managed/user/*"</code> would indicate access to all managed
      user objects.
     </p></li><li class="listitem"><p>
      <code class="literal">"roles"</code> - a list of the roles to which this access
      configuration applies.
     </p></li><li class="listitem"><p>
      <code class="literal">"methods"</code> - a comma separated list of the methods to
      which access is being granted. The method can be one or more of
      <code class="literal">create, read, update, delete, patch, action, query</code>. A
      value of <code class="literal">"*"</code> indicates that all methods are allowed. A
      value of <code class="literal">""</code> indicates that no methods are allowed.
     </p></li><li class="listitem"><p>
      <code class="literal">"actions"</code> - a comma separated list of the allowed
      actions. The possible values depend on the service (URL) that is being
      exposed. The following list indicates the possible actions for each
      service.
     </p><table border="0" summary="Simple list" class="simplelist"><tr><td>
       <code class="literal">openidm/info/*</code> - <code class="literal">(no action parameter
       applies)</code>
      </td></tr><tr><td>
       <code class="literal">openidm/authentication</code> -
       <code class="literal">reauthenticate</code>
      </td></tr><tr><td>
       <code class="literal">openidm/config/ui/*</code> - <code class="literal">(no action
       parameter applies)</code>
      </td></tr><tr><td>
       <code class="literal">openidm/endpoint/securityQA</code> -
       <code class="literal">securityQuestionForUserName, checkSecurityAnswerForUserName,
       setNewPasswordForUserName
       </code>
      </td></tr><tr><td>
       <code class="literal">openidm/endpoint/getprocessforuser</code> -
       <code class="literal">create, complete</code>
      </td></tr><tr><td>
       <code class="literal">openidm/endpoint/gettaskview</code> -
       <code class="literal">create, complete</code>
      </td></tr><tr><td>
       <code class="literal">openidm/external/email</code> - <code class="literal">send</code>
      </td></tr><tr><td>
       <code class="literal">openidm/external/rest</code> - <code class="literal">(no action parameter
       applies)</code>
      </td></tr><tr><td>
       <code class="literal">openidm/managed</code> - <code class="literal">patch,
       triggerSyncCheck</code>
      </td></tr><tr><td>
       <code class="literal">openidm/managed/user</code> - <code class="literal">validateObject,
       validateProperty</code>
      </td></tr><tr><td>
       <code class="literal">openidm/policy</code> - <code class="literal">validateObject,
       validateProperty</code>
      </td></tr><tr><td>
       <code class="literal">openidm/recon</code> - <code class="literal">recon, reconByQuery,
       reconById, cancel</code>
      </td></tr><tr><td>
       <code class="literal">openidm/repo</code> - <code class="literal">updateDbCredentials</code>
      </td></tr><tr><td>
       <code class="literal">openidm/script/*</code> - <code class="literal">eval</code>
      </td></tr><tr><td>
       <code class="literal">openidm/security/keystore</code> -
       <code class="literal">generateCert, generateCSR</code>
      </td></tr><tr><td>
       <code class="literal">openidm/security/truststore</code> -
       <code class="literal">generateCert, generateCSR</code>
      </td></tr><tr><td>
       <code class="literal">openidm/sync</code> - <code class="literal">notifyCreate, notifyUpdate,
       notifyDelete, recon, performAction</code>
      </td></tr><tr><td>
       <code class="literal">openidm/system</code> - <code class="literal">test, testConfig,
       CREATECONFIGURATION, liveSync, authenticate</code>
      </td></tr><tr><td>
       <code class="literal">openidm/system/&lt;name&gt;</code> - <code class="literal">script,
       test, liveSync</code>
      </td></tr><tr><td>
       <code class="literal">openidm/system/&lt;name&gt;/{id}</code> -
       <code class="literal">authenticate, liveSync</code>
      </td></tr><tr><td>
       <code class="literal">openidm/taskscanner</code> - <code class="literal">execute,
       cancel</code>
      </td></tr><tr><td>
       <code class="literal">openidm/workflow/processdefinition</code> - <code class="literal">
       create, complete</code>
      </td></tr><tr><td>
       <code class="literal">openidm/workflow/processinstance</code> - <code class="literal">create,
       complete</code>
      </td></tr><tr><td>
       <code class="literal">openidm/workflow/taskinstance</code> -
       <code class="literal">claim, create, complete</code>
      </td></tr></table><p>
      A value of <code class="literal">"*"</code> indicates that all actions exposed for
      that service are allowed. A value of <code class="literal">""</code> indicates that
      no actions are allowed.
     </p></li><li class="listitem"><p>
      <code class="literal">"customAuthz"</code> - an optional parameter that enables you
      to specify a custom function for additional authorization checks. These
      functions are defined in <code class="filename">router-authz.js</code>.
     </p><p>
      The <code class="literal">allowedPropertiesForManagedUser</code> variable, declared
      at the beginning of the file, enables you to create a white list of
      attributes that users are able to modify on their own accounts.
     </p></li><li class="listitem"><p>
      <code class="literal">"excludePatterns"</code> - an optional parameter that enables
      you to specify particular endpoints to which access should not be given.
     </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="roles-auth-prop"></a>14.6.3.&nbsp;Properties for Authentication and Roles</h3></div></div></div><p>
    The properties in this section define how users and groups may be associated
    with roles and certain authentication mechanisms. Some of these properties
    are included in the excerpt of the <code class="filename">authentication.json</code>
    file shown in <a class="xref" href="#passthrough-auth" title="14.3.&nbsp;Using Delegated Authentication">Section&nbsp;14.3, &#8220;Using Delegated Authentication&#8221;</a>.
   </p><p>
    Different authentication modules may apply. In files such as
    <code class="filename">authentication.json</code>, you may assign an authentication
    module to the <code class="literal">name</code> property. Just be sure to include
    <code class="literal">enabled=true</code> or <code class="literal">enabled=false</code> for
    the configured module(s). For a list of available modules, see
    <a class="xref" href="#supported-auth-modules" title="14.4.&nbsp;Supported Authentication Modules">Section&nbsp;14.4, &#8220;Supported Authentication Modules&#8221;</a>.
   </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">queryOnResource</code></span></dt><dd><p>
       The system endpoint against which the user authenticates, such as
       <code class="literal">system/ldap/account</code>,
       <code class="literal">system/scriptedsql/account</code>,
       <code class="literal">system/ad/account</code>,
       <code class="literal">managed/user</code>, and
       <code class="literal">repo/internal/user</code>.
      </p></dd><dt><span class="term"><code class="literal">augmentSecurityContext</code> (optional)</span></dt><dd><p>
       This parameter points to a script, executed only after a successful
       authentication request to provide additional information, based on the
       security context.
      </p><p>
       For delegated (pass-through authentication), OpenIDM uses the
       <code class="filename">populateAsManagedUser.js</code> script. This script uses
       authentication details returned from the pass-through authentication
       module. Those details can point to a linked managed user record.
       If a linked record is found, the script adjusts the details of the
       security context to match that managed user object. The
       adjusted security context enables additional operations for the
       authenticated user, such as the ability to access the default user
       interface.
      </p><p>
       The script must be either JavaScript
       (<code class="literal">"type":"text/javascript"</code>) or Groovy
       (<code class="literal">"type":"groovy"</code>), and can be provided inline
       (<code class="literal">"source":"script source"</code>) or in a file
       (<code class="literal">"file":"filename"</code>).
      </p></dd><dt><span class="term"><code class="literal">propertyMapping</code> (optional)</span></dt><dd><p>
       A list that enables you to map the following OpenIDM properties to fields
       in the system resource used for the authentication.
      </p></dd><dt><span class="term">
      <code class="literal">authenticationId</code>
     </span></dt><dd><p>
       Specifies the authentication property, such as <code class="literal">"uid"</code>,
       <code class="literal">"sAMAccountName"</code>, and <code class="literal">"username"</code>
      </p></dd><dt><span class="term"><code class="literal">groupMembership</code></span></dt><dd><p>
       Specifies the name of the property in the remote system that contains
       the list of groups of which the authenticated user is a member, such as
       <code class="literal">memberOf</code>, or <code class="literal">ldapGroups</code>.
      </p></dd><dt><span class="term"><code class="literal">groupRoleMapping</code> (optional)</span></dt><dd><p>
       Enables you to assign roles to users, based on their group membership in
       the system resource. In this example, users who are members
       of the <code class="literal">"cn=admins"</code> group in the LDAP directory
       automatically acquire the <code class="literal">"openidm-admin"</code> role. Group
       membership is determined, based on the
       <code class="literal">groupMembership</code> property, described previously.
      </p></dd><dt><span class="term"><code class="literal">managedUserLink</code> (optional)</span></dt><dd><p>
       Used by the script specified in <code class="literal">"augmentSecurityContext"</code>
       to switch the context of an authenticated user from their original
       security context to a context that is based on the related
       <code class="literal">managed/user</code> account. The value is based on the
       <code class="literal">name</code> of the mapping in the associated
       <code class="filename">sync.json</code> file.
      </p><p>
       The value of this property is the <code class="literal">"links"</code> entry
       (usually the mapping name defined in <code class="literal">sync.json</code>) that
       was used to relate the remote system users with the managed users.
      </p></dd><dt><span class="term"><code class="literal">defaultUserRoles</code> (optional)</span></dt><dd><p>
       Can be defined for any authentication module. OpenIDM assigns such roles
       (or an empty set) to the security context of a user.
      </p></dd><dt><span class="term"><code class="literal">enabled</code></span></dt><dd><p>
       Specifies whether the given authentication module is enabled
       (<code class="literal">true</code>) or disabled (<code class="literal">false</code>).
      </p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="authorization-extending"></a>14.6.4.&nbsp;Extending the Authorization Mechanism</h3></div></div></div><p>
    You can extend the default authorization mechanism by defining additional
    functions in <code class="filename">router-authz.js</code> and by creating new access
    control configuration definitions in <code class="filename">access.js</code>.
   </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="user-group-role-auth-assignment"></a>14.7.&nbsp;Building Role-Based Access Control (RBAC)</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#auth-security-context">14.7.1. Roles, Authentication, and the Security Context</a></span></dt></dl></div><p>
   In OpenIDM, role assignments can be configured with different authentication
   options. Roles can be assigned in a number of ways. The roles assigned to
   specific users are cumulative.
  </p><p>
   The roles for each user are calculated based on the process depicted here:
  </p><div class="mediaobject" align="center"><a name="figure-roles-auth"></a><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/roles-auth.png" align="middle" height="360" alt="The Role-Based Access Control Configuration Process"></td></tr></table><div class="longdesc-link" align="right"><br clear="all"><span class="longdesc-link">[<a href="figure-roles-auth.html" target="longdesc">D</a>]</span></div></div><p>
   In OpenIDM, RBAC incorporates authentication and authorization options from
   roles configured for clients, for managed / internal users, as well as for
   group memberships.
  </p><p>
   For information on the properties listed in this section, see <a class="xref" href="#roles-auth-prop" title="14.6.3.&nbsp;Properties for Authentication and Roles">Section&nbsp;14.6.3, &#8220;Properties for Authentication and Roles&#8221;</a>.
  </p><p>
   Roles and authentication options can be configured for users in three stages:
  </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Client Controlled</span></dt><dd><p>
      The <code class="literal">defaultUserRoles</code> may be added to authentication
      modules configured in the applicable
      <code class="filename">authentication.json</code> file. Default roles are listed in
      <a class="xref" href="#openidm-roles" title="14.5.&nbsp;Roles and Authentication">Section&nbsp;14.5, &#8220;Roles and Authentication&#8221;</a>.
     </p><p>
      If you see the following entry in <code class="filename">authentication.json</code>,
      the cited authentication property applies to all authenticated users:
     </p><div class="screen"><pre>"defaultUserRoles" : [ ] </pre></div></dd><dt><span class="term">Managed / Internal</span></dt><dd><p>
      Accumulated roles for users are collected in the <code class="literal">userRoles</code>
      property.
     </p><p>
      For a definition of managed and internal users, see
      <a class="xref" href="#openidm-users" title="14.1.&nbsp;OpenIDM Users">Section&nbsp;14.1, &#8220;OpenIDM Users&#8221;</a>.
     </p></dd><dt><span class="term">Group roles</span></dt><dd><p>
      OpenIDM also uses group roles as input. Options include
      <code class="literal">groupMembership</code>, <code class="literal">groupRoleMapping</code>,
      and <code class="literal">groupComparison</code>
     </p></dd><dt><span class="term">context.security</span></dt><dd><p>
      Once OpenIDM assigns roles and authentication modules to a user,
      OpenIDM then evaluates the result based on the
      <code class="literal">context.security</code> map, based on the scripts in the
      <code class="filename">policy.js</code> file. Details require an extended
      discussion in the next section.
     </p></dd></dl></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="auth-security-context"></a>14.7.1.&nbsp;Roles, Authentication, and the Security Context</h3></div></div></div><p>
   The Security Context, written into the code as
   <code class="literal">context.security</code>, consists of a principal defined by the
   <code class="literal">authenticationId</code>, along with access control defined
   through the <code class="literal">authorizationId</code>.
  </p><p>
   If authentication is successful, Common Authentication Framework (CAF)
   modules set a principal. OpenIDM stores that principal as the
   <code class="literal">authenticationId</code>. For more information, see the
   authentication components defined in <a class="xref" href="#supported-auth-modules" title="14.4.&nbsp;Supported Authentication Modules">Section&nbsp;14.4, &#8220;Supported Authentication Modules&#8221;</a>.
  </p><p>
   The <code class="literal">authorizationId</code> includes two roles-related components,
   generated by OpenIDM:
  </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">roles</span></dt><dd><p>
      Discussed in <a class="xref" href="#openidm-roles" title="14.5.&nbsp;Roles and Authentication">Section&nbsp;14.5, &#8220;Roles and Authentication&#8221;</a>
     </p></dd><dt><span class="term">component</span></dt><dd><p>
      Resources defined through properties defined in
      <a class="xref" href="#roles-auth-prop" title="14.6.3.&nbsp;Properties for Authentication and Roles">Section&nbsp;14.6.3, &#8220;Properties for Authentication and Roles&#8221;</a>. The <code class="literal">authorizationId</code>
      component is set to the value references in the
      <code class="literal">queryOnResource</code> property.
     </p></dd></dl></div></div></div></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-security"></a>Chapter&nbsp;15.&nbsp;Securing &amp; Hardening OpenIDM</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="section"><a href="#security-management-service">15.1. Accessing the Security Management Service</a></span></dt><dt><span class="section"><a href="#security-precautions">15.2. Security Precautions for a Production Environment</a></span></dt></dl></div><a class="indexterm" name="d505e13983"></a><a class="indexterm" name="d505e13986"></a><p>
  OpenIDM provides a security management service, that manages keystore and
  truststore files. The security service is accessible over the REST interface,
  enabling you to read and import SSL certificates, and to generate certificate
  signing requests.
 </p><p>
  This chapter describes the security management service and its REST interface.
 </p><p>
  In addition, the chapter outlines the specific security procedures that you
  should follow before deploying OpenIDM in a production environment.
 </p><div class="note"><h3 class="title">Note</h3><p>
   In a production environment, we recommend that you avoid the use of:
   communications over insecure HTTP, self-signed certificates, and
   certificates associated with insecure ciphers.
  </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="security-management-service"></a>15.1.&nbsp;Accessing the Security Management Service</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#csr-over-rest">15.1.1. To Generate a Certificate Signing Request Over REST</a></span></dt><dt><span class="section"><a href="#import-signed-cert-over-rest">15.1.2. To Import a Signed Certificate into the Keystore</a></span></dt><dt><span class="section"><a href="#security-endpoints">15.1.3. Security Management Service Endpoints</a></span></dt></dl></div><p>
   OpenIDM stores keystore and truststore files in a folder named
   <code class="filename">/path/to/openidm/security</code>. These files can be managed by
   using the <span class="command"><strong>keytool</strong></span> command, or over the REST interface, at
   the URL <code class="literal">https://localhost:8443/openidm/security</code>. For
   information about using the <span class="command"><strong>keytool</strong></span> command, see
   <a class="link" href="http://docs.oracle.com/javase/6/docs/technotes/tools/solaris/keytool.html" target="_top">http://docs.oracle.com/javase/6/docs/technotes/tools/solaris/keytool.html</a>.
  </p><p>
   The following sections describe how to manage certificates and keys over REST.
  </p><div class="example"><a name="display-keystore-over-rest"></a><div class="example-title">Example&nbsp;15.1.&nbsp;To Display the Contents of the Keystore</div><div class="example-contents"><p>
    OpenIDM generates a symmetric key and a private key the first time the
    server is started. After startup, display the contents of the keystore over
    REST, as follows:
   </p><div class="screen"><pre>
$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/security/keystore"</strong>
    <em>
{
  "type" : "JCEKS",
  "provider" : {
     "Cipher.Blowfish SupportedKeyFormats" : "RAW",
     "AlgorithmParameters.DESede" : "com.sun.crypto.provider.DESedeParameters",
     "AlgorithmParameters.DES" : "com.sun.crypto.provider.DESParameters",
  ...
  },
  "aliases" : [ "openidm-sym-default", "openidm-localhost" ]
}</em>
   </pre></div><div class="itemizedlist"><p>
     By default, OpenIDM includes the following aliases:
    </p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
      <code class="literal">openidm-sym-default</code> - the default symmetric key that is
      used, for example, to encrypt the configuration.
     </p></li><li class="listitem"><p>
      <code class="literal">openidm-localhost</code> - the default alias that is used by
      the Jetty web server to service SSL requests. This alias references a
      private key and a self-signed certificate. You can use the self-signed
      certificate for testing purposes. When you deploy OpenIDM in a production
      environment, you should replace the self-signed certificate with a
      certificate that has been signed by a certificate authority.
     </p></li></ul></div></div></div><br class="example-break"><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="csr-over-rest"></a>15.1.1.&nbsp;To Generate a Certificate Signing Request Over REST</h3></div></div></div><p>
    To request a signed certificate, generate a certificate signing request
    (CSR) over REST, as described in this section. The details of the CSR are
    specified in JSON format, for example:
   </p><pre class="brush: javascript;">
{
    "DN" : "www.example.com",
    "OU" : "HR",
    "L"  : "Cupertino",
    "C"  : "US"
}
   </pre><p>
    For information about the complete contents of a CSR, see
    <a class="link" href="http://www.sslshopper.com/what-is-a-csr-certificate-signing-request.html" target="_top">http://www.sslshopper.com/what-is-a-csr-certificate-signing-request.html</a>.
   </p><p>
    To generate a CSR over the REST interface, include the private key alias in
    the URL. The following example, uses the default alias
    (<code class="literal">openidm-localhost</code>). If you have created your own private
    key for this request, specify its alias instead of
    <code class="literal">openidm-localhost</code>. Set <code class="literal"> "returnPrivateKey" : true</code>
    to return the private key along with the request.
   </p><div class="screen"><pre>
$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 --data '{"CN" : "www.example.com",
 "OU" : "HR",
 "L"  : "Cupertino",
 "C"  : "US",
 "returnPrivateKey" : true,
 "alias" : "openidm-localhost"}' \
 "https://localhost:8443/openidm/security/keystore?_action=generateCSR"</strong>
    <em>
{
  "_id": "openidm-localhost",
  "csr": "-----BEGIN CERTIFICATE REQUEST-----\n
MIICmzCCAYMCAQAwWDEZMBcGA1UEAwwQd3d3MS5
leGFtcGxlLmNvbTELMAkGA1UE\nCwwCSFIxDTALBgNVBAoMBE5vbmUxEjAQBgNVBAcMCUN1cGVyd
GlubzELMAkGA1UE\nBhMCVVMwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDAjCjTt1b
o0WKH\nP/4PR/Td3A1ElTo4/J/7o7eWflOqs8vW5d76SMcJFKOQ6FhoOcOHRNewch+a0DBK\njKF
aRCE1c0PuXiIlrO7wsF4dFTtTZKAhrpFdM+0hU4LeyCDxQQ5UDga3rmyVIvC8\nL1PvW+sZEcZ9r
T67XOV03cwUpjvG4W58FCUKd6UAI0szfIrFdvJp4q4LkkBNkk9J\nUf+MXsSVuHzZrqvqhX900Is
a19mXD6/P9Cql8KmwEzzbglGFf6uYAK33F71Kx409\nTeS85sjmBbyJwUVwhgQ0R35H3HC6jex4P
jx1rSfPmsi61JBx9kyGu6rnSv5FOQGy\nBQpgQFnJAgMBAAEwDQYJKoZIhvcNAQENBQADggEBAKc
yInfo2d7/12jUrOjL4Bqt\nStuQS/HkO2KAsc/zUnlpJyd3RPI7Gs1C6FxIRVCzi4Via5QzE06n2
F8HHkinqc6m\nBWhIcf5Omk6fSqG0aw7fqn20XWDkRm+I4vtm8P8CuWftUj5qv5kmyUtrcQ3+YPD
O\nL+cK4cfuCkjLQ3h4GIgBJP+gfWX8fTmCHyaHEFjLTMj1hZYEx+3f8awOVFoNmr3/\nB8LIJNH
UiFHO6EED7LDOwa/z32mTRET0nK5DVO60H80JSWxzdWYZQV/IzHzm8ST4\n6j6vuheBZiG5gZR2V
F0x5XoudQrSg7lpVslXBHNeiM85+H08RMQh8Am2bp+Xstw=\n",
     -----END CERTIFICATE REQUEST-----\n",
  "publicKey": {
     "format": "X.509",
     "encoded": "-----BEGIN PUBLIC KEY-----\n
MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAr
ALtYU662bNbQZG7JZ3M\noOUmVP9cPP3+DhQ5H0V0qB+9YjE4XUtuwUGqaUmuT+mrXHwGpLAqvUm
NsVyXJj9s\nJhX6PCyXzO3RdKBVC8pphMfKXodjBC57ef0OkWjO5ZRAqCRwS3BXkoCfu6/ZXRpk\
ncc/A1RmLZdPmcuKmN5vQl4E3Z6F4YyG7M0g7TE54dhqPvGNS9cO4r0Vom9373MDh\n+8QSfmLCC
94Ro+VUAF9Q6nk2j0PgTi+QZ0i93jbKAWWX57w6S5i7CpEptKyeP9iG\ncFnJddSICPHkbQJ73gu
lyZYkbcBblNUxIhODZV5bJ0oxn9qgYvzlxJupldYsYkBo\ncwIDAQAB\n
     -----END PUBLIC KEY-----\n",
     "algorithm": "RSA"
  },
  "privateKey": {
     "format": "PKCS#8",
     "encoded": "-----BEGIN RSA PRIVATE KEY-----\n
MIIEpAIBAAKCAQEArALtYU662bNbQZG7JZ3MoOU
VP9cPP3+DhQ5H0V0qB+9YjE4\nXUtuwUGqaUmuT+mrXHwGpLAqvUmNsVyXJj9sJhX6PCyXzO3RdK
BVC8pphMfKXodj\nBC57ef0OkWjO5ZRAqCRwS3BXkoCfu6/ZXRpkcc/A1RmLZdPmcuKmN5vQl4E3
Z0i93jbKAWWX57w6S5i7CpEptKyeP9iGcFnJddSICPHkbQJ73gulyZYkbcBb\nlNUxIhODZV5bJ0
Z6F4\nYyG7M0g7TE54dhqPvGNS9cO4r0Vom9373MDh+8QSfmLCC94Ro+VUAF9Q6nk2j0Pg\nTi+Q
oxn9qgYvzlxJupldYsYkBocwIDAQABAoIBAGmfpopRIPWbaBb8\nWNIBcuz9qSsaX1ZolP+qNWVZ
bgfq7Y0FMlo/frQXEYBzqSETGJHC6wVn0+bF6scV\nVw86dLtyVWVr8I77HdoitfZ2hZLuZ/rh4d
BohpPi63YoyJs7DPTy4y2/v1aLuwoy\nMiQ0l6c3bm6sr+eIVgMH4A9Xk5/jzAHVTCBrvfTYZnh6
qD4Qmiuj8pQn79HQV8NK\nLt/5kmV1+uGj78jg7NR06NjNsa4L3mNZSiqsn2haPXZAnBjKfWApxe
GugURgNBCO\ncmYqCDZLvpMy4S/qoRBu+6qdYGprb+tHshBYNywuDkrgszhwgr5yRm8VQ60T9tM/
\nceKM+TECgYEA2Az2DkpC9TjJHPJG7x4boRRVqV5YRgPf5MrU+7PxDMb+EauXXUXg\nsch9Eeon
30yINqSv6FwATLVlkzQpZLkkJ6GJqAxUmPjRslAuosiSJqKaWamDUDbz\nSu/7iANJWvRGayqZsa
GQqFwM0Xpfp/EiBGe757k0D02u8sAv94A75bsCgYEAy9FQ\nMwDU3CaDzgv0qgR1ojXkSW0dCbv0
QPEkKZ2Ik7JbXzwVGzfdv2VUVrzRKBGReYzn\nGg/s4HbZkYy4O+SJo44n/5iO2pgKG5MEDFHSpw
X54Rm+qabT2fQ2lFJ/myWKsPgJ\n4gZ9bUvcemCcLLzsiAphueulQp49eOLnkzPlQKkCgYEAy7A0
jrZuuDjoStUUET5G\neC/urvZWrPPcMx0TfZZhTVWSlWA8HWDS/WnymGA1ZS4HQdU0TxHl6mwerp
C/8ckn\nEAIZAQlW/L2hHcbAoRIN0ET+1kedmJOl/mGQt+O5Vfn1JfYM3s5ezouyPhBsfK43\nDw
Ypvsb6EO+BYDXXQzVvwx8CgYB9o67LcfTFLNzNFCOi9pLJBm2OMbvXt0wPCFch\nbCG34hdfMntU
RvDjvgPqYASSrZm+kvQW5cBAciMWDOe4y91ovAW+En3lFBoO+2Zg\nbcPr/8wUTblxfQxU660Fa4
GL0u2Wv5/f+94vlLb5nTpIfcFU7wllAXTjBwaf0Uet\nPy1P2QKBgQDPoyJqPi2TdN7ZQYcoXAM4
Gl5Yv9oO16RC917XH6SLvj0ePmdLgBXo\nrR6aAmOjLzFp9jiytWZqVR9DbAWd2YNpvQav4Gude3
lteew02UT+GNv/gC71bXCw\ncFTxnmKjP8YYIBBqZXzuk9wEaHN7OdGybUW0dsBCGxTXwDKe8XiA
6w==\n-----END RSA PRIVATE KEY-----\n",
     "algorithm": "RSA"
} </em>
   </pre></div><p>
    This sample request returns the CSR, the private key associated with the
    request, and the public key. The security management service stores the
    private key in the repository.
    When the signed certificate is returned by the certificate authority and you
    import the certificate into the keystore, you do not need to supply the
    private key. The security management service locates the private key in the
    repository, adds the certificate chain, and loads it into the keystore.
   </p><p>
    If you will be importing the signed certificate into the keystore of an
    OpenIDM instance that is not connected to the repository in which this
    private key was stored, you must include the private key when you import the
    signed certificate. Setting <code class="literal">"returnPrivateKey" : true</code> in
    the CSR enables you to maintain a copy of the private key for this purpose.
   </p><p>Send the output from
    </p><div class="screen"><pre>"csr": "-----BEGIN CERTIFICATE REQUEST-----
     ...
     -----END CERTIFICATE REQUEST-----</pre></div><p>
    to your certificate authority for signature.
   </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="import-signed-cert-over-rest"></a>15.1.2.&nbsp;To Import a Signed Certificate into the Keystore</h3></div></div></div><p>
    When a signed certificate is returned by the certificate authority, import
    it into the keystore by running a RESTful <code class="literal">PUT</code> command on
    the keystore alias. Include the CA root certificate in the command. If you
    are not importing the certificate into the same keystore as the one from
    which the CSR was generated, include the private key in the PUT request.
   </p><div class="screen"><pre>
$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request PUT \
 --data '{
    "alias": "openidm-localhost",
    "fromCSR": true,
    "certs": [
        "-----BEGIN CERTIFICATE-----\n
MIIGcDCCBVigAwIBAgIDC23tMA0GCSqGSIb3DQEBBQUAMIGMMQswCQYDVQQGEwJJ\n
TDEWMBQGA1UEChMNU3RhcnRDb20gTHRkLjErMCkGA1UECxMiU2VjdXJlIERpZ2l0\n
YWwgQ2VydGlmaWNhdGUgU2lnbmluZzE4MDYGA1UEAxMvU3RhcnRDb20gQ2xhc3Mg\n
MSBQcmltYXJ5IEludGVybWVkaWF0ZSBTZXJ2ZXIgQ0EwHhcNMTMwODA3MTMyODAz\n
WhcNMTQwODA4MDY0NTM5WjB2MRkwFwYDVQQNExBwZ3BDaGU4cEJPZnptVE9KMQsw\n
CQYDVQQGEwJHQjEjMCEGA1UEAxMadGVzdC1jb25uZWN0LmZvcmdlcm9jay5jb20x\n
JzAlBgkqhkiG9w0BCQEWGHBvc3RtYXN0ZXJAZm9yZ2Vyb2NrLmNvbTCCASIwDQYJ\n
KoZIhvcNAQEBBQADggEPADCCAQoCggEBAJRWGbnMGs+uGKU6ZrlTaaFdPczLqZnv\n
D37T0FOc/X3XXHxSVH94FDk7N4ansP2o6BsDWttIkM2AXkX3efMRaNpgxg7l4+DL\n
opV6H1RkrRba2Lom6Hp2pgkqvOBfd1ZMOmLbjUHt0jhypnIzu7TVwtTH7Ywsrx9F\n
uR9d4veYdW70IeQ64EhUG3RJBGG++AYJZCOjgEfbCwAYe/NoX/YVu+aMreHMR/+0\n
CV0YXKvHZgytcwZIc5WkQYaSWQA9lDWZzt5XjCErCATfiGEQ0k02QgpEfNTXxwQs\n
kfxh//O/qbfOWmloGwVU/2NY+5z3ZW8/eCksmiL1gGAYQAd+9+WI7BsCAwEAAaOC\n
Au4wggLqMAkGA1UdEwQCMAAwCwYDVR0PBAQDAgOoMBMGA1UdJQQMMAoGCCsGAQUF\n
BwMBMB0GA1UdDgQWBBR2zHzb71ZOHSwDZk28L9It3PvOtzAfBgNVHSMEGDAWgBTr\n
QjTQmLCrn/Qbawj3zGQu7w4sRTA0BgNVHREELTArghp0ZXN0LWNvbm5lY3QuZm9y\n
Z2Vyb2NrLmNvbYINZm9yZ2Vyb2NrLmNvbTCCAVYGA1UdIASCAU0wggFJMAgGBmeB\n
DAECATCCATsGCysGAQQBgbU3AQIDMIIBKjAuBggrBgEFBQcCARYiaHR0cDovL3d3\n
dy5zdGFydHNzbC5jb20vcG9saWN5LnBkZjCB9wYIKwYBBQUHAgIwgeowJxYgU3Rh\n
cnRDb20gQ2VydGlmaWNhdGlvbiBBdXRob3JpdHkwAwIBARqBvlRoaXMgY2VydGlm\n
aWNhdGUgd2FzIGlzc3VlZCBhY2NvcmRpbmcgdG8gdGhlIENsYXNzIDEgVmFsaWRh\n
dGlvbiByZXF1aXJlbWVudHMgb2YgdGhlIFN0YXJ0Q29tIENBIHBvbGljeSwgcmVs\n
aWFuY2Ugb25seSBmb3IgdGhlIGludGVuZGVkIHB1cnBvc2UgaW4gY29tcGxpYW5j\n
ZSBvZiB0aGUgcmVseWluZyBwYXJ0eSBvYmxpZ2F0aW9ucy4wNQYDVR0fBC4wLDAq\n
oCigJoYkaHR0cDovL2NybC5zdGFydHNzbC5jb20vY3J0MS1jcmwuY3JsMIGOBggr\n
BgEFBQcBAQSBgTB/MDkGCCsGAQUFBzABhi1odHRwOi8vb2NzcC5zdGFydHNzbC5j\n
b20vc3ViL2NsYXNzMS9zZXJ2ZXIvY2EwQgYIKwYBBQUHMAKGNmh0dHA6Ly9haWEu\n
c3RhcnRzc2wuY29tL2NlcnRzL3N1Yi5jbGFzczEuc2VydmVyLmNhLmNydDAjBgNV\n
HRIEHDAahhhodHRwOi8vd3d3LnN0YXJ0c3NsLmNvbS8wDQYJKoZIhvcNAQEFBQAD\n
ggEBAKVOAHtXTrgISj7XvE4/lLxAfIP56nlhpoLu8CqVlLK6eK4zCQRyTiFYx3xq\n
VQMSNVgQIdimjEsMz8o5/fDrCrozsT6sqxIPFsdgdskPyz9YyC9Y/AVBuECxabQr\n
B//0STicfdPg8PuDYtI64/INA47d/gtb57RaTFYxKs6bU8vtObinDJCwT33x4tvt\n
ob18DwB3/PeTbWyVUIxB0nvfm89dys0SF2alaA/bLuy0B7rdlppd4dOMpmiD0tnI\n
DORtr5HOD1xGiixZWzA1V2pTmF/hJZbhmEgBUSIyPK5Z9pZPephMf+/KrovbQqKr\n
6SEjgs7dGwpo6fA2mfCH5cCrid0=\n
-----END CERTIFICATE-----",
        "-----BEGIN CERTIFICATE-----\n
MIIDdTCCAl2gAwIBAgILBAAAAAABFUtaw5QwDQYJKoZIhvcNAQEFBQAwVzELMAkG\n
A1UEBhMCQkUxGTAXBgNVBAoTEEdsb2JhbFNpZ24gbnYtc2ExEDAOBgNVBAsTB1Jv\n
b3QgQ0ExGzAZBgNVBAMTEkdsb2JhbFNpZ24gUm9vdCBDQTAeFw05ODA5MDExMjAw\n
MDBaFw0yODAxMjgxMjAwMDBaMFcxCzAJBgNVBAYTAkJFMRkwFwYDVQQKExBHbG9i\n
YWxTaWduIG52LXNhMRAwDgYDVQQLEwdSb290IENBMRswGQYDVQQDExJHbG9iYWxT\n
aWduIFJvb3QgQ0EwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDaDuaZ\n
jc6j40+Kfvvxi4Mla+pIH/EqsLmVEQS98GPR4mdmzxzdzxtIK+6NiY6arymAZavp\n
xy0Sy6scTHAHoT0KMM0VjU/43dSMUBUc71DuxC73/OlS8pF94G3VNTCOXkNz8kHp\n
1Wrjsok6Vjk4bwY8iGlbKk3Fp1S4bInMm/k8yuX9ifUSPJJ4ltbcdG6TRGHRjcdG\n
snUOhugZitVtbNV4FpWi6cgKOOvyJBNPc1STE4U6G7weNLWLBYy5d4ux2x8gkasJ\n
U26Qzns3dLlwR5EiUWMWea6xrkEmCMgZK9FGqkjWZCrXgzT/LCrBbBlDSgeF59N8\n
9iFo7+ryUp9/k5DPAgMBAAGjQjBAMA4GA1UdDwEB/wQEAwIBBjAPBgNVHRMBAf8E\n
BTADAQH/MB0GA1UdDgQWBBRge2YaRQ2XyolQL30EzTSo//z9SzANBgkqhkiG9w0B\n
AQUFAAOCAQEA1nPnfE920I2/7LqivjTFKDK1fPxsnCwrvQmeU79rXqoRSLblCKOz\n
yj1hTdNGCbM+w6DjY1Ub8rrvrTnhQ7k4o+YviiY776BQVvnGCv04zcQLcFGUl5gE\n
38NflNUVyRRBnMRddWQVDf9VMOyGj/8N7yy5Y0b2qvzfvGn9LhJIZJrglfCm7ymP\n
AbEVtQwdpf5pLGkkeB6zpxxxYu7KyJesF12KwvhHhm4qxFYxldBniYUr+WymXUad\n
DKqC5JlR3XC321Y9YeRq4VzW9v493kHMB65jUr9TU/Qr6cf9tveCX4XSQRjbgbME\n
HMUfpIBvFSDJ3gyICh3WZlXi/EjJKSZp4A==\n
-----END CERTIFICATE-----"
    ],
    "privateKey": "-----BEGIN RSA PRIVATE KEY-----\n
zDot5q3vP9YjCihMZMkSa0zT2Zt+8S+mC0EVuYuTVhVpqrVNtkP1mlt+CYqmDffY\n
sGuD6SMrT6+SeAzX2uYFgY4+s8yaRWBcr0C5Z7yihilM6BK+IJ4is9kaW5VFr1Ph\n
wRKvSeFHBGh2wLNpjVSNPzLMDZBtkVi9Ny/xD5C3M1Gah0PGmnrPGCP8tr1Lshv4\n
PxYJwzHzouTdQDkLYlCjMN++NmIYfx7zrbEYV4VzXMxgNq7d3+d5dlVfE8xpAjSR\n
Lqlamib+doe1oWOQ2WiS6baBAH+Gw5rgqfwhJbCY/UlbCpuJ6kl7TLvTrFp8YpvB\n
Iv1GD0yuwSued3a+AxMFuIzTBYd2rC6rHq+eF4eHd/Q/Sbm9+9VuW/h8dW3LGvbE\n
5SUUhNw6uSkOZmZ0z/+FLbwoLPCASukY9biSd+12KJf4N42WZxID+9mJTp1j/Bv7\n
n29oGfZ3vav8PqG+F987hSyWEIdGTMfIxwaUrdYe1fmbUCxv0suMcYTRbAs9g3cm\n
eCNxbZBYC/fL+Nlj5NjZ+gxA/tEXV7wWynPZW3mZny6fQpDTDMslqsoFZR+rAUzH\n
ViePuLbCdxIC5heUyqvDBbeOzgQWOu6SZjX+mAQpo0DPKt1KDP4DKv9EW92sIwW3\n
AnFg98sje0DZ+zfsnevGioQMJrG0JSnqTYADxHaauu7NWndkfMZisfNIKA0u+ajU\n
AbP8xFXIP5JU8O4tWmlbxAbMOYfrZHabFNZx4DH1OVOJqdJIVx0KER0GSZd50D6W\n
QBzCfEbwMlJ17OB0AgWzNrbaak3MCmW1mh7OecjQwge1ajy7ho+JtQ==\n
-----END RSA PRIVATE KEY-----"
 }' \
 "https://localhost:8443/openidm/security/keystore/cert"
    </strong>
    <em>
{
    "_id": "openidm-localhost"
}
    </em>
   </pre></div><p>
    If the import is successful, the command returns the alias of the keystore
    to which the signed certificate was added.
   </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="security-endpoints"></a>15.1.3.&nbsp;Security Management Service Endpoints</h3></div></div></div><p>
     The OpenIDM security management service includes the following endpoints:
     </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="filename">openidm/security/keystore</code></p></li><li class="listitem"><p><code class="filename">openidm/security/truststore</code></p></li></ul></div><p>
    </p><p>
     You can use these endpoints to READ the contents on the keystore and
     truststore.
    </p><p>
     In addition, you can use these endpoints to perform related actions such as
     <code class="literal">generateCert</code> and <code class="literal">generateCSR</code>.
    </p><p>
     When you set up an <code class="literal">_action</code> request on either endpoint,
     you need to include all properties, including <code class="literal">alias</code>,
     in the request data.
    </p><p>
     The alias is not provided in the URL; it is available in the data object.
     For example, you might include <code class="literal">"alias" : "openidm-localhost"</code>
     within a <code class="literal">--data '{ "alias" : "openidm-localhost" }' </code>
     option.
    </p><p>
     Certificates and private keys are associated with the following endpoints:
     <code class="literal">openidm/security/keystore/cert</code>,
     <code class="literal">openidm/security/keystore/privatekey</code>, and
     <code class="literal">openidm/security/truststore/cert</code>.
    </p><p>
     All CRUD requests on such certificates and private/public keys use these
     endpoints.
    </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="security-precautions"></a>15.2.&nbsp;Security Precautions for a Production Environment</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#security-ssl-https">15.2.1. Use SSL and HTTPS</a></span></dt><dt><span class="section"><a href="#rest-over-https">15.2.2. Restrict REST Access to the HTTPS Port</a></span></dt><dt><span class="section"><a href="#security-encrypt-data">15.2.3. Encrypt Data Internally and Externally</a></span></dt><dt><span class="section"><a href="#security-messages">15.2.4. Use Message Level Security</a></span></dt><dt><span class="section"><a href="#security-replace-defaults">15.2.5. Replace Default Security Settings</a></span></dt><dt><span class="section"><a href="#security-jetty">15.2.6. Secure Jetty</a></span></dt><dt><span class="section"><a href="#security-urls">15.2.7. Protect Sensitive REST Interface URLs</a></span></dt><dt><span class="section"><a href="#security-files">15.2.8. Protect Sensitive Files &amp; Directories</a></span></dt><dt><span class="section"><a href="#security-bootstrap">15.2.9. Obfuscate Bootstrap Information</a></span></dt><dt><span class="section"><a href="#security-remove-dev-tools">15.2.10. Remove or Protect Development &amp; Debug Tools</a></span></dt><dt><span class="section"><a href="#security-protect-repo">15.2.11. Protect the OpenIDM Repository</a></span></dt><dt><span class="section"><a href="#security-adjust-log-levels">15.2.12. Adjust Log Levels</a></span></dt><dt><span class="section"><a href="#security-run-as-service">15.2.13. Set Up Restart At System Boot</a></span></dt></dl></div><p>
   Out of the box, OpenIDM is set up for ease of development and deployment.
   When you deploy OpenIDM in production, there are specific precautions you
   should take to minimize security breaches. After following the guidance in
   this section, make sure that you test your installation to verify that it
   behaves as expected before putting it into production.
  </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="security-ssl-https"></a>15.2.1.&nbsp;Use SSL and HTTPS</h3></div></div></div><a class="indexterm" name="d505e14170"></a><p>We recommend that you disable plain HTTP access, as
  described in the section titled <a href="../integrators-guide/index.html#security-jetty" class="link"><em class="citetitle">Secure
  Jetty</em></a>.</p><p>
   Use TLS/SSL to access OpenIDM, ideally with mutual authentication so that
   only trusted systems can invoke each other. TLS/SSL protects data on the
   network. Mutual authentication with strong certificates, imported into the
   trust and keystores of each application, provides a level of confidence for
   trusting application access.
  </p><p>Augment this protection with message level security where
  appropriate.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="rest-over-https"></a>15.2.2.&nbsp;Restrict REST Access to the HTTPS Port</h3></div></div></div><p>
   When possible, use a certificate to secure REST access, over HTTPS. For
   production, that certificate should be signed by a certificate authority.
  </p><p>
   OpenIDM generates a self-signed certificate when it first starts up. You can
   use this certificate to test secure REST access.
  </p><p>
   While not recommended for production, you can test secure REST access using
   the default self-signed certificate. To do so, you can create a self-signed
   certificate file, <code class="filename">self-signed.crt</code>, using the following
   procedure:
  </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
     Extract the certificate that is generated when OpenIDM starts up.
    </p><div class="screen"><pre>$ openssl s_client -showcerts -connect localhost:8443 &lt;/dev/null</pre></div><p>
     This command outputs the entire certificate to the terminal.
    </p></li><li class="step"><p>
     Using any text editor, create a file named
     <code class="filename">self-signed.crt</code>. Copy the portion of the certificate
     from <code class="literal">-----BEGIN CERTIFICATE-----</code> to
     <code class="literal">----END CERTIFICATE-----</code> and paste it into the
     <code class="filename">self-signed.crt</code> file, which should appear similar to
     the following:
    </p><div class="screen"><pre>
$ <strong>more self-signed.crt</strong>
<em>-----BEGIN CERTIFICATE-----
MIIB8zCCAVygAwIBAgIETkvDjjANBgkqhkiG9w0BAQUFADA+MSgwJgYDVQQKEx9P
cGVuSURNIFNlbGYtU2lnbmVkIENlcnRpZmljYXRlMRIwEAYDVQQDEwlsb2NhbGhv
c3QwHhcNMTEwODE3MTMzNTEwWhcNMjEwODE3MTMzNTEwWjA+MSgwJgYDVQQKEx9P
cGVuSURNIFNlbGYtU2lnbmVkIENlcnRpZmljYXRlMRIwEAYDVQQDEwlsb2NhbGhv
c3QwgZ8wDQYJKoZIhvcNAQEBBQADgY0AMIGJAoGBAKwMkyvHS5yHAnI7+tXUIbfI
nQfhcTChpWNPTHc/cli/+Ta1InTpN8vRScPoBG0BjCaIKnVVl2zZ5ya74UKgwAVe
oJQ0xDZvIyeC9PlvGoqsdtH/Ihi+T+zzZ14oVxn74qWoxZcvkG6rWEOd42QzpVhg
wMBzX98slxkOZhG9IdRxAgMBAAEwDQYJKoZIhvcNAQEFBQADgYEASo4qMI0axEKZ
m0jU4yJejLBHydWoZVZ8fKcHVlD/rTirtVgWsVgvdr3yUr0Idk1rH1nEF47Tzn+V
UCq7qJZ75HnIIeVrZqmfTx8169paAKAaNF/KRhTE6ZII8+awst02L86shSSWqWz3
s5xPB2YTaZHWWdzrPVv90gL8JL/N7/Q=
-----END CERTIFICATE-----</em>
    </pre></div></li><li class="step"><p>
     Test REST access on the HTTPS port, referencing the self-signed certificate
     in the command. For example:
    </p><div class="screen"><pre><strong>$ curl \
 --header "X-OpenIDM-Username:openidm-admin" \
 --header "X-OpenIDM-Password:openidm-admin" \
 --cacert self-signed.crt \
 --request GET \
 "https://localhost:8443/openidm/managed/user/?_queryId=query-all-ids"</strong>
     <em>{
    "result": [],
    "resultCount": 0,
    "pagedResultsCooke": null,
    "remainingPagedResuts": -1
}    </em></pre></div></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="security-encrypt-data"></a>15.2.3.&nbsp;Encrypt Data Internally and Externally</h3></div></div></div><a class="indexterm" name="d505e14240"></a><a class="indexterm" name="d505e14245"></a><p>Beyond relying on end-to-end availability of TLS/SSL to protect
  data, OpenIDM also supports explicit encryption of data that goes on the
  network. This can be important if the TLS/SSL termination happens prior to
  the final endpoint.</p><p>OpenIDM also supports encryption of data stored in the repository,
  using a symmetric key. This protects against some attacks on the data
  store. Explicit table mapping is supported for encrypted string values.</p><p>OpenIDM automatically encrypts sensitive data in configuration files,
  such as passwords. OpenIDM replaces clear text values when the system first
  reads the configuration file. Take care with configuration files having
  clear text values that OpenIDM has not yet read and updated.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="security-messages"></a>15.2.4.&nbsp;Use Message Level Security</h3></div></div></div><a class="indexterm" name="d505e14257"></a><p>OpenIDM supports message level security, forcing authentication before
  granting access. Authentication works by means of a filter-based mechanism
  that lets you use either an HTTP Basic like mechanism or OpenIDM-specific 
  headers, setting a cookie in the response that you can use for subsequent 
  authentication. If you attempt to access OpenIDM URLs without the appropriate 
  headers or session cookie, OpenIDM returns HTTP 401 Unauthorized, or HTTP 403
  Forbidden, depending on the situation. If you use a session cookie, you must
  include an additional header that indicates the origin of the request.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="security-messages-auth"></a>15.2.4.1.&nbsp;Message Level Security with Logins</h4></div></div></div><p>The following examples show successful authentications.</p><div class="screen"><pre>
$ <strong>curl \
 --cacert self-signed.crt \
 --dump-header /dev/stdout \
 --user openidm-admin:openidm-admin \
 "https://localhost:8443/openidm/managed/user?_queryId=query-all-ids"</strong>
   <em>
HTTP/1.1 200 OK
Content-Type: application/json; charset=UTF-8
Cache-Control: no-cache
Set-Cookie: session-jwt=2l0zobpuk6st1b2m7gvhg5zas ...;Path=/
Expires: Thu, 01 Jan 1970 00:00:00 GMT
Vary: Accept-Encoding, User-Agent
Content-Length: 82
Server: Jetty(8.y.z-SNAPSHOT)

{"result":[],"resultCount":"0","pagedResultsCookie":null,"remainingPagedResults":-1}
   </em>

$ <strong>curl \
 --cacert self-signed.crt \
 --dump-header /dev/stdout \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 "https://localhost:8443/openidm/managed/user?_queryId=query-all-ids"</strong>
   <em>
HTTP/1.1 200 OK
Content-Type: application/json; charset=UTF-8
Cache-Control: no-cache
Set-Cookie: session-jwt=2l0zobpuk6st1b2m7gvhg5zas ...;Path=/
Expires: Thu, 01 Jan 1970 00:00:00 GMT
Vary: Accept-Encoding, User-Agent
Content-Length: 82
Server: Jetty(8.y.z-SNAPSHOT)

{"result":[],"resultCount":"0","pagedResultsCookie":null,"remainingPagedResults":-1}
   </em>

$ <strong>curl \
 --dump-header /dev/stdout \
 --cacert self-signed.crt \
 --header "Cookie: session-jwt=2l0zobpuk6st1b2m7gvhg5zas ..." \
 --header "X-Requested-With: OpenIDM Plugin" \
 "https://localhost:8443/openidm/managed/user?_queryId=query-all-ids"</strong>
   <em>
Expires: Thu, 01 Jan 1970 00:00:00 GMT
Content-Type: application/json; charset=UTF-8
Cache-Control: no-cache
Vary: Accept-Encoding, User-Agent
Content-Length: 82
Server: Jetty(8.y.z-SNAPSHOT)
   </em>
  </pre></div><p>Notice that the last example uses the cookie OpenIDM set in the
  response to the previous request, and includes the
  <code class="literal">X-Requested-With</code> header to indicate the origin of the
  request. The value of the header can be any string, but should be informative
  for logging purposes. If you do not include the
  <code class="literal">X-Requested-With</code> header, OpenIDM returns HTTP 403
  Forbidden.</p><div class="note"><h3 class="title">Note</h3><p>
     The careful readers among you may notice that the expiration date of the
     JWT cookie, January 1, 1970, corresponds to the start of UNIX time. Since
     that time is in the past, browsers will not store that cookie after the
     browser is closed.
    </p></div><p>You can also request one-time authentication without a session.</p><div class="screen"><pre>
$ <strong>curl \
 --dump-header /dev/stdout \
 --cacert self-signed.crt \
 --header "X-OpenIDM-NoSession: true" \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 "https://localhost:8443/openidm/managed/user?_queryId=query-all-ids"</strong>
   <em>
HTTP/1.1 200 OK
Content-Type: application/json; charset=UTF-8
Cache-Control: no-cache
Vary: Accept-Encoding, User-Agent
Content-Length: 82
Server: Jetty(8.y.z-SNAPSHOT)

{"result":[],"resultCount":"0","pagedResultsCookie":null,"remainingPagedResults":-1}
   </em>
  </pre></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="security-messages-logout"></a>15.2.4.2.&nbsp;Logout By Removing the JWT Cookie</h4></div></div></div><p>
   OpenIDM maintains sessions with a JWT session cookie, stored in a client
   browser. To log out and destroy the session, you would access and remove that
   cookie from the client browser.
  </p><p>
   The JWT session cookie is based on the <code class="literal">JWT_SESSION</code> module
   documented in <a href="../integrators-guide/index.html#supported-auth-modules" class="link">
   <em class="citetitle">Supported Authentication Modules</em></a>.
  </p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="security-replace-defaults"></a>15.2.5.&nbsp;Replace Default Security Settings</h3></div></div></div><a class="indexterm" name="d505e14328"></a><p>The default security settings are adequate for evaluation purposes. For 
  production, change the default encryption key, and then replace the default user 
  password.</p><div class="procedure"><a name="security-change-encryption-keys"></a><div class="procedure-title">Procedure&nbsp;15.1.&nbsp;To Change Default Encryption Keys</div><a class="indexterm" name="d505e14336"></a><a class="indexterm" name="d505e14339"></a><p>By default, OpenIDM uses a symmetric encryption key with alias
   <code class="literal">openidm-sym-default</code>. Change this default key before
   deploying OpenIDM in production.</p><p>
    As noted in the section on the<a href="../integrators-guide/index.html#cli-keytool" class="link">
    <em class="citetitle">keytool</em></a> command, the default keystore
    password is <code class="literal">changeit</code>.
   </p><ol class="procedure" type="1"><li class="step"><p>Add the new key to the keystore.</p><div class="screen"><pre><strong>$ cd /path/to/openidm/
$ keytool \
 -genseckey \
 -alias new-sym-key \
 -keyalg AES \
 -keysize 128 \
 -keystore security/keystore.jceks \
 -storetype JCEKS</strong>
    <em>Enter keystore password:
Enter key password for &lt;new-sym-key&gt;
  (RETURN if same as keystore password):
Re-enter new password:</em></pre></div><p>Additional options associated with the <span class="command"><strong>keytool</strong></span>
     command in OpenIDM are shown in the following file:
    <code class="filename">openidm/samples/security/keystore_readme.txt</code>.</p></li><li class="step"><p>Change the alias used in
    <code class="filename">openidm/conf/boot/boot.properties</code>.</p></li></ol></div><div class="procedure"><a name="security-replace-default-user-password"></a><div class="procedure-title">Procedure&nbsp;15.2.&nbsp;To Replace the Default User &amp; Password</div><p>After changing the default encryption key, change at least the default
   user password.</p><ol class="procedure" type="1"><li class="step"><p>Use the <span class="command"><strong>encrypt</strong></span> command to obtain the encrypted 
    version of the new password.</p><div class="screen"><pre>
$ <strong>cd /path/to/openidm/</strong>
$ <strong>cli.sh encrypt newpwd</strong>
     <em>
...
-----BEGIN ENCRYPTED VALUE-----
{
  "$crypto" : {
    "value" : {
      "iv" : "TCoC/YrmiRmINw6jCPB5LQ==",
      "data" : "nCFvBIApIQ7C6k+UPzosaA==",
      "cipher" : "AES/CBC/PKCS5Padding",
      "key" : "openidm-sym-default"
    },
    "type" : "x-simple-encryption"
  }
}
------END ENCRYPTED VALUE------
     </em>
    </pre></div></li><li class="step"><p>Replace the user object in the
    <code class="filename">openidm/db/scripts/mysql/openidm.sql</code> script before
    setting up MySQL as a repository for OpenIDM.</p><p>Alternatively, replace the user in the internal user table.</p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="security-jetty"></a>15.2.6.&nbsp;Secure Jetty</h3></div></div></div><a class="indexterm" name="d505e14415"></a><p>
   If you do not want to use regular HTTP on a production OpenIDM system, edit
   the <code class="filename">openidm/conf/jetty.xml</code> configuration file. Comment
   out the line that enables regular HTTP.
  </p><p>
   The following excerpt includes the Java comment code that you would add
   around the <code class="literal">openidm.port.http</code> argument. The value of this
   argument (8080 by default) is taken from the
   <code class="filename">conf/boot/boot.properties</code> file and the
   <code class="filename">conf/config.properties</code> file.
  </p><pre class="brush: xml;">
&lt;Call name="addConnector&gt;
  &lt;Arg&gt;
    &lt;New class="org.eclipse.jetty.server.nio.SelectChannelConnector"&gt;
      &lt;Set name="host"&gt;&lt;Property name="jetty.host" /&gt;&lt;/Set&gt;
&lt;!-- &lt;Set name="port"&gt;&lt;Call class="org.forgerock.openidm.jetty.Param"
          name="getProperty"&lt;Arg&gt;openidm.port.http&lt;/Arg&gt;&lt;/Call&gt;&lt;/Set&gt;  --&gt;
        &lt;Set name="maxIdleTime"&gt;300000&lt;/Set&gt;
        &lt;Set name="Acceptors"&gt;2&lt;/Set&gt;
        &lt;Set name="statsOn"&gt;false&lt;/Set&gt;
        &lt;Set name="confidentialPort"&gt;
          &lt;Call class="org.forgerock.openidm.jetty.Param" name="getProperty"&gt;
            &lt;Arg&gt;openidm.port.https&lt;/Arg&gt;
          &lt;/Call&gt;
        &lt;/Set&gt;
      &lt;/New&gt;
   &lt;/Arg&gt;
&lt;/Call&gt;</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="security-urls"></a>15.2.7.&nbsp;Protect Sensitive REST Interface URLs</h3></div></div></div><p>
   Anything attached to the router is accessible with the default policy,
   including the repository. If you do not need such access,
   deny it in the authorization policy to reduce the attack surface.
  </p><p>
   In addition, you can deny direct HTTP access to system objects in production,
   particularly access to <code class="literal">action</code>. As a rule of thumb, do not
   expose anything that is not used in production. The main public interfaces
   over HTTP are <code class="literal">/openidm/managed/</code> and
   <code class="literal">/openidm/config/</code>. Other URIs are triggered indirectly,
   or are used for internal consumption.
  </p><p>OpenIDM supports native query expressions on the repository, and it is
   possible to enable these over HTTP, for example, the following query should
   identify managed users in an OrientDB repository:</p><div class="screen"><pre>
$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 "https://localhost:8443/openidm/managed/user?_queryExpression=select+*+from+managed_user"</strong></pre></div><p>
   By default, direct HTTP access to native queries is disallowed, and should
   remain so in production systems.
  </p><p>
   For testing or development purposes, it can be helpful to enable native
   queries on the repository over HTTP. To do so, edit the access
   control configuration file (<code class="filename">access.js</code>). In that file,
   remove any instances of <code class="literal">"disallowQueryExpression()"</code>
   such as the following:
  </p><pre class="brush: javascript;">
{
    "pattern"   : "*",
    "roles"     : "openidm-admin",
    "methods"   : "*", // default to all methods allowed
    "actions"   : "*", // default to all actions allowed
 // "customAuthz" : "disallowQueryExpression()",
    "excludePatterns": "system/*"
},
...
{
    "pattern"   : "system/*",
    "roles"     : "openidm-admin",
    "methods"   : "create,read,update,delete,patch,query", // restrictions on 'action'
    "actions"   : ""
 // "customAuthz" : "disallowQueryExpression()"
},
...
 "customAuthz" : "ownDataOnly() &amp;&amp;
    managedUserRestrictedToAllowedProperties('"+allowedPropertiesForManagedUser+"')",
    // &amp;&amp; disallowQueryExpression()"


  </pre><p>See the chapter on <a href="../integrators-guide/index.html#chap-auth" class="link"><em class="citetitle">Managing
  Authentication, Authorization &amp; RBAC</em></a> for an example
  showing how to protect sensitive URLs.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="security-files"></a>15.2.8.&nbsp;Protect Sensitive Files &amp; Directories</h3></div></div></div><p>Protect OpenIDM files from access by unauthorized users.</p><p>In particular, prevent other users from reading files in at least the
  <code class="filename">openidm/conf/boot/</code> and
  <code class="filename">openidm/security/</code> directories.</p><p>
   The objective is to limit access to the user that is running the service.
   Depending on the operating system and configuration, that user might be
   <code class="filename">root</code>, <code class="filename">Administrator</code>,
   <code class="filename">openidm</code>, or something similar.
  </p><div class="procedure"><a name="security-files-unix"></a><div class="procedure-title">Procedure&nbsp;15.3.&nbsp;Protecting key files in Unix</div><ol class="procedure" type="1"><li class="step"><p>
      For the target directory, and the files therein, make sure user and
      group ownership is limited to the user that is running the OpenIDM
      service.
     </p></li><li class="step"><p>
      Disable access of any sort for <code class="literal">other</code>
      users. One simple command for that purpose, from the
      <code class="filename">/path/to/openidm</code> directory, is:
     </p><div class="screen"><pre># chmod -R o-rwx .</pre></div></li></ol></div><div class="procedure"><a name="security-files-windows"></a><div class="procedure-title">Procedure&nbsp;15.4.&nbsp;Protecting key files in Windows</div><ol class="procedure" type="1"><li class="step"><p>
     The OpenIDM process in Windows is normally run by the
     <code class="literal">Administrator</code> user.
    </p></li><li class="step"><p>
     If you are concerned about the security of the administrative account,
     you can <code class="literal">Deny</code> permissions on the noted directories to
     existing users, or alternatively the <code class="literal">Users</code> group.
    </p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="security-bootstrap"></a>15.2.9.&nbsp;Obfuscate Bootstrap Information</h3></div></div></div><p>
   OpenIDM uses the information in <code class="filename">conf/boot/boot.properties</code>,
   including the keystore password, to start up. The keystore password is
   <code class="literal">changeit</code> by default, and is stored in clear text in the
   <code class="filename">boot.properties</code> file. To set an obfuscated version of
   the keystore password in the <code class="filename">boot.properties</code> file,
   follow these steps.
  </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
     Generate an obfuscated version of the password, by using the crypto bundle
     provided with OpenIDM:
    </p><div class="screen"><pre>
     <strong>
$ java -jar /path/to/openidm/bundle/openidm-crypto-3.1.0-SNAPSHOT.jar
     </strong>
     <em>
This utility helps obfuscate passwords to prevent casual observation.
It is not securely encrypted and needs further measures to prevent disclosure.
Please enter the password:
OBF:1vn21ugu1saj1v9i1v941sar1ugw1vo0
CRYPT:a8b5a01ba48a306f300b62a1541734c7
     </em>
    </pre></div></li><li class="listitem"><p>
     Paste the obfuscated password (<code class="literal">OBF:xxxxxxx</code>) and the
     cryptographic key (<code class="literal">CRYPT:xxxxxxx</code>) into the
     <code class="filename">conf/boot/boot.properties</code> file. Comment out the
     regular keystore password and remove the comment tags from the lines that
     contain the obfuscated password and the cryptographic key:
    </p><div class="screen"><pre>
$ <strong>more conf/boot/boot.properties</strong>
     <em>
...
# Keystore password, adjust to match your keystore and protect this file
# openidm.keystore.password=changeit
openidm.truststore.password=changeit

# optionally use the cli encrypt to obfuscate the password and set
openidm.keystore.password=OBF:1vn21ugu1saj1v9i1v941sar1ugw1vo0
openidm.keystore.password=CRYPT:a8b5a01ba48a306f300b62a1541734c7
...  </em>
    </pre></div></li><li class="listitem"><p>
     Restart OpenIDM.
    </p><div class="screen"><pre>$ ./startup.sh</pre></div></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="security-remove-dev-tools"></a>15.2.10.&nbsp;Remove or Protect Development &amp; Debug Tools</h3></div></div></div><p>Before deploying OpenIDM in production, remove or protect development
  and debug tools, including the OSGi console exposed under
  <code class="literal">/system/console</code>. Authentication for this console is not
  integrated with authentication for OpenIDM.</p><p>To remove the OSGi console, remove the web console bundle,
  <code class="filename">org.apache.felix.webconsole-<em class="replaceable"><code>version</code></em>.jar</code>.</p><p>If you cannot remove the OSGi console, then protect it by overriding
  the default <code class="literal">admin:admin</code> credentials. Create a file called
  <code class="filename">openidm/conf/org.apache.felix.webconsole.internal.servlet.OsgiManager.cfg</code>
  containing the user name and password to access the console in Java
  properties file format.</p><pre class="brush: ini;">
username=user-name
password=password</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="security-protect-repo"></a>15.2.11.&nbsp;Protect the OpenIDM Repository</h3></div></div></div><p>Use the JDBC or MSSQL repositories. OrientDB is not yet supported for
  production use.</p><p>Use a strong password for the JDBC connection. Do not rely on default
  passwords.</p><p>Use a case sensitive database, particularly if you work with systems
  with different identifiers that match except for case. Otherwise correlation
  queries can pick up identifiers that should not be considered the same.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="security-adjust-log-levels"></a>15.2.12.&nbsp;Adjust Log Levels</h3></div></div></div><p>Leave log levels at <code class="literal">INFO</code> in production to ensure
  that you capture enough information to help diagnose issues. See the chapter
  on <a href="../integrators-guide/index.html#chap-logs" class="link"><em class="citetitle">Configuring Server
  Logs</em> for more information.</a>
  </p><p>At start up and shut down, <code class="literal">INFO</code> can produce many
  messages. Yet, during stable operation, <code class="literal">INFO</code> generally
  results in log messages only when coarse-grain operations such as
  scheduled reconciliation start or stop.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="security-run-as-service"></a>15.2.13.&nbsp;Set Up Restart At System Boot</h3></div></div></div><p>You can run OpenIDM in the background as a service (daemon), and
  add startup and shutdown scripts to manage the service at system boot
  and shutdown. For more information, see <a href="../integrators-guide/index.html#chap-services" class="link"><em class="citetitle">Starting and 
  Stopping OpenIDM</em></a>.</p><p>See your operating system documentation for details on adding a
  service such as OpenIDM to be started at boot and shut down at system
  shutdown.</p></div></div></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-workflow"></a>Chapter&nbsp;16.&nbsp;Integrating Business Processes and Workflows</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="section"><a href="#about-bmpm-2-activiti">16.1. BPMN 2.0 and the Activiti Tools</a></span></dt><dt><span class="section"><a href="#setting-up-activiti">16.2. Setting Up Activiti Integration With OpenIDM</a></span></dt><dt><span class="section"><a href="#activiti-custom-templates">16.3. Using Custom Templates for Activiti Workflows</a></span></dt><dt><span class="section"><a href="#workflows-REST">16.4. Managing Workflows Over the REST Interface</a></span></dt><dt><span class="section"><a href="#sample-activiti-workflows">16.5. Example Activiti Workflows With OpenIDM</a></span></dt><dt><span class="section"><a href="#workflow-use-cases">16.6. Workflow Use Cases</a></span></dt></dl></div><a class="indexterm" name="d505e14669"></a><a class="indexterm" name="d505e14672"></a><p>Key to any identity management solution is the ability to provide
 workflow-driven provisioning activities, whether for self-service actions
 such as requests for entitlements, roles or resources, running sunrise or
 sunset processes, handling approvals with escalations, or performing
 maintenance.</p><p>OpenIDM provides an embedded workflow and business process engine
 based on Activiti and the Business Process Model and Notation (BPMN) 2.0
 standard.</p><p>More information about Activiti and the Activiti project can be found
 at <a class="link" href="http://www.activiti.org" target="_blank">http://www.activiti.org</a>.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="about-bmpm-2-activiti"></a>16.1.&nbsp;BPMN 2.0 and the Activiti Tools</h2></div></div></div><p>Business Process Model and Notation 2.0 is the result of consensus
  among Business Process Management (BPM) system vendors. The <a class="link" href="http://omg.org/" target="_blank">Object Management Group</a>
  (OMG) has developed and maintained the <a class="link" href="http://www.omg.org/spec/BPMN/" target="_blank">BPMN</a> standard since
  2004.</p><p>The first version of the BPMN specification focused only on graphical
  notation, and quickly became popular with the business analyst audience.
  BPMN 1.x defines how constructs such as human tasks, executable scripts, and
  automated decisions are visualized in a vendor-neutral, standard way. The
  second version of BPMN extends that focus to include execution semantics,
  and a common exchange format. Thus, BPMN 2.0 process definition models
  can be exchanged not only between different graphical editors, but can also
  be executed as is on any BPMN 2.0-compliant engine, such as the engine
  embedded in OpenIDM.</p><p>Using BPMN 2.0, you can add artifacts describing workflow and business
  process behavior to OpenIDM for provisioning and other purposes. For example,
  you can craft the actual artifacts defining business processes and workflow
  in a text editor, or using a special Eclipse plugin. The Eclipse plugin 
  provides visual design capabilities, simplifying packaging and deployment of 
  the artifact to OpenIDM. See the <a class="link" href="http://docs.codehaus.org/display/ACT/Activiti+BPMN+2.0+Eclipse+Plugin" target="_blank">Activiti BPMN 2.0 Eclipse Plugin</a> documentation for
  instructions on installing Activiti Eclipse BPMN 2.0 Designer.</p><p>Also, read the Activiti <em class="citetitle">User Guide</em> section
  covering <a class="link" href="http://www.activiti.org/userguide/#bpmnConstructs" target="_blank"><em class="citetitle">BPMN 2.0 Constructs</em></a>, which
  describes in detail the graphical notations and XML representations for
  events, flows, gateways, tasks, and process constructs.</p><p>
   With the latest version of Activiti, JavaScript tasks can be added to
   workflow definitions. However, OpenIDM functions cannot be called from a
   JavaScript task in a workflow. Therefore, you can use JavaScript for
   non-OpenIDM workflow tasks, but you must use the
   <code class="literal">activiti:expression</code> construct to call OpenIDM functions.
   </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="setting-up-activiti"></a>16.2.&nbsp;Setting Up Activiti Integration With OpenIDM</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#configuring-activiti-engine">16.2.1. Configuring the Activiti Engine</a></span></dt><dt><span class="section"><a href="#defining-activiti-workflows">16.2.2. Defining Activiti Workflows</a></span></dt><dt><span class="section"><a href="#invoking-activiti-workflows">16.2.3. Invoking Activiti Workflows</a></span></dt><dt><span class="section"><a href="#querying-activiti-workflows">16.2.4. Querying Activiti Workflows</a></span></dt></dl></div><p>
   OpenIDM embeds an Activiti Process Engine that is started in the OpenIDM OSGi
   container.
  </p><p>
   After OpenIDM has been installed (as described in the
   <a href="../install-guide/index.html#chap-install" class="link"><em class="citetitle">Installation
   Guide</em></a>), start OpenIDM, and run the
   <span class="command"><strong>scr list</strong></span> command at the console to check that the workflow
   bundle is active.
  </p><div class="screen"><pre>-&gt; OpenIDM ready
<strong>scr list</strong>
   Id   State          Name
...
[  39] [active       ] org.forgerock.openidm.workflow
...</pre></div><p>
   OpenIDM reads workflow definitions from the
   <code class="literal">/path/to/openidm/workflow</code> directory. To test workflow
   integration, at least one workflow definition must exist in this directory.
  </p><p>
   A sample workflow (<code class="filename">example.bpmn20.xml</code>) is provided in
   the <code class="literal">/path/to/openidm/samples/misc</code> directory. Copy this
   workflow to the <code class="literal">/path/to/openidm/workflow</code> directory to
   test the workflow integration.
  </p><div class="screen"><pre>$ cd /path/to/openidm
$ cp samples/misc/example.bpmn20.xml workflow/</pre></div><p>
   Verify the workflow integration by using the REST API. The following
   REST call lists the defined workflows:
  </p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/workflow/processdefinition?_queryId=query-all-ids"
  </strong></pre></div><p>
   The sample workflow definition that you copied in the previous step is named
   <code class="literal">osgiProcess</code>. The result of the preceding REST call
   therefore includes output similar to the following:
  </p><div class="screen"><pre><em>{
...
  "result":[
     {
        ...
        "key": "osgiProcess",
        ...
        "name":"Osgi process",
        ...
        "_id":"osgiProcess:1:3",
        ...
     }
        ]
}</em></pre></div><p>
   The <code class="literal">osgiProcess</code> workflow calls OpenIDM, queries the
   available workflow definitions from Activiti, then prints the list of
   workflow definitions to the OpenIDM logs. Invoke the <code class="literal">osgiProcess
  </code> workflow with the following REST call:
  </p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 --data '{"_key":"osgiProcess"}' \
 "https://localhost:8443/openidm/workflow/processinstance?_action=create"</strong></pre></div><p>
   The workflow prints the list of workflow definitions to the OpenIDM console.
   With the default sample, you should see something like this on the console:
  </p><div class="screen"><pre><em>
script task using resolver: [
  pagedResultsCookie:null,
  remainingPagedResults:-1,
  result:[
    [
	  tenantId:,
	  candidateStarterGroupIdExpressions:[],
	  candidateStarterUserIdExpressions:[],
	  participantProcess:null,
	  processDiagramResourceName:null,
	  historyLevel:null,
	  hasStartFormKey:false,
	  laneSets:[],
	  version:1, _id:osgiProcess:1:3,
	  description:null,
	  name:Osgi process,
	  executionListeners:[:],
	  key:osgiProcess,
	  resourceName:OSGI-INF/activiti/example.bpmn20.xml,
	  ioSpecification:null,
	  taskDefinitions:null,
	  suspensionState:1,
	  deploymentId:1,
	  properties:[:],
	  startFormHandler:null,
	  suspended:false,
	  variables:null,
	  _rev:1,
	  revisionNext:2,
	  category:Examples,
	  eventSupport:[:],
	  graphicalNotationDefined:false
	]
  ]
]
script task using expression resolver: [
  pagedResultsCookie:null,
  remainingPagedResults:-1,
  result:[
    [
	  tenantId:,
	  candidateStarterGroupIdExpressions:[],
      ...
]</em></pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="configuring-activiti-engine"></a>16.2.1.&nbsp;Configuring the Activiti Engine</h3></div></div></div><p>
   The OpenIDM Activiti module is configured in a file named
   <code class="filename">conf/workflow.json</code>. If this file is absent from the
   configuration, the workflow module is unavailable for use. In the default
   OpenIDM installation, the <code class="filename">workflow.json</code> file has the
   following basic configuration:
  </p><pre class="brush: javascript;">
{
   "enabled"  : true
}
  </pre><p>
   You can disable the workflow module by setting the
   <code class="literal">"enabled"</code> property to <code class="literal">false</code>.
  </p><p>
   There are several additional configuration properties for the Activiti
   module. A sample <code class="filename">workflow.json</code> file that includes all
   configurable properties, is provided in <code class="literal">samples/misc</code>. To
   configure an Activiti engine beyond the default configuration, edit this
   sample file and copy it to the <code class="literal">/path/to/openidm/conf</code>
   directory.
  </p><p>
   The sample <code class="literal">workflow.json</code> file contains the following
   configuration:
  </p><pre class="brush: javascript;">
  {
    "enabled"  : true,
    "location" : "remote",
    "engine" : {
        "url" : "http://localhost:9090/openidm-workflow-remote-3.0.0",
        "username" : "youractivitiuser",
        "password" : "youractivitipassword"
    },
    "mail" : {
        "host" : "yourserver.smtp.com",
        "port" : 587,
        "username" : "yourusername",
        "password" : "yourpassword",
        "starttls" : true
    },
    "history" : "audit"
}
  </pre><div class="itemizedlist"><p>
    These fields have the following meaning:
   </p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
     <code class="literal">enabled</code>. Indicates whether the Activiti module is
     enabled for use. Possible values are <code class="literal">true</code> or
     <code class="literal">false</code>. The default value is <code class="literal">true</code>.
    </p></li><li class="listitem"><p>
     <code class="literal">mail</code>. Specifies the details of the mail server that
     Activiti will use to send email notifications. By default, Activiti uses
     the mail server <code class="literal">localhost:25</code>. To specify a different
     mail server, enter the details of the mail server here.
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>
       <code class="literal">host</code>. The host of the mail server.
      </p></li><li class="listitem"><p>
       <code class="literal">port</code>. The port number of the mail server.
      </p></li><li class="listitem"><p>
       <code class="literal">username</code>. The user name of the account that connects
       to the mail server.
      </p></li><li class="listitem"><p>
       <code class="literal">password</code>. The password for the user specified above.
      </p></li><li class="listitem"><p>
       <code class="literal">startTLS</code>. Whether startTLS should be used to secure
       the connection.
      </p></li></ul></div></li><li class="listitem"><p>
     <code class="literal">history</code>. Determines the history level that should be
     used for the Activiti engine. For more information, see
     <a class="link" href="#activiti-history-level" title="16.2.1.1.&nbsp;Configuring the Activiti History Level">Configuring the Activiti History
     Level</a>.
    </p></li></ul></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="activiti-history-level"></a>16.2.1.1.&nbsp;Configuring the Activiti History Level</h4></div></div></div><p>
     The Activiti history level determines how much historical information is
     retained when workflows are executed. You can configure the history level
     by setting the <code class="literal">history</code> property in the
     <code class="literal">workflow.json</code> file, for example:
    </p><pre class="brush: plain;">"history" : "audit"</pre><div class="itemizedlist"><p>
      The following history levels can be configured:
     </p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
       <code class="literal">none</code>. No history archiving is done. This level results
       in the best performance for workflow execution, but no historical
       information is available.
      </p></li><li class="listitem"><p>
       <code class="literal">activity</code>. Archives all process instances and activity
       instances. No details are archived.
      </p></li><li class="listitem"><p>
       <code class="literal">audit</code>. This is the default level. All process
       instances, activity instances and submitted form properties are archived
       so that all user interaction through forms is traceable and can be
       audited.
      </p></li><li class="listitem"><p>
       <code class="literal">full</code>. This is the highest level of history archiving
       and has the greatest performance impact. This history level stores all
       the information that is stored for the <code class="literal">audit</code> level, as
       well as any process variable updates.
      </p></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="defining-activiti-workflows"></a>16.2.2.&nbsp;Defining Activiti Workflows</h3></div></div></div><p>
   The following section outlines the process to follow when you create an
   Activiti workflow for OpenIDM. Before you start creating workflows, you must
   configure the Activiti engine, as described in <a class="link" href="#configuring-activiti-engine" title="16.2.1.&nbsp;Configuring the Activiti Engine">Configuring the Activiti Engine</a>.
  </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
     Define your workflow in a text file, either using an editor, such as
     Activiti Eclipse BPMN 2.0 Designer, or a simple text editor.
    </p></li><li class="step"><p>
     Package the workflow definition file as a <code class="literal">.bar</code> file
     (Business Archive File). If you are using Eclipse to define the workflow, a
     <code class="literal">.bar</code> file is created when you select "Create deployment
     artifacts". A <code class="literal">.bar</code> file is essentially the same as a
     <code class="literal">.zip</code> file, but with the <code class="literal">.bar</code>
     extension.
    </p></li><li class="step"><p>
     Copy the <code class="literal">.bar</code> file to the
     <code class="literal">openidm/workflow</code> directory.
    </p></li><li class="step"><p>
     Invoke the workflow using a script (in <code class="literal">openidm/script/</code>)
     or directly using the REST interface. For more information, see <a class="link" href="#invoking-activiti-workflows" title="16.2.3.&nbsp;Invoking Activiti Workflows">Invoking Activiti Workflows</a>.
    </p><p>
     You can also schedule the workflow to be invoked repeatedly, or at a future
     time. For more information, see the <span class="olink"><em class="citetitle">Scheduler
     Reference</em></span>.
    </p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="invoking-activiti-workflows"></a>16.2.3.&nbsp;Invoking Activiti Workflows</h3></div></div></div><p>
   You can invoke workflows and business processes from any trigger point within
   OpenIDM, including reacting to situations discovered during reconciliation.
   Workflows can be invoked from script files, using the
   <code class="literal">openidm.create()</code> function, or directly from the REST
   interface.
  </p><p>
   The following sample script extract shows how to invoke a workflow from a
   script file:
  </p><pre class="brush: javascript;">
/*
 * Calling 'myWorkflow' workflow
 */

var params = {
 "_key": "myWorkflow"
};

openidm.create('workflow/processinstance', null, params);
  </pre><p>
   The <code class="literal">null</code> in this example indicates that you do not want to
   specify an ID as part of the create call. For more information, see the
   <a href="../integrators-guide/index.html#function-create" class="link"><em class="citetitle">Function
   Reference</em></a>.
  </p><p>
   You can invoke the same workflow from the REST interface by sending the
   following REST call to OpenIDM:
  </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 --data '{"_key":"myWorkflow"}' \
 "https://localhost:8443/openidm/workflow/processinstance?_action=create"</strong>
  </pre></div><div class="itemizedlist"><p>
    There are two ways in which you can specify the workflow definition that is
    used when a new workflow instance is started.
   </p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
     <code class="literal">_key</code> specifies the <code class="literal">id</code> attribute of
     the workflow process definition, for example:
    </p><pre class="brush: javascript;">
&lt;process id="sendNotificationProcess" name="Send Notification Process"&gt;
    </pre><p>
     If there is more than one workflow definition with the same
     <code class="literal">_key</code> parameter, the latest deployed version of the
     workflow definition is invoked.
    </p></li><li class="listitem"><p>
     <code class="literal">_processDefinitionId</code> specifies the ID that is generated
     by the Activiti Process Engine when a workflow definition is deployed, for
     example:
    </p><pre class="brush: javascript;">
"sendNotificationProcess:1:104";
    </pre><p>
     You can obtain the <code class="literal">processDefinitionId</code> by querying the
     available workflows, for example:
    </p><pre class="brush: javascript;">
 {
  "result": [
    {
      "name": "Process Start Auto Generated Task Auto Generated",
      "_id": "ProcessSAGTAG:1:728"
    },
    {
      "name": "Process Start Auto Generated Task Empty",
      "_id": "ProcessSAGTE:1:725"
    },
    ...     
    </pre><p>
     If you specify a <code class="literal">_key</code> and a
     <code class="literal">_processDefinitionId</code>, the
     <code class="literal">_processDefinitionId</code> is used because it is more precise.
    </p></li></ul></div><p>
   You can use the optional <code class="literal">_businessKey</code> parameter to add
   specific business logic information to the workflow when it is invoked. For
   example, the following workflow invocation assigns the workflow a business
   key of <code class="literal">"newOrder"</code>. This business key can later be used to
   query "newOrder" processes.
  </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request POST \
 --data '{"_key":"myWorkflow", "_businessKey":"newOrder"}' \
 "https://localhost:8443/openidm/workflow/processinstance?_action=create"</strong></pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="querying-activiti-workflows"></a>16.2.4.&nbsp;Querying Activiti Workflows</h3></div></div></div><p>
   The Activiti implementation supports filtered queries that enable you to
   query the running process instances and tasks, based on specific query
   parameters. To perform a filtered query send a GET request to the
   <code class="literal">workflow/processinstance</code> context path, including the query
   in the URL.
  </p><p>
   For example, the following query returns all process instances
   with the business key <code class="literal">"newOrder"</code>, as invoked in the
   previous example.
  </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/workflow/processinstance?_queryId=filtered-query&amp;businessKey=newOrder"</strong>
  </pre></div><p>
   Any Activiti properties can be queried using the same notation, for example,
   <code class="literal">processDefinitionId=managedUserApproval:1:6405</code>. The query
   syntax applies to all queries with <code class="literal">_queryId=filtered-query</code>.
   The following query returns all process instances that were started by the
   user <code class="literal">openidm-admin</code>:
  </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/workflow/processinstance?_queryId=filtered-query&amp;startUserId=openidm-admin"</strong>
  </pre></div><p>
   You can also query process instances based on the value of any process
   instance variable, by prefixing the variable name with
   <code class="literal">var-</code>. For example:
  </p><div class="screen"><pre>var-processvariablename=processvariablevalue</pre></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="activiti-custom-templates"></a>16.3.&nbsp;Using Custom Templates for Activiti Workflows</h2></div></div></div><p>
   The embedded Activiti engine is integrated with the default user interface.
   For simple workflows, you can use the standard Activiti form properties, and
   have the UI render the corresponding generic forms automatically. If you
   require a more complex form template, (including input validation,
   rich input field types, complex CSS, and so forth) you must define a custom
   form template.
  </p><div class="itemizedlist"><p>
    There are two ways in which you can define custom form templates for your
    workflows:
   </p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
     Create an HTML template, and refer to that template in the workflow
     definition.
    </p><p>
     This is the recommended method of creating custom form templates. To refer
     to the HTML template in the workflow definition, use the
     <code class="literal">activiti:formKey</code> attribute, for example
     <code class="literal">activiti:formKey="nUCStartForm.xhtml"</code>.
    </p><p>The HTML file must be deployed as part of the workflow definition.
     Create a .zip file that contains the HTML template and the workflow
     definition file. Rename the .zip file with a .bar extension.
    </p><p>
     For a sample workflow that uses external, referenced form templates, see
     <code class="literal">samples/usecase/workflow/newUserCreate.bpmn20.xml</code>. The
     HTML templates, and the corresponding .bar file are included in that
     directory.
    </p></li><li class="listitem"><p>
     Use an embedded template within the workflow definition.
    </p><p>
     This method is not ideal, because the HTML code must be escaped, and is
     difficult to read, edit, or maintain, as a result. Also, sections of HTML
     code will most likely need to be duplicated if your workflow includes
     multiple task stages. However, you might want to use this method if your
     form is small, not too complex and you do not want to bother with creating
     a separate HTML file and .bar deployment.
    </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="workflows-REST"></a>16.4.&nbsp;Managing Workflows Over the REST Interface</h2></div></div></div><p>
   In addition to the queries described previously, the following examples show
   the context paths that are exposed for managing workflows over the REST
   interface. The example output is based on the sample workflow that is
   provided in <code class="literal">openidm/samples/sample9</code>.
  </p><h3><a name="d505e15150"></a>openidm/workflow/processdefinition</h3><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
     List the available workflow definitions:
    </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/workflow/processdefinition?_queryId=query-all-ids"</strong>
    <em>
{
  "result" : [ {
    "tenantId" : "",
    "candidateStarterGroupIdExpressions" : [ ],
    "candidateStarterUserIdExpressions" : [ ],
    "participantProcess" : null,
    "processDiagramResourceName" : null,
    "historyLevel" : null,
    "hasStartFormKey" : false,
    "laneSets" : [ ],
    "version" : 1,
    "_id" : "managedUserApproval:1:3",
    "description" : null,
    "name" : "Managed User Approval Workflow",
    "executionListeners" : { },
    "key" : "managedUserApproval",
    "resourceName" : "OSGI-INF/activiti/managedUserApproval.bpmn20.xml",
    "ioSpecification" : null,
    "taskDefinitions" : null,
    "suspensionState" : 1,
    "deploymentId" : "1",
    "properties" : { },
    "startFormHandler" : null,
    "suspended" : false,
    "variables" : null,
    "_rev" : 1,
    "revisionNext" : 2,
    "category" : "Examples",
    "eventSupport" : { },
    "graphicalNotationDefined" : false
  } ],
  "resultCount" : 1,
  "pagedResultsCookie" : null,
  "remainingPagedResults" : -1
}     </em>
    </pre></div></li><li class="listitem"><p>
     List the workflow definitions, based on certain filter criteria:
    </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/workflow/processdefinition?_queryId=filtered-query&amp;category=Examples"
      </strong>
      <em>
{
  "result": [
    {
      ...
      "name": "Managed User Approval Workflow",
      "_id": "managedUserApproval:1:3",
      ...
      "category" : "Examples",
      ...
    }
  ]
}</em>
    </pre></div></li></ul></div><h3><a name="d505e15175"></a>openidm/workflow/processdefinition/{id}</h3><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
     Obtain detailed information for a process definition, based on the ID. You
     can determine the ID by querying all the available process definitions, as
     described in the first example in this section.
    </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/workflow/processdefinition/managedUserApproval:1:3"
     </strong>
     <em>
{
  "tenantId" : "",
  "candidateStarterGroupIdExpressions" : [ ],
  "candidateStarterUserIdExpressions" : [ ],
  "participantProcess" : null,
  "processDiagramResourceName" : null,
  "historyLevel" : null,
  "hasStartFormKey" : false,
  "laneSets" : [ ],
  "version" : 1,
  "formProperties" : [ ],
  "_id" : "managedUserApproval:1:3",
  "description" : null,
  "name" : "Managed User Approval Workflow",
  "executionListeners" : {
    "end" : [ { } ]
  },
  "key" : "managedUserApproval",
  "resourceName" : "OSGI-INF/activiti/managedUserApproval.bpmn20.xml",
  "ioSpecification" : null,
  "taskDefinitions" : {
    "evaluateRequest" : {
      "assigneeExpression" : {
        "expressionText" : "openidm-admin"
      },
      "candidateGroupIdExpressions" : [ ],
      "candidateUserIdExpressions" : [ ],
      "categoryExpression" : null,
      "descriptionExpression" : null,
      "dueDateExpression" : null,
      "key" : "evaluateRequest",
      "nameExpression" : {
        "expressionText" : "Evaluate request"
      },
      "ownerExpression" : null,
      "priorityExpression" : null,
      "taskFormHandler" : {
        "deploymentId" : "1",
        "formKey" : null,
        "formPropertyHandlers" : [ {
          "defaultExpression" : null,
          "id" : "requesterName",
          "name" : "Requester's name",
          "readable" : true,
          "required" : false,
          "type" : null,
          "variableExpression" : {
            "expressionText" : "${sourceId}"
          },
          "variableName" : null,
          "writable" : false
        }, {
          "defaultExpression" : null,
          "id" : "requestApproved",
          "name" : "Do you approve the request?",
          "readable" : true,
          "required" : true,
          "type" : {
            "name" : "enum",
            "values" : {
              "true" : "Yes",
              "false" : "No"
            }
          },
          "variableExpression" : null,
          "variableName" : null,
          "writable" : true
        } ]
      },
      "taskListeners" : {
        "assignment" : [ { } ],
        "create" : [ { } ]
      }
    }
  },
  "suspensionState" : 1,
  "deploymentId" : "1",
  "properties" : {
    "documentation" : null
  },
  "startFormHandler" : {
    "deploymentId" : "1",
    "formKey" : null,
    "formPropertyHandlers" : [ ]
  },
  "suspended" : false,
  "variables" : { },
  "_rev" : 2,
  "revisionNext" : 3,
  "category" : "Examples",
  "eventSupport" : { },
  "graphicalNotationDefined" : false
}       </em>
    </pre></div></li><li class="listitem"><p>
     Delete a workflow process definition, based on its ID. Note that you
     cannot delete a process definition if there are currently running
     instances of that process definition.
    </p><p>
     OpenIDM picks up workflow definitions from the files located in the
     <code class="filename">/path/to/openidm/workflow</code> directory. If you delete the
     workflow definition (<code class="filename">.xml</code> file) from this directory,
     the OSGI bundle is deleted. However, deleting this file does not remove the
     workflow definition from the Activiti engine. You must therefore delete the
     definition over REST, as shown in the following example.
    </p><p>
     Note that, although there is only one representation of a workflow
     definition in the file system, there might be several versions of the same
     definition in Activiti. If you want to delete redundant process
     definitions, delete the definition over REST, <span class="emphasis"><em>making sure that
     you do not delete the latest version</em></span>.
    </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "If-Match: *" \
 --request DELETE \
 "http://localhost:8080/openidm/workflow/processdefinition/managedUserApproval:1:3"
    </strong>
    </pre></div><p>
     The delete request returns the contents of the deleted workflow definition.
    </p></li></ul></div><h3><a name="d505e15211"></a>openidm/workflow/processinstance</h3><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
     Start a workflow process instance. For example:
    </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "Content-Type: application/json" \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --data '{"_key":"managedUserApproval"}' \
 --request POST \
 "https://localhost:8443/openidm/workflow/processinstance?_action=create"</strong>
     <em>
{
  "_id" : "4",
  "processInstanceId" : "4",
  "status" : "suspended",
  "businessKey" : null,
  "processDefinitionId" : "managedUserApproval:1:3"
}</em>
    </pre></div></li><li class="listitem"><p>
     Obtain the list of running workflows (process instances). The query returns
     a list of IDs. For example:
    </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/workflow/processinstance?_queryId=query-all-ids"
      </strong>
      <em>
{
  "result" : [ {
    "tenantId" : "",
    "businessKey" : null,
    "queryVariables" : null,
    "durationInMillis" : null,
    "processVariables" : { },
    "endTime" : null,
    "superProcessInstanceId" : null,
    "startActivityId" : "start",
    "startTime" : "2014-04-25T09:54:30.035+02:00",
    "startUserId" : "openidm-admin",
    "_id" : "4",
    "endActivityId" : null,
    "processInstanceId" : "4",
    "processDefinitionId" : "managedUserApproval:1:3",
    "deleteReason" : null
  } ],
  "resultCount" : 1,
  "pagedResultsCookie" : null,
  "remainingPagedResults" : -1
}</em>
    </pre></div></li><li class="listitem"><p>
     Obtain the list of running workflows based on specific filter criteria.
    </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/workflow/processinstance?_queryId=filtered-query&amp;businessKey=myBusinessKey"</strong>
    </pre></div></li></ul></div><h3><a name="d505e15243"></a>openidm/workflow/processinstance/{id}</h3><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
     Obtain the details of the specified process instance. For example:
    </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/workflow/processinstance/4"
     </strong>
     <em>{
  "tenantId" : "",
  "businessKey" : null,
  "queryVariables" : null,
  "durationInMillis" : null,
  "processVariables" : { },
  "endTime" : null,
  "superProcessInstanceId" : null,
  "startActivityId" : "start",
  "startTime" : "2014-05-12T20:56:25.415+02:00",
  "startUserId" : "openidm-admin",
  "_id" : "4",
  "endActivityId" : null,
  "processInstanceId" : "4",
  "processDefinitionId" : "managedUserApproval:1:3",
  "deleteReason" : null
}</em>
    </pre></div></li><li class="listitem"><p>
     Stop the specified process instance. For example:
    </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request DELETE \
 "https://localhost:8443/openidm/workflow/processinstance/4"</strong>
    <em>{
  "deleteReason": null,
  "processDefinitionId": "managedUserApproval:1:3",
  "processInstanceId": "4",
  "endActivityId": null,
  "_id": "4",
  "startUserId": "openidm-admin",
  "startTime": "2014-06-18T10:33:40.955+02:00",
  "tenantId": "",
  "businessKey": null,
  "queryVariables": null,
  "durationInMillis": null,
  "processVariables": {},
  "endTime": null,
  "superProcessInstanceId": null,
  "startActivityId": "start"
}</em></pre></div><p>
     The delete request returns the contents of the deleted process instance.
    </p></li></ul></div><h3><a name="d505e15267"></a>openidm/workflow/processdefinition/{id}/taskdefinition</h3><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
     Query the list of tasks defined for a specific process definition. For
     example:
    </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/workflow/processdefinition/managedUserApproval:1:3/taskdefinition?_queryId=query-all-ids"</strong>
     <em>
{
  "result" : [ {
    "taskCandidateGroup" : [ ],
    "ownerExpression" : null,
    "assignee" : {
      "expressionText" : "openidm-admin"
    },
    "categoryExpression" : null,
    "taskListeners" : {
      "assignment" : [ { } ],
      "create" : [ { } ]
    },
    "formProperties" : {
      "deploymentId" : "1",
      "formKey" : null,
      "formPropertyHandlers" : [ {
        "_id" : "requesterName",
        "defaultExpression" : null,
        "name" : "Requester's name",
        "readable" : true,
        "required" : false,
        "type" : null,
        "variableExpression" : {
          "expressionText" : "${sourceId}"
        },
        "variableName" : null,
        "writable" : false
      }, {
        "_id" : "requestApproved",
        "defaultExpression" : null,
        "name" : "Do you approve the request?",
        "readable" : true,
        "required" : true,
        "type" : {
          "name" : "enum",
          "values" : {
            "true" : "Yes",
            "false" : "No"
          }
        },
        "variableExpression" : null,
        "variableName" : null,
        "writable" : true
      } ]
    },
    "taskCandidateUser" : [ ],
    "formResourceKey" : null,
    "_id" : "evaluateRequest",
    "priority" : null,
    "descriptionExpression" : null,
    "name" : {
      "expressionText" : "Evaluate request"
    },
    "dueDate" : null
  } ],
  "resultCount" : 1,
  "pagedResultsCookie" : null,
  "remainingPagedResults" : -1
}      </em>
    </pre></div></li><li class="listitem"><p>
     Query a task definition based on the process definition ID and the task
     name (<code class="literal">taskDefinitionKey</code>). For example:
    </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/workflow/processdefinition/managedUserApproval:1:3/taskdefinition/evaluateRequest"
      </strong>
      <em>{
  "taskCandidateGroup" : [ ],
  "ownerExpression" : null,
  "formProperties" : {
    "deploymentId" : "1",
    "formKey" : null,
    "formPropertyHandlers" : [ {
      "_id" : "requesterName",
      "defaultExpression" : null,
      "name" : "Requester's name",
      "readable" : true,
      "required" : false,
      "type" : null,
      "variableExpression" : {
        "expressionText" : "${sourceId}"
      },
      "variableName" : null,
      "writable" : false
    }, {
      "_id" : "requestApproved",
      "defaultExpression" : null,
      "name" : "Do you approve the request?",
      "readable" : true,
      "required" : true,
      "type" : {
        "name" : "enum",
        "values" : {
          "true" : "Yes",
          "false" : "No"
        }
      },
      "variableExpression" : null,
      "variableName" : null,
      "writable" : true
    } ]
  },
  "taskCandidateUser" : [ ],
  "_id" : "evaluateRequest",
  "priority" : null,
  "name" : {
    "expressionText" : "Evaluate request"
  },
  "descriptionExpression" : null,
  "categoryExpression" : null,
  "assignee" : {
    "expressionText" : "openidm-admin"
  },
  "taskListeners" : {
    "assignment" : [ { } ],
    "create" : [ { } ]
  },
  "dueDate" : null
}</em>
    </pre></div></li></ul></div><h3><a name="d505e15293"></a>openidm/workflow/taskinstance</h3><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
     Query all running task instances. For example:
    </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/workflow/taskinstance?_queryId=query-all-ids"
      </strong>
      <em>{
  "result" : [ {
    "tenantId" : "",
    "createTime" : "2014-05-12T21:17:10.054+02:00",
    "executionId" : "10",
    "delegationStateString" : null,
    "processVariables" : { },
    "_id" : "15",
    "processInstanceId" : "10",
    "description" : null,
    "priority" : 50,
    "name" : "Evaluate request",
    "dueDate" : null,
    "parentTaskId" : null,
    "processDefinitionId" : "managedUserApproval:1:3",
    "taskLocalVariables" : { },
    "suspensionState" : 1,
    "assignee" : "openidm-admin",
    "cachedElContext" : null,
    "queryVariables" : null,
    "activityInstanceVariables" : { },
    "deleted" : false,
    "suspended" : false,
    "_rev" : 1,
    "revisionNext" : 2,
    "category" : null,
    "taskDefinitionKey" : "evaluateRequest",
    "owner" : null,
    "eventName" : null,
    "delegationState" : null
  } ],
  "resultCount" : 1,
  "pagedResultsCookie" : null,
  "remainingPagedResults" : -1
}</em>
    </pre></div></li><li class="listitem"><p>
     Query task instances based on candidate users or candidate groups. For
     example:
    </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/workflow/taskinstance?_queryId=filtered-query&amp;taskCandidateUser=manager1"
      </strong>
    </pre></div><p>
     or
    </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/workflow/taskinstance?_queryId=filtered-query&amp;taskCandidateGroup=management"
      </strong>
    </pre></div><p>
     Note that you can include both users and groups in the same query.
    </p></li></ul></div><h3><a name="d505e15324"></a>openidm/workflow/taskinstance/{id}</h3><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
     Obtain detailed information for a running task, based on the task ID. For
     example:
    </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/workflow/taskinstance/15"
     </strong>
     <em>{
  "dueDate": null,
  "processDefinitionId": "managedUserApproval:1:3",
  "owner": null,
  "taskDefinitionKey": "evaluateRequest",
  "name": "Evaluate request",
...</em>
    </pre></div></li><li class="listitem"><p>
     Update task-related data stored in the Activiti workflow engine. For
     example:
    </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "Content-Type: application/json" \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "If-Match : *" \
 --request PUT \
 --data '{"description":"Evaluate the new managed user request"}' \
 "https://localhost:8443/openidm/workflow/taskinstance/15" </strong>
    </pre></div></li><li class="listitem"><p>
     Complete the specified task. The variables required by the task are
     provided in the request body. For example:
    </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "Content-Type: application/json" \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request POST \
 --data '{"requestApproved":"true"}' \
 "https://localhost:8443/openidm/workflow/taskinstance/15?_action=complete"</strong></pre></div></li><li class="listitem"><p>
     Claim the specified task. A user who claims a task has that task inserted
     into his list of pending tasks. The ID of the user who claims the task is
     provided in the request body. For example:
    </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "Content-Type: application/json" \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request POST \
 --data '{"userId":"manager1"}' \
 "https://localhost:8443/openidm/workflow/taskinstance/15?_action=claim"</strong></pre></div></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sample-activiti-workflows"></a>16.5.&nbsp;Example Activiti Workflows With OpenIDM</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#example-activiti-email-notification-flow">16.5.1. Example Email Notification Workflow</a></span></dt><dt><span class="section"><a href="#example-provisioning-workflow">16.5.2. Sample Workflow - Provisioning User Accounts</a></span></dt></dl></div><p>
   This section describes two example workflows - an email notification
   workflow, and a workflow that demonstrates provisioning, using the
   browser-based user interface.
  </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="example-activiti-email-notification-flow"></a>16.5.1.&nbsp;Example Email Notification Workflow</h3></div></div></div><p>
    This example uses the Activiti Eclipse BPMN 2.0 Designer to set up an email
    notification business process. The example relies on an SMTP server
    listening on <code class="literal">localhost</code>, port 25.
   </p><div class="variablelist"><p>
     The example sets up a workflow that can accept parameters used to specify
     the sender and recipient of the mail.
    </p><dl class="variablelist"><dt><span class="term"><code class="literal">${fromSender}</code></span></dt><dd><p>
       Specifies the sender
      </p></dd><dt><span class="term"><code class="literal">${toEmail}</code></span></dt><dd><p>
       Specifies the recipient
      </p></dd></dl></div><p>
    Create a new BPMN2 diagram in Eclipse, then drag and drop components to
    create the workflow. This simple example uses a
    <code class="literal">StartEvent</code>, <code class="literal">MailTask</code>, and
    <code class="literal">EndEvent</code>.
   </p><div class="mediaobject" align="center"><a name="figure-bpmn-email-notification"></a><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/bpmn-email-notification.png" align="middle" height="360" alt="Email notification process"></td></tr></table><div class="longdesc-link" align="right"><br clear="all"><span class="longdesc-link">[<a href="figure-bpmn-email-notification.html" target="longdesc">D</a>]</span></div></div><p>
    When you have created the workflow definition, edit the generated XML
    source code, adding the <code class="literal">&lt;extensionElements&gt;</code> to
    the <code class="literal">&lt;serviceTask&gt;</code> tag, as follows.
   </p><pre class="brush: xml;">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;definitions
 xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL"
 xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
 xmlns:activiti="http://activiti.org/bpmn"
 xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI"
 xmlns:omgdc="http://www.omg.org/spec/DD/20100524/DC"
 xmlns:omgdi="http://www.omg.org/spec/DD/20100524/DI"
 typeLanguage="http://www.w3.org/2001/XMLSchema"
 expressionLanguage="http://www.w3.org/1999/XPath"
 targetNamespace="http://www.activiti.org/test"&gt;
 &lt;process id="EmailNotification" name="emailNotification"&gt;
   &lt;documentation&gt;Simple Email Notification Task&lt;/documentation&gt;
   &lt;startEvent id="startevent1" name="Start"&gt;&lt;/startEvent&gt;
   &lt;sequenceFlow id="flow1" name="" sourceRef="startevent1"
     targetRef="mailtask1"&gt;&lt;/sequenceFlow&gt;
   &lt;endEvent id="endevent1" name="End"&gt;&lt;/endEvent&gt;
   &lt;sequenceFlow id="flow2" name="" sourceRef="mailtask1"
     targetRef="endevent1"&gt;&lt;/sequenceFlow&gt;
   &lt;serviceTask id="mailtask1" name="Email Notification"
     activiti:type="mail"&gt;
     &lt;extensionElements&gt;
       &lt;activiti:field name="to" expression="${toEmail}"
       &gt;&lt;/activiti:field&gt;
       &lt;activiti:field name="from" expression="${fromSender}"
       &gt;&lt;/activiti:field&gt;
       &lt;activiti:field name="subject" expression="Simple Email Notification"
       &gt;&lt;/activiti:field&gt;
       &lt;activiti:field name="text"&gt;
         &lt;activiti:expression&gt;&lt;![CDATA[Here is a simple Email Notification
         from ${fromSender}.]]&gt;&lt;/activiti:expression&gt;
       &lt;/activiti:field&gt;
     &lt;/extensionElements&gt;
   &lt;/serviceTask&gt;
 &lt;/process&gt;
 &lt;bpmndi:BPMNDiagram id="BPMNDiagram_EmailNotification"&gt;
   &lt;bpmndi:BPMNPlane bpmnElement="EmailNotification"
     id="BPMNPlane_EmailNotification"&gt;
     &lt;bpmndi:BPMNShape bpmnElement="startevent1" id="BPMNShape_startevent1"&gt;
       &lt;omgdc:Bounds height="35" width="35" x="170" y="250"&gt;&lt;/omgdc:Bounds&gt;
     &lt;/bpmndi:BPMNShape&gt;
     &lt;bpmndi:BPMNShape bpmnElement="endevent1" id="BPMNShape_endevent1"&gt;
       &lt;omgdc:Bounds height="35" width="35" x="410" y="250"&gt;&lt;/omgdc:Bounds&gt;
     &lt;/bpmndi:BPMNShape&gt;
     &lt;bpmndi:BPMNShape bpmnElement="mailtask1" id="BPMNShape_mailtask1"&gt;
       &lt;omgdc:Bounds height="55" width="105" x="250" y="240"&gt;&lt;/omgdc:Bounds&gt;
     &lt;/bpmndi:BPMNShape&gt;
     &lt;bpmndi:BPMNEdge bpmnElement="flow1" id="BPMNEdge_flow1"&gt;
       &lt;omgdi:waypoint x="205" y="267"&gt;&lt;/omgdi:waypoint&gt;
       &lt;omgdi:waypoint x="250" y="267"&gt;&lt;/omgdi:waypoint&gt;
     &lt;/bpmndi:BPMNEdge&gt;
     &lt;bpmndi:BPMNEdge bpmnElement="flow2" id="BPMNEdge_flow2"&gt;
       &lt;omgdi:waypoint x="355" y="267"&gt;&lt;/omgdi:waypoint&gt;
       &lt;omgdi:waypoint x="410" y="267"&gt;&lt;/omgdi:waypoint&gt;
     &lt;/bpmndi:BPMNEdge&gt;
   &lt;/bpmndi:BPMNPlane&gt;
 &lt;/bpmndi:BPMNDiagram&gt;
&lt;/definitions&gt;</pre><p>
    Save the workflow definition as a <code class="literal">bpmn20.xml</code> file
    (<code class="filename">email-notification.bpmn20.xml</code>) in the
    <code class="filename">openidm/workflow</code> directory.
   </p><p>
    After you have deployed the workflow, create a script named
    <code class="filename">openidm/script/triggerEmailNotification.js</code>. The script
    invokes the workflow.
   </p><pre class="brush: javascript;">
/*
 * Calling 'EmailNotification' workflow
 */

var params = {
 "_key" : "EmailNotification",
 "fromSender" : "noreply@openidm",
 "toEmail" : "jdoe@example.com"
};

openidm.action('workflow/processinstance', {"_action" : "createProcessInstance"}, params);
   </pre><p>
    You can also invoke the workflow over the REST interface with the following
    REST command:
   </p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "Content-Type: application/json" \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --data '{
    "_key":"EmailNotification",
    "fromSender":"noreply@openidm",
    "toEmail":"jdoe@example.com"
 }' \
 --request POST \
 "https://localhost:8443/openidm/workflow/processinstance?_action=create"</strong></pre></div><p>
    To schedule the workflow to be invoked regularly, create a schedule
    configuration object named
    <code class="filename">openidm/conf/schedule-EmailNotification.json</code>. The
    following schedule invokes the workflow once per minute.
   </p><pre class="brush: javascript;">
{
   "enabled" : true,
   "type" : "cron",
   "schedule" : "0 0/1 * * * ?",
   "invokeService" : "script",
   "invokeContext" : {
       "script" : {
           "type" : "text/javascript",
           "file" : "script/triggerEmailNotification.js"
       },
   }
}
   </pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="example-provisioning-workflow"></a>16.5.2.&nbsp;Sample Workflow - Provisioning User Accounts</h3></div></div></div><p>
    This example, provided in <code class="filename">openidm/samples/workflow</code>,
    uses workflows to provision user accounts. The example demonstrates the use
    of the browser-based user interface to manage workflows.
   </p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="provisioning-sample-overview"></a>16.5.2.1.&nbsp;Overview of the Sample</h4></div></div></div><p>
     The sample starts with a reconciliation process that loads user accounts
     from an XML file into the managed users repository. The reconciliation
     creates two users, with UIDs <code class="literal">user1</code> and
     <code class="literal">manager1</code>. Both users have the same password
     (<code class="literal">Welcome1</code>).
    </p><p>
     The sample adds two new business roles to the configuration -
     <code class="literal">employee</code> (assigned to <code class="literal">user1</code>) and
     <code class="literal">manager</code> (assigned to <code class="literal">manager1</code>).
    </p><p>
     As part of the provisioning, employees are required to initiate a
     "Contract Onboarding" process. This process is a request to add a
     contractor to the managed users repository, with an option to include the
     contractor in the original data source (the XML file).
    </p><p>
     When the employee has completed the required form, the request is sent to
     the manager for approval. Any user with the role
     <code class="literal">"manager"</code> can claim the approval task. If the request is
     approved, the user is created in the managed users repository. If a request
     was made to add the user to the original data source (the XML file) this is
     done in a subsequent step.
    </p><p>
     The workflow uses embedded templates to build a more sophisticated input
     form.  The form is validated with the server-side policy rules, described
     in <a href="../integrators-guide/index.html#chap-policies" class="link"><em class="citetitle">Using
     Policies to Validate Data</em></a>.
    </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="provisioning-sample-running"></a>16.5.2.2.&nbsp;Running the Sample</h4></div></div></div><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
       Start OpenIDM with the configuration for the workflow sample.
      </p><div class="screen"><pre>$ cd /path/to/openidm
$ ./startup.sh -p samples/workflow</pre></div></li><li class="step"><p>
       Run reconciliation over the REST interface.
      </p><div class="screen"><pre>$ curl \
 --cacert self-signed.crt \
 --header "Content-Type: application/json" \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request POST \
 "https://localhost:8443/openidm/recon?_action=recon&amp;mapping=systemXmlfileAccounts_managedUser"</pre></div><p>
       Successful reconciliation returns an "_id" object, such as the following:
      </p><div class="screen"><pre>{"_id":"aea493f5-29ee-423d-b4b1-10449c60886c"}</pre></div><p>
       The two users are added to the repository. You can test this with the
       following REST query, which shows the two users,
       <code class="literal">manager1</code> and <code class="literal">user1</code>.
      </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/managed/user/?_queryId=query-all-ids"
      </strong>
      <em>{
  "result" : [ {
    "_id" : "manager1",
    "_rev" : "0"
  }, {
    "_id" : "user1",
    "_rev" : "0"
  } ],
  "resultCount" : 2,
  "pagedResultsCookie" : null,
  "remainingPagedResults" : -1
}</em>
      </pre></div></li><li class="step"><p>
       Log into the user interface as <code class="literal">user1</code>, with password
       <code class="literal">Welcome1</code>. For information about logging in to the user
       interface, see <a href="../integrators-guide/index.html#ui-overview" class="link"><em class="citetitle">Overview of
       the Default User Interface</em></a>.
      </p></li><li class="step"><p>
       Under "Processes" click "Contractor onboarding process".
      </p><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/ui-processes.png" align="middle" height="360" alt="User interface - processes"></td></tr></table></div></li><li class="step"><p>
       Complete the details of the new user, then click Start.
      </p><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/ui-workflow.png" align="middle" height="360" alt="Contractor onboarding process form"></td></tr></table></div></li><li class="step"><p>
       Log out of the UI.
      </p></li><li class="step"><p>
       Log into the UI as <code class="literal">manager1</code>, with password
       <code class="literal">Welcome1</code>.
      </p></li><li class="step"><p>
       Under "Tasks that are in my group's queue" click "Contractor Approval".
      </p><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/ui-contractor-approval.png" align="middle" height="360" alt="Contractor approval"></td></tr></table></div></li><li class="step"><p>
       From the drop-down list, select "Assign to me".
      </p><p>
       Note that the "Contractor Approval" task has now moved under "My tasks".
      </p></li><li class="step"><p>
       Under "My tasks" click "Contractor Approval".
      </p><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/ui-my-tasks.png" align="middle" height="360" alt="My tasks"></td></tr></table></div></li><li class="step"><p>
       Under Actions, click Details.
      </p><p>
       The form containing the details of the contractor is displayed.
      </p></li><li class="step"><p>
       At the bottom of the form, select a decision from the drop-down list
       (either "Accept" or "Reject"), then click Complete.
      </p><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/ui-workflow-complete.png" align="middle" height="360" alt="Accept new user account"></td></tr></table></div><p>
       When you Accept the new contractor details, the user account is created
       in the repository. You can check the new account by running the following
       REST command:
      </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/managed/user/?_queryId=query-all-ids"
      </strong>
      <em>
{
  "result" : [ {
    "_id" : "manager1",
    "_rev" : "0"
  }, {
    "_id" : "user1",
    "_rev" : "0"
  }, {
    "_id" : "96a9513b-7896-4d22-83cc-6b35a709f0a8",
    "_rev" : "0"
  } ],
  "resultCount" : 3,
  "pagedResultsCookie" : null,
  "remainingPagedResults" : -1
}</em></pre></div><p>
       Display the details of the new user, by running a REST query on the user
       ID, as follows:
      </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/managed/user/96a9513b-7896-4d22-83cc-6b35a709f0a8"
      </strong>
      <em>
{
  "_id" : "96a9513b-7896-4d22-83cc-6b35a709f0a8",
  "_rev" : "1",
  "startDate" : "05/13/2014",
  "manager" : "user1",
  "passwordAttempts" : "0",
  "department" : "Finance",
  "address2" : "",
  "endDate" : "06/13/2014",
  "givenName" : "John",
  "effectiveRoles" : [ "openidm-authorized" ],
  "city" : "",
  "lastPasswordSet" : "",
  "postalCode" : "",
  "description" : "Accountant",
  "accountStatus" : "active",
  "userName" : "johnb",
  "stateProvince" : "",
  "jobTitle" : "Contract Accountant",
  "mail" : "johnb@example.com",
  "sn" : "Brand",
  "provisionToXML" : "1",
  "lastPasswordAttempt" : "Tue May 13 2014 09:56:49 GMT+0200 (SAST)",
  "country" : "",
  "telephoneNumber" : "8934794578",
  "roles" : [ "openidm-authorized" ],
  "effectiveAssignments" : { },
  "postalAddress" : ""
}</em></pre></div><p>
       You can now log into the UI as the new user (with the details that you
       specified in Step 5). Under "Notifications" you will see a welcome
       message indicating the working dates of the new user. If you log in as
       <code class="literal">user1</code> you are notified of the result of the manager's
       decision.
      </p><p>
       If you specified that the new user should be added to the original data
       source, you will see that the account was added to the XML file:
      </p><div class="screen"><pre><strong>$ cd /path/to/openidm
$ cat samples/workflow/data/xmlConnectorData.xml </strong>
      <em>...
   &lt;ri:__ACCOUNT__&gt;
      &lt;icf:__DESCRIPTION__&gt;Accountant&lt;/icf:__DESCRIPTION__&gt;
      &lt;ri:roles&gt;openidm-authorized&lt;/ri:roles&gt;
      &lt;ri:mobileTelephoneNumber&gt;8934794578&lt;/ri:mobileTelephoneNumber&gt;
      &lt;ri:firstname&gt;John&lt;/ri:firstname&gt;
      &lt;ri:manager&gt;user1&lt;/ri:manager&gt;
      &lt;ri:startDate&gt;05/13/2014&lt;/ri:startDate&gt;
      &lt;ri:jobTitle&gt;Contract Accountant&lt;/ri:jobTitle&gt;
      &lt;icf:__UID__&gt;67b6bb5f-5457-4ac6-bb49-5d98f2b1f3f8&lt;/icf:__UID__&gt;
      &lt;icf:__NAME__&gt;johnb&lt;/icf:__NAME__&gt;
      &lt;ri:email&gt;johnb@example.com&lt;/ri:email&gt;
      &lt;icf:__PASSWORD__&gt;Welcome1&lt;/icf:__PASSWORD__&gt;
      &lt;ri:department&gt;Finance&lt;/ri:department&gt;
      &lt;ri:endDate&gt;06/13/2014&lt;/ri:endDate&gt;
      &lt;ri:lastname&gt;Brand&lt;/ri:lastname&gt;
   &lt;/ri:__ACCOUNT__&gt;
...   </em>
      </pre></div><p>
       If you declined the approval request, the user will not be created in
       either data source.
      </p></li></ol></div><p>
     You can see the details of the workflow definition in
     <code class="filename">samples/workflow/workflow/contractorOnboarding.bpmn20.xml</code>.
    </p></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="workflow-use-cases"></a>16.6.&nbsp;Workflow Use Cases</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#use-case-1">16.6.1. Use Case 1 - Initial Reconciliation</a></span></dt><dt><span class="section"><a href="#use-case-2">16.6.2. Use Case 2 - New User Onboarding</a></span></dt><dt><span class="section"><a href="#use-case-3">16.6.3. Use Case 3 - User Access Request</a></span></dt><dt><span class="section"><a href="#use-case-4">16.6.4. Use Case 4 - Orphan Account Detection</a></span></dt><dt><span class="section"><a href="#use-case-5">16.6.5. Use Case 5 - Certification</a></span></dt><dt><span class="section"><a href="#use-case-6">16.6.6. Use Case 6 - Password Change Reminder</a></span></dt></dl></div><p>
   This section describes a number of sample workflows, that demonstrate typical
   use cases for OpenIDM. The use cases, provided in
   <code class="filename">/path/to/openidm/samples/usecase</code>, work together to
   provide a complete business story, with the same set of sample data. Each of
   the use cases is integrated with the default UI.
  </p><p>
   The use cases can be run independently, but rely on the data set that is
   imported during use case 1 - so you <span class="emphasis"><em>must</em></span> run use case 1
   before running any of the other use cases.
  </p><p>
   The use cases assume an initial data set of twenty "ordinary" managed users
   in OpenIDM (user.0 - user.19). The users are divided as follows:
  </p><div class="informaltable"><table border="0"><colgroup><col width="25%" class="c1"><col width="25%" class="c2"><col width="12%" class="c3"><col width="25%" class="c4"><col width="13%" class="c5"></colgroup><thead><tr><th>Users</th><th>Department</th><th>Manager</th><th>Employees</th><th>Contractors</th></tr></thead><tbody><tr><td>user.0-user.4</td><td>Human Resources</td><td>user.0</td><td>user.0-user.3</td><td>user.4</td></tr><tr><td>user.5-user.9</td><td>Production Planning</td><td>user.5</td><td>user.5-user.8</td><td>user.9</td></tr><tr><td>user.10-user.14</td><td>Sales &amp; Distribution</td><td>user.10</td><td>user.10-user.13</td><td>user.14</td></tr><tr><td>user.15-user.19</td><td>Treasury &amp; Payments</td><td>user.15</td><td>user.15-user.18</td><td>user.19</td></tr></tbody></table></div><div class="itemizedlist"><p>
    In addition, the following "special" users are defined:
   </p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
     <code class="literal">hradmin</code> - represents the human interaction of the HR
     department
    </p></li><li class="listitem"><p>
     <code class="literal">systemadmin</code> - represents the human interaction of the
     populated systems (Business and Project)
    </p></li><li class="listitem"><p>
     <code class="literal">superadmin</code> - represents the manager of the managers
    </p></li></ul></div><p>
   Note that the <span class="command"><strong>curl</strong></span> commands in this section use the secure
   port for OpenIDM (8443) and assume a self-signed certificate named
   <code class="literal">self-signed.crt</code>, located in the directory from which the
   command is launched. For instructions on using the self-signed certificate
   that is generated when OpenIDM first starts up, see
   <a href="../integrators-guide/index.html#rest-over-https" class="link"><em class="citetitle">Restrict REST
   Access to the HTTPS Port</em></a>.
  </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="use-case-1"></a>16.6.1.&nbsp;Use Case 1 - Initial Reconciliation</h3></div></div></div><p>
    This use case assumes an OpenDJ server and populates the managed user
    repository with users from OpenDJ.
   </p><div class="itemizedlist"><p>
     To prepare the sample:
    </p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
      Download and install OpenDJ, as described in <a class="link" href="http://docs.forgerock.org/en/opendj/2.6.0/install-guide/index.html#chap-install-gui" target="_blank">Installing
      OpenDJ With the QuickSetup Wizard</a>.
     </p><p>
      This sample assumes that OpenDJ is listening on port 1389, the standard
      LDAP port for users who cannot use privileged ports.
     </p></li><li class="listitem"><p>
      During the install, import the user data from the LDIF file
      <code class="filename">/path/to/openidm/samples/usecase/data/hr_data.ldif</code>.
     </p></li><li class="listitem"><p>
      The use case assumes a user with DN <code class="literal">cn=Directory Manager</code>
      and password <code class="literal">password</code> who will bind to the directory
      server.
     </p></li></ul></div><p>
    The OpenDJ server now contains the users required for all the workflow use
    cases.
   </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
      Start OpenIDM with the configuration for use case 1.
     </p><div class="screen"><pre>$ cd /path/to/openidm
$ ./startup.sh -p samples/usecase/usecase1
     </pre></div></li><li class="step"><p>
      Run reconciliation to populate the managed user repository with the users
      from the OpenDJ server.
     </p><div class="screen"><pre>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 "https://localhost:8443/openidm/recon?_action=recon&amp;mapping=systemHRAccounts_managedUser"
     </pre></div></li><li class="step"><p>
      Query the managed users that were created by the reconciliation process.
     </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/managed/user?_queryId=query-all-ids"
      </strong>
      <em>{
  "result" : [ {
    "_id" : "user.5",
    "_rev" : "0"
  }, {
    "_id" : "user.10",
    "_rev" : "0"
  }, {
    "_id" : "user.1",
    "_rev" : "0"
  },
 ...
 {
    "_id" : "hradmin",
    "_rev" : "0"
  }, {
    "_id" : "systemadmin",
    "_rev" : "0"
  }, {
    "_id" : "superadmin",
    "_rev" : "0"
  } ],
  "resultCount" : 23,
  "pagedResultsCookie" : null,
  "remainingPagedResults" : -1
}</em>
     </pre></div><p>
      23 users will have been created by the reconciliation process. The default
      password of all the newly created users is <code class="literal">Passw0rd</code>.
     </p></li><li class="step"><p>
      Shut down OpenIDM before you proceed with the next use case.
     </p><div class="screen"><pre>$ cd /path/to/openidm
$ ./shutdown.sh
     </pre></div></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="use-case-2"></a>16.6.2.&nbsp;Use Case 2 - New User Onboarding</h3></div></div></div><p>
    This use case demonstrates a new user onboarding process. The process can be
    initiated by any of the users created in the previous reconciliation
    process. In this example, we use <code class="literal">user.1</code> to initiate the
    process. <code class="literal">user.1</code> captures the details of a new user, and
    then submits the new user entry for approval by the prospective manager of
    that new user.
   </p><p>
    The use case includes three separate workflows - onboarding (creation of the
    new user), sunrise (commencement of the new user work period) and sunset
    (termination of the user contract).
   </p><p>
    The use case also demonstrates email notification with the optional
    configuration of an external email service. If you want to use email
    notification, you must configure the external email service, as described in
    <a class="xref" href="#configure-email-notification" title="Procedure&nbsp;16.2.&nbsp;Configuring Email Notification">Procedure&nbsp;16.2, &#8220;Configuring Email Notification&#8221;</a>, before you start the
    workflow.
   </p><p>
    The use case works with the OpenIDM UI, accessible at the following URL by
    default: <code class="literal">https://localhost:8443/openidmui/</code>.
   </p><div class="procedure"><a name="initiate-onboarding"></a><div class="procedure-title">Procedure&nbsp;16.1.&nbsp;Initiating the Onboarding Workflow</div><ol class="procedure" type="1"><li class="step"><p>
      Start OpenIDM with the configuration for use case 2.
     </p><div class="screen"><pre>$ cd /path/to/openidm
$ ./startup.sh -p samples/usecase/usecase2
     </pre></div></li><li class="step"><p>
      Log into the UI as <code class="literal">user.1</code> with password
      <code class="literal">Passw0rd</code>.
     </p><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/login-user1.png" align="middle" height="360" alt="Log into the UI"></td></tr></table></div></li><li class="step"><p>
      In this use case, the processes associated with the new user onboarding
      workflow are visible to any user who logs into the UI.
     </p><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/processes-user1.png" align="middle" height="360" alt="Processes available to user.1"></td></tr></table></div><p>
      Click on the User Onboarding Process and complete the fields for a sample
      new user. Complete at least all mandatory fields.
     </p><p>
      <span class="emphasis"><em>Department</em></span>. Specifies one of four departments to
      which the new user will belong (Human Resources, Production Planning,
      Sales &amp; Distribution, or Treasury &amp; Payments). The value you
      select here determines the "manager" of the new user, to which the request
      will be sent for approval. (See the previous table of users for a list of
      the managers of the various departments.)
     </p><p>
      <span class="emphasis"><em>User Type</em></span>. Governs user access to specific accounts.
      If the User Type is "Employee", the new user will have access to an
      account named "Business". This access is represented as an attribute of
      the managed user entry in the OpenIDM repository, as follows:
      <code class="literal">accounts : ["Business"]</code>. If the User Type is
      "Contractor", the new user will have no accounts associated with its
      managed user representation in OpenIDM.
     </p><p>
      <span class="emphasis"><em>Send Email Notification</em></span>. Indicates whether an email
      should be sent to alert the manager of the new required approval. The
      email details used here are defined when you configure email notification,
      as described in <a class="xref" href="#configure-email-notification" title="Procedure&nbsp;16.2.&nbsp;Configuring Email Notification">Procedure&nbsp;16.2, &#8220;Configuring Email Notification&#8221;</a>. If you
      select not to send an email notification, the notification is simply added
      to the OpenIDM repository, and appears when the manager logs into the UI.
     </p></li><li class="step"><p>
      Click Start to initiate the onboarding workflow.
     </p><p>
      This action sends the new user request to the corresponding "management"
      users (the department manager, as well as the
      <code class="literal">superadmin</code> user, who is an overall manager).
     </p></li><li class="step"><p>
      Log out of the UI, and log back in as the management user of the
      department that you selected when you completed the new user form. For
      example, if you selected "Human Resources", log in as
      <code class="literal">user.0</code>, which simulates the management user for the HR
      department. All users have the password <code class="literal">Passw0rd</code>.
     </p><p>
      Notice that this user now has an Onboarding Approval task in the queue of
      tasks assigned to his group.
     </p><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/approval-task.png" align="middle" height="360" alt="Approval task in group queue"></td></tr></table></div></li><li class="step"><p>
      Click on the Onboarding Approval task and select "Assign to Me".
     </p><p>
      This action "claims" the task for <code class="literal">user.0</code>, removes it
      from the group queue, and places it in the list of pending tasks for
      <code class="literal">user.0</code>.
     </p></li><li class="step"><p>
      Click on the Onboarding Approval task under the My Tasks list and click
      Details.
     </p><p>
      The complete new user request is displayed for the manager's approval. As
      the manager, you can add any information that was missing from the
      original request.
     </p><p>
      In addition, you can specify the following information for the new user.
     </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        <span class="emphasis"><em>Start Date</em></span>. Completing this field results in the
        user being created, with a <code class="literal">"startDate"</code> added to that
        user's managed user entry. The status of the user is
        <code class="literal">inactive</code>. This field is optional, and is used by
        the task scanner to trigger the Sunrise workflow.
       </p></li><li class="listitem"><p>
        <span class="emphasis"><em>End Date</em></span>. Completing this field results in the user
        being created, with an <code class="literal">"endDate"</code> added to that user's
        managed user entry. The field is optional, and is used by the task
        scanner to trigger the Sunset workflow.
       </p></li><li class="listitem"><p>
        <span class="emphasis"><em>Manager</em></span>. Selecting "Yes" here adds a
        <code class="literal">"title"</code> property, with a value of
        <code class="literal">"manager"</code>, to the new managed user entry.
       </p></li><li class="listitem"><p>
        <span class="emphasis"><em>Decision</em></span>. Selecting "Reject" here terminates the
        workflow and sends a notification to the user who initiated the
        workflow. Selecting "Accept" creates the managed user entry in OpenIDM.
        The password of the new user is <code class="literal">Passw0rd</code>.
       </p><p>
        Two notifications are created when the request is accepted - one for the
        user who initiated the workflow, and one for the newly created user.
        The notifications are visible in the UI after login. If you selected
        email notification, one email is sent to the user defined when you
        configured email notification, as described in
        <a class="xref" href="#configure-email-notification" title="Procedure&nbsp;16.2.&nbsp;Configuring Email Notification">Procedure&nbsp;16.2, &#8220;Configuring Email Notification&#8221;</a>.
       </p></li></ul></div></li><li class="step"><p>
      At the bottom of the form, there is an option either to Requeue the
      request or to Complete it. Click Complete.
     </p><p>
      If you click Requeue here, the task is removed from the list of My Tasks
      for that user, and returned to the list of tasks pending for that group.
      The task can then be claimed by any member of that group.
     </p><p>
      When the new user request has been approved, the user is created in the
      OpenIDM repository. If you did not include a Start Date in the manager
      approval, you should now be able to log into the UI with the details of
      the new user. If you included a Start Date, you need to complete the
      sunrise workflow before the user account is active (which will enable you
      to log in as this user).
     </p></li></ol></div><div class="procedure"><a name="configure-email-notification"></a><div class="procedure-title">Procedure&nbsp;16.2.&nbsp;Configuring Email Notification</div><p>
     This step is optional, and required only if you want to use email
     notification with this workflow.
    </p><ol class="procedure" type="1"><li class="step"><p>
      Edit the settings in the file
      <code class="filename">/path/to/openidm/samples/usecase/usecase2/conf/external.email.json</code>
      to match the settings of your mail server. For example:
     </p><div class="screen"><pre><strong>$ cd /path/to/openidm
$ more samples/usecase/usecase2/conf/external.email.json
     </strong>
     <em>{
        "host" : "smtp.gmail.com",
        "port" : "587",
        "username" : "my-username"
        "password" : "my-password",
        "mail.smtp.auth" : "true",
        "mail.smtp.starttls.enable" : "true"
}</em></pre></div></li><li class="step"><p>
      Change the notification email parameters in the workflow definition file
      (<code class="filename">samples/usecase/usecase2/workflow/newUserCreate.bpmn20.xml</code>).
     </p><p>
      The email parameters are towards the end of this file:
     </p><div class="screen"><pre><strong>$ cd /path/to/openidm/samples/usecase/usecase2/workflow/newUserCreate.bpmn20.xml
$ grep emailParams newUserCreate.bpmn20.xml</strong>
     <em>
emailParams = [from : 'usecasetest@forgerock.com', to : 'notification@example.com',
openidm.action("external/email", 'sendEmail',  emailParams);
emailParams.body = 'Welcome! Your work days are from ' + startDate + ' to ' + endDate;
openidm.action("external/email", 'sendEmail', emailParams);
emailParams = [from : 'usecasetest@forgerock.com', to : 'notification@example.com',
openidm.action("external/email", 'sendEmail', emailParams);</em>
     </pre></div><p>
      Change the <code class="literal">from</code> and <code class="literal">to</code> parameters
      to reflect valid email addresses.
     </p></li></ol></div><div class="procedure"><a name="initiate-sunrise"></a><div class="procedure-title">Procedure&nbsp;16.3.&nbsp;Initiating the Sunrise Workflow</div><p>
     If a sunrise date is specified for the new user, the user is created in
     the repository, with an <code class="literal">inactive</code> account status.
    </p><ul class="procedure"><li class="step"><p>
      To trigger the sunrise workflow (which activates the account), enable the
      sunrise task scanning schedule. The schedule is disabled by default.
     </p><p>
      Modify the schedule configuration file
      (<code class="filename">samples/usecase/usecase2/conf/schedule-taskscan_sunrise.json</code>),
      setting the <code class="literal">"enabled"</code> property to <code class="literal">true</code>.
     </p><div class="screen"><pre><strong>$ cd /path/to/openidm
$ grep "enabled" samples/usecase/usecase2/conf/schedule-taskscan_sunrise.json</strong>
<em>"enabled" : true,</em></pre></div><p>
      The scan runs every minute, and checks the repository for users that have
      a sunrise date that is anything up to one day after the current date.
      When the scan is triggered, it locates the newly created user and starts
      the sunrise workflow on this user. The workflow takes the following
      actions:
     </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        Changes the account status of the user to <code class="literal">active</code>.
       </p></li><li class="listitem"><p>
        Generates a notification for the new user, which is visible when the
        user logs into the UI.
       </p></li></ul></div><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/workflow-notifications.png" align="middle" height="360" alt="Notifications for newly activated user"></td></tr></table></div></li></ul></div><div class="procedure"><a name="initiate-sunset"></a><div class="procedure-title">Procedure&nbsp;16.4.&nbsp;Initiating the Sunset Workflow</div><p>
     If a sunset date is set for the new user, you can trigger the sunset
     workflow to deactivate the user account when the end of his work period is
     reached.
    </p><ol class="procedure" type="1"><li class="step"><p>
      To trigger the sunset workflow, enable the sunset task scanning schedule.
      The schedule is disabled by default.
     </p><p>
      Modify the schedule configuration file
      (<code class="filename">samples/usecase/usecase2/conf/schedule-taskscan_sunset.json</code>),
      setting the <code class="literal">"enabled"</code> property to <code class="literal">true</code>.
     </p><div class="screen"><pre><strong>$ cd /path/to/openidm
$ grep "enabled" samples/usecase/usecase2/conf/schedule-taskscan_sunset.json
     </strong>
<em>"enabled" : true,</em></pre></div><p>
      The scan runs every minute, and checks the repository for users that have
      a sunset date that is anything up to one day after the current date.
      When the scan is triggered, it locates users whose contracts are about to
      end, and starts the sunset workflow on these users. When the workflow is
      initiated, it assigns a task to the manager of the affected user. In this
      example, the task is assigned to <code class="literal">user.0</code>.
       </p></li><li class="step"><p>
      When the sunset schedule has been enabled, log into OpenIDM UI as
      <code class="literal">user.0</code> (with password <code class="literal">Passw0rd</code>). If
      the user's sunset date is within one day of the current date, a "Contract
      Termination" task becomes available under the 'My tasks' section for the
      manager of that user.
     </p><p>
      Select the contract termination task and click Details.
     </p></li><li class="step"><p>
      In the Decision field, select either "Accept termination" or
      "Modify date", then click Complete.
     </p><p>
      When you accept the termination, the user's account status is set to
      <code class="literal">inactive</code> and the HR administrative user receives a
      notification to that effect, next time that user logs into the UI. The
      deactivated user is no longer able to log into the UI.
     </p><p>
      If you select to modify the date, the sunset date of that user is changed
      to the value that you specify in the End Date field on that form. The
      management user receives a UI notification that the employee's contract
      has been extended.
     </p></li><li class="step"><p>
      Shut down OpenIDM before you proceed with the next use case.
     </p><div class="screen"><pre>$ cd /path/to/openidm
$ ./shutdown.sh
     </pre></div></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="use-case-3"></a>16.6.3.&nbsp;Use Case 3 - User Access Request</h3></div></div></div><p>
    This use case simulates a user access request, with two levels of approval
    for the request.
   </p><p>
    If you want to use email notification with this workflow, follow the
    instructions in <a class="xref" href="#configure-email-notification" title="Procedure&nbsp;16.2.&nbsp;Configuring Email Notification">Procedure&nbsp;16.2, &#8220;Configuring Email Notification&#8221;</a> before you
    start the workflow, substituting
    <code class="filename">usecase3/conf/external.email.json</code> and
    <code class="filename">usecase3/workflow/accessRequest.bpmn20.xml</code> for the
    files described in that procedure.
   </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
      Start OpenIDM with the configuration for use case 3.
     </p><div class="screen"><pre>$ cd /path/to/openidm
$ ./startup.sh -p samples/usecase/usecase3
     </pre></div></li><li class="step"><p>
      Log into the UI as <code class="literal">user.1</code> with password
      <code class="literal">Passw0rd</code>.
     </p><p>
      <code class="literal">user.1</code> belongs to the HR department and, in this
      workflow, is requesting access to a Project system.
     </p></li><li class="step"><p>
      Click on the Access Request Process in the list of available processes and
      click Start to start the workflow.
     </p><p>
      A User Access Request appears in the list of tasks for
      <code class="literal">user.1</code>.
     </p></li><li class="step"><p>
      Select the User Access Request task and click Details.
     </p><p>
      The resulting form indicates the various systems to which the user may
      request access.
     </p><p>
      <span class="emphasis"><em>Access to Business system</em></span>. This field reflects the
      current value of the <code class="literal">"accounts"</code> property for that user
      in the repository. If the value includes <code class="literal">"Business"</code>
      this field is True.
     </p><p>
      <span class="emphasis"><em>Access to Project system</em></span>. Set this field to True to
      request Project access for <code class="literal">user.1</code>.
     </p><p>
      <span class="emphasis"><em>Send Email Notification</em></span>. Indicates whether an email
      should be sent to alert the manager of the new access request. The
      email details used here are defined when you configure email notification,
      as described in <a class="xref" href="#configure-email-notification" title="Procedure&nbsp;16.2.&nbsp;Configuring Email Notification">Procedure&nbsp;16.2, &#8220;Configuring Email Notification&#8221;</a>. If you
      select not to send an email notification, the notification is simply added
      to the OpenIDM repository, and appears when the manager logs into the UI.
     </p><p>
      Select either Cancel, to terminate the process, or Request, to start a
      user task, assigned to the manager of the user requesting access
      (<code class="literal">user.0</code> in this example).
     </p></li><li class="step"><p>
      Log out of the UI and log back in as the manager (<code class="literal">user.0</code>
      with password <code class="literal">Passw0rd</code>).
     </p></li><li class="step"><p>
      Under "Tasks that are in my group's queue" click "User Access Request
      Approval" and select "Assign to me".
     </p><p>
      Note that the "User Access Request Approval" task has now moved under
      "My tasks".
     </p></li><li class="step"><p>
      Under "My tasks" click "User Access Request Approval" and click Details.
     </p></li><li class="step"><p>
      The details of the access request are displayed. The manager is able to
      modify the access rights. Select Accept or Reject to approve or deny the
      request.
     </p><p>
      Rejecting the request results in a notification being sent to the user
      who made the request. If you have enabled email notification, a single
      email is sent to the account defined when you configure email notification,
      as described in <a class="xref" href="#configure-email-notification" title="Procedure&nbsp;16.2.&nbsp;Configuring Email Notification">Procedure&nbsp;16.2, &#8220;Configuring Email Notification&#8221;</a>.
     </p><p>
      Accepting the request initiates a second approval task, assigned to the
      <code class="literal">systemadmin</code> user.
     </p><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/ui-access-request.png" align="middle" height="360" alt="Accepting an access request"></td></tr></table></div><p>
      Click Complete to complete the task.
     </p></li><li class="step"><p>
      Log out of the UI and log in as the <code class="literal">systemadmin</code> user
      (with password <code class="literal">Passw0rd</code>).
     </p><p>
      This user now has one User Access Request Approval task in his queue.
     </p></li><li class="step"><p>
      Select the task and click Details.
     </p><p>
      This task interface is similar to that of the task that was assigned to
      the manager.
     </p><p>
      Rejecting the request results in a notification being sent to the user
      who made the request.
     </p><p>
      Accepting the request updates the managed/user record in OpenIDM, to
      reflect the approved access changes.
     </p><p>
      If you have enabled email notification, a single email is sent to the
      account defined when you configured the external email service
      (<a class="xref" href="#configure-email-notification" title="Procedure&nbsp;16.2.&nbsp;Configuring Email Notification">Procedure&nbsp;16.2, &#8220;Configuring Email Notification&#8221;</a>), indicating whether the
      request has been accepted or rejected.
     </p></li></ol></div><p>
    Note that this sample includes an <span class="emphasis"><em>escalation</em></span> step that
    is attached to the manager approval task. If the manager does not complete
    assessment of the user task within ten minutes of its initiation, a new user
    task is created and assigned to the <code class="literal">superadmin</code> user. This
    task has the same interface and functionality as the task assigned to the
    manager. Accordingly, when the <code class="literal">superadmin</code> user completes
    the task, the execution is passed to the <code class="literal">systemadmin</code> user
    for approval.
   </p><p>
    Shut down OpenIDM before you proceed with the next use case.
   </p><div class="screen"><pre>$ cd /path/to/openidm
$ ./shutdown.sh</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="use-case-4"></a>16.6.4.&nbsp;Use Case 4 - Orphan Account Detection</h3></div></div></div><p>
    This use case demonstrates two asynchronous tasks, started from a
    reconciliation process:
   </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
      Detecting orphan accounts on a target object set
     </p></li><li class="listitem"><p>
      Handling ambiguous results during correlation
     </p></li></ul></div><p>
    This use case relies on a customized synchronization configuration (mapping)
    file, named <code class="filename">syncManagedBusiness.json</code>, in the
    <code class="filename">/path/to/openidm/samples/usecase/usecase4/conf</code>
    directory.
   </p><p>
    This file defines a mapping (<code class="literal">recon_managedUser_systemBusiness</code>)
    between a source (managed users) and a target object set. The target object
    set is defined in the file
    <code class="literal">samples/usecase/usecase4/data/business.csv</code>. The
    <code class="filename">business.csv</code> file includes all users from the initial
    reconciliation (described in <a class="xref" href="#use-case-1" title="16.6.1.&nbsp;Use Case 1 - Initial Reconciliation">Section&nbsp;16.6.1, &#8220;Use Case 1 - Initial Reconciliation&#8221;</a>). These users are
    categorized as <code class="literal">employees</code>, and therefore include the
    property <code class="literal">"accounts" : ["Business"]</code> in their managed user
    entry     (see <a class="xref" href="#use-case-2" title="16.6.2.&nbsp;Use Case 2 - New User Onboarding">Section&nbsp;16.6.2, &#8220;Use Case 2 - New User Onboarding&#8221;</a> for an explanation of the User
    Type).
   </p><p>
    The mapping includes the following <code class="literal">"validSource"</code> field:
   </p><pre class="brush: plain;">"validSource" : {
    "type" : "text/javascript",
    "file" : "script/isSourceValidBusiness.js"
}, </pre><p>
    This field references a script which specifies that only those users who
    are employees are taken into account during the reconciliation.
   </p><p>
    In addition, the <code class="literal">business.csv</code> file includes the following
    users:
   </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
      <code class="literal">user.50</code>. This user is defined <span class="emphasis"><em>only</em></span>
      in the .csv file, and not in the managed/user repository. When a
      reconciliation operation is run, this user is detected as an
      <span class="emphasis"><em>orphan account</em></span>. The orphan account workflow is
      triggered when an "UNQUALIFIED" or "UNASSIGNED" situation is encountered,
      as indicated in this section of the mapping:
     </p><pre class="brush: plain;">{
    "situation" : "UNQUALIFIED",
    "action" : {
        "workflowName" : "orphanAccountReport",
        "type" : "text/javascript",
        "file" : "workflow/triggerWorkflowFromSync.js"
    }
},
{
    "situation" : "UNASSIGNED",
    "action" : {
        "workflowName" : "orphanAccountReport",
        "type" : "text/javascript",
        "file" : "workflow/triggerWorkflowFromSync.js"
    }
}</pre></li><li class="listitem"><p>
      <code class="literal">user.33</code>. This user has a <code class="literal">"userName"</code>
      attribute of <code class="literal">"user.3"</code> (which is the same as the
      <code class="literal">"userName"</code> attribute of the user,
      <code class="literal">user.3</code>). The correlation query of the reconciliation
      operation is based on the <code class="literal">"userName"</code> attribute. During
      the correlation query, two candidate users are therefore correlated with
      the same managed user (<code class="literal">user.3</code>), and the result is
      ambiguous. The manual match workflow is triggered when an "AMBIGUOUS"
      situation is encountered, as indicated in this section of the mapping:
     </p><pre class="brush: plain;">{
    "situation" : "AMBIGUOUS",
    "action" : {
        "workflowName" : "manualMatch",
        "type" : "text/javascript",
        "file" : "workflow/triggerWorkflowFromSync.js"
    }
}</pre></li></ul></div><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
      Before you start with this use case, rename the mapping file to
      <code class="filename">sync.json</code>.
     </p><div class="screen"><pre>$ cd /path/to/openidm/samples/usecase/usecase4/conf
$ mv syncManagedBusiness.json sync.json</pre></div></li><li class="step"><p>
      Start OpenIDM with the configuration for use case 4.
     </p><div class="screen"><pre>$ cd /path/to/openidm
$ ./startup.sh -p samples/usecase/usecase4
     </pre></div><p>
      You will see a warning in the Felix console about a password not being
      defined in the CSV file (<code class="literal">WARN Password attribute is not defined.
      [CSVFileConfiguration]</code>). You can ignore this warning.
     </p></li><li class="step"><p>
      Run a reconciliation operation, according to the mapping defined in
      <code class="filename">sync.json</code>.
     </p><div class="screen"><pre>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 "https://localhost:8443/openidm/recon?_action=recon&amp;mapping=recon_managedUser_systemBusiness"</pre></div><p>
      When the reconciliation operation finds the ambiguous entry
      (<code class="literal">user.3</code>) and the orphan entry (<code class="literal">user.50</code>)
      in the CSV file, two asynchronous workflows are launched
      (<code class="literal">manualMatch</code> and <code class="literal">orphanAccountReport</code>),
      as indicated in the mapping file, described previously.
     </p></li><li class="step"><p>
      Log into the UI as the <code class="literal">systemadmin</code> user, with password
      <code class="literal">Passw0rd</code>.
     </p></li><li class="step"><p>
      Select the Manual Linking task from the My tasks list and click Details.
     </p><p>
      The <span class="emphasis"><em>Possible targets</em></span> field presents a list of target
      entries to which the ambiguous record can be linked. In this example,
      <code class="literal">user.3 - Atrc, Aaron</code> and
      <code class="literal">user.33 - Atrc, Aaron</code> are the two candidate users found
      in the target object set by the correlation query. When you select one of
      these values, the workflow manually links the managed user
      (<code class="literal">user.3</code>) to the selected user.
     </p><p>
      If you select Ignore, here, no action is taken (no link is created), and
      the workflow terminates.
     </p></li><li class="step"><p>
      Select the Orphan Account task from the My tasks list and click Details.
     </p><p>
      The <span class="emphasis"><em>Link to</em></span> field enables you to enter an existing
      managed user ID to which this orphan account should be linked. For the
      purposes of this example, enter <code class="literal">user.5</code>.
     </p><p>
      The <span class="emphasis"><em>Delete</em></span> option deletes the user from the target
      object set (the CSV file in this case) and terminates the workflow.
     </p></li><li class="step"><p>
      Shut down OpenIDM before you proceed with the next use case.
     </p><div class="screen"><pre>$ cd /path/to/openidm
$ ./shutdown.sh</pre></div></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="use-case-5"></a>16.6.5.&nbsp;Use Case 5 - Certification</h3></div></div></div><p>
    This use case demonstrates a scheduled task that retrieves all managed users
    and starts a certification workflow for each one.
   </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
      Start OpenIDM with the configuration for use case 5.
     </p><div class="screen"><pre>$ cd /path/to/openidm
$ ./startup.sh -p samples/usecase/usecase5</pre></div></li><li class="step"><p>
      To start the scheduled task, enable the schedule in
      <code class="filename">schedule-certification.json</code>.
     </p><div class="screen"><pre>$ cd /path/to/openidm
$ more samples/usecase/usecase5/conf/schedule-certification.json
{
    "enabled" : true,
...  </pre></div></li><li class="step"><p>
      Log into the UI as <code class="literal">user.0</code> with password
      <code class="literal">Passw0rd</code>.
     </p><p>
      <code class="literal">user.0</code> represents the manager of the users who are
      being certified.
     </p></li><li class="step"><p>
      Under "Tasks that are in my group's queue" click "Certification Process"
      and select "Assign to me".
     </p><p>
      The "Certification Process" task moves under "My tasks".
     </p></li><li class="step"><p>
      Under "My tasks" click "Certification Process" and click Details.
     </p></li><li class="step"><p>
      On the "Access Status Check" task, click Details.
     </p><p>
      The <span class="emphasis"><em>Access to Business system</em></span> and <span class="emphasis"><em>Access to
      Project system</em></span> fields reflect the values of the
      <code class="literal">"accounts"</code> property of the managed user that is being
      certified. These values can be changed on this form, which changes the
      corresponding values in the managed user object.
     </p></li><li class="step"><p>
      Select a Decision.
     </p><p>
      If you select <span class="emphasis"><em>Certify</em></span>, no action
      is taken, the certified user is not modified and the workflow terminates.
     </p><p>
      Selecting <span class="emphasis"><em>Change</em></span> results in a new user task being
      created, and assigned to the <code class="literal">systemadmin</code> user.
     </p><p>
      Click Complete after you have selected one of the previous options.
     </p></li><li class="step"><p>
      If you selected <span class="emphasis"><em>Change</em></span> in the previous step, log in
      to the UI as the <code class="literal">systemadmin</code> user with password
      <code class="literal">Passw0rd</code>.
     </p></li><li class="step"><p>
      Select the Access Status Check task and click Details.
     </p><p>
      The <span class="emphasis"><em>Access to Business system</em></span> and
      <span class="emphasis"><em>Access to Project system</em></span> fields can be modified on
      this form, if required.
     </p></li><li class="step"><p>
      Select a Decision.
     </p><p>
      If you select <span class="emphasis"><em>Accept</em></span>, the managed user object of the
      user being certified is updated with values of the access fields on this
      form. A notification regarding the change is sent to the affected user,
      visible in the UI when the user next logs in.
     </p><p>
      If you select <span class="emphasis"><em>Reject</em></span>, the managed user object of the
      user is not changed. A notification is sent to the manager of the user,
      indicating that the certification change request has been rejected by
      the <code class="literal">systemadmin</code> user.
     </p><p>
      Click Complete after you have selected one of the previous options.
     </p></li><li class="step"><p>
      Shut down OpenIDM before you proceed with the next use case.
     </p><div class="screen"><pre>$ cd /path/to/openidm
$ ./shutdown.sh</pre></div></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="use-case-6"></a>16.6.6.&nbsp;Use Case 6 - Password Change Reminder</h3></div></div></div><p>
    This use case demonstrates using the task scanner to trigger a password
    change reminder workflow for managed users.
   </p><p>
    In this example, each managed user entry in OpenIDM has a dedicated
    attribute, <code class="literal">lastPasswordSet</code>, that stores the date on which
    the password was last changed. The value of this attribute is updated by an
    <code class="literal">onStore</code> script, defined in the managed user configuration
    file (<code class="filename">conf/managed.json</code>), as follows:
   </p><pre class="brush: plain;">
"onStore" : {
    "type" : "text/javascript",
    "file" : "script/onStoreManagedUser.js"
},
   </pre><p>
    When a new password is stored for a user, the script sets the date on which
    this change was made. The task scanner periodically scans the
    <code class="literal">lastPasswordSet</code> attribute, and starts the workflow if the
    password was changed more than an hour ago. This condition is configured in
    the schedule configuration file
    (<code class="filename">schedule-taskscan_passwordchange.json</code>):
   </p><div class="screen"><pre><strong>$ cd /path/to/openidm
$ more samples/usecase/usecase6/conf/schedule-taskscan_passwordchange.json</strong>
<em>
...
"condition" : {
    "before" : "${Time.now - 1h}"
},
....</em>
   </pre></div><p>
    Obviously, in a real deployment, the period between required password
    changes would be longer, and this value would need to be set accordingly.
    For the purposes of testing this use case, you might want to set the value
    to a shorter period, such as <code class="literal">"${Time.now - 1m}"</code>, which
    will send the notification one minute after a password change.
   </p><p>
    By default, the workflow sends notifications to the user entry, visible when
    the user logs into the UI. If you want notifications sent by email,
    configure the external email service, as follows:
   </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
      Edit the settings in the file
      <code class="filename">/path/to/openidm/samples/usecase/usecase6/conf/external.email.json</code>
      to match the settings of your mail server. For example:
     </p><div class="screen"><pre><strong>$ cd /path/to/openidm
$ more samples/usecase/usecase6/conf/external.email.json</strong>
<em>
{
        "host" : "smtp.gmail.com",
        "port" : "587",
        "username" : "my-username"
        "password" : "my-password",
        "mail.smtp.auth" : "true",
        "mail.smtp.starttls.enable" : "true"
}</em>
     </pre></div></li><li class="step"><p>
      Enable email notification in the script file that starts the workflow
      (<code class="filename">samples/usecase/usecase6/script/passwordchange.js</code>).
      For example:
     </p><div class="screen"><pre><strong>$ cd /path/to/openidm
$ more samples/usecase/usecase6/script/passwordchange.js</strong>
<em>
/*global  objectID*/

(function () {
    var params = {
 "userId" : objectID,
 "emailEnabled" : "true",
 "_key": "passwordChangeReminder"
};</em>
     </pre></div></li><li class="step"><p>
      Make sure that all users have a valid email address as the value of their
      <code class="literal">mail</code> attribute, in the OpenIDM repository.
     </p></li></ol></div><p>
    The task scanning schedule is disabled by default. To test this use case,
    follow these steps:
   </p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>
      Enable the task scanning schedule by setting <code class="literal">enabled</code> to
      <code class="literal">true</code> in the schedule configuration file
      (<code class="filename">schedule-taskscan_passwordchange.json</code>).
     </p><div class="screen"><pre><strong>$ cd /path/to/openidm
$ more samples/usecase/usecase6/conf/schedule-taskscan_passwordchange.json</strong>
      <em>
{
    "enabled" : true,
...
      </em>
     </pre></div></li><li class="step"><p>Start OpenIDM with the configuration for use case 6.
     </p><div class="screen"><pre>$ cd /path/to/openidm
$ ./startup.sh -p samples/usecase/usecase6</pre></div><p>
     </p></li><li class="step"><p>
      Log into the UI as any of the users listed in the introduction to this
      section (for example, <code class="literal">user.4</code>, with password
      <code class="literal">Passw0rd</code>).
     </p><p>
      The user sees the following notification upon login:
     </p><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/pwd-expiry.png" align="middle" height="360" alt="Password expiry notification"></td></tr></table></div><p>
      If the password has not been changed after five minutes, a second
      notification is sent to the user.
     </p><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/pwd-expiry2.png" align="middle" height="360" alt="Second password expiry notification"></td></tr></table></div><p>
      If the password has not been changed two minutes after this second
      notification, the user's account is deactivated and that user is no longer
      able to log into the UI.
     </p></li><li class="step"><p>
      To avoid the second notification, or the account deactivation, you can
      change the user password through the UI, as follows:
     </p><ol type="a" class="substeps"><li class="step"><p>
        Log into the UI as the user whose password you want to change and click
        Change Security Data at the top right of the page.
       </p></li><li class="step"><p>
        Enter the existing password (in this case <code class="literal">Passw0rd</code>).
       </p></li><li class="step"><p>
        Enter a new password that conforms to the requirements of the password
        policy.
       </p></li></ol></li></ol></div></div></div></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-auditing"></a>Chapter&nbsp;17.&nbsp;Using Audit Logs</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="section"><a href="#audit-log-types">17.1. Audit Log Types</a></span></dt><dt><span class="section"><a href="#audit-log-format">17.2. Audit Log File Formats</a></span></dt><dt><span class="section"><a href="#audit-configuration">17.3. Audit Configuration</a></span></dt><dt><span class="section"><a href="#audit-reports">17.4. Generating Reports</a></span></dt></dl></div><a class="indexterm" name="d505e16744"></a><p>OpenIDM auditing can publish and log all relevant system activity to
 the targets you specify. Auditing can include data from reconciliation as
 a basis for reporting, access details, and activity logs that capture
 operations on internal (managed) objects and external (system) objects.
 Auditing provides the data for all the relevant reports, including orphan
 account reports.</p><p>The auditing interface allows you to push auditing data to files and
 to the OpenIDM repository.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="audit-log-types"></a>17.1.&nbsp;Audit Log Types</h2></div></div></div><div class="variablelist"><p>This section describes the types of audit log OpenIDM provides.</p><dl class="variablelist"><dt><span class="term">Access Log</span></dt><dd><p>OpenIDM writes messages concerning access to the REST API in this
     log.</p><p>Default file: <code class="filename">openidm/audit/access.csv</code></p></dd><dt><span class="term">Activity Log</span></dt><dd><p>OpenIDM logs operations on internal (managed) and external (system)
     objects to this log type.</p><p>
      Entries in the activity log contain identifiers, both for the action that
      triggered the activity, and also for the original caller and the
      relationships between related actions.
     </p><p>Default file: <code class="filename">openidm/audit/activity.csv</code></p></dd><dt><span class="term">Reconciliation Log</span></dt><dd><p>OpenIDM logs the results of a reconciliation run, including
     situations and the resulting actions taken to this log type. The activity
     log contains details about the actions, where log entries display parent
     activity identifiers,
     <code class="literal">recon/<em class="replaceable"><code>reconID</code></em></code>.</p><p>Default file: <code class="filename">openidm/audit/recon.csv</code></p></dd></dl></div><p>Where an action happens related to a higher level business
  function, the log entry points to a parent activity for that function.
  The relationships are hierarchical. For example, a synchronization operation
  could result from scheduled reconciliation for an object type. OpenIDM also
  logs the top level root activity with each entry, making it possible to
  query related activities.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="audit-log-format"></a>17.2.&nbsp;Audit Log File Formats</h2></div></div></div><p>This section describes the audit log file formats to help you map
  these to the reports you generate.</p><div class="variablelist"><a name="audit-access-fields"></a><div class="variablelist-title">Access Log Fields</div><p>
    The access log includes the following information:
   </p><dl class="variablelist"><dt><span class="term"><code class="literal">"_id"</code></span></dt><dd><p>
      UUID for the message object, such as
      <code class="literal">"0419d364-1b3d-4e4f-b769-555c3ca098b0"</code>
     </p></dd><dt><span class="term"><code class="literal">"action"</code></span></dt><dd><p>
      Action requested, such as <code class="literal">"authenticate"</code>
     </p></dd><dt><span class="term"><code class="literal">"ip"</code></span></dt><dd><p>
      IP address of the client. For access from the local host, this can appear
      for example as <code class="literal">"0:0:0:0:0:0:0:1%0"</code>.
     </p></dd><dt><span class="term"><code class="literal">"principal"</code></span></dt><dd><p>
      Principal (username) requesting the operation, such as
      <code class="literal">"openidm-admin"</code>
     </p></dd><dt><span class="term"><code class="literal">"roles"</code></span></dt><dd><p>
      Roles associated with the principal, such as
      <code class="literal">"[openidm-admin, openidm-authorized]"</code>
     </p></dd><dt><span class="term"><code class="literal">"status"</code></span></dt><dd><p>
      Result of the operation, such as <code class="literal">"SUCCESS"</code>
     </p></dd><dt><span class="term"><code class="literal">"timestamp"</code></span></dt><dd><p>
      The time that OpenIDM logged the message, in UTC format, for example
      <code class="literal">"2012-11-18T08:48:00.160Z"</code>
     </p></dd><dt><span class="term"><code class="literal">"userid"</code></span></dt><dd><p>
      The ID (<code class="literal">_id</code>) of the user requesting the operation, such
      as <code class="literal">openidm-admin</code>, <code class="literal">jdoe</code> or a UUID
      that has been generated by the server, such as
      <code class="literal">"0d7532e2-2b45-420e-b10e-c35684c633fd"</code>.
     </p></dd></dl></div><div class="variablelist"><a name="audit-activity-fields"></a><div class="variablelist-title">Activity Log Fields</div><p>
    The activity log includes the following information for each entry:
   </p><dl class="variablelist"><dt><span class="term"><code class="literal">"_id"</code></span></dt><dd><p>
      UUID for the message object, such as
      <code class="literal">"0419d364-1b3d-4e4f-b769-555c3ca098b0"</code>
     </p></dd><dt><span class="term"><code class="literal">"action"</code></span></dt><dd><p>
      Action performed on that entry, such as <code class="literal">"create"</code>. See
      the section on <a href="../integrators-guide/index.html#audit-eventtypes" class="link"><em class="citetitle">Event
      Types</em></a> for a list of possible actions.</p></dd><dt><span class="term"><code class="literal">"activityId"</code></span></dt><dd><p>
      UUID for the activity corresponding to the UUID of the resource context
     </p></dd><dt><span class="term"><code class="literal">"after"</code></span></dt><dd><p>
      JSON representation of the object resulting from the activity
     </p></dd><dt><span class="term"><code class="literal">"before"</code></span></dt><dd><p>
      JSON representation of the object prior to the activity
     </p></dd><dt><span class="term"><code class="literal">"changedFields"</code></span></dt><dd><p>
      List of the fields that were changed as a result of the activity. This
      list takes into consideration only those fields that have been configured
      as <code class="literal">"watchedFields"</code> in the
      <code class="filename">conf/audit.json</code> file.
     </p></dd><dt><span class="term"><code class="literal">"message"</code></span></dt><dd><p>
      Human readable text about the activity
     </p></dd><dt><span class="term"><code class="literal">"objectId"</code></span></dt><dd><p>
      Object identifier, such as <code class="literal">"managed/user/jdoe"</code> or
      <code class="literal">"managed/user/38e29216-4b0e-4701-8a6f-ed8bf69692c7"</code>.
     </p></dd><dt><span class="term"><code class="literal">"parentActionId"</code></span></dt><dd><p>
      UUID of the action leading to the activity
     </p></dd><dt><span class="term"><code class="literal">"passwordChanged"</code></span></dt><dd><p>
      Boolean (<code class="literal">true</code> or <code class="literal">false</code>) indicating
      whether the action resulted in a password change.
     </p></dd><dt><span class="term"><code class="literal">"requester"</code></span></dt><dd><p>
      Principal requesting the operation
     </p></dd><dt><span class="term"><code class="literal">"rev"</code></span></dt><dd><p>Object revision number</p></dd><dt><span class="term"><code class="literal">"rootActionId"</code></span></dt><dd><p>UUID of the root cause for the activity. This matches a
     corresponding <code class="literal">"rootActionId"</code> in a reconciliation
     message.</p></dd><dt><span class="term"><code class="literal">"status"</code></span></dt><dd><p>Result of the operation, such as <code class="literal">"SUCCESS"</code></p></dd><dt><span class="term"><code class="literal">"timestamp"</code></span></dt><dd><p>Time when OpenIDM logged the message, in UTC format, for example 
     <code class="literal">"2012-11-18T08:48:00.160Z"</code></p></dd></dl></div><div class="variablelist"><a name="audit-recon-fields"></a><div class="variablelist-title">Reconciliation Log Fields</div><p>Reconciliation messages include the following information:</p><dl class="variablelist"><dt><span class="term"><code class="literal">"_id"</code></span></dt><dd><p>
      UUID for the message object, such as
      <code class="literal">"0419d364-1b3d-4e4f-b769-555c3ca098b0"</code>
     </p></dd><dt><span class="term"><code class="literal">"action"</code></span></dt><dd><p>
      Synchronization action, such as <code class="literal">"CREATE"</code>. See the
      section on <a href="../integrators-guide/index.html#sync-actions" class="link"><em class="citetitle">Actions</em></a>
      for a list of possible actions.
     </p></dd><dt><span class="term"><code class="literal">"actionID"</code></span></dt><dd><p>
      The unique ID assigned to the action.
     </p></dd><dt><span class="term"><code class="literal">"ambiguousTargetObjectIds"</code></span></dt><dd><p>
      When the situation is AMBIGUOUS or UNQUALIFIED and OpenIDM cannot
      distinguish between more than one target object, OpenIDM logs the
      identifiers of the objects in this field in comma-separated format. This
      makes it possible to figure out what was ambiguous afterwards.
     </p></dd><dt><span class="term"><code class="literal">"entryType"</code></span></dt><dd><p>
      The type of reconciliation log entry, such as <code class="literal">"start"</code>,
      or <code class="literal">"summary"</code>.
     </p></dd><dt><span class="term"><code class="literal">"exception"</code></span></dt><dd><p>
      The stack trace of the exception, if any.
     </p></dd><dt><span class="term"><code class="literal">"mapping"</code></span></dt><dd><p>
      The name of the mapping used for the reconciliation (defined in
      <code class="filename">conf/sync.json</code>, for example
      <code class="literal">"systemLdapAccounts_managedUser"</code>.
     </p></dd><dt><span class="term"><code class="literal">"message"</code></span></dt><dd><p>
      Human readable text about the reconciliation action that was taken.
     </p></dd><dt><span class="term"><code class="literal">"messageDetail"</code></span></dt><dd><p>
      For the <code class="literal">"summary"</code> entry type, this field contains
      details about that specific stage of the reconciliation run, such as the
      stage name and description, start and end time, and so forth.
     </p><p>
      When script exceptions are encountered during a reconciliation run,
      the error details can also be stored in this property.
     </p><p>
      For script exception details to be pulled in, the script exception must
      take the following format:
     </p><pre class="brush: plain;">
"throw {
    'openidmCode' : HTTP error code,
    'message' : error message,
    'detail' : {
        details
    }
};"
     </pre></dd><dt><span class="term"><code class="literal">"reconId"</code></span></dt><dd><p>
      UUID for the reconciliation operation, which is the same for all entries
      pertaining to the reconciliation run.
     </p></dd><dt><span class="term"><code class="literal">"reconciling"</code></span></dt><dd><p>What OpenIDM is reconciling, 
     <code class="literal">"source"</code> for the first phase, 
     <code class="literal">"target"</code> for the second phase</p></dd><dt><span class="term"><code class="literal">"rootActionId"</code></span></dt><dd><p>UUID of the root cause for the activity. This matches a
     corresponding <code class="literal">"rootActionId"</code> in an activity
     message.</p></dd><dt><span class="term"><code class="literal">"situation"</code></span></dt><dd><p>The situation encountered. See
     the section describing <a href="../integrators-guide/index.html#sync-situations" class="link">synchronization
     situations</a> for a list.</p></dd><dt><span class="term"><code class="literal">"sourceObjectId"</code></span></dt><dd><p>
      The object identifier on the source system, such as
      <code class="literal">"system/xmlfile/account/bjensen"</code> or
      <code class="literal">"managed/user/bjensen"</code> (depending on the resource
      configured as the source in the mapping).
     </p></dd><dt><span class="term"><code class="literal">"status"</code></span></dt><dd><p>Result of the operation, such as <code class="literal">"SUCCESS"</code></p></dd><dt><span class="term"><code class="literal">"targetObjectId"</code></span></dt><dd><p>
      The object identifier on the target system, such as
      <code class="literal">"system/xmlfile/account/bjensen"</code> or
      <code class="literal">"managed/user/bjensen"</code> (depending on the resource
      configured as the target in the mapping).
     </p></dd><dt><span class="term"><code class="literal">"timestamp"</code></span></dt><dd><p>Time when OpenIDM logged the message, in UTC format, for example 
    <code class="literal">"2012-11-18T08:48:00.160Z"</code></p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="audit-configuration"></a>17.3.&nbsp;Audit Configuration</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#audit-eventtypes">17.3.1. Event Types</a></span></dt><dt><span class="section"><a href="#audit-logto">17.3.2. Log To List</a></span></dt><dt><span class="section"><a href="#audit-exception-formatter">17.3.3. Exception Formatter</a></span></dt></dl></div><p>OpenIDM exposes the audit logging configuration under
  <code class="literal">http://localhost:8080/openidm/config/audit</code>
  for the REST API, and in the file <code class="filename">conf/audit.json</code> where
  you installed OpenIDM. A sample <code class="filename">conf/audit.json</code>
  configuration file follows:</p><pre class="brush: javascript;">{
    "eventTypes" : {
        "activity" : {
            "filter" : {
                "actions" : [
                    "create",
                    "update",
                    "delete",
                    "patch",
                    "action"
                ]
            },
            "watchedFields" : [ ],
            "passwordFields" : [ "password" ]
        },
        "recon" : { }
    },
    "logTo" : [
        {
            "logType" : "csv",
            "location" : "audit",
            "recordDelimiter" : ";",
            "ignoreLoggingFailures" : true
        },
        {
            "logType" : "repository",
            "useForQueries" : true,
            "ignoreLoggingFailures" : true
        }
    ],
    "exceptionFormatter" : {
        "type" : "text/javascript",
        "file" : "bin/defaults/script/audit/stacktraceFormatter.js"
    }
}</pre><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="audit-eventtypes"></a>17.3.1.&nbsp;Event Types</h3></div></div></div><p>The <code class="literal">eventTypes</code> configuration specifies what events
   OpenIDM writes to audit logs. OpenIDM supports two
   <code class="literal">eventTypes</code>: <code class="literal">activity</code> for the activity
   log, and <code class="literal">recon</code> for the reconciliation log. The filter
   for actions under activity logging shows the actions on managed or system
   objects for which OpenIDM writes to the activity log.</p><div class="variablelist"><p>The <code class="literal">filter</code> <code class="literal">actions</code> list enables 
    you to configure the conditions that result in actions being written to the 
    activity log.</p><dl class="variablelist"><dt><span class="term"><code class="literal">read</code></span></dt><dd><p>When an object is read by using its identifier.</p></dd><dt><span class="term"><code class="literal">create</code></span></dt><dd><p>When an object is created.</p></dd><dt><span class="term"><code class="literal">update</code></span></dt><dd><p>When an object is updated.</p></dd><dt><span class="term"><code class="literal">delete</code></span></dt><dd><p>When an object is deleted.</p></dd><dt><span class="term"><code class="literal">patch</code></span></dt><dd><p>When an object is partially modified.</p></dd><dt><span class="term"><code class="literal">query</code></span></dt><dd><p>When a query is performed on an object.</p></dd><dt><span class="term"><code class="literal">action</code></span></dt><dd><p>When an action is performed on an object.</p></dd></dl></div><p>You can optionally add a <code class="literal">filter</code> 
   <code class="literal">triggers</code> list that specifies the actions that are logged 
   for a particular trigger. For example, the following addition to the 
   <code class="filename">audit.json</code> file specifies that only 
   <code class="literal">create</code> and <code class="literal">update</code> actions are logged 
   for an activity that was triggered by a <code class="literal">recon</code>.</p><pre class="brush: javascript;">
   ...
            "filter" : {
                "actions" : [
                    "create",
                    "update",
                    "delete",
                    "patch",
                    "action"
                ],
                "triggers" : {
                    "recon" : [
                        "create",
                        "update"
                    ]
                }
            },
            "watchedFields" : [ ],   
   ...
   </pre><p>If a trigger is provided, but no actions are specified, nothing is 
   logged for that trigger. If a trigger is omitted, all actions are logged 
   for that trigger. In the current OpenIDM release, only the 
   <code class="literal">recon</code> trigger is implemented. For a list of reconciliation 
   actions that can be logged, see <a href="../integrators-guide/index.html#sync-actions" class="link"><em class="citetitle">Synchronization 
   Actions</em></a>.</p><p>The <code class="literal">watchedFields</code> parameter enables you to specify 
   a list of fields that should be "watched" for changes. When the value of one 
   of the fields in this list changes, the change is logged in the audit log, 
   under the column <code class="literal">"changedFields"</code>. Fields are listed in 
   comma-separated format, for example:</p><div class="screen"><pre>"watchedFields" : [ "email", "address" ]</pre></div><p>The <code class="literal">passwordFields</code> parameter enables you to specify 
   a list of fields that are considered passwords. This parameter functions much 
   like the <code class="literal">watchedFields</code> parameter in that changes to these 
   field values are logged in the audit log, under the column 
   <code class="literal">"changedFields"</code>. In addition, when a password field is 
   changed, the boolean <code class="literal">"passwordChanged"</code> flag is set to 
   <code class="literal">true</code> in the audit log. Fields are listed in 
   comma-separated format, for example:</p><div class="screen"><pre>"passwordFields" : [ "password", "username" ]</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="audit-logto"></a>17.3.2.&nbsp;Log To List</h3></div></div></div><div class="variablelist"><p>
     The <code class="literal">logTo</code> list enables you to specify the format of the
     log, where it is written, and various parameters for each log type.
    </p><dl class="variablelist"><dt><span class="term"><code class="literal">logType</code></span></dt><dd><p>
       The format of the audit log. The log type can be one of the following:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
          <code class="literal">csv</code> - write to a comma-separated variable format
          file.
         </p><p>
          The <code class="literal">"location"</code> property indicates the name of the
          directory in which the file should be written, relative to the
          directory in which you installed OpenIDM.
         </p><p>
          Audit file names are fixed, <code class="filename">access.csv</code>,
          <code class="filename">activity.csv</code>, and <code class="filename">recon.csv</code>.
         </p><p>
          The <code class="literal">"recordDelimiter"</code> property enables you to
          specify the separator between each record.
         </p></li><li class="listitem"><p>
          <code class="literal">repository</code> - write to the OpenIDM database
          repository.
         </p><p>
          OpenIDM stores entries under the
          <code class="literal">/openidm/repo/audit/</code> context. Such entries appear
          as <code class="literal">audit/access/<em class="replaceable"><code>_id</code></em></code>,
          <code class="literal">audit/activity/<em class="replaceable"><code>_id</code></em></code>, and
          <code class="literal">audit/recon/<em class="replaceable"><code>_id</code></em></code>, where
          the <em class="replaceable"><code>_id</code></em> is the UUID of the entry, such as
          <code class="literal">0419d364-1b3d-4e4f-b769-555c3ca098b0</code>.
         </p><p>
          In the OrientDB repository, OpenIDM stores log records in the
          <code class="literal">audit_access</code>, <code class="literal">audit_activity</code>,
          and <code class="literal">audit_recon</code> tables.
         </p><p>
          In a JDBC repository, OpenIDM stores records in the
          <code class="literal">auditaccess</code>, <code class="literal">auditactivity</code>, and
          <code class="literal">auditrecon</code> tables.
         </p><p>
          The <code class="literal">"useForQueries"</code> boolean property indicates
          whether the repository logger should be used to service reads and
          query requests. The value is <code class="literal">true</code> by default. If
          <code class="literal">"useForQueries"</code> is set to <code class="literal">false</code>,
          the CSV file is used to service read and query requests.
         </p></li></ul></div></dd><dt><span class="term"><code class="literal">ignoreLoggingFailures</code></span></dt><dd><p>
       In certain situations, you might want to tolerate the inability to write
       to an audit log and prevent an exception from being thrown if the logging
       fails. For example, a request for configuration data might succeed, but
       fail to write to the activity log. Reasons for logging failures might
       include full disk (for a CSV logger) or repository unavailable (for a
       repository logger).
      </p><p>
       For each log type, you can specify that failure to write to the log
       should be ignored, and should not prevent the successful execution of the
       underlying request. To ignore logging failures for a specific log type,
       add the <code class="literal">"ignoreLoggingFailures"</code> property to the log
       type configuration, and set its value to <code class="literal">true</code>. This
       parameter is not included in the default <code class="literal">audit.json</code>
       file, and its value is considered to be <code class="literal">false</code> by
       default for all log types.
      </p></dd></dl></div><p>
    You can specify a <code class="literal">logTo</code> location to the directory of your
    choice. The example shown in <a href="../integrators-guide/index.html#custom-audit-log-location" class="link"><em class="citetitle">Custom
    Audit Log Locations</em></a> shows how you can configure
    <code class="literal">logTo</code> to direct audit logs to a user home directory.
   </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="audit-exception-formatter"></a>17.3.3.&nbsp;Exception Formatter</h3></div></div></div><p>
    The <code class="literal">exceptionFormatter</code> property specifies the name and
    type of file that handles the formatting and display of exceptions thrown by
    the audit logger. Supported types include <code class="literal">"text/javascript"</code> and
    <code class="literal">"groovy"</code>.
   </p><p>
    The <code class="literal">"file"</code> property provides the path to the script file
    that performs the formatting. The default exception formatter is
    <code class="literal">"bin/defaults/script/audit/stacktraceFormatter.js"</code>.
   </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="audit-reports"></a>17.4.&nbsp;Generating Reports</h2></div></div></div><p>When generating reports from audit logs, you can correlate information
  from activity and reconciliation logs by matching the
  <code class="literal">"rootActionId"</code> on entries in both logs.</p><p>The following MySQL query shows a join of the audit activity and
  audit reconciliation tables using root action ID values.</p><div class="screen"><pre>
mysql&gt; select distinct auditrecon.activity,auditrecon.sourceobjectid,
 auditrecon.targetobjectid,auditactivity.activitydate,auditrecon.status
 from auditactivity inner join auditrecon
 auditactivity.rootactionid=auditrecon.rootactionid
 where auditrecon.activity is not null group by auditrecon.sourceobjectid;
+----------+--------------------------+----------------------+---------------------+---------+
| activity | sourceobjectid           | targetobjectid       | activitydate        | status  |
+----------+--------------------------+----------------------+---------------------+---------+
| CREATE   | system/xmlfile/account/1 | managed/user/juser   | 2012-01-17T07:59:12 | SUCCESS |
| CREATE   | system/xmlfile/account/2 | managed/user/ajensen | 2012-01-17T07:59:12 | SUCCESS |
| CREATE   | system/xmlfile/account/3 | managed/user/bjensen | 2012-01-17T07:59:12 | SUCCESS |
+----------+--------------------------+----------------------+---------------------+---------+
3 rows in set (0.00 sec)</pre></div></div></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-cluster"></a>Chapter&nbsp;18.&nbsp;Configuring OpenIDM to Work in a Cluster</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="section"><a href="#cluster-config">18.1. Configuring an OpenIDM Instance as Part of a Cluster</a></span></dt><dt><span class="section"><a href="#clustering-scheduled-tasks">18.2. Managing Scheduled Tasks Across a Cluster</a></span></dt><dt><span class="section"><a href="#cluster-over-REST">18.3. Managing Nodes Over REST</a></span></dt></dl></div><a class="indexterm" name="d505e17572"></a><a class="indexterm" name="d505e17575"></a><a class="indexterm" name="d505e17578"></a><p>
  To ensure availability of the identity management service, you can deploy
  multiple OpenIDM instances in a cluster. In a clustered environment, all
  instances point to the same external database. The database itself might or
  might not be clustered, depending on your particular availability strategy.
 </p><p>
  In a clustered environment, if one instance of OpenIDM becomes unavailable or
  does not check in with the cluster management service, another instance
  of OpenIDM detects this situation. If the unavailable instance did not
  complete one or more tasks, the available instance attempts to recover and
  rerun those tasks.
 </p><p>
  For example, if <code class="literal">instance1</code> goes down while executing a
  scheduled task, the cluster manager notifies the scheduler service that
  <code class="literal">instance1</code> is not available. The scheduler service then
  attempts to clean up any jobs that <code class="literal">instance1</code> was running
  when it went down.
 </p><p>
  This chapter describes what changes you need to make to OpenIDM to configure
  multiple instances that point to a database.
 </p><p>
  The following diagram depicts a relatively simple cluster configuration.
  You do need to do more than just set a unique value for
  <code class="literal">openidm.node.id</code>
 </p><div class="mediaobject" align="center"><a name="figure-cluster"></a><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/cluster-config.png" align="middle" height="360" alt="A Simplified Cluster"></td></tr></table><div class="longdesc-link" align="right"><br clear="all"><span class="longdesc-link">[<a href="figure-cluster.html" target="longdesc">D</a>]</span></div></div><p>
  The default installation of OpenIDM is pre-configured to enable the cluster
  service. The <code class="filename">conf/cluster.json</code> file includes the
  <code class="literal">"enabled" : true</code> directive. All you need to do with
  multiple instances of OpenIDM on the same subnet is modify each
  <code class="filename">boot.properties</code> file. Pay attention to the
  <code class="literal">openidm.node.id</code> and <code class="literal">openidm.instance.type</code>
  properties in that file.
 </p><p>
  When you configure a cluster, check the configuration files for each instance
  of OpenIDM. Except for <code class="filename">boot.properties</code>, the configuration
  files should be identical.
 </p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="cluster-config"></a>18.1.&nbsp;Configuring an OpenIDM Instance as Part of a Cluster</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#cluster-boot-config">18.1.1. Edit the Boot Configuration</a></span></dt><dt><span class="section"><a href="#cluster-config-file">18.1.2. Edit the Cluster Configuration</a></span></dt></dl></div><p>
   Before you configure an instance of OpenIDM to work in a cluster, make sure
   that OpenIDM is stopped. If someone had previously run that instance of
   OpenIDM, delete the <code class="filename">/path/to/openidm/felix-cache</code>
   directory.
  </p><p>
   All OpenIDM instances that form part of a single cluster must must all be
   configured to use the same type of repository.
   Note that OrientDB is currently unsupported in production environments.
  </p><p>
   To configure an individual OpenIDM instance as a part of a clustered
   deployment, follow these steps.
  </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
     Configure OpenIDM for a MySQL repository, as described in <a href="../install-guide/index.html#chap-repository" class="link"><em class="citetitle">Installing a
     Repository For Production</em></a> in the
     <em class="citetitle">Installation Guide</em>.
    </p><p>You need only import the data definition language script for OpenIDM
     into MySQL once, not repeatedly for each OpenIDM instance.
    </p></li><li class="listitem"><p><a class="xref" href="#cluster-boot-config" title="18.1.1.&nbsp;Edit the Boot Configuration">Section&nbsp;18.1.1, &#8220;Edit the Boot Configuration&#8221;</a></p></li><li class="listitem"><p><a class="xref" href="#cluster-config-file" title="18.1.2.&nbsp;Edit the Cluster Configuration">Section&nbsp;18.1.2, &#8220;Edit the Cluster Configuration&#8221;</a></p></li><li class="listitem"><p>
     If you are using scheduled tasks, do configure persistent schedules
     to ensure that they fire only once across the cluster. For more information,
     see the section on <a href="../integrators-guide/index.html#persistent-schedules" class="link"><em class="citetitle">Persisted
     Schedules</em></a>.
    </p></li></ol></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="cluster-boot-config"></a>18.1.1.&nbsp;Edit the Boot Configuration</h3></div></div></div><p>
    Each participating instance in a cluster must have its own unique node or
    instance ID, and must be attributed a role in the cluster. Specify these
    parameters in the <code class="filename">conf/boot/boot.properties</code> file of
    each instance.
   </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
      Specify a unique identifier for the instance, such as:
     </p><pre class="brush: plain;">
openidm.node.id=instance1
     </pre><p>
      On subsequent instances, the <code class="literal">openidm.node.id</code> can be set
      to <code class="literal">instance2</code>, <code class="literal">instance3</code>, and so
      forth. You can choose any value, as long as it is unique within the
      cluster.
     </p><p>
      In the cluster manager configuration file,
      <code class="filename">cluster.json</code>, the clustering service is enabled by
      default with the following setting:
     </p><pre class="brush: plain;">
"enabled": true
     </pre><p>
      The cluster manager specifies the OpenIDM instance ID
      from the <code class="filename">boot.properties</code> file as follows:
     </p><pre class="brush: plain;">
"instanceId" : "&amp;{openidm.node.id}",
     </pre><p>
      The scheduler uses the instance ID to claim and execute pending jobs. If
      multiple nodes have the same instance ID, problems will arise with
      multiple nodes attempting to execute the same scheduled jobs.
     </p><p>
      The cluster manager requires nodes to have unique IDs to ensure that it is
      able to detect when a node becomes unavailable.
     </p></li><li class="listitem"><p>
      Specify the instance type in the cluster.
     </p><p>
      On the primary instance, revise the following line in the
      <code class="filename">boot.properties</code> file as follows:
     </p><pre class="brush: plain;">
openidm.instance.type=clustered-first
     </pre><p>
      On subsequent instances, revise the following line in the
      <code class="filename">boot.properties</code> file as follows:
     </p><pre class="brush: plain;">
openidm.instance.type=clustered-additional
     </pre><p>
      The instance type is used during the setup process. When the primary node
      has been configured, additional nodes are bootstrapped with the security
      settings (keystore and truststore) of the primary node. After all nodes
      have been configured, they are all considered equal in the cluster, that
      is, there is no concept of a "master" node.
     </p><p>
      If no instance type is specified, the default value for this property is
      <code class="literal">openidm.instance.type=standalone</code>, which indicates that
      the instance will not be part of a cluster.
     </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="cluster-config-file"></a>18.1.2.&nbsp;Edit the Cluster Configuration</h3></div></div></div><p>
    The cluster configuration file is
    <code class="filename">/path/to/openidm/conf/cluster.json</code>. To enable a
    cluster, you should not have to make changes to this file:
   </p><pre class="brush: javascript;">{
 "instanceId" : "&amp;{openidm.node.id}",
 "instanceTimeout" : "30000",
 "instanceRecoveryTimeout" : "30000",
 "instanceCheckInInterval" : "5000",
 "instanceCheckInOffset" : "0",
 "enabled" : true
 } </pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
      The <code class="literal">instanceId</code> is set to the value of
      <code class="literal">openidm.node.id</code>, as configured in the
      <code class="filename">conf/boot/boot.properties</code> file.
     </p></li><li class="listitem"><p>
      <code class="literal">instanceTimeout</code> specifies the length of time (in
      milliseconds) that an instance can be "down" before the instance is
      considered to be in recovery mode.
     </p><p>
      <span class="emphasis"><em>Recovery mode</em></span> implies that the
      <code class="literal">instanceTimeout</code> of an instance has expired, and that
      another instance of OpenIDM in the cluster has detected that event. That
      second instance of OpenIDM is now attempting to
      <span class="emphasis"><em>recover</em></span> the instance.  The logic behind
      the recovery mechanism differs, depending on the component within OpenIDM.
      The scheduler component has well-defined recovery logic, and attempts to
      move any jobs that had been acquired by the unavailable instance back into
      the pool of waiting jobs.
     </p></li><li class="listitem"><p>
      <code class="literal">instanceRecoveryTimeout</code> specifies the length of time
      (in milliseconds) that an instance can be in recovery mode before that
      instance is considered to be offline.
     </p><p>
      The purpose of the recovery timeout is to prevent an instance from
      attempting to recover an unavailable instance indefinitely.
     </p></li><li class="listitem"><p>
      <code class="literal">instanceCheckInInterval</code> specifies the frequency (in
      milliseconds) that this instance checks in with the cluster manager to
      indicate that it is still online.
     </p></li><li class="listitem"><p>
      <code class="literal">instanceCheckInOffset</code> specifies an offset (in
      milliseconds) for the checkin timing, per instance, when a number of
      instances in a cluster are started simultaneously.
     </p><p>
      Specifying a checkin offset prevents a situation in which all the instances
      in a cluster check in at the same time, and place a strain on the cluster
      manager resource.
     </p></li><li class="listitem"><p>
      <code class="literal">enabled</code> notes whether or not the clustering service
      should be enabled when you start OpenIDM.
     </p></li></ul></div><p>
    If the default cluster configuration is not suitable for your deployment,
    edit the <code class="filename">cluster.json</code> file for each instance.
   </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="clustering-scheduled-tasks"></a>18.2.&nbsp;Managing Scheduled Tasks Across a Cluster</h2></div></div></div><div class="itemizedlist"><p>
    In a clustered environment, the scheduler service looks for pending jobs and
    handles them as follows:
   </p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
     Non-persistent (in-memory) jobs will fire on each node in the cluster.
    </p></li><li class="listitem"><p>
     Persistent scheduled jobs are picked up and executed by a single node in
     the cluster.
    </p></li><li class="listitem"><p>
     Jobs that are configured as persistent but <span class="emphasis"><em>not concurrent</em></span>
     will fire only once across the cluster and will not fire again at the
     scheduled time, on the same node, or on a different node, until the current
     job has completed.
    </p><p>
     For example, a reconciliation operation that runs for longer than the time
     between scheduled intervals will not trigger a duplicate job while it is
     still running.
    </p></li></ul></div><p>
   The order in which nodes in a cluster claim jobs is random. If a node goes
   down, the cluster manager will automatically fail over jobs that have been
   claimed by that node, but not yet started. For example, if node A claims a
   job but does not start it, and then goes down, node B can reclaim that job.
   If node A claims and job, starts it, and then goes down, the job cannot be
   reclaimed by another node in the cluster. That specific job will never be
   completed. Instance B can claim the next iteration (or scheduled occurrence)
   of the job.
  </p><p>
   Note that this failover behavior is different to the behavior in OpenIDM
   2.1.0, in which an unavailable node would need to come up again to free a job
   that it had already claimed.
  </p><p>
   If a number of changes are made as a result of a LiveSync action, a single
   instance will claim the action, and will process all the changes related to
   that action.
  </p><p>
   To prevent a specific instance from claiming pending jobs,
   <code class="literal">"executePersistentSchedules"</code> should be set to
   <code class="literal">false</code> in the scheduler configuration for that instance.
   Because all nodes in a cluster read their configuration from a single
   repository you must use token substitution, via the
   <code class="filename">boot.properties</code> file, to define a specific scheduler
   configuration for each node.
  </p><p>
   So, if you want certain nodes to participate in processing clustered
   schedules (such as LiveSync) and other nodes not to participate, you can
   specify this information in the <code class="filename">conf/boot/boot.properties</code>
   file of each node. For example, to prevent a node from participating, add the
   following line to the <code class="filename">boot.properties</code> file of that node:
  </p><pre class="brush: plain;">
execute.clustered.schedules=false
  </pre><p>
   The initial scheduler configuration that is loaded into the repository must
   point to the relevant property in <code class="filename">boot.properties</code>. So,
   the initial <code class="filename">scheduler.json</code> file would include a token
   such as the following:
  </p><pre class="brush: plain;">
{
    "executePersistentSchedules" : "&amp;{execute.clustered.schedules}",
}
  </pre><p>
   You do not want to allow changes to a configuration file to overwrite the
   global configuration in the repository. To do so, start each instance of
   OpenIDM and then disable the file-based
   configuration view in a clustered deployment. For more information, see
   <span class="olink"><em class="citetitle">Disabling the
    File-Based Configuration View</em></span>.
  </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="cluster-over-REST"></a>18.3.&nbsp;Managing Nodes Over REST</h2></div></div></div><p>
   You can manage clusters and individual nodes over the REST interface, at the
   URL <code class="literal">https://localhost:8443/openidm/cluster/</code>. The following
   sample REST commands demonstrate the cluster information that is available
   over REST.
  </p><div class="example"><a name="d505e17882"></a><div class="example-title">Example&nbsp;18.1.&nbsp;Displaying the Nodes in the Cluster</div><div class="example-contents"><p>
    The following REST request displays the nodes configured in the cluster, and
    their status.
   </p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/cluster" </strong>
    <em>
{
  "results": [
    {
      "shutdown": "",
      "startup": "2013-10-28T11:48:29.026+02:00",
      "instanceId": "instance1",
      "state": "running"
    },
    {
      "shutdown": "",
      "startup": "2013-10-28T11:51:31.639+02:00",
      "instanceId": "instance2",
      "state": "running"
    }
  ]</em>
}  </pre></div></div></div><br class="example-break"><div class="example"><a name="d505e17895"></a><div class="example-title">Example&nbsp;18.2.&nbsp;Checking the State of an Individual Node</div><div class="example-contents"><p>
    To check the status of a specific node, include its instance ID in the URL,
    for example:
   </p><div class="screen"><pre>$ <strong> curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/cluster/instance1"</strong>
    <em>
{
  "results": {
    "shutdown": "",
    "startup": "2013-10-28T11:48:29.026+02:00",
    "instanceId": "instance1",
    "state": "running"
  }</em>
}  </pre></div></div></div><br class="example-break"></div></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-mail"></a>Chapter&nbsp;19.&nbsp;Sending Email</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="section"><a href="#send-mail-rest">19.1. Sending Mail Over REST</a></span></dt><dt><span class="section"><a href="#send-mail-script">19.2. Sending Mail From a Script</a></span></dt></dl></div><a class="indexterm" name="d505e17913"></a><a class="indexterm" name="d505e17918"></a><p>
  This chapter shows you how to configure the outbound email service, so that
  you can send email through OpenIDM either by script or through the REST API.
 </p><div class="procedure"><a name="setup-outbound-email"></a><div class="procedure-title">Procedure&nbsp;19.1.&nbsp;To Set Up Outbound Email</div><p>
   The outbound email service relies on a configuration object to identify the
   email account used to send messages. A sample configuration is provided in
   <code class="filename">/path/to/openidm/samples/misc/external.email.json</code>. To
   set up the external email service, follow these steps.
  </p><ol class="procedure" type="1"><li class="step"><p>
    Shut down OpenIDM.
   </p></li><li class="step"><p>
    Copy the sample configuration to the <code class="filename">conf</code> directory.
   </p><div class="screen"><pre>$ cd /path/to/openidm/
$ cp samples/misc/external.email.json conf/</pre></div></li><li class="step"><p>
    Edit <code class="filename">external.email.json</code> to reflect the account that is
    used to send messages.
   </p><pre class="brush: javascript;">
{
        "host" : "smtp.example.com",
        "port" : "25",
        "username" : "openidm",
        "password" : "secret12",
        "mail.smtp.auth" : "true",
        "mail.smtp.starttls.enable" : "true"
}</pre><p>OpenIDM encrypts the password you provide.</p><div class="variablelist"><p>Follow these hints when editing the configuration.</p><dl class="variablelist"><dt><span class="term"><code class="literal">"host"</code></span></dt><dd><p>SMTP server host name or IP address. This can be
      <code class="literal">"localhost"</code> if the server is on the same system as
      OpenIDM.</p></dd><dt><span class="term"><code class="literal">"port"</code></span></dt><dd><p>SMTP server port number such as 25, or 587</p></dd><dt><span class="term"><code class="literal">"username"</code></span></dt><dd><p>Mail account user name needed when <code class="literal">"mail.smtp.auth" :
      "true"</code></p></dd><dt><span class="term"><code class="literal">"password"</code></span></dt><dd><p>Mail account user password needed when <code class="literal">"mail.smtp.auth" :
      "true"</code></p></dd><dt><span class="term"><code class="literal">"mail.smtp.auth"</code></span></dt><dd><p>If <code class="literal">"true"</code>, use SMTP authentication</p></dd><dt><span class="term"><code class="literal">"mail.smtp.starttls.enable"</code></span></dt><dd><p>If <code class="literal">"true"</code>, use TLS</p></dd><dt><span class="term"><code class="literal">"from"</code></span></dt><dd><p>Optional default <code class="literal">From:</code> address</p></dd></dl></div></li><li class="step"><p>Start up OpenIDM.</p></li><li class="step"><p>Check that the email service is active.</p><div class="screen"><pre>-&gt; scr list
...
[   6] [active       ] org.forgerock.openidm.external.email
...</pre></div></li></ol></div><div class="note"><h3 class="title">Note</h3><p>
   The REST call described in the section that follows may use the local
   SMTP server. For a "quick and dirty" test, you could use the default
   port, disable authentication, and TLS:
  </p><pre class="brush: plain;">
"host" : "localhost",
"port" : "25,
"username" : "xxxxxx",
"password" : "xxxxxx",
"mail.smtp.auth" : "false",
"mail.smtp.starttls.enable" : "false"
  </pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="send-mail-rest"></a>19.1.&nbsp;Sending Mail Over REST</h2></div></div></div><p>Although you are more likely to send mail from a script in production,
  you can send email using the REST API by sending an HTTP POST to
  <code class="literal">/openidm/external/email</code> in order to test that your
  configuration works. You pass the message parameters as POST parameters,
  URL encoding the content as necessary.</p><p>The following example sends a test email using the REST API.</p><div class="screen"><pre>
$ <strong>curl \
 --cacert self-signed.crt \
 --header "Content-Type: application/json" \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request POST \
 --data '{"from":"openidm@example.com",
   "to":"admin@example.com",
   "subject":"Test",
   "body":"Test"}' \
 "https://localhost:8443/openidm/external/email?_action=send"</strong></pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="send-mail-script"></a>19.2.&nbsp;Sending Mail From a Script</h2></div></div></div><p>
   You can send email by using the resource API <a href="../integrators-guide/index.html#function-ref" class="link">functions</a> with
  the <code class="literal">external/email</code> context, as in the following
  example, where <code class="literal">params</code> is an object that contains the
  POST parameters.
  </p><pre class="brush: javascript;">
var params =  new Object();
params.from = "openidm@example.com";
params.to = "admin@example.com";
params.cc = "wally@example.com,dilbert@example.com";
params.subject = "OpenIDM recon report";
params.type = "text/html";
params.body = "&lt;html&gt;&lt;body&gt;&lt;p&gt;Recon report follows...&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;";

openidm.action("external/email", "send", params);</pre><div class="variablelist"><p>OpenIDM supports the following POST parameters.</p><dl class="variablelist"><dt><span class="term"><code class="literal">from</code></span></dt><dd><p>Sender mail address</p></dd><dt><span class="term"><code class="literal">to</code></span></dt><dd><p>Comma-separated list of recipient mail addresses</p></dd><dt><span class="term"><code class="literal">cc</code></span></dt><dd><p>Optional comma-separated list of copy recipient mail addresses</p></dd><dt><span class="term"><code class="literal">bcc</code></span></dt><dd><p>Optional comma-separated list of blind copy recipient mail
     addresses</p></dd><dt><span class="term"><code class="literal">subject</code></span></dt><dd><p>Email subject</p></dd><dt><span class="term"><code class="literal">body</code></span></dt><dd><p>Email body text</p></dd><dt><span class="term"><code class="literal">type</code></span></dt><dd><p>Optional MIME type. One of <code class="literal">"text/plain"</code>,
     <code class="literal">"text/html"</code>, or <code class="literal">"text/xml"</code>.</p></dd></dl></div></div></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-external-rest"></a>Chapter&nbsp;20.&nbsp;Accessing External REST Services</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="section"><a href="#invocation-parameters">20.1. Invocation Parameters</a></span></dt><dt><span class="section"><a href="#non-json-responses">20.2. Support for Non-JSON Responses</a></span></dt></dl></div><a class="indexterm" name="d505e18128"></a><p>
  You can access remote REST services by using the
  <code class="literal">openidm/external/rest</code> endpoint, or by specifying the
  <code class="literal">external/rest</code> resource in your scripts. Note that this
  service is not intended as a full connector to synchronize or reconcile
  identity data, but as a way to make dynamic HTTP calls as part of the OpenIDM
  logic. For more declarative and encapsulated interaction with remote REST
  services, and for synchronization or reconciliation operations, you should
  rather use the scripted REST connector.
 </p><p>
  An external REST call via a script might look something like the following:
 </p><pre class="brush: plain;">openidm.action("external/rest", "call", params);</pre><p>
  The <code class="literal">"call"</code> parameter specifies the action name to be used
  for this invocation, and is the standard method signature for the
  <code class="literal">openidm.action</code> method in OpenIDM 3.0.0.
 </p><p>
  An external REST call over REST might look something like the following:
 </p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "Content-Type: application/json" \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request POST \
 --data '{
  "url": "http://www.december.com/html/demo/hello.html",
  "method": "GET",
  "detectResultFormat": false,
  "headers": { "custom-header": "custom-header-value" }
  }' \
 "https://localhost:8443/openidm/external/rest?_action=call"</strong>
<em>{
  "body": "&lt;!DOCTYPE html PUBLIC \"-//IETF//DTD HTML 2.0//EN\"&gt;\r\n
           &lt;html&gt;\r\n
           &lt;head&gt;\r\n
           &lt;title&gt;\r\n   Hello World Demonstration Document\r\n  &lt;/title&gt;\r\n
           &lt;/head&gt;\r\n
           &lt;body&gt;\r\n
           &lt;h1&gt;\r\n   Hello, World!\r\n  &lt;/h1&gt;
           &#8230;
           &lt;/html&gt;\r\n",
  "headers": {
    "Server": "Apache",
    "ETag": "\"299-4175ff09d1140\"",
    "Date": "Mon, 28 Jul 2014 08:21:25 GMT",
    "Content-Length": "665",
    "Last-Modified": "Thu, 29 Jun 2006 17:05:33 GMT",
    "Keep-Alive": "timeout=15, max=100",
    "Content-Type": "text/html",
    "Connection": "Keep-Alive",
    "Accept-Ranges": "bytes"
  }
}</em></pre></div><p>
  Note that attributes in the POST body <span class="emphasis"><em>do not</em></span> have
  underscore prefixes. This is different to the OpenIDM 2.1 implementation, in
  which underscores were required.
 </p><p>
  HTTP 2xx responses are represented as regular, successful responses to the
  invocation. All other responses, including redirections, are returned as
  exceptions, with the HTTP status code in the exception
  <code class="literal">"code"</code>, and the response body in the exception
  <code class="literal">"detail"</code>, within the "content" element.
 </p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="invocation-parameters"></a>20.1.&nbsp;Invocation Parameters</h2></div></div></div><p>
   The following parameters are passed in the resource API parameters map. These
   parameters can override the static configuration (if present) on a
   per-invocation basis.
  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
     <code class="literal">url</code>. The target URL to invoke, in string format.
    </p></li><li class="listitem"><p>
     <code class="literal">method</code>. The HTTP action to invoke, in string format.
    </p><p>
     Possible actions include <code class="literal">"POST"</code>, <code class="literal">"GET"</code>,
     <code class="literal">"PUT"</code>, <code class="literal">"DELETE"</code>,
     <code class="literal">"HEAD"</code> and <code class="literal">"OPTIONS"</code>.
    </p></li><li class="listitem"><p>
     <code class="literal">authenticate</code>. The login details with which to
     authenticate. For example:
    </p><pre class="brush: plain;">"authenticate" : {"type": "basic", "user" : "john", "password" : "Passw0rd"}</pre><p>
     If no <code class="literal">authenticate</code> parameter is specified, no
     authentication is used. Currently, only basic authentication is supported.
    </p></li><li class="listitem"><p>
     <code class="literal">headers</code>. The HTTP headers to set, in a map format from
     string (<em class="replaceable"><code>header-name</code></em>) to string
     (<em class="replaceable"><code>header-value</code></em>). For example,
     <code class="literal">Accept-Language: en-US</code>.
    </p></li><li class="listitem"><p>
     <code class="literal">content-type</code>. The media type of the data that is sent,
     for example <code class="literal">Content-Type: application/json</code> or
     <code class="literal">Content-Type: application/xml</code>.
    </p></li><li class="listitem"><p>
     <code class="literal">body</code>. The body/resource representation to send (for PUT
     and POST operations), in string format.
    </p></li><li class="listitem"><p>
     <code class="literal">detectResultFormat</code>. Specifies whether JSON or non-JSON
     results are expected. Boolean, defaults to <code class="literal">true</code>.
    </p><p>
     For all responses other than 2xx, the result is returned as an exception,
     with the HTTP code in the exception <code class="literal">"code"</code>. Any details
     are returned in the exception <code class="literal">"detail"</code> under the
     <code class="literal">"content"</code> element. For example:
    </p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "Content-Type: application/json" \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request POST \
 --data '{
     "url":"http://december.com/non_existing_page",
     "method":"GET",
     "content-type":"application/xml"
   }' \
 "https://localhost:8443/openidm/external/rest?_action=call"</strong>
<em>{
    "detail": {
        "content": "&lt;html&gt;&lt;head&gt;&lt;title&gt;December Communications, Inc. Missing Page&lt;/title&gt; (...) &lt;/html&gt;\n"
    },
    "message": "Error while processing GET request: Not Found",
    "reason": "Not Found",
    "code": 404
}</em></pre></div><p>
     For more information about non-JSON results, see
     <a class="xref" href="#non-json-responses" title="20.2.&nbsp;Support for Non-JSON Responses">Section&nbsp;20.2, &#8220;Support for Non-JSON Responses&#8221;</a>.
    </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="non-json-responses"></a>20.2.&nbsp;Support for Non-JSON Responses</h2></div></div></div><p>
   The external REST service supports any arbitrary payload (currently in
   stringified format). The <code class="literal">"detectResultFormat"</code> parameter
   specifies whether the server should attempt to detect the response format
   and, if the format is known, parse that format.
  </p><p>
   Currently, the only known response format is JSON. So, if the service that is
   requested returns results in JSON format, and
   <code class="literal">"detectResultFormat"</code> is set to <code class="literal">true</code>
   (the default), the response from the call to external/rest will be the
   identical JSON data that was returned from the remote system. This enables
   JSON clients to interact with the external REST service with minimal changes
   to account for in the response.
  </p><p>
   If the service returns results in JSON format and
   <code class="literal">"detectResultFormat"</code> is set to <code class="literal">false</code>,
   results are represented as a stringified entry.
  </p><p>
   If <code class="literal">"detectResultFormat"</code> is set to <code class="literal">true</code>
   and the mime type is not recognized (currently any type other than JSON) the
   result is the same as if <code class="literal">"detectResultFormat"</code> were set to
   <code class="literal">false</code>. Set <code class="literal">"detectResultFormat"</code> to
   <code class="literal">false</code> if the remote system returns non-JSON data, or if
   you require details in addition to the literal JSON response body (for
   example, if you need to access a specific response header, such as a cookie).
  </p><p>
   The representation as parsed JSON differs from the stringified format as
   follows:
  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
     The parsed JSON representation returns the message payload directly in the
     body, with no wrapper. Currently, for parsed JSON responses, additional
     meta-data is not returned in the body. For example:
    </p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "Content-Type: application/json" \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request POST \
 --data '{
     "url": "http://localhost:8080/openidm/info/ping",
     "method": "GET",
     "detectResultFormat": true,
     "headers": { "X-OpenIDM-Username": "anonymous", "X-OpenIDM-Password": "anonymous" }
   }' \
 "https://localhost:8443/openidm/external/rest?_action=call"</strong>
<em>{
  "shortDesc": "OpenIDM ready",
  "state": "ACTIVE_READY"
}</em></pre></div></li><li class="listitem"><p>
     The stringified format includes a wrapper that represents other meta-data,
     such as returned headers. For example:
    </p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "Content-Type: application/json" \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request POST \
 --data '{
     "url": "http://localhost:8080/openidm/info/ping",
     "method": "GET",
     "detectResultFormat": false,
     "headers": { "X-OpenIDM-Username": "anonymous", "X-OpenIDM-Password": "anonymous" }
   }' \
 "https://localhost:8443/openidm/external/rest?_action=call"</strong>
<em>{
  "body": "{\"state\":\"ACTIVE_READY\",\"shortDesc\":\"OpenIDM ready\"}",
  "headers": {
    "Cache-Control": "no-cache",
    "Server": "Jetty(8.y.z-SNAPSHOT)",
    "Content-Type": "application/json;charset=UTF-8",
    "Set-Cookie": "session-jwt=eyAiYWxn...-cQ.3QT4zT4ZZTj8LH8Oo_zx3w;Path=/",
    "Expires": "Thu, 01 Jan 1970 00:00:00 GMT",
    "Content-Length": "52",
    "Vary": "Accept-Encoding, User-Agent"
  }
}</em></pre></div><p>
     A sample non-JSON response would be similar:
    </p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "Content-Type: application/json" \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request POST \
 --data '{
     "url":"http://december.com",
     "method":"GET",
     "content-type":"application/xml",
     "detectResultFormat":false
   }' \
 "https://localhost:8443/openidm/external/rest?_action=call"</strong>
<em>{
  "body": "&lt;!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.01 Transitional//EN\"
          \"http://www.w3.org/TR/html4/loose.dtd\"&gt; \n
          &lt;html&gt;&lt;head&gt;&lt;title&gt;December Communications, Inc.
          december.com&lt;/title&gt;\n
          &lt;meta http-equiv=\"Content-Type\" content=\"text/html;
          charset=iso-8859-1\"&gt;
          ..."
  "headers": {
  "Server": "Apache",
  "ETag": "\"4c3c-4f06c64da3980\"",
  "Date": "Mon, 28 Jul 2014 19:16:33 GMT",
  "Content-Length": "19516",
  "Last-Modified": "Mon, 20 Jan 2014 20:04:06 GMT",
  "Keep-Alive": "timeout=15, max=100",
  "Content-Type": "text/html",
  "Connection": "Keep-Alive",
  "Accept-Ranges": "bytes"
  }
}</em></pre></div></li></ul></div></div></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-best-practices"></a>Chapter&nbsp;21.&nbsp;OpenIDM Project Best Practices</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="section"><a href="#immplementation-phase">21.1. Implementation Phases</a></span></dt></dl></div><a class="indexterm" name="d505e18368"></a><p>This chapter lists points to check when implementing an identity
 management solution with OpenIDM.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="immplementation-phase"></a>21.1.&nbsp;Implementation Phases</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#d505e18378">21.1.1. Initiation</a></span></dt><dt><span class="section"><a href="#d505e18383">21.1.2. Definition</a></span></dt><dt><span class="section"><a href="#d505e18445">21.1.3. Design</a></span></dt><dt><span class="section"><a href="#d505e18450">21.1.4. Build</a></span></dt><dt><span class="section"><a href="#d505e18455">21.1.5. Production</a></span></dt></dl></div><p>Any identity management project should follow a set of well defined
  phases, where each phase defines discrete deliverables. The phases take
  the project from initiation to finally going live with a tested
  solution.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d505e18378"></a>21.1.1.&nbsp;Initiation</h3></div></div></div><p>The project's initiation phase involves identifying and gathering
   project background, requirements, and goals at a high level. The deliverable
   for this phase is a statement of work or a mission statement.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d505e18383"></a>21.1.2.&nbsp;Definition</h3></div></div></div><p>In the definition phase, you gather more detailed information on
   existing systems, determine how to integrate, describe account schemas,
   procedures, and other information relevant to the OpenIDM deployment.
   The deliverable for this phase is one or more documents that define
   detailed requirements for the project, and that cover project definition,
   the business case, use cases to solve, and functional specifications.</p><div class="variablelist"><p>The definition phase should capture at least the following.</p><dl class="variablelist"><dt><span class="term">User Administration and Management</span></dt><dd><p>Procedures for managing users and accounts, who manages users,
      what processes look like for joiners, movers and leavers, and what is
      required of OpenIDM to manage users</p></dd><dt><span class="term">Password Management and Password Synchronization</span></dt><dd><p>Procedures for managing account passwords, password policies,
      who manages passwords, and what is required of OpenIDM to manage
      passwords</p></dd><dt><span class="term">Security Policy</span></dt><dd><p>What security policies defines for users, accounts, passwords, and
      access control</p></dd><dt><span class="term">Target Systems</span></dt><dd><p>Target systems and resources with which OpenIDM must integrate.
      Information such as schema, attribute mappings and attribute
      transformation flow, credentials and other integration specific
      information.</p></dd><dt><span class="term">Entitlement Management</span></dt><dd><p>Procedures to manage user access to resources, individual
      entitlements, grouping provisioning activities into encapsulated
      concepts such as roles and groups</p></dd><dt><span class="term">Synchronization and Data Flow</span></dt><dd><p>Detailed outlines showing how identity information flows from
      authoritative sources to target systems, attribute transformations
      required</p></dd><dt><span class="term">Interfaces</span></dt><dd><p>How to secure the REST, user and file-based interfaces, and to
      secure the communication protocols involved</p></dd><dt><span class="term">Auditing and Reporting</span></dt><dd><p>Procedures for auditing and reporting, including who takes
      responsibility for auditing and reporting, and what information is
      aggregated and reported. Characteristics of reporting engines provided,
      or definition of the reporting engine to be integrated.</p></dd><dt><span class="term">Technical Requirements</span></dt><dd><p>Other technical requirements for the solution such as how to
      maintain the solution in terms of monitoring, patch management,
      availability, backup, restore and recovery process. This includes any
      other components leveraged such as a ConnectorServer and plug-ins for
      password synchronization on Active Directory, or OpenDJ.</p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d505e18445"></a>21.1.3.&nbsp;Design</h3></div></div></div><p>This phase focuses on solution design including on OpenIDM and other
   components. The deliverables for this phase are the architecture and design
   documents, and also success criteria with detailed descriptions and test
   cases to verify when project goals have been met.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d505e18450"></a>21.1.4.&nbsp;Build</h3></div></div></div><p>This phase builds and tests the solution prior to moving the solution
   into production.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d505e18455"></a>21.1.5.&nbsp;Production</h3></div></div></div><p>This phase deploys the solution into production until an
   application steady state is reached and maintenance routines and procedures
   can be applied.</p></div></div></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-troubleshooting"></a>Chapter&nbsp;22.&nbsp;Troubleshooting</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="section"><a href="#stops-when-backgrounded">22.1. OpenIDM Stopped in Background</a></span></dt><dt><span class="section"><a href="#internal-recon-sync-errors">22.2. Internal Server Error During Reconciliation or Synchronization</a></span></dt><dt><span class="section"><a href="#sync-service-unsatisfied">22.3. The scr list Command Shows Sync Service As Unsatisfied</a></span></dt><dt><span class="section"><a href="#json-parse-error">22.4. JSON Parsing Error</a></span></dt><dt><span class="section"><a href="#system-not-available">22.5. System Not Available</a></span></dt><dt><span class="section"><a href="#bad-connector-host-reference">22.6. Bad Connector Host Reference in Provisioner Configuration</a></span></dt><dt><span class="section"><a href="#missing-name-attribute">22.7. Missing Name Attribute</a></span></dt></dl></div><a class="indexterm" name="d505e18464"></a><p>
  When things are not working check this chapter for tips and answers.
 </p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="stops-when-backgrounded"></a>22.1.&nbsp;OpenIDM Stopped in Background</h2></div></div></div><p>When you start OpenIDM in the background without having disabled the
  text console, the job can stop immediately after startup.</p><div class="screen"><pre>$ ./startup.sh &amp;
[2] 346
$ ./startup.sh
Using OPENIDM_HOME:   /path/to/openidm
Using OPENIDM_OPTS:   -Xmx1024m -Xms1024m
Using LOGGING_CONFIG:
 -Djava.util.logging.config.file=/path/to/openidm/conf/logging.properties
Using boot properties at /path/to/openidm/conf/boot/boot.properties
-&gt; 

[2]+  Stopped                 ./startup.sh</pre></div><p>To resolve this problem, make sure you remove
  <code class="filename">openidm/bundle/org.apache.felix.shell.tui-1.4.1.jar</code>
  before starting OpenIDM, and also remove Felix cache files in
  <code class="filename">openidm/felix-cache/</code>.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="internal-recon-sync-errors"></a>22.2.&nbsp;Internal Server Error During Reconciliation or Synchronization</h2></div></div></div><p>You might see an error message such as the following returned from
  reconciliation or synchronization.</p><pre class="brush: javascript;">
{
    "error": "Conflict",
    "description": "Internal Server Error:
        org.forgerock.openidm.sync.SynchronizationException:
        Cowardly refusing to perform reconciliation with an
        empty source object set: Cowardly refusing to perform
        reconciliation with an empty source object set"
}</pre><p>This error can be misleading. This usually means the connector is
  not able to communicate with the target source.</p><p>Check the settings for your connector. For example, with the XML
  connector you get this error if the filename for the source is invalid. With
  the LDAP connector, you can get this error if your connector cannot contact
  the target LDAP server.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sync-service-unsatisfied"></a>22.3.&nbsp;The scr list Command Shows Sync Service As Unsatisfied</h2></div></div></div><p>You might encounter this message in the logs.</p><pre class="brush: plain;">
WARNING: Loading configuration file /path/to/openidm/conf/sync.json failed
org.forgerock.openidm.config.InvalidException:
 Configuration for org.forgerock.openidm.sync could not be parsed and may not
     be valid JSON : Unexpected character ('}' (code 125)): expected a value
     at [Source: java.io.StringReader@3951f910; line: 24, column: 6]
 at org.forgerock.openidm.config.crypto.ConfigCrypto.parse...
 at org.forgerock.openidm.config.crypto.ConfigCrypto.encrypt...
 at org.forgerock.openidm.config.installer.JSONConfigInstaller.setConfig...</pre><p>This indicates a syntax error in
  <code class="filename">openidm/conf/sync.json</code>. After fixing your configuration,
  change to the <code class="filename">/path/to/openidm/</code> directory, and use the
  <span class="command"><strong>cli.sh validate</strong></span> command to check that your configuration
  files are valid.</p><div class="screen"><pre>$ cd /path/to/openidm ; ./cli.sh validate
Using boot properties at /path/to/openidm/conf/boot/boot.properties
...................................................................
[Validating] Load JSON configuration files from:
[Validating]  /path/to/openidm/conf
[Validating] audit.json .................................. SUCCESS
[Validating] authentication.json ......................... SUCCESS
[Validating] managed.json ................................ SUCCESS
[Validating] provisioner.openicf-xml.json ................ SUCCESS
[Validating] repo.orientdb.json .......................... SUCCESS
[Validating] router.json ................................. SUCCESS
[Validating] scheduler-reconcile_systemXmlAccounts_managedUser.json  SUCCESS
[Validating] sync.json ................................... SUCCESS</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="json-parse-error"></a>22.4.&nbsp;JSON Parsing Error</h2></div></div></div><p>You might encounter this error message in the logs.</p><pre class="brush: plain;">
"Configuration for org.forgerock.openidm.provisioner.openicf could not be
 parsed and may not be valid JSON : Unexpected character ('}' (code 125)): 
 was expecting double-quote to start field name"</pre><p>The error message usually indicates the precise point where the
  JSON file has the syntax problem. The error above was caused by an extra
  comma in the JSON file, <code class="literal">{"attributeName":{},{},}</code>. The
  second comma is redundant.</p><p>The situation usually results in the service that the specific JSON file
   configures being left in the <code class="literal">unsatisfied</code> state.</p><p>After fixing your configuration, change to the
  <code class="filename">/path/to/openidm/</code> directory, and use the <span class="command"><strong>cli.sh
  validate</strong></span> command to check that your configuration files are
  valid.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="system-not-available"></a>22.5.&nbsp;System Not Available</h2></div></div></div><p>OpenIDM throws the following error as a result of a reconciliation
  where the source systems configuration can not be found.</p><pre class="brush: javascript;">
{
    "error": "Conflict",
    "description": "Internal Server Error:
        org.forgerock.openidm.sync.SynchronizationException:
        org.forgerock.openidm.objset.ObjectSetException:
        System: system/HR/account is not available.:
        org.forgerock.openidm.objset.ObjectSetException:
        System: system/HR/account is not available.:
        System: system/HR/account is not available."
}</pre><p>This error occurs when the <code class="literal">"name"</code> property value
  in <code class="filename">provisioner.<em class="replaceable"><code>resource</code></em>.json</code>
  is changed from <code class="literal">HR</code> to something else.</p><p>The same error occurs when a provisioner configuration fails to load due
   to misconfiguration, or when the path to the data file for a CSV or XML
   connector is incorrectly set.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="bad-connector-host-reference"></a>22.6.&nbsp;Bad Connector Host Reference in Provisioner Configuration</h2></div></div></div><p>You might see the following error when a provisioner configuration
  loads.</p><pre class="brush: plain;">
Wait for meta data for config org.forgerock.openidm.provisioner.openicf-scriptedsql</pre><p>In this case the configuration fails to load because information is
   missing. One possible cause is an incorrect value for
  <code class="literal">connectorHostRef</code> in the provisioner configuration
  file.</p><div class="itemizedlist"><p>For local Java connector servers, the following rules apply.</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>If the connector .jar is installed as a bundle under
    <code class="filename">openidm/bundle</code>, then the value must be
    <code class="literal">"connectorHostRef" :
    "osgi:service/org.forgerock.openicf.framework.api.osgi.ConnectorManager",</code>.</p></li><li class="listitem"><p>If the connector .jar is installed as a connector under
    <code class="filename">openidm/connectors</code>, then the value must be 
    <code class="literal">"connectorHostRef" : "#LOCAL",</code>.</p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="missing-name-attribute"></a>22.7.&nbsp;Missing Name Attribute</h2></div></div></div><p>In this case, the situation in the audit recon log shows "NULL".</p><p>A missing name attribute error, followed by an
  <code class="literal">IllegalArgumentException</code>, points to misconfiguration of
  the correlation rule, with the correlation query pointing to the external
  system. Such queries usually reference the "name" field which, if empty,
  leads to the error below.</p><pre class="brush: plain;">
Jan 20, 2012 1:59:58 PM
 org.forgerock.openidm.provisioner.openicf.commons.AttributeInfoHelper build
SEVERE: Failed to build name attribute out of [null]
Jan 20, 2012 1:59:58 PM
 org.forgerock.openidm.provisioner.openicf.impl.OpenICFProvisionerService query
SEVERE: Operation [query, system/ad/account] failed with Exception on system
 object: java.lang.IllegalArgumentException: Attribute value must be an
 instance of String.
Jan 20, 2012 1:59:58 PM org.forgerock.openidm.router.JsonResourceRouterService
 handle
WARNING: JSON resource exception
org.forgerock.json.resource.JsonResourceException: IllegalArgumentException
 at org.forgerock.openidm.provisioner....OpenICFProvisionerService.query...
 at org.forgerock.openidm.provisioner.....OpenICFProvisionerService.handle...
 at org.forgerock.openidm.provisioner.impl.SystemObjectSetService.handle...
 at org.forgerock.json.resource.JsonResourceRouter.handle...</pre><p>Check your <code class="literal">correlationQuery</code>. Another symptom of a
  broken correlation query is that the audit recon log shows a situation
  of "NULL", and no onCreate, onUpdate or similar scripts are executed.</p></div></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-advanced"></a>Chapter&nbsp;23.&nbsp;Advanced Configuration</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="section"><a href="#adv-startup-configuration">23.1. Advanced Startup Configuration</a></span></dt></dl></div><p>OpenIDM is a highly customizable, extensible identity management system.
  For the most part, the customization and configuration required for a "typical"
  deployment is described earlier in this book.
  This chapter describes advanced configuration methods that would usually not
  be required in a deployment, but that might assist in situations that require
  a high level of customization.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="adv-startup-configuration"></a>23.1.&nbsp;Advanced Startup Configuration</h2></div></div></div><p>A customizable startup configuration file (named
       <code class="filename">launcher.json</code>) enables you to specify how the OSGi
       Framework is started.
       You specify the startup configuration file with the <code class="literal">-c</code>
       option of the <span class="command"><strong>startup</strong></span> command.</p><p>Unless you are working with a highly customized deployment, you
       should not modify the default framework configuration.</p><p>If no configuration file is specified, the default configuration
       (defined in <code class="filename">/path/to/openidm/bin/launcher.json</code>) is
       used. The following command starts OpenIDM with an alternative startup
       configuration file:</p><div class="screen"><pre>$ ./startup.sh -c /Users/admin/openidm/bin/launcher.json</pre></div><p>You can modify the default startup configuration file to specify
       a different startup configuration.</p><p>The customizable properties of the default startup configuration
       file are as follows:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">"location" : "bundle"</code> - resolves to the
           install location. You can also load OpenIDM from a specified zip
           file (<code class="literal">"location" : "openidm.zip"</code>) or you can
           install a single jar file
           (<code class="literal">"location" : "openidm-system-2.2.jar"</code>).</p></li><li class="listitem"><p><code class="literal">"includes" : "**/openidm-system-*.jar"</code> -
           the specified folder is scanned for jar files relating to the system
           startup. If the value of <code class="literal">"includes"</code> is
           <code class="literal">*.jar</code>, you must specifically exclude any jars in
           the bundle that you do not want to install, by setting the
           <code class="literal">"excludes"</code> property.</p></li><li class="listitem"><p><code class="literal">"start-level" : 1</code> - specifies a start level
           for the jar files identified previously.</p></li><li class="listitem"><p><code class="literal">"action" : "install.start"</code> - a
           period-separated list of actions to be taken on the jar files.
           Values can be one or more of
           <code class="literal">"install.start.update.uninstall"</code>.</p></li><li class="listitem"><p><code class="literal">"config.properties"</code> - takes either a path to
           a configuration file (relative to the project location) or a list
           of configuration properties and their values. The list must be in
           the format
           <code class="literal"><em class="replaceable"><code>"string"</code></em>:<em class="replaceable"><code>"string"</code></em></code>,
           for example:</p><pre class="brush: javascript;">
           "config.properties" :
 	           {
 	               "property" : "value"
 	           },
           </pre></li><li class="listitem"><p><code class="literal">"system.properties"</code> - takes either a path to
           a <code class="filename">system.properties</code> file (relative to the project
           location) or a list of system properties and their values. The list
           must be in the format
           <code class="literal"><em class="replaceable"><code>"string"</code></em>:<em class="replaceable"><code>"string"</code></em></code>,
           for example:</p><pre class="brush: javascript;">
           "system.properties" :
 	           {
 	               "property" : "value"
 	           },
           </pre></li><li class="listitem"><p><code class="literal">"boot.properties"</code> - takes either a path to
           a <code class="filename">boot.properties</code> file (relative to the project
           location) or a list of boot properties and their values.The list
           must be in the format
           <code class="literal"><em class="replaceable"><code>"string"</code></em>:<em class="replaceable"><code>object</code></em></code>,
           for example:</p><pre class="brush: javascript;">
           "boot.properties" :
 	           {
 	               "property" : true
 	           },
           </pre></li></ul></div></div></div><div lang="en" class="appendix"><div class="titlepage"><div><div><h1 class="title"><a name="appendix-file-layout"></a>Appendix&nbsp;A.&nbsp;File Layout</h1></div></div></div><a class="indexterm" name="d505e18737"></a><a class="indexterm" name="d505e18740"></a><div class="variablelist"><p>
   When you unpack and start OpenIDM 3.0.0, you create
   the following files and directories. Note that the precise paths will depend
   on the install, project, and working directories that you have selected
   during startup. For more information, see <a href="../integrators-guide/index.html#startup-configuration" class="link">
   <em class="citetitle">Specifying the OpenIDM Startup Configuration</em></a>.
  </p><dl class="variablelist"><dt><span class="term">
    <code class="filename">openidm/audit/</code>
   </span></dt><dd><p>
     OpenIDM audit log directory default location, created at run time, as
     configured in
     <code class="filename">openidm/conf/audit.json</code>
    </p></dd><dt><span class="term"><code class="filename">openidm/audit/access.csv</code></span></dt><dd><p>Default OpenIDM access audit log</p></dd><dt><span class="term"><code class="filename">openidm/audit/activity.csv</code></span></dt><dd><p>Default OpenIDM activity audit log</p></dd><dt><span class="term"><code class="filename">openidm/audit/recon.csv</code></span></dt><dd><p>Default OpenIDM reconciliation audit log</p></dd><dt><span class="term"><code class="filename">openidm/bin/</code></span></dt><dd><p>OpenIDM core libraries and scripts</p></dd><dt><span class="term"><code class="filename">openidm/bin/create-openidm-logrotate.sh</code></span></dt><dd><p>Script to create an <code class="filename">openidmlog</code> log 
    rotation scheduler for inclusion under 
    <code class="filename">/etc/logrotate.d/</code></p></dd><dt><span class="term"><code class="filename">openidm/bin/create-openidm-rc.sh</code></span></dt><dd><p>Script to create an <code class="filename">openidm</code> resource 
    definition file for inclusion under <code class="filename">/etc/init.d/</code></p></dd><dt><span class="term"><code class="filename">openidm/bin/defaults/script</code></span></dt><dd><p>Default scripts required to run specific services. In general, you 
    should not modify these scripts. Instead, add customized scripts to the 
    <code class="filename">openidm/script</code> folder.</p></dd><dt><span class="term"><code class="filename">openidm/bin/defaults/script/info/login.js</code></span></dt><dd><p>Provides information about the current OpenIDM session.
    </p></dd><dt><span class="term"><code class="filename">openidm/bin/defaults/script/info/ping.js</code></span></dt><dd><p>Provides basic information about the health of an OpenIDM 
    system</p></dd><dt><span class="term"><code class="filename">openidm/bin/defaults/script/policy.js</code></span></dt><dd><p>Defines each policy and specifies how policy validation is 
    performed</p></dd><dt><span class="term"><code class="filename">openidm/bin/defaults/script/policyFilter.js</code></span></dt><dd><p>Enforces policy validation</p></dd><dt><span class="term"><code class="filename">openidm/bin/defaults/script/router-authz.js</code></span></dt><dd><p>Provides the functions that enforce access rules</p></dd><dt><span class="term"><code class="filename">openidm/bin/defaults/script/ui/*</code></span></dt><dd><p>Scripts required by the UI</p></dd><dt><span class="term"><code class="filename">openidm/bin/defaults/script/workflow/*</code></span></dt><dd><p>Default workflow scripts</p></dd><dt><span class="term"><code class="filename">openidm/bin/felix.jar</code>, </span><span class="term"><code class="filename">openidm/bin/openidm.jar</code>, </span><span class="term"><code class="filename">openidm/bin/org.apache.felix.gogo.runtime-0.10.0.jar</code>, </span><span class="term"><code class="filename">openidm/bin/org.apache.felix.gogo.shell-0.10.0.jar</code></span></dt><dd><p>Files relating to the Apache Felix OSGi framework</p></dd><dt><span class="term"><code class="filename">openidm/bin/launcher.bat</code>, </span><span class="term"><code class="filename">openidm/bin/launcher.jar</code>, </span><span class="term"><code class="filename">openidm/bin/launcher.json</code></span></dt><dd><p>Files relating to the startup configuration</p></dd><dt><span class="term"><code class="filename">openidm/bin/LICENSE.TXT</code>, </span><span class="term"><code class="filename">openidm/bin/NOTICE.TXT</code></span></dt><dd><p>Files relating to the Apache Software License</p></dd><dt><span class="term"><code class="filename">openidm/bin/MonitorService.bat</code>, </span><span class="term"><code class="filename">openidm/bin/prunmgr.exe</code>, </span><span class="term"><code class="filename">openidm/bin/amd64/prunsrv.exe</code>, </span><span class="term"><code class="filename">openidm/bin/i386/prunsrv.exe</code>, </span><span class="term"><code class="filename">openidm/bin/ia64/prunsrv.exe</code></span></dt><dd><p>Files required by the user interface to monitor and 
    configure installed services</p></dd><dt><span class="term"><code class="filename">openidm/bin/startup/</code>, </span><span class="term"><code class="filename">openidm/bin/startup/OS X - Run OpenIDM In Background.command</code>, </span><span class="term"><code class="filename">openidm/bin/startup/OS X - Run OpenIDM In Terminal Window.command</code>, </span><span class="term"><code class="filename">openidm/bin/startup/OS X - Stop OpenIDM.command</code></span></dt><dd><p>Clickable commands for Mac OS X</p></dd><dt><span class="term"><code class="filename">openidm/bin/workflow/</code></span></dt><dd><p>Files related to the Activiti workflow engine</p></dd><dt><span class="term"><code class="filename">openidm/bundle/</code></span></dt><dd><p>OSGi bundles and modules required by OpenIDM. Upgrade can 
    install new and upgraded bundles here.</p></dd><dt><span class="term"><code class="filename">openidm/cli.bat</code>, </span><span class="term"><code class="filename">openidm/cli.sh</code></span></dt><dd><p>Management commands for operations such as validating 
    configuration files</p></dd><dt><span class="term"><code class="filename">openidm/conf/</code></span></dt><dd><p>OpenIDM configuration files, including .properties files and JSON
    files. You can also access JSON views through the REST interface.</p></dd><dt><span class="term"><code class="filename">openidm/conf/audit.json</code></span></dt><dd><p>Audit event publisher configuration file</p></dd><dt><span class="term"><code class="filename">openidm/conf/authentication.json</code></span></dt><dd><p>Authentication configuration file for access to the REST API</p></dd><dt><span class="term"><code class="filename">openidm/conf/boot/boot.properties</code></span></dt><dd><p>OpenIDM bootstrap properties</p></dd><dt><span class="term"><code class="filename">openidm/conf/config.properties</code></span></dt><dd><p>Felix and OSGi bundle configuration properties</p></dd><dt><span class="term"><code class="filename">openidm/conf/endpoint-*.json</code></span></dt><dd><p>Endpoint configuration files required by the UI for the default 
    workflows</p></dd><dt><span class="term"><code class="filename">openidm/conf/jetty.xml</code></span></dt><dd><p>Jetty configuration controlling access to the REST interface</p></dd><dt><span class="term"><code class="filename">openidm/conf/logging-config.xml</code></span></dt><dd><p>Experimental log configuration</p></dd><dt><span class="term"><code class="filename">openidm/conf/logging.properties</code></span></dt><dd><p>OpenIDM log configuration properties</p></dd><dt><span class="term"><code class="filename">openidm/conf/managed.json</code></span></dt><dd><p>Managed object configuration file</p></dd><dt><span class="term"><code class="filename">openidm/conf/policy.json</code></span></dt><dd><p>Default policy configuration</p></dd><dt><span class="term"><code class="filename">openidm/conf/process-access.json</code></span></dt><dd><p>Workflow access configuration</p></dd><dt><span class="term"><code class="filename">openidm/conf/repo.orientdb.json</code></span></dt><dd><p>OrientDB internal repository configuration file</p></dd><dt><span class="term"><code class="filename">openidm/conf/router.json</code></span></dt><dd><p>Router service configuration file</p></dd><dt><span class="term"><code class="filename">openidm/conf/scheduler.json</code></span></dt><dd><p>Scheduler service configuration</p></dd><dt><span class="term"><code class="filename">openidm/conf/script.json</code></span></dt><dd><p>Script configuration file with default script directories.</p></dd><dt><span class="term"><code class="filename">openidm/conf/system.properties</code></span></dt><dd><p>System configuration properties used when starting OpenIDM
    services</p></dd><dt><span class="term"><code class="filename">openidm/conf/ui-configuration.json</code></span></dt><dd><p>Main configuration file for the browser-based user interface</p></dd><dt><span class="term"><code class="filename">openidm/conf/ui-countries.json</code></span></dt><dd><p>Configurable list of countries available when registering users in 
    the user interface</p></dd><dt><span class="term"><code class="filename">openidm/conf/ui-secquestions.json</code></span></dt><dd><p>Configurable list of security questions available when registering 
    users in the user interface</p></dd><dt><span class="term"><code class="filename">openidm/conf/workflow.json</code></span></dt><dd><p>Configuration of the Activiti workflow engine</p></dd><dt><span class="term"><code class="filename">openidm/connectors/</code></span></dt><dd><p>OpenICF connector libraries. OSGi enabled connector libraries can
    also be stored in <code class="filename">openidm/bundle/</code>.</p></dd><dt><span class="term"><code class="filename">openidm/db/</code></span></dt><dd><p>Internal repository files, including both OrientDB files and data
    definition language scripts for JDBC based repositories such as MySQL</p></dd><dt><span class="term"><code class="filename">openidm/felix-cache/</code></span></dt><dd><p>Bundle cache directory created when the Felix framework is 
    started</p></dd><dt><span class="term"><code class="filename">openidm/lib</code></span></dt><dd><p>
     Location in which third-party libraries (required, for example, by custom
     connectors) should be placed.
    </p></dd><dt><span class="term"><code class="filename">openidm/logs/</code></span></dt><dd><p>OpenIDM service log directory</p></dd><dt><span class="term"><code class="filename">openidm/logs/openidm0.log.*</code></span></dt><dd><p>OpenIDM service log files as configured in
    <code class="filename">openidm/conf/logging.properties</code></p></dd><dt><span class="term"><code class="filename">openidm/samples/</code></span></dt><dd><p>OpenIDM sample configurations</p></dd><dt><span class="term"><code class="filename">openidm/samples/audit-sample/</code></span></dt><dd><p>
     Sample demonstrates configuring a MySQL database to receive the audit logs
     for access, activity, and recon.
    </p></dd><dt><span class="term"><code class="filename">openidm/samples/customendpoint/</code></span></dt><dd><p>Sample custom endpoint configuration. For more information, see 
    <a href="../integrators-guide/index.html#adding-custom-endpoints" class="link"><em class="citetitle">Adding Custom Endpoints</em></a>.</p></dd><dt><span class="term"><code class="filename">openidm/samples/infoservice/</code></span></dt><dd><p>Sample that shows how to use the configurable information service. 
    For more information, see <a href="../integrators-guide/index.html#info-service" class="link"><em class="citetitle">Obtaining Information About an OpenIDM Instance</em></a>.</p></dd><dt><span class="term"><code class="filename">openidm/samples/misc/</code></span></dt><dd><p>Sample configuration files</p></dd><dt><span class="term"><code class="filename">openidm/samples/provisioners/</code></span></dt><dd><p>Sample connector configuration files</p></dd><dt><span class="term"><code class="filename">openidm/samples/sample1/</code></span></dt><dd><p>XML file connector sample</p></dd><dt><span class="term"><code class="filename">openidm/samples/sample2/</code></span></dt><dd><p>OpenDJ connector sample with no back link</p></dd><dt><span class="term"><code class="filename">openidm/samples/sample2b/</code></span></dt><dd><p>OpenDJ connector sample with back link</p></dd><dt><span class="term"><code class="filename">openidm/samples/sample2c/</code></span></dt><dd><p>OpenDJ connector sample synchronizing users' LDAP group membership</p></dd><dt><span class="term"><code class="filename">openidm/samples/sample2d/</code></span></dt><dd><p>OpenDJ connector sample synchronizing LDAP groups</p></dd><dt><span class="term"><code class="filename">openidm/samples/sample3/</code></span></dt><dd><p>Scripted SQL connector sample for MySQL</p></dd><dt><span class="term"><code class="filename">openidm/samples/sample4/</code></span></dt><dd><p>CSV connector sample</p></dd><dt><span class="term"><code class="filename">openidm/samples/sample5/</code></span></dt><dd><p>LDAP to OpenIDM to Active Directory attribute flow sample using XML
    resources rather than actual directories</p></dd><dt><span class="term"><code class="filename">openidm/samples/sample6/</code></span></dt><dd><p>LiveSync sample for use with one or two LDAP servers</p></dd><dt><span class="term"><code class="filename">openidm/samples/sample7/</code></span></dt><dd><p>Sample exposing identities with a SCIM-line schema</p></dd><dt><span class="term"><code class="filename">openidm/samples/sample8/</code></span></dt><dd><p>Sample demonstrating logging in scripts</p></dd><dt><span class="term"><code class="filename">openidm/samples/sample9/</code></span></dt><dd><p>Sample showing asynchronous reconciliation with workflows</p></dd><dt><span class="term"><code class="filename">openidm/samples/schedules/</code></span></dt><dd><p>Sample schedule configuration files</p></dd><dt><span class="term"><code class="filename">openidm/samples/security/</code></span></dt><dd><p>Sample keystore, truststore, and certificates</p></dd><dt><span class="term"><code class="filename">openidm/samples/syncfailure/</code></span></dt><dd><p>
     Sample showing the sync failure handler for liveSync
    </p></dd><dt><span class="term"><code class="filename">openidm/samples/taskscanner/</code></span></dt><dd><p>Sample sunset scanning task. For more information, see <a href="../integrators-guide/index.html#task-scanner" class="link"><em class="citetitle">Scanning Data to Trigger Tasks</em></a>.</p></dd><dt><span class="term"><code class="filename">openidm/samples/workflow/</code></span></dt><dd><p>Typical use case of a workflow for provisioning</p></dd><dt><span class="term"><code class="filename">openidm/script/</code></span></dt><dd><p>
     OpenIDM location for script files referenced in the configuration
    </p></dd><dt><span class="term"><code class="filename">openidm/script/access.js</code></span></dt><dd><p>Default authorization policy script</p></dd><dt><span class="term"><code class="filename">openidm/security/</code></span></dt><dd><p>OpenIDM security configuration, keystore, and truststore</p></dd><dt><span class="term"><code class="filename">openidm/shutdown.sh</code></span></dt><dd><p>Script to shutdown OpenIDM services based on the process
    identifier</p></dd><dt><span class="term"><code class="filename">openidm/startup.bat</code></span></dt><dd><p>Script to start OpenIDM services on Windows</p></dd><dt><span class="term"><code class="filename">openidm/startup.sh</code></span></dt><dd><p>Script to start OpenIDM services on UNIX</p></dd><dt><span class="term"><code class="filename">openidm/ui/</code></span></dt><dd><p>OpenIDM graphical UI files</p></dd><dt><span class="term"><code class="filename">openidm/workflow/</code></span></dt><dd><p>OpenIDM location for BPMN 2.0 workflows and .bar files</p></dd></dl></div></div><div lang="en" class="appendix"><div class="titlepage"><div><div><h1 class="title"><a name="appendix-ports-used"></a>Appendix&nbsp;B.&nbsp;Ports Used</h1></div></div></div><div class="variablelist"><p>
   By default, OpenIDM 3.0.0 listens on the following ports
   (specified in the files
   <code class="filename">/path/to/openidm/conf/boot/boot.properties</code> and
   <code class="filename">/path/to/openidm/conf/config.properties</code>):
  </p><p>
   If you change the default port numbers, you must make the same modification
   in both the <code class="filename">boot.properties</code> and
   <code class="filename">config.properties</code> files.
  </p><dl class="variablelist"><dt><span class="term"><code class="literal">8080</code></span></dt><dd><a class="indexterm" name="d505e19423"></a><p>HTTP access to the REST API, requiring OpenIDM authentication. This
    port is not secure, exposing clear text passwords and all data that is not
    encrypted. This port is therefore not suitable for production use.</p></dd><dt><span class="term"><code class="literal">8443</code></span></dt><dd><a class="indexterm" name="d505e19435"></a><p>HTTPS access to the REST API, requiring OpenIDM authentication</p></dd><dt><span class="term"><code class="literal">8444</code></span></dt><dd><a class="indexterm" name="d505e19447"></a><p>
     HTTPS access to the REST API, requiring SSL mutual authentication. Clients
     that present certificates found in the truststore under
     <code class="filename">openidm/security/</code> are granted access to the system.
    </p></dd></dl></div><p>
  The Jetty configuration (in <code class="filename">openidm/conf/jetty.xml</code>)
  references the ports that are specified in the <code class="filename">boot.properties</code>
  and <code class="filename">config.properties</code> files.
 </p></div><div lang="en" class="appendix"><div class="titlepage"><div><div><h1 class="title"><a name="appendix-objects"></a>Appendix&nbsp;C.&nbsp;Data Models and Objects Reference</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="section"><a href="#managed-objects">C.1. Managed Objects</a></span></dt><dt><span class="section"><a href="#configuration-objects-reference">C.2. Configuration Objects</a></span></dt><dt><span class="section"><a href="#system-objects">C.3. System Objects</a></span></dt><dt><span class="section"><a href="#audit-objects">C.4. Audit Objects</a></span></dt><dt><span class="section"><a href="#links">C.5. Links</a></span></dt></dl></div><p>OpenIDM allows you to customize a variety of objects that can be
 addressed via a URL or URI, and that have a common set of functions that
 OpenIDM can perform on them such as CRUD, query, and action.</p><p>Depending on how you intend to use them, different objects are
 appropriate.</p><div class="table"><a name="table-object-types"></a><div class="table-title">Table&nbsp;C.1.&nbsp;OpenIDM Objects</div><div class="table-contents"><a class="indexterm" name="d505e19479"></a><table summary="OpenIDM Objects" width="100%" border="0"><colgroup><col width="28%"><col width="43%"><col width="29%"></colgroup><thead><tr><th>Object Type</th><th>Intended Use</th><th>Special Functionality</th></tr></thead><tbody><tr><td>Managed objects</td><td>Serve as targets and sources for synchronization, and to build
     virtual identities.</td><td>Provide appropriate auditing, script hooks, declarative mappings
     and so forth in addition to the REST interface.</td></tr><tr><td>Configuration objects</td><td>Ideal for look-up tables or other custom configuration, which
     can be configured externally like any other system configuration.</td><td>Adds file view, REST interface, and so forth</td></tr><tr><td>Repository objects</td><td>The equivalent of arbitrary database table access. Appropriate
     for managing data purely through the underlying data store or repository 
     API.</td><td>Persistence and API access</td></tr><tr><td>System objects</td><td>Representation of target resource objects, such as accounts,
     but also resource objects such as groups.</td><td>&nbsp;</td></tr><tr><td>Audit objects</td><td>Houses audit data in the OpenIDM internal repository.</td><td>&nbsp;</td></tr><tr><td>Links</td><td>Defines a relation between two objects.</td><td>&nbsp;</td></tr></tbody></table></div></div><br class="table-break"><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="managed-objects"></a>C.1.&nbsp;Managed Objects</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#managed-object-schema">C.1.1. Managed Object Schema</a></span></dt><dt><span class="section"><a href="#managed-object-data-consistency">C.1.2. Data Consistency</a></span></dt><dt><span class="section"><a href="#managed-object-triggers">C.1.3. Managed Object Triggers</a></span></dt><dt><span class="section"><a href="#managed-object-encryption">C.1.4. Managed Object Encryption</a></span></dt><dt><span class="section"><a href="#managed-object-configuration">C.1.5. Managed Object Configuration</a></span></dt><dt><span class="section"><a href="#custom-managed-objects">C.1.6. Custom Managed Objects</a></span></dt><dt><span class="section"><a href="#managed-objects-access-rest">C.1.7. Accessing Managed Objects Through the REST API</a></span></dt></dl></div><a class="indexterm" name="d505e19542"></a><p>A <em class="firstterm">managed object</em> in OpenIDM is an object which
  represents the identity-related data managed by OpenIDM. Managed objects
  are stored by OpenIDM in its data store. All managed objects are JSON-based
  data structures.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="managed-object-schema"></a>C.1.1.&nbsp;Managed Object Schema</h3></div></div></div><p>Managed objects have an associated schema to enforce a specific
   data structure. Schema is specified using the <a class="link" href="http://tools.ietf.org/html/draft-zyp-json-schema-03" target="_blank">JSON
   Schema</a> specification. This is currently an Internet-Draft, with
   implementations in multiple programming languages.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="managed-object-reserved-properties"></a>C.1.1.1.&nbsp;Managed Object Reserved Properties</h4></div></div></div><p>Top-level properties in a managed object that begin with an underscore
    ( <code class="literal">_</code> ) are reserved by OpenIDM for internal use, and are
    not explicitly part of its schema. Internal properties are read-only, and
    are ignored when provided by the REST API client.</p><div class="variablelist"><p>The following properties exist for all managed objects in
     OpenIDM.</p><dl class="variablelist"><dt><span class="term">_id</span></dt><dd><p>string</p><p>The unique identifier for the object. This value forms a part
       of the managed object's URI.</p></dd><dt><span class="term">_rev</span></dt><dd><p>string</p><p>The revision of the object. This is the same value that is
       exposed as the object's ETag through the REST API. The content of this
       attribute is not defined. No consumer should make any assumptions
       of its content beyond equivalence comparison. This attribute may
       be provided by the underlying data store.</p></dd><dt><span class="term">_schema_id</span></dt><dd><p>string</p><p>The a reference to the schema object that the managed object
       is associated with.</p></dd><dt><span class="term">_schema_rev</span></dt><dd><p>string</p><p>The revision of the schema that was used for validation when
       the object was last stored.</p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="managed-object-schema-validation"></a>C.1.1.2.&nbsp;Managed Object Schema Validation</h4></div></div></div><p>Schema validation is performed unequivocally whenever an object
    is stored, and conditionally whenever an object is retrieved from the
    data store and exhibits a <code class="literal">_schema_rev</code> value that
    differs from the <code class="literal">_rev</code> of the schema that the OpenIDM
    instance currently has for that managed object type. Whenever schema
    validation is performed, the <code class="literal">_schema_rev</code> of the object
    is updated to contain the <code class="literal">_rev</code> value of the current
    schema.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="managed-object-derived-properties"></a>C.1.1.3.&nbsp;Managed Object Derived Properties</h4></div></div></div><p>Properties can be defined to be strictly derived from other
    properties within the object. This allows computed and composite
    values to be created in the object. Whenever an object undergoes a
    change, all derived properties are recomputed. The values of derived
    properties are stored in the data store, and are not recomputed upon
    retrieval.</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="managed-object-data-consistency"></a>C.1.2.&nbsp;Data Consistency</h3></div></div></div><p>Single-object operations shall be consistent within the scope of
   the operation performed, limited by capabilities of the underlying
   data store. Bulk operations shall not have any consistency
   guarantees. OpenIDM does not expose any transactional semantics
   in the managed object access API.</p><p>All access through the REST API uses the ETag and associated
   conditional headers: <code class="literal">If-Match</code>,
   <code class="literal">If-None-Match</code>. In operations that
   modify model objects, conditional headers are mandatory.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="managed-object-triggers"></a>C.1.3.&nbsp;Managed Object Triggers</h3></div></div></div><p><em class="firstterm">Triggers</em> are user-definable functions that
   validate or modify object or property state.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="managed-object-state-triggers"></a>C.1.3.1.&nbsp;State Triggers</h4></div></div></div><p>Managed objects are resource-oriented. A set of triggers is
    defined to intercept the supported request methods on managed
    objects. Such triggers are intended to perform authorization, redact,
    or modify objects before the action is performed. The object
    being operated on is in scope for each trigger, meaning that the
    object is retrieved by the data store before the trigger is fired.</p><p>If retrieval of the object fails, the failure occurs before any
    trigger is called. Triggers are executed before any optimistic
    concurrency mechanisms are invoked. The reason for this is to
    prevent a potential attacker from getting information about an
    object (including its presence in the data store) before
    authorization is applied.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">onCreate</span></dt><dd><p>Called upon a request to create a new object. Throwing an
       exception causes the create to fail.</p></dd><dt><span class="term">postCreate</span></dt><dd><p>
        Called after the creation of a new object is complete.
       </p></dd><dt><span class="term">onRead</span></dt><dd><p>Called upon a request to retrieve a whole object or portion of
       an object. Throwing an exception causes the object to not be
       included in the result. This method is also called when lists of
       objects are retrieved via requests to its container object; in this
       case, only the requested properties are included in the object.
       Allows for uniform access control for retrieval of objects,
       regardless of the method in which they were requested.</p></dd><dt><span class="term">onUpdate</span></dt><dd><p>Called upon a request to store an object. The "old" and "new"
       objects are in-scope for the trigger. The "old" object represents a
       complete object as retrieved from the data store. The trigger can
       elect to change "new" object properties. If as a result of the
       trigger the object's "old" and "new" values are identical (that is,
       update is reverted), the update ends prematurely, though
       successfully. Throwing an exception causes the update to fail.</p></dd><dt><span class="term">postUpdate</span></dt><dd><p>
        Called after an update request is complete.
       </p></dd><dt><span class="term">onDelete</span></dt><dd><p>Called upon a request to delete an object. Throwing an
       exception causes the deletion to fail.</p></dd><dt><span class="term">postDelete</span></dt><dd><p>
        Called after an object is deleted.
       </p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="managed-object-storage-triggers"></a>C.1.3.2.&nbsp;Object Storage Triggers</h4></div></div></div><div class="variablelist"><p>An object-scoped trigger applies to an entire object. Unless
    otherwise specified, the object itself is in scope for the trigger.</p><dl class="variablelist"><dt><span class="term">onValidate</span></dt><dd><p>Validates an object prior to its storage in the data store.
           Throws an exception in the event of a validation failure.</p></dd><dt><span class="term">onStore</span></dt><dd><p>Called just prior to when an object is stored in the data
        store. Typically used to transform an object just prior to its
        storage (for example, encryption).</p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="managed-object-property-storage-triggers"></a>C.1.3.3.&nbsp;Property Storage Triggers</h4></div></div></div><p>A property-scoped trigger applies to a specific property within
    an object. Only the property itself is in scope for the trigger. No
    other properties in the object should be accessed during execution
    of the trigger. Unless otherwise specified, the order of execution
    of property-scoped triggers is intentionally left undefined.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">onValidate</span></dt><dd><p>Validates a given property value after its retrieval from and
       prior to its storage in the data store. Throws an exception in the
       event of a validation failure.</p></dd><dt><span class="term">onRetrieve</span></dt><dd><p>Called in the result of a query request. Executed only when the
       <code class="literal">executeOnRetrieve</code> condition shows a full managed
       object.</p></dd><dt><span class="term">onStore</span></dt><dd><p>Called prior to when an object is stored in the data store.
           Typically used to transform a given property prior to its
           object's storage.</p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="managed-object-storage-trigger-sequences"></a>C.1.3.4.&nbsp;Storage Trigger Sequences</h4></div></div></div><p>Triggers are executed in the following order:</p><div class="orderedlist"><a name="managed-object-retrieval-sequence"></a><div class="orderedlist-title">Object Retrieval Sequence</div><ol class="orderedlist" type="1"><li class="listitem"><p>Retrieve the raw object from the data store</p></li><li class="listitem"><p>
       The <code class="literal">executeOnRetrieve</code> boolean is used to see
       if a full managed object is returned. The sequence continues if
       the boolean is set to <code class="literal">true</code>.
      </p></li><li class="listitem"><p>Call object <code class="literal">onRetrieve</code> trigger</p></li><li class="listitem"><p>Per-property within the object:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Call property <code class="literal">onRetrieve</code> trigger</p></li><li class="listitem"><p>Perform schema validation if <code class="literal">_schema_rev</code>
        does not match (see the <a class="link" href="#managed-object-schema-validation" title="C.1.1.2.&nbsp;Managed Object Schema Validation"><em class="citetitle">Schema
        Validation</em></a> section)</p></li></ul></div></li></ol></div><div class="orderedlist"><a name="managed-object-storage-sequence"></a><div class="orderedlist-title">Object Storage Sequence</div><ol class="orderedlist" type="1"><li class="listitem"><p>Per-property within the object:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Call property <code class="literal">onValidate</code> trigger</p></li><li class="listitem"><p>Call object <code class="literal">onValidate</code> trigger</p></li></ul></div></li><li class="listitem"><p>Per-property trigger within the object:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Call property <code class="literal">onStore</code> trigger</p></li><li class="listitem"><p>Call object <code class="literal">onStore</code> trigger</p></li><li class="listitem"><p>Store the object with any resulting changes to the data
          store</p></li></ul></div></li></ol></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="managed-object-encryption"></a>C.1.4.&nbsp;Managed Object Encryption</h3></div></div></div><p>Sensitive object properties can be encrypted prior to storage,
   typically through the property <code class="literal">onStore</code> trigger. The
   trigger has access to configuration data, which can include arbitrary
   attributes that you define, such as a symmetric encryption key. Such
   attributes can be decrypted during retrieval from the data store through
   the property <code class="literal">onRetrieve</code> trigger.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="managed-object-configuration"></a>C.1.5.&nbsp;Managed Object Configuration</h3></div></div></div><p>Configuration of managed objects is provided through an array of
   managed object configuration objects.</p><pre class="brush: javascript;">
{
  "objects": [ managed-object-config object, ... ]
}</pre><div class="variablelist"><dl class="variablelist"><dt><span class="term">objects</span></dt><dd><p>array of managed-object-config objects, required</p><p>Specifies the objects that the managed object service
       manages.</p></dd></dl></div><div class="variablelist"><a name="managed-object-config-object-properties"></a><div class="variablelist-title">Managed-Object-Config Object Properties</div><p>Specifies the configuration of each managed object.</p><pre class="brush: javascript;">
{
  "name"      : string,
  "schema"    : json-schema object,
  "onCreate"  : script object,
  "postCreate": script object,
  "onRead"    : script object,
  "onUpdate"  : script object,
  "postUpdate": script object,
  "onDelete"  : script object,
  "postDelete": script object,
  "onValidate": script object,
  "onRetrieve": script object,
  "onStore"   : script object,
  "properties": [ property-configuration object, ... ]
}</pre><dl class="variablelist"><dt><span class="term">name</span></dt><dd><p>string, required</p><p>The name of the managed object. Used to identify the
      managed object in URIs and identifiers.</p></dd><dt><span class="term">schema</span></dt><dd><p>json-schema object, optional</p><p>The schema to use to validate the structure and content of
      the managed object. The schema-object format is specified by the
      JSON Schema specification.</p></dd><dt><span class="term">onCreate</span></dt><dd><p>script object, optional</p><p>A script object to trigger when the creation of an object
      is being requested. The object to be created is provided in the
      root scope as an object property. The script may change the
      object. If an exception is thrown, the create aborts with an
      exception.</p></dd><dt><span class="term">postCreate</span></dt><dd><p>script object, optional</p><p>A script object to trigger after an object is created, but
       before any targets are synchronized.</p></dd><dt><span class="term">onRead</span></dt><dd><p>script object, optional</p><p>A script object to trigger when the read of an object is
      being requested. The object being read is provided in the root
      scope as an object property. The script may change the object.
      If an exception is thrown, the read aborts with an
      exception.</p></dd><dt><span class="term">onUpdate</span></dt><dd><p>script object, optional</p><p>A script object to trigger when an update to an object is
      requested. The old value of the object being updated is provided
      in the root scope as an <code class="literal">oldObject</code> property. The new
      value of the object being updated is provided in the root scope as a
      <code class="literal">newObject</code> property. The script may change the
      <code class="literal">newObject</code>. If an exception is thrown, the update
      aborts with an exception.</p></dd><dt><span class="term">postUpdate</span></dt><dd><p>script object, optional</p><p>A script object to trigger after an update to an object is
       complete, but before any targets are synchronized.</p></dd><dt><span class="term">onDelete</span></dt><dd><p>script object, optional</p><p>A script object to trigger when the deletion of an object
      is being requested. The object being deleted is provided in the
      root scope as an object property. If an exception is thrown, the
      deletion aborts with an exception.</p></dd><dt><span class="term">postDelete</span></dt><dd><p>script object, optional</p><p>A script object to trigger after a delete of an object is
       complete, but before any further synchronization.</p></dd><dt><span class="term">onValidate</span></dt><dd><p>script object, optional</p><p>A script object to trigger when the object requires
      validation. The object to be validated is provided in the root
      scope as an object property. If an exception is thrown, the
      validation fails.</p></dd><dt><span class="term">onRetrieve</span></dt><dd><p>script object, optional</p><p>A script object to trigger once an object is retrieved from
      the repository. The object that was retrieved is provided in the
      root scope as an object property. The script may change the
      object. If an exception is thrown, then object retrieval
      fails.</p></dd><dt><span class="term">onStore</span></dt><dd><p>script object, optional</p><p>A script object to trigger when an object is about to be
      stored in the repository. The object to be stored is provided in
      the root scope as an object property. The script may change the
      object. If an exception is thrown, then object storage
      fails.</p></dd><dt><span class="term">properties</span></dt><dd><p>array of property-config objects, optional</p><p>A list of property specifications.</p></dd></dl></div><div class="variablelist"><a name="managed-object-script-object-properties"></a><div class="variablelist-title">Script Object Properties</div><pre class="brush: javascript;">
{
  "type"  : "text/javascript",
  "source": string
 }</pre><dl class="variablelist"><dt><span class="term">type</span></dt><dd><p>string, required</p><p>
       Specifies the type of script to be executed. Supported types include
       <code class="literal">"text/javascript"</code> and <code class="literal">"groovy"</code>.
      </p></dd><dt><span class="term">source, file</span></dt><dd><p>string, required (only one, source or file is required)</p><p>Specifies the source code of the script to be executed (if the 
      keyword is "source"), or a pointer to the file that contains the script 
      (if the keyword is "file").</p></dd></dl></div><div class="variablelist"><a name="managed-object-property-config-properties"></a><div class="variablelist-title">Property Config Properties</div><pre class="brush: javascript;">
{
  "name"      : string,
  "onValidate": script object,
  "onRetrieve": script object,
  "onStore"   : script object,
  "encryption": property-encryption object,
  "scope"     : string
}</pre><dl class="variablelist"><dt><span class="term">name</span></dt><dd><p>string, required</p><p>The name of the property being configured.</p></dd><dt><span class="term">onValidate</span></dt><dd><p>script object, optional</p><p>A script object to trigger when the property requires
      validation. The property to be validated is provided in the root
      scope as the <code class="literal">property</code> property. If an exception is
      thrown, the validation fails.</p></dd><dt><span class="term">onRetrieve</span></dt><dd><p>script object, optional</p><p>A script object to trigger once a property is retrieved
       from the repository. The property that was retrieved is provided
       in the root scope as the <code class="literal">property</code> property. The
       script may change the property value. If an exception is thrown, then
       object retrieval fails.</p></dd><dt><span class="term">onStore</span></dt><dd><p>script object, optional</p><p>A script object to trigger when a property is about to be
       stored in the repository. The property to be stored is provided
       in the root scope as the <code class="literal">property</code> property. The
       script may change the property value. If an exception is thrown, then
       object storage fails.</p></dd><dt><span class="term">encryption</span></dt><dd><p>property-encryption object, optional</p><p>Specifies the configuration for encryption of the property
       in the repository. If omitted or null, the property is not
       encrypted.</p></dd><dt><span class="term">scope</span></dt><dd><p>string, optional</p><p>Specifies whether the property should be filtered from HTTP/external
       calls. The value can be either <code class="literal">"public"</code> or
       <code class="literal">"private"</code>. <code class="literal">"private"</code> indicates that
       the property should be filtered, <code class="literal">"public"</code> indicates
       no filtering. If no value is set, the property is assumed to be public
       and thus not filtered.</p></dd></dl></div><div class="variablelist"><a name="managed-object-property-encryption-properties"></a><div class="variablelist-title">Property Encryption Object</div><pre class="brush: javascript;">
{
  "cipher": string,
  "key"   : string
}</pre><dl class="variablelist"><dt><span class="term">cipher</span></dt><dd><p>string, optional</p><p>The cipher transformation used to encrypt the property. If
      omitted or null, the default cipher of
      <code class="literal">"AES/CBC/PKCS5Padding"</code> is used.</p></dd><dt><span class="term">key</span></dt><dd><p>string, required</p><p>The alias of the key in the OpenIDM cryptography service
      keystore used to encrypt the property.</p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="custom-managed-objects"></a>C.1.6.&nbsp;Custom Managed Objects</h3></div></div></div><a class="indexterm" name="d505e20173"></a><p>Managed objects in OpenIDM are inherently fully user definable and
   customizable. Like all OpenIDM objects, managed objects can maintain
   relationships to each other in the form of links. Managed objects are
   intended for use as targets and sources for synchronization operations to
   represent domain objects, and to build up virtual identities. The name comes
   from the intention that OpenIDM stores and manages these objects, as opposed
   to system objects that are present in external systems.</p><p>OpenIDM can synchronize and map directly between external systems
   (system objects), without storing intermediate managed objects. Managed
   objects are appropriate, however, as a way to cache the data&#8212;for
   example, when mapping to multiple target systems, or when decoupling the
   availability of systems&#8212;to more fully report and audit on all object
   changes during reconciliation, and to build up views that are different from
   the original source, such as transformed and combined or virtual views.
   Managed objects can also be allowed to act as an authoritative source if no
   other appropriate source is available.</p><p>Other object types exist for other settings that should be available
   to a script, such as configuration or look-up tables that do not need audit
   logging.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="managed-objects-setup"></a>C.1.6.1.&nbsp;Setting Up a Managed Object Type</h4></div></div></div><p>To set up a managed object, you declare the object in the
    <code class="filename">conf/managed.json</code> file where OpenIDM is installed.
    The following example adds a simple <code class="literal">foobar</code> object
    declaration after the user object type.</p><pre class="brush: javascript;">
{
    "objects": [
        {
            "name": "user"
        },
        {
            "name": "foobar"
        }
    ]
}
    </pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="managed-objects-declarative"></a>C.1.6.2.&nbsp;Manipulating Managed Objects Declaratively</h4></div></div></div><p>By mapping an object to another object, either an external system
    object or another internal managed object, you automatically tie the object
    life cycle and property settings to the other object. See the chapter on
    <a href="../integrators-guide/index.html#chap-synchronization" class="link"><em class="citetitle">Configuring Synchronization</em></a> for
    details.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="managed-objects-programmatic"></a>C.1.6.3.&nbsp;Manipulating Managed Objects Programmatically</h4></div></div></div><p>You can address managed objects as resources using URLs or URIs with
    the <code class="literal">managed/</code> prefix. This works whether you address the
    managed object internally as a script running in OpenIDM or externally
    through the REST interface.</p><p>You can use all resource API functions in script objects for
    create, read, update, delete operations, and also for arbitrary queries on
    the object set, but not currently for arbitrary actions. See the
    <a href="../integrators-guide/index.html#appendix-scripting" class="link"><em class="citetitle">Scripting Reference</em></a> appendix for
    details.</p><p>OpenIDM supports concurrency through a multi version concurrency
    control (MVCC) mechanism. In other words, each time an object changes,
    OpenIDM assigns it a new revision.</p><p>Objects can be arbitrarily complex as long as they use supported
    types, such as maps, lists, numbers, strings, and booleans as defined in
    <a class="link" href="http://www.json.org" target="_blank">JSON</a>.</p><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="managed-objects-programmatic-create"></a>C.1.6.3.1.&nbsp;Creating Objects</h5></div></div></div><p>The following script example creates an object type.</p><pre class="brush: javascript;">
openidm.create("managed/foobar", "myidentifier", mymap)</pre></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="managed-objects-programmatic-update"></a>C.1.6.3.2.&nbsp;Updating Objects</h5></div></div></div><p>The following script example updates an object type.</p><pre class="brush: javascript;">var expectedRev = origMap._rev
openidm.update("managed/foobar/myidentifier", expectedRev, mymap)</pre><p>The MVCC mechanism requires that <code class="literal">expectedRev</code>
     be set to the expected revision of the object to update. You obtain the
     revision from the object's <code class="literal">_rev</code> property. If something
     else changes the object concurrently, OpenIDM rejects the update, and you
     must either retry or inspect the concurrent modification.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="managed-objects-programmatic-patch"></a>C.1.6.3.3.&nbsp;Patching Objects</h5></div></div></div><p>You can partially update a managed object using the patch method, 
      which changes only the specified properties of the object. OpenIDM
      implements the JSON patch media type version 02, described at
      <a class="link" href="http://tools.ietf.org/html/rfc6902" target="_blank">http://tools.ietf.org/html/rfc6902</a>.
     </p><p>
      The following script example updates an object type.
     </p><pre class="brush: javascript;">
openidm.patch("managed/foobar/myidentifier", rev, value)</pre><p>The patch method supports a revision of <code class="literal">"null"</code>, 
     which effectively disables the MVCC mechanism, that is, changes are 
     applied, regardless of revision. In the REST interface, this matches the 
     <code class="literal">If-Match: "*"</code> condition supported by patch.</p><p>The API supports patch by query, so the caller does not need to 
     know the identifier of the object to change.</p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 --data '[{
  "operation":"replace",
  "field":"/password",
  "value":"Passw0rd"
  }]' \
 "https://localhost:8443/openidm/managed/user?_action=patch&amp;_queryId=for-userName&amp;uid=DDOE"</strong></pre></div><p>For the syntax on how to formulate the query
      <code class="literal">_queryId=for-userName&amp;uid=DDOE</code> see
      <a class="xref" href="#managed-objects-programmatic-query" title="C.1.6.3.6.&nbsp;Querying Object Sets">Section&nbsp;C.1.6.3.6, &#8220;Querying Object Sets&#8221;</a>.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="managed-objects-programmatic-delete"></a>C.1.6.3.4.&nbsp;Deleting Objects</h5></div></div></div><p>The following script example deletes an object type.</p><pre class="brush: javascript;">var expectedRev = origMap._rev
openidm.delete("managed/foobar/myidentifier", expectedRev)</pre><p>The MVCC mechanism requires that <code class="literal">expectedRev</code>
     be set to the expected revision of the object to update. You obtain the
     revision from the object's <code class="literal">_rev</code> property. If something
     else changes the object concurrently, OpenIDM rejects deletion, and you
     must either retry or inspect the concurrent modification.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="managed-objects-programmatic-read"></a>C.1.6.3.5.&nbsp;Reading Objects</h5></div></div></div><p>The following script example reads an object type.</p><pre class="brush: javascript;">
val = openidm.read("managed/foobar/myidentifier")</pre></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="managed-objects-programmatic-query"></a>C.1.6.3.6.&nbsp;Querying Object Sets</h5></div></div></div><p>The following script example queries object type instances.</p><pre class="brush: javascript;">
var params = {
    "_queryId": "my-custom-query-id",
    "mycustomtoken": "samplevalue"
};
val = openidm.query("managed/foobar", params);</pre><p>The example sets up a query with ID
     <code class="literal">my-custom-query-id</code>. The query definition (not shown)
     is found in the repository configuration. The query definition includes
     the parameter <code class="literal">mycustomtoken</code> for token
     substitution.</p><p>An example for a query can be found in chapter <a href="../integrators-guide/index.html#correlation-query-managed-object" class="link">
  <em class="citetitle">Managed Object as Correlation Query Target</em>
</a>.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="managed-objects-access-rest"></a>C.1.7.&nbsp;Accessing Managed Objects Through the REST API</h3></div></div></div><p>OpenIDM exposes all managed object functionality through the REST API
   unless you configure a policy to prevent such access. In addition to the
   common REST functionality of create, read, update, delete, patch, and query,
   the REST API also supports patch by query. See the <a href="../integrators-guide/index.html#appendix-rest" class="link"><em class="citetitle">REST
   API Reference</em></a> appendix for details.</p><p>OpenIDM requires authentication to access the REST API. Authentication
   configuration is shown in
   <code class="filename">openidm/conf/authentication.json</code>. The default
   authorization filter script is
   <code class="filename">openidm/script/router-authz.js</code>.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="configuration-objects-reference"></a>C.2.&nbsp;Configuration Objects</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#configuration-objects-when-to-use">C.2.1. When To Use Custom Configuration Objects</a></span></dt><dt><span class="section"><a href="#configuration-objects-naming">C.2.2. Custom Configuration Object Naming Conventions</a></span></dt><dt><span class="section"><a href="#configuration-objects-file-mapping">C.2.3. Mapping Configuration Objects To Configuration Files</a></span></dt><dt><span class="section"><a href="#configuration-objects-formats">C.2.4. Configuration Objects File &amp; REST Payload Formats</a></span></dt><dt><span class="section"><a href="#configuration-objects-access-rest">C.2.5. Accessing Configuration Objects Through the REST API</a></span></dt><dt><span class="section"><a href="#configuration-objects-access-programmatic">C.2.6. Accessing Configuration Objects Programmatically</a></span></dt><dt><span class="section"><a href="#configuration-objects-programmatic-create">C.2.7. Creating Objects</a></span></dt><dt><span class="section"><a href="#configuration-objects-programmatic-update">C.2.8. Updating Objects</a></span></dt><dt><span class="section"><a href="#configuration-objects-programmatic-delete">C.2.9. Deleting Objects</a></span></dt><dt><span class="section"><a href="#configuration-objects-programmatic-read">C.2.10. Reading Objects</a></span></dt></dl></div><p>OpenIDM provides an extensible configuration to allow you to leverage
  regular configuration mechanisms.</p><p>Unlike native OpenIDM configuration, which OpenIDM interprets
  automatically and can start new services, OpenIDM stores custom configuration
  objects and makes them available to your code through the API.</p><p>See the chapter on <a href="../integrators-guide/index.html#chap-configuration" class="link"><em class="citetitle">Configuration Options</em></a> for an introduction
  to standard configuration objects.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="configuration-objects-when-to-use"></a>C.2.1.&nbsp;When To Use Custom Configuration Objects</h3></div></div></div><p>Configuration objects are ideal for metadata and settings that need
   not be included in the data to reconcile. In other words, use configuration
   objects for data that does not require audit log, and does not serve
   directly as a target or source for mappings.</p><p>Although you can set and manipulate configuration objects both
   programmatically and also manually, configuration objects are expected to
   change slowly, perhaps through a mix of both manual file updates and also
   programmatic updates. To store temporary values that can change frequently
   and that you do not expect to be updated by configuration file changes,
   custom repository objects can be more appropriate.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="configuration-objects-naming"></a>C.2.2.&nbsp;Custom Configuration Object Naming Conventions</h3></div></div></div><p>By convention custom configuration objects are added under the
   reserved context, <code class="literal">config/custom</code>.</p><p>You can choose any name under
   <code class="literal">config/<em class="replaceable"><code>context</code></em></code>. Be sure,
   however, to choose a value for <em class="replaceable"><code>context</code></em> that
   does not clash with future OpenIDM configuration names.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="configuration-objects-file-mapping"></a>C.2.3.&nbsp;Mapping Configuration Objects To Configuration Files</h3></div></div></div><p>If you have not disabled the file based view for configuration, you
   can view and edit all configuration including custom configuration in
   <code class="filename">openidm/conf/*.json</code> files. The configuration maps to a
   file named
   <code class="filename"><em class="replaceable"><code>context</code></em>-<em class="replaceable"><code>config-name</code></em>.json</code>,
   where <em class="replaceable"><code>context</code></em> for custom configuration objects
   is <code class="literal">custom</code> by convention, and
   <em class="replaceable"><code>config-name</code></em> is the configuration object name.
   A configuration object named <code class="literal">escalation</code> thus maps to a
   file named <code class="filename">conf/custom-escalation.json</code>.</p><p>OpenIDM detects and automatically picks up changes to the file.</p><p>OpenIDM also applies changes made through APIs to the file.</p><p>By default, OpenIDM stores configuration objects in the repository.
   The file view is an added convenience aimed to help you in the development
   phase of your project.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="configuration-objects-formats"></a>C.2.4.&nbsp;Configuration Objects File &amp; REST Payload Formats</h3></div></div></div><p>By default, OpenIDM maps configuration objects to JSON
   representations.</p><p>OpenIDM represents objects internally in plain, native types like
   maps, lists, strings, numbers, booleans, null. OpenIDM constrains the
   object model to simple types so that mapping objects to external
   representations is trivial.</p><p>The following example shows a representation of a configuration
   object with a look-up map.</p><pre class="brush: javascript;">{
    "CODE123" : "ALERT",
    "CODE889" : "IGNORE"
}</pre><p>In the JSON representation, maps are represented with braces
   (<code class="literal">{ }</code>), and lists are represented with brackets
   (<code class="literal">[ ]</code>). Objects can be arbitrarily complex, as in the
   following example.</p><pre class="brush: javascript;">{
    "CODE123" : {
        "email" : ["sample@sample.com", "john.doe@somedomain.com"],
        "sms" : ["555666777"]
    }
    "CODE889" : "IGNORE"
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="configuration-objects-access-rest"></a>C.2.5.&nbsp;Accessing Configuration Objects Through the REST API</h3></div></div></div><p>You can list all available configuration objects, including system
   and custom configurations, using an HTTP GET on
   <code class="literal">/openidm/config</code>.</p><p>The <code class="literal">_id</code> property in the configuration object
   provides the link to the configuration details with an HTTP GET on
   <code class="literal">/openidm/config/<em class="replaceable"><code>id-value</code></em></code>.
   By convention, the <em class="replaceable"><code>id-value</code></em> for a custom
   configuration object called <code class="literal">escalation</code> is
   <code class="literal">custom/escalation</code>.</p><p>OpenIDM supports REST mappings for create, read, update, and delete
   of configuration objects. Currently OpenIDM does not support patch and
   custom query operations for configuration objects.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="configuration-objects-access-programmatic"></a>C.2.6.&nbsp;Accessing Configuration Objects Programmatically</h3></div></div></div><p>You can address configuration objects as resources using the URL or
   URI <code class="literal">config/</code> prefix both internally and also through
   the REST interface. The resource API provides script object functions for
   create, read, update, and delete operations.</p><p>OpenIDM supports concurrency through a multi version concurrency
   control mechanism. In other words, each time an object changes, OpenIDM
   assigns it a new revision.</p><p>Objects can be arbitrarily complex as long as they use supported
   types, such as maps, lists, numbers, strings, and booleans.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="configuration-objects-programmatic-create"></a>C.2.7.&nbsp;Creating Objects</h3></div></div></div><p>The following script example creates an object type.</p><pre class="brush: javascript;">
openidm.create("config/custom", "myconfig", mymap)</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="configuration-objects-programmatic-update"></a>C.2.8.&nbsp;Updating Objects</h3></div></div></div><p>The following script example updates a custom configuration object
    type.</p><pre class="brush: javascript;">openidm.update("config/custom/myconfig", mymap)</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="configuration-objects-programmatic-delete"></a>C.2.9.&nbsp;Deleting Objects</h3></div></div></div><p>The following script example deletes a custom configuration object
    type.</p><pre class="brush: javascript;">openidm.delete("config/custom/myconfig")</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="configuration-objects-programmatic-read"></a>C.2.10.&nbsp;Reading Objects</h3></div></div></div><p>The following script example reads an object type.</p><pre class="brush: javascript;">
val = openidm.read("config/custom/myconfig")</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="system-objects"></a>C.3.&nbsp;System Objects</h2></div></div></div><a class="indexterm" name="d505e20515"></a><p><em class="firstterm">System objects</em> are pluggable representations of
 objects on external systems. They follow the same RESTful resource based
 design principles as managed objects. There is a default implementation for
 the OpenICF framework, which allows any connector object to be represented
 as a system object.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="audit-objects"></a>C.4.&nbsp;Audit Objects</h2></div></div></div><a class="indexterm" name="d505e20527"></a><p>Audit objects house audit data selected for local storage in the
 OpenIDM repository. For details, see the chapter on <a href="../integrators-guide/index.html#chap-auditing" class="link"><em class="citetitle">Using Audit
 Logs</em></a>.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="links"></a>C.5.&nbsp;Links</h2></div></div></div><a class="indexterm" name="d505e20541"></a><p>Link objects define relations between source objects and target
 objects, usually relations between managed objects and system objects.
 The link relationship is established by provisioning activity that either
 results in a new account on a target system, or a reconciliation or
 synchronization scenario that takes a <code class="literal">LINK</code> action.</p></div></div><div lang="en" class="appendix"><div class="titlepage"><div><div><h1 class="title"><a name="appendix-synchronization"></a>Appendix&nbsp;D.&nbsp;Synchronization Reference</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="section"><a href="#sync-object-mapping">D.1. Object-Mapping Objects</a></span></dt><dt><span class="section"><a href="#sync-links">D.2. Links</a></span></dt><dt><span class="section"><a href="#sync-queries">D.3. Queries</a></span></dt><dt><span class="section"><a href="#sync-reconciliation">D.4. Reconciliation</a></span></dt><dt><span class="section"><a href="#sync-rest-api">D.5. REST API</a></span></dt></dl></div><a class="indexterm" name="d505e20555"></a><p>The synchronization engine is one of the core services of OpenIDM. You 
 configure the synchronization service through a <code class="literal">mappings</code> 
 property that specifies mappings between objects that are managed by the 
 synchronization engine.</p><pre class="brush: javascript;">{
  "mappings": [ object-mapping object, ... ]
}</pre><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sync-object-mapping"></a>D.1.&nbsp;Object-Mapping Objects</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#sync-property-objects">D.1.1. Property Objects</a></span></dt><dt><span class="section"><a href="#sync-policy-objects">D.1.2. Policy Objects</a></span></dt></dl></div><p>An object-mapping object specifies the configuration for a mapping of
  source objects to target objects.</p><pre class="brush: javascript;"> {
  "name"            : string,
  "source"          : string,
  "target"          : string,
  "links"           : string,
  "oldTarget"       : script object
  "validSource"     : script object,
  "validTarget"     : script object,
  "correlationQuery": script object,
  "properties"      : [ property object, ... ],
  "policies"        : [ policy object, ... ],
  "onCreate"        : script object,
  "onUpdate"        : script object,
  "onLink"          : script object,
  "onUnlink"        : script object,
  "result"          : script object
}</pre><div class="variablelist"><a name="mapping-object-properties"></a><div class="variablelist-title">Mapping Object Properties</div><dl class="variablelist"><dt><span class="term">name</span></dt><dd><p>string, required</p><p>Uniquely names the object mapping. Used in the link object
      identifier.</p></dd><dt><span class="term">source</span></dt><dd><p>string, required</p><p>Specifies the path of the source object set. Example:
      <code class="literal">"managed/user"</code>.</p></dd><dt><span class="term">target</span></dt><dd><p>string, required</p><p>Specifies the path of the target object set. Example:
      <code class="literal">"system/ldap/account"</code>.</p></dd><dt><span class="term">links</span></dt><dd><p>string, optional</p><p>Enables reuse of the links created in another mapping. 
      Example: <code class="literal">"systemLdapAccounts_managedUser"</code> reuses the 
      links created by a previous mapping whose <code class="literal">name</code> is 
      <code class="literal">"systemLdapAccounts_managedUser"</code>.</p></dd><dt><span class="term">oldTarget</span></dt><dd><p>object, optional</p><p>
      An optional old target object, which contains the value of the target
      before any mappings were applied.
     </p></dd><dt><span class="term">validSource</span></dt><dd><p>script object, optional</p><p>A script that determines if a source object is valid to be
      mapped. The script yields a boolean value: <code class="literal">true</code>
      indicates the source object is valid; <code class="literal">false</code> can be
      used to defer mapping until some condition is met. In the root scope,
      the source object is provided in the <code class="literal">"source"</code>
      property. If the script is not specified, then all source objects are
      considered valid.</p></dd><dt><span class="term">validTarget</span></dt><dd><p>script object, optional</p><p>A script used during the target phase of reconciliation that 
     determines if a target object is valid to be mapped. The script yields 
     a boolean value: <code class="literal">true</code> indicates that the target object 
     is valid; <code class="literal">false</code> indicates that the target object should 
     not be included in reconciliation. In the root scope, the target object is
      provided in the <code class="literal">"target"</code> property. If the script is
      not specified, then all target objects are considered valid for
      mapping.</p></dd><dt><span class="term">correlationQuery</span></dt><dd><p>script object, optional</p><p>A script that yields a query object to query the target object
      set when a source object has no linked target. The syntax for writing 
      the query depends on the target system of the correlation. See the 
      section on <a href="../integrators-guide/index.html#correlation" class="link"> 
      <em class="citetitle">Correlation Queries</em></a> for examples of some 
      common targets. The source object is provided in the 
      <code class="literal">"source"</code> property in the script scope.</p></dd><dt><span class="term">properties</span></dt><dd><p>array of property-mapping objects, optional</p><p>Specifies mappings between source object properties and target
      object properties, with optional transformation scripts.</p></dd><dt><span class="term">policies</span></dt><dd><p>array of policy objects, optional</p><p>Specifies a set of link conditions and associated actions to
      take in response.</p></dd><dt><span class="term">onCreate</span></dt><dd><p>script object, optional</p><p>A script to execute when a target object is to be created,
      after property mappings have been applied. In the root scope, the
      source object is provided in the <code class="literal">"source"</code> property,
      projected target object in the <code class="literal">"target"</code> property and
      the link situation that led to the create operation in
      <code class="literal">"situation"</code>. The <code class="literal">_id</code> property in
      the target object can be modified, allowing the mapping to select an
      identifier; if not set then the identifier is expected to be set by
      the target object set. If the script throws an exception, then
      target object creation is aborted.</p></dd><dt><span class="term">onUpdate</span></dt><dd><p>script object, optional</p><p>A script to execute when a target object is to be updated,
      after property mappings have been applied. In the root scope, the
      source object is provided in the <code class="literal">"source"</code> property,
      projected target object in the <code class="literal">"target"</code> property,
      link situation that led to the update operation in
      <code class="literal">"situation"</code>. If the script throws an exception,
      then target object update is aborted.</p></dd><dt><span class="term">onLink</span></dt><dd><p>script object, optional</p><p>A script to execute when a source object is to be linked to a target object,
      after property mappings have been applied. In the root scope, the
      source object is provided in the <code class="literal">"source"</code> property,
      projected target object in the <code class="literal">"target"</code> property. If the script throws an exception,
      then target object linking is aborted.</p></dd><dt><span class="term">onUnlink</span></dt><dd><p>script object, optional</p><p>A script to execute when a source and a target object are to be 
     unlinked, after property mappings have been applied. In the root scope, 
     the source object is provided in the <code class="literal">"source"</code> property,
      projected target object in the <code class="literal">"target"</code> property. If 
      the script throws an exception, then target object unlinking is aborted.
      </p></dd><dt><span class="term">result</span></dt><dd><p>script object, optional</p><p>A script to execute on each mapping event, independent of the nature
      of the operation. In the root scope, the source object is provided in the
      <code class="literal">"source"</code> property, projected target object in the
      <code class="literal">"target"</code> property. If the script throws an exception,
      then target object unlinking is aborted.</p><p>The "result" script is executed only during reconciliation 
      operations!</p></dd></dl></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="sync-property-objects"></a>D.1.1.&nbsp;Property Objects</h3></div></div></div><p>A property object specifies how the value of a target property is
   determined.</p><pre class="brush: javascript;"> {
  "target" : string,
  "source" : string,
  "transform" : script object,
  "condition" : script object,
  "default": value
}</pre><div class="variablelist"><a name="sync-property-object-properties"></a><div class="variablelist-title">Property Object Properties</div><dl class="variablelist"><dt><span class="term">target</span></dt><dd><p>string, required</p><p>Specifies the path of the property in the target object to map
       to.</p></dd><dt><span class="term">source</span></dt><dd><p>string, optional</p><p>Specifies the path of the property in the source object to map
        from. If not specified, then the target property value is derived
        from the script or default value.</p></dd><dt><span class="term">transform</span></dt><dd><p>script object, optional</p><p>A script to determine the target property value. The root
        scope contains the value of the source in the
        <code class="literal">"source"</code> property, if specified. If the 
        <code class="literal">"source"</code> property has a value of 
        <code class="literal">""</code>, then the entire source object of the mapping is 
        contained in the root scope. The resulting value yielded by the script 
        is stored in the target property.</p></dd><dt><span class="term">condition</span></dt><dd><p>script object, optional</p><p>A script to determine whether the mapping should be executed or 
       not. The condition has an <code class="literal">"object"</code> property available
       in root scope, which (if specified) contains the full source object. For
       example <code class="literal">"source": "(object.email != null)"</code>. The
       script is considered to return a boolean value.</p></dd><dt><span class="term">default</span></dt><dd><p>any value, optional</p><p>Specifies the value to assign to the target property if a
        non-null value is not established by <code class="literal">"source"</code> or
        <code class="literal">"transform"</code>. If not specified, the default value is
        <code class="literal">null</code>.</p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="sync-policy-objects"></a>D.1.2.&nbsp;Policy Objects</h3></div></div></div><p>A policy object specifies a link condition and the associated actions
   to take in response.</p><pre class="brush: javascript;">{
  "situation"  : string,
  "action"     : string or script object
  "postAction" : optional, script object
}</pre><div class="variablelist"><a name="sync-policy-object-properties"></a><div class="variablelist-title">Policy Object Properties</div><dl class="variablelist"><dt><span class="term">situation</span></dt><dd><p>string, required</p><p>Specifies the situation for which an associated action is to be
      defined.</p></dd><dt><span class="term">action</span></dt><dd><p>string or script object, required</p><p>Specifies the action to perform. If a script is specified, the
       script is executed and is expected to yield a string containing the
       action to perform.</p></dd><dt><span class="term">postAction</span></dt><dd><p>script object, optional</p><p>Specifies the action to perform after the previously specified 
      action has completed.</p></dd></dl></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="sync-script-objects"></a>D.1.2.1.&nbsp;Script Object</h4></div></div></div><p>Script objects take the following form.</p><pre class="brush: javascript;">{
  "type"  : "text/javascript",
  "source": string
}</pre><div class="variablelist"><dl class="variablelist"><dt><span class="term">type</span></dt><dd><p>string, required</p><p>Specifies the type of script to be executed. Supported types
        include <code class="literal">"text/javascript"</code> and
        <code class="literal">"groovy"</code>.
       </p></dd><dt><span class="term">source</span></dt><dd><p>string, required</p><p>Specifies the source code of the script to be executed.</p></dd></dl></div></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sync-links"></a>D.2.&nbsp;Links</h2></div></div></div><p>To maintain links between source and target objects in mappings,
  OpenIDM stores an object set in the repository. The object set identifier
  follows this scheme.</p><pre class="literallayout">links/<em class="replaceable"><code>mapping</code></em></pre><p>Here, <em class="replaceable"><code>mapping</code></em> represents the name of the
  mapping for which links are managed.</p><p>Link entries have the following structure.</p><pre class="brush: javascript;">{
   "_id":string,
   "_rev":string,
   "linkType":string,
   "firstId":string
   "secondId":string,
}</pre><div class="variablelist"><dl class="variablelist"><dt><span class="term">_id</span></dt><dd><p>string</p><p>The identifier of the link object.</p></dd><dt><span class="term">_rev</span></dt><dd><p>string, required</p><p>The value of link object's revision.</p></dd><dt><span class="term">linkType</span></dt><dd><p>string, required</p><p>The type of the link. Usually then name of the mapping which 
     created the link.</p></dd><dt><span class="term">firstId</span></dt><dd><p>string, required</p><p>The identifier of the first of the two linked objects.</p></dd><dt><span class="term">secondId</span></dt><dd><p>string</p><p>The identifier of the second of the two linked objects.</p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sync-queries"></a>D.3.&nbsp;Queries</h2></div></div></div><div class="orderedlist"><p>OpenIDM performs the following queries on a link object set.</p><ol class="orderedlist" type="1"><li class="listitem"><p>Find link(s) for a given firstId object identifier.</p><pre class="literallayout">SELECT * FROM links WHERE linkType
     = <em class="replaceable"><code>value</code></em> AND firstId = <em class="replaceable"><code>value</code></em></pre><p>Although a single result makes sense, this query is intended to
    allow multiple results so that this scenario can be handled as an
    exception.</p></li><li class="listitem"><p>Select link(s) for a given second object identifier.</p><pre class="literallayout">SELECT * FROM links  WHERE linkType 
    = <em class="replaceable"><code>value</code></em> AND secondId = <em class="replaceable"><code>value</code></em></pre><p>Although a single result makes sense, this query is intended to
    allow multiple results so that this scenario can be handled as an
    exception.</p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sync-reconciliation"></a>D.4.&nbsp;Reconciliation</h2></div></div></div><div class="orderedlist"><p>OpenIDM performs reconciliation on a per-mapping basis. The process of
  reconciliation for a given mapping includes these stages.</p><ol class="orderedlist" type="1"><li class="listitem"><p>Iterate through all objects for the object set specified as
    <code class="literal">"source"</code>. For each source object, carry out the
    following steps.</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p>Look for a link to a target object in the link object set, and
      perform a correlation query (if defined).</p></li><li class="listitem"><p>Determine the link condition, as well as whether a target object 
      can be found.</p></li><li class="listitem"><p>Determine the action to perform based on the policy defined for the
      condition.</p></li><li class="listitem"><p>Perform the action.</p></li><li class="listitem"><p>Keep track of the target objects for which a condition and action 
      has already been determined.</p></li><li class="listitem"><p>Write the results.</p></li></ol></div></li><li class="listitem"><p>Iterate through all object identifiers for the object set specified
    as <code class="literal">"target"</code>. For each identifier, carry out the
    following steps.</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p>Find the target in the link object set.</p><p>Determine if the target object was handled in the first phase.</p></li><li class="listitem"><p>Determine the action to perform based on the policy defined for the
      condition.</p></li><li class="listitem"><p>Perform the action.</p></li><li class="listitem"><p>Write the results.</p></li></ol></div></li><li class="listitem"><p>Iterate through all link objects, carrying out the following
    steps.</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p>If the <code class="literal">reconId</code> is <code class="literal">"my"</code>, then
      skip the object.</p><p>If the <code class="literal">reconId</code> is not recognized, then the
      source or the target is missing.</p></li><li class="listitem"><p>Determine the action to perform based on the policy.</p></li><li class="listitem"><p>Perform the action.</p></li><li class="listitem"><p>Store the <code class="literal">reconId</code> identifer in the mapping to
      indicate that it was processed in this run.</p></li></ol></div></li></ol></div><div class="note"><h3 class="title">Note</h3><p>To optimize a reconciliation operation, the reconciliation process 
   does not attempt to correlate source objects to target objects if the set 
   of target objects is empty when the correlation is started. For information 
   on changing this default behaviour, see 
   <a href="../integrators-guide/index.html#reconciliation-optimization" class="link"><em class="citetitle">Reconciliation 
   Optimization</em></a>.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sync-rest-api"></a>D.5.&nbsp;REST API</h2></div></div></div><div class="variablelist"><p>External synchronized objects expose an API to request immediate
   synchronization. This API includes the following requests and
   responses.</p><dl class="variablelist"><dt><span class="term">Request</span></dt><dd><p>Example:</p><pre class="brush: http;">
POST /openidm/system/xml/account/jsmith?_action=liveSync HTTP/1.1</pre></dd><dt><span class="term">Response (success)</span></dt><dd><p>Example:</p><pre class="brush: http;">
HTTP/1.1 204 No Content
...</pre></dd><dt><span class="term">Response (synchronization failure)</span></dt><dd><p>Example:</p><pre class="brush: http;">
HTTP/1.1 409 Conflict
...
[JSON representation of error]</pre></dd></dl></div></div></div><div lang="en" class="appendix"><div class="titlepage"><div><div><h1 class="title"><a name="appendix-rest"></a>Appendix&nbsp;E.&nbsp;REST API Reference</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="section"><a href="#rest-uri-scheme">E.1. URI Scheme</a></span></dt><dt><span class="section"><a href="#rest-object-identifier">E.2. Object Identifiers</a></span></dt><dt><span class="section"><a href="#rest-content-negotiation">E.3. Content Negotiation</a></span></dt><dt><span class="section"><a href="#rest-supported-operations">E.4. Supported Operations</a></span></dt><dt><span class="section"><a href="#rest-conditional-operations">E.5. Conditional Operations</a></span></dt><dt><span class="section"><a href="#rest-supported-methods">E.6. Supported Methods</a></span></dt><dt><span class="section"><a href="#sample-rest-commands">E.7. REST Endpoints and Sample Commands</a></span></dt><dt><span class="section"><a href="#http-status-codes">E.8. HTTP Status Codes</a></span></dt></dl></div><a class="indexterm" name="d505e21222"></a><a class="indexterm" name="d505e21227"></a><p>
   Representational State Transfer (REST) is a software architecture style for
   exposing resources, using the technologies and protocols of the World Wide
   Web. REST describes how distributed data objects, or resources, can be
   defined and addressed. OpenIDM provides a RESTful API for accessing managed
   objects, system objects, workflows, and some elements of the system
   configuration.
  </p><p>
   The ForgeRock implementation of REST, known as commons REST (CREST), defines
   an API intended for common use across all ForgeRock products. CREST is a
   framework used to access various web resources, and for writing to RESTful
   resource providers (servers).
  </p><p>
   CREST is intended to support the following types of operations, described in
   detail in <a class="xref" href="#rest-supported-operations" title="E.4.&nbsp;Supported Operations">Section&nbsp;E.4, &#8220;Supported Operations&#8221;</a>:
   <code class="literal">Create</code>, <code class="literal">Read</code>,
   <code class="literal">Update</code>, <code class="literal">Delete</code>,
   <code class="literal">Action</code>, and <code class="literal">Query</code>.
  </p><p>
   ForgeRock defines a JSON Resource core library, as a common framework to
   implement RESTful APIs. That core library includes two components:
  </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">json-resource</code></span></dt><dd><p>
      A Maven module that provides core interfaces such as <code class="literal">
      Connections</code>, <code class="literal">Requests</code>, and
      <code class="literal">Request Handlers</code>.
     </p></dd><dt><span class="term"><code class="literal">json-resource-servlet</code></span></dt><dd><p>
      Provides J2EE servlet integration. Defines a common HTTP-based REST API
      for interacting with JSON resources.
     </p></dd></dl></div><div class="note"><h3 class="title">Note</h3><p>
      You can examine the libraries associated with ForgeRock REST at
      http://commons.forgerock.org/forgerock-rest.
     </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="rest-uri-scheme"></a>E.1.&nbsp;URI Scheme</h2></div></div></div><p>The URI scheme for accessing a managed object follows this
  convention, assuming the OpenIDM web application was deployed at
  <code class="literal">/openidm</code>.</p><pre class="literallayout">/openidm/managed/<em class="replaceable"><code>type</code></em>/<em class="replaceable"><code>id</code></em></pre><p>
   Similar schemes exist for URIs associated with all but system objects.
   For more information, see the reference on the <a href="../integrators-guide/index.html#access-js" class="link"><em class="citetitle">
   access.js</em></a> file.
  </p><p>
   The URI scheme for accessing a system object follows this convention:
  </p><pre class="literallayout">/openidm/system/<em class="replaceable"><code>resource-name</code></em>/<em class="replaceable"><code>type</code></em>/<em class="replaceable"><code>id</code></em></pre><p>
   An example of a system object in an LDAP repository might be:
  </p><pre class="literallayout">
/openidm/system/ldap/account/uid=jsmith,ou=people,dc=example,dc=com
  </pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="rest-object-identifier"></a>E.2.&nbsp;Object Identifiers</h2></div></div></div><a class="indexterm" name="d505e21325"></a><p>
   Every managed and system object has an identifier (expressed as
   <em class="replaceable"><code>id</code></em> in the URI scheme) that is used to address the
   object through the REST API. The REST API allows for client-generated and
   server-generated identifiers, through PUT and POST methods. The default
   server-generated identifier type is a UUID. If you create an object by using
   <code class="literal">POST</code>, a server-assigned ID is generated in the form of a
   UUID. If you create an object by using PUT, the client assigns the ID in
   whatever format you specify.
  </p><p>
   Most of the examples in this guide use client-assigned IDs, as it makes the
   examples easier to read.
  </p><p>
   In general, UUIDs are better in production, as they can be generated easily
   in clustered environments. However, you might have specific reasons that
   dictate a different scheme for generating IDs.
  </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="rest-content-negotiation"></a>E.3.&nbsp;Content Negotiation</h2></div></div></div><p>The REST API fully supports negotiation of content representation
  through the <code class="literal">Accept</code> HTTP header. Currently, the supported
  content type is JSON. In most cases, you should include the following
  header:</p><pre class="literallayout">Accept: application/json</pre><p>
   In a REST call (using the <span class="command"><strong>curl</strong></span> command, for example),
   you would include the following option to specify the noted header:</p><pre class="literallayout">--header "Content-Type: application/json"</pre><p>You can also specify the default UTF-8 character set as follows:</p><pre class="literallayout">--header "Content-Type: application/json;charset=utf-8"</pre><p>
   The <code class="literal">application/json</code> content type is not needed when a
   REST call is made with the GET and DELETE methods.
  </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="rest-supported-operations"></a>E.4.&nbsp;Supported Operations</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#rest-supported-create">E.4.1. Creating an Object</a></span></dt><dt><span class="section"><a href="#rest-supported-read">E.4.2. Reading an Object</a></span></dt><dt><span class="section"><a href="#rest-supported-update">E.4.3. Updating an Object</a></span></dt><dt><span class="section"><a href="#rest-supported-delete">E.4.4. Deleting an Object</a></span></dt><dt><span class="section"><a href="#rest-supported-query">E.4.5. Querying Resources</a></span></dt></dl></div><p>
   CREST supports several types of operations for communication with web
   servers.
  </p><p>
   The following request parameters can be used in conjunction with the
   supported operations.
  </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">_debug=[true,false]</code></span></dt><dd><p>
      If <code class="literal">_debug=true</code>, the <code class="literal">HttpServlet</code>
      dumps the <code class="literal">HttpServletRequest</code> to the embedded
      Jetty Servlet log file.
     </p></dd><dt><span class="term"><code class="literal">_prettyPrint=[true,false]</code></span></dt><dd><p>
      If <code class="literal">_prettyPrint=true</code>, the <code class="literal">HttpServlet</code>
      formats the response, in a fashion similar to the JSON parser known
      as <a class="link" href="http://stedolan.github.io/jq/" target="_top">jq</a>.
     </p><p>
      For example, adding <code class="literal">_prettyPrint=true</code> to the end of
      a <code class="literal">query-all-ids</code> request formats the output in the
      following manner:
     </p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/managed/user?_queryId=query-all-ids&amp;_prettyPrint=true"</strong>
<em>{
 "result" : [ {
   "_id" : "bjensen",
   "_rev" : "0"
 }, {
   "_id" : "scarter",
   "_rev" : "0"
 }, {
   "_id" : "jberg",
   "_rev" : "0"
 } ],
 "resultCount" : 3,
 "pagedResultsCookie" : null,
 "remainingPagedResults" : -1
}</em>
     </pre></div><p>
      Note that most command-line examples in this guide do not show this
      parameter, although the output in the examples is formatted for
      readability.
     </p></dd><dt><span class="term">_fields</span></dt><dd><p>
      The <code class="literal">_fields</code> parameter can be used to return multiple
      common attributes.
     </p><p>
      For example, you can use <code class="literal">GET</code> to read specific
      attributes for a user as follows:
     </p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET
 "https://localhost:8443/openidm/managed/user/james?_fields=userName,mail"</strong>
<em>{
  "mail": "james@example.com",
  "userName": "james"
}</em></pre></div></dd></dl></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="rest-supported-create"></a>E.4.1.&nbsp;Creating an Object</h3></div></div></div><p>
    Objects can be created with two different HTTP operations:
    <code class="literal">POST</code> and <code class="literal">PUT</code>.
   </p><p>
    To create an object with a server-assigned ID, use the
    <code class="literal">POST</code> operation with the <code class="literal">create</code> action.
    For example:
   </p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 --data '{
    "userName":"mike",
    "sn":"Smith",
    "givenName":"Mike",
    "mail": "mike@example.com",
    "telephoneNumber": "082082082",
    "password":"Passw0rd"
 }'
 "https://localhost:8443/openidm/managed/user?_action=create"</strong>
<em>{
  "userName": "mike",
  ...
  "_rev": "1",
  "_id": "a5bed4d7-99d4-41c4-8d64-49493b48a920",
  ...
}</em></pre></div><p>
    To create an object with a client-assigned ID, use the
    <code class="literal">PUT</code> operation, with either of the following headers:
   </p><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="literal">If-None-Match: *</code></td></tr><tr><td><code class="literal">If-None-Match: "*"</code></td></tr></table><p>
    Specify the ID as part of the URL, for example:
   </p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --header "If-None-Match: *"
 --request PUT \
 --data '{
    "userName":"james",
    "sn":"Berg",
    "givenName":"James",
    "mail": "james@example.com",
    "telephoneNumber": "082082082",
    "password":"Passw0rd"
    }' \
 "https://localhost:8443/openidm/managed/user/james"</strong>
<em>{
  "userName": "james",
  ...
  "_rev": "1",
  ...
  "_id": "james",
  ...
}</em>
   </pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="rest-supported-read"></a>E.4.2.&nbsp;Reading an Object</h3></div></div></div><p>
    To read the contents of an object, use the <code class="literal">GET</code>
    operation, specifying the object ID. For example:
   </p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/system/ldap/account/uid=mike,ou=People,dc=example,dc=com"</strong>
<em>{
  "_id": "uid=mike,ou=People,dc=example,dc=com",
  "sn": "Smith",
  "telephoneNumber": "082082082",
  "description": null,
  "mail": "mike@example.com",
  "givenName": "Mike",
  "cn": "Mike Smith",
  "dn": "uid=mike,ou=People,dc=example,dc=com",
  "uid": "mike",
  "ldapGroups": []
}   </em></pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="rest-supported-update"></a>E.4.3.&nbsp;Updating an Object</h3></div></div></div><p>
   An update replaces some or all of the contents of an existing object. Any
   object can be updated over REST with a PUT request. <span class="emphasis"><em>Managed
   objects</em></span> can also be updated with a POST request, using the
   <code class="literal">patch</code> action, or with a PATCH request.
  </p><p>
   To update an object with a <code class="literal">PUT</code> request, use the
   <code class="literal">If-Match</code> header, for example:
  </p><div class="screen"><pre>$ <strong> curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --header "If-Match : *" \
 --request PUT \
 --data '{"description":"The new description for Mike"}'
 "https://localhost:8443/openidm/system/ldap/account/uid=mike,ou=People,dc=example,dc=com"</strong>
<em>{
  "_id": "uid=mike,ou=People,dc=example,dc=com",
  "sn": "Smith",
  "telephoneNumber": "082082082",
  "description": "The new description for Mike",
  "mail": "mike@example.com",
  "givenName": "Mike",
  "cn": "Mike Smith",
  "dn": "uid=mike,ou=People,dc=example,dc=com",
  "uid": "mike",
  "ldapGroups": []
}  </em></pre></div><p>
   To update a managed object with a POST request, use the
   <code class="literal">patch</code> action and specify the updated fields as an array in
   the <code class="literal">data</code> option. For example:
  </p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 --data '[
   {
   "operation":"replace",
   "field":"/description",
   "value":"The new description for James"
   }
 ]'
 "https://localhost:8443/openidm/managed/user/james?_action=patch"</strong>
<em>{
   ...
   "userName": "james",
   ...
   "_id": "james",
  "description": "The new description for James",
   ...
}</em></pre></div><p>
   To update a managed object with a PATCH request, use the
   <code class="literal">If-Match</code> header. A PATCH request can add, remove, replace,
   or increment an attribute value. A <code class="literal">replace</code> operation
   replaces an existing value, or adds a value if no value exists.
  </p><p>
   The following example shows a patch request that updates a multi-valued
   attribute by adding a new value. Note the dash <code class="literal">-</code> character
   appended to the field name, which specifies that the value provided should be
   added to the existing values. If the dash character is omitted, the provided
   value replaces the existing values of that field.
  </p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --header "If-Match: *" \
 --request PATCH \
 --data '[
    {
        "operation": "add",
        "field": "/roles/-",
        "value": "managed/role/ldap"

    }
]' \
 "https://localhost:8443/openidm/managed/user/bjensen"</strong>
  </pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="rest-supported-delete"></a>E.4.4.&nbsp;Deleting an Object</h3></div></div></div><p>
    A delete request is similar to an update request, and can optionally include
    the HTTP <code class="literal">If-Match</code> header. To delete an object, specify
    its ID in the request, for example:
   </p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request DELETE \
 "https://localhost:8443/openidm/system/ldap/account/uid=james,ou=People,dc=example,dc=com"</strong>
<em>{
  "_id": "uid=james,ou=People,dc=example,dc=com"
}   </em></pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="rest-supported-query"></a>E.4.5.&nbsp;Querying Resources</h3></div></div></div><p>
   Resources can be queried using the <code class="literal">GET</code> method, with one of
   the following query parameters:
  </p><div class="itemizedlist"><p>
    For queries on managed objects:
   </p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
     <code class="literal">_queryId</code> for arbitrary predefined, parameterized queries
    </p></li><li class="listitem"><p>
     <code class="literal">_queryExpression</code> for client-supplied queries, in native
     query format
    </p></li></ul></div><div class="itemizedlist"><p>
    For queries on system objects:
   </p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
     <code class="literal">_queryId=query-all-ids</code> (the only supported predefined
     query)
    </p></li><li class="listitem"><p>
     <code class="literal">_queryFilter</code> for arbitrary filters, in common filter
     notation
    </p></li></ul></div><p>
   The following additional query parameters are supported.
  </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">_sortKeys</code></span></dt><dd><p>
      When configured with a comma-separated list, this will order the way
      JSON resources are returned by this query request.
     </p></dd><dt><span class="term"><code class="literal">_pagedResultsCookie</code></span></dt><dd><p>
      Opaque cookie used by the server to keep track of the position
      in the search results. The format of the cookie is a string value.
     </p><p>
      The server provides the cookie value on the first request. You should then
      supply the cookie value in subsequent requests until the server returns a
      null cookie, meaning that the final page of results has been returned.
     </p><p>
      Paged results are enabled only if the <code class="literal">_pageSize</code> is a
      non-zero integer.
     </p></dd><dt><span class="term"><code class="literal">_pagedResultsOffset</code></span></dt><dd><p>
      Specifies the index within the result set of the number of records to be
      skipped before the first result is returned. The format of the
      <code class="literal">_pagedResultsOffset</code> is an integer value. When the value
      of <code class="literal">_pagedResultsOffset</code> is greater than or equal to 1,
      the server returns pages, starting after the specified index.
     </p><p>
      This request assumes that the <code class="literal">_pageSize</code> is set, and not
      equal to zero.
     </p><p>
      For example, if the result set includes 10 records, the
      <code class="literal">_pageSize</code> is 2, and the
      <code class="literal">_pagedResultsOffset</code> is 6, the server skips the first 6
      records, then returns 2 records, 7 and 8. The
      <code class="literal">_pagedResultsCookie</code> value would then be 8 (the index of
      the last returned record) and the <code class="literal">_remainingPagedResults</code>
      value would be 2, the last two records (9 and 10) that have not yet been
      returned.
     </p><p>
      If the offset points to a page beyond the last of the search results, the
      result set returned is empty.
     </p></dd><dt><span class="term"><code class="literal">_pageSize</code></span></dt><dd><p>
      An optional parameter indicating that query results should be returned in
      pages of the specified size. For all paged result requests other than the
      initial request, a cookie should be provided with the query request.
     </p><p>
      The default behavior is not to return paged query results. If set, this
      parameter should be an integer value, greater than zero.
     </p></dd></dl></div><p>
   For additional information on queries, see the section on <a href="../integrators-guide/index.html#constructing-queries" class="link"><em class="citetitle">Constructing
   Queries</em></a>.
  </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="rest-conditional-operations"></a>E.5.&nbsp;Conditional Operations</h2></div></div></div><p>The REST API fully supports conditional operations through the use of
  the <code class="literal">ETag</code>, <code class="literal">If-Match</code> and
  <code class="literal">If-None-Match</code> HTTP headers. The use of HTTP conditional
  operations is the basis of OpenIDM's optimistic concurrency control system.
  Clients should make requests conditional in order to prevent inadvertent
  modification of the wrong version of an object.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="rest-supported-methods"></a>E.6.&nbsp;Supported Methods</h2></div></div></div><p>
   The managed object API uses standard HTTP methods to access managed objects.
  </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">GET</span></dt><dd><p>Retrieves a managed object in OpenIDM.</p><p>Example Request</p><pre class="brush: http;">
GET /openidm/managed/user/bdd793f8
...</pre><p>Example Response</p><pre class="brush: http;">
HTTP/1.1 200 OK
Content-Type: application/json;charset=UTF-8
Cache-Control: no-cache
Vary: Accept-Encoding, User-Agent
Set-Cookie: session-jwt=2sadf... afd5;Path=/
Expires: Thu, 01 Jan 2015 00:00:00 GMT
Content-Length: 1230
Server: Jetty(8.y.z-SNAPSHOT)
...

[JSON representation of the managed object]</pre></dd><dt><span class="term">HEAD</span></dt><dd><p>Returns metainformation about a managed object in OpenIDM.</p><p>Example Request</p><pre class="brush: http;">
HEAD /openidm/managed/user/bdd793f8
...</pre><p>Example Response</p><pre class="brush: http;">
HTTP/1.1 200 OK
Content-Type: application/json
Content-Length: 123
ETag: "0"</pre></dd><dt><span class="term">PUT</span></dt><dd><p>Creates or updates a managed object.</p><p>Example Request: Creating a new object</p><pre class="brush: http;">
PUT /openidm/managed/user/5752c0fd9509
Content-Type: application/json
Content-Length: 123
If-None-Match: *
...

[JSON representation of the managed object to create]</pre><p>Example Response: Creating a new object (success)</p><pre class="brush: http;">
HTTP/1.1 201 Created
Content-Type: application/json
Content-Length: 45
ETag: "0"
...

[JSON representation containing metadata (underscore-prefixed) properties]</pre><p>
      Example Response: Creating a new object without the
      <code class="literal">If-None-Match</code> header
     </p><pre class="brush: http;">
HTTP/1.1 404 Not Found
Content-Type: application/json
Content-Length: 83
...

[JSON representation of error]</pre><p>
      Example Request: Updating an existing object
     </p><pre class="brush: http;">
PUT /openidm/managed/user/5752c0fd9509
Content-Type: application/json
Content-Length: 123
If-Match: "1"
...

[JSON representation of managed object to update]</pre><p>Example Response: Updating an existing object (success)</p><pre class="brush: http;">
HTTP/1.1 200 OK
Content-Type: application/json
Content-Length: 45
ETag: "2"
...

[JSON representation of updated object]</pre><p>Example Response: Updating an existing object when no version is
     supplied</p><pre class="brush: http;">
HTTP/1.1 200 OK
Content-Type: application/json
Content-Length: 89
ETag: "3"
...

[JSON representation of updated object]</pre><p>
       Example Response: Updating an existing object when an invalid version is
       supplied
      </p><pre class="brush: http;">
HTTP/1.1 412 Precondition Required
Content-Type: application/json
Content-Length: 89
...

[JSON representation of error]</pre><p>
      Example Response: Updating an existing object with
      <code class="literal">If-Match: *</code></p><pre class="brush: http;">
HTTP/1.1 200 OK
Content-Type: application/json
Content-Length: 45
ETag: "0"
...
[JSON representation of updated object]</pre></dd><dt><span class="term">POST</span></dt><dd><p>The POST method allows arbitrary actions to be performed on managed
     objects. The <code class="literal">_action</code> query parameter defines the action
     to be performed.</p><p>The <code class="literal">create</code> action is used to create a managed
     object. Because POST is neither safe nor idempotent, PUT is the preferred
     method of creating managed objects, and should be used if the client knows
     what identifier it wants to assign the object. The response contains
     the server-generated <code class="literal">_id</code> of the newly created managed
     object.</p><p>The POST method create optionally accepts an <code class="literal">_id</code>
     query parameter to specify the identifier to give the newly created
     object. If an <code class="literal">_id</code> is not provided, the server selects
     its own identifier.</p><p>The <code class="literal">patch</code> action is used to update one or more
     attributes of a managed object, without replacing the entire object.</p><p>Example Create Request</p><pre class="brush: http;">
POST /openidm/managed/user?_action=create
Content-Type: application/json;charset=UTF-8
Content-Length: 123
...

[JSON representation of the managed object to create]</pre><p>Example Response</p><pre class="brush: http;">
HTTP/1.1 201 Created
Content-Type: application/json;charset=UTF-8
Cache-Control: no-cache
Location: https://Some_URI
...

[JSON representation containing metadata (underscore-prefixed) properties]</pre><p>Example Patch Request</p><pre class="brush: http;">
POST /openidm/managed/user?_action=patch
Content-Type: application/json;charset=UTF-8
Content-Length: 123
...

[JSON representation of the managed object to create]</pre><p>Example Response (success)</p><pre class="brush: http;">
HTTP/1.1 200 OK
Content-Type: application/json;charset=UTF-8
Cache-Control: no-cache
Set-Cookie: session-jwt=yAiYWxnIjogI;Path=/
...</pre></dd><dt><span class="term">DELETE</span></dt><dd><p>Deletes a managed object.</p><p>Example Request</p><pre class="brush: http;">
DELETE /openidm/managed/user/c3471805b60f
If-Match: "0"
...</pre><p>Example Response (success)</p><pre class="brush: http;">
HTTP/1.1 200 OK
Content-Length: 405
Content-Type: application/json;charset=UTF-8
Etag: "4"
...

[JSON representation of the managed object that was deleted]</pre><p>
      Example Response: Deleting an existing object when no version is supplied
     </p><pre class="brush: http;">
HTTP/1.1 200 OK
Content-Length: 405
Content-Type: application/json;charset=UTF-8
Etag: "4"
...

[JSON representation of the managed object that was deleted]</pre><p>
       Example Response: Deleting an existing object when an invalid version is
       supplied
      </p><pre class="brush: http;">
HTTP/1.1 412 Precondition Required
Content-Type: application/json;charset=UTF-8
Content-Length: 89
...

[JSON representation of error]</pre></dd><dt><span class="term">PATCH</span></dt><dd><p>Performs a partial modification of a managed object.</p><p>See the <a class="link" href="http://tools.ietf.org/html/draft-pbryan-json-patch-04" target="_blank">JSON
     Patch Internet-Draft</a> for details.</p><p>Example Request</p><pre class="brush: http;">
PATCH /openidm/managed/user/5752c0fd9509
Content-Type: application/patch+json
Content-Length: 456
If-Match: "0"
...

[JSON representation of patch document to apply]</pre><p>Example Response (success)</p><pre class="brush: http;">
HTTP/1.1 200 OK
Set-Cookie: JSESSIONID=1kke440cyv1vivbrid6ljso7b;Path=/
Expires: Thu, 01 Jan 1970 00:00:00 GMT
Content-Type: application/json; charset=UTF-8
ETag: "1"
...
{"_id":"5752c0fd9509","_rev":"2"}
     </pre><p>Updating an existing object when no version is supplied (version
     conflict)</p><pre class="brush: http;">
HTTP/1.1 409 Conflict
Content-Type: application/json;charset=UTF-8
Content-Length: 89
...

[JSON representation of error]</pre><p>Example Response: Updating an existing object when an invalid
     version is supplied (version conflict)</p><pre class="brush: http;">
HTTP/1.1 412 Precondition Required
Content-Type: application/json;charset=UTF-8
Content-Length: 89
...

[JSON representation of error]</pre></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sample-rest-commands"></a>E.7.&nbsp;REST Endpoints and Sample Commands</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#rest-server-config">E.7.1. Managing the Server Configuration Over REST</a></span></dt><dt><span class="section"><a href="#managing-users-REST">E.7.2. Managing Users Over REST</a></span></dt><dt><span class="section"><a href="#managing-system-objects-REST">E.7.3. Managing System Objects Over Rest</a></span></dt><dt><span class="section"><a href="#managing-workflows-over-REST">E.7.4. Managing Workflows Over Rest</a></span></dt><dt><span class="section"><a href="#managing-scanned-REST">E.7.5. Managing Scanned Tasks Over REST</a></span></dt><dt><span class="section"><a href="#accessing-log-REST">E.7.6. Accessing Log Entries Over REST</a></span></dt><dt><span class="section"><a href="#recon-over-REST">E.7.7. Managing Reconciliation Operations Over REST</a></span></dt></dl></div><p>
    This section describes the OpenIDM REST endpoints and provides
    a number of sample commands that show the interaction with the REST
    interface.
   </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="rest-server-config"></a>E.7.1.&nbsp;Managing the Server Configuration Over REST</h3></div></div></div><p>
      OpenIDM stores configuration objects in the repository, and exposes
      them under the context path <code class="literal">/openidm/config</code>. Single instance
      configuration objects are exposed under
      <code class="literal">/openidm/config/<em class="replaceable"><code>object-name</code></em></code>.
     </p><p>
      Multiple instance configuration objects are exposed under
      <code class="literal">/openidm/config/<em class="replaceable"><code>object-name</code></em>/<em class="replaceable"><code>instance-name</code></em></code>.
      The following table outlines these configuration objects and how they can
      be accessed through the REST interface.
     </p><div class="informaltable"><table width="100%" border="0"><colgroup><col width="50%" class="c1"><col width="10%" class="c2"><col width="40%" class="c3"></colgroup><thead><tr><th>URI</th><th>HTTP Operation</th><th>Description</th></tr></thead><tbody><tr><td>/openidm/config</td><td>GET</td><td>Returns a list of configuration objects</td></tr><tr><td>/openidm/config/audit</td><td>GET</td><td>Returns the current logging configuration</td></tr><tr><td>/openidm/config/provisioner.openicf/<em class="replaceable"><code>provisioner-name</code></em></td><td>GET</td><td>Returns the configuration of the specified connector</td></tr><tr><td>/openidm/config/router</td><td>PUT</td><td>Changes the router configuration. Modifications
           are provided with the <code class="literal">-data</code> option,
           in JSON format.</td></tr><tr><td>/openidm/config/<em class="replaceable"><code>object</code></em></td><td>DELETE</td><td>Deletes the specified configuration object.</td></tr></tbody></table></div><p>
        OpenIDM supports REST mappings for create, read, update, and
        delete of configuration objects. Currently OpenIDM does not support
        custom query operations or patch operations for configuration objects.
       </p><p>
        For an example that displays the current configuration, the current
        logging configuration, the configuration with an XML connector
        provisioner, and how the configuration can be modified over the router,
        see the section on <a href="../integrators-guide/index.html#configuring-over-rest" class="link"><em class="citetitle">Configuring
        OpenIDM Over REST</em></a>.
       </p><p>
        One entry is returned for each configuration object. To obtain
        additional information on the configuration object, include its
        <code class="literal">pid</code> or <code class="literal">_id</code> in the URL. The
        following example displays configuration information on the
        <code class="literal">sync</code> object, based on OpenIDM using Sample 1.
       </p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/config/sync"</strong>
<em>{
  "mappings": [ {
    "target" : "managed/user",
    "correlationQuery" : {
      "type" : "text/javascript",
      "source" : "var query = {'_queryId' : 'for-userName', 'uid' : source.name};query;"
    },
    "properties" : [ {
      "target" : "_id",
      "source" : "_id"
    }, {
      "target" : "description",
      "source" : "description"
    }, {
      "target" : "givenName",
      "source" : "firstname"
    }, {
      "target" : "mail",
      "source" : "email"
    }, {
... </em></pre></div><div class="note"><h3 class="title">Note</h3><p>
      The <span class="command"><strong>--header "X-OpenIDM-Username=openidm-admin</strong></span> and
      <span class="command"><strong>--header "X-OpenIDM-Password=openidm-admin</strong></span> options
      are constructs unique to OpenIDM. You can also specify the username and
      password with the following option:
      <span class="command"><strong>--user openidm-admin:openidm-admin</strong></span>. For more
      information, see the section on <a href="../integrators-guide/index.html#openidm-authentication" class="link">
      <em class="citetitle">Authentication</em></a>.
     </p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="managing-users-REST"></a>E.7.2.&nbsp;Managing Users Over REST</h3></div></div></div><p>
     User objects are stored in the repository and are exposed under the context
     path <code class="literal">/managed/user</code>. Many examples of REST calls related
     to this context path exist throughout this document. The following table
     lists available functionality associated with the
     <code class="literal">/managed/user</code> context path.
    </p><div class="informaltable"><table width="100%" border="0"><colgroup><col width="50%" class="c1"><col width="10%" class="c2"><col width="40%" class="c3"></colgroup><thead><tr><th>URI</th><th>HTTP Operation</th><th>Description</th></tr></thead><tbody><tr><td>/openidm/managed/user?_queryId=query-all-ids</td><td>GET</td><td>List all the managed users in the repository</td></tr><tr><td>/openidm/managed/user/<em class="replaceable"><code>id</code></em></td><td>GET</td><td>Retrieve the JSON representation of a specific user</td></tr><tr><td>/openidm/managed/user/<em class="replaceable"><code>userName</code></em></td><td>PUT</td><td>Create a new user</td></tr><tr><td>/openidm/managed/user/<em class="replaceable"><code>userName</code></em></td><td>PUT</td><td>Update a user entry (replaces the entire entry)</td></tr><tr><td>/openidm/managed/user?_action=create</td><td>POST</td><td>Create a new user</td></tr><tr><td>/openidm/managed/user?_action=patch&amp;_queryId=for-userName&amp;uid=
       <em class="replaceable"><code>userName</code></em></td><td>POST</td><td>Update a user (can be used to replace the value of one or more
       existing attributes)</td></tr><tr><td>/openidm/managed/user/<em class="replaceable"><code>userName</code></em></td><td>PATCH</td><td>Update specified fields of a user entry</td></tr><tr><td>/openidm/managed/user/<em class="replaceable"><code>userName</code></em></td><td>DELETE</td><td>Delete a user entry</td></tr></tbody></table></div><p>
    The following example retrieves the JSON representation of all users stored
    in the internal repository.
   </p><div class="screen"><pre>$ <strong>curl \
--cacert self-signed.crt \
--header "X-OpenIDM-Username: openidm-admin" \
--header "X-OpenIDM-Password: openidm-admin" \
--request GET \
"https://localhost:8443/openidm/managed/user?_queryId=query-all-ids"
   </strong></pre></div><p>
    The following example retrieves the JSON representation of a specified user.
   </p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/managed/user/<em><strong>user_id</strong></em>"</strong></pre></div><p>
    To add a user without a specified ID, see the Installation Guide section on
    <a href="../install-guide/index.html#sample-adding-users-rest" class="link"><em class="citetitle">Adding Users
    Through REST</em></a>.
   </p><p>
    The following example adds a user with a specific user ID.
   </p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "Content-Type: application/json" \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request PUT \
 --data '{
    "userName":"james",
    "sn":"Berg",
    "givenName":"James",
    "mail": "james@example.com",
    "telephoneNumber": "082082082",
    "password":"password"
  }' \
"https://localhost:8443/openidm/managed/user/james"</strong></pre></div><p>
    The following example checks whether a user exists, then updates the user
    entry. The command replaces the telephone number with the new data provided
    in the request body.
   </p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "Content-Type: application/json" \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request POST \
 --data '[{
  "operation":"replace",
  "field":"/telephoneNumber",
  "value":"1234567"
  }]' \
  "https://localhost:8443/openidm/managed/user?_action=patch&amp;_queryId=for-userName&amp;uid=<em><strong>id</strong></em>"</strong>
   </pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="managing-system-objects-REST"></a>E.7.3.&nbsp;Managing System Objects Over Rest</h3></div></div></div><p>
    System objects, that is, objects that are stored in remote systems, are
    exposed under the <code class="literal">/openidm/system</code> context. OpenIDM
    provides access to system objects over REST, as listed in the following
    table.
   </p><div class="informaltable"><table width="100%" border="0"><colgroup><col width="50%" class="c1"><col width="10%" class="c2"><col width="40%" class="c3"></colgroup><thead><tr><th>URI</th><th>HTTP Operation</th><th>Description</th></tr></thead><tbody><tr><td>/openidm/system?_action=<em class="replaceable"><code>action-name</code></em></td><td>POST</td><td>
        <p>
         <code class="literal">_action=CREATECONFIGURATION</code> returns a list of the
         connector configurations available in <code class="literal">openidm/connectors</code>.
        </p>
        <p>
         <code class="literal">_action=test</code> returns a list of all remote systems,
         with their status.
        </p>
        <p>
         <code class="literal">_action=testConfig</code> validates the connector
         configuration provided in the POST body.
        </p>
        <p>
         <code class="literal">_action=liveSync</code> triggers a liveSync operation on
         the specified source object.
        </p>
        <p>
         <code class="literal">_action=authenticate</code> authenticates to the specified
         system with the credentials provided.
        </p>
       </td></tr><tr><td>/openidm/system/<em class="replaceable"><code>system-name</code></em>?_action=<em class="replaceable"><code>action-name</code></em></td><td>POST</td><td>
        <p>
         <code class="literal">_action=test</code> tests the status of the specified
         system.
        </p>
       </td></tr><tr><td>/openidm/system/<em class="replaceable"><code>system-name</code></em>/<em class="replaceable"><code>system-object</code></em>?_action=<em class="replaceable"><code>action-name</code></em></td><td>POST</td><td>
        <p>
         <code class="literal">_action=liveSync</code> triggers a liveSync operation on
         the specified system object.
        </p>
        <p>
         <code class="literal">_action=script</code> runs the specified script on the
         system object.
        </p>
        <p>
         <code class="literal">_action=authenticate</code> authenticates to the specified
         system object, with the provided credentials.
        </p>
        <p>
         <code class="literal">_action=create</code> creates a new system object.
        </p>
       </td></tr><tr><td>/openidm/system/<em class="replaceable"><code>system-name</code></em>/<em class="replaceable"><code>system-object</code></em>?_queryId=query-all-ids</td><td>GET</td><td>Lists all IDs related to the specified system object, such as
        users, and groups.</td></tr><tr><td>/openidm/system/<em class="replaceable"><code>system-name</code></em>/<em class="replaceable"><code>system-object</code></em>?_queryFilter=<em class="replaceable"><code>filter</code></em></td><td>GET</td><td>Lists the item(s) associated with the query filter.</td></tr><tr><td>/openidm/system/<em class="replaceable"><code>system-name</code></em>/<em class="replaceable"><code>system-object</code></em>/<em class="replaceable"><code>id</code></em></td><td>PUT</td><td>Creates a system object, or updates the system object, if it
        exists (replaces the entire object).</td></tr><tr><td>/openidm/system/<em class="replaceable"><code>system-name</code></em>/<em class="replaceable"><code>system-object</code></em>/<em class="replaceable"><code>id</code></em></td><td>DELETE</td><td>Deletes a system object.</td></tr></tbody></table></div><div class="note"><h3 class="title">Note</h3><p>
     When you create a system object with a PUT request (that is, specifying a
     client-assigned ID), you should specify the ID in the URL only and not in
     the JSON payload. If you specify a different ID in the URL and in the JSON
     payload, the request will fail, with an error similar to the following:
    </p><div class="screen"><pre>{
    "code":500,
    "reason":"Internal Server Error",
    "message":"The uid attribute is not single value attribute."}</pre></div><p>
     The <code class="literal">patch</code> action is not supported on system objects.
    </p></div><div class="example"><a name="d505e22386"></a><div class="example-title">Example&nbsp;E.1.&nbsp;Returning a list of the available connector configurations</div><div class="example-contents"><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "Content-Type: application/json" \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request POST \
 "https://localhost:8443/openidm/system?_action=CREATECONFIGURATION"</strong></pre></div></div></div><br class="example-break"><div class="example"><a name="d505e22393"></a><div class="example-title">Example&nbsp;E.2.&nbsp;Returning a list of remote systems, and their status</div><div class="example-contents"><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "Content-Type: application/json" \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request POST \
 "https://localhost:8443/openidm/system?_action=test"</strong>
<em>[
  {
    "ok": true,
    "name": "ldap"
  }
]</em></pre></div></div></div><br class="example-break"><div class="example"><a name="d505e22403"></a><div class="example-title">Example&nbsp;E.3.&nbsp;Two options for running a liveSync operation on a specified system object</div><div class="example-contents"><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "Content-Type: application/json" \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request POST \
 "http://localhost:8080/openidm/system?_action=liveSync&amp;source=system/ldap/account"</strong>
<em>{
  "_rev": "1",
  "_id": "SYSTEMLDAPACCOUNT",
  "connectorData": {
    "nativeType": "integer",
    "syncToken": 0
  }
}</em></pre></div><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "Content-Type: application/json" \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request POST \
 "https://localhost:8443/openidm/system/ldap/account?_action=liveSync"</strong>
<em>
{
  "_rev": "2",
  "_id": "SYSTEMLDAPACCOUNT",
  "connectorData": {
    "nativeType": "integer",
    "syncToken": 0
  }
}   </em></pre></div></div></div><br class="example-break"><div class="example"><a name="d505e22420"></a><div class="example-title">Example&nbsp;E.4.&nbsp;Running a script on a system object</div><div class="example-contents"><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "Content-Type: application/json" \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request POST \
 "https://localhost:8443/openidm/system/ldap/account?_action=script&amp;_scriptId=addUser"</strong></pre></div></div></div><br class="example-break"><div class="example"><a name="d505e22427"></a><div class="example-title">Example&nbsp;E.5.&nbsp;Authenticating to a system object</div><div class="example-contents"><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "Content-Type: application/json" \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request POST \
 "https://localhost:8443/openidm/system/ldap/account?_action=authenticate&amp;username=bjensen&amp;password=Passw0rd"</strong>
<em>{
  "_id": "uid=bjensen,ou=People,dc=example,dc=com"
}</em></pre></div></div></div><br class="example-break"><div class="example"><a name="d505e22437"></a><div class="example-title">Example&nbsp;E.6.&nbsp;Creating a new system object</div><div class="example-contents"><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "Content-Type: application/json" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "X-OpenIDM-Username: openidm-admin" \
 --data '{
    "cn":"James Smith",
    "dn":"uid=jsmith,ou=people,dc=example,dc=com",
    "uid":"jsmith",
    "sn":"Smith",
    "givenName":"James",
    "mail": "jsmith@example.com",
    "description":"Created by OpenIDM REST"}' \
 --request POST \
 "https://localhost:8443/openidm/system/ldap/account?_action=create"</strong>
<em>{
    "telephoneNumber":null,
    "description":"Created by OpenIDM REST",
    "mail":"jsmith@example.com",
    "givenName":"James",
    "cn":"James Smith",
    "dn":"uid=jsmith,ou=people,dc=example,dc=com",
    "uid":"jsmith",
    "ldapGroups":[],
    "sn":"Smith",
    "_id":"uid=jsmith,ou=people,dc=example,dc=com"
}   </em></pre></div></div></div><br class="example-break"><div class="example"><a name="d505e22447"></a><div class="example-title">Example&nbsp;E.7.&nbsp;List the IDs associated with a specific system object</div><div class="example-contents"><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "Content-Type: application/json" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "X-OpenIDM-Username: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/system/ldap/account?_queryId=query-all-ids"</strong>
<em>{
  "remainingPagedResults": -1,
  "pagedResultsCookie": null,
  "resultCount": 3,
  "result": [
    {
      "_id": "uid=jdoe,ou=People,dc=example,dc=com",
      "dn": "uid=jdoe,ou=People,dc=example,dc=com"
    },
    {
      "_id": "uid=bjensen,ou=People,dc=example,dc=com",
      "dn": "uid=bjensen,ou=People,dc=example,dc=com"
    },
    {
      "_id": "uid=jsmith,ou=people,dc=example,dc=com",
      "dn": "uid=jsmith,ou=people,dc=example,dc=com"
    }
  ]
}</em></pre></div></div></div><br class="example-break"></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="managing-workflows-over-REST"></a>E.7.4.&nbsp;Managing Workflows Over Rest</h3></div></div></div><p>
     Workflow objects are exposed under the <code class="literal">/openidm/workflow</code>
     context. OpenIDM provides access to the workflow module over REST, as listed
     in the following table.
    </p><div class="informaltable"><table width="100%" border="0"><colgroup><col width="50%" class="c1"><col width="10%" class="c2"><col width="40%" class="c3"></colgroup><thead><tr><th>URI</th><th>HTTP Operation</th><th>Description</th></tr></thead><tbody><tr><td>/openidm/workflow/processdefinition</td><td>GET</td><td>Lists the defined workflow definitions</td></tr><tr><td>/openidm/workflow/processdefinition?_queryId=<em class="replaceable"><code>id</code></em></td><td>GET</td><td>Performs a filtered search for a process definition</td></tr><tr><td>/openidm/workflow/processdefinition/<em class="replaceable"><code>id</code></em></td><td>GET</td><td>Returns detailed information about the specified process definition</td></tr><tr><td>/openidm/workflow/processinstance?_queryId=query-all-ids</td><td>GET</td><td>Lists the running workflow process instances</td></tr><tr><td>/openidm/workflow/processinstance/<em class="replaceable"><code>id</code></em></td><td>GET</td><td>Provides detailed information of a running process instance</td></tr><tr><td>/openidm/workflow/taskdefinition</td><td>GET</td><td>Returns detailed information about the task definition</td></tr><tr><td>/openidm/workflow/taskinstance</td><td>GET</td><td>Returns detailed information about the task instance</td></tr><tr><td>/openidm/workflow/task?_queryId=query-all-ids</td><td>GET</td><td>Lists all active tasks</td></tr><tr><td>/openidm/workflow/task?_queryId=filteredQuery&amp;<em class="replaceable"><code>filter
        </code></em></td><td>GET</td><td>Lists the tasks according to the specified filter</td></tr><tr><td>/openidm/workflow/task?_queryId=user-task-summary&amp;id=<em class="replaceable"><code>id
        </code></em></td><td>GET</td><td>Lists the summary of tasks assigned to the specified user</td></tr><tr><td>/openidm/workflow/processinstance_action=create</td><td>POST</td><td>Start a new workflow. Parameters are included in the request body.</td></tr><tr><td>/openidm/workflow/task/<em class="replaceable"><code>id</code></em></td><td>PUT</td><td>Update task data</td></tr><tr><td>/openidm/workflow/processinstance/<em class="replaceable"><code>id</code></em></td><td>DELETE</td><td>Delete a process instance</td></tr><tr><td>/openidm/workflow/task/<em class="replaceable"><code>id</code></em>?_action=claim</td><td>POST</td><td>Claim or complete a task. Parameters are included in the request body.
        Specifically for user tasks, a user can <span class="emphasis"><em>claim</em></span> a specific
        task, which will then be assigned to that user.</td></tr></tbody></table></div><p>The following examples list the defined workflows. For a workflow to
     appear in this list, the corresponding workflow definition must be in the
     <code class="literal">openidm/workflow</code> directory.</p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/workflow/processdefinition?_queryId=query-all-ids"</strong></pre></div><p>Depending on the defined workflows, the output will be something like
     the following:</p><div class="screen"><pre>{
"result":[ {
     "tenantId" : "",
     "candidateStarterGroupIdExpressions" : [ ],
     "candidateStarterUserIdExpressions" : [ ],
     "participantProcess" : null,
...
 } ],
     "resultCount" : 1,
     "pagedResultsCookie" : null,
     "remainingPagedResults" : -1
}</pre></div><p>The following example invokes a workflow named "myWorkflow". The
     <code class="literal">foo</code> parameter is given the value <code class="literal">bar</code>
     in the workflow invokation.</p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "Content-Type: application/json" \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request POST \
 --data '{
      "key":"contractorOnboarding",
      "foo":"bar"
  }' \
 "https://localhost:8443/openidm/workflow/processinstance?_action=create"</strong></pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="managing-scanned-REST"></a>E.7.5.&nbsp;Managing Scanned Tasks Over REST</h3></div></div></div><p>
     OpenIDM provides a task scanning mechanism that enables you
     to perform a batch scan for a specified date in OpenIDM data, on a
     scheduled interval, and then to execute a task when this date is
     reached. For more information about scanned tasks, see <a href="../integrators-guide/index.html#task-scanner" class="link">
     <em class="citetitle">Scanning Data to Trigger Tasks</em></a>.</p><p>OpenIDM provides REST access to the task scanner, as listed
     in the following table.</p><div class="informaltable"><table width="100%" border="0"><colgroup><col width="50%" class="c1"><col width="10%" class="c2"><col width="40%" class="c3"></colgroup><thead><tr><th>URI</th><th>HTTP Operation</th><th>Description</th></tr></thead><tbody><tr><td>/openidm/taskscanner</td><td>GET</td><td>Lists the all scanning tasks, past and present.</td></tr><tr><td>/openidm/taskscanner/<em class="replaceable"><code>id</code></em></td><td>GET</td><td>Lists details of the given task.</td></tr><tr><td>/openidm/taskscanner?_action=execute&amp;name=<em class="replaceable"><code>name</code></em></td><td>POST</td><td>Triggers the specified task scan run.</td></tr><tr><td>/openidm/taskscanner/<em class="replaceable"><code>id</code></em>?_action=cancel</td><td>POST</td><td>Cancels the specified task scan run.</td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="accessing-log-REST"></a>E.7.6.&nbsp;Accessing Log Entries Over REST</h3></div></div></div><p>
    You can interact with the audit and activity logs over REST, as
    shown in the following table.</p><div class="informaltable"><table width="100%" border="0"><colgroup><col width="50%" class="c1"><col width="10%" class="c2"><col width="40%" class="c3"></colgroup><thead><tr><th>URI</th><th>HTTP Operation</th><th>Description</th></tr></thead><tbody><tr><td>/openidm/audit/recon</td><td>GET</td><td>Displays the reconciliation audit log</td></tr><tr><td>/openidm/audit/recon/<em class="replaceable"><code>id</code></em></td><td>GET</td><td>Reads a specific reconciliation audit log entry</td></tr><tr><td>/openidm/audit/recon?_queryId=audit-by-recon-id&amp;reconId=<em class="replaceable"><code>id</code></em></td><td>GET</td><td>Queries the audit log for a particular reconciliation operation</td></tr><tr><td>/openidm/audit/recon?_queryId=audit-by-recon-id-situation&amp;situation=
        <em class="replaceable"><code>situation</code></em>&amp;reconId=<em class="replaceable"><code>id</code></em></td><td>GET</td><td>Queries the reconciliation audit log for a specific reconciliation situation</td></tr><tr><td>/openidm/audit/activity</td><td>GET</td><td>Displays the activity log</td></tr><tr><td>/openidm/audit/activity/<em class="replaceable"><code>id</code></em></td><td>GET</td><td>Returns activity information for a specific action</td></tr><tr><td>/openidm/audit/activity?_queryId=audit-by-activity-parent-action&amp;parentActionId=<em class="replaceable"><code>id</code></em></td><td>GET</td><td>Queries the activity log for the details of an action</td></tr><tr><td>/openidm/audit/access</td><td>GET</td><td>Displays the full list of auditable actions.</td></tr><tr><td>/openidm/audit/access/<em class="replaceable"><code>id</code></em></td><td>GET</td><td>Displays information on the specific audit item.</td></tr></tbody></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="recon-over-REST"></a>E.7.7.&nbsp;Managing Reconciliation Operations Over REST</h3></div></div></div><p>
    You can interact with the reconciliation engine over REST,
    as shown in the following table.</p><div class="informaltable"><table width="100%" border="0"><colgroup><col width="50%" class="c1"><col width="10%" class="c2"><col width="40%" class="c3"></colgroup><thead><tr><th>URI</th><th>HTTP Operation</th><th>Description</th></tr></thead><tbody><tr><td>/openidm/recon</td><td>GET</td><td>Lists all completed reconciliation runs</td></tr><tr><td>/openidm/recon?_action=recon&amp;mapping=<em class="replaceable"><code>mapping-name
       </code></em></td><td>POST</td><td>Launches a reconciliation run with the specified mapping</td></tr><tr><td>/openidm/recon/<em class="replaceable"><code>id</code></em>?_action=cancel</td><td>POST</td><td>Cancels the specified reconciliation run</td></tr><tr><td>/openidm/system/<em class="replaceable"><code>datastore</code></em>
       account?_action=liveSync</td><td>POST</td><td>Calls a LiveSync operation.</td></tr></tbody></table></div><p>
     The following example runs a reconciliation action, with the mapping
     <code class="literal">systemHrdb_managedUser</code>, defined in the <code class="filename">sync.json
     </code> file.
    </p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "Content-Type: application/json" \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request POST \
 "https://localhost:8443/openidm/recon?_action=recon&amp;mapping=systemHrdb_managedUser"</strong></pre></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="http-status-codes"></a>E.8.&nbsp;HTTP Status Codes</h2></div></div></div><p>The OpenIDM REST API returns the standard HTTP response codes, as
            described in the following table.</p><div class="informaltable"><table border="0"><colgroup><col width="40%" class="c1"><col width="60%" class="c2"></colgroup><thead><tr><th>HTTP Status</th><th>Description</th></tr></thead><tbody><tr><td>200 OK</td><td>The request was successfully completed. If this request created a
         new resource that is addressable with a URI, and a response body is
         returned containing a representation of the new resource, a 200 status
         will be returned with a Location header containing the canonical URI for
         the newly created resource.</td></tr><tr><td>201 Created</td><td>A request that created a new resource was completed. A
         representation of the new resource is returned. A
         Location header containing the canonical URI for the newly created resource
         should also be returned.</td></tr><tr><td>202 Accepted</td><td>The request has been accepted for processing, but the processing
         has not been completed.</td></tr><tr><td>204 No Content</td><td>The server fulfilled the request, but does not need to return a
         response message body.</td></tr><tr><td>400 Bad Request</td><td>The request could not be processed because it contains missing or
         invalid information.</td></tr><tr><td>401 Unauthorized</td><td>The authentication credentials included with this request are
         missing or invalid.</td></tr><tr><td>403 Forbidden</td><td>The server recognized your credentials, but you do not possess
         authorization to perform this request.</td></tr><tr><td>404 Not Found</td><td>The request specified a URI of a resource that does not exist.</td></tr><tr><td>405 Method Not Allowed</td><td>The HTTP verb specified in the request (DELETE, GET, HEAD, POST, PUT)
         is not supported for this request URI.</td></tr><tr><td>406 Not Acceptable</td><td>The resource identified by this request is not capable of generating
         a representation corresponding to one of the media types in the Accept
         header of the request.</td></tr><tr><td>409 Conflict</td><td>A creation or update request could not be completed, because it would
         cause a conflict in the current state of the resources supported by the
         server (for example, an attempt to create a new resource with a unique
         identifier already assigned to some existing resource).</td></tr><tr><td>500 Internal Server Error</td><td>The server encountered an unexpected condition which prevented it
         from fulfilling the request.</td></tr><tr><td>501 Not Implemented</td><td>The server does not (currently) support the functionality required
         to fulfill the request.</td></tr><tr><td>503 Service Unavailable</td><td>The server is currently unable to handle the request due to
         temporary overloading or maintenance of the server.</td></tr></tbody></table></div></div></div><div lang="en" class="appendix"><div class="titlepage"><div><div><h1 class="title"><a name="appendix-scripting"></a>Appendix&nbsp;F.&nbsp;Scripting Reference</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="section"><a href="#scripting-configuration">F.1. Scripting Configuration</a></span></dt><dt><span class="section"><a href="#scripting-example">F.2. Examples</a></span></dt><dt><span class="section"><a href="#function-ref">F.3. Function Reference</a></span></dt><dt><span class="section"><a href="#script-places">F.4. Places to Trigger Scripts</a></span></dt><dt><span class="section"><a href="#script-variables">F.5. Variables Available in Scripts</a></span></dt><dt><span class="section"><a href="#debugging-scripts">F.6. Debugging OpenIDM JavaScripts</a></span></dt></dl></div><a class="indexterm" name="d505e22937"></a><p>
   Scripting allows you to customize various aspects of OpenIDM functionality,
   for example, by providing custom logic between source and target mappings,
   defining correlation rules, filters, and triggers, and so on.
  </p><p>
   OpenIDM 3.0.0 supports scripts written in JavaScript and
   Groovy. OpenIDM configures script options in the
   <code class="filename">conf/script.json</code> file.
  </p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="scripting-configuration"></a>F.1.&nbsp;Scripting Configuration</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#script-json">F.1.1. Script Configuration File</a></span></dt><dt><span class="section"><a href="#script-call">F.1.2. Calling A Script From Another Configuration File</a></span></dt></dl></div><p>
    OpenIDM includes several default scripts in the following directory:
    <code class="filename">path/to/openidm/bin/defaults/script/</code>. Do not modify
    or remove any of the scripts in this directory, as OpenIDM needs these
    scripts to run specific services. Scripts in this folder are not guaranteed
    to remain constant between product releases.
   </p><p>
    If you develop custom scripts, copy them to the <code class="literal">script/</code>
    directory for your project, such as
    <code class="literal">path/to/openidm/script/</code>.
   </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="script-json"></a>F.1.1.&nbsp;Script Configuration File</h3></div></div></div><p>
      OpenIDM 3.0.0 includes a script configuration file
      in the <code class="filename">conf/</code> directory,
      <code class="filename">script.json</code>. OpenIDM uses this file to set up
      <a href="../integrators-guide/index.html#config-default-directories" class="link">
       <em class="citetitle">Default and Custom Configuration Directories</em>
      </a>.
     </p><p>
      The properties shown in the default version of the
      <code class="filename">script.json</code> file are described here:
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">properties</span></dt><dd><p>
         Additional custom properties.
        </p></dd><dt><span class="term">ECMAScript</span></dt><dd><p>
         JavaScript is an ECMAScript language.
        </p></dd><dt><span class="term">javascript.debug</span></dt><dd><p>
         See <a class="xref" href="#debugging-scripts" title="F.6.&nbsp;Debugging OpenIDM JavaScripts">Section&nbsp;F.6, &#8220;Debugging OpenIDM JavaScripts&#8221;</a>
        </p></dd><dt><span class="term">javascript.recompile.minimumInterval</span></dt><dd><p>
         Minimum time after which a script can be recompiled.
        </p></dd><dt><span class="term">groovy.warnings</span></dt><dd><p>
         Specifies a log level for Groovy scripts.
        </p></dd><dt><span class="term">groovy.source.encoding</span></dt><dd><p>
         Defines the encoding format for Groovy scripts.
        </p></dd><dt><span class="term">groovy.target.directory</span></dt><dd><p>
         Specifies the output directory.
        </p></dd><dt><span class="term">groovy.target.bytecode</span></dt><dd><p>
         Specifies the output bytecode.
        </p></dd><dt><span class="term">groovy.classpath</span></dt><dd><p>
         Defines directories with Groovy class files.
        </p></dd><dt><span class="term">groovy.output.verbose</span></dt><dd><p>
         Specifies the verbosity of stack traces.
        </p></dd><dt><span class="term">groovy.output.debug</span></dt><dd><p>
         Sets debugging status.
        </p></dd><dt><span class="term">groovy.errors.tolerance</span></dt><dd><p>
         Sets number of non-fatal errors before aborting a compilation.
        </p></dd><dt><span class="term">groovy.script.extension</span></dt><dd><p>
         Defines the file extension for a Groovy script.
        </p></dd><dt><span class="term">groovy.script.base</span></dt><dd><p>
         Defines the base class for the script.
        </p></dd><dt><span class="term">groovy.recompile</span></dt><dd><p>
         Allows a script to be recompiled.
        </p></dd><dt><span class="term">groovy.recompile.minimumInterval</span></dt><dd><p>
         Minimum time between when Groovy scripts can be compiled.
        </p></dd><dt><span class="term">groovy.target.indy</span></dt><dd><p>
         Defines whether a Groovy indy test can be used.
        </p></dd><dt><span class="term">groovy.disabled.global.ast.transformations</span></dt><dd><p>
         Notes whether Groovy Abstract Syntax Transformations (AST)s are 
         disabled.
        </p></dd></dl></div><p>
     The remaining options in the <code class="filename">script.json</code> file are
     discussed in the section on <a href="../integrators-guide/index.html#config-default-directories" class="link">
     <em class="citetitle">Default and Custom Configuration Directories</em></a>.
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="script-call"></a>F.1.2.&nbsp;Calling A Script From Another Configuration File</h3></div></div></div><pre class="brush: javascript;">

{
  "type" : "text/javascript",
  "source": string
}  </pre><p>or</p><pre class="brush: javascript;">
{
  "type" : "text/javascript",
  "file" : file location
}  </pre><div class="variablelist"><dl class="variablelist"><dt><span class="term">type</span></dt><dd><p>string, required</p><p>
       Specifies the type of script to be executed. Supported types include
       <code class="literal">"text/javascript"</code> and <code class="literal">"groovy"</code>.
      </p></dd><dt><span class="term">source</span></dt><dd><p>string, required if file is not specified</p><p>
       Specifies the source code of the script to be executed.
      </p></dd><dt><span class="term">file</span></dt><dd><p>string, required if source is not specified</p><p>
       Specifies the file containing the source code of the script to execute.
      </p></dd></dl></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="scripting-example"></a>F.2.&nbsp;Examples</h2></div></div></div><p>
    The following example (included in the <code class="filename">sync.json</code> file)
    returns <code class="literal">true</code> if the <code class="literal">employeeType</code> is
    equal to <code class="literal">external</code>, otherwise returns
    <code class="literal">false</code>. This script can be useful during reconciliation to
    establish whether the source object should be a part of the reconciliation,
    or ignored.
   </p><pre class="brush: javascript;">
"validTarget": {
   "type" : "text/javascript",
   "source": "target.employeeType == 'external'"
}  </pre><p>
    The following example (included in the <code class="filename">sync.json</code> file)
    sets the <code class="literal">__PASSWORD__</code> attribute to
    <code class="literal">defaultpwd</code> when OpenIDM creates a target object.
   </p><pre class="brush: javascript;">
"onCreate" : {
  "type" : "text/javascript",
  "source": "target.__PASSWORD__ = 'defaultpwd'"
}  </pre><p>
    The following example (included in the <code class="filename">router.json</code>
    file) shows a trigger to create Solaris home directories using a script. The
    script is located in a file,
    <code class="filename">/path/to/openidm/script/createUnixHomeDir.js</code>.
   </p><pre class="brush: javascript;">
{
  "filters" : [ {
    "pattern" : "^system/solaris/account$",
    "methods" : [ "create" ],
    "onResponse" : {
      "type" : "text/javascript",
      "file" : "script/createUnixHomeDir.js"
    }
  } ]
}   </pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="function-ref"></a>F.3.&nbsp;Function Reference</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#function-create">F.3.1. openidm.create(container, id, value)</a></span></dt><dt><span class="section"><a href="#function-patch">F.3.2. openidm.patch(id, rev, value)</a></span></dt><dt><span class="section"><a href="#function-read">F.3.3. openidm.read(id)</a></span></dt><dt><span class="section"><a href="#function-update">F.3.4. openidm.update(id, rev, value)</a></span></dt><dt><span class="section"><a href="#function-delete">F.3.5. openidm.delete(id, rev)</a></span></dt><dt><span class="section"><a href="#function-query">F.3.6. openidm.query(id, params)</a></span></dt><dt><span class="section"><a href="#function-action">F.3.7. openidm.action(id, params, value)</a></span></dt><dt><span class="section"><a href="#function-encrypt">F.3.8. openidm.encrypt(value, cipher, alias)</a></span></dt><dt><span class="section"><a href="#function-decrypt">F.3.9. openidm.decrypt(value)</a></span></dt><dt><span class="section"><a href="#function-logger-debug">F.3.10. logger.debug(string message, object... params)</a></span></dt><dt><span class="section"><a href="#function-logger-error">F.3.11. logger.error(string message, object... params)</a></span></dt><dt><span class="section"><a href="#function-logger-info">F.3.12. logger.info(string message, object... params)</a></span></dt><dt><span class="section"><a href="#function-logger-trace">F.3.13. logger.trace(string message, object... params)</a></span></dt><dt><span class="section"><a href="#function-logger-warn">F.3.14. logger.warn(string message, object... params)</a></span></dt></dl></div><a class="indexterm" name="d505e23200"></a><a class="indexterm" name="d505e23205"></a><p>
     Functions (access to managed objects, system objects, and configuration
     objects) within OpenIDM are accessible to scripts via the
     <code class="literal">openidm</code> object, which is included in the top-level scope
     provided to each script.
    </p><p>
     OpenIDM also provides a <code class="literal">logger</code> object to access SLF4J
     facilities. The following code shows an example:
    </p><pre class="brush: javascript;">
logger.info("Parameters passed in: {} {} {}", param1, param2, param3);
        </pre><p>To set the log level, use
            <code class="literal">org.forgerock.openidm.script.javascript.JavaScript.level</code>
            in <code class="filename">openidm/conf/logging.properties</code>.
        </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="function-create"></a>F.3.1.&nbsp;openidm.create(container, id, value)</h3></div></div></div><p>This function creates a new resource object.</p><div class="variablelist"><div class="variablelist-title">Parameters</div><dl class="variablelist"><dt><span class="term">container</span></dt><dd><p>string</p><p>
                         The resource container in which the object will be
                         created, for example, <code class="literal">managed/user</code>.
                        </p></dd><dt><span class="term">id</span></dt><dd><p>string</p><p>
                         The identifier of the object to be created, if the
                         client is supplying the ID. If the server should
                         generate an ID, pass null here.
                         </p></dd><dt><span class="term">value</span></dt><dd><p>object</p><p>The value of the object to be created.</p></dd></dl></div><div class="itemizedlist"><div class="itemizedlist-title">Returns</div><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The created OpenIDM resource object.
                    </p></li></ul></div><div class="itemizedlist"><div class="itemizedlist-title">Throws</div><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>An exception is thrown if the object could not be created.
                    </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="function-patch"></a>F.3.2.&nbsp;openidm.patch(id, rev, value)</h3></div></div></div><p>This function performs a partial modification of a managed
            object. Unlike the <code class="literal">update</code> function, only the
            modified attributes are provided, not the entire object.</p><div class="variablelist"><div class="variablelist-title">Parameters</div><dl class="variablelist"><dt><span class="term">id</span></dt><dd><p>string</p><p>The identifier of the object to be updated.</p></dd><dt><span class="term">rev</span></dt><dd><p>string</p><p>The revision of the object to be updated, or
                        <code class="literal">null</code> if the object is not subject
                        to revision control.
                        </p></dd><dt><span class="term">value</span></dt><dd><p>object</p><p>The value of the modifications to be applied to
                        the object.</p></dd></dl></div><div class="itemizedlist"><div class="itemizedlist-title">Returns</div><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The modified OpenIDM resource object.
                    </p></li></ul></div><div class="itemizedlist"><div class="itemizedlist-title">Throws</div><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>An exception is thrown if the object could not be updated.
                    </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="function-read"></a>F.3.3.&nbsp;openidm.read(id)</h3></div></div></div><p>This function reads and returns an OpenIDM resource object.</p><div class="variablelist"><div class="variablelist-title">Parameters</div><dl class="variablelist"><dt><span class="term">id</span></dt><dd><p>string</p><p>The identifier of the object to be read.</p></dd></dl></div><div class="itemizedlist"><div class="itemizedlist-title">Returns</div><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The read OpenIDM resource object, or <code class="literal">null</code>
                        if not found.
                    </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="function-update"></a>F.3.4.&nbsp;openidm.update(id, rev, value)</h3></div></div></div><p>This function updates a resource object.</p><div class="variablelist"><div class="variablelist-title">Parameters</div><dl class="variablelist"><dt><span class="term">id</span></dt><dd><p>string</p><p>The identifier of the resource object to be updated.</p></dd><dt><span class="term">rev</span></dt><dd><p>string</p><p>The revision of the object to be updated, or
                            <code class="literal">null</code> if the object is not subject to revision control.
                        </p></dd><dt><span class="term">value</span></dt><dd><p>object</p><p>The value of the object to be updated.</p></dd></dl></div><div class="itemizedlist"><div class="itemizedlist-title">Returns</div><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The modified OpenIDM resource object.
                    </p></li></ul></div><div class="itemizedlist"><div class="itemizedlist-title">Throws</div><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>An exception is thrown if the object could not be updated.
                    </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="function-delete"></a>F.3.5.&nbsp;openidm.delete(id, rev)</h3></div></div></div><p>This function deletes a resource object.</p><div class="variablelist"><div class="variablelist-title">Parameters</div><dl class="variablelist"><dt><span class="term">id</span></dt><dd><p>string</p><p>The identifier of the object to be deleted.</p></dd><dt><span class="term">rev</span></dt><dd><p>string</p><p>The revision of the object to be deleted, or
                            <code class="literal">null</code> if the object is not subject to revision control.
                        </p></dd></dl></div><div class="itemizedlist"><div class="itemizedlist-title">Returns</div><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>A <code class="literal">null</code> value if successful.
                    </p></li></ul></div><div class="itemizedlist"><div class="itemizedlist-title">Throws</div><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>An exception is thrown if the object could not be deleted.
                    </p></li></ul></div><p>Note that <code class="literal">delete</code> is a reserved word in JavaScript
                and this function can therefore not be called in the usual manner. To call
                delete from a JavaScript, you must specify the call as shown in the
                following example:
            </p><pre class="brush: javascript;">
openidm['delete']('managed/user/'+ user._id, user._rev)
            </pre><p>Calling <code class="literal">openidm.delete()</code> directly from a JavaScript
                results in an error similar to the following:
            </p><div class="screen"><pre>
org.forgerock.openidm.script.ScriptException: missing name after . operator
            </pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="function-query"></a>F.3.6.&nbsp;openidm.query(id, params)</h3></div></div></div><p>This function performs a query on the specified OpenIDM resource object.
            </p><div class="variablelist"><div class="variablelist-title">Parameters</div><dl class="variablelist"><dt><span class="term">id</span></dt><dd><p>string</p><p>The identifier of the object to perform the query on.</p></dd><dt><span class="term">params</span></dt><dd><p>object</p><p>An object containing the query ID and its parameters.</p></dd></dl></div><div class="itemizedlist"><div class="itemizedlist-title">Returns</div><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The result of the query. A query result includes the following
                        parameters:
                    </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">"query-time-ms"</span></dt><dd><p>The time, in milliseconds, that OpenIDM took to process
                                    the query.
                                </p></dd><dt><span class="term">"conversion-time-ms"</span></dt><dd><p>(For an OrientDB repository only) the time, in
                                    milliseconds, taken to convert the data to a JSON object.
                                </p></dd><dt><span class="term">"result"</span></dt><dd><p>The list of entries retrieved by the query. The result
                                    includes the revision (<code class="literal">"_rev"</code>) of the
                                    entry and any other properties that were requested in the
                                    query.
                                </p></dd></dl></div><p>The following example shows the result of a custom query that
                        requests the ID, user name, and email address of managed users in the
                        repository. For an OrientDB repository, the query would be something like
                        <code class="literal">select _openidm_id, userName, email from managed_user,</code>.
                    </p><pre class="brush: javascript;">
{
  "conversion-time-ms": 0,
  "result": [
    {
      "email": "bjensen@example.com",
      "userName": "bjensen",
      "_rev": "0",
      "_id": "36bbb745-517f-4695-93d0-998e1e7065cf"
    },
    {
      "email": "scarter@example.com",
      "userName": "scarter",
      "_rev": "0",
      "_id": "cc3bf6f0-949e-4699-9b8e-8c78ce04a287"
    }
  ],
  "query-time-ms": 1
}
                    </pre></li></ul></div><div class="itemizedlist"><div class="itemizedlist-title">Throws</div><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>An exception is thrown if the given query could not be processed.
                    </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="function-action"></a>F.3.7.&nbsp;openidm.action(id, params, value)</h3></div></div></div><p>This function performs an action on the specified OpenIDM resource
                object.
            </p><div class="variablelist"><div class="variablelist-title">Parameters</div><dl class="variablelist"><dt><span class="term">id</span></dt><dd><p>string</p><p>The identifier of the object on which the action should be
                            performed.</p></dd><dt><span class="term">params</span></dt><dd><p>object</p><p>An object containing the parameters to pass to the action.</p></dd><dt><span class="term">value</span></dt><dd><p>object</p><p>A value that can be provided to the action for processing.</p></dd></dl></div><div class="itemizedlist"><div class="itemizedlist-title">Returns</div><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The result of the action. May be <code class="literal">null</code> if
                        no result is provided.
                    </p></li></ul></div><div class="itemizedlist"><div class="itemizedlist-title">Throws</div><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>An exception is thrown if the given action could not be executed
                        for any reason.
                    </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="function-encrypt"></a>F.3.8.&nbsp;openidm.encrypt(value, cipher, alias)</h3></div></div></div><p>This function encrypts a value.</p><div class="variablelist"><div class="variablelist-title">Parameters</div><dl class="variablelist"><dt><span class="term">value</span></dt><dd><p>any</p><p>The value to be encrypted.</p></dd><dt><span class="term">cipher</span></dt><dd><p>string</p><p>The cipher with which to encrypt the value, using the form
                            "algorithm/mode/padding" or just "algorithm". Example:
                            <code class="literal">AES/ECB/PKCS5Padding</code>.
                        </p></dd><dt><span class="term">alias</span></dt><dd><p>string</p><p>The key alias in the keystore with which to encrypt the node.</p></dd></dl></div><div class="itemizedlist"><div class="itemizedlist-title">Returns</div><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The value, encrypted with the specified cipher and key.</p></li></ul></div><div class="itemizedlist"><div class="itemizedlist-title">Throws</div><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>An exception is thrown if the object could not be encrypted for any
                        reason.
                    </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="function-decrypt"></a>F.3.9.&nbsp;openidm.decrypt(value)</h3></div></div></div><p>This function decrypts a value.</p><div class="variablelist"><div class="variablelist-title">Parameters</div><dl class="variablelist"><dt><span class="term">value</span></dt><dd><p>any</p><p>The value to be decrypted.</p></dd></dl></div><div class="itemizedlist"><div class="itemizedlist-title">Returns</div><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>A deep copy of the value, with any encrypted value decrypted.</p></li></ul></div><div class="itemizedlist"><div class="itemizedlist-title">Throws</div><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>An exception is thrown if the object could not be decrypted for any
                        reason.
                    </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="function-logger-debug"></a>F.3.10.&nbsp;logger.debug(string message, object... params)</h3></div></div></div><p>Logs a message at DEBUG level.</p><div class="variablelist"><div class="variablelist-title">Parameters</div><dl class="variablelist"><dt><span class="term">message</span></dt><dd><p>string</p><p>The message format to log. Params replace <code class="literal">{}</code>
                            in your message.
                        </p></dd><dt><span class="term">params</span></dt><dd><p>object</p><p>Arguments to include in the message.</p></dd></dl></div><div class="itemizedlist"><div class="itemizedlist-title">Returns</div><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>A <code class="literal">null</code> value if successful.
                    </p></li></ul></div><div class="itemizedlist"><div class="itemizedlist-title">Throws</div><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>An exception is thrown if the message could not be logged.</p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="function-logger-error"></a>F.3.11.&nbsp;logger.error(string message, object... params)</h3></div></div></div><p>Logs a message at ERROR level.</p><div class="variablelist"><div class="variablelist-title">Parameters</div><dl class="variablelist"><dt><span class="term">message</span></dt><dd><p>string</p><p>The message format to log. Params replace <code class="literal">{}</code>
                            in your message.
                        </p></dd><dt><span class="term">params</span></dt><dd><p>object</p><p>Arguments to include in the message.</p></dd></dl></div><div class="itemizedlist"><div class="itemizedlist-title">Returns</div><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>A <code class="literal">null</code> value if successful.
                    </p></li></ul></div><div class="itemizedlist"><div class="itemizedlist-title">Throws</div><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>An exception is thrown if the message could not be logged.</p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="function-logger-info"></a>F.3.12.&nbsp;logger.info(string message, object... params)</h3></div></div></div><p>Logs a message at INFO level.</p><div class="variablelist"><div class="variablelist-title">Parameters</div><dl class="variablelist"><dt><span class="term">message</span></dt><dd><p>string</p><p>The message format to log. Params replace
                            <code class="literal">{}</code>
                            in your message.
                        </p></dd><dt><span class="term">params</span></dt><dd><p>object</p><p>Arguments to include in the message.</p></dd></dl></div><div class="itemizedlist"><div class="itemizedlist-title">Returns</div><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>A
                        <code class="literal">null</code>
                        value if successful.
                    </p></li></ul></div><div class="itemizedlist"><div class="itemizedlist-title">Throws</div><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>An exception is thrown if the message could not be logged.</p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="function-logger-trace"></a>F.3.13.&nbsp;logger.trace(string message, object... params)</h3></div></div></div><p>Logs a message at TRACE level.</p><div class="variablelist"><div class="variablelist-title">Parameters</div><dl class="variablelist"><dt><span class="term">message</span></dt><dd><p>string</p><p>The message format to log. Params replace
                            <code class="literal">{}</code>
                            in your message.
                        </p></dd><dt><span class="term">params</span></dt><dd><p>object</p><p>Arguments to include in the message.</p></dd></dl></div><div class="itemizedlist"><div class="itemizedlist-title">Returns</div><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>A
                        <code class="literal">null</code>
                        value if successful.
                    </p></li></ul></div><div class="itemizedlist"><div class="itemizedlist-title">Throws</div><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>An exception is thrown if the message could not be logged.</p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="function-logger-warn"></a>F.3.14.&nbsp;logger.warn(string message, object... params)</h3></div></div></div><p>Logs a message at WARN level.</p><div class="variablelist"><div class="variablelist-title">Parameters</div><dl class="variablelist"><dt><span class="term">message</span></dt><dd><p>string</p><p>The message format to log. Params replace
                            <code class="literal">{}</code>
                            in your message.
                        </p></dd><dt><span class="term">params</span></dt><dd><p>object</p><p>Arguments to include in the message.</p></dd></dl></div><div class="itemizedlist"><div class="itemizedlist-title">Returns</div><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>A <code class="literal">null</code> value if successful.
                    </p></li></ul></div><div class="itemizedlist"><div class="itemizedlist-title">Throws</div><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>An exception is thrown if the message could not be logged.</p></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="script-places"></a>F.4.&nbsp;Places to Trigger Scripts</h2></div></div></div><p>Scripts can be triggered at different places, by different events.
        </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">In <code class="filename">openidm/conf/sync.json</code>
                </span></dt><dd><div class="variablelist"><dl class="variablelist"><dt><span class="term">Triggered by situation</span></dt><dd><p>onCreate, onUpdate, onDelete, onLink, onUnlink</p></dd><dt><span class="term">Object filter</span></dt><dd><p>vaildSource, validTarget</p></dd><dt><span class="term">Correlating objects</span></dt><dd><p>correlationQuery</p></dd><dt><span class="term">Triggered on any reconciliation</span></dt><dd><p>result</p></dd><dt><span class="term">Scripts inside properties</span></dt><dd><p>condition, transform</p><p><code class="literal">sync.json</code> supports only one script
                                    per hook. If multiple scripts are defined for the same hook, only the last
                                    one is kept.
                                </p></dd></dl></div></dd><dt><span class="term">In <code class="filename">openidm/conf/managed.json</code>
                </span></dt><dd><p>onCreate, onRead, onUpdate, onDelete, onValidate,
                     onRetrieve, onStore, postCreate, postUpdate, and postDelete
                    </p><p><code class="literal">managed.json</code> supports only one script
                        per hook. If multiple scripts are defined for the same hook, only the last
                        one is kept.
                    </p></dd><dt><span class="term">In <code class="filename">openidm/conf/router.json</code>
                </span></dt><dd><p>onRequest, onResponse, onFailure</p><p><code class="literal">router.json</code> supports multiple scripts per hook.
                    </p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="script-variables"></a>F.5.&nbsp;Variables Available in Scripts</h2></div></div></div><p>The variables that are available to scripts depend on the triggers
            that launch the script. The following section outlines the available
            variables, per trigger.
        </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">condition</span></dt><dd><p>object</p></dd><dt><span class="term">correlationQuery</span></dt><dd><p>source</p></dd><dt><span class="term">Custom endpoint scripts</span></dt><dd><p>request</p></dd><dt><span class="term">onCreate, postCreate</span></dt><dd><p>object, source, target</p></dd><dt><span class="term">onDelete, postDelete</span></dt><dd><p>object</p></dd><dt><span class="term">onLink</span></dt><dd><p>source, target</p></dd><dt><span class="term">onRead</span></dt><dd><p>object</p></dd><dt><span class="term">onRetrieve</span></dt><dd><p>object (when called from either an object or a
                     property storage trigger); property (only when
                     called from a property storage trigger)</p><p>
                  As a property, returns the modified property values from the
                  script.
                 </p></dd><dt><span class="term">onStore</span></dt><dd><p>object, property</p><p>
                  As a property, returns the modified property values from the
                  script.
                 </p></dd><dt><span class="term">onUnlink</span></dt><dd><p>source, target</p></dd><dt><span class="term">onUpdate, postUpdate</span></dt><dd><p>oldObject, newObject</p></dd><dt><span class="term">onValidate</span></dt><dd><p>object, property</p></dd><dt><span class="term">propertyName</span></dt><dd><p>
               Name of the property that is changed.
              </p></dd><dt><span class="term">result</span></dt><dd><p>source, target</p></dd><dt><span class="term">synchronization situation scripts</span></dt><dd><p><code class="literal">recon.actionParam</code> - the details of
                    the synchronization operation in progress. This variable can
                    be used for asynchronous callbacks to execute the action at
                    a later stage.</p><p><code class="literal">sourceAction</code> - a boolean that
                    indicates whether the situation was assessed during the source phase</p><p><code class="literal">source</code> (if found)</p><p><code class="literal">target</code> (if found)</p><p>The properties from the configured script object.</p></dd><dt><span class="term">taskScanner</span></dt><dd><p>input, objectID</p></dd><dt><span class="term">transform</span></dt><dd><p>source</p></dd><dt><span class="term">validSource</span></dt><dd><p>source</p></dd><dt><span class="term">validTarget</span></dt><dd><p>target</p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="debugging-scripts"></a>F.6.&nbsp;Debugging OpenIDM JavaScripts</h2></div></div></div><p>
      OpenIDM includes Eclipse JSDT libraries so you can use Eclipse to debug
      your OpenIDM JavaScripts during development.
     </p><div class="procedure"><a name="enable-debugging"></a><div class="procedure-title">Procedure&nbsp;F.1.&nbsp;To Enable Debugging</div><p>
       Follow these steps to enable debugging using Eclipse.
      </p><ol class="procedure" type="1"><li class="step"><p>
        Install the environment to support JavaScript development in either of
        the following ways.
       </p><ul class="stepalternatives">
        <li class="step"><p>
          Download and install Eclipse IDE for JavaScript Web Developers from
          the <a class="link" href="http://www.eclipse.org/downloads/" target="_blank">Eclipse download page</a>.
         </p></li>
        <li class="step"><p>
          Add <a class="link" href="http://wiki.eclipse.org/JSDT" target="_blank">JavaScript Development Tools</a> to your existing
          Eclipse installation.
         </p></li>
       </ul></li><li class="step"><p>
        Create an empty JavaScript project called <code class="literal">External JavaScript
        Source</code> in Eclipse.
       </p><p>
        Eclipse then uses the <code class="filename">External JavaScript Source</code>
        directory in the default workspace location to store sources that it
        downloads from OpenIDM.
       </p></li><li class="step"><p>
        Stop OpenIDM.
       </p></li><li class="step"><p>
        Edit <code class="filename">openidm/conf/boot/boot.properties</code> to enable
        debugging.
       </p><ol type="a" class="substeps"><li class="step"><p>
          Uncomment and edit the following line.
         </p><pre class="brush: plain;">
#openidm.script.javascript.debug=transport=socket,suspend=y,address=9888,trace=true
         </pre><p>
          Here <code class="literal">suspend=y</code> prevents OpenIDM from starting until
          the remote JavaScript debugger has connected. You might therefore
          choose to set this to <code class="literal">suspend=n</code>.
         </p></li><li class="step"><p>
          Uncomment and edit the following line.
         </p><pre class="brush: plain;">
#openidm.script.javascript.sources=/Eclipse/workspace/External JavaScript Source/
         </pre><p>
          Adjust <code class="literal">/Eclipse/workspace/External JavaScript Source/</code>
          to match the absolute path to this folder including the trailing
          <code class="literal">/</code> character. On Windows, also use forward slashes,
          such as<code class="literal">C:/Eclipse/workspace/External JavaScript Source/</code>.
         </p><p>
          Each time OpenIDM loads a new script, it then creates or overwrites
          the file in the <code class="filename">External JavaScript Source</code>
          directory. Before toggling breakpoints, be sure to refresh the source
          manually in Eclipse so you have the latest version.
         </p></li></ol></li><li class="step"><p>Prepare the Eclipse debugger to allow you to set breakpoints.</p><p>In the Eclipse Debug perspective, select the Breakpoints tab, and
                    then click the Add Script Load Breakpoint icon to open the list of
                    scripts.
                </p><p>In the Add Script Load Breakpoint window, select your scripts, and
                    then click OK.
                </p></li><li class="step"><p>Start OpenIDM, and connect the debugger.</p><p>To create a new debug, configuration click Run &gt; Debug
                    Configurations... &gt; Remote JavaScript &gt; New button, and then set
                    the port to 9888 as shown above.
                </p></li></ol></div></div></div><div lang="en" class="appendix"><div class="titlepage"><div><div><h1 class="title"><a name="appendix-router"></a>Appendix&nbsp;G.&nbsp;Router Service Reference</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="section"><a href="#router-configuration">G.1. Configuration</a></span></dt><dt><span class="section"><a href="#router-example">G.2. Example</a></span></dt></dl></div><a class="indexterm" name="d505e24168"></a><p>The OpenIDM router service provides the uniform interface to all
  objects in OpenIDM: managed objects, system objects, configuration
  objects, and so on.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="router-configuration"></a>G.1.&nbsp;Configuration</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#filter-object">G.1.1. Filter Objects</a></span></dt><dt><span class="section"><a href="#script-sequenze">G.1.2. Script Execution Sequence</a></span></dt><dt><span class="section"><a href="#filter-script-scope">G.1.3. Script Scope</a></span></dt></dl></div><p>The router object as shown in <code class="filename">conf/router.json</code>
  defines an array of filter objects.</p><pre class="brush: javascript;">
{
  "filters": [ filter object, ... ]
}</pre><p>The required filters array defines a list of filters to be processed
  on each router request. Filters are processed in the order in which they are
  specified in this array.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="filter-object"></a>G.1.1.&nbsp;Filter Objects</h3></div></div></div><p>Filter objects are defined as follows.</p><pre class="brush: javascript;">
{
  "pattern": string,
  "methods": [ string, ... ],
  "condition": script object,
  "onRequest": script object,
  "onResponse": script object,
  "onFailure": script object
}</pre><div class="variablelist"><dl class="variablelist"><dt><span class="term">"pattern"</span></dt><dd><p>string, optional</p><p>Specifies a regular expression pattern matching the JSON pointer of
      the object to trigger scripts. If not specified, all identifiers
      (including <code class="literal">null</code>) match. Pattern matching is done on the
      resource name, rather than on individual objects.</p></dd><dt><span class="term">"methods"</span></dt><dd><p>array of strings, optional</p><p>One or more methods for which the script(s) should be triggered.
      Supported methods are: <code class="literal">"create"</code>,
      <code class="literal">"read"</code>, <code class="literal">"update"</code>,
      <code class="literal">"delete"</code>, <code class="literal">"patch"</code>,
      <code class="literal">"query"</code>, <code class="literal">"action"</code>. If not specified,
      all methods are matched.</p></dd><dt><span class="term">"condition"</span></dt><dd><p>script object, optional</p><p>Specifies a script that is called first to determine if the script
      should be triggered. If the condition yields <code class="literal">"true"</code>,
      the other script(s) are executed. If no condition is specified, the 
      script(s) are called unconditionally.</p></dd><dt><span class="term">"onRequest"</span></dt><dd><p>script object, optional</p><p>Specifies a script to execute before the request is dispatched to
      the resource. If the script throws an exception, the method is not
      performed, and a client error response is provided.</p></dd><dt><span class="term">"onResponse"</span></dt><dd><p>script object, optional</p><p>Specifies a script to execute after the request is successfully
      dispatched to the resource and a response is returned. Throwing an
      exception from this script does not undo the method already
      performed.</p></dd><dt><span class="term">"onFailure"</span></dt><dd><p>script object, optional</p><p>Specifies a script to execute if the request resulted in an
      exception being thrown. Throwing an exception from this script does not
      undo the method already performed.</p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="script-sequenze"></a>G.1.2.&nbsp;Script Execution Sequence</h3></div></div></div><p>All "onRequest" and "onResponse" scripts are executed in sequence. 
    First, the "onRequest" scripts are executed from the top down, then the 
    "onResponse" scripts are executed from the bottom up.</p><div class="screen"><pre>
client -&gt; filter 1 onRequest -&gt; filter 2 onRequest -&gt; resource
client &lt;- filter 1 onResponse &lt;- filter 2 onResponse &lt;- resource
    </pre></div><p>The following sample <code class="filename">router.json</code> file shows the 
    order in which the scripts would be executed:</p><pre class="brush: javascript;">
{
    "filters" : [
        {
            "onRequest" : {
                "type" : "text/javascript",
                "file" : "script/router-authz.js"
            }
        },
        {
            "pattern" : "^managed/user",
            "methods" : [
                "read"
            ],
            "onRequest" : {
                "type" : "text/javascript",
                "source" : "java.lang.System.out.println('requestFilter 1');"
            }
        },
        {
            "pattern" : "^managed/user",
            "methods" : [
                "read"
            ],
            "onResponse" : {
                "type" : "text/javascript",
                "source" : "java.lang.System.out.println('responseFilter 1');"
            }
        },
        {
            "pattern" : "^managed/user",
            "methods" : [
                "read"
            ],
            "onRequest" : {
                "type" : "text/javascript",
                "source" : "java.lang.System.out.println('requestFilter 2');"
            }
        },
        {
            "pattern" : "^managed/user",
            "methods" : [
                "read"
            ],
            "onResponse" : {
                "type" : "text/javascript",
                "source" : "java.lang.System.out.println('responseFilter 2');"
            }
        }
    ]
}    
    </pre><p>Will produce a log like:</p><div class="screen"><pre>
requestFilter 1
requestFilter 2
responseFilter 2
responseFilter 1
    </pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="filter-script-scope"></a>G.1.3.&nbsp;Script Scope</h3></div></div></div><p>Scripts are provided with the following scope.</p><pre class="brush: javascript;">
{
  "openidm": openidm-functions object,
  "request": resource-request object,
  "response": resource-response object,
  "exception": exception object
}</pre><div class="variablelist"><dl class="variablelist"><dt><span class="term">"openidm"</span></dt><dd><p><a href="../integrators-guide/index.html#function-ref" class="link">openidm-functions</a>
      object</p><p>Provides access to OpenIDM resources.</p></dd><dt><span class="term">"request"</span></dt><dd><p><a class="link" href="https://wikis.forgerock.org/confluence/display/json/resource-request" target="_blank">resource-request</a> object</p><p>The resource-request context, which has one or more parent contexts.
      Provided in the scope of <code class="literal">"condition"</code>,
      <code class="literal">"onRequest"</code>, <code class="literal">"onResponse"</code> and
      <code class="literal">"onFailure"</code> scripts.</p></dd><dt><span class="term">"response"</span></dt><dd><p><a href="../integrators-guide/index.html#function-ref" class="link">openidm-functions</a>
      object</p><p>The response to the resource-request. Only provided in the scope of
      the <code class="literal">"onResponse"</code> script.</p></dd><dt><span class="term">"exception"</span></dt><dd><p>exception object</p><p>The exception value that was thrown as a result of processing the
      request. Only provided in the scope of the
      <code class="literal">"onFailure"</code> script.</p></dd></dl></div><p>An exception object is defined as follows.</p><pre class="brush: javascript;">
{
  "code": integer,
  "reason": string,
  "message": string,
  "detail": string
}</pre><div class="variablelist"><dl class="variablelist"><dt><span class="term">"code"</span></dt><dd><p>integer</p><p>The numeric HTTP code of the exception.</p></dd><dt><span class="term">"reason"</span></dt><dd><p>string</p><p>The short reason phrase of the exception.</p></dd><dt><span class="term">"message"</span></dt><dd><p>string</p><p>A brief message describing the exception.</p></dd><dt><span class="term">"detail"</span></dt><dd><p>(optional), string</p><p>A detailed description of the exception, in structured JSON format, 
      suitable for programmatic evaluation.</p></dd></dl></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="router-example"></a>G.2.&nbsp;Example</h2></div></div></div><p>The following example executes a script after a managed user object is
  created or updated.</p><pre class="brush: javascript;">
{
    "filters": [
        {
            "pattern": "^managed/user",
            "methods": [
                "create",
                "update"
            ],
            "onResponse": {
                "type": "text/javascript",
                "file": "scripts/afterUpdateUser.js"
            }
        }
    ]
}</pre></div></div><div lang="en" class="appendix"><div class="titlepage"><div><div><h1 class="title"><a name="appendix-jetty"></a>Appendix&nbsp;H.&nbsp;Embedded Jetty Configuration</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="section"><a href="#access-openidm-config-properties">H.1. Using OpenIDM Configuration Properties in the Jetty Configuration</a></span></dt><dt><span class="section"><a href="#default-jetty-settings">H.2. Jetty Default Settings</a></span></dt><dt><span class="section"><a href="#registering-servlet-filters">H.3. Registering Additional Servlet Filters</a></span></dt></dl></div><p>
  OpenIDM 3.0.0 includes an embedded Jetty web server.
 </p><p>To configure the embedded Jetty server, edit
 <code class="filename">openidm/conf/jetty.xml</code>. OpenIDM delegates most of the
 connector configuration to <code class="filename">jetty.xml</code>. OSGi and PAX web specific
 settings for connector configuration therefore do not have an effect. This
 lets you take advantage of all Jetty capabilities, as the web server is not
 configured through an abstraction that might limit some of the options.</p><p>
  The Jetty configuration can reference configuration properties (such as port
  numbers and keystore details) from OpenIDM's
  <code class="filename">boot.properties</code> configuration file. If you change the
  ports in the <code class="filename">boot.properties</code> file, you must make the same
  change in the <code class="filename">config.properties</code> file.
 </p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="access-openidm-config-properties"></a>H.1.&nbsp;Using OpenIDM Configuration Properties in the Jetty Configuration</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#jetty-access-bean-properties">H.1.1. Accessing Explicit Bean Properties</a></span></dt><dt><span class="section"><a href="#jetty-access-generic-properties">H.1.2. Accessing Generic Properties</a></span></dt></dl></div><p>OpenIDM exposes a <code class="literal">Param</code> class that you can use in
  <code class="filename">jetty.xml</code> to include OpenIDM configuration. The
  <code class="literal">Param</code> class exposes Bean properties for common Jetty
  settings and generic property access for other, arbitrary settings.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="jetty-access-bean-properties"></a>H.1.1.&nbsp;Accessing Explicit Bean Properties</h3></div></div></div><p>To retrieve an explicit Bean property, use the following syntax in
   <code class="filename">jetty.xml</code>.</p><pre class="brush: xml;">
&lt;Get class="org.forgerock.openidm.jetty.Param" name="&lt;bean property name&gt;"/&gt;
   </pre><p>For example, to set a Jetty property for keystore password:</p><pre class="brush: xml;">
&lt;Set name="password"&gt;
    &lt;Get class="org.forgerock.openidm.jetty.Param" name="keystorePassword"/&gt;
&lt;/Set&gt;</pre><p>Also see the bundled <code class="filename">jetty.xml</code> for further
   examples.</p><div class="variablelist"><p>The following explicit Bean properties are available.</p><dl class="variablelist"><dt><span class="term">port</span></dt><dd><p>Maps to <code class="literal">openidm.port.http</code></p></dd><dt><span class="term">port</span></dt><dd><p>Maps to <code class="literal">openidm.port.https</code></p></dd><dt><span class="term">port</span></dt><dd><p>Maps to <code class="literal">openidm.port.mutualauth</code></p></dd><dt><span class="term">keystoreType</span></dt><dd><p>Maps to <code class="literal">openidm.keystore.type</code></p></dd><dt><span class="term">keystoreProvider</span></dt><dd><p>Maps to <code class="literal">openidm.keystore.provider</code></p></dd><dt><span class="term">keystoreLocation</span></dt><dd><p>Maps to <code class="literal">openidm.keystore.location</code></p></dd><dt><span class="term">keystorePassword</span></dt><dd><p>Maps to <code class="literal">openidm.keystore.password</code></p></dd><dt><span class="term">keystoreKeyPassword</span></dt><dd><p>
       Maps to <code class="literal">openidm.keystore.key.password</code>, or the keystore
       password, if not set
      </p></dd><dt><span class="term">truststoreLocation</span></dt><dd><p>
       Maps to <code class="literal">openidm.truststore.location</code>, or the keystore
       location, if not set
      </p></dd><dt><span class="term">truststorePassword</span></dt><dd><p>
       Maps to <code class="literal">openidm.truststore.password</code>, or the keystore
       password, if not set
      </p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="jetty-access-generic-properties"></a>H.1.2.&nbsp;Accessing Generic Properties</h3></div></div></div><pre class="brush: xml;">
&lt;Call class="org.forgerock.openidm.jetty.Param" name="getProperty"&gt;
  &lt;Arg&gt;org.forgerock.openidm.some.sample.property&lt;/Arg&gt;
&lt;/Call&gt;
    </pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="default-jetty-settings"></a>H.2.&nbsp;Jetty Default Settings</h2></div></div></div><div class="itemizedlist"><p>By default the embedded Jetty server uses the following
   settings.</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The HTTP, SSL, and Mutual Authentication ports defined in OpenIDM</p></li><li class="listitem"><p>The same keystore and truststore settings as OpenIDM</p></li><li class="listitem"><p>Trivial sample realm,
    <code class="filename">openidm/security/realm.properties</code> to add users</p></li></ul></div><p>The default settings are intended for evaluation only. Adjust them
  according to your production requirements.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="registering-servlet-filters"></a>H.3.&nbsp;Registering Additional Servlet Filters</h2></div></div></div><p>
   You can register generic servlet filters in the embedded Jetty server to
   perform additional filtering tasks on requests to or responses from OpenIDM.
   For example, you might want to use a servlet filter to protect access to
   OpenIDM with an access management product. Servlet filters are configured in
   files named
   <code class="filename">openidm/conf/servletfilter-<em class="replaceable"><code>name</code></em>.json</code>.
   These servlet filter configuration files define the filter class, required
   libraries, and other settings.
  </p><p>
   A sample servlet filter configuration is provided in the
   <code class="filename">servletfilter-cors.json</code> file in the
   <code class="filename">/path/to/openidm/conf</code> directory.
  </p><p>The sample servlet filter configuration file is shown below:</p><pre class="brush: javascript;">{
    "classPathURLs" : [ ],
    "systemProperties" : { },
    "requestAttributes" : { },
    "scriptExtensions" : { }.
    "initParams" : {
       "allowedOrigins" : "https://localhost:8443",
       "allowedMethods" : "GET,POST,PUT,DELETE,PATCH",
       "allowedHeaders" : "accept,x-openidm-password,x-openidm-nosession,
                           x-openidm-username,content-type,origin,
                           x-requested-with",
       "allowCredentials" : "true",
       "chainPreflight" : "false"
    },
    "urlPatterns" : [
       "/*"
    ],
    "filterClass" : "org.eclipse.jetty.servlets.CrossOriginFilter"
}</pre><p>The sample configuration includes the following properties:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">"classPathURLs"</code></span></dt><dd><p>The URLs to any required classes or libraries that should be 
        added to the classpath used by the servlet filter class</p></dd><dt><span class="term"><code class="literal">"systemProperties"</code></span></dt><dd><p>Any additional Java system properties required by the filter</p></dd><dt><span class="term"><code class="literal">"requestAttributes"</code></span></dt><dd><p>The HTTP Servlet request attributes that will be set by OpenIDM 
        when the filter is invoked. OpenIDM expects certain request attributes 
        to be set by any module that protects access to it, so this helps in setting these expected settings.</p></dd><dt><span class="term"><code class="literal">"scriptExtensions"</code></span></dt><dd><p>Optional script extensions to OpenIDM. Currently only 
        <code class="literal">"augmentSecurityContext"</code> is supported. A script 
        that is defined in <code class="literal">augmentSecurityContext</code> is 
        executed by OpenIDM after a successful authentication request. The 
        script helps to populate the expected security context in OpenIDM. 
        For example, the login module (servlet filter) might select to supply 
        only the authenticated user name, while the associated roles and user 
        ID can be augmented by the script.</p><p>
         Supported script types include <code class="literal">"text/javascript"</code> and
         <code class="literal">"groovy"</code>. The script can be provided inline
         (<code class="literal">"source":<em class="replaceable"><code>script source</code></em></code>)
         or in a file (<code class="literal">"file":<em class="replaceable"><code>filename</code></em></code>).
        The sample filter extends the filter interface with the functionality in 
        the script <code class="filename">script/security/populateContext.js</code>.</p></dd><dt><span class="term"><code class="literal">"filterClass"</code></span></dt><dd><p>The servlet filter that is being registered</p></dd></dl></div><p>The following additional properties can be configured for the filter:
  </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">"httpContextId"</code></span></dt><dd><p>The HTTP context under which the filter should be registered. 
        The default is <code class="literal">"openidm"</code>.</p></dd><dt><span class="term"><code class="literal">"servletNames"</code></span></dt><dd><p>A list of servlet names to which the filter should apply. The 
        default is <code class="literal">"OpenIDM REST"</code>.</p></dd><dt><span class="term"><code class="literal">"urlPatterns"</code></span></dt><dd><p>A list of URL patterns to which the filter applies. The default 
        is <code class="literal">["/openidm/*", "/openidmui/*"]</code>.</p></dd><dt><span class="term"><code class="literal">"initParams"</code></span></dt><dd><p>Filter configuration initialization parameters that are passed 
        to the servlet filter <code class="literal">init</code> method. For more 
        information, see 
        <a class="link" href="http://docs.oracle.com/javaee/5/api/javax/servlet/FilterConfig.html" target="_top">http://docs.oracle.com/javaee/5/api/javax/servlet/FilterConfig.html</a>.
        </p></dd></dl></div></div></div><div lang="en" class="appendix"><div class="titlepage"><div><div><h1 class="title"><a name="appendix-interface-stability"></a>Appendix&nbsp;I.&nbsp;Release Levels &amp; Interface Stability</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="section"><a href="#release-levels">I.1. ForgeRock Product Release Levels</a></span></dt><dt><span class="section"><a href="#interface-stability">I.2. ForgeRock Product Interface Stability</a></span></dt></dl></div><p>This appendix includes ForgeRock definitions for product release levels
 and interface stability.</p><div lang="en" class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="release-levels"></a>I.1.&nbsp;ForgeRock Product Release Levels</h2></div></div></div><p>
  ForgeRock defines Major, Minor, and Maintenance product release levels.

  The release level is reflected in the version number.

  The release level tells you what sort of compatibility changes to expect.
 </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Major (version: x.0.0)</span></dt><dd><p>
     Major releases bring big new features.

     Major releases can include changes even to Stable interfaces.

     Major releases can remove previously Deprecated functionality,
     and in rare cases remove Evolving functionality
     that has not been explicitly Deprecated.

     Major releases also include the changes present
     in previous Minor and Maintenance releases.
    </p></dd><dt><span class="term">Minor (version: x.y.0)</span></dt><dd><p>
     Minor releases might include new features,
     backwards-compatible changes to Stable interfaces in the same Major release,
     and incompatible changes to Evolving interfaces.

     Minor releases can remove previously Deprecated functionality.

     Minor releases also include the changes present in Maintenance releases.
    </p></dd><dt><span class="term">Maintenance (version: x.y.z)</span></dt><dd><p>
     Maintenance releases can include bug fixes.

     Maintenance releases are intended
     to be fully compatible with previous versions from the same Minor release.
    </p></dd></dl></div></div><div lang="en" class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="interface-stability"></a>I.2.&nbsp;ForgeRock Product Interface Stability</h2></div></div></div><p>
  ForgeRock products support many protocols, APIs, GUIs,
  and command-line interfaces.

  Some of these interfaces are standard and very stable.

  Others offer new functionality that is continuing to evolve.
 </p><p>
  We realize that you invest in these interfaces,
  and therefore must know when and how ForgeRock expects them to change.

  For that reason, ForgeRock defines interface stability labels
  and uses these definitions in ForgeRock products.
 </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Stable</span></dt><dd><p>
     This documented interface is expected to undergo only
     backwards-compatible changes between major releases.

     Changes are announced at least one minor release before they take effect.
    </p></dd><dt><span class="term">Evolving</span></dt><dd><p>
     This documented interface is continuing to evolve
     and so is expected to change,
     potentially in backwards-incompatible ways even in a minor release.

     Changes are documented at the time of product release.
    </p><p>
     While new protocols and APIs are still in the process of standardization,
     they are Evolving.

     This applies for example to recent Internet-Draft implementations,
     and also to newly developed functionality.
    </p></dd><dt><span class="term">Deprecated</span></dt><dd><p>
     This interface is deprecated
     and likely to be removed in a future release.

     For previously stable interfaces,
     the change was likely announced in a previous release.

     Deprecated interfaces will be removed from ForgeRock products.
    </p></dd><dt><span class="term">Removed</span></dt><dd><p>
     This interface was deprecated in a previous release
     and has now been removed from the product.
    </p></dd><dt><span class="term">Internal/Undocumented</span></dt><dd><p>
     Internal and undocumented interfaces can change without notice.

     If you depend on one of these interfaces,
     contact ForgeRock support
     or email <a class="link" href="mailto:info@forgerock.com" target="_top">info@forgerock.com</a>
     to discuss your needs.
    </p></dd></dl></div></div></div><div lang="en" class="glossary"><div class="titlepage"><div><div><h1 class="title"><a name="openidm-glossary"></a>OpenIDM Glossary</h1></div></div></div><dl><dt><span class="glossterm">JSON</span></dt><dd class="glossdef"><p>JavaScript Object Notation, a lightweight data interchange format 
  based on a subset of JavaScript syntax. For more information, see the 
  <a class="link" href="http://www.json.org" target="_blank">JSON</a> site.</p></dd><dt><span class="glossterm">JWT</span></dt><dd class="glossdef"><p>
   JSON Web Token. As noted in the <a class="link" href="http://self-issued.info/docs/draft-ietf-oauth-json-web-token.html" target="_blank">
   <em class="citetitle">JSON Web Token draft IETF Memo</em></a>,
   "JSON Web Token (JWT) is a compact URL-safe means of representing claims to
   be transferred between two parties." For OpenIDM, the JWT is associated
   with the <code class="literal">JWT_SESSION</code> authentication module.
  </p></dd><dt><span class="glossterm">managed object</span></dt><dd class="glossdef"><p>An object that represents the identity-related data managed by OpenIDM. 
  Managed objects are configurable, JSON-based data structures that OpenIDM 
  stores in its pluggable repository. The default configuration of a managed 
  object is that of a user, but you can define any kind of managed object, for 
  example, groups or roles.</p></dd><dt><span class="glossterm">mapping</span></dt><dd class="glossdef"><p>A policy that is defined between a source object and a target object 
  during reconciliation or synchronization. A mapping can also define a trigger 
  for validation, customization, filtering, and transformation of source and 
  target objects.</p></dd><dt><span class="glossterm">OSGi</span></dt><dd class="glossdef"><p>A module system and service platform for the Java programming language 
  that implements a complete and dynamic component model. For a good 
  introduction, see the <a class="link" href="http://www.osgi.org/About/WhyOSGi" target="_blank">OSGi</a> site. OpenIDM 
  services are designed to run in any OSGi container, but OpenIDM currently 
  runs in <a class="link" href="http://felix.apache.org/site/index.html" target="_blank">Apache Felix</a>.</p></dd><dt><span class="glossterm">reconciliation</span></dt><dd class="glossdef"><p>During reconciliation, comparisons are made between managed objects 
  and objects on source or target systems. Reconciliation can result in one 
  or more specified actions, including, but not limited to, synchronization.
  </p></dd><dt><span class="glossterm">resource</span></dt><dd class="glossdef"><p>An external system, database, directory server, or other source of 
  identity data to be managed and audited by the identity management system.
  </p></dd><dt><a name="gloss-rest"></a><span class="glossterm">REST</span></dt><dd class="glossdef"><p>Representational State Transfer. A software architecture style for 
  exposing resources, using the technologies and protocols of the World Wide Web. 
  REST describes how distributed data objects, or resources, can be defined and 
  addressed.
  </p></dd><dt><span class="glossterm">source object</span></dt><dd class="glossdef"><p>In the context of reconciliation, a source object is a data object on 
  the source system, that OpenIDM scans before attempting to find a 
  corresponding object on the target system. Depending on the defined mapping, 
  OpenIDM then adjusts the object on the target system (target object).</p></dd><dt><span class="glossterm">synchronization</span></dt><dd class="glossdef"><p>The synchronization process creates, updates, or deletes objects on a 
  target system, based on the defined mappings from the source system. 
  Synchronization can be scheduled or on demand.</p></dd><dt><span class="glossterm">system object</span></dt><dd class="glossdef"><p>A pluggable representation of an object on an external system. For 
  example, a user entry that is stored in an external LDAP directory is 
  represented as a system object in OpenIDM for the period during which 
  OpenIDM requires access to that entry.System objects follow the same 
  RESTful resource-based design principles as managed objects.</p></dd><dt><span class="glossterm">target object</span></dt><dd class="glossdef"><p>In the context of reconciliation, a target object is a data object on 
  the target system, that OpenIDM scans after locating its corresponding object 
  on the source system. Depending on the defined mapping, OpenIDM then adjusts 
  the target object to match the corresponding source object.</p></dd></dl></div><div class="index"><div class="titlepage"><div><div><h1 class="title"><a name="d505e24886"></a>Index</h1></div></div></div><div class="index"><div class="indexdiv"><h3>A</h3><dl><dt>Architecture, <a class="indexterm" href="#chap-overview">Architectural Overview</a></dt><dt>Audit logs, <a class="indexterm" href="#chap-auditing">Using Audit Logs</a></dt><dt>Authentication, <a class="indexterm" href="#chap-auth">Managing Authentication, Authorization and Role-Based Access Control</a></dt><dd><dl><dt>Internal users, <a class="indexterm" href="#openidm-users">OpenIDM Users</a></dt><dt>Managed users, <a class="indexterm" href="#openidm-users">OpenIDM Users</a></dt><dt>Roles, <a class="indexterm" href="#openidm-roles">Roles and Authentication</a></dt></dl></dd><dt>Authorization, <a class="indexterm" href="#chap-auth">Managing Authentication, Authorization and Role-Based Access Control</a>, <a class="indexterm" href="#openidm-authorization">Authorization</a></dt></dl></div><div class="indexdiv"><h3>B</h3><dl><dt>Best practices, <a class="indexterm" href="#chap-security">Securing &amp; Hardening OpenIDM</a>, <a class="indexterm" href="#chap-best-practices">OpenIDM Project Best Practices</a></dt><dt>Business processes, <a class="indexterm" href="#chap-workflow">Integrating Business Processes and Workflows</a></dt></dl></div><div class="indexdiv"><h3>C</h3><dl><dt>cluster management, <a class="indexterm" href="#chap-cluster">Configuring OpenIDM to Work in a Cluster</a></dt><dt>Configuration</dt><dd><dl><dt>Email, <a class="indexterm" href="#chap-mail">Sending Email</a></dt><dt>Files, <a class="indexterm" href="#appendix-file-layout">File Layout</a></dt><dt>Objects, <a class="indexterm" href="#configuration-objects">OpenIDM Configuration Objects</a></dt><dt>REST API, <a class="indexterm" href="#configuring-over-rest">Configuring OpenIDM Over REST</a></dt><dt>Validating, <a class="indexterm" href="#cli-validate">validate</a></dt></dl></dd><dt>Connectors, <a class="indexterm" href="#chap-resource-conf">Connecting to External Resources</a></dt><dd><dl><dt>Generating configurations, <a class="indexterm" href="#connector-wiz">Creating Default Connector Configurations</a></dt><dt>Object types, <a class="indexterm" href="#openicf-provisioner-conf">Configuring Connectors</a></dt><dt>Remote, <a class="indexterm" href="#connector-info-provider-conf">Accessing Remote Connectors</a></dt></dl></dd><dt>Correlation queries, <a class="indexterm" href="#correlation">Correlation Queries</a></dt></dl></div><div class="indexdiv"><h3>D</h3><dl><dt>Data</dt><dd><dl><dt>accessing, <a class="indexterm" href="#chap-data">Accessing Data Objects</a></dt></dl></dd></dl></div><div class="indexdiv"><h3>E</h3><dl><dt>Encryption, <a class="indexterm" href="#security-encrypt-data">Encrypt Data Internally and Externally</a>, <a class="indexterm" href="#security-replace-defaults">Replace Default Security Settings</a></dt><dt>External REST, <a class="indexterm" href="#chap-external-rest">Accessing External REST Services</a></dt></dl></div><div class="indexdiv"><h3>F</h3><dl><dt>failover, <a class="indexterm" href="#chap-cluster">Configuring OpenIDM to Work in a Cluster</a></dt><dt>File layout, <a class="indexterm" href="#appendix-file-layout">File Layout</a></dt></dl></div><div class="indexdiv"><h3>H</h3><dl><dt>healthcheck, <a class="indexterm" href="#system-healthcheck">Verifying the Health of an OpenIDM System</a></dt><dt>high availability, <a class="indexterm" href="#chap-cluster">Configuring OpenIDM to Work in a Cluster</a></dt></dl></div><div class="indexdiv"><h3>K</h3><dl><dt>Keytool, <a class="indexterm" href="#cli-keytool">keytool</a></dt></dl></div><div class="indexdiv"><h3>L</h3><dl><dt>LiveSync, <a class="indexterm" href="#sync-types">Types of Synchronization</a></dt><dd><dl><dt>Scheduling, <a class="indexterm" href="#scheduling-synchronization">Scheduling Synchronization</a></dt></dl></dd></dl></div><div class="indexdiv"><h3>M</h3><dl><dt>Mappings, <a class="indexterm" href="#openidm-core-services">Core Services</a>, <a class="indexterm" href="#synchronization-mappings-file">Synchronization Mappings File</a></dt><dd><dl><dt>Hooks for scripting, <a class="indexterm" href="#advanced-dataflow">Advanced Data Flow Configuration</a></dt><dt>Scheduled reconciliation, <a class="indexterm" href="#alternative-mapping">Alternative Mappings</a></dt></dl></dd></dl></div><div class="indexdiv"><h3>O</h3><dl><dt>Objects</dt><dd><dl><dt>Audit objects, <a class="indexterm" href="#audit-objects">Audit Objects</a></dt><dt>Configuration objects, <a class="indexterm" href="#configuration-objects">OpenIDM Configuration Objects</a></dt><dt>Links, <a class="indexterm" href="#links">Links</a></dt><dt>Managed objects, <a class="indexterm" href="#openidm-core-services">Core Services</a>, <a class="indexterm" href="#sync-flexible-data">Flexible Data Model</a>, <a class="indexterm" href="#managed-users">Managed Users</a>, <a class="indexterm" href="#managed-objects">Managed Objects</a>, <a class="indexterm" href="#appendix-rest">REST API Reference</a></dt><dd><dl><dt>Customizing, <a class="indexterm" href="#custom-managed-objects">Custom Managed Objects</a></dt><dt>Identifiers, <a class="indexterm" href="#rest-object-identifier">Object Identifiers</a></dt><dt>Passwords, <a class="indexterm" href="#enforce-password-policy">Enforcing Password Policy</a></dt></dl></dd><dt>Object types, <a class="indexterm" href="#appendix-objects">Data Models and Objects Reference</a></dt><dt>Script access, <a class="indexterm" href="#data-scripts">Accessing Data Objects by Using Scripts</a>, <a class="indexterm" href="#function-ref">Function Reference</a></dt><dt>System objects, <a class="indexterm" href="#openidm-core-services">Core Services</a>, <a class="indexterm" href="#system-objects">System Objects</a></dt></dl></dd><dt>OpenICF, <a class="indexterm" href="#chap-resource-conf">Connecting to External Resources</a></dt></dl></div><div class="indexdiv"><h3>P</h3><dl><dt>Passwords, <a class="indexterm" href="#chap-passwords">Managing Passwords</a>, <a class="indexterm" href="#security-replace-defaults">Replace Default Security Settings</a></dt><dt>Policies, <a class="indexterm" href="#chap-policies">Using Policies to Validate Data</a></dt><dt>Ports</dt><dd><dl><dt>8080, <a class="indexterm" href="#appendix-ports-used">Ports Used</a></dt><dt>8443, <a class="indexterm" href="#appendix-ports-used">Ports Used</a></dt><dt>8444, <a class="indexterm" href="#appendix-ports-used">Ports Used</a></dt><dt>Disabling, <a class="indexterm" href="#security-jetty">Secure Jetty</a></dt></dl></dd></dl></div><div class="indexdiv"><h3>R</h3><dl><dt>Reconciliation, <a class="indexterm" href="#openidm-core-services">Core Services</a>, <a class="indexterm" href="#sync-types">Types of Synchronization</a></dt><dd><dl><dt>Scheduling, <a class="indexterm" href="#scheduling-synchronization">Scheduling Synchronization</a></dt></dl></dd><dt>Resources, <a class="indexterm" href="#chap-resource-conf">Connecting to External Resources</a></dt><dt>REST API, <a class="indexterm" href="#configuring-over-rest">Configuring OpenIDM Over REST</a>, <a class="indexterm" href="#appendix-rest">REST API Reference</a></dt><dd><dl><dt>Listing configuration objects, <a class="indexterm" href="#configuring-over-rest">Configuring OpenIDM Over REST</a></dt></dl></dd><dt>Roles, <a class="indexterm" href="#openidm-roles">Roles and Authentication</a></dt><dt>Router service, <a class="indexterm" href="#appendix-router">Router Service Reference</a></dt></dl></div><div class="indexdiv"><h3>S</h3><dl><dt>Schedule</dt><dd><dl><dt>Examples, <a class="indexterm" href="#scheduler-examples">Schedule Examples</a></dt></dl></dd><dt>Scheduler, <a class="indexterm" href="#scheduling-synchronization">Scheduling Synchronization</a>, <a class="indexterm" href="#chap-scheduler-conf">Scheduling Tasks and Events</a></dt><dd><dl><dt>Configuration, <a class="indexterm" href="#scheduler-configuration-file">Scheduler Configuration</a></dt></dl></dd><dt>Scheduling tasks, <a class="indexterm" href="#chap-scheduler-conf">Scheduling Tasks and Events</a></dt><dt>Scripting, <a class="indexterm" href="#appendix-scripting">Scripting Reference</a></dt><dd><dl><dt>Functions, <a class="indexterm" href="#function-ref">Function Reference</a></dt></dl></dd><dt>Security, <a class="indexterm" href="#chap-security">Securing &amp; Hardening OpenIDM</a></dt><dd><dl><dt>Authentication, <a class="indexterm" href="#security-messages">Use Message Level Security</a></dt><dt>Encryption, <a class="indexterm" href="#security-encrypt-data">Encrypt Data Internally and Externally</a>, <a class="indexterm" href="#security-replace-defaults">Replace Default Security Settings</a></dt><dt>SSL, <a class="indexterm" href="#security-ssl-https">Use SSL and HTTPS</a></dt></dl></dd><dt>Sending mail, <a class="indexterm" href="#chap-mail">Sending Email</a></dt><dt>Server logs, <a class="indexterm" href="#chap-logs">Configuring Server Logs</a></dt><dt>Starting OpenIDM, <a class="indexterm" href="#starting-and-stopping">To Start and Stop OpenIDM</a></dt><dt>Stopping OpenIDM, <a class="indexterm" href="#starting-and-stopping">To Start and Stop OpenIDM</a></dt><dt>Synchronization, <a class="indexterm" href="#openidm-core-services">Core Services</a>, <a class="indexterm" href="#chap-synchronization">Configuring Synchronization</a>, <a class="indexterm" href="#appendix-synchronization">Synchronization Reference</a></dt><dd><dl><dt>Actions, <a class="indexterm" href="#handling-sync">Synchronization Situations and Actions</a></dt><dt>Conditions, <a class="indexterm" href="#synchronization-mappings-file">Synchronization Mappings File</a></dt><dt>Connectors, <a class="indexterm" href="#connector-config-files">Connector Configuration Files</a></dt><dt>Correlation queries, <a class="indexterm" href="#correlation">Correlation Queries</a></dt><dt>Creating attributes, <a class="indexterm" href="#synchronization-mappings-file">Synchronization Mappings File</a>, <a class="indexterm" href="#constructing-attributes">Constructing and Manipulating Attributes</a></dt><dt>Direct (push), <a class="indexterm" href="#sync-types">Types of Synchronization</a></dt><dt>Encryption, <a class="indexterm" href="#sync-encrypted-values">Using Encrypted Values</a></dt><dt>Filtering, <a class="indexterm" href="#synchronization-mappings-file">Synchronization Mappings File</a></dt><dt>Mappings, <a class="indexterm" href="#synchronization-mappings-file">Synchronization Mappings File</a></dt><dt>Passwords, <a class="indexterm" href="#password-history">Creating a Password History Policy</a>, <a class="indexterm" href="#password-sync">Password Synchronization</a></dt><dd><dl><dt>With Active Directory, <a class="indexterm" href="#password-sync">Password Synchronization</a></dt><dt>With OpenDJ, <a class="indexterm" href="#password-sync">Password Synchronization</a></dt></dl></dd><dt>Reusing links, <a class="indexterm" href="#reusing-links">Reusing Links</a></dt><dt>Scheduling, <a class="indexterm" href="#scheduling-synchronization">Scheduling Synchronization</a></dt><dt>Situations, <a class="indexterm" href="#handling-sync">Synchronization Situations and Actions</a></dt><dt>Transforming attributes, <a class="indexterm" href="#synchronization-mappings-file">Synchronization Mappings File</a></dt></dl></dd></dl></div><div class="indexdiv"><h3>T</h3><dl><dt>Troubleshooting, <a class="indexterm" href="#chap-troubleshooting">Troubleshooting</a></dt></dl></div><div class="indexdiv"><h3>W</h3><dl><dt>Workflow, <a class="indexterm" href="#chap-workflow">Integrating Business Processes and Workflows</a></dt></dl></div></div></div></div><p>&nbsp;</p><div id="footer"><p>Something wrong on this page? <a href="https://bugster.forgerock.org/jira/secure/CreateIssueDetails!init.jspa?pid=10020&components=10164&issuetype=1">Log a documentation bug.</a></p></div>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-23412190-9']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</body></html>