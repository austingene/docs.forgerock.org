<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
   <title>Chapter&nbsp;3.&nbsp;More OpenIDM Samples</title><link rel="stylesheet" type="text/css" href="coredoc.css"><link rel="stylesheet" type="text/css" href="css/coredoc.css"><link rel="stylesheet" type="text/css" href="sh/shCore.css"><link rel="stylesheet" type="text/css" href="sh/shCoreEclipse.css"><link rel="stylesheet" type="text/css" href="sh/shThemeEclipse.css"><script src="http://code.jquery.com/jquery-1.11.0.min.js" type="text/javascript"></script><script src="uses-jquery.js" type="text/javascript"></script><script src="sh/shCore.js" type="text/javascript"></script><script src="sh/shBrushAci.js" type="text/javascript"></script><script src="sh/shBrushBash.js" type="text/javascript"></script><script src="sh/shBrushCsv.js" type="text/javascript"></script><script src="sh/shBrushHttp.js" type="text/javascript"></script><script src="sh/shBrushJava.js" type="text/javascript"></script><script src="sh/shBrushJScript.js" type="text/javascript"></script><script src="sh/shBrushLDIF.js" type="text/javascript"></script><script src="sh/shBrushPlain.js" type="text/javascript"></script><script src="sh/shBrushProperties.js" type="text/javascript"></script><script src="sh/shBrushXml.js" type="text/javascript"></script><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="OpenIDM Installation Guide"><link rel="up" href="index.html" title="OpenIDM Installation Guide"><link rel="prev" href="chap-sample.html" title="Chapter&nbsp;2.&nbsp;First OpenIDM Sample"><link rel="next" href="chap-repository.html" title="Chapter&nbsp;4.&nbsp;Installing a Repository For Production"><link rel="copyright" href="legalnotice.html" title="Legal Notice"><script type="text/javascript">SyntaxHighlighter.all();</script>
<link rel="shortcut icon" href="http://forgerock.org/favicon.ico">
</head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter&nbsp;3.&nbsp;More OpenIDM Samples</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="chap-sample.html">Prev</a>&nbsp;</td><th width="60%" align="center">&nbsp;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="chap-repository.html">Next</a></td></tr></table><hr></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-samples"></a>Chapter&nbsp;3.&nbsp;More OpenIDM Samples</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="section"><a href="chap-samples.html#before-you-begin-samples">3.1. Before You Begin</a></span></dt><dt><span class="section"><a href="chap-samples.html#more-sample1">3.2. Sample 1 - XML File</a></span></dt><dt><span class="section"><a href="chap-samples.html#more-sample2">3.3. Sample 2 - LDAP One Way</a></span></dt><dt><span class="section"><a href="chap-samples.html#more-sample2b">3.4. Sample 2b - LDAP Two Way</a></span></dt><dt><span class="section"><a href="chap-samples.html#more-sample2c">3.5. Sample 2c - Synchronizing LDAP Group Membership</a></span></dt><dt><span class="section"><a href="chap-samples.html#more-sample2d">3.6. Sample 2d - Synchronizing LDAP Groups</a></span></dt><dt><span class="section"><a href="chap-samples.html#more-sample3">3.7. Sample 3 - Scripted SQL</a></span></dt><dt><span class="section"><a href="chap-samples.html#more-sample4">3.8. Sample 4 - CSV to XML File</a></span></dt><dt><span class="section"><a href="chap-samples.html#more-sample5">3.9. Sample 5 - Synchronization of Two Resources</a></span></dt><dt><span class="section"><a href="chap-samples.html#more-sample5b">3.10. Sample 5b - Compensated Synchronization with <code class="literal">onSync</code></a></span></dt><dt><span class="section"><a href="chap-samples.html#more-sample6">3.11. Sample 6 - LiveSync With an AD Server</a></span></dt><dt><span class="section"><a href="chap-samples.html#more-sample7">3.12. Sample 7 - Scripting a SCIM-like Schema</a></span></dt><dt><span class="section"><a href="chap-samples.html#more-sample8">3.13. Sample 8 - Logging in Scripts</a></span></dt><dt><span class="section"><a href="chap-samples.html#more-sample9">3.14. Sample 9 - Asynchronous Reconciliation Using Workflows</a></span></dt></dl></div><p>The current distribution of OpenIDM comes with a variety of samples
 in <code class="filename">openidm/samples/</code>. Sample 1 is described in 
 <a href="../../install-guide/index/chap-sample.html" class="link"><em class="citetitle">First OpenIDM
 Sample</em></a>. This chapter describes the remaining OpenIDM 
 samples.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="before-you-begin-samples"></a>3.1.&nbsp;Before You Begin</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="chap-samples.html#install-samples">3.1.1. Installing the Samples</a></span></dt><dt><span class="section"><a href="chap-samples.html#preparing-openidm">3.1.2. Preparing OpenIDM</a></span></dt></dl></div><p>Install OpenIDM, as described in <a href="../../install-guide/index/chap-install.html" class="link"><em class="citetitle">Installing
  OpenIDM Services</em></a>.</p><p>OpenIDM comes with an internal noSQL database, OrientDB, for use as
  the internal repository out of the box. This makes it easy to get started
  with OpenIDM. OrientDB is not yet supported for production use, however, 
  so use a supported JDBC database when moving to production.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="install-samples"></a>3.1.1.&nbsp;Installing the Samples</h3></div></div></div><a class="indexterm" name="d0e1434"></a><p>
    Each sample directory in <code class="filename">openidm/samples/</code> contains a
    number of subdirectories, such as <code class="filename">conf/</code> and
    <code class="filename">script/</code>. To start OpenIDM with a sample configuration,
    navigate to the <code class="filename">/path/to/openidm</code> directory and use the
    <code class="literal">-p</code> option of the <span class="command"><strong>startup</strong></span> command to
    point to the sample whose configuration you want to use. Some, but not all
    samples require additional software, such as an external LDAP server or
    database.
   </p><p>
    When you move from one sample to the next, bear in mind that you are
    changing the OpenIDM configuration. For information on how configuration
    changes work, see <span class="olink"><em class="citetitle">Changing the
    Configuration</em></span> in the <em class="citetitle">Integrator's
    Guide</em>.
   </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="preparing-openidm"></a>3.1.2.&nbsp;Preparing OpenIDM</h3></div></div></div><p>Install an instance of OpenIDM specifically to try the samples. That
   way you can experiment as much as you like, and discard the result if you
   are not satisfied.</p><p>
    If you are using the same instance of OpenIDM for multiple samples, it is
    helpful to clear out the repository created for an earlier sample. To do so,
    shut down OpenIDM and delete the <code class="filename">openidm/db/openidm</code>
    directory.
   </p><div class="screen"><pre>$ rm -rf /path/to/openidm/db/openidm</pre></div><p>
    OpenIDM should now be ready to start with a new sample. For a number of
    the following samples, users are created either at the UI or with a
    commons REST call. Once added, and when reconciliation is complete, such
    users should be able to log into the UI.
   </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="more-sample1"></a>3.2.&nbsp;Sample 1 - XML File</h2></div></div></div><p>Sample 1 is described in the chapter, <a href="../../install-guide/index/chap-sample.html" class="link"><em class="citetitle">First OpenIDM
  Sample</em></a>.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="more-sample2"></a>3.3.&nbsp;Sample 2 - LDAP One Way</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="chap-samples.html#external-ldap-config-2">3.3.1. LDAP Server Configuration</a></span></dt><dt><span class="section"><a href="chap-samples.html#install-sample2">3.3.2. Install the Sample</a></span></dt><dt><span class="section"><a href="chap-samples.html#run-sample2">3.3.3. Running the Sample</a></span></dt></dl></div><a class="indexterm" name="d0e1494"></a><p>Sample 2 resembles the first sample, but in sample 2 OpenIDM is 
  connected to a local LDAP server. The sample has been tested with 
  <a class="link" href="http://www.forgerock.org/opendj.html" target="_blank">OpenDJ
  </a>, but it should work with any LDAPv3 compliant server.</p><p>Sample 2 demonstrates how OpenIDM can pick up new or changed objects
  from an external resource. The sample contains only one mapping, from the
  external LDAP server resource to the OpenIDM repository. The sample therefore
  does not push any changes made to OpenIDM managed user objects out to the
  LDAP server.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="external-ldap-config-2"></a>3.3.1.&nbsp;LDAP Server Configuration</h3></div></div></div><div class="itemizedlist"><p>Sample 2 expects the following configuration for the external LDAP
    server:</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The LDAP server runs on the local host.</p></li><li class="listitem"><p>The LDAP server listens on port 1389.</p></li><li class="listitem"><p>A user with DN <code class="literal">cn=Directory Manager</code>
    and password <code class="literal">password</code> has read access to the LDAP
    server.</p></li><li class="listitem"><p>Directory data for that server is stored under base DN
     <code class="literal">dc=example,dc=com</code>.</p></li><li class="listitem"><p>User objects for that server are stored under base DN
    <code class="literal">ou=People,dc=example,dc=com</code>.</p></li><li class="listitem"><p>User objects have the object class
    <code class="literal">inetOrgPerson</code>.</p></li><li class="listitem"><p>User objects have the following attributes:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p><code class="literal">cn</code></p></li><li class="listitem"><p><code class="literal">description</code></p></li><li class="listitem"><p><code class="literal">givenName</code></p></li><li class="listitem"><p><code class="literal">mail</code></p></li><li class="listitem"><p><code class="literal">sn</code></p></li><li class="listitem"><p><code class="literal">telephoneNumber</code></p></li><li class="listitem"><p><code class="literal">uid</code></p></li><li class="listitem"><p><code class="literal">userPassword</code></p></li></ul></div><p>An example user object follows.</p><pre class="brush: ldif;">
dn: uid=jdoe,ou=People,dc=example,dc=com
objectClass: person
objectClass: organizationalPerson
objectClass: inetOrgPerson
objectClass: top
givenName: John
uid: jdoe
cn: John Doe
telephoneNumber: 1-415-523-0772
sn: Doe
mail: jdoe@example.com
description: Created by OpenIDM
userPassword: password</pre></li></ul></div><p>Prepare the LDAP server by creating a base suffix of
   <code class="literal">dc=example,dc=com</code>, and importing these objects from
   <code class="filename">samples/sample2/data/Example.ldif</code>.</p><pre class="brush: ldif;">
dn: dc=com
objectClass: domain
objectClass: top
dc: com

dn: dc=example,dc=com
objectClass: domain
objectClass: top
dc: example

dn: ou=People,dc=example,dc=com
ou: people
description: people
objectclass: organizationalunit

dn: uid=jdoe,ou=People,dc=example,dc=com
objectClass: person
objectClass: organizationalPerson
objectClass: inetOrgPerson
objectClass: top
givenName: John
uid: jdoe
cn: John Doe
telephoneNumber: 1-415-523-0772
sn: Doe
mail: jdoe@example.com
description: Created for OpenIDM
userPassword: password
</pre><p>There is an additional user, <code class="literal">bjensen</code> in the
      sample LDIF file. This user is essentially a "dummy" user, provided for
      compliance with RFC 4519, which stipulates that every
      <code class="literal">groupOfUniqueNames</code> object must contain at least one
      <code class="literal">uniqueMember</code>.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="install-sample2"></a>3.3.2.&nbsp;Install the Sample</h3></div></div></div><p>Prepare OpenIDM as described in <a class="xref" href="chap-samples.html#preparing-openidm" title="3.1.2.&nbsp;Preparing OpenIDM">Section&nbsp;3.1.2, &#8220;Preparing OpenIDM&#8221;</a>, 
   then start OpenIDM with the configuration for sample 2.</p><div class="screen"><pre>$ cd /path/to/openidm
$ ./startup.sh -p samples/sample2</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="run-sample2"></a>3.3.3.&nbsp;Running the Sample</h3></div></div></div><p>Run reconciliation over the REST interface.</p><div class="screen"><pre>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 "https://localhost:8443/openidm/recon?_action=recon&amp;mapping=systemLdapAccounts_managedUser"</pre></div><p>Successful reconciliation returns a reconciliation run ID.</p><div class="note"><h3 class="title">Note</h3><p>
     If you want to run a <span class="command"><strong>curl</strong></span> command over regular HTTP,
     remove the <code class="literal">--cacert self-signed.crt</code> option and change
     the URL to use protocol HTTP over port 8080. For instructions on how
     to set up a <code class="filename">self-signed.crt</code>, see the Integrator's
     Guide section entitled <a href="../../integrators-guide/index/chap-security.html#rest-over-https" class="link">
     <em class="citetitle">Restrict REST Access to the HTTPS Port</em></a>.
    </p></div><p>With the configuration of sample 2, OpenIDM creates user objects from
   LDAP in OpenIDM, assigning the new objects random unique IDs. To list user
   objects by ID, run a query over the REST interface.</p><div class="screen"><pre>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/managed/user?_queryId=query-all-ids"</pre></div><p>
    If you want the output to be formatted, include the
    <code class="literal">_prettyPrint=true</code> request parameter or pipe the output to
    a JSON parser such as <span class="command"><strong>jq</strong></span>, otherwise the resulting JSON
    object appears all on one line.
   </p><pre class="brush: javascript;">
{
    "result": [
      {
        "_id": "53fbf0c5-aa37-4845-a4b3-92a21810a36d",
        "_rev": "0"
      },
      {
        "_id": "ae0aed26-2a9c-43e3-a6f0-ca707c9c6455",
        "_rev": "0"
      }
    ],
    "resultCount": 2,
    "pagedResultsCookie": null,
    "remainingPagedResults": -1,
 }</pre><p>
    You should now be able to review reconciled users in the UI. Point your
    browser to <code class="literal">https://localhost:8443/openidmui</code>, log in as
    the <code class="literal">openidm-admin</code> user (with password
    <code class="literal">openidm-admin</code>), and navigate to the Users tab. Select the
    user whose profile information you want to see.
   </p><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/sample2-bjensen.png" align="middle" height="360" alt="Example of adding a new user"></td></tr></table></div><p>Alternatively, you can retrieve individual user objects by ID, as shown
    here.</p><div class="screen"><pre>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/managed/user/53fbf0c5-aa37-4845-a4b3-92a21810a36d"</pre></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="more-sample2b"></a>3.4.&nbsp;Sample 2b - LDAP Two Way</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="chap-samples.html#external-ldap-config-2b">3.4.1. External LDAP Configuration</a></span></dt><dt><span class="section"><a href="chap-samples.html#install-sample2b">3.4.2. Install the Sample</a></span></dt><dt><span class="section"><a href="chap-samples.html#run-sample2b">3.4.3. Running the Sample</a></span></dt></dl></div><a class="indexterm" name="d0e1678"></a><p>Like sample 2, sample 2b also connects to an external LDAP
  server.</p><p>Unlike sample 2, however, sample 2b has two mappings configured, one
  from the LDAP server to the OpenIDM repository, and the other from the
  OpenIDM repository to the LDAP server.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="external-ldap-config-2b"></a>3.4.1.&nbsp;External LDAP Configuration</h3></div></div></div><p>Configure the LDAP server as for sample 2,
   <a class="xref" href="chap-samples.html#external-ldap-config-2" title="3.3.1.&nbsp;LDAP Server Configuration">Section&nbsp;3.3.1, &#8220;LDAP Server Configuration&#8221;</a>. The LDAP user must have write
   access to create users from OpenIDM on the LDAP server.</p><p>
    When configuring the LDAP server, be sure to import the appropriate
    LDIF file, in this case,
    <code class="filename">/path/to/openidm/samples/sample2b/data/Example.ldif</code>
   </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="install-sample2b"></a>3.4.2.&nbsp;Install the Sample</h3></div></div></div><p>Prepare OpenIDM as described in <a class="xref" href="chap-samples.html#preparing-openidm" title="3.1.2.&nbsp;Preparing OpenIDM">Section&nbsp;3.1.2, &#8220;Preparing OpenIDM&#8221;</a>, 
   then start OpenIDM with the configuration for sample 2b.</p><div class="screen"><pre>$ cd /path/to/openidm
$ ./startup.sh -p samples/sample2b</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="run-sample2b"></a>3.4.3.&nbsp;Running the Sample</h3></div></div></div><p>Run reconciliation over the REST interface.</p><div class="screen"><pre>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 "https://localhost:8443/openidm/recon?_action=recon&amp;mapping=systemLdapAccounts_managedUser"</pre></div><p>Successful reconciliation returns a reconciliation run ID.</p><p>With the configuration of sample 2b, OpenIDM creates user objects from
   LDAP in OpenIDM, assigning the new objects random unique IDs. To list user
   objects by ID, run a query over the REST interface.</p><div class="screen"><pre>
$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/managed/user?_queryId=query-all-ids"
   </pre></div><p>The resulting JSON object should include content similar to the
    following.</p><pre class="brush: javascript;">
{
  "result": [
    {
      "_id": "53fbf0c5-aa37-4845-a4b3-92a21810a36d"
      "_rev": "0",
    },
    {
      "_id": "6490489f-bbff-4855-808a-5c1862b09339"
      "_rev": "0",
    }
    "resultCount": 2,
    "pagedResultsCookie": null,
    "remainingPagedResults": -1,
],
 }</pre><p>To retrieve the user, log into the UI, on an URI such as
    <code class="literal">https://localhost:8443/openidmui</code> as the administrative
    user
   </p><p>
    Alternatively, you can make a commons REST call to get a specific user
    object by ID.</p><div class="screen"><pre>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/managed/user/53fbf0c5-aa37-4845-a4b3-92a21810a36d"</pre></div><p>Test the second mapping by creating a user in the OpenIDM
   repository. On UNIX:</p><div class="screen"><pre>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 --data '{
    "mail":"fdoe@example.com",
    "sn":"Doe",
    "telephoneNumber":"555-1234",
    "userName":"fdoe",
    "givenName":"Felicitas",
    "description":"Felicitas Doe",
    "displayName":"fdoe"}' \
 "https://localhost:8443/openidm/managed/user?_action=create"</pre></div><p>On Windows:</p><div class="screen"><pre>$ curl ^
 --cacert self-signed.crt ^
 --header "X-OpenIDM-Username: openidm-admin" ^
 --header "X-OpenIDM-Password: openidm-admin" ^
 --header "Content-Type: application/json" ^
 --request POST ^
 --data "{
  \"mail\":\"fdoe@example.com\",
  \"sn\":\"Doe\",
  \"telephoneNumber"\:\"555-1234\",
  \"userName\":\"fdoe\",
  \"givenName\":\"Felicitas\",
  \"description\":\"Felicitas Doe\",
  \"displayName\":\"fdoe\"}" ^
 "https://localhost:8443/openidm/managed/user?_action=create"</pre></div><p>
    By default, automatic synchronization is enabled. This means that when you
    update a managed object, any mappings defined in the
    <code class="filename">sync.json</code> file that have the managed object as the
    source are automatically executed to update the target system. For more
    information, see <a href="../../integrators-guide/index/chap-synchronization.html#synchronization-mappings-file" class="link"><em class="citetitle">Synchronization
    Mappings File</em></a> in the <em class="citetitle">Integrator's
    Guide</em>.
   </p><p>Test that the automatic reconciliation has been successful by
   locating the new user in the LDAP directory.</p><div class="screen"><pre>$ <strong>/path/to/OpenDJ/bin/ldapsearch \
 -bindDN "cn=Directory Manager" \
 -bindPassword password \
 -hostname localhost \
 -port 1389 \
 -baseDN "dc=example,dc=com" \
 "uid=fdoe" </strong>
<em>dn: uid=fdoe,ou=People,dc=example,dc=com
mail: fdoe@example.com
givenName: Felicitas
objectClass: person
objectClass: organizationalPerson
objectClass: inetOrgPerson
objectClass: top
uid: fdoe
cn: Felicitas Doe
sn: Doe</em>
   </pre></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="more-sample2c"></a>3.5.&nbsp;Sample 2c - Synchronizing LDAP Group Membership</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="chap-samples.html#external-ldap-config-2c">3.5.1. External LDAP Configuration</a></span></dt><dt><span class="section"><a href="chap-samples.html#install-sample2c">3.5.2. Install the Sample</a></span></dt><dt><span class="section"><a href="chap-samples.html#run-sample2c">3.5.3. Running the Sample</a></span></dt></dl></div><a class="indexterm" name="d0e1767"></a><p>Like sample 2b, sample 2c also connects to an external LDAP
  server. The only difference is that in sample 2c, LDAP Group Memberships 
  are synchronized.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="external-ldap-config-2c"></a>3.5.1.&nbsp;External LDAP Configuration</h3></div></div></div><p>Configure the LDAP server as for sample 2,
   <a class="xref" href="chap-samples.html#external-ldap-config-2" title="3.3.1.&nbsp;LDAP Server Configuration">Section&nbsp;3.3.1, &#8220;LDAP Server Configuration&#8221;</a>. The LDAP user must have write
   access to create users from OpenIDM on the LDAP server.</p><p>In addition, two LDAP Groups should be created, which can be found in 
   the LDIF file: <code class="filename">openidm/samples/sample2c/data/Example.ldif</code>:</p><pre class="brush: ldif;">
dn: ou=Groups,dc=example,dc=com
ou: Groups
objectClass: organizationalUnit
objectClass: top

dn: cn=openidm,ou=Groups,dc=example,dc=com
uniqueMember: uid=jdoe,ou=People,dc=example,dc=com
cn: openidm
objectClass: groupOfUniqueNames
objectClass: top

dn: cn=openidm2,ou=Groups,dc=example,dc=com
uniqueMember: uid=bjensen,ou=People,dc=example,dc=com
cn: openidm2
objectClass: groupOfUniqueNames
objectClass: top</pre><p>The users with DNs <code class="literal">uid=jdoe,ou=People,dc=example,dc=com</code>
   and <code class="literal">uid=bjensen,ou=People,dc=example,dc=com</code> are also
   imported with the <code class="filename">Example.ldif</code> file. (The user
   <code class="literal">bjensen</code> is essentially a "dummy" user, provided for
   compliance with RFC 4519, which stipulates that every
   <code class="literal">groupOfUniqueNames</code> object must contain at least one
   <code class="literal">uniqueMember</code>. User <code class="literal">bjensen</code> is not
   actually used in this sample.)</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="install-sample2c"></a>3.5.2.&nbsp;Install the Sample</h3></div></div></div><p>Prepare OpenIDM as described in <a class="xref" href="chap-samples.html#preparing-openidm" title="3.1.2.&nbsp;Preparing OpenIDM">Section&nbsp;3.1.2, &#8220;Preparing OpenIDM&#8221;</a>, 
   then start OpenIDM with the configuration for sample 2c.</p><div class="screen"><pre>$ cd /path/to/openidm
$ ./startup.sh -p samples/sample2c</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="run-sample2c"></a>3.5.3.&nbsp;Running the Sample</h3></div></div></div><p>Run reconciliation over the REST interface.</p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
  "https://localhost:8443/openidm/recon?_action=recon&amp;mapping=systemLdapAccounts_managedUser"</strong></pre></div><p>Successful reconciliation returns a reconciliation run ID.</p><p>With the configuration of sample 2c, OpenIDM creates user objects from
   LDAP in OpenIDM, assigning the new objects random unique IDs. To list user
   objects by ID, run a query over the REST interface.</p><div class="screen"><pre>
$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/managed/user?_queryId=query-all-ids"
   </pre></div><p>The resulting JSON object should appear similar to the following:</p><pre class="brush: javascript;">
{
  "result": [
    {
      "_id": "53fbf0c5-aa37-4845-a4b3-92a21810a36d"
      "_rev": "0",
    }
    {
      "_id": "56f0fb7e-3837-464d-b9ec-9d3b6af665c3",
      "_rev": "0"
    }
    ]
    "resultCount": 2,
    "pagedResultsCookie": null,
    "remainingPagedResults": -1,
 }</pre><p>
    You should now be able to retrieve John Doe's user object in the UI,
    navigating to the domain for OpenIDM such as
    <code class="literal">https://localhost:8443/openidmui</code>. Alternatively, you can
    retrieve John Doe's user object at the command line by his ID.
   </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/managed/user/53fbf0c5-aa37-4845-a4b3-92a21810a36d"</strong></pre></div><p>The user object should contain a property like: </p><div class="screen"><pre>"ldapGroups":["cn=openidm,ou=Groups,dc=example,dc=com"]</pre></div><p>Now change the user on the OpenIDM side with the following REST
   call (on UNIX):</p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 --data '[
    {
      "operation":"replace",
      "field":"/ldapGroups",
      "value": ["cn=openidm2,ou=Groups,dc=example,dc=com"]
    }
 ]' \
 "https://localhost:8443/openidm/managed/user?_action=patch&amp;_queryId=for-userName&amp;uid=jdoe"</strong></pre></div><p>
    On Windows, you might need to escape certain characters, so your REST call
    would look like this:
   </p><div class="screen"><pre><strong>$ curl ^
 --cacert self-signed.crt ^
 --header "X-OpenIDM-Username: openidm-admin" ^
 --header "X-OpenIDM-Password: openidm-admin" ^
 --header "Content-Type: application/json" ^
 --request POST ^
 --data "[
    {
    \"operation\":\"replace\",
    \"field\":\"\/ldapGroups\",
    \"value\": [\"cn=openidm2,ou=Groups,dc=example,dc=com\"]
    }
 ]" ^
 "https://localhost:8443/openidm/managed/user?_action=patch&amp;_queryId=for-userName&amp;uid=jdoe"</strong></pre></div><p>This will change the user's <code class="literal">ldapGroups</code> property 
   in OpenIDM from <code class="filename">"cn=openidm,ou=Groups,dc=example,dc=com"</code> 
   to <code class="filename">"cn=openidm2,ou=Groups,dc=example,dc=com"</code> and, as a 
   result, the user will be removed from the one LDAP group and added to 
   the other LDAP group on OpenDJ.</p><p>Retrieve John Doe's user object again and notice the changed
   <code class="literal">"ldapGroups"</code> property.</p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/managed/user/56f0fb7e-3837-464d-b9ec-9d3b6af665c3"</strong></pre></div><p>
    By default, automatic synchronization is enabled. This means that when you
    update a managed object, any mappings defined in the
    <code class="filename">sync.json</code> file that have the managed object as the
    source are automatically executed to update the target system. For more
    information, see <a href="../../integrators-guide/index/chap-synchronization.html#synchronization-mappings-file" class="link"> <em class="citetitle">Synchronization
    Mappings File</em></a> in the <em class="citetitle">Integrator's
    Guide</em>.
   </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="more-sample2d"></a>3.6.&nbsp;Sample 2d - Synchronizing LDAP Groups</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="chap-samples.html#external-ldap-config-2d">3.6.1. External LDAP Configuration</a></span></dt><dt><span class="section"><a href="chap-samples.html#install-sample2d">3.6.2. Install the Sample</a></span></dt><dt><span class="section"><a href="chap-samples.html#run-sample2d">3.6.3. Running the Sample</a></span></dt></dl></div><a class="indexterm" name="d0e1896"></a><p>Sample 2d also connects to an external LDAP server. This sample 
  focuses on LDAP Group synchronization.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="external-ldap-config-2d"></a>3.6.1.&nbsp;External LDAP Configuration</h3></div></div></div><p>Configure the LDAP server as for sample 2,
   <a class="xref" href="chap-samples.html#external-ldap-config-2" title="3.3.1.&nbsp;LDAP Server Configuration">Section&nbsp;3.3.1, &#8220;LDAP Server Configuration&#8221;</a>. The LDAP user must have write
   access to create users from OpenIDM on the LDAP server.</p><p>In addition, two LDAP Groups should be created, which can be found in 
   the LDIF file: <code class="filename">openidm/samples/sample2d/data/Example.ldif</code> 
   (if they have not already been added through sample 2c):</p><pre class="brush: ldif;">
dn: ou=Groups,dc=example,dc=com
ou: Groups
objectClass: organizationalUnit
objectClass: top

dn: cn=openidm,ou=Groups,dc=example,dc=com
uniqueMember: uid=jdoe,ou=People,dc=example,dc=com
cn: openidm
objectClass: groupOfUniqueNames
objectClass: top

dn: cn=openidm2,ou=Groups,dc=example,dc=com
uniqueMember: uid=bjensen,ou=People,dc=example,dc=com
uniqueMember: uid=jdoe,ou=People,dc=example,dc=com
cn: openidm2
objectClass: groupOfUniqueNames
objectClass: top
</pre><p>The user with dn <code class="literal">uid=jdoe,ou=People,dc=example,dc=com</code> 
   is also imported with the <code class="filename">Example.ldif</code> file.</p><p>There is an additional user, <code class="literal">bjensen</code> in the
   sample LDIF file. This user is essentially a "dummy" user, provided for
   compliance with RFC 4519, which stipulates that every
   <code class="literal">groupOfUniqueNames</code> object must contain at least one
   <code class="literal">uniqueMember</code>. <code class="literal">bjensen</code> is not actually
   used in this sample.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="install-sample2d"></a>3.6.2.&nbsp;Install the Sample</h3></div></div></div><p>Prepare OpenIDM as described in <a class="xref" href="chap-samples.html#preparing-openidm" title="3.1.2.&nbsp;Preparing OpenIDM">Section&nbsp;3.1.2, &#8220;Preparing OpenIDM&#8221;</a>, 
   then start OpenIDM with the configuration for sample 2d.</p><div class="screen"><pre>$ cd /path/to/openidm
$ ./startup.sh -p samples/sample2d</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="run-sample2d"></a>3.6.3.&nbsp;Running the Sample</h3></div></div></div><p>Run reconciliation <span class="emphasis"><em>for the groups mapping</em></span> over 
   the REST interface.</p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 "https://localhost:8443/openidm/recon?_action=recon&amp;mapping=systemLdapGroups_managedGroup"</strong></pre></div><p>Successful reconciliation returns a reconciliation run ID.</p><p>With the configuration of sample 2d, OpenIDM creates group objects from
   LDAP in OpenIDM. To list group objects by ID, run a query over the REST interface.</p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET
 "https://localhost:8443/openidm/managed/group?_queryId=query-all-ids"</strong></pre></div><p>The resulting JSON object should include content similar to the
    following.</p><pre class="brush: javascript;">
{
   "result":[
      {
         "_id":"3c704429-aacd-4995-816a-fac33451c642"
         "_rev": "0",
      },
      {
         "_id":"b0982152-5099-4358-bdd1-45a39ebe0d77"
         "_rev": "0",
      }
   ]
    "resultCount": 2,
    "pagedResultsCookie": null,
    "remainingPagedResults": -1,
}</pre><p>To retrieve a group, get the object by ID.</p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/managed/group/b0982152-5099-4358-bdd1-45a39ebe0d77"</strong></pre></div><p>Your group's object should be similar to the following:</p><pre class="brush: javascript;">
{
    "name": [
      "openidm"
    ],
    "uniqueMember": [
      "uid=jdoe,ou=People,dc=example,dc=com"
    ],
    "description": [],
    "dn": "cn=openidm,ou=Groups,dc=example,dc=com",
    "_rev": "0",
    "_id": "b0982152-5099-4358-bdd1-45a39ebe0d77"
}
   </pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="more-sample3"></a>3.7.&nbsp;Sample 3 - Scripted SQL</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="chap-samples.html#external-mysql-config-sample3">3.7.1. External Configuration</a></span></dt><dt><span class="section"><a href="chap-samples.html#install-sample3">3.7.2. Install the Sample</a></span></dt><dt><span class="section"><a href="chap-samples.html#run-sample3">3.7.3. Run the Sample</a></span></dt></dl></div><a class="indexterm" name="d0e1982"></a><p>
   Sample 3 shows an example configuration for the Scripted SQL connector. The
   Scripted SQL connector allows OpenIDM to communicate with the database
   through configurable SQL scripts. Each operation, like create or delete, is
   represented by its own script.
  </p><p>
   In this sample, you will see how OpenIDM uses a scripted connection to a
   MySQL server. Do configure MySQL first, before starting OpenIDM.
  </p><p>
   After reconciliation with the existing MySQL database, you will be able to
   review users in the internal repository of OpenIDM.
  </p><p>
   Sample 3 uses the following file in the <code class="filename">conf/</code> directory
   for the Scripted SQL connector:
   <code class="filename">conf/provisioner.openicf-scriptedsql.json</code>. It cites
   customizable Groovy scripts in the
   <code class="filename">/path/to/openidm/samples/sample3/tools</code> directory.
  </p><p>
   Prepare a fresh installation of OpenIDM before trying this sample.
  </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="external-mysql-config-sample3"></a>3.7.1.&nbsp;External Configuration</h3></div></div></div><p>
    In this example OpenIDM communicates with an external MySQL database server.
   </p><p>
    Make sure MySQL is running.
   </p><div class="note"><h3 class="title">Note</h3><p>
     If you want to test this sample on an existing MySQL database, examine the
     <code class="literal">configurationProperties</code> section of the
     <code class="filename">provisioner.openicf-scriptedsql.json</code> file. Change
     parameters such as <code class="literal">host</code>, <code class="literal">database</code>,
     <code class="literal">password</code>, and <code class="literal">jdbcConnectionUrl</code> to
     match your configuration.
    </p><p>
     The remainder of the Sample 3 documentation is based on the database
     schema that exists in the <code class="filename">openidm/samples/sample3/data</code>
     directory.
    </p></div><div class="itemizedlist"><p>The sample expects the following configuration for MySQL:</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The database is available on the local host.</p></li><li class="listitem"><p>The database listens on port 3306.</p></li><li class="listitem"><p>You can connect over the network to the database with user
     <code class="literal">root</code> and password <code class="literal">password</code>.</p></li><li class="listitem"><p>MySQL serves a database called <code class="literal">HRDB</code> with a table
      called <code class="literal">Users</code>.</p></li><li class="listitem"><p>
      The database schema is as described in the data definition language file,
      <code class="filename">openidm/samples/sample3/data/sample_HR_DB.mysql</code>.
      Import the file into MySQL before running the sample.
     </p><div class="screen"><pre>$ <strong>mysql -u root -p &lt; /path/to/openidm/samples/sample3/data/sample_HR_DB.mysql
</strong>
Enter password:
$ </pre></div></li></ul></div><p>
    Once imported, you can review the contents of the sample in MySQL. The
    following command accesses the MySQL prompt:
   </p><div class="screen"><pre>$ mysql -u root -p</pre></div><p>
    From the <code class="literal">mysql &gt;</code> prompt, use the following commands
    to review the users configured in the <code class="filename">sample_HR_DB.mysql</code>
    file:
   </p><div class="screen"><pre>mysql &gt; <strong>use HRDB;</strong>
    <em>
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed</em>
mysql &gt; <strong>select * from Users;</strong>
    <em>
     +----+--------+--------------+-----------+----------+---------------+------...
     | id | uid    | password     | firstname | lastname | fullname      | email...
     +----+--------+------------------------------------------+-----------+-----...
     |  1 | bob    | e38ad2149... | Bob       | Fleming  | Bob Fleming   | Bob. ...
     |  2 | rowley | 2aa60a8ff... | Rowley    | Birkin   | Rowley Birkin | Rowl ...
     |  3 | louis  | 1119cfd37... | Louis     | Balfour  | Louis Balfour | Loui ...
     |  4 | john   | a1d7584da... | John      | Smith    | John Smith    | John ...
     |  5 | jdoe   | edba955d0... | John      | Doe      | John Doe      | John ...
     +----+--------+------------------------------------------+-----------+---- ...
     5 rows in set (0.01 sec)
    </em>
    </pre></div><p>
     You can exit from the MySQL prompt with the <span class="command"><strong>quit</strong></span>
     command.
    </p><div class="note"><h3 class="title">Note</h3><p>
     The passwords in the output shown above are hashed to the SHA-1 standard,
     as they cannot be read into OpenIDM as cleartext.
    </p><p>
     The SHA-1 Hash function is used for compatibility reasons. When configuring
     a database for production, more secure algorithms should be used.
    </p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="install-sample3"></a>3.7.2.&nbsp;Install the Sample</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Prepare OpenIDM as described in <a class="xref" href="chap-samples.html#preparing-openidm" title="3.1.2.&nbsp;Preparing OpenIDM">Section&nbsp;3.1.2, &#8220;Preparing OpenIDM&#8221;</a>.</p></li><li class="listitem"><p>Set up the MySQL driver for OpenIDM. Download MySQL Connector/J,
      version 5.1 or later. Unpack the download and copy the .jar into the
      <code class="filename">openidm/bundle</code> directory.</p><div class="screen"><pre>$ cp mysql-connector-java-<em><strong>version</strong></em>-bin.jar /path/to/openidm/bundle/</pre></div></li><li class="listitem"><p>Once the MySQL driver is in place, start OpenIDM with the
      configuration for sample 3.</p><div class="screen"><pre>$ cd /path/to/openidm
$ ./startup.sh -p samples/sample3</pre></div></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="run-sample3"></a>3.7.3.&nbsp;Run the Sample</h3></div></div></div><p>
    The sample 3 <code class="filename">sync.json</code> configuration file contains a
    mapping to reconcile OpenIDM and the external database. Run the
    reconciliation with the following command.
   </p><div class="screen"><pre>$ curl \
--cacert self-signed.crt \
--header "X-OpenIDM-Username: openidm-admin" \
--header "X-OpenIDM-Password: openidm-admin" \
--header "Content-Type: application/json" \
--request POST \
"https://localhost:8443/openidm/recon?_action=recon&amp;mapping=systemHrdb_managedUser"</pre></div><p>
    Reconciliation creates the five users from the database in the OpenIDM
    repository. Check the result with the following command.
   </p><div class="screen"><pre>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/managed/user?_queryId=query-all-ids"</pre></div><p>
    The output includes the identifier <code class="literal">_id</code> for each user.
   </p><pre class="brush: javascript;">
{
    "result": [ {
        "_id": "8366a23d-f6cf-46df-9746-469bf45aafcd",
        "_rev": "0"
    },
    {
        "_id": "3f90933b-9397-4897-84d0-03ed8d99f61e",
        "_rev": "0"
    },
    {
        "_id": "8fbf759d-bebc-42ed-b321-b69487b4470f",
        "_rev": "0"
    },
    {
        "_id": "9592de42-a8ef-4db3-9c6c-7d191e39b084",
        "_rev": "0"
    },
    {
        "_id": "d933441b-684b-446c-a89e-01eca6d21ef3",
        "_rev": "0"
    },
    {
        "_id": "fd962b71-752a-444b-8492-35bff57bec69",
        "_rev": "0"
    } ],
    "resultCount": 6,
    "pagedResultsCookie": null,
    "remainingPagedResults": -1
}</pre><p>
    You can get more information about users with any of the following three
    methods:
   </p><p>
    You can review the users from the UI, navigating to the domain where OpenIDM
    is installed, with a URL similar to
    <code class="literal">https://localhost:8443/openidmui</code>
   </p><p>Alternatively, to view all fields for a single user, based on its
    <code class="literal">_id</code>, run the following command:</p><div class="screen"><pre>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/managed/user/8366a23d-f6cf-46df-9746-469bf45aafcd"</pre></div><p>
    You can query specific fields with a REST call. For example, the following
    command displays the unique ID and the <code class="literal">givenName</code> of all
    managed users:
   </p><div class="screen"><pre>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/managed/user?_queryId=query-all&amp;fields=_openidm_id,givenName"
</pre></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="more-sample4"></a>3.8.&nbsp;Sample 4 - CSV to XML File</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="chap-samples.html#install-sample4">3.8.1. Install the Sample</a></span></dt><dt><span class="section"><a href="chap-samples.html#examine-sample4">3.8.2. Check and then Run the Sample</a></span></dt></dl></div><a class="indexterm" name="d0e2183"></a><p>Sample 4 works with two databases, a comma-separated value file
   and an XML file. There is no need to include any external
   resources.
  </p><p>
   A correlation query is used to relate the records in these
   two files.
  </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="install-sample4"></a>3.8.1.&nbsp;Install the Sample</h3></div></div></div><p>No external configuration is required for this sample. Prepare 
   OpenIDM as described in <a class="xref" href="chap-samples.html#preparing-openidm" title="3.1.2.&nbsp;Preparing OpenIDM">Section&nbsp;3.1.2, &#8220;Preparing OpenIDM&#8221;</a>, then start up 
   OpenIDM with the configuration of sample 4.</p><div class="screen"><pre>$ cd /path/to/openidm
$ ./startup.sh -p samples/sample4</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="examine-sample4"></a>3.8.2.&nbsp;Check and then Run the Sample</h3></div></div></div><p>
    The <code class="filename">sample4/data/hr.csv</code> file contains two example
    users. The first line of the file sets the attribute names.
   </p><p>
    Review the current contents of the database in the
    <code class="filename">sample4/data/xmlConnectorData.xml</code> file. For comparison
    purposes, make a copy of the file in a temporary directory with a command
    like:
   </p><div class="screen"><pre>$ cp /path/to/openidm/samples/sample4/data/xmlConnectorData.xml /tmp/</pre></div><p>
    The reconciliation command run here uses the information
    from the <code class="filename">hr.csv</code> file to update the database in the
    <code class="filename">sample4/data/xmlConnectorData.xml</code> file.
   </p><div class="screen"><pre>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 "https://localhost:8443/openidm/recon?_action=recon&amp;mapping=csv_xmlfile"</pre></div><p>Check the results of reconciliation. Review the updated contents
    of the <code class="filename">sample4/data/xmlConnectorData.xml</code> file.</p><p>
    If you want to experiment further, try changing the data in the
    <code class="filename">hr.csv</code> file. Run the noted reconciliation command
    again.
   </p><p>
    These users will not be visible from the OpenIDM UI, since they are mapped
    directly between the XML and CSV files. The internal OpenIDM repository is
    not updated in this sample.
   </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="more-sample5"></a>3.9.&nbsp;Sample 5 - Synchronization of Two Resources</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="chap-samples.html#email-sample5">3.9.1. Configure Email for the Sample</a></span></dt><dt><span class="section"><a href="chap-samples.html#install-sample5">3.9.2. Install the Sample</a></span></dt><dt><span class="section"><a href="chap-samples.html#run-sample5">3.9.3. Run the Sample</a></span></dt></dl></div><a class="indexterm" name="d0e2241"></a><p>
   Sample 5 demonstrates the flow of data from one external resource to
   another. The resources are named <code class="literal">LDAP</code> and
   <code class="literal">AD</code> but in the sample, both directory-like resources are
   simulated with XML files.
  </p><p>
   You can optionally configure an outbound email service, if you want to
   receive emailed reconciliation summaries, as described in the following
   section.
  </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="email-sample5"></a>3.9.1.&nbsp;Configure Email for the Sample</h3></div></div></div><p>
    If you do not configure the email service, the functionality of the sample
    does not change. However, you might see the following message at the
    OpenIDM console when you run a reconciliation operation:
   </p><div class="screen"><pre>Email service not configured; report not generated.</pre></div><div class="procedure"><p>
     To configure an email summary, follow these steps:
    </p><ol class="procedure" type="1"><li class="step"><p>
      Copy the template <code class="filename">external.email.json</code> file from
      the <code class="filename">/path/to/openidm/samples/misc</code> directory:
     </p><div class="screen"><pre>$ cd /path/to/openidm
$ cp samples/misc/external.email.json samples/sample5/conf
     </pre></div></li><li class="step"><p>
      Edit the <code class="filename">external.email.json</code> file for outbound email,
      as described in the chapter on
      <span class="olink"><em class="citetitle">Sending
      Email</em></span>.
     </p></li><li class="step"><p>
      Edit the <code class="filename">reconStats.js</code> file from the
      <code class="filename">/path/to/openidm/samples/sample5/script</code> directory.
      Near the start of the file, configure the OpenIDM email service to send
      statistics to the email addresses of your choice:
     </p><pre class="brush: javascript;">
var params = {
      //UPDATE THESE VALUES
      from : "openidm@example.com",
      to : "youremail@example.com",
      cc : "idmadmin2@example.com,idmadmin3@example.com",
      subject : "Recon stats for " + global.reconName,
      type : "text/html"
},
template,
     </pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="install-sample5"></a>3.9.2.&nbsp;Install the Sample</h3></div></div></div><p>
    No external configuration is required for this sample. Prepare OpenIDM as
    described in <a class="xref" href="chap-samples.html#preparing-openidm" title="3.1.2.&nbsp;Preparing OpenIDM">Section&nbsp;3.1.2, &#8220;Preparing OpenIDM&#8221;</a>, then start OpenIDM with
    the configuration of sample 5.
   </p><div class="screen"><pre>$ cd /path/to/openidm
$ ./startup.sh -p samples/sample5</pre></div><p>
    The XML files that simulate the resources are located in the
    <code class="filename">openidm/samples/sample5/data/</code> folder. When you start
    OpenIDM with the sample 5 configuration, OpenIDM creates the
    <code class="filename">xml_AD_Data.xml</code> file, which does not contain users
    until you run reconciliation.
   </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="run-sample5"></a>3.9.3.&nbsp;Run the Sample</h3></div></div></div><p>
    Run a reconciliation operation, to synchronize the contents of the simulated
    LDAP resource to the OpenIDM repository.
   </p><div class="screen"><pre>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 "https://localhost:8443/openidm/recon?_action=recon&amp;mapping=systemLdapAccounts_managedUser"</pre></div><p>
    This command creates a user in the repository. It is not necessary to run a
    second reconciliation operation to synchronize the AD resource. Automatic
    synchronization propagates any change made to managed users in the OpenIDM
    repository to the simulated AD resource.
   </p><p>
    Review the contents of <code class="filename">xml_AD_Data.xml</code>. It should now
    contain information for the same user that was present in the startup
    version of the <code class="filename">xml_LDAP_Data.xml</code> file.
   </p><p>
    Alternatively, you can list users in the AD resource with the following
    command:
   </p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/system/ad/account?_queryId=query-all-ids"
   </strong>
   <em>{
  "result" : [ {
    "name" : "DDOE1",
    "__UID__" : "8dad9df3-820d-41ea-a3ab-a80c241bbc98",
    "_id" : "8dad9df3-820d-41ea-a3ab-a80c241bbc98"
  } ],
    "resultCount" : 1,
    "pagedResultsCookie" : null,
    "remainingPagedResults" : -1
}</em>
   </pre></div><p>
    You can use the <code class="literal">_id</code> of the user to read the user
    information from the AD resource, for example:
   </p><div class="screen"><pre>$ <strong>curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/system/ad/account/8dad9df3-820d-41ea-a3ab-a80c241bbc98"
   </strong>
   <em>{
  "email" : [ "mail1@example.com" ],
  "name" : "DDOE1",
  "__UID__" : "8dad9df3-820d-41ea-a3ab-a80c241bbc98",
  "firstname" : "Darth",
  "lastname" : "Doe",
  "_id" : "8dad9df3-820d-41ea-a3ab-a80c241bbc98"
}[</em></pre></div><p>
    To verify that the sample is working, repeat the process. Set up a second
    user in the <code class="filename">xml_LDAP_Data.xml</code> file. An example of how
    that file might appear with a second user (<code class="literal">GDOE1</code>) is
    shown here:
   </p><pre class="brush: xml;">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;icf:OpenICFContainer
    xmlns:icf="http://openidm.forgerock.com/xml/ns/public/resource/openicf/resource-schema-1.xsd"
    xmlns:ri="http://openidm.forgerock.com/xml/ns/public/resource/instances/resource-schema-extension"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://openidm.forgerock.com/xml/ns/public/resource/instances/resource-schema-extension
    samples/sample5/data/resource-schema-extension.xsd
    http://openidm.forgerock.com/xml/ns/public/resource/openicf/resource-schema-1.xsd
    data/resource-schema-1.xsd"&gt;
    &lt;ri:__ACCOUNT__&gt;
       &lt;icf:__UID__&gt;1&lt;/icf:__UID__&gt;
       &lt;icf:__PASSWORD__&gt;TestPassw0rd2&lt;/icf:__PASSWORD__&gt;
       &lt;ri:firstname&gt;Darth&lt;/ri:firstname&gt;
       &lt;icf:__DESCRIPTION__&gt;Created By XML1&lt;/icf:__DESCRIPTION__&gt;
       &lt;icf:__NAME__&gt;DDOE1&lt;/icf:__NAME__&gt;
       &lt;ri:email&gt;mail1@example.com&lt;/ri:email&gt;
       &lt;ri:lastname&gt;Doe&lt;/ri:lastname&gt;
    &lt;/ri:__ACCOUNT__&gt;
    &lt;ri:__ACCOUNT__&gt;
       &lt;icf:__UID__&gt;2&lt;/icf:__UID__&gt;
       &lt;icf:__PASSWORD__&gt;TestPassw0rd2&lt;/icf:__PASSWORD__&gt;
       &lt;ri:firstname&gt;Garth&lt;/ri:firstname&gt;
       &lt;icf:__DESCRIPTION__&gt;Created By XML1&lt;/icf:__DESCRIPTION__&gt;
       &lt;icf:__NAME__&gt;GDOE1&lt;/icf:__NAME__&gt;
       &lt;ri:email&gt;mail2@example.com&lt;/ri:email&gt;
       &lt;ri:lastname&gt;Doe&lt;/ri:lastname&gt;
    &lt;/ri:__ACCOUNT__&gt;
&lt;/icf:OpenICFContainer&gt;</pre><p>
    Rerun the reconciliation and query REST commands shown previously. The
    reconciliation operation creates the new user from the simulated LDAP
    resource in the OpenIDM repository. Automatic synchronization then creates
    that user in the AD resource.
   </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="more-sample5b"></a>3.10.&nbsp;Sample 5b - Compensated Synchronization with <code class="literal">onSync</code></h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="chap-samples.html#install-sample5b">3.10.1. Install the Sample</a></span></dt><dt><span class="section"><a href="chap-samples.html#onsync-sample5b">3.10.2. Demonstrate onSync</a></span></dt></dl></div><a class="indexterm" name="d0e2371"></a><p>
   The compensated synchronization mechanism depicted in this sample can help
   manage the risks associated with synchronizing data across multiple
   resources.
  </p><p>
   Typically, when a managed/user object is changed, automatic synchronization
   replays that change to all configured external resources. If synchronization
   fails for one target resource (for example, due to a policy validation
   failure on the target, or the target being unavailable), the synchronization
   operation stops at that point. The effect is that a record might be changed
   in the repository, and in the targets on which synchronization was successful,
   but not on the failed target, or any targets that would have been
   synchronized after the failure. This situation can result in disparate data
   sets across resources. While a reconciliation operation would eventually
   bring all targets back in sync, reconciliation can be an expensive operation
   with large data sets.
  </p><p>
   The compensated synchronization mechanism ensures that either all resources
   are synchronized successfully, or that the original change is rolled back.
   This mechanism uses an <code class="literal">onSync</code> script hook configured with
   a <code class="filename">compensate.js</code> script that can be used to "revert" the
   partial change to managed/user and to the corresponding external resources.
  </p><p>
   Sample 5b is similar to sample 5 in that it simulates two external resources
   with XML files (located in the
   <code class="filename">/path/to/samples/sample5b/data</code> directory). The
   <code class="filename">xml_LDAP_Data.xml</code> file simulates an LDAP data source.
   OpenIDM creates the <code class="filename">xml_AD_Data.xml</code> file when you start
   OpenIDM with the sample. Sample 5b adds the <code class="literal">onSync</code> script
   hook to the process, configured in the
   <code class="filename">sample5b/conf/managed.json</code> file.
  </p><p>
   The following excerpt of the <code class="filename">managed.json</code> file shows
   the <code class="literal">onSync</code> hook, which calls the
   <code class="filename">compensate.js</code> script, provided in the
   <code class="filename">/path/to/openidm/bin/defaults/script</code> directory.
  </p><pre class="brush: javascript;">
...
},
"onSync" : {
   "type" : "text/javascript",
   "file" : "compensate.js"
},
  </pre><p>
   You can use the <code class="literal">onSync</code> script hook to ensure that changes
   made in the repository are synchronized to all external resources, or that
   no changes are made. For more information about how automatic synchronization
   uses the <code class="literal">onSync</code> script hook, see <a href="../../integrators-guide/index/chap-synchronization.html#sync-types-automatic" class="link"><em class="citetitle">How Automatic
   Sync works with onSync</em></a> in the <em class="citetitle">Integrator's
   Guide</em>.
  </p><p>
   You can optionally configure an outbound email service for this sample, if
   you want to receive emailed reconciliation summaries. The email service
   configuration is identical to that of sample 5
   (<a class="xref" href="chap-samples.html#email-sample5" title="3.9.1.&nbsp;Configure Email for the Sample">Section&nbsp;3.9.1, &#8220;Configure Email for the Sample&#8221;</a>).
  </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="install-sample5b"></a>3.10.1.&nbsp;Install the Sample</h3></div></div></div><p>No external configuration is required for this sample. Prepare
    OpenIDM as described in <a class="xref" href="chap-samples.html#preparing-openidm" title="3.1.2.&nbsp;Preparing OpenIDM">Section&nbsp;3.1.2, &#8220;Preparing OpenIDM&#8221;</a>, then start
    OpenIDM with the configuration of sample 5b.</p><div class="screen"><pre>$ cd /path/to/openidm
$ ./startup.sh -p samples/sample5b</pre></div><p>
    The XML files that simulate an external LDAP and AD resource are now located
    in the <code class="filename">openidm/samples/sample5b/data/</code> directory. The
    simulated AD data store file, <code class="filename">xml_AD_Data.xml</code>, does not
    contain users until you run reconciliation.
   </p><p>
    Run the sample in exactly the same way that you did for Sample 5, following
    the steps in <a class="xref" href="chap-samples.html#run-sample5" title="3.9.3.&nbsp;Run the Sample">Section&nbsp;3.9.3, &#8220;Run the Sample&#8221;</a>.
   </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="onsync-sample5b"></a>3.10.2.&nbsp;Demonstrate onSync</h3></div></div></div><p>
    To demonstrate integration of the samples with the OpenIDM UI, this sample
    uses the UI to view and make changes to user objects in the repository.
    However, you can also use the REST interface to make these changes, as shown
    in the previous section.
   </p><p>
    Log into the OpenIDM UI as the administrative user. On a local system,
    navigate to <code class="literal">https://localhost:8443/openidmui</code>. The default
    administrative account and password are both <code class="literal">openidm-admin</code>.
   </p><p>
    Make a change to the data of an existing user (<code class="literal">DDOE1</code>).
    With automatic synchronization, that change is reflected almost immediately
    on the external resources. For sample 5b, you should see the changes in both
    XML files in the <code class="filename">/path/to/openidm/sample5b/data</code>
    directory. Alternatively, you can query the external resources over REST, as
    described previously.
   </p><p>
    The synchronization is successful, across all configured external resources,
    so the updated user record can be seen in both the
    <code class="filename">xml_LDAP_Data.xml</code> and
    <code class="filename">xml_AD_Data.xml</code> files.
   </p><p>
    The next step is to simulate a problem connecting to the LDAP resource. One
    way to do so on the local system is to rename the LDAP data file so that it
    is unreadable. On a Linux system, the following command, as an
    administrative user, would serve that purpose:
   </p><div class="screen"><pre>$ cd /path/to/openidm/samples/sample5b/data
$ sudo mv xml_LDAP_Data.xml xml_LDAP_Data.xml.bak</pre></div><p>
    In the UI, now try another update to user <code class="literal">DDOE1</code>. With the
    modified filename of the simulated LDAP resource, automatic synchronization
    cannot write to this resource. An error similar to the following is
    displayed in the log file, <code class="filename">openidm0.log.0</code>:
   </p><div class="screen"><pre>Data file does not exist:
/path/to/openidm/samples/sample5b/data/xml_LDAP_Data.xml</pre></div><p>
    Although the AD resource is available, automatic synchronization will not
    reach this resource, because the mapping is specified
    <span class="emphasis"><em>after</em></span> the managed/user to LDAP mapping in the
    <code class="filename">sync.json</code> file.
   </p><p>
    When the automatic synchronization fails for the LDAP resource, the
    <code class="literal">onSync</code> hook invokes the
    <code class="filename">compensate.js</code> script. This script attempts to revert
    the original change by performing another update to DDOE1 in the repository
    (managed/user). This change, in turn, triggers another automatic
    synchronization to the AD and LDAP resources.
   </p><p>
    Because the LDAP resource is still unreadable, the synchronization to LDAP
    fails again, which triggers the <code class="literal">compensate.js</code> script
    again. This time, however, the script recognizes that the change was
    originally called as a result of a compensation and aborts.
   </p><p>
    The original synchronization error from the first update is thrown from the
    script and the UI should display that error. If you refresh the UI, and view
    that user entry again, you will notice that the change to the entry has been
    reverted.
   </p><p>
    Note that if you change the name of the AD resource file (to make it
    unavailable), a change to a managed/user entry will be synchronized
    successfully with the LDAP resource (because that mapping appears first in
    <code class="filename">sync.json</code>). The synchronization will fail for the AD
    resource. In this case, the change will be reverted on both the managed/user
    entry, and the LDAP resource.
   </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="more-sample6"></a>3.11.&nbsp;Sample 6 - LiveSync With an AD Server</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="chap-samples.html#more-sample6-realad">3.11.1. Sample 6 with an Active AD Deployment</a></span></dt><dt><span class="section"><a href="chap-samples.html#d0e2608">3.11.2. Sample 6 with a Simulated AD Deployment</a></span></dt><dt><span class="section"><a href="chap-samples.html#external-resource-sample6">3.11.3. External Configuration</a></span></dt><dt><span class="section"><a href="chap-samples.html#install-sample6">3.11.4. Start OpenIDM with Sample 6</a></span></dt><dt><span class="section"><a href="chap-samples.html#run-sample6">3.11.5. Run the Sample</a></span></dt></dl></div><a class="indexterm" name="d0e2538"></a><p>
   Sample 6 resembles sample 5, but demonstrates LiveSync from an external
   resource. Sample 6 includes configuration files for two scenarios, depending
   on whether you have a live Active Directory (AD) service, or whether you
   need to simulate an AD service with an OpenDJ server. Each scenario is
   associated with a file in the
   <code class="filename">/path/to/sample6/alternatives</code> directory. The file you
   select should be copied to the <code class="filename">/path/to/sample6/conf</code>
   directory.
  </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Active AD Deployment</span></dt><dd><p>
       If you have an actual AD deployment available, copy the
       <code class="filename">provisioner.openicf-realad.json</code> file to the
       <code class="filename">conf/</code> subdirectory. You can then configure
       synchronization between an OpenDJ Directory Server and an active AD
       deployment.
      </p><p>
       As this sample demonstrates synchronization <span class="emphasis"><em>from</em></span> the
       AD server <span class="emphasis"><em>to</em></span> OpenDJ, data on the AD server is not
       changed.
      </p></dd><dt><span class="term">Simulated AD Deployment</span></dt><dd><p>
      If you need to simulate an AD deployment, copy the 
      <code class="filename">provisioner.openicf-fakead.json</code> file to the
      <code class="filename">conf/</code> subdirectory. You can then configure
      synchronization between an OpenDJ Directory server and a simulated
      AD server.
     </p><p>
      This sample simulates an AD server on the same instance of OpenDJ, using a
      different base DN.
     </p></dd></dl></div><p>
   The options shown in the associated configuration files can be easily
   modified to work with any standard LDAP server.
  </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="more-sample6-realad"></a>3.11.1.&nbsp;Sample 6 with an Active AD Deployment</h3></div></div></div><p>
    If you have an existing, active instance of AD, set up OpenDJ, as described
    in the <a class="link" href="http://opendj.forgerock.org/opendj-server/doc/install-guide/" target="_blank">
    <em class="citetitle">OpenDJ Installation Guide</em></a>.
   </p><p>
    During installation, populate OpenDJ with the data in the
    <code class="filename">Example.ldif</code> file, available in the
    <code class="filename">/path/to/sample6/data</code> directory.
   </p><p>
    The actions run in this sample should not change any data on the AD server.
   </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d0e2608"></a>3.11.2.&nbsp;Sample 6 with a Simulated AD Deployment</h3></div></div></div><p>
    In this sample, an AD deployment is simulated with a different baseDN
    (<code class="literal">dc=fakead,dc=com</code>) on the same OpenDJ server instance.
    You can also simulate the AD server with a separate OpenDJ instance, running
    on the same host, as long as the two instances communicate on different
    ports. The data for the simulated AD instance is contained in the file
    <code class="filename">AD.ldif</code>. The data for the OpenDJ instance is contained
    in the file <code class="filename">Example.ldif</code>.
   </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="external-resource-sample6"></a>3.11.3.&nbsp;External Configuration</h3></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="prepare-livesync-sample6"></a>3.11.3.1.&nbsp;Prepare OpenDJ For LiveSync</h4></div></div></div><p>
      This sample assumes a replicated OpenDJ server. When configured,
      OpenDJ replication includes an External Change Log (ECL), required to
      support LiveSync. LiveSync detects changes in OpenDJ by reading the ECL.
     </p><p>
      To activate the OpenDJ ECL, enable replication as described in the
      <a class="link" href="http://opendj.forgerock.org/opendj-server/doc/admin-guide/index.html#chap-replication" target="_blank">
      <em class="citetitle">OpenDJ Administration Guide chapter on Managing Data
      Replication</em></a>
     </p><p>
      Once configured, you can proceed with either an active or simulated AD
      deployment.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="external-resource-sample6-active"></a>3.11.3.2.&nbsp;External Configuration for an Active AD Deployment</h4></div></div></div><p>
      To configure an active AD deployment for sample 6, open the
      <code class="filename">provisioner.openicf-realad.json</code> file in
      a text editor. Update it as needed. At minimum, you should check and
      if needed update the following parameters in that file, as shown in the
      following table:
     </p><div class="table"><a name="realad-json-configuration"></a><div class="table-title">Table&nbsp;3.1.&nbsp;Key Parameters for an Active AD Configuration</div><div class="table-contents"><table summary="Key Parameters for an Active AD Configuration" border="0"><colgroup><col width="40%"><col width="60%"></colgroup><thead><tr><th>Option</th><th>Description</th></tr></thead><tbody><tr><td>host</td><td>The hostname/IP address of the AD server</td></tr><tr><td>port</td><td>The LDAP port; the default is 389.</td></tr><tr><td>ssl</td><td>By default, SSL is not used.</td></tr><tr><td>principal</td><td>The full DN of the account to bind with, such as
         "CN=Administrator,CN=Users,DC=example,DC=com"</td></tr><tr><td>credentials</td><td>If a password is used, replace null with that password.
          When OpenIDM starts, it encrypts that password in the
          <code class="filename">provisioner.openicf-realad.conf</code> file.</td></tr><tr><td>baseContexts</td><td>The DNs for account containers, such as
         ["CN=Users,DC=Example,DC=com"]</td></tr><tr><td>baseContextsToSynchronize</td><td>Set to the same value as <code class="literal">baseContexts</code></td></tr><tr><td>accountSearchFilter</td><td>Default searches for active user (not computer) accounts</td></tr><tr><td>accountSynchronizationFilter</td><td>Default synchronizes with active user (not computer)
         accounts</td></tr></tbody></table></div></div><br class="table-break"><p>
      If you do not want to filter out computer and disabled user accounts,
      set the <code class="literal">accountSearchFilter</code> and
      <code class="literal">accountSynchronizationFilter</code> to <code class="literal">null</code>.
     </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="external-resource-sample6-simulated"></a>3.11.3.3.&nbsp;External Configuration for a Simulated AD Deployment</h4></div></div></div><p>
      Not everyone has a testable instance of AD readily available. For such
      administrators, you can use the <code class="filename">AD.ldif</code> file from
      the <code class="filename">data/</code> subdirectory to simulate an AD deployment.
     </p><p>
      If you have not already done so, copy the
      <code class="filename">provisioner.openicf-fakead.json</code> file to the
      <code class="filename">conf</code> subdirectory.
     </p><p>
      As previously mentioned, you can use a separate OpenDJ instance to
      simulate  the AD server. However, the following instructions assume that
      the simulated AD server runs on the same OpenDJ instance.
     </p><p>
      Open the <code class="filename">provisioner.openicf-fakead.json</code> file and
      note the following:
     </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        OpenDJ directory server uses port 1389 by default for users who cannot
        use privileged ports, so this is the port that is specified in the
        provisioner file. Adjust the port if your OpenDJ server is listening on
        a different port.
       </p></li><li class="listitem"><p>
        The simulated AD server uses the base DN
        <code class="literal">dc=fakead,dc=com</code>.
       </p></li></ul></div><p>
      To load the data for the simulated AD instance, launch the OpenDJ control
      panel, add the simulated AD baseDN (<code class="literal">dc=fakead,dc=com</code>),
      and then import the <code class="filename">/path/to/sample6/data/AD.ldif</code>
      file. When you import the <code class="filename">AD.ldif</code> file, select
      "Append to Existing Data", not "Overwrite Existing Data". Otherwise, the
      data in the <code class="literal">dc=example,dc=com</code> baseDN will be
      overwritten.
     </p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="install-sample6"></a>3.11.4.&nbsp;Start OpenIDM with Sample 6</h3></div></div></div><p>
     Now that OpenDJ and a real or simulated AD database is configured,
     prepare OpenIDM as described in <a class="xref" href="chap-samples.html#preparing-openidm" title="3.1.2.&nbsp;Preparing OpenIDM">Section&nbsp;3.1.2, &#8220;Preparing OpenIDM&#8221;</a>.
     You can then start OpenIDM with the configuration for sample 6.
    </p><div class="screen"><pre>$ cd /path/to/openidm
$ ./startup.sh -p samples/sample6</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="run-sample6"></a>3.11.5.&nbsp;Run the Sample</h3></div></div></div><p>The following sections show how to run the sample with command-based
     reconciliation with a REST call, and to configure scheduled reconciliation
     with LiveSync.
    </p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="run-sample6-reconciliation"></a>3.11.5.1.&nbsp;Using Reconciliation</h4></div></div></div><p>
     Now that OpenIDM is in operation, review the entries in the OpenDJ
     data store. When you run reconciliation, any entries that share the same
     <code class="literal">uid</code> with the AD data store will be updated with the
     contents from AD.
    </p><p>
     If you have set up the simulated AD data store as described in
     <a class="xref" href="chap-samples.html#external-resource-sample6-simulated" title="3.11.3.3.&nbsp;External Configuration for a Simulated AD Deployment">Section&nbsp;3.11.3.3, &#8220;External Configuration for a Simulated AD Deployment&#8221;</a>, compare the
     entries for <code class="literal">uid=jdoe</code> as shown in the
     <code class="filename">AD.ldif</code> and <code class="filename">Example.ldif</code> files.
     Note the different values of <code class="literal">givenName</code> for
     <code class="literal">uid=jdoe</code>.
    </p><p>
     Run reconciliation over the REST interface. If you have followed the
     instructions for the simulated AD data store, the following command
     takes the information for user <code class="literal">jdoe</code> imported from the
     <code class="filename">AD.ldif</code> file, with a <code class="literal">givenName</code> of
     Johnny, and synchronizes that information to the LDAP database, overwriting
     the <code class="literal">givenName</code> of John for that same user
     <code class="literal">jdoe</code>.
    </p><div class="screen"><pre>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 "https://localhost:8443/openidm/recon?_action=recon&amp;mapping=systemAdAccounts_managedUser"</pre></div><p>Successful reconciliation returns a reconciliation run ID.</p><div class="screen"><pre>{"_id":"9ece3807-08c3-4ec6-87fb-a6a2d0c71cee"}</pre></div><p>
     The reconciliation operation synchronizes the data in the AD deployment
     with OpenIDM repository (managed/user). That information is then
     automatically synchronized to the OpenDJ server, as described in
     <a href="../../integrators-guide/index/chap-synchronization.html#handling-sync" class="link">
      <em class="citetitle">Synchronization Situations and Actions</em></a>.
    </p><p>After reconciliation, list all users in the OpenDJ server data
     store.</p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/system/ldap/account?_queryId=query-all-ids"</strong></pre></div><p>The result should resemble the following JSON object.</p><pre class="brush: javascript;">{
  "result": [ {
     "dn" : "uid=jdoe,ou=People,dc=example,dc=com",
     "_id" : "uid=jdoe,ou=People,dc=example,dc=com"
     }, {
     "dn" : "uid=bjensen,ou=People,dc=example,dc=com",
     "_id" : "uid=bjensen,ou=People,dc=example,dc=com"
    } ],
  "resultCount": 2,
  "pagedResultsCookie": null,
  "remainingPagedResults": -1,
}</pre><p>
     You see only two entries, as the <code class="literal">uid=jdoe</code> entry from
     <code class="literal">dc=fakead,dc=com</code> overwrites the original LDAP entry for
     <code class="literal">uid=jdoe</code> in the reconciled LDAP data store.
    </p><p>
     To read the user object in the OpenDJ server, run the
     <span class="command"><strong>ldapsearch</strong></span> command. The following example returns the
     entry for user <code class="literal">uid=jdoe</code>:
    </p><div class="screen"><pre><strong>$ ./ldapsearch \
 --port 1389 \
 --baseDN dc=example,dc=com \
 "(uid=jdoe)"</strong></pre></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="run-sample6-live-sync"></a>3.11.5.2.&nbsp;Using LiveSync</h4></div></div></div><p>You can start reconciliation by using a scheduled configuration or
     by using the REST interface directly. However, to use LiveSync, you must
     configure a schedule. When LiveSync is active, the default schedule in the
     <code class="filename">schedule-activeSynchroniser_systemAdAccount.json</code>
     configuration file runs LiveSync every 15 seconds.
    </p><p>
     LiveSync pushes changes made in the AD data store to the OpenIDM repository,
     automatically.
    </p><p>
     LiveSync is disabled by default. To activate LiveSync, change the
     value of the <code class="literal">"enabled"</code> property
     from <code class="literal">false</code> to <code class="literal">true</code>.
    </p><pre class="brush: javascript;">{
    "enabled" : false,
    "type" : "cron",
    "schedule" : "0/15 * * * * ?",
    "invokeService" : "provisioner",
    "invokeContext" : {
        "action" : "liveSync",
        "source" : "system/ad/account"
    },
    "invokeLogLevel" : "debug"
}</pre><div class="procedure"><a name="test-live-sync"></a><div class="procedure-title">Procedure&nbsp;3.1.&nbsp;Testing LiveSync</div><p>
      Now you can test LiveSync. This procedure assumes that you have configured
      OpenDJ using the parameters and commands described in this section.
     </p><ol class="procedure" type="1"><li class="step"><p>
       Create an LDIF file with a new user entry (<code class="literal">uid=bsmith</code>)
       that will be added to the simulated AD data store.
      </p></li><li class="step"><p>
       The following is the contents of a sample
       <code class="filename">bsmith.ldif</code> file for demonstration purposes:
       </p><div class="screen"><pre>dn: uid=bsmith,ou=People,dc=fakead,dc=com
objectClass: person
objectClass: inetOrgPerson
objectClass: organizationalPerson
objectClass: top
givenName: Barry
description: Created to see LiveSync work
uid: bsmith
cn: Barry
sn: Smith
mail: bsmith@example.com
telephoneNumber: 1-415-523-0772
userPassword: passw0rd</pre></div><p>
      </p></li><li class="step"><p>
       Navigate to the <code class="filename">/path/to/opendj/bin</code> directory.
      </p></li><li class="step"><p>
       Use the <span class="command"><strong>ldapmodify</strong></span> command to add the
       <code class="filename">bsmith.ldif</code> file to the directory.
      </p><div class="screen"><pre><strong>$ ./ldapmodify
 --port 1389
 --defaultAdd
 --bindDN "cn=Directory Manager"
 --bindPassword password
 --filename /path/to/bsmith.ldif</strong></pre></div></li><li class="step"><p>
       Now you can test synchronization by viewing the new user in the OpenIDM
       repository. The easiest way to do this, is through OpenIDM UI. You should
       be able to log into the UI with any of the accounts in the AD data store.
       For this example, log into the UI as user <code class="literal">bsmith</code>, with
       password <code class="literal">passw0rd</code>. The fact that you can log into the
       UI as this new user indicates that LiveSync has synchronized the user
       from the AD data store to the managed/user repository.
      </p></li><li class="step"><p>
       Automatic synchronization pushes this change out to the OpenDJ data store.
       To test this synchronization operation, search the OpenDJ baseDN for the
       new user entry.
      </p><div class="screen"><pre><strong>$ ./ldapsearch \
 --port 1389 \
 --baseDN ou=people,dc=example,dc=com \
 "(uid=bsmith)"</strong></pre></div></li></ol></div></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="more-sample7"></a>3.12.&nbsp;Sample 7 - Scripting a SCIM-like Schema</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="chap-samples.html#install-sample7">3.12.1. Install the Sample</a></span></dt><dt><span class="section"><a href="chap-samples.html#run-sample7">3.12.2. Running the Sample</a></span></dt></dl></div><a class="indexterm" name="d0e2952"></a><p>Sample 7 demonstrates how you can use OpenIDM to expose user data with a
  SCIM-like schema. The sample uses the XML file connector to read in attributes
  from external accounts and construct a JSON object for users stored in the
  OpenIDM repository. For more information about SCIM schema, see
  <a class="link" href="http://www.simplecloud.info/specs/draft-scim-core-schema-01.html" target="_blank">
  <em class="citetitle">System for Cross-Domain Identity Management:
   Core Schema 1.1</em></a>.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="install-sample7"></a>3.12.1.&nbsp;Install the Sample</h3></div></div></div><p>Prepare OpenIDM as described in <a class="xref" href="chap-samples.html#preparing-openidm" title="3.1.2.&nbsp;Preparing OpenIDM">Section&nbsp;3.1.2, &#8220;Preparing OpenIDM&#8221;</a>, 
   then start OpenIDM with the configuration for sample 7.</p><div class="screen"><pre>$ cd /path/to/openidm
$ ./startup.sh -p samples/sample7</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="run-sample7"></a>3.12.2.&nbsp;Running the Sample</h3></div></div></div><p>Run a reconciliation to pull the user from
   <code class="filename">samples/sample7/data/xmlConnectorData.xml</code> into the 
   OpenIDM internal repository.</p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 "https://localhost:8443/openidm/recon?_action=recon&amp;mapping=systemXmlfileAccounts_managedUser"</strong></pre></div><p>Reconciliation creates a user object in the repository. Retrieve the
   user from the repository.</p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/managed/user/DDOE1"</strong></pre></div><p>The user object has the following JSON representation.</p><pre class="brush: javascript;">{
  "_id" : "DDOE1",
  "_rev" : "2",
  "schemas" : "['urn:scim:schemas:core:1.0']",
  "ims" : [ {
    "type" : "aim",
    "value" : "jonyOnAim"
  }, {
    "type" : "skype",
    "value" : "skyperHiasl"
  } ],
  "locale" : null,
  "phoneNumbers" : [ {
    "type" : "work",
    "value" : "1234567"
  }, {
    "type" : "home",
    "value" : "1234568"
  } ],
  "emails" : [ {
    "type" : "work",
    "value" : "hallo@example.com",
    "primary" : true
  }, {
    "type" : "home",
    "value" : "jdoe@forgerock.com"
  } ],
  "externalId" : "DDOE1",
  "preferredLanguage" : "en_US",
  "meta" : {
    "lastModified" : "Thu May 01 2014 12:57:10 GMT-0800 (GMT-08:00)",
    "created" : "Thu May 01 2014 12:56:27 GMT-0800 (GMT-08:00)"
  },
  "userType" : "permanent",
  "photos" : [ {
    "type" : "photo",
    "value" : "https://photos.example.com/profilephoto/72930000000Ccne/F"
  }, {
    "type" : "thumbnail",
    "value" : "https://photos.example.com/profilephoto/72930000000Ccne/T"
  } ],
  "title" : "Mr.Universe",
  "timezone" : "America/Denver",
  "profileUrl" : "https://login.example.com/DDOE1",
  "nickName" : "Jonny",
  "name" : {
    "familyName" : "Doe",
    "middleName" : "Hias",
    "formatted" : "Dr. John H Doe III",
    "givenName" : "John",
    "honorificSuffix" : "III",
    "honorificPrefix" : "Dr."
  },
  "userName" : "DDOE1",
  "displayName" : "John Doe",
  "addresses" : [ {
    "streetAddress" : "100 Universal City Plaza",
    "region" : "CA",
    "formatted" : "100 Universal City Plaza\nHollywood, CA 91608 USA",
    "postalCode" : "91608",
    "primary" : "true",
    "locality" : "Hollywood",
    "type" : "work",
    "country" : "USA"
  }, {
    "streetAddress" : "222 Universal City Plaza",
    "region" : "CA",
    "formatted" : "222 Universal City Plaza\nHollywood, CA 91622 USA",
    "postalCode" : "91622",
    "primary" : "false",
    "locality" : "Hollywood",
    "type" : "home",
    "country" : "USA"
  } ],
  "groups" : [ {
    "value" : "usemploys",
    "display" : "US Employees"
  }, {
    "value" : "euemploys",
    "display" : "EU Employees"
  } ]
}</pre><p>
    The sample script file, <code class="filename">scim.js</code> in the
    <code class="filename">/path/to/samples/sample7/script</code> directory,
    transforms the user data from the resource into the JSON object layout
    required by SCIM schema.
   </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="more-sample8"></a>3.13.&nbsp;Sample 8 - Logging in Scripts</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="chap-samples.html#install-sample8">3.13.1. Install the Sample</a></span></dt><dt><span class="section"><a href="chap-samples.html#run-sample8">3.13.2. Running the Sample</a></span></dt></dl></div><a class="indexterm" name="d0e3004"></a><p>OpenIDM provides a <code class="literal">logger</code> object with
  <code class="literal">debug()</code>, <code class="literal">error()</code>,
  <code class="literal">info()</code>, <code class="literal">trace()</code>, and
  <code class="literal">warn()</code> functions that you can use to log messages to 
  the OpenIDM console from your scripts.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="install-sample8"></a>3.13.1.&nbsp;Install the Sample</h3></div></div></div><p>Prepare OpenIDM as described in <a class="xref" href="chap-samples.html#preparing-openidm" title="3.1.2.&nbsp;Preparing OpenIDM">Section&nbsp;3.1.2, &#8220;Preparing OpenIDM&#8221;</a>, 
   then start OpenIDM with the configuration for sample 8.</p><div class="screen"><pre>$ cd /path/to/openidm
$ ./startup.sh -p samples/sample8</pre></div><p>The <code class="filename">sync.json</code> file in the
    <code class="filename">/path/to/samples/sample8/conf</code> directory includes
    brief examples of log messages.
   </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="run-sample8"></a>3.13.2.&nbsp;Running the Sample</h3></div></div></div><p>Run reconciliation over the REST interface.</p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 "https://localhost:8443/openidm/recon?_action=recon&amp;mapping=systemXmlfileAccounts_managedUser"</strong></pre></div><p>Successful reconciliation returns a reconciliation run ID.</p><p>Notice the log messages displayed on the OpenIDM (Felix) console.
   The following example omits timestamps and so forth to show only the message
   strings.</p><pre class="brush: plain;">-&gt;
...Case no Source: the source object contains: = null [5235432-...
...Case emptySource: the source object contains: = {lastname=Carter, mobile...
...Case sourceDescription: the source object contains: = Created By XML1
...Case onCreate: the source object contains: = {lastname=Carter, mobile...
...Case result: the source object contains: = {SOURCE_IGNORED={count=0, ids=[]},...</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="more-sample9"></a>3.14.&nbsp;Sample 9 - Asynchronous Reconciliation Using Workflows</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="chap-samples.html#install-sample9">3.14.1. Install the Sample</a></span></dt><dt><span class="section"><a href="chap-samples.html#run-sample9">3.14.2. Running the Sample</a></span></dt></dl></div><a class="indexterm" name="d0e3063"></a><p>Sample 9 demonstrates asynchronous reconciliation using workflows. 
  Reconciliation generates an approval request for each ABSENT user. The 
  configuration for this action is defined in the <code class="filename">conf/sync.json</code> 
  file, which specifies that an <code class="literal">ABSENT</code> condition should 
  launch the <code class="literal">managedUserApproval</code> workflow:</p><pre class="brush: javascript;">...
    {
        "situation" : "ABSENT",
        "action" : {
            "workflowName" : "managedUserApproval",
            "type" : "text/javascript",
            "file" : "workflow/triggerWorkflowFromSync.js"
        }
    },
 ...  </pre><p>When the request is approved by an administrator, the absent users are 
  created by an asynchronous reconciliation process.</p><p>Prepare a fresh installation of OpenIDM before trying this
  sample.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="install-sample9"></a>3.14.1.&nbsp;Install the Sample</h3></div></div></div><p>Prepare OpenIDM as described in <a class="xref" href="chap-samples.html#preparing-openidm" title="3.1.2.&nbsp;Preparing OpenIDM">Section&nbsp;3.1.2, &#8220;Preparing OpenIDM&#8221;</a>, 
     then start OpenIDM with the configuration for sample 9.</p><div class="screen"><pre><strong>$ cd /path/to/openidm
$ ./startup.sh -p samples/sample9</strong></pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="run-sample9"></a>3.14.2.&nbsp;Running the Sample</h3></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Run reconciliation over the REST interface.</p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 "https://localhost:8443/openidm/recon?_action=recon&amp;mapping=systemXmlfileAccounts_managedUser"</strong></pre></div><p>Successful reconciliation returns a reconciliation run ID.</p><p>The reconciliation starts an approval workflow for each ABSENT 
         user. These approval workflows (named <code class="literal">managedUserApproval</code>) 
         wait for the request to be approved by an administrator.</p></li><li class="listitem"><p>Query the invoked workflow task instances over REST.</p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/workflow/taskinstance?_queryId=query-all-ids"</strong></pre></div><p>
          In this case, the request returns two workflow results, each with a
          process ID (<code class="literal">_id</code>) as well as a process definition
          ID. You will use the value of the <code class="literal">_id</code> shortly.
         </p><div class="screen"><pre>{
 "result" : [ {
   "tenantId" : "",
   "createTime" : "2014-05-01T13:48:42.980-08:00",
   "executionId" : "101",
   "delegationStateString" : null,
   "processVariables" : { },
   "_id" : "123",
   "processInstanceId" : "101",
   "description" : null,
   "priority" : 50,
   "name" : "Evaluate request",
   "dueDate" : null,
   "parentTaskId" : null,
   "processDefinitionId" : "managedUserApproval:1:3",
   "taskLocalVariables" : { },
   "suspensionState" : 1,
   "assignee" : "openidm-admin",
   "cachedElContext" : null,
   "queryVariables" : null,
   "activityInstanceVariables" : { },
   "deleted" : false,
   "suspended" : false,
   "_rev" : 1,
   "revisionNext" : 2,
   "category" : null,
   "taskDefinitionKey" : "evaluateRequest",
   "owner" : null,
   "eventName" : null,
   "delegationState" : null
 }, {
   "tenantId" : "",
   "createTime" : "2014-05-01T13:48:42.980-08:00",
   "executionId" : "102",
   "delegationStateString" : null,
   "processVariables" : { },
   "_id" : "124",
   "processInstanceId" : "102",
   "description" : null,
   "priority" : 50,
   "name" : "Evaluate request",
   "dueDate" : null,
   "parentTaskId" : null,
   "processDefinitionId" : "managedUserApproval:1:3",
   "taskLocalVariables" : { },
   "suspensionState" : 1,
   "assignee" : "openidm-admin",
   "cachedElContext" : null,
   "queryVariables" : null,
   "activityInstanceVariables" : { },
   "deleted" : false,
   "suspended" : false,
   "_rev" : 1,
   "revisionNext" : 2,
   "category" : null,
   "taskDefinitionKey" : "evaluateRequest",
   "owner" : null,
   "eventName" : null,
   "delegationState" : null
 } ],
 "resultCount" : 2,
 "pagedResultsCookie" : null,
 "remainingPagedResults" : -1
}</pre></div></li><li class="listitem"><p>
         Approve the requests over REST, by setting the
         <code class="literal">"requestApproved"</code> parameter for the specified task
         instance to <code class="literal">"true"</code>. Note the use of one of the
         values of <code class="literal">_id</code> in the REST call, in this case,
         <code class="literal">124</code>.
        </p><p>On UNIX:</p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --header "Content-Type: application/json" \
 --request POST \
 --data '{"requestApproved": "true"}' \
 "https://localhost:8443/openidm/workflow/taskinstance/124?_action=complete"</strong></pre></div><p>On Windows:</p><div class="screen"><pre><strong>$ curl ^
 --cacert self-signed.crt ^
 --header "X-OpenIDM-Username: openidm-admin" ^
 --header "X-OpenIDM-Password: openidm-admin" ^
 --header "Content-Type: application/json" ^
 --request POST ^
 --data "{\"requestApproved\": \"true\"}" ^
 "https://localhost:8443/openidm/workflow/taskinstance/124?_action=complete"</strong></pre></div><p>A successful call returns the following:</p><div class="screen"><pre>{"Task action performed":"complete"}</pre></div></li><li class="listitem"><p>
         Once the request has been approved, an asynchronous reconciliation
         operation runs, which creates the users whose accounts were approved in
         the previous step.
        </p><p>
         List the users that were created by the asynchronous reconciliation.
        </p><div class="screen"><pre><strong>$ curl \
 --cacert self-signed.crt \
 --header "X-OpenIDM-Username: openidm-admin" \
 --header "X-OpenIDM-Password: openidm-admin" \
 --request GET \
 "https://localhost:8443/openidm/managed/user?_queryId=query-all-ids"</strong></pre></div><p>One user is returned.</p><div class="screen"><pre>{
 "result": [ {
   "_rev": "0",
   "_id": "1"
 } ],
 "resultCount": 1,
 "pagedResultsCookie": null,
 "remainingPagedResults": -1,
}</pre></div></li></ol></div></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="chap-sample.html">Prev</a>&nbsp;</td><td width="20%" align="center">&nbsp;</td><td width="40%" align="right">&nbsp;<a accesskey="n" href="chap-repository.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter&nbsp;2.&nbsp;First OpenIDM Sample&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;4.&nbsp;Installing a Repository For Production</td></tr></table></div><p>&nbsp;</p><div id="footer"><p>Something wrong on this page? <a href="https://bugster.forgerock.org/jira/secure/CreateIssueDetails!init.jspa?pid=10020&components=10164&issuetype=1">Log a documentation bug.</a></p></div>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-23412190-9']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</body></html>