<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
   <title>Chapter&nbsp;4.&nbsp;Installing a Repository For Production</title><link rel="stylesheet" type="text/css" href="coredoc.css"><link rel="stylesheet" type="text/css" href="css/coredoc.css"><link rel="stylesheet" type="text/css" href="sh/shCore.css"><link rel="stylesheet" type="text/css" href="sh/shCoreEclipse.css"><link rel="stylesheet" type="text/css" href="sh/shThemeEclipse.css"><script src="http://code.jquery.com/jquery-1.11.0.min.js" type="text/javascript"></script><script src="uses-jquery.js" type="text/javascript"></script><script src="sh/shCore.js" type="text/javascript"></script><script src="sh/shBrushAci.js" type="text/javascript"></script><script src="sh/shBrushBash.js" type="text/javascript"></script><script src="sh/shBrushCsv.js" type="text/javascript"></script><script src="sh/shBrushHttp.js" type="text/javascript"></script><script src="sh/shBrushJava.js" type="text/javascript"></script><script src="sh/shBrushJScript.js" type="text/javascript"></script><script src="sh/shBrushLDIF.js" type="text/javascript"></script><script src="sh/shBrushPlain.js" type="text/javascript"></script><script src="sh/shBrushProperties.js" type="text/javascript"></script><script src="sh/shBrushXml.js" type="text/javascript"></script><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="OpenIDM Installation Guide"><link rel="up" href="index.html" title="OpenIDM Installation Guide"><link rel="prev" href="chap-samples.html" title="Chapter&nbsp;3.&nbsp;More OpenIDM Samples"><link rel="next" href="chap-uninstall.html" title="Chapter&nbsp;5.&nbsp;Removing and Moving OpenIDM Software"><link rel="copyright" href="legalnotice.html" title="Legal Notice"><script type="text/javascript">SyntaxHighlighter.all();</script>
<link rel="shortcut icon" href="http://forgerock.org/favicon.ico">
</head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter&nbsp;4.&nbsp;Installing a Repository For Production</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="chap-samples.html">Prev</a>&nbsp;</td><th width="60%" align="center">&nbsp;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="chap-uninstall.html">Next</a></td></tr></table><hr></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-repository"></a>Chapter&nbsp;4.&nbsp;Installing a Repository For Production</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="section"><a href="chap-repository.html#repository-mysql">4.1. To Set Up OpenIDM With MySQL</a></span></dt><dt><span class="section"><a href="chap-repository.html#repository-mssql">4.2. To Set Up OpenIDM With MS SQL</a></span></dt><dt><span class="section"><a href="chap-repository.html#repository-oracledb">4.3. To Set Up OpenIDM With Oracle Database</a></span></dt><dt><span class="section"><a href="chap-repository.html#jdbc-repo-config">4.4. Understanding the JDBC Repository Configuration File</a></span></dt><dt><span class="section"><a href="chap-repository.html#explicit-generic-mapping">4.5. Using Explicit or Generic Object Mapping With a JDBC Repository</a></span></dt><dt><span class="section"><a href="chap-repository.html#jdbc-repos-ssl">4.6. Configuring SSL with a JDBC Repository</a></span></dt></dl></div><a class="indexterm" name="d0e3173"></a><p>
  By default, OpenIDM uses OrientDB for its internal repository so that you do
  not have to install a database in order to evaluate OpenIDM. Before using
  OpenIDM in production, however, you must replace OrientDB with a supported
  JDBC repository.
 </p><p>
  OpenIDM  supports the use of <a class="link" href="http://dev.mysql.com/downloads/mysql/" target="_blank">MySQL</a>, MS SQL, and Oracle Database as internal
  repositories. For details of the supported versions, see <a href="../../release-notes/index/chap-before-you-install.html" class="link"><em class="citetitle">Before You Install
  OpenIDM Software</em></a> in the
  <em class="citetitle">Release Notes</em>.
 </p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="repository-mysql"></a>4.1.&nbsp;To Set Up OpenIDM With MySQL</h2></div></div></div><div class="procedure"><p>
    After you have installed MySQL on the local host and <span class="emphasis"><em>before
    starting OpenIDM for the first time</em></span>, set up OpenIDM to use the
    new repository, as described in the following sections.
   </p><p>
    This procedure assumes that a password has already been set for the MySQL
    root user.
   </p><ol class="procedure" type="1"><li class="step"><p>
     Download MySQL Connector/J, version 5.1 or later from the MySQL website.
     Unpack the delivery, and copy the .jar into the
     <code class="filename">openidm/bundle</code> directory.
    </p><div class="screen"><pre>
$ cp mysql-connector-java-<em><strong>version</strong></em>-bin.jar /path/to/openidm/bundle/
    </pre></div></li><li class="step"><p>
     Make sure that OpenIDM is stopped.
    </p><div class="screen"><pre>$ cd /path/to/openidm/
$ ./shutdown.sh
OpenIDM is not running, not stopping.
    </pre></div></li><li class="step"><p>
     Remove <code class="filename">openidm/conf/repo.orientdb.json</code>.
    </p><div class="screen"><pre>$ cd /path/to/openidm/conf/
$ rm repo.orientdb.json</pre></div></li><li class="step"><p>
    Copy <code class="filename">openidm/samples/misc/repo.jdbc.json</code> to the
    <code class="filename">openidm/conf</code> directory.
   </p><div class="screen"><pre>$ cd /path/to/openidm/conf
$ cp ../samples/misc/repo.jdbc.json .</pre></div></li><li class="step"><a class="indexterm" name="d0e3239"></a><p>
    Import the data definition language script for OpenIDM into MySQL.
   </p><div class="screen"><pre><strong>$ cd /path/to/mysql
$ ./bin/mysql -u root -p &lt; /path/to/openidm/db/scripts/mysql/openidm.sql</strong>
<em>Enter password:
$ </em></pre></div><p>This step creates an <code class="literal">openidm</code> database for use
   as the internal repository, and a user <code class="literal">openidm</code> with 
   password <code class="literal">openidm</code> who has all the required privileges to 
   update the database.</p><div class="screen"><pre><strong>$ ./bin/mysql -u root -p</strong>
<em>Enter password:
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 18
Server version: 5.5.19 MySQL Community Server (GPL)
...
mysql&gt; </em><strong>use openidm;</strong>
<em>Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed
mysql&gt; </em><strong>show tables;</strong>
<em>
+---------------------------+
| Tables_in_openidm         |
+---------------------------+
| auditaccess               |
| auditactivity             |
| auditrecon                |
| clusterobjectproperties   |
| clusterobjects            |
| configobjectproperties    |
| configobjects             |
| genericobjectproperties   |
| genericobjects            |
| internaluser              |
| links                     |
| managedobjectproperties   |
| managedobjects            |
| objecttypes               |
| schedulerobjectproperties |
| schedulerobjects          |
| security                  |
| securitykeys              |
| uinotification            |
+---------------------------+
19 rows in set (0.00 sec)</em></pre></div><p>The table names are similar to those used with OrientDB.</p></li><li class="step"><p>
    Update <code class="filename">openidm/conf/repo.jdbc.json</code> as necessary, to
    reflect your MySQL deployment.
   </p><pre class="brush: javascript;">"connection" : {
    "dbType" : "MYSQL",
    "jndiName" : "",
    "driverClass" : "com.mysql.jdbc.Driver",
    "jdbcUrl" : "jdbc:mysql://localhost:3306/openidm",
    "username" : "openidm",
    "password" : "openidm",
    "defaultCatalog" : "openidm",
    "maxBatchSize" : 100,
    "maxTxRetry" : 5,
    "enableConnectionPool" : true,
    "connectionTimeoutInMs" : 30000
},</pre></li></ol></div><p>
     When you have set up MySQL for use as the OpenIDM internal repository,
     start OpenIDM to check that the setup has been successful. After startup,
     you should see that <code class="literal">repo.jdbc</code> is
     <code class="literal">active</code>, whereas <code class="literal">repo.orientdb</code> is
     <code class="literal">unsatisfied</code>.
    </p><div class="screen"><pre><strong>
$ cd /path/to/openidm
$ ./startup.sh</strong>
<em>Using OPENIDM_HOME:   /path/to/openidm
Using OPENIDM_OPTS:   -Xmx1024m -Xms1024m
Using LOGGING_CONFIG:
-Djava.util.logging.config.file=/path/to/openidm/conf/logging.properties
Using boot properties at /path/to/openidm/conf/boot/boot.properties</em>
<strong>-&gt; scr list</strong>
<em>
Id   State          Name
[  19] [active       ] org.forgerock.openidm.config.starter
[  23] [active       ] org.forgerock.openidm.taskscanner
[   8] [active       ] org.forgerock.openidm.external.rest
[  12] [active       ] org.forgerock.openidm.provisioner.openicf.connectorinfoprovider
[  15] [active       ] org.forgerock.openidm.ui.simple
[   1] [active       ] org.forgerock.openidm.router
[  22] [active       ] org.forgerock.openidm.scheduler
[  14] [active       ] org.forgerock.openidm.restlet
[   7] [unsatisfied  ] org.forgerock.openidm.external.email
[  18] [unsatisfied  ] org.forgerock.openidm.repo.orientdb
[   6] [active       ] org.forgerock.openidm.sync
[   3] [active       ] org.forgerock.openidm.script
[   5] [active       ] org.forgerock.openidm.recon
[   2] [active       ] org.forgerock.openidm.scope
[  10] [active       ] org.forgerock.openidm.http.contextregistrator
[  20] [active       ] org.forgerock.openidm.config
[   0] [active       ] org.forgerock.openidm.audit
[  21] [active       ] org.forgerock.openidm.schedule
[  17] [active       ] org.forgerock.openidm.repo.jdbc
[  16] [active       ] org.forgerock.openidm.workflow
[  13] [active       ] org.forgerock.openidm.provisioner.openicf
[   4] [active       ] org.forgerock.openidm.managed
[   9] [active       ] org.forgerock.openidm.authentication
[  11] [active       ] org.forgerock.openidm.provisioner</em></pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="repository-mssql"></a>4.2.&nbsp;To Set Up OpenIDM With MS SQL</h2></div></div></div><div class="procedure"><p>
    These instructions are specific to MS SQL Server 2008 R2 Express running on
    a local Windows XP system. Adapt the instructions for your environment.
   </p><div class="itemizedlist"><p>
     When you install MS SQL Server, note that OpenIDM has the following
     specific configuration requirements:
    </p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
      OpenIDM requires SQL Server authentication. During the MS SQL Server
      installation, make sure that you select SQL Server authentication and not
      just Windows authentication.
     </p></li><li class="listitem"><p>
      During the Feature Selection installation step, make sure that at least
      SQL Server Replication, Full Text Search, and Management Tools - Basic are
      selected.
     </p><p>
      These instructions require SQL Management Studio so make sure that you
      include Management Tools in the installation.
     </p></li><li class="listitem"><p>
      TCP/IP must be enabled and configured for the correct IP address and port.
      To configure TCP/IP, follow these steps:
     </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
        Click Start &gt; All Programs &gt; MS SQL Server 2008 R2 &gt; Configuration Tools
        &gt; SQL Server Configuration Manager.
       </p></li><li class="listitem"><p>
        Expand the SQL Server Network Configuration item and select "Protocols
        for SQLEXPRESS".
       </p></li><li class="listitem"><p>
        Double click TCP/IP and select Enabled &gt; Yes.
       </p></li><li class="listitem"><p>
        Select the IP Addresses tab and set the addresses and ports on which the
        server will listen.
       </p><p>
        For this sample procedure, scroll down to IPAll and set TCP Dynamic
        Ports to 1433 (the default port for MS SQL).
       </p></li><li class="listitem"><p>
        Click Apply, then OK.
       </p></li><li class="listitem"><p>
        Restart MS SQL Server for the configuration changes to take effect. To
        restart the server, select SQL Server Services in the left pane, double
        click SQL Server (SQLEXPRESS) and click Restart.
       </p></li><li class="listitem"><p>
        If you have a firewall enabled, ensure that the port you configured in
        the previous step is open for OpenIDM to access MS SQL.
       </p></li></ol></div></li></ul></div><p>
    After you have installed MS SQL on the local host, install OpenIDM, if you
    have not already done so, but <span class="emphasis"><em>do not start</em></span> the OpenIDM
    instance. Import the data definition and set up OpenIDM to use the new
    repository, as described in the following steps.
   </p><ol class="procedure" type="1"><li class="step"><p>
     Use SQL Management Studio to import the data definition language script for
     OpenIDM into MS SQL.
    </p><ol type="a" class="substeps"><li class="step"><p>
       Click Start &gt; All Programs &gt; MS SQL Server 2008 R2 &gt; SQL Server
       Management Studio.
      </p></li><li class="step"><p>
       On the Connect to Server panel, select SQL Server Authentication from the
       Authentication drop down list and log in as the current user (for
       example, Administrator).
      </p></li><li class="step"><p>
       Select File &gt; Open &gt; File and navigate to the OpenIDM data definition
       language script
       (<code class="filename">path\to\openidm\db\scripts\mssql\openidm.sql</code>).
       Click Open to open the file.
      </p></li><li class="step"><p>
       Click Execute to run the script.
      </p></li></ol></li><li class="step"><p>
     This step creates an <code class="literal">openidm</code> database for use as the
     internal repository, and a user <code class="literal">openidm</code> with password
     <code class="literal">Passw0rd</code> who has all the required privileges to update
     the database. You might need to refresh the view in SQL Server Management
     Studio to see the <code class="literal">openidm</code> database in the Object
     Explorer.
    </p><p>
     Expand Databases &gt; openidm &gt; Tables. You should see the OpenIDM tables in
     the openidm database, as shown in the following example:
    </p><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/sql-tables.png" align="middle" height="360" alt="Default tables in the openidm MS SQL database"></td></tr></table></div><p>
     The table names are similar to those used with OrientDB.
    </p></li><li class="step"><p>
     OpenIDM requires an MS SQL driver that must be created from two separate
     JAR files. Create the driver as follows.
    </p><ol type="a" class="substeps"><li class="step"><p>
       Download the JDBC Driver 4.0 for SQL Server
       (<code class="filename">sqljdbc_4.0.2206.100_enu.tar.gz</code>) from <a class="link" href="http://www.microsoft.com/en-us/download/details.aspx?id=11774" target="_top">
       Microsoft's download site</a>. The precise URL may vary, depending on
       your location.
      </p><p>
       Extract the executable Java archive file
       (<code class="filename">sqljdbc4.jar</code>) from the zip file, using 7-zip or an
       equivalent file management application.
      </p><p>
       Copy the file to <code class="filename">openidm\db\scripts\mssql</code>.
      </p></li><li class="step"><p>
       Download the <code class="literal">bnd</code> Java archive file
       (<code class="filename">biz.aQute.bnd.jar</code>) that enables you to create OSGi
       bundles. The file can be downloaded from <a class="link" href="http://dl.dropbox.com/u/2590603/bnd/biz.aQute.bnd.jar" target="_top">http://dl.dropbox.com/u/2590603/bnd/biz.aQute.bnd.jar</a>.
       For more information about <code class="literal">bnd</code>, see <a class="link" href="http://www.aqute.biz/Bnd/Bnd" target="_top">http://www.aqute.biz/Bnd/Bnd</a>.
      </p><p>
       Copy the file to <code class="filename">openidm\db\scripts\mssql</code>.
      </p></li><li class="step"><p>
       Your <code class="filename">openidm\db\scripts\mssql</code> directory should now
       contain the following files:
      </p><div class="screen"><pre>
       <strong>.\&gt; ls \path\to\openidm\db\scripts\mssql</strong>
       <em>
       biz.aQute.bnd.jar  openidm.sql  sqljdbc4.bnd  sqljdbc4.jar
       </em>
      </pre></div></li><li class="step"><p>
       Bundle the two JAR files together with the following command:
      </p><div class="screen"><pre>
C:\&gt; cd \path\to\openidm\db\scripts\mssql
./&gt; java -jar biz.aQute.bnd.jar wrap -properties sqljdbc4.bnd sqljdbc4.jar
      </pre></div><p>
       This step creates a single <code class="literal">.bar</code> file, named
       <code class="filename">sqljdbc4.bar</code>.
      </p></li><li class="step"><p>
       Rename the <code class="filename">sqljdbc4.bar</code> file to
       <code class="filename">sqljdbc4-osgi.jar</code> and copy it to the
       <code class="filename">openidm\bundle</code> directory.
      </p><div class="screen"><pre>
./&gt; mv sqljdbc4.bar sqljdbc4-osgi.jar
./&gt; cp sqljdbc4-osgi.jar \path\to\openidm\bundle
      </pre></div></li></ol></li><li class="step"><p>
     Remove the default OrientDB repository configuration file
     (<code class="filename">openidm\conf\repo.orientdb.json</code>) from the
     configuration directory.
    </p><div class="screen"><pre>
C:\&gt; cd \path\to\openidm\conf\
.\&gt; del repo.orientdb.json
    </pre></div></li><li class="step"><p>
     Copy the repository configuration file for MS SQL
     (<code class="filename">openidm\samples\misc\repo.jdbc.json</code>) to the
     configuration directory.
    </p><div class="screen"><pre>
C:\&gt; cd \path\to\openidm\conf\
.\&gt; cp ..\samples\misc\repo.jdbc-mssql.json .
    </pre></div></li><li class="step"><p>
     Rename the MS SQL repository configuration file to
     <code class="filename">repo.jdbc.json</code>.
    </p><div class="screen"><pre>.\&gt; mv repo.jdbc-mssql.json repo.jdbc.json</pre></div></li><li class="step"><p>
     Update <code class="filename">openidm\conf\repo.jdbc.json</code> as necessary, to
     reflect your MS SQL deployment.
    </p><pre class="brush: javascript;">
{
    "connection" : {
        "dbType" : "SQLSERVER",
        "jndiName" : "",
        "driverClass" : "com.microsoft.sqlserver.jdbc.SQLServerDriver",
        "jdbcUrl" : "jdbc:sqlserver://localhost:1433;instanceName=default;
                     databaseName=openidm;applicationName=OpenIDM",
        "username" : "openidm",
        "password" : "Passw0rd",
        "defaultCatalog" : "openidm",
        "maxBatchSize" : 100,
        "maxTxRetry" : 5,
        "enableConnectionPool" : true
    },
...
    </pre><p>
     Specifically, check that the port matches what you have configured in MS
     SQL.
    </p></li></ol></div><p>
   When you have completed the preceding steps, start OpenIDM to check that the
   setup has been successful. After startup, you should see that
   <code class="literal">repo.jdbc</code> is <code class="literal">active</code>, whereas
   <code class="literal">repo.orientdb</code> is <code class="literal">unsatisfied</code>.
  </p><div class="screen"><pre><strong>
C:&gt; cd \path\to\openidm
./&gt; startup.bat</strong>
   <em>"Using OPENIDM_HOME:   \path\to\openidm"
"Using OPENIDM_OPTS:   -Xmx1024m -Xms1024m"
"Using LOGGING_CONFIG:
-Djava.util.logging.config.file=\path\to\openidm\conf\logging.properties"
Using boot properties at \path\to\openidm\conf\boot\boot.properties
-&gt; scr list
Id   State          Name
[ 19] [active      ] org.forgerock.openidm.config.starter
[ 23] [active      ] org.forgerock.openidm.taskscanner
[  8] [active      ] org.forgerock.openidm.external.rest
[ 12] [active      ] org.forgerock.openidm.provisioner.openicf.connectorinfoprovider
[ 15] [active      ] org.forgerock.openidm.ui.simple
[  1] [active      ] org.forgerock.openidm.router
[ 22] [active      ] org.forgerock.openidm.scheduler
[ 14] [active      ] org.forgerock.openidm.restlet
[  7] [unsatisfied ] org.forgerock.openidm.external.email
[ 18] [unsatisfied ] org.forgerock.openidm.repo.orientdb
[  6] [active      ] org.forgerock.openidm.sync
[  3] [active      ] org.forgerock.openidm.script
[  5] [active      ] org.forgerock.openidm.recon
[  2] [active      ] org.forgerock.openidm.scope
[ 10] [active      ] org.forgerock.openidm.http.contextregistrator
[ 20] [active      ] org.forgerock.openidm.config
[  0] [active      ] org.forgerock.openidm.audit
[ 21] [active      ] org.forgerock.openidm.schedule
[ 17] [active      ] org.forgerock.openidm.repo.jdbc
[ 16] [active      ] org.forgerock.openidm.workflow
[ 13] [active      ] org.forgerock.openidm.provisioner.openicf
[  4] [active      ] org.forgerock.openidm.managed
[  9] [active      ] org.forgerock.openidm.authentication
[ 11] [active      ] org.forgerock.openidm.provisioner
   </em></pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="repository-oracledb"></a>4.3.&nbsp;To Set Up OpenIDM With Oracle Database</h2></div></div></div><p>
   This section assumes that you have configured an Oracle
   Database with <a class="link" href="http://docs.oracle.com/cd/B28359_01/network.111/b28317/tnsnames.htm" target="_blank">Local Naming Parameters (tnsnames.ora)</a>, a schema owner, and
   optionally a service user and its associated credentials for use by OpenIDM.
  </p><div class="procedure"><p>
   For more information on connecting to an Oracle database, see
   <a class="link" href="http://docs.oracle.com/cd/E11882_01/appdev.112/e10766/tdddg_connecting.htm" target="_blank">Connecting to Oracle Database</a>.
  </p><p>
   You will need to import the OpenIDM schema using the data definition language
   script found in
   <code class="filename">/path/to/openidm/db/scripts/oracle/openidm.sql</code> using the
   appropriate schema owner user.
  </p><p>
   If you have created OpenIDM tables correctly, you should be able to
   query the <code class="literal">internaluser</code> table. The query should return two
   records (<code class="literal">openidm-admin</code> and <code class="literal">anonymous</code>).
   The output here has been formatted for legibility.
  </p><div class="screen"><pre>SQL&gt; select * from internaluser;

OBJECTID     openidm-admin
-----------------------------------------------------------------------------
REV          0
-----------------------------------------------------------------------------
PWD          openidm-admin
-----------------------------------------------------------------------------
ROLES        openidm-admin,openidm-authorized
-----------------------------------------------------------------------------

OBJECTID     anonymous
-----------------------------------------------------------------------------
REV          0
-----------------------------------------------------------------------------
PWD          anonymous
-----------------------------------------------------------------------------
ROLES        openidm-reg
-----------------------------------------------------------------------------</pre></div><p>
   Before you start OpenIDM, you should create an Oracle DB driver from
   two separate jar files and set up the OpenIDM repository file for the
   Oracle DB. To do so, take the following steps:
  </p><ol class="procedure" type="1"><li class="step"><p>Download the Oracle JDBC driver for your Oracle DB version
    from <a class="link" href="http://www.oracle.com/technetwork/database/features/jdbc/index-091264.html" target="_blank">Oracle Technology Network</a> and place it in the
    <code class="filename">openidm/db/scripts/oracle</code> directory.</p><div class="screen"><pre>$ ls /path/to/openidm/db/scripts/oracle
ojdbc6_g.jar
   </pre></div></li><li class="step"><p>
    Create a bind file and edit it to match the version information
    for your JDBC driver.
   </p><p>
    You can use the sample bind file located in
    <code class="filename">openidm/db/scripts/mssql/</code>. Copy the bind file
    to the same location as the JDBC driver.
   </p><div class="screen"><pre>$ cd /path/to/openidm/db/scripts
$ cp mssql/sqljdbc4.bnd oracle/
$ ls oracle/
ojdbc6_g.jar  sqljdbc4.bnd</pre></div><p>
    The JDBC driver version information for your driver is located
    in the <code class="literal">Specification-Version</code> property in the
    MANIFEST file of the driver.</p><div class="screen"><pre>$ cd /path/to/openidm/db/scripts/oracle
$ unzip -q -c ojdbc6_g.jar META-INF/MANIFEST.MF
...
Specification-Vendor: Sun Microsystems Inc.
Specification-Title: JDBC
Specification-Version: 4.0
...</pre></div><p>
    Edit the bind file to match the JDBC driver version.
   </p><div class="screen"><pre>$ more sqljdbc4.bnd
...
version=4.0
Export-Package: *;version=3.1.0-SNAPSHOT
Bundle-Name: Oracle JDBC Driver 4.0 for SQL Server
Bundle-SymbolicName: Oracle JDBC Driver 4.0 for SQL Server
Bundle-Version: 3.1.0-SNAPSHOT</pre></div></li><li class="step"><p>
    Download the <code class="literal">bnd</code> Java archive file
    (<code class="filename">biz.aQute.bnd.jar</code>) that enables you to create
    OSGi bundles. The file can be downloaded from
    <a class="link" href="http://dl.dropbox.com/u/2590603/bnd/biz.aQute.bnd.jar" target="_blank">http://dl.dropbox.com/u/2590603/bnd/biz.aQute.bnd.jar</a>.
    For more information about <code class="literal">bnd</code>, see
    <a class="link" href="http://www.aqute.biz/Bnd/Bnd" target="_blank">http://www.aqute.biz/Bnd/Bnd</a>.
   </p><p>
    Place the <code class="literal">bnd</code> Java archive file in the same
    directory as the JDBC driver, and the bind file.
   </p><div class="screen"><pre>$ ls /path/to/openidm/db/scripts/oracle/
biz.aQute.bnd.jar  ojdbc6_g.jar  sqljdbc4.bnd</pre></div></li><li class="step"><p>
    Change to the directory in which the three files are located and
    run the following command to create the OSGi bundle.
   </p><div class="screen"><pre>$ cd /path/to/openidm/db/scripts/oracle/
$ java -jar biz.aQute.bnd.jar wrap -properties sqljdbc4.bnd ojdbc6_g.jar
Dec 10, 2013 9:53:28 AM java.util.prefs.FileSystemPreferences$1 run
INFO: Created user preferences directory.
ojdbc6_g 984 0</pre></div><p>
    A new <code class="literal">.bar</code> file has now been created.
   </p><div class="screen"><pre>$ ls
biz.aQute.bnd.jar  ojdbc6_g.bar  ojdbc6_g.jar  sqljdbc4.bnd</pre></div></li><li class="step"><p>Move the <code class="literal">.bar</code> file to the
   <code class="literal">openidm/bundle</code> directory and rename it with a
   <code class="literal">.jar</code> extension. The actual name of the file is
   unimportant.</p><div class="screen"><pre>$ mv ojdbc6_g.bar /path/to/openidm/bundle/ojdbc6_g-osgi.jar</pre></div></li><li class="step"><p>
    Remove the default OrientDB configuration file
   (<code class="filename">openidm/conf/repo.orientdb.json</code>) from the
   configuration directory.
   </p><div class="screen"><pre>$ rm /path/to/openidm/conf/repo.orientdb.json</pre></div></li><li class="step"><p>Copy the OracleDB configuration file
   (<code class="filename">openidm/samples/misc/repo.jdbc-oracle.json</code>) to the
   configuration directory and rename the file
    <code class="filename">repo.jdbc.json</code>.
   </p><div class="screen"><pre>$ cd /path/to/openidm/conf
$ cp ../samples/misc/repo.jdbc-oracle.json repo.jdbc.json</pre></div></li><li class="step"><p>
    Update <code class="filename">openidm/conf/repo.jdbc.json</code> as necessary,
    to reflect your OracleDB deployment. Specifically, edit the
    <code class="literal">jdbcUrl</code>,
    <code class="literal">username</code>, and <code class="literal">password</code> properties. For
    example:</p><pre class="brush: javascript;">"connection" : {
        "dbType" : "ORACLE",
        "jndiName" : "",
        "driverClass" : "oracle.jdbc.OracleDriver",
        "jdbcUrl" : "jdbc:oracle:thin:@//localhost:1521/openidm",
        "username" : "openidm",
        "password" : "password",
        "defaultCatalog" : "openidm",
        "maxBatchSize" : 100,
        "maxTxRetry" : 5,
        "connectionTimeoutInMs" : 30000
    },</pre></li></ol></div><div class="itemizedlist"><p>
    The following parameters relate to the Oracle database:
   </p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
     The <code class="literal">"dbType"</code> is <code class="literal">"ORACLE"</code>.
    </p></li><li class="listitem"><p>
     The <code class="literal">"driverClass"</code> is
     <code class="literal">"oracle.jdbc.OracleDriver"</code>.
    </p></li><li class="listitem"><p>
     The <code class="literal">"jdbcUrl"</code> corresponds to the URL of the Oracle DB
     listener, including the service name, based on your configured Local Naming
     Parameters (tnsnames.ora). It should be whatever is appropriate for your
     environment. Replace "openidm" with the service name from your TNS
     description.
    </p></li><li class="listitem"><p>
     The <code class="literal">"username"</code> and <code class="literal">"password"</code>
     corresponds to the credentials of the service user that connects from
     OpenIDM. Use the username of the service user you have created with grants
     to the OpenIDM tables you created earlier.
    </p></li><li class="listitem"><p>
     The <code class="literal">"defaultCatalog"</code> is used to generate queries
     appropriate to your OpenIDM schema in Oracle. It should match the user who
     "owns" the tables. If your schema owner was <code class="literal">"openidm"</code>,
     then the <code class="literal">"defaultCatalog"</code> should also be
     <code class="literal">"openidm"</code>. This will cause OpenIDM to generate queries
     such as <code class="literal">"SELECT objectid FROM openidm.internaluser"</code>.
    </p></li></ul></div><p>
     When you have set up OracleDB for use as the OpenIDM internal
     repository, start OpenIDM to check that the setup has been successful. On
     startup, a number of INFO messages are output, as the predefined queries
     are processed.
    </p><p>
     After startup, you should see that <code class="literal">repo.jdbc</code> is
     <code class="literal">active</code>, whereas <code class="literal">repo.orientdb</code> is
     <code class="literal">unsatisfied</code>.
    </p><div class="screen"><pre><strong>$ cd /path/to/openidm
$ ./startup.sh        </strong>
<em>Using OPENIDM_HOME:   /path/to/openidm
Using OPENIDM_OPTS:   -Xmx1024m -Xms1024m
Using LOGGING_CONFIG:
-Djava.util.logging.config.file=/path/to/openidm/conf/logging.properties
Using boot properties at /path/to/openidm/conf/boot/boot.properties
....</em>
<strong>-&gt; scr list</strong>
<em>   Id   State          Name
...
[   2] [unsatisfied  ] org.forgerock.openidm.repo.orientdb
...
[   3] [active       ] org.forgerock.openidm.repo.jdbc
...</em></pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="jdbc-repo-config"></a>4.4.&nbsp;Understanding the JDBC Repository Configuration File</h2></div></div></div><p>
   OpenIDM provides a specific configuration file for each supported JDBC
   repository, as well as example configurations for other repositories. These
   configuration files are located in
   <code class="filename">/path/to/openidm/samples/misc</code> and are named
   <code class="filename">repo.jdbc-<em class="replaceable"><code>database</code></em>.json</code>. Copy
   the configuration file for your specific database type to
   <code class="filename">/path/to/openidm/conf/repo.jdbc.json</code>.
  </p><p>
   The repository configuration file includes the connection details for the
   repository, a number of predefined queries, and a mapping between OpenIDM
   resources and the tables in the repository.
  </p><p>
   An excerpt from an example repository configuration follows.
  </p><pre class="brush: javascript;">
{
    "connection" : {
        "dbType" : "MYSQL",
        "jndiName" : "",
        "driverClass" : "com.mysql.jdbc.Driver",
        "jdbcUrl" : "jdbc:mysql://localhost:3306/openidm?characterEncoding=utf8",
        "username" : "openidm",
        "password" : "openidm",
        "defaultCatalog" : "openidm",
        "maxBatchSize" : 100,
        "maxTxRetry" : 5,
        "enableConnectionPool" : true,
        "connectionTimeoutInMs" : 30000
    },
    "queries" : {...},
    "resourceMapping" : {...}
}
  </pre><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">"dbType" : string, optional</code></span></dt><dd><p>
      The type of database. The database type might affect the queries used and
      other optimizations. Supported database types include
      <code class="literal">MYSQL</code>, <code class="literal">SQLSERVER</code>, and
      <code class="literal">ORACLE</code>.
     </p></dd><dt><span class="term"><code class="literal">"driverClass"</code>, <code class="literal">"jndiName"</code>, or
    <code class="literal">"jtaName"</code></span></dt><dd><p>
      Depending on the mechanism you use to acquire the data source, set
      <span class="emphasis"><em>one</em></span> of these properties.
     </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        <code class="literal">"driverClass" : string</code>
       </p><p>
        To use the JDBC driver manager to acquire a data source, set this
        property, as well as <code class="literal">"jdbcUrl"</code>,
        <code class="literal">"username"</code>, and <code class="literal">"password"</code>. The
        driver class must be the fully qualified class name of the database
        driver to use for your database.
       </p><p>
        Using the JDBC driver manager to acquire a data source is the most
        likely option, and the only one supported "out of the box". The
        remaining options in the sample repository configuration file assume
        that you are using a JDBC driver manager.
       </p><p>
        Example: <code class="literal">"driverClass" : "com.mysql.jdbc.Driver"</code>
       </p></li><li class="listitem"><p>
        <code class="literal">"jndiName" : string</code>
       </p><p>
        If you use JNDI to acquire the data source, set this property to the
        JNDI name of the data source.
       </p><p>
        This option might be relevant if you want to run OpenIDM inside your own
        web container.
       </p><p>
        Example: <code class="literal">"jndiName" : "jdbc/my-datasource"</code>
       </p></li><li class="listitem"><p>
        <code class="literal">"jtaName" : string</code>
       </p><p>
        If you use an OSGi service to acquire the data source, set this property
        to a stringified version of the OsgiName.
       </p><p>
        This option would only be relevant in a highly customized deployment,
        for example, if you wanted to develop your own connection pool.
       </p><p>
        Example: <code class="literal">"jtaName" : "osgi:service/javax.sql.DataSource/(osgi.jndi.service.name=jdbc/openidm)"</code>
       </p></li></ul></div></dd><dt><span class="term"><code class="literal">"jdbcUrl"</code></span></dt><dd><p>
      The connection URL to the JDBC database. The URL should include all of the
      parameters required by your database. For example, to specify the encoding
      in MySQL use <code class="literal">'characterEncoding=utf8'</code>.
     </p><p>
      Example: <code class="literal">"jdbcUrl" : "jdbc:mysql://localhost:3306/openidm?characterEncoding=utf8"</code>
     </p></dd><dt><span class="term"><code class="literal">"username"</code></span></dt><dd><p>
      The username with which to access the JDBC database.
     </p></dd><dt><span class="term"><code class="literal">"password"</code></span></dt><dd><p>
      The password with which to access the JDBC database. OpenIDM automatically
      encrypts clear string passwords. To replace an existing encrypted value,
      replace the whole <code class="literal">crypto-object</code> value, including the
      brackets, with a string of the new password.
     </p></dd><dt><span class="term"><code class="literal">"defaultCatalog"</code></span></dt><dd><p>
      The database schema to use for OpenIDM. By default, no schema prefix
      is used for queries.
     </p></dd><dt><span class="term"><code class="literal">"maxBatchSize"</code></span></dt><dd><p>
      The maximum number of SQL statements that will be batched together. This
      parameter allows you to optimize the time taken to execute multiple
      queries. Certain databases do not support batching, or limit how many
      statements can be batched. A value of <code class="literal">1</code> disables
      batching.
     </p></dd><dt><span class="term"><code class="literal">"queries"</code></span></dt><dd><p>
      Enables you to create pre-defined queries that can be referenced from the
      configuration. The queries are divided between those for
      <code class="literal">"genericTables"</code> and those for
      <code class="literal">"explicitTables"</code>.
     </p><p>
      The following sample extract from the default MySQL configuration file
      shows two credential queries, one for a generic mapping, and one for an
      explicit mapping. Note that the lines have been broken here for legibility
      only. In a real configuration file, the query would be all on one line.
     </p><pre class="brush: javascript;">
"queries" : {
    "genericTables" : {
        "credential-query" : "SELECT fullobject FROM ${_dbSchema}.${_mainTable}
          obj INNER JOIN ${_dbSchema}.${_propTable} prop ON
          obj.id = prop.${_mainTable}_id INNER JOIN ${_dbSchema}.objecttypes
          objtype ON objtype.id = obj.objecttypes_id WHERE prop.propkey='/userName'
          AND prop.propvalue = ${username} AND objtype.objecttype = ${_resource}",
        ...
    "explicitTables" : {
        "credential-query" : "SELECT * FROM ${_dbSchema}.${_table}
          WHERE objectid = ${username} and accountStatus = 'active'",
        ...
    }
}    </pre><div class="itemizedlist"><p>
       Options supported for query parameters include the following:
      </p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        A default string parameter, for example:
       </p><pre class="brush: plain;">
openidm.query("managed/user", { "_queryId": "for-userName", "uid": "jdoe" });
       </pre></li><li class="listitem"><p>
        A list parameter (<code class="literal">${list:propName}</code>).
       </p><p>
        Use this parameter to specify a set of indeterminate size as part of
        your query. For example:
       </p><pre class="brush: plain;">
WHERE targetObjectId IN (${list:filteredIds})
       </pre></li><li class="listitem"><p>
        An integer parameter (<code class="literal">${int:propName}</code>).
       </p><p>
        Use this parameter if you need query for non-string values in the
        database. This is particularly useful with explicit tables.
       </p></li></ul></div></dd><dt><span class="term"><code class="literal">"resourceMapping"</code></span></dt><dd><p>
      Defines the mapping between OpenIDM resource URIs (for example,
      <code class="literal">managed/user</code>) and JDBC tables. The structure of the
      resource mapping is as follows:
     </p><pre class="brush: javascript;">
"resourceMapping" : {
    "default" : {
        "mainTable" : "genericobjects",
        "propertiesTable" : "genericobjectproperties",
        "searchableDefault" : true
    },
    "genericMapping" : {...},
    "explicitMapping" : {...}
}    </pre><p>
      The default mapping object represents a default generic table in which any
      resource that does not have a more specific mapping is stored.
     </p><p>
      The generic and explicit mapping objects are described in the following
      section.
     </p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="explicit-generic-mapping"></a>4.5.&nbsp;Using Explicit or Generic Object Mapping With a JDBC Repository</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="chap-repository.html#generic-mappings">4.5.1. Using Generic Mappings</a></span></dt><dt><span class="section"><a href="chap-repository.html#searches-with-generic-mappings">4.5.2. Improving Search Performance for Generic Mappings</a></span></dt><dt><span class="section"><a href="chap-repository.html#explicit-mappings">4.5.3. Using Explicit Mappings</a></span></dt></dl></div><div class="itemizedlist"><p>
    For JDBC repositories, there are two ways of mapping OpenIDM objects to the
    database tables.
   </p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
     <span class="emphasis"><em>Generic mapping</em></span>, which allows arbitrary objects to be
     stored without special configuration or administration.
    </p></li><li class="listitem"><p>
     <span class="emphasis"><em>Explicit mapping</em></span>, which allows for optimized storage
     and queries by explicitly mapping objects to tables and columns in the
     database.
    </p></li></ul></div><p>
   These two mapping strategies are discussed in the following sections.
  </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="generic-mappings"></a>4.5.1.&nbsp;Using Generic Mappings</h3></div></div></div><p>
    Generic mapping speeds up development, and can make system maintenance
    more flexible by providing a more stable database structure. However,
    generic mapping can have a performance impact and does not take full
    advantage of the database facilities (such as validation within the database
    and flexible indexing). In addition, queries can be more difficult to set up.
   </p><p>
    In a generic table, the entire object content is stored in a single
    large-character field named <code class="literal">"fullobject"</code> in the
    <code class="literal">"mainTable"</code> for the object. To search on specific fields,
    you can read them by referring to them in the corresponding
    <code class="literal">properties table</code> for that object. The disadvantage of
    generic objects is that, because every property you might like to filter by
    is stored in a separate table, you must join to that table each time you need
    to filter by anything.
   </p><p>
    The following diagram shows a pared down database structure for the default
    generic table, and indicates the relationship between the main table and
    the corresponding properties table for each object.
   </p><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/generic-tables-erd.png" align="middle" height="360" alt="Generic tables entity relationship diagram"></td></tr></table></div><p>
    These separate tables can make the query syntax particularly complex. For
    example, a simple query to return user entries based on a user name would
    need to be implemented as follows:
   </p><pre class="brush: plain;">
SELECT fullobject FROM ${_dbSchema}.${_mainTable} obj INNER JOIN ${_dbSchema}.${_propTable} prop
    ON obj.id = prop.${_mainTable}_id INNER JOIN ${_dbSchema}.objecttypes objtype
    ON objtype.id = obj.objecttypes_id WHERE prop.propkey='/userName' AND prop.propvalue = ${uid}
    AND objtype.objecttype = ${_resource}",
   </pre><p>
    The query can be broken down as follows:
   </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Select the full object from the main table</p><pre class="brush: plain;">
SELECT fullobject FROM ${_dbSchema}.${_mainTable} obj
     </pre></li><li class="listitem"><p>
      Join to the properties table and locate the object with the corresponding ID.
     </p><pre class="brush: plain;">
INNER JOIN ${_dbSchema}.${_propTable} prop  ON obj.id = prop.${_mainTable}_id
     </pre></li><li class="listitem"><p>
      Join to the object types table to restrict returned entries to objects of
      a specific type. For example, you might want to restrict returned entries
      to <code class="literal">managed/user</code> objects, or <code class="literal">managed/role</code>
      objects.
     </p><pre class="brush: plain;">
INNER JOIN ${_dbSchema}.objecttypes objtype ON objtype.id = obj.objecttypes_id
     </pre></li><li class="listitem"><p>
      Filter records by the <code class="literal">userName</code> property, where the
      userName is equal to the specified <code class="literal">uid</code> and the object
      type is the specified type (in this case, managed/user objects).
     </p><pre class="brush: plain;">
WHERE prop.propkey='/userName'
AND prop.propvalue = ${uid}
AND objtype.objecttype = ${_resource}",
     </pre><p>
      The value of the <code class="literal">uid</code> field is provided as part of the
      query call, for example:
     </p><pre class="brush: plain;">
openidm.query("managed/user", { "_queryId": "for-userName", "uid": "jdoe" });
     </pre></li></ul></div><p>
    Tables for user definable objects use a generic mapping by default.
   </p><p>
    The following sample generic mapping object illustrates how
    <code class="literal">managed/</code> objects are stored in a generic table.
   </p><pre class="brush: javascript;">
  "genericMapping" : {
      "managed/*" : {
          "mainTable" : "managedobjects",
          "propertiesTable" : "managedobjectproperties",
          "searchableDefault" : true,
          "properties" : {
              "/picture" : {
                  "searchable" : false
              }
          }
      }
  },
   </pre><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">"mainTable"</code> (string, mandatory)</span></dt><dd><p>
       Indicates the main table in which data is stored for this resource.
      </p><p>
       The complete object is stored in the <code class="literal">fullobject</code> column
       of this table. The table includes an <code class="literal">entityType</code>
       foreign key, that is used to distinguish the different objects stored
       within the table. In addition, the revision of each stored object is
       tracked, in the <code class="literal">rev</code> column of the table, enabling
       multi version concurrency control (MVCC). For more information, see
       <a href="../../integrators-guide/index/appendix-objects.html#managed-objects-programmatic" class="link"><em class="citetitle">Manipulating
       Managed Objects Programmatically</em></a> in the
       <em class="citetitle">Integrator's Guide</em>.
      </p></dd><dt><span class="term"><code class="literal">"propertiesTable"</code> (string, mandatory)</span></dt><dd><p>
       Indicates the properties table, used for searches.
      </p><p>
       The contents of the properties table is a defined subset of the
       properties, copied from the character large object (CLOB) that is stored
       in the <code class="literal">fullobject</code> column of the main table. The
       properties are stored in a one-to-many style separate table. The set of
       properties stored here is determined by the properties that are defined
       as <code class="literal">"searchable"</code>.
      </p><p>
       The stored set of searchable properties makes these values available as
       discrete rows that can be accessed with SQL queries, specifically, with
       <code class="literal">WHERE</code> clauses. It is not otherwise possible to query
       specific properties of the full object.
      </p><div class="itemizedlist"><p>
        The properties table includes the following columns:
       </p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
         <code class="literal">${_mainTable}_id</code> corresponds to the
         <code class="literal">id</code> of the full object in the main table,
         for example, <code class="literal">manageobjects_id</code>, or
         <code class="literal">genericobjects_id</code>.
        </p></li><li class="listitem"><p>
          <code class="literal">propkey</code> is the name of the searchable property,
          stored in JSON pointer format (for example <code class="literal">/mail</code>.
          For more information about JSON pointer syntax, see
          <a class="link" href="http://tools.ietf.org/html/rfc6901" target="_blank">RFC 6901</a>.
         </p></li><li class="listitem"><p>
         <code class="literal">proptype</code> is the data type of the property, for
         example <code class="literal">java.lang.String</code>. The property type is
         obtained from the Class associated with the value.
        </p></li><li class="listitem"><p>
         <code class="literal">propvalue</code> is the value of property, extracted from
         the full object that is stored in the main table.
        </p><p>
         Regardless of the property data type, this value is stored as a string,
         so queries against it should treat it as such.
        </p></li></ul></div></dd><dt><span class="term"><code class="literal">"searchableDefault"</code> (boolean, optional)</span></dt><dd><p>
       Specifies whether all properties of the resource should be searchable by
       default. Properties that are searchable are stored and indexed. You can
       override the default for individual properties in the
       <code class="literal">"properties"</code> element of the mapping. The preceding
       example indicates that all properties are searchable, with the exception
       of the <code class="literal">"picture"</code> property.
      </p><p>
       For large, complex objects, having all properties searchable implies a
       substantial performance impact. In such a case, a separate insert
       statement is made in the properties table for each element in the object,
       every time the object is updated. Also, because these are indexed fields,
       the recreation of these properties incurs a cost in the maintenance of
       the index. You should therefore enable <code class="literal">"searchable"</code>
       only for those properties that must be used as part of a WHERE clause in
       a query.
      </p></dd><dt><span class="term"><code class="literal">"properties"</code></span></dt><dd><p>
       Lists any individual properties for which the searchable default should
       be overridden.
      </p><p>
       Note that if an object was originally created with a subset of
       <code class="literal">"searchable"</code> properties, changing this subset (by
       adding a new <code class="literal">"searchable"</code> property in the
       configuration, for example) will not cause the existing values to be
       updated in the properties table for that object. To add the new property
       to the properties table for that object, you must update or recreate the
       object.
      </p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="searches-with-generic-mappings"></a>4.5.2.&nbsp;Improving Search Performance for Generic Mappings</h3></div></div></div><p>
    By default, all properties in a generic mapping are searchable.
    Although there are no individual indexes in a generic mapping, you can
    improve search performance by setting only those properties that you need to
    search as <code class="literal">"searchable"</code>. Properties that are searchable
    are created within the corresponding properties table. The properties table
    exists only for searches or look-ups, and has a composite index, based on
    the resource, then the property name.
   </p><p>
    To restrict searches to specific properties, set the
    <code class="literal">"searchableDefault"</code> to false for the mapping, and then
    explicitly set <code class="literal">"searchable"</code> to true for each property
    that should be searched. The following sample extract from
    <code class="filename">repo.jdbc.json</code> indicates searches restricted to the
    <code class="literal">"userName"</code> property.
   </p><pre class="brush: javascript;">
"genericMapping" : {
    "managed/user" : {
        "mainTable" : "manageduserobjects",
        "propertiesTable" : "manageduserobjectproperties",
        "searchableDefault" : false,
        "properties" : {
            "/userName" : {
            "searchable" : true
            }
        }
    }
},
   </pre><p>
    With this configuration, OpenIDM creates entries in the properties table
    only for <code class="literal">"userName"</code> properties of managed user objects.
   </p><p>
    If the global <code class="literal">"searchableDefault"</code> is set to false,
    properties that do not have a searchable attribute explicitly set to true
    are not written in the properties table.
   </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="explicit-mappings"></a>4.5.3.&nbsp;Using Explicit Mappings</h3></div></div></div><p>
    Explicit mapping is more difficult to set up and maintain, but can take
    complete advantage of the native database facilities.
   </p><p>
    An explicit table offers better performance and simpler queries. There is
    less work in the reading and writing of data, since the data is all in a
    single row of a single table. In addition, it is easier to create different
    types of indexes that apply to only specific fields in an explicit table.
    The disadvantage of explicit tables is the additional work required in
    creating the table in the schema. Also, because rows in a table are
    inherently more simple, it is more difficult to deal with complex objects.
    Any non-simple key:value pair in an object associated with an explicit table
    is converted to a JSON string and stored in the cell in that format. This
    makes the value difficult to use, from the perspective of a query attempting
    to search within it.
   </p><p>
    Note that it is possible to have a generic mapping configuration for most
    managed objects, <span class="emphasis"><em>and</em></span> to have an explicit mapping that
    overrides the default generic mapping in certain cases. The sample
    configuration provided in
    <code class="filename">/path/to/openidm/samples/misc/repo.jdbc-mysql-explicit-managed-user.json</code>
    has a generic mapping for managed objects, but an explicit mapping for
    managed user objects.
   </p><p>
    OpenIDM uses explicit mapping for internal system tables, such as the tables
    used for auditing.
   </p><p>
    Depending on the types of usage your system is supporting, you might find
    that an explicit mapping performs better than a generic mapping. Operations
    such as sorting and searching (such as those performed in the default UI)
    tend to be faster with explicitly-mapped objects, for example.
   </p><p>
    The following sample explicit mapping object illustrates how
    <code class="literal">internal/user</code> objects are stored in an explicit table.
   </p><pre class="brush: javascript;">
"explicitMapping" : {
    "internal/user" : {
        "table" : "internaluser",
        "objectToColumn" : {
            "_id" : "objectid",
            "_rev" : "rev",
            "password" : "pwd",
            "roles" : "roles"
        }
    },
    ...
}
   </pre><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">"&lt;resource-uri&gt;"</code> (string, mandatory)</span></dt><dd><p>
       Indicates the URI for the resources to which this mapping applies, for
       example, <code class="literal">"internal/user"</code>.
      </p></dd><dt><span class="term"><code class="literal">"table"</code> (string, mandatory)</span></dt><dd><p>
       The name of the database table in which the object (in this case internal
       users) is stored.
      </p></dd><dt><span class="term"><code class="literal">"objectToColumn"</code> (string, mandatory)</span></dt><dd><p>
       The way in which specific managed object properties are mapped to columns
       in the table.
      </p><p>
       The mapping can be a simple one to one mapping, for example
       <code class="literal">"userName": "userName",</code> or a more complex JSON map or
       list. When a column is mapped to a JSON map or list, the syntax is as
       shown in the following examples:
      </p><pre class="brush: plain;">
"messageDetail" : { "column" : "messagedetail", "type" : "JSON_MAP" }
      </pre><p>
       or
      </p><pre class="brush: plain;">
"roles": { "column" : "roles", "type" : "JSON_LIST" }
      </pre></dd></dl></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="jdbc-repos-ssl"></a>4.6.&nbsp;Configuring SSL with a JDBC Repository</h2></div></div></div><p>
   To configure SSL with a JDBC repository, you need to import the CA
   certificate file for the server into two locations: the Java truststore
   and the OpenIDM truststore. That certificate file could have a name like
   <code class="filename">ca-cert.pem</code>. If you have a different genuine or
   self-signed certificate file, substitute accordingly.
  </p><p>
   To import the CA certificate file into both truststores, use the
   <span class="command"><strong>keytool</strong></span> command native to the Java environment, typically
   located in the <code class="filename">/path/to/jre-version/bin</code> directory. On
   some UNIX-based systems, <span class="command"><strong>/usr/bin/keytool</strong></span> may link
   to that command.
  </p><p>
   You can find the Java truststore file, <code class="filename">cacerts</code>, in the
   <code class="filename">/path/to/jre-version/jre/lib/security</code> directory. On
   some UNIX-based systems, that may be linked to a location such as
   <code class="filename">/etc/pki/java/cacerts</code>.
  </p><div class="procedure"><a name="import-cacert-jdbc"></a><div class="procedure-title">Procedure&nbsp;4.1.&nbsp;Preparing OpenIDM for SSL with a JDBC Repository</div><ol class="procedure" type="1"><li class="step"><p>
     Import the <code class="filename">ca-cert.pem</code> certificate into the Java
     truststore file with the following command:
    </p><div class="screen"><pre>$ keytool \
 -importcert \
 -trustcacerts
 -file ca-cert.pem \
 -alias "DB cert" \
 -keystore /etc/pki/java/cacerts
    </pre></div></li><li class="step"><p>
     Import the <code class="filename">ca-cert.pem</code> certificate into the OpenIDM
     truststore file with the following command:
    </p><div class="screen"><pre>$ keytool \
 -importcert \
 -trustcacerts \
 -file ca-cert.pem \
 -alias "DB cert" \
 -keystore /path/to/openidm/security/truststore
    </pre></div></li><li class="step"><p>
     Open the repository configuration file, <code class="filename">repo.jdbc.json</code>.
    </p><p>
     Look for the <code class="literal">"jdbcUrl"</code> properties. You should see a
     <code class="literal">jdbc</code> URL. Add a
     <code class="literal">?characterEncoding=utf8&amp;useSSL=true</code> to the end of
     that URL.
    </p><p>
     The <code class="literal">"jdbcUrl"</code> that you configure depends on your JDBC
     repository. The following entries correspond to appropriate
     <code class="literal">"jdbcURL"</code> properties for MySQL, MSSQL, and Oracle DB,
     respectively.
    </p><div class="screen"><pre>
"jdbcUrl" : "jdbc:mysql://localhost:3306/openidm?characterEncoding=utf8&amp;useSSL=true"</pre></div><div class="screen"><pre>
"jdbcUrl" : "jdbc:sqlserver://localhost:1433;instanceName=default;
     databaseName=openidm;applicationName=OpenIDM?characterEncoding=utf8&amp;useSSL=true"</pre></div><div class="screen"><pre>
"jdbcUrl" : "jdbc:oracle:thin:@//localhost:1521/openidm?characterEncoding=utf8&amp;useSSL=true"</pre></div></li><li class="step"><p>
     Open the <code class="filename">/path/to/openidm/conf/config.properties</code> file.
     Find the <code class="literal">org.osgi.framework.bootdelegation</code> property.
     Make sure that property includes a reference to the
     <code class="literal">javax.net.ssl</code> option. If you started with the default
     version of <code class="filename">config.properties</code> that line should now
     read as follows:
    </p><div class="screen"><pre>
org.osgi.framework.bootdelegation=sun.*,com.sun.*,apple.*,com.apple.*,javax.net.ssl
    </pre></div></li></ol></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="chap-samples.html">Prev</a>&nbsp;</td><td width="20%" align="center">&nbsp;</td><td width="40%" align="right">&nbsp;<a accesskey="n" href="chap-uninstall.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter&nbsp;3.&nbsp;More OpenIDM Samples&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;5.&nbsp;Removing and Moving OpenIDM Software</td></tr></table></div><p>&nbsp;</p><div id="footer"><p>Something wrong on this page? <a href="https://bugster.forgerock.org/jira/secure/CreateIssueDetails!init.jspa?pid=10020&components=10164&issuetype=1">Log a documentation bug.</a></p></div>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-23412190-9']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</body></html>