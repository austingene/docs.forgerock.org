<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
   <title>Appendix&nbsp;F.&nbsp;Scripting Reference</title><link rel="stylesheet" type="text/css" href="css/coredoc.css"><meta name="generator" content="DocBook XSL-NS Stylesheets V1.76.1"><link rel="home" href="OpenIDM-Integrators-Guide.html" title="OpenIDM 2.0.2 Integrator's Guide"><link rel="up" href="OpenIDM-Integrators-Guide.html" title="OpenIDM 2.0.2 Integrator's Guide"><link rel="prev" href="appendix-rest.html" title="Appendix&nbsp;E.&nbsp;REST API Reference"><link rel="next" href="appendix-scheduling.html" title="Appendix&nbsp;G.&nbsp;Scheduler Reference"><link rel="copyright" href="legalnotice.html" title="Legal Notice"><script src="http://code.jquery.com/jquery.min.js"></script>
<script>
// On double-click, reformat <div class="screen"> for easy copying.
$(document).ready(function() {
  $(".screen").attr("title", "Double-click [-] to flatten lines.");
  $(".screen").prepend('<img src="../images/minus.png" class="toggle">');
});
$(".screen").live("dblclick", function() {
  $(this).replaceWith(
    "<div class=\"flat\" title=\"Double-click [+] to wrap long lines.\">" +
    $(this).html().replace(/minus\.png/,"plus.png").replace(/\n /g," ") + "\n<!--" + $(this).html() + "-->" +
    "</div>");
});
$(".flat").live("dblclick", function() {
  $(this).replaceWith(
    "<div class=\"screen\" title=\"Double-click [-] to flatten lines.\">" +
    $(this).html().replace(/(.|\n)+<!\-\-/m,"").replace(/\-\-\>/,"").replace(/plus\.png/,"minus.png") +
    "</div>");
});
</script>
<link rel="shortcut icon" href="http://forgerock.org/favicon.ico">
</head ><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Appendix&nbsp;F.&nbsp;Scripting Reference</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="appendix-rest.html">Prev</a>&nbsp;</td><th width="60%" align="center">&nbsp;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="appendix-scheduling.html">Next</a></td></tr></table><hr></div><div lang="en" class="appendix" title="Appendix&nbsp;F.&nbsp;Scripting Reference"><div class="titlepage"><div><div><h2 class="title"><a name="appendix-scripting"></a>Appendix&nbsp;F.&nbsp;Scripting Reference</h2></div></div></div><a class="indexterm" name="d155e8214"></a><p>Scripting lets you customize how OpenIDM works in various ways, such
  as providing custom logic between source and target mappings, defining
  correlation rules, filters, and triggers.</p><div class="section" title="F.1.&nbsp;Configuration"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="scripting-configuration"></a>F.1.&nbsp;Configuration</h2></div></div></div><p>You define scripts using script objects, which can either include the
  code directly in the configuration, or call an external file containing the
  script.</p><div class="programlisting">{
  <strong class="hl-string"><em style="color: #f58220">"type"</em></strong>  : <strong class="hl-string"><em style="color: #f58220">"text/javascript"</em></strong>,
  <strong class="hl-string"><em style="color: #f58220">"source"</em></strong>: <em class="replaceable"><code>string</code></em>
}</div><p>or</p><div class="programlisting">{
  <strong class="hl-string"><em style="color: #f58220">"type"</em></strong>  : <strong class="hl-string"><em style="color: #f58220">"text/javascript"</em></strong>,
  <strong class="hl-string"><em style="color: #f58220">"file"</em></strong>  : <em class="replaceable"><code>file location</code></em>
}</div><div class="variablelist"><dl><dt><span class="term">type</span></dt><dd><p>string, required</p><p>Specifies the type of script to be executed. Currently, OpenIDM
     supports only <code class="literal">"text/javascript"</code>.</p></dd><dt><span class="term">source</span></dt><dd><p>string, required if file is not specified</p><p>Specifies the source code of the script to be executed.</p></dd><dt><span class="term">file</span></dt><dd><p>string, required if source is not specified</p><p>Specifies the file containing the source code of the script to
     execute.</p></dd></dl></div></div><div class="section" title="F.2.&nbsp;Examples"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="scripting-example"></a>F.2.&nbsp;Examples</h2></div></div></div><p>The following example returns <code class="literal">true</code> if the
  <code class="literal">employeeType</code> is equal to <code class="literal">external</code>,
  otherwise returns <code class="literal">false</code>. This script can be useful during
  reconciliation to establish whether the source object should be a part of
  the reconciliation, or ignored.</p><div class="programlisting">
<strong class="hl-string"><em style="color: #f58220">"validTarget"</em></strong>: {
  <strong class="hl-string"><em style="color: #f58220">"type"</em></strong>  : <strong class="hl-string"><em style="color: #f58220">"text/javascript"</em></strong>,
  <strong class="hl-string"><em style="color: #f58220">"source"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"object.employeeType == 'external'"</em></strong>
}</div><p>The following example sets the <code class="literal">__PASSWORD__</code>
  attribute to <code class="literal">defaultpwd</code> when OpenIDM creates a target
  object.</p><div class="programlisting">
<strong class="hl-string"><em style="color: #f58220">"onCreate"</em></strong> : {
  <strong class="hl-string"><em style="color: #f58220">"type"</em></strong>  : <strong class="hl-string"><em style="color: #f58220">"text/javascript"</em></strong>,
  <strong class="hl-string"><em style="color: #f58220">"source"</em></strong>: <strong class="hl-string"><em style="color: #f58220">"target.__PASSWORD__ = 'defaultpwd'"</em></strong>
}</div><p>The following example shows a trigger to create Solaris home
  directories using a script. The script is located in a file,
  <code class="filename">/path/to/openidm/script/createUnixHomeDir.js</code>.</p><div class="programlisting">
{
  <strong class="hl-string"><em style="color: #f58220">"filters"</em></strong> : [ {
      <strong class="hl-string"><em style="color: #f58220">"pattern"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"^system/solaris/account$"</em></strong>,
      <strong class="hl-string"><em style="color: #f58220">"methods"</em></strong> : [ <strong class="hl-string"><em style="color: #f58220">"create"</em></strong> ],
      <strong class="hl-string"><em style="color: #f58220">"onResponse"</em></strong> : {
        <strong class="hl-string"><em style="color: #f58220">"type"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"text/javascript"</em></strong>,
        <strong class="hl-string"><em style="color: #f58220">"file"</em></strong> : <strong class="hl-string"><em style="color: #f58220">"script/createUnixHomeDir.js"</em></strong>
      }
  } ]
}</div></div><div class="section" title="F.3.&nbsp;Function Reference"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="function-ref"></a>F.3.&nbsp;Function Reference</h2></div></div></div><a class="indexterm" name="d155e8303"></a><a class="indexterm" name="d155e8308"></a><p>Functions (access to managed objects, system objects, configuration
   objects) within OpenIDM are accessible to scripts via the
   <code class="literal">openidm</code> object, which is included in the top-level scope
   provided to each script.</p><div class="section" title="F.3.1.&nbsp;openidm.create(id, value)"><div class="titlepage"><div><div><h3 class="title"><a name="function-create"></a>F.3.1.&nbsp;openidm.create(id, value)</h3></div></div></div><p>This function creates a new resource object.</p><div class="variablelist" title="Parameters"><div class="variablelist-title">Parameters</div><dl><dt><span class="term">id</span></dt><dd><p>string</p><p>The identifier of the object to be created.</p></dd><dt><span class="term">value</span></dt><dd><p>object</p><p>The value of the object to be created.</p></dd></dl></div><div class="itemizedlist" title="Returns"><div class="itemizedlist-title">Returns</div><ul class="itemizedlist" type="disc"><li class="listitem"><p>A <code class="literal">null</code> value if successful.</p></li></ul></div><div class="itemizedlist" title="Throws"><div class="itemizedlist-title">Throws</div><ul class="itemizedlist" type="disc"><li class="listitem"><p>An exception is thrown if the object could not be created for any
     reason.</p></li></ul></div></div><div class="section" title="F.3.2.&nbsp;openidm.read(id)"><div class="titlepage"><div><div><h3 class="title"><a name="function-read"></a>F.3.2.&nbsp;openidm.read(id)</h3></div></div></div><p>This function reads and returns an OpenIDM resource object.</p><div class="variablelist" title="Parameters"><div class="variablelist-title">Parameters</div><dl><dt><span class="term">id</span></dt><dd><p>string</p><p>The identifier of the object to be read.</p></dd></dl></div><div class="itemizedlist" title="Returns"><div class="itemizedlist-title">Returns</div><ul class="itemizedlist" type="disc"><li class="listitem"><p>The read OpenIDM resource object, or <code class="literal">null</code> if not
     found.</p></li></ul></div></div><div class="section" title="F.3.3.&nbsp;openidm.update(id, rev, value)"><div class="titlepage"><div><div><h3 class="title"><a name="function-update"></a>F.3.3.&nbsp;openidm.update(id, rev, value)</h3></div></div></div><p>This function updates a resource object.</p><div class="variablelist" title="Parameters"><div class="variablelist-title">Parameters</div><dl><dt><span class="term">id</span></dt><dd><p>string</p><p>The identifier of the resource object to be updated.</p></dd><dt><span class="term">rev</span></dt><dd><p>string</p><p>The revision of the object to be updated, or <code class="literal">null</code>
      if the object is not subject to revision control.</p></dd><dt><span class="term">value</span></dt><dd><p>object</p><p>The value of the object to be updated.</p></dd></dl></div><div class="itemizedlist" title="Returns"><div class="itemizedlist-title">Returns</div><ul class="itemizedlist" type="disc"><li class="listitem"><p>A <code class="literal">null</code> value if successful.</p></li></ul></div><div class="itemizedlist" title="Throws"><div class="itemizedlist-title">Throws</div><ul class="itemizedlist" type="disc"><li class="listitem"><p>An exception is thrown if the object could not be updated for any
     reason.</p></li></ul></div></div><div class="section" title="F.3.4.&nbsp;openidm.delete(id, rev)"><div class="titlepage"><div><div><h3 class="title"><a name="function-delete"></a>F.3.4.&nbsp;openidm.delete(id, rev)</h3></div></div></div><p>This function deletes a resource object.</p><div class="variablelist" title="Parameters"><div class="variablelist-title">Parameters</div><dl><dt><span class="term">id</span></dt><dd><p>string</p><p>The identifier of the object to be deleted.</p></dd><dt><span class="term">rev</span></dt><dd><p>string</p><p>The revision of the object to be deleted, or <code class="literal">null</code>
      if the object is not subject to revision control.</p></dd></dl></div><div class="itemizedlist" title="Returns"><div class="itemizedlist-title">Returns</div><ul class="itemizedlist" type="disc"><li class="listitem"><p>A <code class="literal">null</code> value if successful.</p></li></ul></div><div class="itemizedlist" title="Throws"><div class="itemizedlist-title">Throws</div><ul class="itemizedlist" type="disc"><li class="listitem"><p>An exception is thrown if the object could not be deleted for any
     reason.</p></li></ul></div></div><div class="section" title="F.3.5.&nbsp;openidm.query(id, params)"><div class="titlepage"><div><div><h3 class="title"><a name="function-query"></a>F.3.5.&nbsp;openidm.query(id, params)</h3></div></div></div><p>This function performs a query on the specified OpenIDM resource
   object.</p><div class="variablelist" title="Parameters"><div class="variablelist-title">Parameters</div><dl><dt><span class="term">id</span></dt><dd><p>string</p><p>The identifier of the object to perform the query on.</p></dd><dt><span class="term">params</span></dt><dd><p>object</p><p>An object containing the parameters to pass to the query.</p></dd></dl></div><div class="itemizedlist" title="Returns"><div class="itemizedlist-title">Returns</div><ul class="itemizedlist" type="disc"><li class="listitem"><p>The result of the query.</p></li></ul></div><div class="itemizedlist" title="Throws"><div class="itemizedlist-title">Throws</div><ul class="itemizedlist" type="disc"><li class="listitem"><p>An exception is thrown if the given query could not be processed for
     any reason.</p></li></ul></div></div><div class="section" title="F.3.6.&nbsp;openidm.action(id, params, value)"><div class="titlepage"><div><div><h3 class="title"><a name="function-action"></a>F.3.6.&nbsp;openidm.action(id, params, value)</h3></div></div></div><p>This function performs an action on the specified OpenIDM resource
   object.</p><div class="variablelist" title="Parameters"><div class="variablelist-title">Parameters</div><dl><dt><span class="term">id</span></dt><dd><p>string</p><p>The identifier of the object to perform the action on.</p></dd><dt><span class="term">params</span></dt><dd><p>object</p><p>An object containing the parameters to pass to the action.</p></dd><dt><span class="term">value</span></dt><dd><p>object</p><p>A value that can be provided to the action for processing.</p></dd></dl></div><div class="itemizedlist" title="Returns"><div class="itemizedlist-title">Returns</div><ul class="itemizedlist" type="disc"><li class="listitem"><p>The result of the action. May be <code class="literal">null</code> if no result
     is provided.</p></li></ul></div><div class="itemizedlist" title="Throws"><div class="itemizedlist-title">Throws</div><ul class="itemizedlist" type="disc"><li class="listitem"><p>An exception is thrown if the given action could not be executed
     for any reason.</p></li></ul></div></div><div class="section" title="F.3.7.&nbsp;openidm.encrypt(value, cipher, alias)"><div class="titlepage"><div><div><h3 class="title"><a name="function-encrypt"></a>F.3.7.&nbsp;openidm.encrypt(value, cipher, alias)</h3></div></div></div><p>This function encrypts a value.</p><div class="variablelist" title="Parameters"><div class="variablelist-title">Parameters</div><dl><dt><span class="term">value</span></dt><dd><p>any</p><p>The value to be encrypted.</p></dd><dt><span class="term">cipher</span></dt><dd><p>string</p><p>The cipher with which to encrypt the value, using the form
      "algorithm/mode/padding" or just "algorithm". Example:
      <code class="literal">AES/ECB/PKCS5Padding</code>.</p></dd><dt><span class="term">alias</span></dt><dd><p>string</p><p>The key alias in the key store with which to encrypt the node.</p></dd></dl></div><div class="itemizedlist" title="Returns"><div class="itemizedlist-title">Returns</div><ul class="itemizedlist" type="disc"><li class="listitem"><p>The value, encrypted with the specified cipher and key.</p></li></ul></div><div class="itemizedlist" title="Throws"><div class="itemizedlist-title">Throws</div><ul class="itemizedlist" type="disc"><li class="listitem"><p>An exception is thrown if the object could not be encrypted for any
     reason.</p></li></ul></div></div><div class="section" title="F.3.8.&nbsp;openidm.decrypt(value)"><div class="titlepage"><div><div><h3 class="title"><a name="function-decrypt"></a>F.3.8.&nbsp;openidm.decrypt(value)</h3></div></div></div><p>This function decrypts a value.</p><div class="variablelist" title="Parameters"><div class="variablelist-title">Parameters</div><dl><dt><span class="term">value</span></dt><dd><p>any</p><p>The value to be decrypted.</p></dd></dl></div><div class="itemizedlist" title="Returns"><div class="itemizedlist-title">Returns</div><ul class="itemizedlist" type="disc"><li class="listitem"><p>A deep copy of the value, with any encrypted value decrypted.</p></li></ul></div><div class="itemizedlist" title="Throws"><div class="itemizedlist-title">Throws</div><ul class="itemizedlist" type="disc"><li class="listitem"><p>An exception is thrown if the object could not be decrypted for any
     reason.</p></li></ul></div></div></div><div class="section" title="F.4.&nbsp;Places to Trigger Scripts"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="script-places"></a>F.4.&nbsp;Places to Trigger Scripts</h2></div></div></div><p>Scripts can be triggered at different places, by different
  events.</p><div class="variablelist"><dl><dt><span class="term">In <code class="filename">openidm/conf/sync.json</code></span></dt><dd><div class="variablelist"><dl><dt><span class="term">Triggered by situation</span></dt><dd><p>onCreate, onUpdate, onDelete, onLink, onUnlink</p></dd><dt><span class="term">Object filter</span></dt><dd><p>vaildSource, validTarget</p></dd><dt><span class="term">Correlating objects</span></dt><dd><p>correlationQuery</p></dd><dt><span class="term">Triggered on any reconciliation</span></dt><dd><p>result</p></dd><dt><span class="term">Scripts inside properties</span></dt><dd><p>condition, transform</p></dd></dl></div></dd><dt><span class="term">In <code class="filename">openidm/conf/managed.json</code></span></dt><dd><p>onRetreive, onValidate</p></dd><dt><span class="term">In <code class="filename">openidm/conf/router.json</code></span></dt><dd><p>onRequest, onResponse</p></dd></dl></div></div><div class="section" title="F.5.&nbsp;Debugging OpenIDM Scripts"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="debugging-scripts"></a>F.5.&nbsp;Debugging OpenIDM Scripts</h2></div></div></div><p>OpenIDM includes Eclipse JSDT libraries so you can use Eclipse to debug
  your OpenIDM scripts during development.</p><div class="procedure" title="Procedure&nbsp;F.1.&nbsp;To Enable Debugging"><a name="enable-debugging"></a><div class="procedure-title">Procedure&nbsp;F.1.&nbsp;To Enable Debugging</div><p>Follow these steps to enable debugging using Eclipse.</p><ol class="procedure" type="1"><li class="step" title="Step 1"><p>Install the environment to support JavaScript development in either
    of the following ways.</p><ul class="stepalternatives">
     <li class="step" title="Step 1.1"><p>Download and install Eclipse IDE for JavaScript Web Developers
      from the <a class="link" href="http://www.eclipse.org/downloads/" target="_blank">Eclipse download page</a>.</p></li>
     <li class="step" title="Step 1.2"><p>Add <a class="link" href="http://wiki.eclipse.org/JSDT" target="_blank">JavaScript Development Tools</a> to your existing
      Eclipse installation.</p></li>
    </ul></li><li class="step" title="Step 2"><p>Create an empty JavaScript project called <code class="literal">External JavaScript
    Source</code> in Eclipse.</p><p>Eclipse then uses the <code class="filename">External JavaScript Source</code>
    directory in the default workspace location to store sources that it
    downloads from OpenIDM.</p></li><li class="step" title="Step 3"><p>Stop OpenIDM.</p></li><li class="step" title="Step 4"><p>Edit <code class="filename">openidm/conf/boot/boot.properties</code> to
    enable debugging.</p><ol type="a" class="substeps"><li class="step" title="Step 4.a"><p>Uncomment and edit the following line.</p><div class="programlisting" width="84">
#openidm.script.javascript.debug=transport=socket,suspend=y,address=9888,trace=true</div><p>Here <code class="literal">suspend=y</code> prevents OpenIDM from starting
      until the remote JavaScript debugger has connected. You might therefore
      choose to set this to <code class="literal">suspend=n</code>.</p></li><li class="step" title="Step 4.b"><p>Uncomment and edit the following line.</p><div class="programlisting" width="81">
#openidm.script.javascript.sources=/Eclipse/workspace/External JavaScript Source/</div><p>Adjust <code class="literal">/Eclipse/workspace/External JavaScript
      Source/</code> to match the absolute path to this folder including the
      trailing <code class="literal">/</code> character. On Windows, also use forward
      slashes, such as <code class="literal">C:/Eclipse/workspace/External JavaScript
      Source/</code>.</p><p>Each time OpenIDM loads a new script, it then creates or overwrites
      the file in the <code class="filename">External JavaScript Source</code> directory.
      Before toggling breakpoints, be sure to refresh the source manually in
      Eclipse so you have the latest version.</p></li></ol></li><li class="step" title="Step 5"><p>Start OpenIDM, and connect the debugger.</p><p>To create a new debug, configuration click Run &gt; Debug
    Configurations... &gt; Remote JavaScript &gt; New button, and then set
    the port to 9888 as shown above.</p></li></ol></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="appendix-rest.html">Prev</a>&nbsp;</td><td width="20%" align="center">&nbsp;</td><td width="40%" align="right">&nbsp;<a accesskey="n" href="appendix-scheduling.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Appendix&nbsp;E.&nbsp;REST API Reference&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="OpenIDM-Integrators-Guide.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Appendix&nbsp;G.&nbsp;Scheduler Reference</td></tr></table></div></body></html>