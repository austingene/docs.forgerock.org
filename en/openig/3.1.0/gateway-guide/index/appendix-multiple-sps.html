<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head>

      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
   <title>Appendix&nbsp;A.&nbsp;SAML 2.0 &amp; Multiple Applications</title><link rel="stylesheet" type="text/css" href="coredoc.css"><link rel="stylesheet" type="text/css" href="css/coredoc.css"><link rel="stylesheet" type="text/css" href="sh/shCore.css"><link rel="stylesheet" type="text/css" href="sh/shCoreEclipse.css"><link rel="stylesheet" type="text/css" href="sh/shThemeEclipse.css"><script src="http://code.jquery.com/jquery-1.11.0.min.js" type="text/javascript"></script><script src="uses-jquery.js" type="text/javascript"></script><script src="sh/shCore.js" type="text/javascript"></script><script src="sh/shBrushAci.js" type="text/javascript"></script><script src="sh/shBrushBash.js" type="text/javascript"></script><script src="sh/shBrushCsv.js" type="text/javascript"></script><script src="sh/shBrushHttp.js" type="text/javascript"></script><script src="sh/shBrushJava.js" type="text/javascript"></script><script src="sh/shBrushJScript.js" type="text/javascript"></script><script src="sh/shBrushLDIF.js" type="text/javascript"></script><script src="sh/shBrushPlain.js" type="text/javascript"></script><script src="sh/shBrushProperties.js" type="text/javascript"></script><script src="sh/shBrushXml.js" type="text/javascript"></script><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="Guide to OpenIG"><link rel="up" href="index.html" title="Guide to OpenIG"><link rel="prev" href="chap-troubleshooting.html" title="Chapter&nbsp;13.&nbsp;Troubleshooting"><link rel="next" href="ix01.html" title="Index"><link rel="copyright" href="legalnotice.html" title="Legal Notice"><script type="text/javascript">SyntaxHighlighter.all();</script>
<link rel="shortcut icon" href="http://forgerock.org/favicon.ico">
</head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Appendix&nbsp;A.&nbsp;SAML 2.0 &amp; Multiple Applications</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="chap-troubleshooting.html">Prev</a>&nbsp;</td><th width="60%" align="center">&nbsp;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="ix01.html">Next</a></td></tr></table><hr></div><div lang="en" class="appendix"><div class="titlepage"><div><div><h1 class="title"><a name="appendix-multiple-sps"></a>Appendix&nbsp;A.&nbsp;SAML 2.0 &amp; Multiple Applications</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="section"><a href="appendix-multiple-sps.html#multisp-before-you-start">A.1. Before You Start</a></span></dt><dt><span class="section"><a href="appendix-multiple-sps.html#multisp-prepare-network">A.2. Preparing the Network</a></span></dt><dt><span class="section"><a href="appendix-multiple-sps.html#multisp-prepare-saml-conf">A.3. Preparing the SAML 2.0 Service Provider Configurations</a></span></dt><dt><span class="section"><a href="appendix-multiple-sps.html#multisp-create-saml-entities">A.4. Importing Service Provider Configurations Into OpenAM</a></span></dt><dt><span class="section"><a href="appendix-multiple-sps.html#multisp-create-gateway-conf">A.5. Preparing Configurations in OpenIG</a></span></dt><dt><span class="section"><a href="appendix-multiple-sps.html#multisp-try-it-out">A.6. Trying It Out</a></span></dt></dl></div><p>
  You can use a single OpenIG server as SAML 2.0 Service Provider
  for multiple protected applications.
 </p><a class="indexterm" name="d0e5105"></a><a class="indexterm" name="d0e5108"></a><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="multisp-before-you-start"></a>A.1.&nbsp;Before You Start</h2></div></div></div><p>
   Before you try the samples described here,
   familiarize yourself with OpenIG SAML 2.0 support
   by reading the chapter,
   <a href="../../gateway-guide/index/chap-federation.html" class="link"><em class="citetitle">OpenIG as a SAML 2.0 Service Provider</em></a>,
   and working through the tutorial in that chapter.
  </p><p>
   Also make sure you understand the principles
   for configuring SAML 2.0 entities in OpenAM.
   The preparation for handling multiple applications
   involves editing the SAML 2.0 Service Provider configurations
   based on the original Fedlet configuration,
   and then importing the new configurations as SAML 2.0 entities in OpenAM.
  </p><p>
   At this point, you should have OpenIG
   protecting the sample application as SAML 2.0 Service Provider,
   with OpenAM working as Identity Provider
   configured as described in the tutorial.
  </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="multisp-prepare-network"></a>A.2.&nbsp;Preparing the Network</h2></div></div></div><p>
   You must configure the network so that
   browser traffic to the application hosts is proxied through OpenIG.
  </p><p>
   Modify DNS or host file settings so that
   the hosts name of the protected applications resolve
   to the IP address of OpenIG on the system where the browser runs.
   Restart the browser as necessary to take the changes into account.
  </p><p>
   The examples that follow use host names
   <code class="literal">sp.one.example</code> and <code class="literal">sp.two.example</code>.
   To try the examples on your computer,
   you can edit the host file settings to add these to the loopback address.
  </p><pre class="brush: plain;">
127.0.0.1    localhost www.example.com sp.one.example sp.two.example
  </pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="multisp-prepare-saml-conf"></a>A.3.&nbsp;Preparing the SAML 2.0 Service Provider Configurations</h2></div></div></div><p>
   Based on the original Fedlet configuration,
   you add configuration for each new protected application.
  </p><p>
   In the following examples,
   the first application runs on host <code class="literal">sp.one.example</code>.
   The examples assign the entity ID <code class="literal">One</code> to this application,
   and use the metaAlias <code class="literal">/sp1</code> in the SAML configuration.
   The second application runs on <code class="literal">sp.two.example</code>
   with entity ID <code class="literal">Two</code> and metaAlias <code class="literal">/sp2</code>.
  </p><p>
   Edit the <code class="filename">SAML/fedlet.cot</code> file
   to include the entity IDs as in the following example.
  </p><pre class="brush: ini;">
cot-name=Circle of Trust
sun-fm-cot-status=Active
sun-fm-trusted-providers=http://openam.example.com:8088/openam,${projectName},One,Two
sun-fm-saml2-readerservice-url=
sun-fm-saml2-writerservice-url=

  </pre><p>
   For each application, make copies of the SAML configuration files
   <code class="filename">sp.xml</code> and <code class="filename">sp-extended.xml</code>.
   Edit the copy of <code class="filename">sp.xml</code> for the application so that
   the entity ID matches the application,
   the Location and ResponseLocation attributes reflect those of the application,
   and the AssertionConsumerService Location attributes include the metaAlias.
  </p><div class="example"><a name="multisp-sp1"></a><div class="example-title">Example&nbsp;A.1.&nbsp;Service Provider Configuration for Application One</div><div class="example-contents"><pre class="brush: xml;">
&lt;!--
  Set the entityID and edit *Location attributes to match the service provider.
  Note that AssertionConsumerService Location attributes include the metaAlias.
--&gt;
&lt;EntityDescriptor
  entityID="One"
  xmlns="urn:oasis:names:tc:SAML:2.0:metadata"&gt;
  &lt;SPSSODescriptor
    AuthnRequestsSigned="false"
    WantAssertionsSigned="false"
    protocolSupportEnumeration="urn:oasis:names:tc:SAML:2.0:protocol"&gt;
    &lt;SingleLogoutService
      Binding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect"
      Location="http://sp.one.example:8080/saml/fedletSloRedirect"
      ResponseLocation="http://sp.one.example:8080/saml/fedletSloRedirect"/&gt;
    &lt;SingleLogoutService
      Binding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST"
      Location="http://sp.one.example:8080/saml/fedletSloPOST"
      ResponseLocation="http://sp.one.example:8080/saml/fedletSloPOST"/&gt;
    &lt;SingleLogoutService
      Binding="urn:oasis:names:tc:SAML:2.0:bindings:SOAP"
      Location="http://sp.one.example:8080/saml/fedletSloSoap"/&gt;
    &lt;NameIDFormat&gt;urn:oasis:names:tc:SAML:2.0:nameid-format:transient&lt;/NameIDFormat&gt;
    &lt;AssertionConsumerService
      isDefault="true"
      index="0"
      Binding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST"
      Location="http://sp.one.example:8080/saml/fedletapplication/metaAlias/sp1"/&gt;
    &lt;AssertionConsumerService
      index="1"
      Binding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Artifact"
      Location="http://sp.one.example:8080/saml/fedletapplication/metaAlias/sp1"/&gt;
  &lt;/SPSSODescriptor&gt;
  &lt;RoleDescriptor
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:query="urn:oasis:names:tc:SAML:metadata:ext:query"
    xsi:type="query:AttributeQueryDescriptorType"
    protocolSupportEnumeration="urn:oasis:names:tc:SAML:2.0:protocol"&gt;
  &lt;/RoleDescriptor&gt;
  &lt;XACMLAuthzDecisionQueryDescriptor
    WantAssertionsSigned="false"
    protocolSupportEnumeration="urn:oasis:names:tc:SAML:2.0:protocol"&gt;
  &lt;/XACMLAuthzDecisionQueryDescriptor&gt;
&lt;/EntityDescriptor&gt;

   </pre></div></div><br class="example-break"><div class="example"><a name="multisp-sp2"></a><div class="example-title">Example&nbsp;A.2.&nbsp;Service Provider Configuration for Application Two</div><div class="example-contents"><pre class="brush: xml;">
&lt;!--
  Set the entityID and edit *Location attributes to match the service provider.
  Note that AssertionConsumerService Location attributes include the metaAlias.
--&gt;
&lt;EntityDescriptor
  entityID="Two"
  xmlns="urn:oasis:names:tc:SAML:2.0:metadata"&gt;
  &lt;SPSSODescriptor
    AuthnRequestsSigned="false"
    WantAssertionsSigned="false"
    protocolSupportEnumeration="urn:oasis:names:tc:SAML:2.0:protocol"&gt;
    &lt;SingleLogoutService
      Binding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect"
      Location="http://sp.two.example:8080/saml/fedletSloRedirect"
      ResponseLocation="http://sp.two.example:8080/saml/fedletSloRedirect"/&gt;
    &lt;SingleLogoutService
      Binding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST"
      Location="http://sp.two.example:8080/saml/fedletSloPOST"
      ResponseLocation="http://sp.two.example:8080/saml/fedletSloPOST"/&gt;
    &lt;SingleLogoutService
      Binding="urn:oasis:names:tc:SAML:2.0:bindings:SOAP"
      Location="http://sp.two.example:8080/saml/fedletSloSoap"/&gt;
    &lt;NameIDFormat&gt;urn:oasis:names:tc:SAML:2.0:nameid-format:transient&lt;/NameIDFormat&gt;
    &lt;AssertionConsumerService
      isDefault="true"
      index="0"
      Binding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST"
      Location="http://sp.two.example:8080/saml/fedletapplication/metaAlias/sp2"/&gt;
    &lt;AssertionConsumerService
      index="1"
      Binding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Artifact"
      Location="http://sp.two.example:8080/saml/fedletapplication/metaAlias/sp2"/&gt;
  &lt;/SPSSODescriptor&gt;
  &lt;RoleDescriptor
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:query="urn:oasis:names:tc:SAML:metadata:ext:query"
    xsi:type="query:AttributeQueryDescriptorType"
    protocolSupportEnumeration="urn:oasis:names:tc:SAML:2.0:protocol"&gt;
  &lt;/RoleDescriptor&gt;
  &lt;XACMLAuthzDecisionQueryDescriptor
    WantAssertionsSigned="false"
    protocolSupportEnumeration="urn:oasis:names:tc:SAML:2.0:protocol"&gt;
  &lt;/XACMLAuthzDecisionQueryDescriptor&gt;
&lt;/EntityDescriptor&gt;

   </pre></div></div><br class="example-break"><p>
   Edit the copy of <code class="filename">sp-extended.xml</code> for the application
   so that the entity ID matches the application,
   and the metaAlias and appLogoutUrl are correctly set.
  </p><div class="example"><a name="multisp-sp1-extended"></a><div class="example-title">Example&nbsp;A.3.&nbsp;Service Provider Extended Configuration for Application One</div><div class="example-contents"><pre class="brush: xml;">
&lt;!--
  Set the entityID and edit the SPSSOConfig metaAlias attribute.
  Also set the value of appLogoutUrl.
--&gt;
&lt;EntityConfig xmlns="urn:sun:fm:SAML:2.0:entityconfig"
    xmlns:fm="urn:sun:fm:SAML:2.0:entityconfig"
    hosted="1"
    entityID="One"&gt;

    &lt;SPSSOConfig metaAlias="/sp1"&gt;
        &lt;Attribute name="description"&gt;
            &lt;Value&gt;&lt;/Value&gt;
        &lt;/Attribute&gt;
        &lt;Attribute name="signingCertAlias"&gt;
            &lt;Value&gt;&lt;/Value&gt;
        &lt;/Attribute&gt;
        &lt;Attribute name="encryptionCertAlias"&gt;
            &lt;Value&gt;&lt;/Value&gt;
        &lt;/Attribute&gt;
        &lt;Attribute name="basicAuthOn"&gt;
            &lt;Value&gt;false&lt;/Value&gt;
        &lt;/Attribute&gt;
        &lt;Attribute name="basicAuthUser"&gt;
            &lt;Value&gt;&lt;/Value&gt;
        &lt;/Attribute&gt;
        &lt;Attribute name="basicAuthPassword"&gt;
            &lt;Value&gt;&lt;/Value&gt;
        &lt;/Attribute&gt;
        &lt;Attribute name="autofedEnabled"&gt;
            &lt;Value&gt;false&lt;/Value&gt;
        &lt;/Attribute&gt;
        &lt;Attribute name="autofedAttribute"&gt;
            &lt;Value&gt;&lt;/Value&gt;
        &lt;/Attribute&gt;
        &lt;Attribute name="transientUser"&gt;
            &lt;Value&gt;anonymous&lt;/Value&gt;
        &lt;/Attribute&gt;
        &lt;Attribute name="spAdapter"&gt;
            &lt;Value&gt;&lt;/Value&gt;
        &lt;/Attribute&gt;
        &lt;Attribute name="spAdapterEnv"&gt;
            &lt;Value&gt;&lt;/Value&gt;
        &lt;/Attribute&gt;
        &lt;Attribute name="fedletAdapter"&gt;
            &lt;Value&gt;com.sun.identity.saml2.plugins.DefaultFedletAdapter&lt;/Value&gt;
        &lt;/Attribute&gt;
        &lt;Attribute name="fedletAdapterEnv"&gt;
            &lt;Value&gt;&lt;/Value&gt;
        &lt;/Attribute&gt;
        &lt;Attribute name="spAccountMapper"&gt;
            &lt;Value&gt;com.sun.identity.saml2.plugins.DefaultLibrarySPAccountMapper&lt;/Value&gt;
        &lt;/Attribute&gt;
        &lt;Attribute name="useNameIDAsSPUserID"&gt;
            &lt;Value&gt;false&lt;/Value&gt;
        &lt;/Attribute&gt;
        &lt;Attribute name="spAttributeMapper"&gt;
            &lt;Value&gt;com.sun.identity.saml2.plugins.DefaultSPAttributeMapper&lt;/Value&gt;
        &lt;/Attribute&gt;
        &lt;Attribute name="spAuthncontextMapper"&gt;
            &lt;Value&gt;com.sun.identity.saml2.plugins.DefaultSPAuthnContextMapper&lt;/Value&gt;
        &lt;/Attribute&gt;
        &lt;Attribute name="spAuthncontextClassrefMapping"&gt;
            &lt;Value&gt;
            urn:oasis:names:tc:SAML:2.0:ac:classes:PasswordProtectedTransport|0|default
            &lt;/Value&gt;
        &lt;/Attribute&gt;
        &lt;Attribute name="spAuthncontextComparisonType"&gt;
           &lt;Value&gt;exact&lt;/Value&gt;
        &lt;/Attribute&gt;
        &lt;Attribute name="attributeMap"&gt;
           &lt;Value&gt;employeenumber=employeenumber&lt;/Value&gt;
           &lt;Value&gt;mail=mail&lt;/Value&gt;
        &lt;/Attribute&gt;
        &lt;Attribute name="saml2AuthModuleName"&gt;
           &lt;Value&gt;&lt;/Value&gt;
       &lt;/Attribute&gt;
       &lt;Attribute name="localAuthURL"&gt;
           &lt;Value&gt;&lt;/Value&gt;
       &lt;/Attribute&gt;
       &lt;Attribute name="intermediateUrl"&gt;
           &lt;Value&gt;&lt;/Value&gt;
       &lt;/Attribute&gt;
       &lt;Attribute name="defaultRelayState"&gt;
           &lt;Value&gt;&lt;/Value&gt;
       &lt;/Attribute&gt;
       &lt;Attribute name="appLogoutUrl"&gt;
           &lt;Value&gt;http://sp.one.example:8080/saml/logout&lt;/Value&gt;
       &lt;/Attribute&gt;
       &lt;Attribute name="assertionTimeSkew"&gt;
           &lt;Value&gt;300&lt;/Value&gt;
       &lt;/Attribute&gt;
       &lt;Attribute name="wantAttributeEncrypted"&gt;
           &lt;Value&gt;&lt;/Value&gt;
       &lt;/Attribute&gt;
       &lt;Attribute name="wantAssertionEncrypted"&gt;
           &lt;Value&gt;&lt;/Value&gt;
       &lt;/Attribute&gt;
       &lt;Attribute name="wantNameIDEncrypted"&gt;
           &lt;Value&gt;&lt;/Value&gt;
       &lt;/Attribute&gt;
       &lt;Attribute name="wantPOSTResponseSigned"&gt;
           &lt;Value&gt;&lt;/Value&gt;
       &lt;/Attribute&gt;
       &lt;Attribute name="wantArtifactResponseSigned"&gt;
           &lt;Value&gt;&lt;/Value&gt;
       &lt;/Attribute&gt;
       &lt;Attribute name="wantLogoutRequestSigned"&gt;
           &lt;Value&gt;&lt;/Value&gt;
       &lt;/Attribute&gt;
       &lt;Attribute name="wantLogoutResponseSigned"&gt;
           &lt;Value&gt;&lt;/Value&gt;
       &lt;/Attribute&gt;
       &lt;Attribute name="wantMNIRequestSigned"&gt;
           &lt;Value&gt;&lt;/Value&gt;
       &lt;/Attribute&gt;
       &lt;Attribute name="wantMNIResponseSigned"&gt;
           &lt;Value&gt;&lt;/Value&gt;
       &lt;/Attribute&gt;
       &lt;Attribute name="responseArtifactMessageEncoding"&gt;
           &lt;Value&gt;URI&lt;/Value&gt;
       &lt;/Attribute&gt;
       &lt;Attribute name="cotlist"&gt;
       &lt;Value&gt;Circle of Trust&lt;/Value&gt;&lt;/Attribute&gt;
       &lt;Attribute name="saeAppSecretList"&gt;
       &lt;/Attribute&gt;
       &lt;Attribute name="saeSPUrl"&gt;
           &lt;Value&gt;&lt;/Value&gt;
       &lt;/Attribute&gt;
       &lt;Attribute name="saeSPLogoutUrl"&gt;
       &lt;/Attribute&gt;
       &lt;Attribute name="ECPRequestIDPListFinderImpl"&gt;
           &lt;Value&gt;com.sun.identity.saml2.plugins.ECPIDPFinder&lt;/Value&gt;
       &lt;/Attribute&gt;
       &lt;Attribute name="ECPRequestIDPList"&gt;
           &lt;Value&gt;&lt;/Value&gt;
       &lt;/Attribute&gt;
       &lt;Attribute name="ECPRequestIDPListGetComplete"&gt;
           &lt;Value&gt;&lt;/Value&gt;
       &lt;/Attribute&gt;
       &lt;Attribute name="enableIDPProxy"&gt;
           &lt;Value&gt;false&lt;/Value&gt;
       &lt;/Attribute&gt;
       &lt;Attribute name="idpProxyList"&gt;
           &lt;Value&gt;&lt;/Value&gt;
       &lt;/Attribute&gt;
       &lt;Attribute name="idpProxyCount"&gt;
           &lt;Value&gt;0&lt;/Value&gt;
       &lt;/Attribute&gt;
       &lt;Attribute name="useIntroductionForIDPProxy"&gt;
           &lt;Value&gt;false&lt;/Value&gt;
       &lt;/Attribute&gt;
       &lt;Attribute name="spSessionSyncEnabled"&gt;
           &lt;Value&gt;false&lt;/Value&gt;
       &lt;/Attribute&gt;
        &lt;Attribute name="relayStateUrlList"&gt;
        &lt;/Attribute&gt;
    &lt;/SPSSOConfig&gt;
    &lt;AttributeQueryConfig metaAlias="/attrQuery"&gt;
        &lt;Attribute name="signingCertAlias"&gt;
            &lt;Value&gt;&lt;/Value&gt;
        &lt;/Attribute&gt;
        &lt;Attribute name="encryptionCertAlias"&gt;
            &lt;Value&gt;&lt;/Value&gt;
        &lt;/Attribute&gt;
        &lt;Attribute name="wantNameIDEncrypted"&gt;
            &lt;Value&gt;&lt;/Value&gt;
        &lt;/Attribute&gt;
        &lt;Attribute name="cotlist"&gt;
            &lt;Value&gt;Circle of Trust&lt;/Value&gt;
        &lt;/Attribute&gt;
    &lt;/AttributeQueryConfig&gt;
    &lt;XACMLAuthzDecisionQueryConfig metaAlias="/pep"&gt;
        &lt;Attribute name="signingCertAlias"&gt;
            &lt;Value&gt;&lt;/Value&gt;
        &lt;/Attribute&gt;
        &lt;Attribute name="encryptionCertAlias"&gt;
            &lt;Value&gt;&lt;/Value&gt;
        &lt;/Attribute&gt;
        &lt;Attribute name="basicAuthOn"&gt;
            &lt;Value&gt;false&lt;/Value&gt;
        &lt;/Attribute&gt;
        &lt;Attribute name="basicAuthUser"&gt;
            &lt;Value&gt;&lt;/Value&gt;
        &lt;/Attribute&gt;
        &lt;Attribute name="basicAuthPassword"&gt;
            &lt;Value&gt;&lt;/Value&gt;
        &lt;/Attribute&gt;
        &lt;Attribute name="wantXACMLAuthzDecisionResponseSigned"&gt;
            &lt;Value&gt;false&lt;/Value&gt;
        &lt;/Attribute&gt;
        &lt;Attribute name="wantAssertionEncrypted"&gt;
            &lt;Value&gt;false&lt;/Value&gt;
        &lt;/Attribute&gt;
        &lt;Attribute name="cotlist"&gt;
            &lt;Value&gt;Circle of Trust&lt;/Value&gt;
        &lt;/Attribute&gt;
    &lt;/XACMLAuthzDecisionQueryConfig&gt;
&lt;/EntityConfig&gt;

   </pre></div></div><br class="example-break"><div class="example"><a name="multisp-sp2-extended"></a><div class="example-title">Example&nbsp;A.4.&nbsp;Service Provider Extended Configuration for Application Two</div><div class="example-contents"><pre class="brush: xml;">
&lt;!--
  Set the entityID and edit the SPSSOConfig metaAlias attribute.
  Also set the value of appLogoutUrl.
--&gt;
&lt;EntityConfig xmlns="urn:sun:fm:SAML:2.0:entityconfig"
    xmlns:fm="urn:sun:fm:SAML:2.0:entityconfig"
    hosted="1"
    entityID="Two"&gt;

    &lt;SPSSOConfig metaAlias="/sp2"&gt;
        &lt;Attribute name="description"&gt;
            &lt;Value&gt;&lt;/Value&gt;
        &lt;/Attribute&gt;
        &lt;Attribute name="signingCertAlias"&gt;
            &lt;Value&gt;&lt;/Value&gt;
        &lt;/Attribute&gt;
        &lt;Attribute name="encryptionCertAlias"&gt;
            &lt;Value&gt;&lt;/Value&gt;
        &lt;/Attribute&gt;
        &lt;Attribute name="basicAuthOn"&gt;
            &lt;Value&gt;false&lt;/Value&gt;
        &lt;/Attribute&gt;
        &lt;Attribute name="basicAuthUser"&gt;
            &lt;Value&gt;&lt;/Value&gt;
        &lt;/Attribute&gt;
        &lt;Attribute name="basicAuthPassword"&gt;
            &lt;Value&gt;&lt;/Value&gt;
        &lt;/Attribute&gt;
        &lt;Attribute name="autofedEnabled"&gt;
            &lt;Value&gt;false&lt;/Value&gt;
        &lt;/Attribute&gt;
        &lt;Attribute name="autofedAttribute"&gt;
            &lt;Value&gt;&lt;/Value&gt;
        &lt;/Attribute&gt;
        &lt;Attribute name="transientUser"&gt;
            &lt;Value&gt;anonymous&lt;/Value&gt;
        &lt;/Attribute&gt;
        &lt;Attribute name="spAdapter"&gt;
            &lt;Value&gt;&lt;/Value&gt;
        &lt;/Attribute&gt;
        &lt;Attribute name="spAdapterEnv"&gt;
            &lt;Value&gt;&lt;/Value&gt;
        &lt;/Attribute&gt;
        &lt;Attribute name="fedletAdapter"&gt;
            &lt;Value&gt;com.sun.identity.saml2.plugins.DefaultFedletAdapter&lt;/Value&gt;
        &lt;/Attribute&gt;
        &lt;Attribute name="fedletAdapterEnv"&gt;
            &lt;Value&gt;&lt;/Value&gt;
        &lt;/Attribute&gt;
        &lt;Attribute name="spAccountMapper"&gt;
            &lt;Value&gt;com.sun.identity.saml2.plugins.DefaultLibrarySPAccountMapper&lt;/Value&gt;
        &lt;/Attribute&gt;
        &lt;Attribute name="useNameIDAsSPUserID"&gt;
            &lt;Value&gt;false&lt;/Value&gt;
        &lt;/Attribute&gt;
        &lt;Attribute name="spAttributeMapper"&gt;
            &lt;Value&gt;com.sun.identity.saml2.plugins.DefaultSPAttributeMapper&lt;/Value&gt;
        &lt;/Attribute&gt;
        &lt;Attribute name="spAuthncontextMapper"&gt;
            &lt;Value&gt;com.sun.identity.saml2.plugins.DefaultSPAuthnContextMapper&lt;/Value&gt;
        &lt;/Attribute&gt;
        &lt;Attribute name="spAuthncontextClassrefMapping"&gt;
            &lt;Value&gt;
            urn:oasis:names:tc:SAML:2.0:ac:classes:PasswordProtectedTransport|0|default
            &lt;/Value&gt;
        &lt;/Attribute&gt;
        &lt;Attribute name="spAuthncontextComparisonType"&gt;
           &lt;Value&gt;exact&lt;/Value&gt;
        &lt;/Attribute&gt;
        &lt;Attribute name="attributeMap"&gt;
           &lt;Value&gt;employeenumber=employeenumber&lt;/Value&gt;
           &lt;Value&gt;mail=mail&lt;/Value&gt;
        &lt;/Attribute&gt;
        &lt;Attribute name="saml2AuthModuleName"&gt;
           &lt;Value&gt;&lt;/Value&gt;
       &lt;/Attribute&gt;
       &lt;Attribute name="localAuthURL"&gt;
           &lt;Value&gt;&lt;/Value&gt;
       &lt;/Attribute&gt;
       &lt;Attribute name="intermediateUrl"&gt;
           &lt;Value&gt;&lt;/Value&gt;
       &lt;/Attribute&gt;
       &lt;Attribute name="defaultRelayState"&gt;
           &lt;Value&gt;&lt;/Value&gt;
       &lt;/Attribute&gt;
       &lt;Attribute name="appLogoutUrl"&gt;
           &lt;Value&gt;http://sp.two.example:8080/saml/logout&lt;/Value&gt;
       &lt;/Attribute&gt;
       &lt;Attribute name="assertionTimeSkew"&gt;
           &lt;Value&gt;300&lt;/Value&gt;
       &lt;/Attribute&gt;
       &lt;Attribute name="wantAttributeEncrypted"&gt;
           &lt;Value&gt;&lt;/Value&gt;
       &lt;/Attribute&gt;
       &lt;Attribute name="wantAssertionEncrypted"&gt;
           &lt;Value&gt;&lt;/Value&gt;
       &lt;/Attribute&gt;
       &lt;Attribute name="wantNameIDEncrypted"&gt;
           &lt;Value&gt;&lt;/Value&gt;
       &lt;/Attribute&gt;
       &lt;Attribute name="wantPOSTResponseSigned"&gt;
           &lt;Value&gt;&lt;/Value&gt;
       &lt;/Attribute&gt;
       &lt;Attribute name="wantArtifactResponseSigned"&gt;
           &lt;Value&gt;&lt;/Value&gt;
       &lt;/Attribute&gt;
       &lt;Attribute name="wantLogoutRequestSigned"&gt;
           &lt;Value&gt;&lt;/Value&gt;
       &lt;/Attribute&gt;
       &lt;Attribute name="wantLogoutResponseSigned"&gt;
           &lt;Value&gt;&lt;/Value&gt;
       &lt;/Attribute&gt;
       &lt;Attribute name="wantMNIRequestSigned"&gt;
           &lt;Value&gt;&lt;/Value&gt;
       &lt;/Attribute&gt;
       &lt;Attribute name="wantMNIResponseSigned"&gt;
           &lt;Value&gt;&lt;/Value&gt;
       &lt;/Attribute&gt;
       &lt;Attribute name="responseArtifactMessageEncoding"&gt;
           &lt;Value&gt;URI&lt;/Value&gt;
       &lt;/Attribute&gt;
       &lt;Attribute name="cotlist"&gt;
       &lt;Value&gt;Circle of Trust&lt;/Value&gt;&lt;/Attribute&gt;
       &lt;Attribute name="saeAppSecretList"&gt;
       &lt;/Attribute&gt;
       &lt;Attribute name="saeSPUrl"&gt;
           &lt;Value&gt;&lt;/Value&gt;
       &lt;/Attribute&gt;
       &lt;Attribute name="saeSPLogoutUrl"&gt;
       &lt;/Attribute&gt;
       &lt;Attribute name="ECPRequestIDPListFinderImpl"&gt;
           &lt;Value&gt;com.sun.identity.saml2.plugins.ECPIDPFinder&lt;/Value&gt;
       &lt;/Attribute&gt;
       &lt;Attribute name="ECPRequestIDPList"&gt;
           &lt;Value&gt;&lt;/Value&gt;
       &lt;/Attribute&gt;
       &lt;Attribute name="ECPRequestIDPListGetComplete"&gt;
           &lt;Value&gt;&lt;/Value&gt;
       &lt;/Attribute&gt;
       &lt;Attribute name="enableIDPProxy"&gt;
           &lt;Value&gt;false&lt;/Value&gt;
       &lt;/Attribute&gt;
       &lt;Attribute name="idpProxyList"&gt;
           &lt;Value&gt;&lt;/Value&gt;
       &lt;/Attribute&gt;
       &lt;Attribute name="idpProxyCount"&gt;
           &lt;Value&gt;0&lt;/Value&gt;
       &lt;/Attribute&gt;
       &lt;Attribute name="useIntroductionForIDPProxy"&gt;
           &lt;Value&gt;false&lt;/Value&gt;
       &lt;/Attribute&gt;
       &lt;Attribute name="spSessionSyncEnabled"&gt;
           &lt;Value&gt;false&lt;/Value&gt;
       &lt;/Attribute&gt;
        &lt;Attribute name="relayStateUrlList"&gt;
        &lt;/Attribute&gt;
    &lt;/SPSSOConfig&gt;
    &lt;AttributeQueryConfig metaAlias="/attrQuery"&gt;
        &lt;Attribute name="signingCertAlias"&gt;
            &lt;Value&gt;&lt;/Value&gt;
        &lt;/Attribute&gt;
        &lt;Attribute name="encryptionCertAlias"&gt;
            &lt;Value&gt;&lt;/Value&gt;
        &lt;/Attribute&gt;
        &lt;Attribute name="wantNameIDEncrypted"&gt;
            &lt;Value&gt;&lt;/Value&gt;
        &lt;/Attribute&gt;
        &lt;Attribute name="cotlist"&gt;
            &lt;Value&gt;Circle of Trust&lt;/Value&gt;
        &lt;/Attribute&gt;
    &lt;/AttributeQueryConfig&gt;
    &lt;XACMLAuthzDecisionQueryConfig metaAlias="/pep"&gt;
        &lt;Attribute name="signingCertAlias"&gt;
            &lt;Value&gt;&lt;/Value&gt;
        &lt;/Attribute&gt;
        &lt;Attribute name="encryptionCertAlias"&gt;
            &lt;Value&gt;&lt;/Value&gt;
        &lt;/Attribute&gt;
        &lt;Attribute name="basicAuthOn"&gt;
            &lt;Value&gt;false&lt;/Value&gt;
        &lt;/Attribute&gt;
        &lt;Attribute name="basicAuthUser"&gt;
            &lt;Value&gt;&lt;/Value&gt;
        &lt;/Attribute&gt;
        &lt;Attribute name="basicAuthPassword"&gt;
            &lt;Value&gt;&lt;/Value&gt;
        &lt;/Attribute&gt;
        &lt;Attribute name="wantXACMLAuthzDecisionResponseSigned"&gt;
            &lt;Value&gt;false&lt;/Value&gt;
        &lt;/Attribute&gt;
        &lt;Attribute name="wantAssertionEncrypted"&gt;
            &lt;Value&gt;false&lt;/Value&gt;
        &lt;/Attribute&gt;
        &lt;Attribute name="cotlist"&gt;
            &lt;Value&gt;Circle of Trust&lt;/Value&gt;
        &lt;/Attribute&gt;
    &lt;/XACMLAuthzDecisionQueryConfig&gt;
&lt;/EntityConfig&gt;

   </pre></div></div><br class="example-break"><p>
   For each of the service provider extended configuration files,
   prepare a copy for use when importing the configuration into OpenAM.
   The only change to make in each copy is to set <code class="literal">hosted="0"</code>,
   so that when you import the configuration into OpenAM,
   OpenAM considers it that of a <span class="emphasis"><em>remote</em></span> service provider.
  </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="multisp-create-saml-entities"></a>A.4.&nbsp;Importing Service Provider Configurations Into OpenAM</h2></div></div></div><p>
   For each new protected application, import a SAML 2.0 entity into OpenAM.
  </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
     Login to OpenAM console as global administrator (<code class="literal">amadmin</code>).
    </p></li><li class="listitem"><p>
     On the Federation tab &gt; Entity Providers table, click Import Entity.
    </p></li><li class="listitem"><p>
     Import the entity using the metadata from the edited copies of
     <code class="filename">sp.xml</code> and <code class="filename">sp-extended.xml</code>,
     where the copy of <code class="filename">sp-extended.xml</code>
     has <code class="literal">hosted="0"</code>.
    </p><p>
     The service provider configurations should have
     Location <code class="literal">Remote</code> in the Entity Providers table.
    </p></li><li class="listitem"><p>
     Log out of OpenAM Console.
    </p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="multisp-create-gateway-conf"></a>A.5.&nbsp;Preparing Configurations in OpenIG</h2></div></div></div><p>
   For each new protected application, prepare a OpenIG configuration.
   The configurations in this section follow the example in the chapter,
   <a href="../../gateway-guide/index/chap-federation.html" class="link"><em class="citetitle">OpenIG as a SAML 2.0 Service Provider</em></a>.
  </p><p>
   Before editing route configurations for the protected applications,
   configure a top-level router that does not rebase the incoming URLs,
   such as the following <code class="filename">config.json</code>.
   This differs from the example used in earlier tutorials.
  </p><pre class="brush: javascript;">
{
    "handler": {
        "type": "Router"
    },
    "heap": [
        {
            "name": "LogSink",
            "type": "ConsoleLogSink",
            "config": {
                "level": "DEBUG"
            }
        },
        {
            "name": "ClientHandler",
            "type": "ClientHandler"
        },
        {
            "name": "capture",
            "type": "CaptureDecorator",
            "config": {
                "captureEntity": true,
                "captureExchange": true
            }
        }
    ]
}

  </pre><p>
   Also restart OpenIG to put all configuration changes into effect.
  </p><p>
   For each application set up a pair of routes,
   one to handle redirection for SAML authentication and login to the application,
   the other to act as the SAML 2.0 assertion consumer
   that maps attributes from the SAML assertion into the exchange
   and redirects back to the first route.
  </p><p>
   The following examples show the routes for application One.
  </p><div class="example"><a name="multisp-sp1-route"></a><div class="example-title">Example&nbsp;A.5.&nbsp;Route for SAML Authentication &amp; Login: Application One</div><div class="example-contents"><pre class="brush: javascript;">
{
    "handler": {
        "type": "DispatchHandler",
        "config": {
            "bindings": [
                {
                    "condition": "${empty exchange.session.sp1Username}",
                    "handler": {
                        "type": "StaticResponseHandler",
                        "config": {
                            "status": 302,
                            "reason": "Found",
                            "headers": {
                                "Location": [
                                    "http://sp.one.example:8080/saml/SPInitiatedSSO?metaAlias=/sp1"
                                ]
                            }
                        }
                    },
                    "baseURI": "http://sp.one.example:8081"
                },
                {
                    "handler": {
                        "type": "Chain",
                        "config": {
                            "filters": [
                                {
                                    "type": "StaticRequestFilter",
                                    "config": {
                                        "method": "POST",
                                        "uri": "http://sp.one.example:8081",
                                        "form": {
                                            "username": [
                                                "${exchange.session.sp1Username}"
                                            ],
                                            "password": [
                                                "${exchange.session.sp1Password}"
                                            ]
                                        }
                                    }
                                }
                            ],
                            "handler": "ClientHandler"
                        }
                    },
                    "baseURI": "http://sp.one.example:8081"
                }
            ]
        }
    },
    "condition": "${matches(exchange.request.uri.host, 'sp.one.example')}"
}

   </pre></div></div><br class="example-break"><div class="example"><a name="multisp-sp1-saml-route"></a><div class="example-title">Example&nbsp;A.6.&nbsp;SAML Assertion Consumer: Application One</div><div class="example-contents"><pre class="brush: javascript;">
{
    "handler": {
        "type": "SamlFederationHandler",
        "config": {
            "comment": "Use unique session properties for this SP.",
            "assertionMapping": {
                "sp1Username": "mail",
                "sp1Password": "employeenumber"
            },
            "authnContext": "sp1AuthnContext",
            "sessionIndexMapping": "sp1SessionIndex",
            "subjectMapping": "sp1SubjectName",
            "redirectURI": "/sp1"
        }
    },
    "condition": "${matches(exchange.request.uri.host, 'sp.one.example')
                    and matches(exchange.request.uri.path, '^/saml')}"
}

   </pre></div></div><br class="example-break"><p>
   The following examples show the routes for application Two.
  </p><div class="example"><a name="multisp-sp2-route"></a><div class="example-title">Example&nbsp;A.7.&nbsp;Route for SAML Authentication &amp; Login: Application Two</div><div class="example-contents"><pre class="brush: javascript;">
{
    "handler": {
        "type": "DispatchHandler",
        "config": {
            "bindings": [
                {
                    "condition": "${empty exchange.session.sp2Username}",
                    "handler": {
                        "type": "StaticResponseHandler",
                        "config": {
                            "status": 302,
                            "reason": "Found",
                            "headers": {
                                "Location": [
                                    "http://sp.two.example:8080/saml/SPInitiatedSSO?metaAlias=/sp2"
                                ]
                            }
                        }
                    },
                    "baseURI": "http://sp.two.example:8081"
                },
                {
                    "handler": {
                        "type": "Chain",
                        "config": {
                            "filters": [
                                {
                                    "type": "StaticRequestFilter",
                                    "config": {
                                        "method": "POST",
                                        "uri": "http://sp.two.example:8081",
                                        "form": {
                                            "username": [
                                                "${exchange.session.sp2Username}"
                                            ],
                                            "password": [
                                                "${exchange.session.sp2Password}"
                                            ]
                                        }
                                    }
                                }
                            ],
                            "handler": "ClientHandler"
                        }
                    },
                    "baseURI": "http://sp.two.example:8081"
                }
            ]
        }
    },
    "condition": "${matches(exchange.request.uri.host, 'sp.two.example')}"
}

   </pre></div></div><br class="example-break"><div class="example"><a name="multisp-sp2-saml-route"></a><div class="example-title">Example&nbsp;A.8.&nbsp;SAML Assertion Consumer: Application Two</div><div class="example-contents"><pre class="brush: javascript;">
{
    "handler": {
        "type": "SamlFederationHandler",
        "config": {
            "comment": "Use unique session properties for this SP.",
            "assertionMapping": {
                "sp2Username": "mail",
                "sp2Password": "employeenumber"
            },
            "authnContext": "sp2AuthnContext",
            "sessionIndexMapping": "sp2SessionIndex",
            "subjectMapping": "sp2SubjectName",
            "redirectURI": "/sp2"
        }
    },
    "condition": "${matches(exchange.request.uri.host, 'sp.two.example')
                    and matches(exchange.request.uri.path, '^/saml')}"
}

   </pre></div></div><br class="example-break"></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="multisp-try-it-out"></a>A.6.&nbsp;Trying It Out</h2></div></div></div><p>
   Try the configuration for multiple protected applications,
   logging in to OpenAM as for the single SP federation example
   with username <code class="literal">george</code>, password <code class="literal">costanza</code>.
  </p><div class="itemizedlist"><p>
    If you use the example configurations described here
    with all services running on your computer protecting the sample application,
    then you can try the SAML 2.0 web single sign-on profile
    with application One by using either of the following links.
   </p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
     The link for
     <a class="link" href="http://sp.one.example:8080/saml/SPInitiatedSSO?metaAlias=/sp1&amp;idpEntityID=http://openam.example.com:8088/openam&amp;binding=urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST" target="_blank">SP initiated SSO</a>.
    </p></li><li class="listitem"><p>
     The link for
     <a class="link" href="http://openam.example.com:8088/openam/idpssoinit?NameIDFormat=urn:oasis:names:tc:SAML:2.0:nameid-format:transient&amp;metaAlias=/idp&amp;spEntityID=One&amp;binding=urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST" target="_blank">IDP initiated SSO</a>.
    </p></li></ul></div><div class="itemizedlist"><p>
    Similarly you can try the SAML 2.0 web single sign-on profile
    with application Two by using either of the following links.
   </p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
     The link for
     <a class="link" href="http://sp.two.example:8080/saml/SPInitiatedSSO?metaAlias=/sp2&amp;idpEntityID=http://openam.example.com:8088/openam&amp;binding=urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST" target="_blank">SP initiated SSO</a>.
    </p></li><li class="listitem"><p>
     The link for
     <a class="link" href="http://openam.example.com:8088/openam/idpssoinit?NameIDFormat=urn:oasis:names:tc:SAML:2.0:nameid-format:transient&amp;metaAlias=/idp&amp;spEntityID=Two&amp;binding=urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST" target="_blank">IDP initiated SSO</a>.
    </p></li></ul></div><p>
   If you have not configured the examples exactly as shown in this guide,
   then adapt the SSO links accordingly.
  </p></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="chap-troubleshooting.html">Prev</a>&nbsp;</td><td width="20%" align="center">&nbsp;</td><td width="40%" align="right">&nbsp;<a accesskey="n" href="ix01.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter&nbsp;13.&nbsp;Troubleshooting&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Index</td></tr></table></div><p>&nbsp;</p><div id="footer"><p>Something wrong on this page? <a href="https://bugster.forgerock.org/jira/secure/CreateIssueDetails!init.jspa?pid=10060&components=10220&issuetype=1">Log a documentation bug.</a></p></div>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-23412190-14']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</body></html>