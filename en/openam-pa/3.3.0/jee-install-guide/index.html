<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head>

      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
   <title>OpenAM Java EE Policy Agent Installation Guide</title><link rel="stylesheet" type="text/css" href="coredoc.css"><link rel="stylesheet" type="text/css" href="css/coredoc.css"><link rel="stylesheet" type="text/css" href="sh/shCore.css"><link rel="stylesheet" type="text/css" href="sh/shCoreEclipse.css"><link rel="stylesheet" type="text/css" href="sh/shThemeEclipse.css"><script src="http://code.jquery.com/jquery-1.11.0.min.js" type="text/javascript"></script><script src="uses-jquery.js" type="text/javascript"></script><script src="sh/shCore.js" type="text/javascript"></script><script src="sh/shBrushAci.js" type="text/javascript"></script><script src="sh/shBrushBash.js" type="text/javascript"></script><script src="sh/shBrushCsv.js" type="text/javascript"></script><script src="sh/shBrushHttp.js" type="text/javascript"></script><script src="sh/shBrushJava.js" type="text/javascript"></script><script src="sh/shBrushJScript.js" type="text/javascript"></script><script src="sh/shBrushLDIF.js" type="text/javascript"></script><script src="sh/shBrushPlain.js" type="text/javascript"></script><script src="sh/shBrushProperties.js" type="text/javascript"></script><script src="sh/shBrushXml.js" type="text/javascript"></script><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><meta name="description" content="Guide to installing OpenAM Java EE policy agents. OpenAM provides open source Authentication, Authorization, Entitlement and Federation software."><script type="text/javascript">SyntaxHighlighter.all();</script>
<link rel="shortcut icon" href="http://forgerock.org/favicon.ico">
</head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div lang="en" class="book"><div class="titlepage"><div><div><h1 class="title"><a name="jee-agent-install-guide"></a>OpenAM Java EE Policy Agent Installation Guide</h1></div><div><h2 class="subtitle">Version 3.3.0</h2></div><div><div class="authorgroup"><div class="author"><h3 class="author"><span class="firstname">Mark </span> <span class="surname">Craig</span></h3></div><div class="author"><h3 class="author"><span class="firstname">Vanessa </span> <span class="surname">Richie</span></h3></div><div class="author"><h3 class="author"><span class="firstname">Mike </span> <span class="surname">Jang</span></h3><div lang="en" class="affiliation"><span class="orgname">ForgeRock AS<br></span><div class="address"><p><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="street">33&nbsp;New&nbsp;Montgomery&nbsp;St.</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="otheraddr">Suite&nbsp;1500</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="city">San&nbsp;Francisco</span>,&nbsp;<span class="state">CA</span>&nbsp;<span class="postcode">94105</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="country">USA</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="phone">+1&nbsp;415-599-1100</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<code class="uri">www.forgerock.com</code><br>
&nbsp;&nbsp;&nbsp;</p></div></div></div></div></div><div><p class="releaseinfo">Software release date: November 08, 2013</p></div><div><p class="copyright">Copyright &copy; 2011-2014 ForgeRock AS</p></div><div><a href="legalnotice.html">Legal Notice</a></div><div><p class="pubdate">Publication date: October 08, 2014</p></div><div><div class="abstract"><div class="abstract-title">Abstract</div><p>Guide to installing OpenAM Java EE policy agents. OpenAM provides open source
   Authentication, Authorization, Entitlement and Federation software.</p></div></div></div><hr></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="preface"><a href="#preface">Preface</a></span></dt><dt><span class="chapter"><a href="#chap-about-jee-agents">1. About OpenAM Java EE Policy Agents</a></span></dt><dt><span class="chapter"><a href="#chap-apache-tomcat">2. Installing the Apache Tomcat Policy Agent</a></span></dt><dt><span class="chapter"><a href="#chap-glassfish">3. Installing the GlassFish Policy Agent</a></span></dt><dt><span class="chapter"><a href="#chap-jboss">4. Installing the JBoss Application Server Policy Agent</a></span></dt><dt><span class="chapter"><a href="#chap-jetty">5. Installing the Jetty Server Policy Agent</a></span></dt><dt><span class="chapter"><a href="#chap-weblogic">6. Installing the Oracle WebLogic Policy Agent</a></span></dt><dt><span class="chapter"><a href="#chap-websphere">7. Installing the IBM WebSphere Policy Agent</a></span></dt><dt><span class="chapter"><a href="#chap-troubleshooting">8. Troubleshooting</a></span></dt><dt><span class="index"><a href="#d1498e2634">Index</a></span></dt></dl></div><div lang="en" class="preface"><div class="titlepage"><div><div><h1 class="title"><a name="preface"></a>Preface</h1></div></div></div><p>This guide shows you how to install OpenAM Java EE policy agents, as well as 
 how to integrate with other access management software. Read the 
 <em class="citetitle">Release Notes</em> before you get started.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d1498e155"></a>1.&nbsp;Who Should Use this Guide</h2></div></div></div><p>This guide is written for anyone installing OpenAM policy agents to 
  interface with supported Java EE application containers.</p><p>This guide covers procedures that you theoretically perform only
  once per version. This guide aims to provide you with at least some idea
  of what happens behind the scenes when you perform the steps.</p><p>You do not need to be an OpenAM wizard to learn something from
  this guide, though a background in access management and maintaining
  web application software can help. You do need some background in
  managing services on your operating systems and in your application
  servers. You can nevertheless get started with this guide, and then
  learn more as you go along.</p></div><div lang="en" class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="formatting-conventions"></a>2.&nbsp;Formatting Conventions</h2></div></div></div><p>
  Most examples in the documentation are created on GNU/Linux or Mac OS X.

  Where it is helpful to make a distinction between operating environments,
  examples for UNIX, GNU/Linux, Mac OS X, and so forth are labeled (UNIX).
  Mac OS X specific examples can be labeled (Mac OS X).
  Examples for Microsoft Windows can be labeled (Windows).

  To avoid repetition, however, file system directory names are
  often given only in UNIX format as in <code class="filename">/path/to/server</code>,
  even if the text applies to <code class="filename">C:\path\to\server</code> as well.
 </p><p>
  Absolute path names usually begin with the placeholder
  <code class="filename">/path/to/</code>.

  This path might translate to <code class="filename">/opt/</code>,
  <code class="filename">C:\Program Files\</code>, or somewhere else on your system.
 </p><p>
  Command line, terminal sessions are formatted as follows.
 </p><div class="screen"><pre>$ <strong>echo $JAVA_HOME</strong>
<em>/path/to/jdk</em></pre></div><p>
  Command output is sometimes formatted for narrower, more readable output
  even though formatting parameters are not shown in the command.
  In the following example, the query string parameter
  <code class="literal">_prettyPrint=true</code> is omitted.
 </p><div class="screen"><pre>
$ <strong>curl https://bjensen:hifalutin@opendj.example.com:8443/users/newuser</strong>
<em>{
  "_rev" : "000000005b337348",
  "schemas" : [ "urn:scim:schemas:core:1.0" ],
  "contactInformation" : {
    "telephoneNumber" : "+1 408 555 1212",
    "emailAddress" : "newuser@example.com"
  },
  "_id" : "newuser",
  "name" : {
    "familyName" : "New",
    "givenName" : "User"
  },
  "userName" : "newuser@example.com",
  "displayName" : "New User",
  "meta" : {
    "created" : "2014-06-03T09:58:27Z"
  },
  "manager" : [ {
    "_id" : "kvaughan",
    "displayName" : "Kirsten Vaughan"
  } ]
}</em>
 </pre></div><p>
  Program listings are formatted as follows.
 </p><pre class="brush: java;">class Test {
    public static void main(String [] args)  {
        System.out.println("This is a program listing.");
    }
}</pre></div><div lang="en" class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="accessing-doc-online"></a>3.&nbsp;Accessing Documentation Online</h2></div></div></div><p>
  ForgeRock core documentation, such as what you are now reading, aims to be
  technically accurate and complete with respect to the software documented.
 </p><div class="itemizedlist"><p>
   Core documentation therefore follows a three-phase review process
   designed to eliminate errors.
  </p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
    Product managers and software architects review project documentation design
    with respect to the users' software lifecycle needs.
   </p></li><li class="listitem"><p>
    Subject matter experts review proposed documentation changes for
    technical accuracy and completeness
    with respect to the corresponding software.
   </p></li><li class="listitem"><p>
    Quality experts validate implemented documentation changes for
    technical validity with respect to the software,
    technical completeness with respect to the scope of the document,
    and usability for the expected audience.
   </p></li></ul></div><p>
  The review process helps to ensure that documentation published for
  a ForgeRock release is technically accurate and complete.
 </p><p>
  Fully reviewed, published core documentation is available at
  <a class="link" href="http://docs.forgerock.org/" target="_blank">http://docs.forgerock.org/</a>.

  Use this documentation when working with a ForgeRock Enterprise release.
 </p><p>
  In-progress documentation can be found at each project site under the
  <a class="link" href="http://forgerock.org" target="_blank">Developer Community</a> projects page.

  Use this documentation when trying a nightly build.
 </p><p>
  The ForgeRock <a class="link" href="https://wikis.forgerock.org/" target="_blank">Community Wikis</a> and provide additional, user-created information.

  We encourage you to
  <a class="link" href="https://sso.forgerock.com/openam/UI/Login" target="_blank">join the community</a>, so that you can update the Wikis, too.
 </p></div><div lang="en" class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="joining-the-community"></a>4.&nbsp;Joining the ForgeRock Community</h2></div></div></div><p>
  After you
  <a class="link" href="https://backstage.forgerock.com/#/account/register" target="_blank">sign up</a> to join the ForgeRock community,
  you can edit the
  <a class="link" href="https://wikis.forgerock.org/" target="_blank">Community Wikis</a>,
  and also log bugs and feature requests in the
  <a class="link" href="https://bugster.forgerock.org/" target="_blank">issue tracker</a>.
 </p><p>
  If you have a question regarding a project but cannot find an answer
  in the project documentation or Wiki, browse to the
  <a class="link" href="http://forgerock.org" target="_blank">Developer Community</a> page for the project,
  where you can find details on joining the project mailing lists,
  and find links to mailing list archives.

  You can also suggest updates to documentation through the
  <a class="link" href="https://lists.forgerock.org/mailman/listinfo/docs" target="_blank">ForgeRock docs mailing list</a>.
 </p><p>
  The Community Wikis describe how to check out and build source code.

  Should you want to contribute a patch, test, or feature,
  or want to author part of the core documentation,
  first have a look on the ForgeRock site at
  <a class="link" href="http://forgerock.org/get_involved.html" target="_blank">how to get involved</a>.
 </p></div></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-about-jee-agents"></a>Chapter&nbsp;1.&nbsp;About OpenAM Java EE Policy Agents</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="section"><a href="#example-j2ee-agent-interaction">1.1. How the User, Application, Policy Agent, &amp; OpenAM Interact</a></span></dt><dt><span class="section"><a href="#j2ee-agent-configuration">1.2. How J2EE Policy Agents are Configured</a></span></dt></dl></div><p>OpenAM Java EE policy agents provide medium touch integration for
 web applications running in supported web application containers. Java EE
 policy agents require some configuration and code changes to deployed web
 applications. This chapter covers what Java EE policy agents do and how they
 work.</p><p>A <em class="firstterm">policy agent</em> enforces policy for OpenAM. A
 <em class="firstterm">J2EE policy agent</em> installed in a web application
 container intercepts requests from users trying to access resources in
 protected web applications. The agent denies access until the user has
 authorization from OpenAM to access a particular resource.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="example-j2ee-agent-interaction"></a>1.1.&nbsp;How the User, Application, Policy Agent, &amp; OpenAM Interact</h2></div></div></div><p>Imagine that a user attempts to access a protected resource before
  having authenticated by pointing her browser to a page in a protected
  application. Assume that you have configured OpenAM to protect the web
  application. You have therefore installed the J2EE agent in the web container,
  and also configured the protected web application to use the agent filter,
  thus sending requests through the agent. Then the J2EE policy agent
  intercepting her filtered browser's request finds no session token in the
  request, and so redirects the user's browser to the OpenAM login page for
  authentication. After the user has successfully authenticated, OpenAM
  sets a session token in a browser cookie, and redirects her browser back to
  the page she tried to access initially.</p><p>When the user's browser reiterates the request, the policy agent again
  checks that the request has a session token, finds a session token this
  time, and validates the session token with OpenAM. Given the valid session
  token, the policy agent gets a policy decision from OpenAM concerning whether
  the user can access the page. If OpenAM's Policy Service determines that
  the user is allowed to access the page, OpenAM responds to the policy agent
  that access should be granted. The J2EE policy agent then permits the page
  to be returned to the user's browser.</p><p>You can also configure J2EE agent filters to work in tandem with
  the J2EE security policies defined alongside the policies for OpenAM. In this
  case the filter ensures the J2EE security policy grants access to the
  resource before the agent gets a decision from OpenAM.</p><p>The following diagram shows how the pieces fit together when a Java
  EE client accesses a resource protected by a policy agent. This diagram is
  simplified to show only the essential principals rather than to describe
  every possible case.</p><div class="mediaobject" align="center"><a name="figure-jee-pa-overview"></a><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/jee-pa-overview.png" align="middle" height="360" alt="Diagram of Java EE policy agent use"></td></tr></table><div class="longdesc-link" align="right"><br clear="all"><span class="longdesc-link">[<a href="figure-jee-pa-overview.html" target="longdesc">D</a>]</span></div></div><div class="orderedlist"><p>A Java EE policy agent is a web application installed in the web
   application container. Other applications have filters configured to
   call the policy agent when a client requests access to a protected resource
   in the application.</p><ol class="orderedlist" type="1"><li class="listitem"><p>The web client requests access to a protected resource.</p></li><li class="listitem"><p>The web application filter settings put the request through the
    policy agent that protects the resource according to OpenAM policy. The
    policy agent acts to enforce policy, whereas the policy configuration and
    decisions are handled by OpenAM.</p></li><li class="listitem"><p>The policy agent communicates with OpenAM to get the policy
    decision to enforce.</p></li><li class="listitem"><p>For a resource to which OpenAM approves access, the policy agent
    allows access.</p></li><li class="listitem"><p>The web application returns the requested access to the web
    client.</p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="j2ee-agent-configuration"></a>1.2.&nbsp;How J2EE Policy Agents are Configured</h2></div></div></div><p>You install J2EE policy agents in the web application containers
  serving web applications that you want to protect. J2EE policy agents are
  themselves web applications running in the container whose applications you
  configure OpenAM to protect. By default, the J2EE policy agent has only
  enough configuration at installation time to connect to OpenAM in order to
  get the rest of its configuration from the OpenAM configuration store. With
  nearly all configuration stored centrally, you can manage policy agents
  centrally from the OpenAM console.<a href="#ftn.d1498e334" class="footnote" name="d1498e334"><sup class="footnote">[1]</sup></a></p><p>For each web application that you protect, you also configure at least
  the deployment descriptor to filter requests through the policy agent.
  ForgeRock delivers the J2EE policy agents with a sample application under
  <code class="filename">j2ee_agents/<em class="replaceable"><code>container</code></em>_agent/sampleapp/</code>
  demonstrating the configuration to use to protect your web application.</p><p>You configure J2EE policy agents per OpenAM realm. Thus to access
  centralized configuration, you select Access Control &gt; <em class="replaceable"><code>Realm
  Name</code></em> &gt; Agents &gt; J2EE &gt; <em class="replaceable"><code>Agent
  Name</code></em>. J2EE policy agent configuration is distinct from
  policy configuration. The only policy-like configuration that you apply to
  J2EE policy agents is indicating which URLs in the web server can be
  ignored (<em class="firstterm">not enforced URLs</em>) and which client IP
  address are exempt from policy enforcement (<em class="firstterm">not enforced
  IPs</em>).</p><p>For each aspect of J2EE policy agent configuration, you can configure
  the policy agent through the OpenAM console during testing, and then
  export the resulting configuration in order to script configuration in
  your production environment.</p></div><div class="footnotes"><br><hr class="footnote-hr"><div id="ftn.d1498e334" class="footnote"><p><a href="#d1498e334" class="para"><sup class="para">[1] </sup></a>You can opt to store the
  agent configuration locally if necessary.</p></div></div></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-apache-tomcat"></a>Chapter&nbsp;2.&nbsp;Installing the Apache Tomcat Policy Agent</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="section"><a href="#before-tomcat-agent-install">2.1. Before You Install</a></span></dt><dt><span class="section"><a href="#install-tomcat-agent">2.2. Installing the Tomcat Policy Agent</a></span></dt><dt><span class="section"><a href="#silent-tomcat-agent-installation">2.3. Silent Tomcat Policy Agent Installation</a></span></dt><dt><span class="section"><a href="#uninstall-tomcat-agent">2.4. Remove Tomcat Policy Agent Software</a></span></dt></dl></div><a class="indexterm" name="d1498e365"></a><p>This chapter covers installation of the policy agent for Apache
 Tomcat.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="before-tomcat-agent-install"></a>2.1.&nbsp;Before You Install</h2></div></div></div><p>Make sure OpenAM is installed and running, and that you can contact OpenAM
  from the system running the policy agent. Next, create a profile for your
  policy agent as described in the <em class="citetitle">Administration Guide</em>
  section on <span class="olink"><em class="citetitle">Creating Agent
  Profiles</em></span>. To protect resources with the agent also create
  at least one policy as described in the section on <span class="olink"><em class="citetitle">Configuring
  Policies</em></span>. Consider creating a simple policy, such as a
  policy that allows only authenticated users to access your resources, in order
  to test your policy agent after installation.</p><p>You must install Apache Tomcat before you install the policy
  agent, and you must stop the server during installation.</p><p>All of the Tomcat scripts must be present in
  <code class="filename">$CATALINA_HOME/bin</code>. The Tomcat Windows executable
  installer does not include the scripts, for example. If the scripts
  are not present in your installation, copy the contents of the
  <code class="filename">bin</code> directory from a .zip download of Tomcat of
  the same version as the one you installed.</p><p>You must install a supported version of the Java runtime environment.
          Please review the <a href="../jee-release-notes/index.html#java-requirements-javaee-agents" class="link">
              <em class="citetitle">Release Notes</em></a> for the currently supported version
          of Java, and set the <code class="literal">JAVA_HOME</code> environment
          variable accordingly. The policy agent installer requires Java.</p><div class="screen"><pre>$ echo $JAVA_HOME
/path/to/java
$ which java
/usr/bin/java</pre></div><p>Go to <span class="olink"><em class="citetitle">Obtaining OpenAM Software</em></span>
  to determine which version of the agent to download and download the agent.
  Also verify the checksum of the file you download against the checksum
  posted on the download page.</p><p>Unzip the file in the directory where you plan to install the J2EE
  policy agent. The agent you install stores its configuration and logs
  under this directory.</p><div class="variablelist"><p>When you unzip the policy agent, you find the following directories
   under the <code class="filename">j2ee_agents/tomcat_v6_agent</code> directory.</p><dl class="variablelist"><dt><span class="term"><code class="filename">bin</code></span></dt><dd><p>The installation and configuration program,
     <span class="command"><strong>agentadmin</strong></span>.</p></dd><dt><span class="term"><code class="filename">config</code></span></dt><dd><p>Configuration templates used by the <span class="command"><strong>agentadmin</strong></span>
     command during installation</p></dd><dt><span class="term"><code class="filename">data</code></span></dt><dd><p>Not used</p></dd><dt><span class="term"><code class="filename">etc</code></span></dt><dd><p>Configuration templates used during installation</p></dd><dt><span class="term"><code class="filename">installer-logs</code></span></dt><dd><p>Location for log files written during installation</p></dd><dt><span class="term"><code class="filename">lib</code></span></dt><dd><p>Shared libraries used by the J2EE policy agent</p></dd><dt><span class="term"><code class="filename">locale</code></span></dt><dd><p>Property files used by the installation program</p></dd><dt><span class="term"><code class="filename">sampleapp</code></span></dt><dd><p>Sample application that demonstrates key features of the policy
     agent. Wait until you have installed the agent to deploy this.</p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="install-tomcat-agent"></a>2.2.&nbsp;Installing the Tomcat Policy Agent</h2></div></div></div><p>Complete the following procedures to install the policy agent.</p><div class="procedure"><a name="create-tomcat-agent-profile"></a><div class="procedure-title">Procedure&nbsp;2.1.&nbsp;To Create the Tomcat Agent Profile</div><p>Regardless of whether you store configurations centrally in OpenAM
   or locally with your agents, the agent requires a profile so that it can
   connect to and communicate with OpenAM.</p><ol class="procedure" type="1"><li class="step"><p>In the OpenAM console, browse to Access Control &gt;
    <em class="replaceable"><code>Realm Name</code></em> &gt; Agents &gt; J2EE,
    and then click the New... button in the Agent table.</p></li><li class="step"><p>Complete the web form using the following hints.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Name</span></dt><dd><p>The name for the agent profile used when you install the
       agent</p></dd><dt><span class="term">Password</span></dt><dd><p>Password the agent uses to authenticate to OpenAM</p></dd><dt><span class="term">Configuration</span></dt><dd><p>Centralized configurations are stored in the OpenAM configuration
       store. You can manage the centralized configuration through the OpenAM
       console. Local configurations are stored in a file alongside the
       agent.</p></dd><dt><span class="term">Server URL</span></dt><dd><p>The full URL to an OpenAM instance, or if OpenAM is deployed in
       a site configuration (behind a load balancer) then the site URL</p><p>In centralized configuration mode, the Server URL is used to
       populate the agent profile for services such as Login, Logout, Naming,
       and Cross Domain SSO.</p></dd><dt><span class="term">Agent URL</span></dt><dd><p>The URL to the J2EE application that the agent protects</p><p>In centralized configuration mode, the Agent URL is used to
       populate the Agent Profile for services such as notifications.</p></dd></dl></div></li></ol></div><div class="procedure"><a name="create-tomcat-agent-pwdfile"></a><div class="procedure-title">Procedure&nbsp;2.2.&nbsp;To Create the Password File</div><ol class="procedure" type="1"><li class="step"><p>Create a text file containing only the password.</p><div class="screen"><pre>$ echo password &gt; /tmp/pwd.txt</pre></div></li><li class="step"><p>Protect the password file you create as appropriate for your
    operating system.</p><div class="screen"><pre>$ chmod 400 /tmp/pwd.txt</pre></div></li></ol></div><div class="procedure"><a name="install-agent-into-tomcat"></a><div class="procedure-title">Procedure&nbsp;2.3.&nbsp;To Install the Policy Agent into Tomcat</div><ol class="procedure" type="1"><li class="step"><p>Shut down the Tomcat server where you plan to install the
    agent.</p><div class="screen"><pre>$ /path/to/tomcat/bin/shutdown.sh</pre></div></li><li class="step"><p>Make sure OpenAM is running.</p></li><li class="step"><p>Run <span class="command"><strong>agentadmin --install</strong></span> to install the agent.</p><div class="screen"><pre>$ /path/to/j2ee_agents/tomcat_v6_agent/bin/agentadmin --install
...
-----------------------------------------------
SUMMARY OF YOUR RESPONSES
-----------------------------------------------
Tomcat Server Config Directory : /path/to/tomcat/conf
OpenAM server URL : http://openam.example.com:8080/openam
$CATALINA_HOME environment variable : /path/to/tomcat
Tomcat global web.xml filter install : true
Agent URL : http://www.example.com:8080/agentapp
Agent Profile name : Tomcat Agent
Agent Profile Password file name : /tmp/pwd.txt

...
SUMMARY OF AGENT INSTALLATION
-----------------------------
Agent instance name: Agent_001
Agent Bootstrap file location:
/path/to/j2ee_agents/tomcat_v6_agent/Agent_001/config/
 OpenSSOAgentBootstrap.properties
Agent Configuration file location
/path/to/j2ee_agents/tomcat_v6_agent/Agent_001/config/
 OpenSSOAgentConfiguration.properties
Agent Audit directory location:
/path/to/j2ee_agents/tomcat_v6_agent/Agent_001/logs/audit
Agent Debug directory location:
/path/to/j2ee_agents/tomcat_v6_agent/Agent_001/logs/debug


Install log file location:
/path/to/j2ee_agents/tomcat_v6_agent/installer-logs/audit/install.log
...</pre></div><p>Upon successful completion, the installer has added the agent
    configuration to Tomcat's configuration, and also set up configuration
    and log directories for the agent.</p><div class="note"><h3 class="title">Note</h3><p>If the agent is in a different domain than the server, refer to <em class="citetitle">Administration Guide</em> procedure, <span class="olink"><em class="citetitle">Configuring Cross-Domain
   Single Sign On</em></span>.</p></div></li><li class="step"><p>Take note of the configuration files and log locations.</p><p>Each agent instance that you install on the system has its own
    numbered configuration and logs directory. The first agent's configuration
    and logs are thus located under the directory
    <code class="filename">j2ee_agents/tomcat_v6_agent/Agent_001/</code>.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="filename">config/OpenSSOAgentBootstrap.properties</code></span></dt><dd><p>Used to bootstrap the J2EE policy agent, allowing the agent to
       connect to OpenAM and download its configuration</p></dd><dt><span class="term"><code class="filename">config/OpenSSOAgentConfiguration.properties</code></span></dt><dd><p>Only used if you configured the J2EE policy agent to use local
       configuration</p></dd><dt><span class="term"><code class="filename">logs/audit/</code></span></dt><dd><p>Operational audit log directory, only used if remote logging
       to OpenAM is disabled</p></dd><dt><span class="term"><code class="filename">logs/debug/</code></span></dt><dd><p>Debug directory where the <code class="filename">debug.out</code> debug
       file resides. Useful in troubleshooting policy agent issues.</p></dd></dl></div></li><li class="step"><p>If your policy agent configuration is not in the top-level realm (/),
       then you must edit config/OpenSSOAgentBootstrap.properties to identify
       the sub-realm that has your policy agent configuration.
       Find com.sun.identity.agents.config.organization.name and change
       the / to the path to your policy agent profile. This allows the policy agent
       to properly identify itself to the OpenAM server. </p></li><li class="step"><p>If you choose not to let the installer install a global filter in
    Tomcat's <code class="filename">web.xml</code>, then you must add the filter
    manually for each protected application's <code class="filename">web.xml</code>
    configuration, following the opening &lt;web-app&gt; tag. The file for  
    the sample application delivered with the agent is 
    <code class="filename">/path/to/j2ee_agents/tomcat_v6_agent/sampleapp/etc/web.xml</code>.</p><pre class="brush: xml;"> &lt;filter&gt;
  &lt;filter-name&gt;Agent&lt;/filter-name&gt;
  &lt;display-name&gt;Agent&lt;/display-name&gt;
  &lt;description&gt;OpenAM Policy Agent Filter&lt;/description&gt;
 &lt;filter-class&gt;com.sun.identity.agents.filter.AmAgentFilter&lt;/filter-class&gt;
 &lt;/filter&gt;
 &lt;filter-mapping&gt;
  &lt;filter-name&gt;Agent&lt;/filter-name&gt;
  &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
  &lt;dispatcher&gt;REQUEST&lt;/dispatcher&gt;
  &lt;dispatcher&gt;INCLUDE&lt;/dispatcher&gt;
  &lt;dispatcher&gt;FORWARD&lt;/dispatcher&gt;
  &lt;dispatcher&gt;ERROR&lt;/dispatcher&gt;
 &lt;/filter-mapping&gt;</pre></li><li class="step"><p>Add the agent application web archive to Tomcat's webapps.</p><p>$ cp /path/to/j2ee_agents/tomcat_v6_agent/etc/agentapp.war
 /path/to/tomcat/webapps/</p></li><li class="step"><p>Start the Tomcat server where you installed the agent.</p><div class="screen"><pre>$ /path/to/tomcat/bin/startup.sh</pre></div></li></ol></div><div class="procedure"><a name="check-tomcat-agent-installation"></a><div class="procedure-title">Procedure&nbsp;2.4.&nbsp;To Check the Policy Agent Installation</div><ol class="procedure" type="1"><li class="step"><p>Check the Tomcat server log after you start the server to make
    sure startup completed successfully.</p><div class="screen"><pre>$ tail -n 1 /path/to/tomcat/logs/catalina.out
INFO: Server startup in 810 ms</pre></div></li><li class="step"><p>Check the <code class="filename">debug.out</code> debug log to verify that
    the agent did start up.</p><div class="screen"><pre>$ tail -n 7 /path/to/j2ee_agents/tomcat_v6_agent/Agent_001/logs/debug/debug.out
=======================================
Version: ...
Revision: 3111
Build Date: 20120915
Build Machine: builds.forgerock.org
=======================================

</pre></div></li><li class="step"><p>If you have a policy configured, you can test your policy agent.
    For example, try to browse to a resource that your policy agent protects.
    You should be redirected to OpenAM to authenticate, for example as user
    <code class="literal">demo</code>, password <code class="literal">changeit</code>. After
    you authenticate, OpenAM then redirects you back to the resource you tried
    to access.</p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="silent-tomcat-agent-installation"></a>2.3.&nbsp;Silent Tomcat Policy Agent Installation</h2></div></div></div><p>When performing a scripted, silent installation, use
  <span class="command"><strong>agentadmin --install --saveResponse
  <em class="replaceable"><code>response-file</code></em></strong></span>
  to create a response file for scripted installation. Then install silently
  using <span class="command"><strong>agentadmin --install --useResponse
  <em class="replaceable"><code>response-file</code></em></strong></span>.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="uninstall-tomcat-agent"></a>2.4.&nbsp;Remove Tomcat Policy Agent Software</h2></div></div></div><p>Shut down the Tomcat server before you uninstall the
    policy agent.</p><div class="screen"><pre>$ /path/to/tomcat/bin/shutdown.sh</pre></div><p>To remove the J2EE policy agent, use <span class="command"><strong>agentadmin
  --uninstall</strong></span>. You must provide the Tomcat server configuration
  directory location.</p><p>Uninstall does not remove the agent instance directory, but you can
  do so manually after removing the agent configuration from Tomcat.</p></div></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-glassfish"></a>Chapter&nbsp;3.&nbsp;Installing the GlassFish Policy Agent</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="section"><a href="#before-glassfish-agent-install">3.1. Before You Install</a></span></dt><dt><span class="section"><a href="#install-glassfish-agent">3.2. Installing the GlassFish Policy Agent</a></span></dt><dt><span class="section"><a href="#silent-glassfish-agent-installation">3.3. Silent GlassFish Policy Agent Installation</a></span></dt><dt><span class="section"><a href="#uninstall-glassfish-agent">3.4. Removing GlassFish Policy Agent Software</a></span></dt></dl></div><a class="indexterm" name="d1498e707"></a><p>This chapter covers installation of the policy agent for GlassFish.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="before-glassfish-agent-install"></a>3.1.&nbsp;Before You Install</h2></div></div></div><p>Make sure OpenAM is installed and running, and that you can contact OpenAM
  from the system running the policy agent. Next, create a profile for your
  policy agent as described in the <em class="citetitle">Administration Guide</em>
  section on <span class="olink"><em class="citetitle">Creating Agent
  Profiles</em></span>. To protect resources with the agent also create
  at least one policy as described in the section on <span class="olink"><em class="citetitle">Configuring
  Policies</em></span>. Consider creating a simple policy, such as a
  policy that allows only authenticated users to access your resources, in order
  to test your policy agent after installation.</p><p>You must install GlassFish before you install the policy agent, and you
  must stop the domain with applications to protect during installation. Policy
  agents support GlassFish v2, v3 (at least 3.1).</p><p>You must install a supported version of the Java runtime environment.
          Please review the <a href="../jee-release-notes/index.html#java-requirements-javaee-agents" class="link">
              <em class="citetitle">Release Notes</em></a> for the currently supported version
          of Java, and set the <code class="literal">JAVA_HOME</code> environment
          variable accordingly.</p><div class="screen"><pre>$ echo $JAVA_HOME
/path/to/java
$ which java
/usr/bin/java</pre></div><p>Go to <span class="olink"><em class="citetitle">Obtaining OpenAM Software</em></span>
  to determine which version of the agent to download and download the agent.
  Also verify the checksum of the file you download against the checksum
  posted on the download page.</p><p>Unzip the file in the directory where you plan to install the J2EE
  policy agent. The agent you install stores its configuration and logs
  under this directory.</p><div class="variablelist"><p>When you unzip the policy agent, you find the following directories
   under the <code class="filename">j2ee_agents/appserver_v10_agent</code> directory.</p><dl class="variablelist"><dt><span class="term"><code class="filename">bin</code></span></dt><dd><p>The installation and configuration program,
     <span class="command"><strong>agentadmin</strong></span>.</p></dd><dt><span class="term"><code class="filename">config</code></span></dt><dd><p>Configuration templates used by the <span class="command"><strong>agentadmin</strong></span>
     command during installation</p></dd><dt><span class="term"><code class="filename">data</code></span></dt><dd><p>Not used</p></dd><dt><span class="term"><code class="filename">etc</code></span></dt><dd><p>Agent web application used during installation</p></dd><dt><span class="term"><code class="filename">installer-logs</code></span></dt><dd><p>Location for log files written during installation</p></dd><dt><span class="term"><code class="filename">lib</code></span></dt><dd><p>Shared libraries used by the J2EE policy agent</p></dd><dt><span class="term"><code class="filename">locale</code></span></dt><dd><p>Property files used by the installation program</p></dd><dt><span class="term"><code class="filename">sampleapp</code></span></dt><dd><p>Sample application that demonstrates key features of the policy
     agent. Wait until you have installed the agent to deploy this.</p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="install-glassfish-agent"></a>3.2.&nbsp;Installing the GlassFish Policy Agent</h2></div></div></div><p>Complete the following procedures to install the policy agent.</p><div class="procedure"><a name="create-glassfish-agent-profile"></a><div class="procedure-title">Procedure&nbsp;3.1.&nbsp;To Create the GlassFish Agent Profile</div><p>Regardless of whether you store configurations centrally in OpenAM
   or locally with your agents, the agent requires a profile so that it can
   connect to and communicate with OpenAM.</p><ol class="procedure" type="1"><li class="step"><p>In the OpenAM console, browse to Access Control &gt;
    <em class="replaceable"><code>Realm Name</code></em> &gt; Agents &gt; J2EE,
    and then click the New... button in the Agent table.</p></li><li class="step"><p>Complete the web form using the following hints.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Name</span></dt><dd><p>The name for the agent profile used when you install the
       agent</p></dd><dt><span class="term">Password</span></dt><dd><p>Password the agent uses to authenticate to OpenAM</p></dd><dt><span class="term">Configuration</span></dt><dd><p>Centralized configurations are stored in the OpenAM configuration
       store. You can manage the centralized configuration through the OpenAM
       console. Local configurations are stored in a file alongside the
       agent.</p></dd><dt><span class="term">Server URL</span></dt><dd><p>The full URL to an OpenAM instance, or if OpenAM is deployed in
       a site configuration (behind a load balancer) then the site URL</p><p>In centralized configuration mode, the Server URL is used to
       populate the agent profile for services such as Login, Logout, Naming,
       and Cross Domain SSO.</p></dd><dt><span class="term">Agent URL</span></dt><dd><p>The URL to the J2EE agent application, such as
       <code class="literal">http://www.example.com:8080/agentapp</code></p><p>In centralized configuration mode, the Agent URL is used to
       populate the Agent Profile for services such as notifications.</p></dd></dl></div></li></ol></div><div class="procedure"><a name="create-glassfish-agent-pwdfile"></a><div class="procedure-title">Procedure&nbsp;3.2.&nbsp;To Create the Password File</div><ol class="procedure" type="1"><li class="step"><p>Create a text file containing only the password.</p><div class="screen"><pre>$ echo password &gt; /tmp/pwd.txt</pre></div></li><li class="step"><p>Protect the password file you create as appropriate for your
    operating system.</p><div class="screen"><pre>$ chmod 400 /tmp/pwd.txt</pre></div></li></ol></div><div class="procedure"><a name="install-agent-into-glassfish"></a><div class="procedure-title">Procedure&nbsp;3.3.&nbsp;To Install the Policy Agent into GlassFish</div><ol class="procedure" type="1"><li class="step"><p>Shut down the GlassFish domain where you plan to install the
    agent.</p><div class="screen"><pre>$ /path/to/glassfish/bin/asadmin stop-domain domain1
Waiting for the domain to stop ....
Command stop-domain executed successfully.</pre></div></li><li class="step"><p>Make sure OpenAM is running.</p></li><li class="step"><p>Run <span class="command"><strong>agentadmin --install</strong></span> to install the agent.</p><div class="screen"><pre>$ /path/to/j2ee_agents/appserver_v10_agent/bin/agentadmin --install
...
-----------------------------------------------
SUMMARY OF YOUR RESPONSES
-----------------------------------------------
Application Server Config Directory :
/path/to/glassfish/glassfish/domains/domain1/config
Application Server Instance name : server
OpenAM server URL : http://openam.example.com:8080/openam
Agent URL : http://www.example.com:8080/agentapp
Agent Profile name : GlassFish Agent
Agent Profile Password file name : /tmp/pwd.txt

...
SUMMARY OF AGENT INSTALLATION
-----------------------------
Agent instance name: Agent_001
Agent Bootstrap file location:
/path/to/j2ee_agents/appserver_v10_agent/Agent_001/config/
 OpenSSOAgentBootstrap.properties
Agent Configuration file location
/path/to/j2ee_agents/appserver_v10_agent/Agent_001/config/
 OpenSSOAgentConfiguration.properties
Agent Audit directory location:
/path/to/j2ee_agents/appserver_v10_agent/Agent_001/logs/audit
Agent Debug directory location:
/path/to/j2ee_agents/appserver_v10_agent/Agent_001/logs/debug


Install log file location:
/path/to/j2ee_agents/appserver_v10_agent/installer-logs/audit/install.log
...</pre></div><p>Upon successful completion, the installer has updated the GlassFish
    configuration, and also set up configuration and log directories for the
    agent.</p><div class="note"><h3 class="title">Note</h3><p>If the agent is in a different domain than the server, refer to <em class="citetitle">Administration Guide</em> procedure, <span class="olink"><em class="citetitle">Configuring Cross-Domain
   Single Sign On</em></span>.</p></div></li><li class="step"><p>Take note of the configuration files and log locations.</p><p>Each agent instance that you install on the system has its own
    numbered configuration and logs directory. The first agent's configuration
    and logs are thus located under the directory
    <code class="filename">j2ee_agents/appserver_v10_agent/Agent_001/</code>.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="filename">config/OpenSSOAgentBootstrap.properties</code></span></dt><dd><p>Used to bootstrap the J2EE policy agent, allowing the agent to
       connect to OpenAM and download its configuration</p></dd><dt><span class="term"><code class="filename">config/OpenSSOAgentConfiguration.properties</code></span></dt><dd><p>Only used if you configured the J2EE policy agent to use local
       configuration</p></dd><dt><span class="term"><code class="filename">logs/audit/</code></span></dt><dd><p>Operational audit log directory, only used if remote logging
       to OpenAM is disabled</p></dd><dt><span class="term"><code class="filename">logs/debug/</code></span></dt><dd><p>Debug directory where the debug file resides. Useful in
       troubleshooting policy agent issues.</p></dd></dl></div></li><li class="step"><p>If your policy agent configuration is not in the top-level realm (/),
       then you must edit config/OpenSSOAgentBootstrap.properties to identify
       the sub-realm that has your policy agent configuration.
       Find com.sun.identity.agents.config.organization.name and change
       the / to the path to your policy agent profile. This allows the policy agent
       to properly identify itself to the OpenAM server. </p></li><li class="step"><p>To protect a web application, you must add the following filter
    to the application's <code class="filename">web.xml</code> configuration,
    following the opening &lt;web-app&gt; tag. The file for the sample 
    application delivered with the agent is 
    <code class="filename">/path/to/j2ee_agents/appserver_v10_agent/sampleapp/etc/web.xml</code>.</p><pre class="brush: xml;"> &lt;filter&gt;
  &lt;filter-name&gt;Agent&lt;/filter-name&gt;
  &lt;display-name&gt;Agent&lt;/display-name&gt;
  &lt;description&gt;OpenAM Policy Agent Filter&lt;/description&gt;
 &lt;filter-class&gt;com.sun.identity.agents.filter.AmAgentFilter&lt;/filter-class&gt;
 &lt;/filter&gt;
 &lt;filter-mapping&gt;
  &lt;filter-name&gt;Agent&lt;/filter-name&gt;
  &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
  &lt;dispatcher&gt;REQUEST&lt;/dispatcher&gt;
  &lt;dispatcher&gt;INCLUDE&lt;/dispatcher&gt;
  &lt;dispatcher&gt;FORWARD&lt;/dispatcher&gt;
  &lt;dispatcher&gt;ERROR&lt;/dispatcher&gt;
 &lt;/filter-mapping&gt;</pre></li><li class="step"><p>Start the GlassFish domain where you installed the agent.</p><div class="screen"><pre>$ /path/to/glassfish/bin/asadmin start-domain domain1
Waiting for domain1 to start .....
Successfully started the domain : domain1
domain  Location: /path/to/glassfish/glassfish/domains/domain1
Log File: /path/to/glassfish/glassfish/domains/domain1/logs/server.log
Admin Port: 4848
Command start-domain executed successfully.</pre></div></li><li class="step"><p>Deploy the agent web application.</p><div class="screen"><pre>cd /path/to/glassfish/glassfish/bin/asadmin
    $ deploy --name agentapp --contextroot /agentapp
 /path/to/j2ee_agents/appserver_v10_agent/etc/agentapp.war</pre></div></li><li class="step"><p>Check your work by quickly deploying the sample application,
    <code class="filename">/path/to/j2ee_agents/appserver_v10_agent/sampleapp/dist/agentsample.ear</code>
    through the GlassFish administration console, and verifying that the agent
    redirects to OpenAM for authentication and that access is denied after
    successful login to OpenAM. (Access is denied because when no policy exists
    for a protected resource the default decision for OpenAM is to deny all
    access.)</p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="silent-glassfish-agent-installation"></a>3.3.&nbsp;Silent GlassFish Policy Agent Installation</h2></div></div></div><p>When performing a scripted, silent installation, use
  <span class="command"><strong>agentadmin --install --saveResponse
  <em class="replaceable"><code>response-file</code></em></strong></span>
  to create a response file for scripted installation. Then install silently
  using <span class="command"><strong>agentadmin --install --useResponse
  <em class="replaceable"><code>response-file</code></em></strong></span>.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="uninstall-glassfish-agent"></a>3.4.&nbsp;Removing GlassFish Policy Agent Software</h2></div></div></div><p>Shut down the GlassFish domain before you uninstall the
    policy agent.</p><div class="screen"><pre>$ /path/to/glassfish/bin/asadmin stop-domain domain1
    Waiting for the domain to stop ....
    Command stop-domain executed successfully.</pre></div><p>To remove the J2EE policy agent, use <span class="command"><strong>agentadmin
  --uninstall</strong></span>. You must provide the GlassFish configuration directory
  location, and the instance name.</p><p>Uninstall does not remove the agent instance directory, but you can
  do so manually after removing the agent configuration from GlassFish.</p></div></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-jboss"></a>Chapter&nbsp;4.&nbsp;Installing the JBoss Application Server Policy Agent</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="section"><a href="#before-jboss-agent-install">4.1. Before You Install</a></span></dt><dt><span class="section"><a href="#install-jboss-agent">4.2. Installing the JBoss Policy Agent</a></span></dt><dt><span class="section"><a href="#silent-jboss-agent-installation">4.3. Silent JBoss Policy Agent Installation</a></span></dt><dt><span class="section"><a href="#uninstall-jboss-agent">4.4. Removing JBoss Policy Agent Software</a></span></dt></dl></div><a class="indexterm" name="d1498e1018"></a><p>This chapter covers installation of the policy agent for JBoss
 Application Server.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="before-jboss-agent-install"></a>4.1.&nbsp;Before You Install</h2></div></div></div><p>Make sure OpenAM is installed and running, and that you can contact OpenAM
  from the system running the policy agent. Next, create a profile for your
  policy agent as described in the <em class="citetitle">Administration Guide</em>
  section on <span class="olink"><em class="citetitle">Creating Agent
  Profiles</em></span>. To protect resources with the agent also create
  at least one policy as described in the section on <span class="olink"><em class="citetitle">Configuring
  Policies</em></span>. Consider creating a simple policy, such as a
  policy that allows only authenticated users to access your resources, in order
  to test your policy agent after installation.</p><p>You must install JBoss before you install the policy agent, and you
  must stop the server during installation.</p><p>You must install a supported version of the Java runtime environment.
          Please review the <a href="../jee-release-notes/index.html#java-requirements-javaee-agents" class="link">
              <em class="citetitle">Release Notes</em></a> for the currently supported version
          of Java, and set the <code class="literal">JAVA_HOME</code> environment
          variable accordingly.</p><div class="screen"><pre>$ echo $JAVA_HOME
/path/to/java
$ which java
/usr/bin/java</pre></div><p>&gt;Go to <span class="olink"><em class="citetitle">Obtaining OpenAM Software</em></span>
  to determine which version of the agent to download and download the agent.
  Also verify the checksum of the file you download against the checksum
  posted on the download page.</p><p>Unzip the file in the directory where you plan to install the J2EE
  policy agent. The agent you install stores its configuration and logs
  under this directory.</p><div class="variablelist"><p>
    When you unzip the policy agent,
    you find the following directories under the
    <code class="filename">j2ee_agents/jboss_<em class="replaceable"><code>version</code></em>_agent</code>
    directory, where <em class="replaceable"><code>version</code></em> depends
    on the version of JBoss that the policy agent supports.
   </p><dl class="variablelist"><dt><span class="term"><code class="filename">bin</code></span></dt><dd><p>The installation and configuration program,
     <span class="command"><strong>agentadmin</strong></span>.</p></dd><dt><span class="term"><code class="filename">config</code></span></dt><dd><p>Configuration templates used by the <span class="command"><strong>agentadmin</strong></span>
     command during installation</p></dd><dt><span class="term"><code class="filename">data</code></span></dt><dd><p>Not used</p></dd><dt><span class="term"><code class="filename">etc</code></span></dt><dd><p>Agent web application and configuration templates used during
     installation</p></dd><dt><span class="term"><code class="filename">installer-logs</code></span></dt><dd><p>Location for log files written during installation</p></dd><dt><span class="term"><code class="filename">lib</code></span></dt><dd><p>Shared libraries used by the J2EE policy agent</p></dd><dt><span class="term"><code class="filename">locale</code></span></dt><dd><p>Property files used by the installation program</p></dd><dt><span class="term"><code class="filename">sampleapp</code></span></dt><dd><p>Sample application that demonstrates key features of the policy
     agent. Wait until you have installed the agent to deploy this.</p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="install-jboss-agent"></a>4.2.&nbsp;Installing the JBoss Policy Agent</h2></div></div></div><p>Complete the following procedures to install the policy agent.</p><div class="procedure"><a name="create-jboss-agent-profile"></a><div class="procedure-title">Procedure&nbsp;4.1.&nbsp;To Create the JBoss Agent Profile</div><p>Regardless of whether you store configurations centrally in OpenAM
   or locally with your agents, the agent requires a profile so that it can
   connect to and communicate with OpenAM.</p><ol class="procedure" type="1"><li class="step"><p>In the OpenAM console, browse to Access Control &gt;
    <em class="replaceable"><code>Realm Name</code></em> &gt; Agents &gt; J2EE,
    and then click the New... button in the Agent table.</p></li><li class="step"><p>Complete the web form using the following hints.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Name</span></dt><dd><p>The name for the agent profile used when you install the
       agent</p></dd><dt><span class="term">Password</span></dt><dd><p>Password the agent uses to authenticate to OpenAM</p></dd><dt><span class="term">Configuration</span></dt><dd><p>Centralized configurations are stored in the OpenAM configuration
       store. You can manage the centralized configuration through the OpenAM
       console. Local configurations are stored in a file alongside the
       agent.</p></dd><dt><span class="term">Server URL</span></dt><dd><p>The full URL to an OpenAM instance, or if OpenAM is deployed in
       a site configuration (behind a load balancer) then the site URL</p><p>In centralized configuration mode, the Server URL is used to
       populate the agent profile for services such as Login, Logout, Naming,
       and Cross Domain SSO.</p></dd><dt><span class="term">Agent URL</span></dt><dd><p>The URL to the J2EE agent application, such as
       <code class="literal">http://www.example.com:8080/agentapp</code></p><p>In centralized configuration mode, the Agent URL is used to
       populate the Agent Profile for services such as notifications.</p></dd></dl></div></li></ol></div><div class="procedure"><a name="create-jboss-agent-pwdfile"></a><div class="procedure-title">Procedure&nbsp;4.2.&nbsp;To Create the Password File</div><ol class="procedure" type="1"><li class="step"><p>Create a text file containing only the password.</p><div class="screen"><pre>$ echo password &gt; /tmp/pwd.txt</pre></div></li><li class="step"><p>Protect the password file you create as appropriate for your
    operating system.</p><div class="screen"><pre>$ chmod 400 /tmp/pwd.txt</pre></div></li></ol></div><div class="procedure"><a name="install-agent-into-jboss"></a><div class="procedure-title">Procedure&nbsp;4.3.&nbsp;To Install the Policy Agent into JBoss</div><ol class="procedure" type="1"><li class="step"><p>Shut down the JBoss server where you plan to install the
    agent.</p></li><li class="step"><p>Make sure OpenAM is running.</p></li><li class="step"><p>Run <span class="command"><strong>agentadmin --install</strong></span> to install the agent.</p><p>
     The following excerpt shows installation of the JBoss 4 &amp; 5 policy agent.
    </p><div class="screen"><pre>$ /path/to/j2ee_agents/jboss_v42_agent/bin/agentadmin --install
...
-----------------------------------------------
SUMMARY OF YOUR RESPONSES
-----------------------------------------------
JBoss Server Config Directory : /path/to/jboss/server/default/conf
JBoss Server Home Directory : /path/to/jboss
OpenAM server URL : http://openam.example.com:8080/openam
Agent URL : http://www.example.com:8080/agentapp
Agent Profile name : JBoss Agent
Agent Profile Password file name : /tmp/pwd.txt
Agent permissions gets added to java permissions policy file : false

...
SUMMARY OF AGENT INSTALLATION
-----------------------------
Agent instance name: Agent_001
Agent Bootstrap file location:
/path/to/j2ee_agents/jboss_v42_agent/Agent_001/config/
 OpenSSOAgentBootstrap.properties
Agent Configuration file location
/path/to/j2ee_agents/jboss_v42_agent/Agent_001/config/
 OpenSSOAgentConfiguration.properties
Agent Audit directory location:
/path/to/j2ee_agents/jboss_v42_agent/Agent_001/logs/audit
Agent Debug directory location:
/path/to/j2ee_agents/jboss_v42_agent/Agent_001/logs/debug


Install log file location:
/path/to/j2ee_agents/jboss_v42_agent/installer-logs/audit/install.log
...</pre></div><p>Upon successful completion, the installer has updated the JBoss
    configuration, created a
    <code class="filename">JBOSS_HOME/bin/setAgentClasspathdefault.sh</code> script,
    added the agent web application under
    <code class="filename">JBOSS_HOME/server/default/deploy/</code>, and also set up
    configuration and log directories for the agent.</p><div class="note"><h3 class="title">Note</h3><p>If the agent is in a different domain than the server, refer to <em class="citetitle">Administration Guide</em> procedure, <span class="olink"><em class="citetitle">Configuring Cross-Domain
   Single Sign On</em></span>.</p></div></li><li class="step"><p>Take note of the configuration files and log locations.</p><p>Each agent instance that you install on the system has its own
    numbered configuration and logs directory. The first agent's configuration
    and logs are thus located under the directory
    <code class="filename">j2ee_agents/jboss_v42_agent/Agent_001/</code>.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="filename">config/OpenSSOAgentBootstrap.properties</code></span></dt><dd><p>Used to bootstrap the J2EE policy agent, allowing the agent to
       connect to OpenAM and download its configuration</p></dd><dt><span class="term"><code class="filename">config/OpenSSOAgentConfiguration.properties</code></span></dt><dd><p>Only used if you configured the J2EE policy agent to use local
       configuration</p></dd><dt><span class="term"><code class="filename">logs/audit/</code></span></dt><dd><p>Operational audit log directory, only used if remote logging
       to OpenAM is disabled</p></dd><dt><span class="term"><code class="filename">logs/debug/</code></span></dt><dd><p>Debug directory where the debug file resides. Useful in
       troubleshooting policy agent issues.</p></dd></dl></div></li><li class="step"><p>If your policy agent configuration is not in the top-level realm (/),
       then you must edit config/OpenSSOAgentBootstrap.properties to identify
       the sub-realm that has your policy agent configuration.
       Find com.sun.identity.agents.config.organization.name and change
       the / to the path to your policy agent profile. This allows the policy agent
       to properly identify itself to the OpenAM server. </p></li><li class="step"><p>To protect a web application, you must add the following filter
    to the application's <code class="filename">web.xml</code> configuration,
    following the opening &lt;web-app&gt; tag. The file for the sample 
    application delivered with the agent is 
    <code class="filename">/path/to/j2ee_agents/jboss_v42_agent/sampleapp/etc/web.xml</code>.</p><pre class="brush: xml;"> &lt;filter&gt;
  &lt;filter-name&gt;Agent&lt;/filter-name&gt;
  &lt;display-name&gt;Agent&lt;/display-name&gt;
  &lt;description&gt;OpenAM Policy Agent Filter&lt;/description&gt;
 &lt;filter-class&gt;com.sun.identity.agents.filter.AmAgentFilter&lt;/filter-class&gt;
 &lt;/filter&gt;
 &lt;filter-mapping&gt;
  &lt;filter-name&gt;Agent&lt;/filter-name&gt;
  &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
  &lt;dispatcher&gt;REQUEST&lt;/dispatcher&gt;
  &lt;dispatcher&gt;INCLUDE&lt;/dispatcher&gt;
  &lt;dispatcher&gt;FORWARD&lt;/dispatcher&gt;
  &lt;dispatcher&gt;ERROR&lt;/dispatcher&gt;
 &lt;/filter-mapping&gt;</pre><p>You must also add the following security domain specification to the
    application's <code class="filename">jboss.xml</code> and
    <code class="filename">jboss-web.xml</code> configuration files.</p><pre class="brush: xml;">&lt;security-domain&gt;java:/jaas/AMRealm&lt;/security-domain&gt;</pre></li></ol></div><div class="procedure"><a name="run-jboss-after-agent-installation"></a><div class="procedure-title">Procedure&nbsp;4.4.&nbsp;To Run JBoss After Agent Installation</div><ol class="procedure" type="1"><li class="step"><p>Render the script to set the agent classpath executable.</p><div class="screen"><pre>$ chmod +x $JBOSS_HOME/bin/setAgentClasspathdefault.sh</pre></div></li><li class="step"><p>Open the <code class="filename">JBOSS_HOME/bin/run.sh</code> script for
    editing, and locate the following code block.</p><pre class="brush: shell;">if [ "x$JBOSS_CLASSPATH" = "x" ]; then
    JBOSS_CLASSPATH="$JBOSS_BOOT_CLASSPATH"
else
    JBOSS_CLASSPATH="$JBOSS_CLASSPATH:$JBOSS_BOOT_CLASSPATH"
fi
if [ "x$JAVAC_JAR_FILE" != "x" ]; then
    JBOSS_CLASSPATH="$JBOSS_CLASSPATH:$JAVAC_JAR_FILE"
fi</pre></li><li class="step"><p>Edit the <code class="filename">JBOSS_HOME/bin/run.sh</code> script
    to set the classpath needed for the agent, by adding these lines after
    the code block you located in the previous step.</p><pre class="brush: shell;">if [ -r "$JBOSS_HOME/bin/setAgentClasspathdefault.sh" ]; then 
    . $JBOSS_HOME/bin/setAgentClasspathdefault.sh
fi</pre></li><li class="step"><p>Start the JBoss server where you installed the agent.</p><div class="screen"><pre>$ cd $JBOSS_HOME ; ./bin/run.sh -b 0.0.0.0
...
16:30:31,172 INFO  [ServerImpl] JBoss ... Started in 1m:44s:759ms</pre></div></li><li class="step"><p>If you have a policy configured, you can test your policy agent.
    For example, try to browse to a resource that your policy agent protects.
    You should be redirected to OpenAM to authenticate, for example as user
    <code class="literal">demo</code>, password <code class="literal">changeit</code>. After
    you authenticate, OpenAM then redirects you back to the resource you tried
    to access.</p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="silent-jboss-agent-installation"></a>4.3.&nbsp;Silent JBoss Policy Agent Installation</h2></div></div></div><p>When performing a scripted, silent installation, use
  <span class="command"><strong>agentadmin --install --saveResponse
  <em class="replaceable"><code>response-file</code></em></strong></span>
  to create a response file for scripted installation. Then install silently
  using <span class="command"><strong>agentadmin --install --useResponse
  <em class="replaceable"><code>response-file</code></em></strong></span>.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="uninstall-jboss-agent"></a>4.4.&nbsp;Removing JBoss Policy Agent Software</h2></div></div></div><p>Shut down the JBoss server before you uninstall the
    policy agent.</p><p>To remove the J2EE policy agent, use <span class="command"><strong>agentadmin
  --uninstall</strong></span>. You must provide the JBoss configuration directory
  location.</p><p>Uninstall does not remove the agent instance directory, but you can
  do so manually after removing the agent configuration from JBoss.</p></div></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-jetty"></a>Chapter&nbsp;5.&nbsp;Installing the Jetty Server Policy Agent</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="section"><a href="#before-jetty-agent-install">5.1. Before You Install</a></span></dt><dt><span class="section"><a href="#install-jetty-agent">5.2. Installing the Jetty Policy Agent</a></span></dt><dt><span class="section"><a href="#silent-jetty-agent-installation">5.3. Silent Jetty Policy Agent Installation</a></span></dt><dt><span class="section"><a href="#uninstall-jetty-agent">5.4. Removing Jetty Policy Agent Software</a></span></dt></dl></div><a class="indexterm" name="d1498e1371"></a><p>This chapter covers installation of the policy agent for Jetty.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="before-jetty-agent-install"></a>5.1.&nbsp;Before You Install</h2></div></div></div><p>Make sure OpenAM is installed and running, and that you can contact OpenAM
  from the system running the policy agent. Next, create a profile for your
  policy agent as described in the <em class="citetitle">Administration Guide</em>
  section on <span class="olink"><em class="citetitle">Creating Agent
  Profiles</em></span>. To protect resources with the agent also create
  at least one policy as described in the section on <span class="olink"><em class="citetitle">Configuring
  Policies</em></span>. Consider creating a simple policy, such as a
  policy that allows only authenticated users to access your resources, in order
  to test your policy agent after installation.</p><p>You must install Jetty before you install the policy agent, and you
  must stop the server during installation.</p><p>You must install a supported version of the Java runtime environment.
          Please review the <a href="../jee-release-notes/index.html#java-requirements-javaee-agents" class="link">
              <em class="citetitle">Release Notes</em></a> for the currently supported version
          of Java, and set the <code class="literal">JAVA_HOME</code> environment
          variable accordingly.</p><div class="screen"><pre>$ echo $JAVA_HOME
/path/to/java
$ which java
/usr/bin/java</pre></div><p>Go to <span class="olink"><em class="citetitle">Obtaining OpenAM Software</em></span>
  to determine which version of the agent to download and download the agent.
  Also verify the checksum of the file you download against the checksum
  posted on the download page.</p><div class="note"><h3 class="title">Note</h3><p>Command line examples in this chapter show Jetty accessed remotely. If 
   you are following the examples and have issues accessing Jetty remotely,
    you might have to change the test filter settings in
   <code class="filename">/path/to/jetty/webapps/test/WEB-INF/web.xml</code>.</p><pre class="brush: xml;">&lt;filter&gt;
 &lt;filter-name&gt;TestFilter&lt;/filter-name&gt;
 &lt;filter-class&gt;com.acme.TestFilter&lt;/filter-class&gt;
 &lt;init-param&gt;
  &lt;param-name&gt;remote&lt;/param-name&gt;
  &lt;param-value&gt;true&lt;/param-value&gt; &lt;!-- default: false --&gt;
 &lt;/init-param&gt;
&lt;/filter&gt;</pre></div><p>Unzip the file in the directory where you plan to install the J2EE
  policy agent. The agent you install stores its configuration and logs
  under this directory.</p><div class="variablelist"><p>When you unzip the policy agent, you find the following directories
   under the <code class="filename">j2ee_agents/jetty_v61_agent</code> directory.</p><dl class="variablelist"><dt><span class="term"><code class="filename">bin</code></span></dt><dd><p>The installation and configuration program,
     <span class="command"><strong>agentadmin</strong></span>.</p></dd><dt><span class="term"><code class="filename">config</code></span></dt><dd><p>Configuration templates used by the <span class="command"><strong>agentadmin</strong></span>
     command during installation</p></dd><dt><span class="term"><code class="filename">data</code></span></dt><dd><p>Not used</p></dd><dt><span class="term"><code class="filename">etc</code></span></dt><dd><p>Agent web application used during installation</p></dd><dt><span class="term"><code class="filename">installer-logs</code></span></dt><dd><p>Location for log files written during installation</p></dd><dt><span class="term"><code class="filename">lib</code></span></dt><dd><p>Shared libraries used by the J2EE policy agent</p></dd><dt><span class="term"><code class="filename">locale</code></span></dt><dd><p>Property files used by the installation program</p></dd><dt><span class="term"><code class="filename">sampleapp</code></span></dt><dd><p>Sample application that demonstrates key features of the policy
     agent. Wait until you have installed the agent to deploy this.</p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="install-jetty-agent"></a>5.2.&nbsp;Installing the Jetty Policy Agent</h2></div></div></div><p>Complete the following procedures to install the policy agent.</p><div class="procedure"><a name="create-jetty-agent-profile"></a><div class="procedure-title">Procedure&nbsp;5.1.&nbsp;To Create the Jetty Agent Profile</div><p>Regardless of whether you store configurations centrally in OpenAM
   or locally with your agents, the agent requires a profile so that it can
   connect to and communicate with OpenAM.</p><ol class="procedure" type="1"><li class="step"><p>In the OpenAM console, browse to Access Control &gt;
    <em class="replaceable"><code>Realm Name</code></em> &gt; Agents &gt; J2EE,
    and then click the New... button in the Agent table.</p></li><li class="step"><p>Complete the web form using the following hints.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Name</span></dt><dd><p>The name for the agent profile used when you install the
       agent</p></dd><dt><span class="term">Password</span></dt><dd><p>Password the agent uses to authenticate to OpenAM</p></dd><dt><span class="term">Configuration</span></dt><dd><p>Centralized configurations are stored in the OpenAM configuration
       store. You can manage the centralized configuration through the OpenAM
       console. Local configurations are stored in a file alongside the
       agent.</p></dd><dt><span class="term">Server URL</span></dt><dd><p>The full URL to an OpenAM instance, or if OpenAM is deployed in
       a site configuration (behind a load balancer) then the site URL</p><p>In centralized configuration mode, the Server URL is used to
       populate the agent profile for services such as Login, Logout, Naming,
       and Cross Domain SSO.</p></dd><dt><span class="term">Agent URL</span></dt><dd><p>The URL to the J2EE agent application, such as
       <code class="literal">http://www.example.com:8080/agentapp</code></p><p>In centralized configuration mode, the Agent URL is used to
       populate the Agent Profile for services such as notifications.</p></dd></dl></div></li></ol></div><div class="procedure"><a name="create-jetty-agent-pwdfile"></a><div class="procedure-title">Procedure&nbsp;5.2.&nbsp;To Create the Password File</div><ol class="procedure" type="1"><li class="step"><p>Create a text file containing only the password.</p><div class="screen"><pre>$ echo password &gt; /tmp/pwd.txt</pre></div></li><li class="step"><p>Protect the password file you create as appropriate for your
    operating system.</p><div class="screen"><pre>$ chmod 400 /tmp/pwd.txt</pre></div></li></ol></div><div class="procedure"><a name="install-agent-into-jetty"></a><div class="procedure-title">Procedure&nbsp;5.3.&nbsp;To Install the Policy Agent into Jetty</div><ol class="procedure" type="1"><li class="step"><p>Shut down the Jetty server where you plan to install the
    agent.</p></li><li class="step"><p>Make sure OpenAM is running.</p></li><li class="step"><p>Run <span class="command"><strong>agentadmin --install</strong></span> to install the agent.</p><div class="screen"><pre>$ /path/to/j2ee_agents/jetty_v61_agent/bin/agentadmin --install
...
-----------------------------------------------
SUMMARY OF YOUR RESPONSES
-----------------------------------------------
Jetty Server Config Directory : /path/to/jetty/etc
OpenAM server URL : http://openam.example.com:8080/openam
Jetty installation directory. : /path/to/jetty
Agent URL : http://www.example.com:8080/agentapp
Agent Profile name : Jetty Agent
Agent Profile Password file name : /tmp/pwd.txt

...
SUMMARY OF AGENT INSTALLATION
-----------------------------
Agent instance name: Agent_001
Agent Bootstrap file location:
/path/to/j2ee_agents/jetty_v61_agent/Agent_001/config/
 OpenSSOAgentBootstrap.properties
Agent Configuration file location
/path/to/j2ee_agents/jetty_v61_agent/Agent_001/config/
 OpenSSOAgentConfiguration.properties
Agent Audit directory location:
/path/to/j2ee_agents/jetty_v61_agent/Agent_001/logs/audit
Agent Debug directory location:
/path/to/j2ee_agents/jetty_v61_agent/Agent_001/logs/debug


Install log file location:
/path/to/j2ee_agents/jetty_v61_agent/installer-logs/audit/install.log
...</pre></div><p>Upon successful completion, the installer has updated Jetty's
    <code class="filename">start.jar</code> to reference the agent, set up the agent
    web application, and also set up configuration and log directories for the
    agent.</p><div class="note"><h3 class="title">Note</h3><p>If the agent is in a different domain than the server, refer to <em class="citetitle">Administration Guide</em> procedure, <span class="olink"><em class="citetitle">Configuring Cross-Domain
   Single Sign On</em></span>.</p></div></li><li class="step"><p>Take note of the configuration files and log locations.</p><p>Each agent instance that you install on the system has its own
    numbered configuration and logs directory. The first agent's configuration
    and logs are thus located under the directory
    <code class="filename">j2ee_agents/jetty_v61_agent/Agent_001/</code>.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="filename">config/OpenSSOAgentBootstrap.properties</code></span></dt><dd><p>Used to bootstrap the J2EE policy agent, allowing the agent to
       connect to OpenAM and download its configuration</p></dd><dt><span class="term"><code class="filename">config/OpenSSOAgentConfiguration.properties</code></span></dt><dd><p>Only used if you configured the J2EE policy agent to use local
       configuration</p></dd><dt><span class="term"><code class="filename">logs/audit/</code></span></dt><dd><p>Operational audit log directory, only used if remote logging
       to OpenAM is disabled</p></dd><dt><span class="term"><code class="filename">logs/debug/</code></span></dt><dd><p>Debug directory where the <code class="filename">debug.out</code> debug
       file resides. Useful in troubleshooting policy agent issues.</p></dd></dl></div></li><li class="step"><p>If your policy agent configuration is not in the top-level realm (/),
       then you must edit config/OpenSSOAgentBootstrap.properties to identify
       the sub-realm that has your policy agent configuration.
       Find com.sun.identity.agents.config.organization.name and change
       the / to the path to your policy agent profile. This allows the policy agent
       to properly identify itself to the OpenAM server. </p></li><li class="step"><p>To protect a web application, you must add the following filter
    to the application's <code class="filename">web.xml</code> configuration,
    following the opening &lt;web-app&gt; tag. The file for the sample 
    application delivered with the agent is 
    <code class="filename">/path/to/j2ee_agents/jetty_v61_agent/sampleapp/etc/web.xml</code>.</p><pre class="brush: xml;"> &lt;filter&gt;
  &lt;filter-name&gt;Agent&lt;/filter-name&gt;
  &lt;display-name&gt;Agent&lt;/display-name&gt;
  &lt;description&gt;OpenAM Policy Agent Filter&lt;/description&gt;
 &lt;filter-class&gt;com.sun.identity.agents.filter.AmAgentFilter&lt;/filter-class&gt;
 &lt;/filter&gt;
 &lt;filter-mapping&gt;
  &lt;filter-name&gt;Agent&lt;/filter-name&gt;
  &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
  &lt;dispatcher&gt;REQUEST&lt;/dispatcher&gt;
  &lt;dispatcher&gt;INCLUDE&lt;/dispatcher&gt;
  &lt;dispatcher&gt;FORWARD&lt;/dispatcher&gt;
  &lt;dispatcher&gt;ERROR&lt;/dispatcher&gt;
 &lt;/filter-mapping&gt;</pre></li><li class="step"><p>Start the Jetty server where you installed the agent.</p><div class="screen"><pre>$ cd /path/to/jetty ; java -jar start.jar
...
2011-09-15 12:49:55.469:INFO::Extract file:/path/to/jetty/webapps/agentapp.war
...
2011-09-15 12:50:14.163:INFO::Started SelectChannelConnector@0.0.0.0:8080</pre></div></li><li class="step"><p>If you have a policy configured, you can test your policy agent.
    For example, try to browse to a resource that your policy agent protects.
    You should be redirected to OpenAM to authenticate, for example as user
    <code class="literal">demo</code>, password <code class="literal">changeit</code>. After
    you authenticate, OpenAM then redirects you back to the resource you tried
    to access.</p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="silent-jetty-agent-installation"></a>5.3.&nbsp;Silent Jetty Policy Agent Installation</h2></div></div></div><p>When performing a scripted, silent installation, use
  <span class="command"><strong>agentadmin --install --saveResponse
  <em class="replaceable"><code>response-file</code></em></strong></span>
  to create a response file for scripted installation. Then install silently
  using <span class="command"><strong>agentadmin --install --useResponse
  <em class="replaceable"><code>response-file</code></em></strong></span>.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="uninstall-jetty-agent"></a>5.4.&nbsp;Removing Jetty Policy Agent Software</h2></div></div></div><p>Shut down the Jetty server before you uninstall the
    policy agent.</p><p>To remove the J2EE policy agent, use <span class="command"><strong>agentadmin
  --uninstall</strong></span>. You must provide the Jetty configuration directory
  location.</p><p>Uninstall does not remove the agent instance directory, but you can
  do so manually after removing the agent configuration from Jetty.</p></div></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-weblogic"></a>Chapter&nbsp;6.&nbsp;Installing the Oracle WebLogic Policy Agent</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="section"><a href="#before-weblogic-agent-install">6.1. Before You Install</a></span></dt><dt><span class="section"><a href="#install-weblogic-agent">6.2. Installing the WebLogic Policy Agent</a></span></dt><dt><span class="section"><a href="#silent-weblogic-agent-installation">6.3. Silent WebLogic Policy Agent Installation</a></span></dt><dt><span class="section"><a href="#post-weblogic-agent-installation">6.4. Post Installation of WebLogic Policy Agent</a></span></dt><dt><span class="section"><a href="#uninstall-weblogic-agent">6.5. Removing WebLogic Policy Agent Software</a></span></dt></dl></div><a class="indexterm" name="d1498e1690"></a><p>This chapter covers installation of the policy agent for Oracle
 WebLogic.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="before-weblogic-agent-install"></a>6.1.&nbsp;Before You Install</h2></div></div></div><p>Make sure OpenAM is installed and running, and that you can contact OpenAM
  from the system running the policy agent. Next, create a profile for your
  policy agent as described in the <em class="citetitle">Administration Guide</em>
  section on <span class="olink"><em class="citetitle">Creating Agent
  Profiles</em></span>. To protect resources with the agent also create
  at least one policy as described in the section on <span class="olink"><em class="citetitle">Configuring
  Policies</em></span>. Consider creating a simple policy, such as a
  policy that allows only authenticated users to access your resources, in order
  to test your policy agent after installation.</p><p>You must install WebLogic before you install the policy agent, and you
  must stop the server during installation.</p><p>You must install a supported version of the Java runtime environment.
          Please review the <a href="../jee-release-notes/index.html#java-requirements-javaee-agents" class="link">
              <em class="citetitle">Release Notes</em></a> for the currently supported version
          of Java, and set the <code class="literal">JAVA_HOME</code> environment
          variable accordingly.</p><div class="screen"><pre>$ echo $JAVA_HOME
/path/to/java
$ which java
/usr/bin/java</pre></div><p>Go to <span class="olink"><em class="citetitle">Obtaining OpenAM Software</em></span>
  to determine which version of the agent to download and download the agent.
  Also verify the checksum of the file you download against the checksum
  posted on the download page.</p><p>Unzip the file in the directory where you plan to install the J2EE
  policy agent. The agent you install stores its configuration and logs
  under this directory.</p><div class="variablelist"><p>When you unzip the policy agent, you find the following directories
   under the <code class="filename">j2ee_agents/weblogic_v10_agent</code> directory.</p><dl class="variablelist"><dt><span class="term"><code class="filename">bin</code></span></dt><dd><p>The installation and configuration program,
     <span class="command"><strong>agentadmin</strong></span>.</p></dd><dt><span class="term"><code class="filename">config</code></span></dt><dd><p>Configuration templates used by the <span class="command"><strong>agentadmin</strong></span>
     command during installation</p></dd><dt><span class="term"><code class="filename">data</code></span></dt><dd><p>Not used</p></dd><dt><span class="term"><code class="filename">etc</code></span></dt><dd><p>Agent web application and startup configuration</p></dd><dt><span class="term"><code class="filename">installer-logs</code></span></dt><dd><p>Location for log files written during installation</p></dd><dt><span class="term"><code class="filename">lib</code></span></dt><dd><p>Shared libraries used by the J2EE policy agent</p></dd><dt><span class="term"><code class="filename">locale</code></span></dt><dd><p>Property files used by the installation program</p></dd><dt><span class="term"><code class="filename">sampleapp</code></span></dt><dd><p>Sample application that demonstrates key features of the policy
     agent. Wait until you have installed the agent to deploy this.</p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="install-weblogic-agent"></a>6.2.&nbsp;Installing the WebLogic Policy Agent</h2></div></div></div><p>Complete the following procedures to install the policy agent.</p><div class="procedure"><a name="create-weblogic-agent-profile"></a><div class="procedure-title">Procedure&nbsp;6.1.&nbsp;To Create the WebLogic Agent Profile</div><p>Regardless of whether you store configurations centrally in OpenAM
   or locally with your agents, the agent requires a profile so that it can
   connect to and communicate with OpenAM.</p><ol class="procedure" type="1"><li class="step"><p>In the OpenAM console, browse to Access Control &gt;
    <em class="replaceable"><code>Realm Name</code></em> &gt; Agents &gt; J2EE,
    and then click the New... button in the Agent table.</p></li><li class="step"><p>Complete the web form using the following hints.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Name</span></dt><dd><p>The name for the agent profile used when you install the
       agent</p></dd><dt><span class="term">Password</span></dt><dd><p>Password the agent uses to authenticate to OpenAM</p></dd><dt><span class="term">Configuration</span></dt><dd><p>Centralized configurations are stored in the OpenAM configuration
       store. You can manage the centralized configuration through the OpenAM
       console. Local configurations are stored in a file alongside the
       agent.</p></dd><dt><span class="term">Server URL</span></dt><dd><p>The full URL to an OpenAM instance, or if OpenAM is deployed in
       a site configuration (behind a load balancer) then the site URL</p><p>In centralized configuration mode, the Server URL is used to
       populate the agent profile for services such as Login, Logout, Naming,
       and Cross Domain SSO.</p></dd><dt><span class="term">Agent URL</span></dt><dd><p>The URL to the J2EE agent application, such as
       <code class="literal">http://www.example.com:8080/agentapp</code></p><p>In centralized configuration mode, the Agent URL is used to
       populate the Agent Profile for services such as notifications.</p></dd></dl></div></li></ol></div><div class="procedure"><a name="create-weblogic-agent-pwdfile"></a><div class="procedure-title">Procedure&nbsp;6.2.&nbsp;To Create the Password File</div><ol class="procedure" type="1"><li class="step"><p>Create a text file containing only the password.</p><div class="screen"><pre>$ echo password &gt; /tmp/pwd.txt</pre></div></li><li class="step"><p>Protect the password file you create as appropriate for your
    operating system.</p><div class="screen"><pre>$ chmod 400 /tmp/pwd.txt</pre></div></li></ol></div><div class="procedure"><a name="install-agent-into-weblogic"></a><div class="procedure-title">Procedure&nbsp;6.3.&nbsp;To Install the Policy Agent into WebLogic</div><ol class="procedure" type="1"><li class="step"><p>Shut down the WebLogic server where you plan to install the
    agent.</p></li><li class="step"><p>Make sure OpenAM is running.</p></li><li class="step"><p>Run <span class="command"><strong>agentadmin --install</strong></span> to install the agent.</p><div class="screen"><pre>$ /path/to/j2ee_agents/weblogic_v10_agent/bin/agentadmin --install
...
-----------------------------------------------
SUMMARY OF YOUR RESPONSES
-----------------------------------------------
Startup script location :
/path/to/domain/mydomain/bin/startWebLogic.sh
WebLogic Server instance name : AdminServer
WebLogic home directory : /path/to/wlserver
OpenAM server URL : http://openam.example.com:8080/openam
Agent URL : http://www.example.com:7001/agentapp
Agent Profile name : WebLogic Agent
Agent Profile Password file name : /tmp/pwd.txt

...
SUMMARY OF AGENT INSTALLATION
-----------------------------
Agent instance name: Agent_001
Agent Bootstrap file location:
/path/to/j2ee_agents/weblogic_v10_agent/Agent_001/config/
 OpenSSOAgentBootstrap.properties
Agent Configuration file location
/path/to/j2ee_agents/weblogic_v10_agent/Agent_001/config/
 OpenSSOAgentConfiguration.properties
Agent Audit directory location:
/path/to/j2ee_agents/weblogic_v10_agent/Agent_001/logs/audit
Agent Debug directory location:
/path/to/j2ee_agents/weblogic_v10_agent/Agent_001/logs/debug


Install log file location:
/path/to/j2ee_agents/weblogic_v10_agent/installer-logs/audit/install.log
...</pre></div><p>Upon successful completion, the installer has updated the WebLogic
    configuration, copied the agent libraries to WebLogic's library directory,
    and also set up configuration and log directories for the agent.</p><div class="note"><h3 class="title">Note</h3><p>If the agent is in a different domain than the server, refer to <em class="citetitle">Administration Guide</em> procedure, <span class="olink"><em class="citetitle">Configuring Cross-Domain
   Single Sign On</em></span>.</p></div></li><li class="step"><p>Take note of the configuration files and log locations.</p><p>Each agent instance that you install on the system has its own
    numbered configuration and logs directory. The first agent's configuration
    and logs are thus located under the directory
    <code class="filename">j2ee_agents/weblogic_v10_agent/Agent_001/</code>.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="filename">config/OpenSSOAgentBootstrap.properties</code></span></dt><dd><p>Used to bootstrap the J2EE policy agent, allowing the agent to
       connect to OpenAM and download its configuration</p></dd><dt><span class="term"><code class="filename">config/OpenSSOAgentConfiguration.properties</code></span></dt><dd><p>Only used if you configured the J2EE policy agent to use local
       configuration</p></dd><dt><span class="term"><code class="filename">logs/audit/</code></span></dt><dd><p>Operational audit log directory, only used if remote logging
       to OpenAM is disabled</p></dd><dt><span class="term"><code class="filename">logs/debug/</code></span></dt><dd><p>Debug directory where the debug file resides. Useful in
       troubleshooting policy agent issues.</p></dd></dl></div></li><li class="step"><p>If your policy agent configuration is not in the top-level realm (/),
       then you must edit config/OpenSSOAgentBootstrap.properties to identify
       the sub-realm that has your policy agent configuration.
       Find com.sun.identity.agents.config.organization.name and change
       the / to the path to your policy agent profile. This allows the policy agent
       to properly identify itself to the OpenAM server. </p></li><li class="step"><p>The agent requires sourcing before it will work properly. There are two 
    ways to source.</p><ul class="stepalternatives">
     <li class="step"><p>Manually source the file containing the policy agent environment settings for 
      WebLogic before starting the application server. </p><div class="screen"><pre>. /path/to/setAgentEnv_AdminServer.sh</pre></div></li>
     <li class="step"><p>Or edit the <code class="filename">startWebLogic.sh</code> script to set the sourcing
      needed for the agent, by adding these lines after the code block shown. Add the
      setAgentEnv_AdminServer.sh line to the following location in the file. The drawback 
      to this approach is that it could be overwritten, as noted in the file.</p><div class="screen"><pre>$ vi /path/to/startWebLogic.sh
 # Any changes to this script may be lost when adding extensions to this configuration.
 DOMAIN_HOME="/opt/Oracle/Middleware/user_projects/domains/base_domain"
  . /path/to/setAgentEnv_AdminServer.sh
 ${DOMAIN_HOME}/bin/startWebLogic.sh $*</pre></div></li>
    </ul><div class="note"><h3 class="title">Note</h3><p>If the sourcing is not properly set, the following message appears.</p><div class="screen"><pre>&lt;Error&gt; &lt;HTTP&gt; &lt;cent.example.com&gt; 
 &lt;AdminServer&gt; &lt;[STANDBY] ExecuteThread: '5' for queue: 'weblogic.kernel.Default 
 (self-tuning)'&gt; &lt;&lt;WLS Kernel&gt;&gt; &lt;&gt;&lt;&gt; &lt;&gt; &lt;1360800613441&gt; 
 &lt;BEA-101165&gt; &lt;Could not load user defined filter in web.xml: 
 ServletContext@1761850405[app:agentapp module:agentapp.war path:null 
 spec-version:null] com.sun.identity.agents.filter.AmAgentFilter.
 java.lang.ClassNotFoundException: com.sun.identity.agents.filter.AmAgentFilter</pre></div></div></li><li class="step"><p>Start the WebLogic server.</p></li><li class="step"><p>Configure shutdown classes for the environment.</p><ol type="a" class="substeps"><li class="step"><p>In WebLogic console, browse to Environment &gt; Startup &amp;
      Shutdown Classes.</p></li><li class="step"><p>Click Lock &amp; Edit.</p></li><li class="step"><p>Click New.</p></li><li class="step"><p>Select the Shutdown Class option, and then click Next.</p></li><li class="step"><p>Provide the Name <code class="literal">Agent</code>, and the Class Name
      <code class="literal">org.forgerock.agents.weblogic.v10.lifecycle.ShutdownListener</code>.</p></li><li class="step"><p>Select the appropriate targets to call the shutdown class once per
      Java Virtual Machine, and then click Finish.</p></li><li class="step"><p>Click Activate Changes.</p></li></ol></li></ol></div><div class="procedure"><a name="protect-weblogic-apps-after-agent-installation"></a><div class="procedure-title">Procedure&nbsp;6.4.&nbsp;To Protect Applications After Agent Installation</div><ol class="procedure" type="1"><li class="step"><p>Deploy the
    <code class="filename">/path/to/j2ee_agents/weblogic_v10_agent/etc/agentapp.war</code>
    agent application in WebLogic.</p></li><li class="step"><p>For each web application to protect, add the following filter
    to the application's <code class="filename">web.xml</code> configuration,
    following the opening &lt;web-app&gt; tag. The file for the sample 
    application delivered with the agent is 
    <code class="filename">/path/to/j2ee_agents/weblogic_v10_agent/sampleapp/etc/web.xml</code>.</p><pre class="brush: xml;"> &lt;filter&gt;
  &lt;filter-name&gt;Agent&lt;/filter-name&gt;
  &lt;display-name&gt;Agent&lt;/display-name&gt;
  &lt;description&gt;OpenAM Policy Agent Filter&lt;/description&gt;
 &lt;filter-class&gt;com.sun.identity.agents.filter.AmAgentFilter&lt;/filter-class&gt;
 &lt;/filter&gt;
 &lt;filter-mapping&gt;
  &lt;filter-name&gt;Agent&lt;/filter-name&gt;
  &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
  &lt;dispatcher&gt;REQUEST&lt;/dispatcher&gt;
  &lt;dispatcher&gt;INCLUDE&lt;/dispatcher&gt;
  &lt;dispatcher&gt;FORWARD&lt;/dispatcher&gt;
  &lt;dispatcher&gt;ERROR&lt;/dispatcher&gt;
 &lt;/filter-mapping&gt;</pre><p>You might also have to update additional configuration files. See
    the sample application located under
    <code class="filename">/path/to/j2ee_agents/weblogic_v10_agent/sampleapp</code>
    for examples.</p></li><li class="step"><p>If you have a policy configured, you can test your policy agent.
    For example, try to browse to a resource that your policy agent protects.
    You should be redirected to OpenAM to authenticate, for example as user
    <code class="literal">demo</code>, password <code class="literal">changeit</code>. After
    you authenticate, OpenAM then redirects you back to the resource you tried
    to access.</p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="silent-weblogic-agent-installation"></a>6.3.&nbsp;Silent WebLogic Policy Agent Installation</h2></div></div></div><p>When performing a scripted, silent installation, use
  <span class="command"><strong>agentadmin --install --saveResponse
  <em class="replaceable"><code>response-file</code></em></strong></span>
  to create a response file for scripted installation. Then install silently
  using <span class="command"><strong>agentadmin --install --useResponse
  <em class="replaceable"><code>response-file</code></em></strong></span>.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="post-weblogic-agent-installation"></a>6.4.&nbsp;Post Installation of WebLogic Policy Agent</h2></div></div></div><p>After installing WebLogic, some configuration is required before
  the policy agent will work.</p><div class="procedure"><a name="configure-weblogic-agent"></a><div class="procedure-title">Procedure&nbsp;6.5.&nbsp;To Configure the WebLogic Policy Agent</div><p>WebLogic is unique in that it requires additional configuration
   after the installation is complete.</p><ol class="procedure" type="1"><li class="step"><p>Go to the WebLogic Server Administratotion Console and login.</p></li><li class="step"><p>Click <code class="literal">Security realms</code>.</p></li><li class="step"><p>Click the name of the realm to use for OpenAM.</p></li><li class="step"><p>Click <code class="literal">Providers</code> &gt; <code class="literal">Authentication</code>.</p></li><li class="step"><p>Click <code class="literal">Lock &amp; Edit</code> &gt; <code class="literal">New</code>.</p></li><li class="step"><p>Enter the desired type in <code class="literal">Type as AgentAuthenticator</code>,
    provide a name, and click <code class="literal">OK</code>.</p></li><li class="step"><p>Click on the name of the agent authenticator you just created.</p></li><li class="step"><p>Use <code class="literal">OPTIONAL</code> for the control flag and save.</p></li><li class="step"><p>Click on <code class="literal">Providers</code> to display the Authentication
    Providers Table.</p></li><li class="step"><p>Click on <code class="literal">Default Authenticator</code>, use <code class="literal">OPTIONAL</code>
    for the control flag, and save.</p></li><li class="step"><p>Activate the changes once the default authenticator is done saving.</p><p>You will need to restart the WebLogic Server to implement the changes.</p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="uninstall-weblogic-agent"></a>6.5.&nbsp;Removing WebLogic Policy Agent Software</h2></div></div></div><p>Shut down the WebLogic server before you uninstall the
    policy agent.</p><p>To remove the J2EE policy agent, use <span class="command"><strong>agentadmin
  --uninstall</strong></span>. You must provide the WebLogic configuration directory
  location.</p><p>Uninstall does not remove the agent instance directory, but you can
  do so manually after removing the agent configuration from WebLogic.</p></div></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-websphere"></a>Chapter&nbsp;7.&nbsp;Installing the IBM WebSphere Policy Agent</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="section"><a href="#before-websphere-agent-install">7.1. Before You Install</a></span></dt><dt><span class="section"><a href="#install-websphere-agent">7.2. Installing the WebSphere Policy Agent</a></span></dt><dt><span class="section"><a href="#silent-websphere-agent-installation">7.3. Silent WebSphere Policy Agent Installation</a></span></dt><dt><span class="section"><a href="#uninstall-websphere-agent">7.4. Removing WebSphere Policy Agent Software</a></span></dt><dt><span class="section"><a href="#websphere-network-deployment">7.5. Notes About WebSphere Network Deployment</a></span></dt></dl></div><a class="indexterm" name="d1498e2142"></a><p>This chapter covers installation of the policy agent for IBM
 WebSphere.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="before-websphere-agent-install"></a>7.1.&nbsp;Before You Install</h2></div></div></div><p>Make sure OpenAM is installed and running, and that you can contact OpenAM
  from the system running the policy agent. Next, create a profile for your
  policy agent as described in the <em class="citetitle">Administration Guide</em>
  section on <span class="olink"><em class="citetitle">Creating Agent
  Profiles</em></span>. To protect resources with the agent also create
  at least one policy as described in the section on <span class="olink"><em class="citetitle">Configuring
  Policies</em></span>. Consider creating a simple policy, such as a
  policy that allows only authenticated users to access your resources, in order
  to test your policy agent after installation.</p><p>You must install WebSphere before you install the policy agent, and you
  must stop the server during installation.</p><p>You must install a supported version of the Java runtime environment.
          Please review the <a href="../jee-release-notes/index.html#java-requirements-javaee-agents" class="link">
              <em class="citetitle">Release Notes</em></a> for the currently supported version
          of Java, and set the <code class="literal">JAVA_HOME</code> environment
          variable accordingly.</p><div class="screen"><pre>$ echo $JAVA_HOME
/path/to/java
$ which java
/usr/bin/java</pre></div><p>If you are using IBM Java, see <a class="xref" href="#install-with-ibm-jvm" title="Procedure&nbsp;7.1.&nbsp;To Install With IBM Java">Procedure&nbsp;7.1, &#8220;To Install With IBM Java&#8221;</a>.</p><p>Go to <span class="olink"><em class="citetitle">Obtaining OpenAM Software</em></span>
  to determine which version of the agent to download and download the agent.
  Also verify the checksum of the file you download against the checksum
  posted on the download page.</p><p>Unzip the file in the directory where you plan to install the J2EE
  policy agent. The agent you install stores its configuration and logs
  under this directory.</p><div class="variablelist"><p>When you unzip the policy agent, you find the following directories
   under the <code class="filename">j2ee_agents/websphere_v61_agent</code> directory.</p><dl class="variablelist"><dt><span class="term"><code class="filename">bin</code></span></dt><dd><p>The installation and configuration program,
     <span class="command"><strong>agentadmin</strong></span>.</p></dd><dt><span class="term"><code class="filename">config</code></span></dt><dd><p>Configuration templates used by the <span class="command"><strong>agentadmin</strong></span>
     command during installation</p></dd><dt><span class="term"><code class="filename">data</code></span></dt><dd><p>Not used</p></dd><dt><span class="term"><code class="filename">etc</code></span></dt><dd><p>Agent web application that handles notifications and Cross
     Domain SSO</p></dd><dt><span class="term"><code class="filename">installer-logs</code></span></dt><dd><p>Location for log files written during installation</p></dd><dt><span class="term"><code class="filename">lib</code></span></dt><dd><p>Shared libraries used by the J2EE policy agent</p></dd><dt><span class="term"><code class="filename">locale</code></span></dt><dd><p>Property files used by the installation program</p></dd><dt><span class="term"><code class="filename">sampleapp</code></span></dt><dd><p>Sample application that demonstrates key features of the policy
     agent. Wait until you have installed the agent to deploy this.</p></dd></dl></div><div class="procedure"><a name="install-with-ibm-jvm"></a><div class="procedure-title">Procedure&nbsp;7.1.&nbsp;To Install With IBM Java</div><p>The WebSphere policy agent runs with IBM Java. In order to install
   the policy agent using IBM Java on platforms other than AIX, you must first
   change the <span class="command"><strong>agentadmin</strong></span> script to use IBMJCE.</p><ol class="procedure" type="1"><li class="step"><p>Open the file, <code class="filename">bin/agentadmin</code>
    (<code class="filename">bin/agentadmin.bat</code> on Windows), for editing.</p></li><li class="step"><p>Edit the line specifying <code class="literal">AGENT_OPTS</code> on platforms
    other than AIX.</p><pre class="literallayout">AGENT_OPTS="-DamKeyGenDescriptor.provider=IBMJCE \
 -DamCryptoDescriptor.provider=IBMJCE -DamRandomGenProvider=IBMJCE"</pre></li><li class="step"><p>Edit the last line to include the IBMJCE settings before the
    classpath is set.</p><pre class="literallayout">$JAVA_VM \
 -DamCryptoDescriptor.provider=IBMJCE -DamKeyGenDescriptor.provider=IBMJCE \
 -classpath "$AGENT_CLASSPATH" $AGENT_OPTS \
 com.sun.identity.install.tools.launch.AdminToolLauncher $*</pre></li><li class="step"><p>Save your work.</p><p>You can now install the WebSphere policy agent with IBM Java as
    described in <a class="xref" href="#install-websphere-agent" title="7.2.&nbsp;Installing the WebSphere Policy Agent">Section&nbsp;7.2, &#8220;Installing the WebSphere Policy Agent&#8221;</a>.</p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="install-websphere-agent"></a>7.2.&nbsp;Installing the WebSphere Policy Agent</h2></div></div></div><p>Complete the following procedures to install the policy agent.</p><div class="procedure"><a name="create-websphere-agent-profile"></a><div class="procedure-title">Procedure&nbsp;7.2.&nbsp;To Create the WebSphere Agent Profile</div><p>Regardless of whether you store configurations centrally in OpenAM
   or locally with your agents, the agent requires a profile so that it can
   connect to and communicate with OpenAM.</p><ol class="procedure" type="1"><li class="step"><p>In the OpenAM console, browse to Access Control &gt;
    <em class="replaceable"><code>Realm Name</code></em> &gt; Agents &gt; J2EE,
    and then click the New... button in the Agent table.</p></li><li class="step"><p>Complete the web form using the following hints.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Name</span></dt><dd><p>The name for the agent profile used when you install the
       agent</p></dd><dt><span class="term">Password</span></dt><dd><p>Password the agent uses to authenticate to OpenAM</p></dd><dt><span class="term">Configuration</span></dt><dd><p>Centralized configurations are stored in the OpenAM configuration
       store. You can manage the centralized configuration through the OpenAM
       console. Local configurations are stored in a file alongside the
       agent.</p></dd><dt><span class="term">Server URL</span></dt><dd><p>The full URL to an OpenAM instance, or if OpenAM is deployed in
       a site configuration (behind a load balancer) then the site URL</p><p>In centralized configuration mode, the Server URL is used to
       populate the agent profile for services such as Login, Logout, Naming,
       and Cross Domain SSO.</p></dd><dt><span class="term">Agent URL</span></dt><dd><p>The URL to the J2EE agent application, such as
       <code class="literal">http://www.example.com:8080/agentapp</code></p><p>In centralized configuration mode, the Agent URL is used to
       populate the Agent Profile for services such as notifications.</p></dd></dl></div></li></ol></div><div class="procedure"><a name="create-websphere-agent-pwdfile"></a><div class="procedure-title">Procedure&nbsp;7.3.&nbsp;To Create the Password File</div><ol class="procedure" type="1"><li class="step"><p>Create a text file containing only the password.</p><div class="screen"><pre>$ echo password &gt; /tmp/pwd.txt</pre></div></li><li class="step"><p>Protect the password file you create as appropriate for your
    operating system.</p><div class="screen"><pre>$ chmod 400 /tmp/pwd.txt</pre></div></li></ol></div><div class="procedure"><a name="install-agent-into-websphere"></a><div class="procedure-title">Procedure&nbsp;7.4.&nbsp;To Install the Policy Agent into WebSphere</div><ol class="procedure" type="1"><li class="step"><p>Shut down the WebSphere server where you plan to install the
    agent.</p></li><li class="step"><p>Make sure OpenAM is running.</p></li><li class="step"><p>Run <span class="command"><strong>agentadmin --install</strong></span> to install the agent.</p><div class="screen"><pre>$ /path/to/j2ee_agents/websphere_v61_agent/bin/agentadmin --install
...
-----------------------------------------------
SUMMARY OF YOUR RESPONSES
-----------------------------------------------
Instance Config Directory :
/path/to/WebSphere/AppServer/profiles/AppSrv01/config/cells/wwwNode01Cell/
 nodes/wwwNode01/servers/server1

Instance Server name : server1 
WebSphere Install Root Directory : /path/to/WebSphere/AppServer 
OpenAM server URL : http://openam.example.com:8080/openam 
Agent URL : http://www.example.com:9080/agentapp 
Agent Profile name : WebSphere Agent 
Agent Profile Password file name : /tmp/pwd.txt

...
SUMMARY OF AGENT INSTALLATION
-----------------------------
Agent instance name: Agent_001
Agent Bootstrap file location:
/path/to/j2ee_agents/websphere_v61_agent/Agent_001/config/
 OpenSSOAgentBootstrap.properties
Agent Configuration file location
/path/to/j2ee_agents/websphere_v61_agent/Agent_001/config/
 OpenSSOAgentConfiguration.properties
Agent Audit directory location:
/path/to/j2ee_agents/websphere_v61_agent/Agent_001/logs/audit
Agent Debug directory location:
/path/to/j2ee_agents/websphere_v61_agent/Agent_001/logs/debug


Install log file location:
/path/to/j2ee_agents/websphere_v61_agent/installer-logs/audit/install.log
...</pre></div><p>Upon successful completion, the installer has updated the WebSphere
    configuration, copied the agent libraries to WebSphere's external library
    directory, and also set up configuration and log directories for the
    agent.</p><div class="note"><h3 class="title">Note</h3><p>If the agent is in a different domain than the server, refer to <em class="citetitle">Administration Guide</em> procedure, <span class="olink"><em class="citetitle">Configuring Cross-Domain
   Single Sign On</em></span>.</p></div></li><li class="step"><p>Take note of the configuration files and log locations.</p><p>Each agent instance that you install on the system has its own
    numbered configuration and logs directory. The first agent's configuration
    and logs are thus located under the directory
    <code class="filename">j2ee_agents/websphere_v61_agent/Agent_001/</code>.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="filename">config/OpenSSOAgentBootstrap.properties</code></span></dt><dd><p>Used to bootstrap the J2EE policy agent, allowing the agent to
       connect to OpenAM and download its configuration</p></dd><dt><span class="term"><code class="filename">config/OpenSSOAgentConfiguration.properties</code></span></dt><dd><p>Only used if you configured the J2EE policy agent to use local
       configuration</p></dd><dt><span class="term"><code class="filename">logs/audit/</code></span></dt><dd><p>Operational audit log directory, only used if remote logging
       to OpenAM is disabled</p></dd><dt><span class="term"><code class="filename">logs/debug/</code></span></dt><dd><p>Debug directory where the debug file resides. Useful in
       troubleshooting policy agent issues.</p></dd></dl></div></li><li class="step"><p>If your policy agent configuration is not in the top-level realm (/),
       then you must edit config/OpenSSOAgentBootstrap.properties to identify
       the sub-realm that has your policy agent configuration.
       Find com.sun.identity.agents.config.organization.name and change
       the / to the path to your policy agent profile. This allows the policy agent
       to properly identify itself to the OpenAM server. </p></li><li class="step"><p>Restart the WebSphere server.</p></li></ol></div><div class="procedure"><a name="protect-websphere-apps-after-agent-installation"></a><div class="procedure-title">Procedure&nbsp;7.5.&nbsp;To Protect Applications After Agent Installation</div><ol class="procedure" type="1"><li class="step"><p>Deploy the
    <code class="filename">/path/to/j2ee_agents/websphere_v61_agent/etc/agentapp.war</code>
    agent application in WebSphere.</p></li><li class="step"><p>For each web application to protect, add the following filter
    to the application's <code class="filename">web.xml</code> configuration,
    following the opening &lt;web-app&gt; tag. The file for the sample 
    application delivered with the agent is 
    <code class="filename">/path/to/j2ee_agents/websphere_v61_agent/sampleapp/etc/web.xml</code>.</p><pre class="brush: xml;"> &lt;filter&gt;
  &lt;filter-name&gt;Agent&lt;/filter-name&gt;
  &lt;display-name&gt;Agent&lt;/display-name&gt;
  &lt;description&gt;OpenAM Policy Agent Filter&lt;/description&gt;
 &lt;filter-class&gt;com.sun.identity.agents.filter.AmAgentFilter&lt;/filter-class&gt;
 &lt;/filter&gt;
 &lt;filter-mapping&gt;
  &lt;filter-name&gt;Agent&lt;/filter-name&gt;
  &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
  &lt;dispatcher&gt;REQUEST&lt;/dispatcher&gt;
  &lt;dispatcher&gt;INCLUDE&lt;/dispatcher&gt;
  &lt;dispatcher&gt;FORWARD&lt;/dispatcher&gt;
  &lt;dispatcher&gt;ERROR&lt;/dispatcher&gt;
 &lt;/filter-mapping&gt;</pre><p>You might also have to update additional configuration files. See
    the sample application located under
    <code class="filename">/path/to/j2ee_agents/websphere_v61_agent/sampleapp</code>
    for examples.</p></li><li class="step"><p>If you have a policy configured, you can test your policy agent.
    For example, try to browse to a resource that your policy agent protects.
    You should be redirected to OpenAM to authenticate, for example as user
    <code class="literal">demo</code>, password <code class="literal">changeit</code>. After
    you authenticate, OpenAM then redirects you back to the resource you tried
    to access.</p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="silent-websphere-agent-installation"></a>7.3.&nbsp;Silent WebSphere Policy Agent Installation</h2></div></div></div><p>When performing a scripted, silent installation, use
  <span class="command"><strong>agentadmin --install --saveResponse
  <em class="replaceable"><code>response-file</code></em></strong></span>
  to create a response file for scripted installation. Then install silently
  using <span class="command"><strong>agentadmin --install --useResponse
  <em class="replaceable"><code>response-file</code></em></strong></span>.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="uninstall-websphere-agent"></a>7.4.&nbsp;Removing WebSphere Policy Agent Software</h2></div></div></div><p>Shut down the WebSphere server before you uninstall the
    policy agent.</p><p>To remove the J2EE policy agent, use <span class="command"><strong>agentadmin
  --uninstall</strong></span>. You must provide the WebSphere configuration directory
  location.</p><p>Uninstall does not remove the agent instance directory, but you can
  do so manually after removing the agent configuration from WebSphere.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="websphere-network-deployment"></a>7.5.&nbsp;Notes About WebSphere Network Deployment</h2></div></div></div><p>When using WebSphere Application Server Network Deployment, you must
  install policy agents on the Deployment Manager, on each Node Agent, and
  on each Application Server. Installation requires that you stop and then
  restart the Deployment Manager, each Node Agent, and each Application Server
  in the Network Deployment.</p><p>Before installation, synchronize each server configuration with the
  profile saved by the Deployment Manager using the <span class="command"><strong>syncNode</strong></span>
  command. After agent installation, copy the server configuration for each
  node, stored in <code class="filename">server.xml</code>, to the corresponding
  Deployment Manager profile. After you have synchronized the configurations,
  you must restart the Deployment Manager for the Network Deployment.</p></div></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-troubleshooting"></a>Chapter&nbsp;8.&nbsp;Troubleshooting</h1></div></div></div><a class="indexterm" name="d1498e2513"></a><p>This chapter offers solutions to issues during installation of OpenAM
  policy agents.</p><div class="qandaset"><h2 class="title"><a name="solutions-to-common-issues"></a>Solutions to Common Issues</h2><p>This section offers solutions to common problems when installing 
   OpenAM policy agents.</p><table border="0" style="width: 100%;"><colgroup><col align="left" width="1%"><col></colgroup><tbody><tr class="question"><td align="left" valign="top"><a name="cannot-install-over-https"></a><a name="d1498e2524"></a><p><b>Q:</b></p></td><td align="left" valign="top"><p>I am trying to install a policy agent, connecting to OpenAM over
    HTTPS, and seeing the following error.</p><div class="screen"><pre>OpenAM server URL: https://openam.example.com:8443/openam

WARNING: Unable to connect to OpenAM server URL. Please specify the
correct OpenAM server URL by hitting the Back button (&lt;) or if the OpenAM
server URL is not started and you want to start it later, please proceed with
the installation.
If OpenAM server is SSL enabled and the root CA certificate for the OpenAM
server certificate has been not imported into installer JVMs key store (see
installer-logs/debug/Agent.log for detailed exception), import the root
CA certificate and restart the installer; or continue installation without
verifying OpenAM server URL.</pre></div><p>What should I do?</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>A:</b></p></td><td align="left" valign="top"><p>The Java platform includes certificates from many Certificate
    Authorities (CAs). If however you run your own CA, or you use self-signed
    certificates for HTTPS on the container where you run OpenAM, then the
    <span class="command"><strong>agentadmin</strong></span> command cannot trust the certificate
    presented during connection to OpenAM, and so cannot complete installation
    correctly.</p><p>After setting up the container where you run OpenAM to use HTTPS,
    get the certificate to trust in a certificate file. The certificate you
    want is the that of the CA who signed the container certificate, or the
    certificate itself if the container certificate is self-signed.</p><p>Copy the certificate file to the system where you plan to install the
    policy agent. Import the certificate into a trust store that you will use
    during policy agent installation. If you import the certificate into the
    default trust store for the Java platform, then the
    <span class="command"><strong>agentadmin</strong></span> command can recognize it without additional
    configuration.</p><p>Export and import of self-signed certificates is demonstrated in the
    <em class="citetitle">Administration Guide</em> chapter on <span class="olink"><em class="citetitle">Managing
    Certificates</em></span>.</p></td></tr><tr class="question"><td align="left" valign="top"><a name="cannot-install-with-ibm-java"></a><a name="d1498e2554"></a><p><b>Q:</b></p></td><td align="left" valign="top"><p>I am trying to install the WebSphere policy agent on Linux.
    The system has IBM Java. When I run <span class="command"><strong>agentadmin --install</strong></span>,
    the script fails to encrypt the password from the password file, ending
    with this message:</p><pre class="literallayout">ERROR: An unknown error has occurred (null). Please try again.</pre><p>What should I do?</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>A:</b></p></td><td align="left" valign="top"><p>You must edit <span class="command"><strong>agentadmin</strong></span> to use IBMJCE, and then
    try again.</p><p>See <span class="olink"><em class="citetitle">To Install
    With IBM Java</em></span>.</p></td></tr><tr class="question"><td align="left" valign="top"><a name="websphere-SRVE0190E-file-not-found"></a><a name="d1498e2577"></a><p><b>Q:</b></p></td><td align="left" valign="top"><p>After installing a Java EE policy agent on WebSphere AS 7 or 8,
    accessing a URL for a folder in a protected application such as
    <code class="literal">http://openam.example.com:9080/test/</code> results in
    <code class="literal">Error 404: SRVE0190E: File not found: {0}</code>, and
    redirection fails. What should I do to work around this problem?</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>A:</b></p></td><td align="left" valign="top"><p>Perform the following steps to work around the problem, by setting
    the WebSphere custom property
    <code class="literal">com.ibm.ws.webcontainer.invokeFiltersCompatibility=true</code>.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>In the administration console, browse to Servers &gt; Server Types,
      and then click WebSphere application servers.</p></li><li class="listitem"><p>Click the server for which to apply the custom property.</p></li><li class="listitem"><p>Browse to Configuration &gt; Container settings &gt; Web Container
      Settings &gt; Web container.</p></li><li class="listitem"><p>Under Configuration &gt; Additional Properties, click Custom
      Properties.</p></li><li class="listitem"><p>In the Custom Properties page, click New.</p></li><li class="listitem"><p>In the settings page, enter the Name
      <code class="literal">com.ibm.ws.webcontainer.invokeFiltersCompatibility</code> and
      Value <code class="literal">true</code> for the custom property.</p><p>Some properties are case sensitive.</p></li><li class="listitem"><p>Click Apply or OK as applicable.</p></li><li class="listitem"><p>Click Save in the Message box that appears.</p></li><li class="listitem"><p>Restart the server for the custom property to take effect.</p></li></ol></div><p>See the IBM documentation on <a class="link" href="http://www-01.ibm.com/support/docview.wss?uid=swg21284395" target="_blank"><em class="citetitle">Setting webcontainer custom properties</em></a>
    for additional information.</p></td></tr></tbody></table></div></div><div class="index"><div class="titlepage"><div><div><h1 class="title"><a name="d1498e2634"></a>Index</h1></div></div></div><div class="index"><div class="indexdiv"><h3>A</h3><dl><dt>Apache Tomcat Server, <a class="indexterm" href="#chap-apache-tomcat">Installing the Apache Tomcat Policy Agent</a></dt></dl></div><div class="indexdiv"><h3>G</h3><dl><dt>GlassFish Server, <a class="indexterm" href="#chap-glassfish">Installing the GlassFish Policy Agent</a></dt></dl></div><div class="indexdiv"><h3>I</h3><dl><dt>IBM WebSphere Application Server, <a class="indexterm" href="#chap-websphere">Installing the IBM WebSphere Policy Agent</a></dt></dl></div><div class="indexdiv"><h3>J</h3><dl><dt>JBoss Application Server, <a class="indexterm" href="#chap-jboss">Installing the JBoss Application Server Policy Agent</a></dt><dt>Jetty Server, <a class="indexterm" href="#chap-jetty">Installing the Jetty Server Policy Agent</a></dt></dl></div><div class="indexdiv"><h3>O</h3><dl><dt>Oracle WebLogic Server, <a class="indexterm" href="#chap-weblogic">Installing the Oracle WebLogic Policy Agent</a></dt></dl></div><div class="indexdiv"><h3>T</h3><dl><dt>Troubleshooting, <a class="indexterm" href="#chap-troubleshooting">Troubleshooting</a></dt></dl></div></div></div></div><p>&nbsp;</p><div id="footer"><p>Something wrong on this page? <a href="https://bugster.forgerock.org/jira/secure/CreateIssueDetails!init.jspa?pid=10000&components=10007&issuetype=1">Log a documentation bug.</a></p></div>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-23412190-14']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</body></html>