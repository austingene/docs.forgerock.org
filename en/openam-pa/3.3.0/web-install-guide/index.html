<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head>

      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
   <title>OpenAM Web Policy Agent Installation Guide</title><link rel="stylesheet" type="text/css" href="coredoc.css"><link rel="stylesheet" type="text/css" href="css/coredoc.css"><link rel="stylesheet" type="text/css" href="sh/shCore.css"><link rel="stylesheet" type="text/css" href="sh/shCoreEclipse.css"><link rel="stylesheet" type="text/css" href="sh/shThemeEclipse.css"><script src="http://code.jquery.com/jquery-1.11.0.min.js" type="text/javascript"></script><script src="uses-jquery.js" type="text/javascript"></script><script src="sh/shCore.js" type="text/javascript"></script><script src="sh/shBrushAci.js" type="text/javascript"></script><script src="sh/shBrushBash.js" type="text/javascript"></script><script src="sh/shBrushCsv.js" type="text/javascript"></script><script src="sh/shBrushHttp.js" type="text/javascript"></script><script src="sh/shBrushJava.js" type="text/javascript"></script><script src="sh/shBrushJScript.js" type="text/javascript"></script><script src="sh/shBrushLDIF.js" type="text/javascript"></script><script src="sh/shBrushPlain.js" type="text/javascript"></script><script src="sh/shBrushProperties.js" type="text/javascript"></script><script src="sh/shBrushXml.js" type="text/javascript"></script><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><meta name="description" content="Guide to installing OpenAM web policy agents. OpenAM provides open source Authentication, Authorization, Entitlement and Federation software."><script type="text/javascript">SyntaxHighlighter.all();</script>
<link rel="shortcut icon" href="http://forgerock.org/favicon.ico">
</head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div lang="en" class="book"><div class="titlepage"><div><div><h1 class="title"><a name="web-agent-install-guide"></a>OpenAM Web Policy Agent Installation Guide</h1></div><div><h2 class="subtitle">Version 3.3.0</h2></div><div><div class="authorgroup"><div class="author"><h3 class="author"><span class="firstname">Mark </span> <span class="surname">Craig</span></h3></div><div class="author"><h3 class="author"><span class="firstname">Vanessa </span> <span class="surname">Richie</span></h3></div><div class="author"><h3 class="author"><span class="firstname">Mike </span> <span class="surname">Jang</span></h3><div lang="en" class="affiliation"><span class="orgname">ForgeRock AS<br></span><div class="address"><p><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="street">33&nbsp;New&nbsp;Montgomery&nbsp;St.</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="otheraddr">Suite&nbsp;1500</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="city">San&nbsp;Francisco</span>,&nbsp;<span class="state">CA</span>&nbsp;<span class="postcode">94105</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="country">USA</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="phone">+1&nbsp;415-599-1100</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<code class="uri">www.forgerock.com</code><br>
&nbsp;&nbsp;&nbsp;</p></div></div></div></div></div><div><p class="releaseinfo">Software release date: November 08, 2013</p></div><div><p class="copyright">Copyright &copy; 2011-2014 ForgeRock AS</p></div><div><a href="legalnotice.html">Legal Notice</a></div><div><p class="pubdate">Publication date: October 08, 2014</p></div><div><div class="abstract"><div class="abstract-title">Abstract</div><p>Guide to installing OpenAM web policy agents. OpenAM provides open source
   Authentication, Authorization, Entitlement and Federation software.</p></div></div></div><hr></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="preface"><a href="#preface">Preface</a></span></dt><dt><span class="chapter"><a href="#chap-about-web-agents">1. About OpenAM Web Policy Agents</a></span></dt><dt><span class="chapter"><a href="#chap-apache-22">2. Installing the Apache 2.2 Policy Agent</a></span></dt><dt><span class="chapter"><a href="#chap-apache-24">3. Installing the Apache 2.4 Policy Agent</a></span></dt><dt><span class="chapter"><a href="#chap-msiis-6">4. Installing the Microsoft IIS 6 Policy Agent</a></span></dt><dt><span class="chapter"><a href="#chap-msiis-7">5. Installing the Microsoft IIS 7 Policy Agent</a></span></dt><dt><span class="chapter"><a href="#chap-sun-websvr">6. Installing the Oracle iPlanet/Sun Web Server Policy Agent</a></span></dt><dt><span class="chapter"><a href="#chap-troubleshooting">7. Troubleshooting</a></span></dt><dt><span class="index"><a href="#d547e2412">Index</a></span></dt></dl></div><div lang="en" class="preface"><div class="titlepage"><div><div><h1 class="title"><a name="preface"></a>Preface</h1></div></div></div><p>This guide shows you how to install OpenAM web server policy agents, as well as 
 how to integrate with other access management software. Read the 
 <em class="citetitle">Release Notes</em> before you get started.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d547e155"></a>1.&nbsp;Who Should Use this Guide</h2></div></div></div><p>This guide is written for anyone installing OpenAM policy agents to 
  interface with supported web servers application containers.</p><p>This guide covers procedures that you theoretically perform only
  once per version. This guide aims to provide you with at least some idea
  of what happens behind the scenes when you perform the steps.</p><p>You do not need to be an OpenAM wizard to learn something from
  this guide, though a background in access management and maintaining
  web application software can help. You do need some background in
  managing services on your operating systems and in your application
  servers. You can nevertheless get started with this guide, and then
  learn more as you go along.</p></div><div lang="en" class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="formatting-conventions"></a>2.&nbsp;Formatting Conventions</h2></div></div></div><p>
  Most examples in the documentation are created on GNU/Linux or Mac OS X.

  Where it is helpful to make a distinction between operating environments,
  examples for UNIX, GNU/Linux, Mac OS X, and so forth are labeled (UNIX).
  Mac OS X specific examples can be labeled (Mac OS X).
  Examples for Microsoft Windows can be labeled (Windows).

  To avoid repetition, however, file system directory names are
  often given only in UNIX format as in <code class="filename">/path/to/server</code>,
  even if the text applies to <code class="filename">C:\path\to\server</code> as well.
 </p><p>
  Absolute path names usually begin with the placeholder
  <code class="filename">/path/to/</code>.

  This path might translate to <code class="filename">/opt/</code>,
  <code class="filename">C:\Program Files\</code>, or somewhere else on your system.
 </p><p>
  Command line, terminal sessions are formatted as follows.
 </p><div class="screen"><pre>$ <strong>echo $JAVA_HOME</strong>
<em>/path/to/jdk</em></pre></div><p>
  Command output is sometimes formatted for narrower, more readable output
  even though formatting parameters are not shown in the command.
  In the following example, the query string parameter
  <code class="literal">_prettyPrint=true</code> is omitted.
 </p><div class="screen"><pre>
$ <strong>curl https://bjensen:hifalutin@opendj.example.com:8443/users/newuser</strong>
<em>{
  "_rev" : "000000005b337348",
  "schemas" : [ "urn:scim:schemas:core:1.0" ],
  "contactInformation" : {
    "telephoneNumber" : "+1 408 555 1212",
    "emailAddress" : "newuser@example.com"
  },
  "_id" : "newuser",
  "name" : {
    "familyName" : "New",
    "givenName" : "User"
  },
  "userName" : "newuser@example.com",
  "displayName" : "New User",
  "meta" : {
    "created" : "2014-06-03T09:58:27Z"
  },
  "manager" : [ {
    "_id" : "kvaughan",
    "displayName" : "Kirsten Vaughan"
  } ]
}</em>
 </pre></div><p>
  Program listings are formatted as follows.
 </p><pre class="brush: java;">class Test {
    public static void main(String [] args)  {
        System.out.println("This is a program listing.");
    }
}</pre></div><div lang="en" class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="accessing-doc-online"></a>3.&nbsp;Accessing Documentation Online</h2></div></div></div><p>
  ForgeRock core documentation, such as what you are now reading, aims to be
  technically accurate and complete with respect to the software documented.
 </p><div class="itemizedlist"><p>
   Core documentation therefore follows a three-phase review process
   designed to eliminate errors.
  </p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
    Product managers and software architects review project documentation design
    with respect to the users' software lifecycle needs.
   </p></li><li class="listitem"><p>
    Subject matter experts review proposed documentation changes for
    technical accuracy and completeness
    with respect to the corresponding software.
   </p></li><li class="listitem"><p>
    Quality experts validate implemented documentation changes for
    technical validity with respect to the software,
    technical completeness with respect to the scope of the document,
    and usability for the expected audience.
   </p></li></ul></div><p>
  The review process helps to ensure that documentation published for
  a ForgeRock release is technically accurate and complete.
 </p><p>
  Fully reviewed, published core documentation is available at
  <a class="link" href="http://docs.forgerock.org/" target="_blank">http://docs.forgerock.org/</a>.

  Use this documentation when working with a ForgeRock Enterprise release.
 </p><p>
  In-progress documentation can be found at each project site under the
  <a class="link" href="http://forgerock.org" target="_blank">Developer Community</a> projects page.

  Use this documentation when trying a nightly build.
 </p><p>
  The ForgeRock <a class="link" href="https://wikis.forgerock.org/" target="_blank">Community Wikis</a> and provide additional, user-created information.

  We encourage you to
  <a class="link" href="https://sso.forgerock.com/openam/UI/Login" target="_blank">join the community</a>, so that you can update the Wikis, too.
 </p></div><div lang="en" class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="joining-the-community"></a>4.&nbsp;Joining the ForgeRock Community</h2></div></div></div><p>
  After you
  <a class="link" href="https://backstage.forgerock.com/#/account/register" target="_blank">sign up</a> to join the ForgeRock community,
  you can edit the
  <a class="link" href="https://wikis.forgerock.org/" target="_blank">Community Wikis</a>,
  and also log bugs and feature requests in the
  <a class="link" href="https://bugster.forgerock.org/" target="_blank">issue tracker</a>.
 </p><p>
  If you have a question regarding a project but cannot find an answer
  in the project documentation or Wiki, browse to the
  <a class="link" href="http://forgerock.org" target="_blank">Developer Community</a> page for the project,
  where you can find details on joining the project mailing lists,
  and find links to mailing list archives.

  You can also suggest updates to documentation through the
  <a class="link" href="https://lists.forgerock.org/mailman/listinfo/docs" target="_blank">ForgeRock docs mailing list</a>.
 </p><p>
  The Community Wikis describe how to check out and build source code.

  Should you want to contribute a patch, test, or feature,
  or want to author part of the core documentation,
  first have a look on the ForgeRock site at
  <a class="link" href="http://forgerock.org/get_involved.html" target="_blank">how to get involved</a>.
 </p></div></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-about-web-agents"></a>Chapter&nbsp;1.&nbsp;About OpenAM Web Policy Agents</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="section"><a href="#example-agent-interaction">1.1. How the User, Web Policy Agent, &amp; OpenAM Interact</a></span></dt><dt><span class="section"><a href="#web-agent-configuration">1.2. How Web Policy Agents are Configured</a></span></dt></dl></div><p>OpenAM web policy agents provide light touch integration for web
 applications running on supported web servers. This chapter covers what web
 policy agents do and how they work.</p><p>A <em class="firstterm">policy agent</em> enforces policy for OpenAM. A
 <em class="firstterm">web policy agent</em> installed in a web server intercepts
 requests from users trying to access a protected web resource, and denies
 access until the user has authorization from OpenAM to access the
 resource.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="example-agent-interaction"></a>1.1.&nbsp;How the User, Web Policy Agent, &amp; OpenAM Interact</h2></div></div></div><p>Imagine that a user attempts to access a protected resource before
  having authenticated by pointing her browser to a web page. Assume that you
  have configured OpenAM to protect the web page. Then the web policy agent
  intercepting her browser's request finds no session token in the request,
  and so redirects the user's browser to the OpenAM login page for
  authentication. After the user has successfully authenticated, OpenAM
  sets a session token in a browser cookie, and redirects her browser back to
  the page she tried to access initially.</p><p>When the user's browser reiterates the request, the policy agent again
  checks that the request has a session token, finds a session token this
  time, and validates the session token with OpenAM. Given the valid session
  token, the policy agent gets a policy decision from OpenAM concerning whether
  the user can access the page. If OpenAM's Policy Service determines that
  the user is allowed to access the page, OpenAM responds to the policy agent
  that access should be granted. The web policy agent then permits the web
  page to be returned to the user's browser.</p><p>The following diagram shows how the pieces fit together when a web
  client accesses a web page protected by a policy agent. This diagram is
  simplified to show only the essential principals rather than to describe
  every possible case.</p><div class="mediaobject" align="center"><a name="figure-web-pa-overview"></a><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/web-pa-overview.png" align="middle" height="360" alt="Diagram of web policy agent use"></td></tr></table><div class="longdesc-link" align="right"><br clear="all"><span class="longdesc-link">[<a href="figure-web-pa-overview.html" target="longdesc">D</a>]</span></div></div><div class="orderedlist"><p>A web policy agent is a library installed in the web server and
   configured to be called by the web server when a client requests access
   to a protected resource in a web site.</p><ol class="orderedlist" type="1"><li class="listitem"><p>The web client requests access to a protected resource.</p></li><li class="listitem"><p>The web server runs the request through the policy agent that
    protects the resource according to OpenAM policy. The policy agent
    acts to enforce policy, whereas the policy configuration and
    decisions are handled by OpenAM.</p></li><li class="listitem"><p>The policy agent communicates with OpenAM to get the policy
    decision to enforce.</p></li><li class="listitem"><p>For a resource to which OpenAM approves access, the policy agent
    allows access.</p></li><li class="listitem"><p>The web server returns the requested access to the web client.</p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="web-agent-configuration"></a>1.2.&nbsp;How Web Policy Agents are Configured</h2></div></div></div><p>You install web policy agents in the web servers holding web resources
  that you want to protect. By default, the web policy agent has only enough
  configuration at installation time to connect to OpenAM in order to get the
  rest of its configuration from the OpenAM configuration store. With nearly
  all configuration stored centrally, you can manage policy agents centrally
  from the OpenAM console.</p><p>You can opt to store the agent configuration locally if necessary.
  If you store the configuration locally, then avoid issues with the
  configuration by making sure you provide valid values for configuration
  properties ending in the following.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">.cookie.name</code></p></li><li class="listitem"><p><code class="literal">.fqdn.default</code></p></li><li class="listitem"><p><code class="literal">.agenturi.prefix</code></p></li><li class="listitem"><p><code class="literal">.naming.url</code></p></li><li class="listitem"><p><code class="literal">.login.url</code></p></li><li class="listitem"><p><code class="literal">.instance.name</code></p></li><li class="listitem"><p><code class="literal">.username</code></p></li><li class="listitem"><p><code class="literal">.password</code></p></li><li class="listitem"><p><code class="literal">.connection_timeout</code></p></li><li class="listitem"><p><code class="literal">.policy_clock_skew</code></p></li></ul></div><p>You configure web policy agents per realm. Thus to access centralized
  configuration, you select Access Control &gt; <em class="replaceable"><code>Realm
  Name</code></em> &gt; Agents &gt; Web &gt; <em class="replaceable"><code>Agent
  Name</code></em>. Web policy agent configuration is distinct from
  policy configuration. The only policy-like configuration that you apply to
  web policy agents is indicating which URLs in the web server can be
  ignored (<em class="firstterm">not enforced URLs</em>) and which client IP
  address are exempt from policy enforcement (<em class="firstterm">not enforced
  IPs</em>).</p><p>For each aspect of web policy agent configuration, you can configure
  the policy agent through the OpenAM console during testing, and then
  export the resulting configuration in order to script configuration in
  your production environment.</p></div></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-apache-22"></a>Chapter&nbsp;2.&nbsp;Installing the Apache 2.2 Policy Agent</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="section"><a href="#before-apache22-agent-install">2.1. Before You Install</a></span></dt><dt><span class="section"><a href="#install-apache22-web-agent">2.2. Installing Apache 2.2 Web Policy Agent</a></span></dt><dt><span class="section"><a href="#custom-apache22-agent-installation">2.3. Custom Apache 2.2 Web Policy Agent Installation</a></span></dt><dt><span class="section"><a href="#uninstall-apache22-agent">2.4. Remove Apache 2.2 Web Policy Agent Software</a></span></dt></dl></div><a class="indexterm" name="d547e396"></a><p>This chapter covers installation of the policy agent for Apache
 HTTP Server 2.2.x.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="before-apache22-agent-install"></a>2.1.&nbsp;Before You Install</h2></div></div></div><p>Make sure OpenAM is installed, running, that you can contact OpenAM
  from the system running the policy agent. Next, create a profile for your
  policy agent as described in the <em class="citetitle">Administration Guide</em>
  section on <span class="olink"><em class="citetitle">Creating Agent
  Profiles</em></span>. To protect resources with the agent also create
  at least one policy as described in the section on <span class="olink"><em class="citetitle">Configuring
  Policies</em></span>. Consider creating a simple policy, such as a
  policy that allows only authenticated users to access your resources, in order
  to test your policy agent after installation.</p><p>You must install Apache HTTP Server before you install the policy
  agent, and you must stop the server during installation.</p><p>You must install a supported version of the Java runtime environment.
         Please review the <a href="../web-release-notes/index.html#java-requirements-web-agents" class="link">
         <em class="citetitle">Release Notes</em></a> for the currently supported version
         of Java, and set the <code class="literal">JAVA_HOME</code> environment
         variable accordingly. The policy agent installer requires Java.</p><div class="screen"><pre>$ echo $JAVA_HOME
/path/to/java
$ which java
/usr/bin/java</pre></div><p>To obtain the web agent built for this server, contact ForgeRock at <a class="link" href="mailto:info@forgerock.com" target="_top">info@forgerock.com</a>.
         Make sure to get and verify the checksum of the agent binary that you get.
         Be aware, only 64-bit versions of these specialized agents are available.</p><p>Unzip the file in the directory where you plan to install the web
  policy agent. The agent you install stores its configuration and logs
  under this directory.</p><div class="variablelist"><p>When you unzip the policy agent .zip download, you find the following
   directories under the <code class="filename">web_agents/apache22_agent</code>
   directory.</p><dl class="variablelist"><dt><span class="term"><code class="filename">bin</code></span></dt><dd><p>Contains the installation and configuration program,
     <span class="command"><strong>agentadmin</strong></span>; the certificate management tool
     <span class="command"><strong>certutil</strong></span> and the password hashing tool
     <span class="command"><strong>crypt_util</strong></span>.</p></dd><dt><span class="term"><code class="filename">config</code></span></dt><dd><p>Configuration templates used by the <span class="command"><strong>agentadmin</strong></span>
     command during installation</p></dd><dt><span class="term"><code class="filename">data</code></span></dt><dd><p>Not used</p></dd><dt><span class="term"><code class="filename">etc</code></span></dt><dd><p>Apache configuration template used during installation</p></dd><dt><span class="term"><code class="filename">installer-logs</code></span></dt><dd><p>Location for log files written during installation</p></dd><dt><span class="term"><code class="filename">lib</code></span></dt><dd><p>Shared libraries used by the web policy agent</p></dd><dt><span class="term"><code class="filename">locale</code></span></dt><dd><p>Property files used by the installation program</p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="install-apache22-web-agent"></a>2.2.&nbsp;Installing Apache 2.2 Web Policy Agent</h2></div></div></div><p>Complete the following procedures to install the policy agent.</p><div class="procedure"><a name="create-apache22-agent-profile"></a><div class="procedure-title">Procedure&nbsp;2.1.&nbsp;To Create the Apache 2.2 Web Agent Profile</div><p>Regardless of whether you store configurations centrally in OpenAM
   or locally with your agents, the agent requires a profile so that it can
   connect to and communicate with OpenAM.</p><ol class="procedure" type="1"><li class="step"><p>In the OpenAM console, browse to Access Control &gt;
    <em class="replaceable"><code>Realm Name</code></em>&gt; Agents &gt; Web,
    and then click the New... button in the Agent table.</p></li><li class="step"><p>Complete the web form using the following hints.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Name</span></dt><dd><p>The name for the agent profile used when you install the
       agent</p></dd><dt><span class="term">Password</span></dt><dd><p>Password the agent uses to authenticate to OpenAM</p></dd><dt><span class="term">Configuration</span></dt><dd><p>Centralized configurations are stored in the OpenAM configuration
       store. You can manage the centralized configuration through the OpenAM
       console. Local configurations are stored in a file alongside the
       agent.</p></dd><dt><span class="term">Server URL</span></dt><dd><p>The full URL to an OpenAM instance, or if OpenAM is deployed in
       a site configuration (behind a load balancer) then the site URL</p><p>In centralized configuration mode, the Server URL is used to
       populate the agent profile for services such as Login, Logout, Naming,
       and Cross Domain SSO.</p></dd><dt><span class="term">Agent URL</span></dt><dd><p>The web server URL that the agent protects</p><p>In centralized configuration mode, the Agent URL is used to
       populate the Agent Profile for services such as notifications.</p></dd></dl></div></li></ol></div><div class="procedure"><a name="create-apache22-agent-pwdfile"></a><div class="procedure-title">Procedure&nbsp;2.2.&nbsp;To Create the Password File</div><ol class="procedure" type="1"><li class="step"><p>Create a text file containing only the password.</p><div class="screen"><pre>$ echo password &gt; /tmp/pwd.txt</pre></div></li><li class="step"><p>Protect the password file you create as appropriate for your
    operating system.</p><div class="screen"><pre>$ chmod 400 /tmp/pwd.txt</pre></div></li></ol></div><div class="procedure"><a name="install-agent-into-apache22"></a><div class="procedure-title">Procedure&nbsp;2.3.&nbsp;To Install the Policy Agent into Apache 2.2</div><ol class="procedure" type="1"><li class="step"><p>Shut down the Apache 2.2 server where you plan to install the
    agent.</p><div class="screen"><pre>$ /path/to/apache22/bin/apachectl -k stop</pre></div></li><li class="step"><p>Make sure OpenAM is running.</p></li><li class="step"><p>Run <span class="command"><strong>./agentadmin --install</strong></span> to install the agent.</p><div class="screen"><pre>$ cd /path/to/web_agents/apache22_agent/bin/
$ ./agentadmin --install
...
-----------------------------------------------
SUMMARY OF YOUR RESPONSES
-----------------------------------------------
Apache Server Config Directory : /path/to/apache22/conf 
OpenAM server URL : http://openam.example.com:8080/openam 
Agent URL : http://www.example.com:80
Agent Profile name : Apache Web Agent 
Agent Profile Password file name : /tmp/pwd.txt 

...
SUMMARY OF AGENT INSTALLATION
-----------------------------
Agent instance name: Agent_001
Agent Bootstrap file location:
/path/to/web_agents/apache22_agent/Agent_001/config/
 OpenSSOAgentBootstrap.properties
Agent Configuration Tag file location
/path/to/web_agents/apache22_agent/Agent_001/config/
 OpenSSOAgentConfiguration.properties
Agent Audit directory location:
/path/to/web_agents/apache22_agent/Agent_001/logs/audit
Agent Debug directory location:
/path/to/web_agents/apache22_agent/Agent_001/logs/debug


Install log file location:
/path/to/web_agents/apache22_agent/installer-logs/audit/install.log
...</pre></div><p>Upon successful completion, the installer has added the agent as
    a module to the Apache 2.2 configuration, and also set up configuration
    and log directories for the agent.</p><div class="note"><h3 class="title">Note</h3><p>If the agent is in a different domain than the server, refer to <em class="citetitle">Administration Guide</em> procedure, <span class="olink"><em class="citetitle">Configuring Cross-Domain
   Single Sign On</em></span>.</p></div></li><li class="step"><p>Take note of the configuration files and log locations.</p><p>Each agent instance that you install on the system has its own
    numbered configuration and logs directory. The first agent's configuration
    and logs are thus located under the directory
    <code class="filename">web_agents/apache22_agent/Agent_001/</code>.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="filename">config/OpenSSOAgentBootstrap.properties</code></span></dt><dd><p>Used to bootstrap the web policy agent, allowing the agent to
       connect to OpenAM and download its configuration</p></dd><dt><span class="term"><code class="filename">config/OpenSSOAgentConfiguration.properties</code></span></dt><dd><p>Only used if you configured the web policy agent to use local
       configuration</p></dd><dt><span class="term"><code class="filename">logs/audit/</code></span></dt><dd><p>Operational audit log directory, only used if remote logging
       to OpenAM is disabled</p></dd><dt><span class="term"><code class="filename">logs/debug/</code></span></dt><dd><p>Debug directory where the <code class="filename">amAgent</code> debug file
       resides. Useful in troubleshooting policy agent issues.</p></dd></dl></div></li><li class="step"><p>If your policy agent configuration is not in the top-level realm (/),
       then you must edit config/OpenSSOAgentBootstrap.properties to identify
       the sub-realm that has your policy agent configuration.
       Find com.sun.identity.agents.config.organization.name and change
       the / to the path to your policy agent profile. This allows the policy agent
       to properly identify itself to the OpenAM server. </p></li><li class="step"><p>Start the Apache 2.2 server where you installed the agent.</p><div class="screen"><pre>$ /path/to/apache22/bin/apachectl -k start</pre></div></li></ol></div><div class="procedure"><a name="check-apache22-agent-installation"></a><div class="procedure-title">Procedure&nbsp;2.4.&nbsp;To Check the Policy Agent Installation</div><ol class="procedure" type="1"><li class="step"><p>Check the Apache 2.2 error log after you start the server to make
    sure startup completed successfully.</p><div class="screen"><pre>$ tail -n 2 /path/to/apache22/logs/error_log
[Sat Sep 03 13:28:16 2011] [notice] Policy web agent shared memory conf...
[Sat Sep 03 13:28:16 2011] [notice] Apache/2.2.19 (Unix) DSAME/3.0 configured
 -- resuming normal operations</pre></div></li><li class="step"><p>Check the <code class="filename">amAgent</code> debug log to verify that
    no errors occurred on startup.</p><div class="screen"><pre>$ tail /path/to/web_agents/apache22_agent/Agent_001/logs/debug/amAgent
2011-09-03 13:28:16.971    -1 32686:9daae60 all: ==============...=====
2011-09-03 13:28:16.972    -1 32686:9daae60 all: Version: ...
2011-09-03 13:28:16.972    -1 32686:9daae60 all: 
2011-09-03 13:28:16.972    -1 32686:9daae60 all: Build Date: ...
2011-09-03 13:28:16.972    -1 32686:9daae60 all: Build Machine: ..forgerock.com
2011-09-03 13:28:16.972    -1 32686:9daae60 all: ==============...=====</pre></div></li><li class="step"><p>If you have a policy configured, you can test your policy agent.
    For example, try to browse to a resource that your policy agent protects.
    You should be redirected to OpenAM to authenticate, for example as user
    <code class="literal">demo</code>, password <code class="literal">changeit</code>. After
    you authenticate, OpenAM then redirects you back to the resource you tried
    to access.</p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="custom-apache22-agent-installation"></a>2.3.&nbsp;Custom Apache 2.2 Web Policy Agent Installation</h2></div></div></div><p>When running multiple Apache 2.2 servers on the same host, use
  <span class="command"><strong>./agentadmin --custom-install</strong></span>.</p><p>When performing a scripted, silent installation, use
  <span class="command"><strong>./agentadmin --install --saveResponse
  <em class="replaceable"><code>response-file</code></em></strong></span>
  to create a response file for scripted installation. Then install silently
  using <span class="command"><strong>./agentadmin --install --useResponse
  <em class="replaceable"><code>response-file</code></em></strong></span>.</p><p>With <span class="command"><strong>./agentadmin --custom-install</strong></span>, you can opt to
  create the policy agent profile during installation. The OpenAM administrator
  must first create an agent administrator user, as described in <span class="olink"><em class="citetitle">Delegating Agent
  Profile Creation</em></span>, and provide you with the agent
  administrator user name and password. Before running the
  <span class="command"><strong>./agentadmin --custom-install</strong></span> command, put the password
  alone in a read-only file only the user installing can access, as for the
  agent password. When the <span class="command"><strong>agentadmin</strong></span> command prompts you to
  create the profile during installation, enter <code class="literal">true</code>, and
  then respond to the <span class="command"><strong>agentadmin</strong></span> prompts for the agent
  administrator user name and password file.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="uninstall-apache22-agent"></a>2.4.&nbsp;Remove Apache 2.2 Web Policy Agent Software</h2></div></div></div><p>Shut down the Apache 2.2 server before you uninstall the
    policy agent.</p><div class="screen"><pre>$ /path/to/apache22/bin/apachectl -k stop</pre></div><p>To remove the web policy agent, use <span class="command"><strong>./agentadmin
  --uninstall</strong></span>.</p><div class="screen"><pre>$ ./agentadmin --uninstall
...
-----------------------------------------------
SUMMARY OF YOUR RESPONSES
-----------------------------------------------
Apache Server Config Directory : /path/to/apache22/conf 

...
Deleting the config directory
/path/to/web_agents/apache22_agent/Agent_001/config
...DONE.

Removing Agent parameters from /path/to/apache22/conf/httpd.conf file
...DONE.


Uninstall log file location:
/path/to/web_agents/apache22_agent/installer-logs/audit/uninstall.log
...</pre></div></div></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-apache-24"></a>Chapter&nbsp;3.&nbsp;Installing the Apache 2.4 Policy Agent</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="section"><a href="#before-apache24-agent-install">3.1. Before You Install</a></span></dt><dt><span class="section"><a href="#install-apache24-web-agent">3.2. Installing Apache 2.4 Web Policy Agent</a></span></dt><dt><span class="section"><a href="#custom-apache24-agent-installation">3.3. Custom Apache 2.4 Web Policy Agent Installation</a></span></dt><dt><span class="section"><a href="#uninstall-apache24-agent">3.4. Remove Apache 2.4 Web Policy Agent Software</a></span></dt></dl></div><a class="indexterm" name="d547e735"></a><p>This chapter covers installation of the policy agent for Apache
 HTTP Server 2.4.x.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="before-apache24-agent-install"></a>3.1.&nbsp;Before You Install</h2></div></div></div><p>Make sure OpenAM is installed, running, that you can contact OpenAM
  from the system running the policy agent. Next, create a profile for your
  policy agent as described in the <em class="citetitle">Administration Guide</em>
  section on <span class="olink"><em class="citetitle">Creating Agent
  Profiles</em></span>. To protect resources with the agent also create
  at least one policy as described in the section on <span class="olink"><em class="citetitle">Configuring
  Policies</em></span>. Consider creating a simple policy, such as a
  policy that allows only authenticated users to access your resources, in order
  to test your policy agent after installation.</p><p>You must install Apache HTTP Server before you install the policy
  agent, and you must stop the server during installation.</p><p>You must install a supported version of the Java runtime environment.
         Please review the <a href="../web-release-notes/index.html#java-requirements-web-agents" class="link">
             <em class="citetitle">Release Notes</em></a> for the currently supported version
         of Java, and set the <code class="literal">JAVA_HOME</code> environment
         variable accordingly. The policy agent installer requires Java.</p><p>To obtain the web agent built for this server, contact ForgeRock at <a class="link" href="mailto:info@forgerock.com" target="_top">info@forgerock.com</a>.
         Make sure to get and verify the checksum of the agent binary that you get.
         Be aware, only 64-bit versions of these specialized agents are available.</p><p>Unzip the file in the directory where you plan to install the web
  policy agent. The agent you install stores its configuration and logs
  under this directory.</p><div class="variablelist"><p>When you unzip the policy agent .zip download, you find the following
   directories under the <code class="filename">web_agents/apache24_agent</code>
   directory.</p><dl class="variablelist"><dt><span class="term"><code class="filename">bin</code></span></dt><dd><p>Contains the installation and configuration program,
     <span class="command"><strong>agentadmin</strong></span>; the certificate management tool
     <span class="command"><strong>certutil</strong></span> and the password hashing tool
     <span class="command"><strong>crypt_util</strong></span>.</p></dd><dt><span class="term"><code class="filename">config</code></span></dt><dd><p>Configuration templates used by the <span class="command"><strong>agentadmin</strong></span>
     command during installation</p></dd><dt><span class="term"><code class="filename">data</code></span></dt><dd><p>Not used</p></dd><dt><span class="term"><code class="filename">etc</code></span></dt><dd><p>Apache configuration template used during installation</p></dd><dt><span class="term"><code class="filename">installer-logs</code></span></dt><dd><p>Location for log files written during installation</p></dd><dt><span class="term"><code class="filename">lib</code></span></dt><dd><p>Shared libraries used by the web policy agent</p></dd><dt><span class="term"><code class="filename">locale</code></span></dt><dd><p>Property files used by the installation program</p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="install-apache24-web-agent"></a>3.2.&nbsp;Installing Apache 2.4 Web Policy Agent</h2></div></div></div><p>Complete the following procedures to install the policy agent.</p><div class="procedure"><a name="create-apache24-agent-profile"></a><div class="procedure-title">Procedure&nbsp;3.1.&nbsp;To Create the Apache 2.4 Web Agent Profile</div><p>Regardless of whether you store configurations centrally in OpenAM
   or locally with your agents, the agent requires a profile so that it can
   connect to and communicate with OpenAM.</p><ol class="procedure" type="1"><li class="step"><p>In the OpenAM console, browse to Access Control &gt;
    <em class="replaceable"><code>Realm Name</code></em>&gt; Agents &gt; Web,
    and then click the New... button in the Agent table.</p></li><li class="step"><p>Complete the web form using the following hints.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Name</span></dt><dd><p>The name for the agent profile used when you install the
       agent</p></dd><dt><span class="term">Password</span></dt><dd><p>Password the agent uses to authenticate to OpenAM</p></dd><dt><span class="term">Configuration</span></dt><dd><p>Centralized configurations are stored in the OpenAM configuration
       store. You can manage the centralized configuration through the OpenAM
       console. Local configurations are stored in a file alongside the
       agent.</p></dd><dt><span class="term">Server URL</span></dt><dd><p>The full URL to an OpenAM instance, or if OpenAM is deployed in
       a site configuration (behind a load balancer) then the site URL</p><p>In centralized configuration mode, the Server URL is used to
       populate the agent profile for services such as Login, Logout, Naming,
       and Cross Domain SSO.</p></dd><dt><span class="term">Agent URL</span></dt><dd><p>The web server URL that the agent protects</p><p>In centralized configuration mode, the Agent URL is used to
       populate the Agent Profile for services such as notifications.</p></dd></dl></div></li></ol></div><div class="procedure"><a name="create-apache24-agent-pwdfile"></a><div class="procedure-title">Procedure&nbsp;3.2.&nbsp;To Create the Password File</div><ol class="procedure" type="1"><li class="step"><p>Create a text file containing only the password.</p><div class="screen"><pre>$ echo password &gt; /tmp/pwd.txt</pre></div></li><li class="step"><p>Protect the password file you create as appropriate for your
    operating system.</p><div class="screen"><pre>$ chmod 400 /tmp/pwd.txt</pre></div></li></ol></div><div class="procedure"><a name="install-agent-into-apache24"></a><div class="procedure-title">Procedure&nbsp;3.3.&nbsp;To Install the Policy Agent into Apache 2.4</div><ol class="procedure" type="1"><li class="step"><p>Shut down the Apache 2.4 server where you plan to install the
    agent.</p><div class="screen"><pre>$ /path/to/apache24/bin/apachectl -k stop</pre></div></li><li class="step"><p>Make sure OpenAM is running.</p></li><li class="step"><p>Run <span class="command"><strong>./agentadmin --install</strong></span> to install the
    agent.</p><div class="screen"><pre>$ cd /path/to/web_agents/apache24_agent/bin/
$ ./agentadmin --install
...
-----------------------------------------------
SUMMARY OF YOUR RESPONSES
-----------------------------------------------
Apache Server Config Directory : /path/to/apache24/conf 
OpenAM server URL : http://openam.example.com:8080/openam 
Agent URL : http://www.example.com:80
Agent Profile name : Apache Web Agent 
Agent Profile Password file name : /tmp/pwd.txt 

...
SUMMARY OF AGENT INSTALLATION
-----------------------------
Agent instance name: Agent_001
Agent Bootstrap file location:
/path/to/web_agents/apache24_agent/Agent_001/config/
 OpenSSOAgentBootstrap.properties
Agent Configuration Tag file location
/path/to/web_agents/apache24_agent/Agent_001/config/
 OpenSSOAgentConfiguration.properties
Agent Audit directory location:
/path/to/web_agents/apache24_agent/Agent_001/logs/audit
Agent Debug directory location:
/path/to/web_agents/apache24_agent/Agent_001/logs/debug


Install log file location:
/path/to/web_agents/apache24_agent/installer-logs/audit/install.log
...</pre></div><p>Upon successful completion, the installer has added the agent as
    a module to the Apache 2.4 configuration, and also set up configuration
    and log directories for the agent. You can find a backup Apache HTTPD
    configuration file, <code class="filename">http.conf-preAmAgent-*</code>,
    in the Apache HTTPD configuration directory.</p><div class="note"><h3 class="title">Note</h3><p>If the agent is in a different domain than the OpenAM server,
     refer to the <em class="citetitle">Administration Guide</em> procedure,
     <span class="olink"><em class="citetitle">Configuring
     Cross-Domain Single Sign On</em></span>.</p></div></li><li class="step"><p>Take note of the configuration files and log locations.</p><p>Each agent instance that you install on the system has its own
    numbered configuration and logs directory. The first agent's configuration
    and logs are thus located under the directory
    <code class="filename">web_agents/apache24_agent/Agent_001/</code>.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="filename">config/OpenSSOAgentBootstrap.properties</code></span></dt><dd><p>Used to bootstrap the web policy agent, allowing the agent to
       connect to OpenAM and download its configuration</p></dd><dt><span class="term"><code class="filename">config/OpenSSOAgentConfiguration.properties</code></span></dt><dd><p>Only used if you configured the web policy agent to use local
       configuration</p></dd><dt><span class="term"><code class="filename">logs/audit/</code></span></dt><dd><p>Operational audit log directory, only used if remote logging
       to OpenAM is disabled</p></dd><dt><span class="term"><code class="filename">logs/debug/</code></span></dt><dd><p>Debug directory where the <code class="filename">amAgent</code> debug file
       resides. Useful in troubleshooting policy agent issues.</p></dd></dl></div></li><li class="step"><p>If your policy agent configuration is not in the top-level realm (/),
       then you must edit
       <code class="filename">config/OpenSSOAgentBootstrap.properties</code> to
       indentify the sub-realm that has your policy agent configuration.
       Find com.sun.identity.agents.config.organization.name and change
       the / to the path to your policy agent profile. This allows the
       policy agent to properly identify itself to the OpenAM server.</p></li><li class="step"><p>Start the Apache 2.4 server where you installed the agent.</p><div class="screen"><pre>$ /path/to/apache24/bin/apachectl -k start</pre></div></li></ol></div><div class="procedure"><a name="check-apache24-agent-installation"></a><div class="procedure-title">Procedure&nbsp;3.4.&nbsp;To Check the Policy Agent Installation</div><ol class="procedure" type="1"><li class="step"><p>Check the Apache 2.4 error log after you start the server to make
    sure startup completed successfully.</p><div class="screen"><pre>$ tail -n 2 /path/to/apache24/logs/error_log
[Fri Sep 14 12:48:55.765192 2012] [dsame:notice] [pid 18991:tid 3075335872]
 Policy web agent shared memory configuration: notif_shm_size[2099200],
 pdp_shm_size[3213312], max_pid_count[256], max_pdp_count[256]
[Fri Sep 14 12:48:55.774790 2012] [mpm_event:notice] [pid 18991:tid 3075335872]
 AH00489: Apache/2.4.3 (Unix) DSAME/3.0 configured
 -- resuming normal operations</pre></div></li><li class="step"><p>Check the <code class="filename">amAgent</code> debug log to verify that
    no errors occurred on startup.</p><div class="screen"><pre>$ tail /path/to/web_agents/apache24_agent/Agent_001/logs/debug/amAgent
2012-09-14 12:48:55.613      -1 18991:85fdd48 all: ==============...=====
2012-09-14 12:48:55.614      -1 18991:85fdd48 all: Version: ...
2012-09-14 12:48:55.614      -1 18991:85fdd48 all: Revision: ...
2012-09-14 12:48:55.614      -1 18991:85fdd48 all: Build Date: ...
2012-09-14 12:48:55.614      -1 18991:85fdd48 all: Build Machine: ...
2012-09-14 12:48:55.614      -1 18991:85fdd48 all: ==============...=====</pre></div></li><li class="step"><p>If you have a policy configured, you can test your policy agent.
    For example, try to browse to a resource that your policy agent protects.
    You should be redirected to OpenAM to authenticate, for example as user
    <code class="literal">demo</code>, password <code class="literal">changeit</code>. After
    you authenticate, OpenAM then redirects you back to the resource you tried
    to access.</p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="custom-apache24-agent-installation"></a>3.3.&nbsp;Custom Apache 2.4 Web Policy Agent Installation</h2></div></div></div><p>When running multiple Apache 2.4 servers on the same host, use
  <span class="command"><strong>./agentadmin --custom-install</strong></span>.</p><p>When performing a scripted, silent installation, use
  <span class="command"><strong>./agentadmin --install --saveResponse
  <em class="replaceable"><code>response-file</code></em></strong></span>
  to create a response file for scripted installation. Then install silently
  using <span class="command"><strong>./agentadmin --install --useResponse
  <em class="replaceable"><code>response-file</code></em></strong></span>.</p><p>With <span class="command"><strong>./agentadmin --custom-install</strong></span>, you can opt to
  create the policy agent profile during installation. The OpenAM administrator
  must first create an agent administrator user, as described in <span class="olink"><em class="citetitle">Delegating Agent
  Profile Creation</em></span>, and provide you with the agent
  administrator user name and password. Before running the
  <span class="command"><strong>./agentadmin --custom-install</strong></span> command, put the password
  alone in a read-only file only the user installing can access, as for the
  agent password. When the <span class="command"><strong>agentadmin</strong></span> command prompts you to
  create the profile during installation, enter <code class="literal">true</code>, and
  then respond to the <span class="command"><strong>agentadmin</strong></span> prompts for the agent
  administrator user name and password file.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="uninstall-apache24-agent"></a>3.4.&nbsp;Remove Apache 2.4 Web Policy Agent Software</h2></div></div></div><p>Shut down the Apache 2.4 server before you uninstall the
    policy agent.</p><div class="screen"><pre>$ /path/to/apache24/bin/apachectl -k stop</pre></div><p>To remove the web policy agent, use <span class="command"><strong>./agentadmin
  --uninstall</strong></span>.</p><div class="screen"><pre>$ ./agentadmin --uninstall
...
-----------------------------------------------
SUMMARY OF YOUR RESPONSES
-----------------------------------------------
Apache Server Config Directory : /path/to/apache24/conf 

...
Deleting the config directory
/path/to/web_agents/apache24_agent/Agent_001/config
...DONE.

Removing Agent parameters from /path/to/apache24/conf/httpd.conf file
...DONE.


Uninstall log file location:
/path/to/web_agents/apache24_agent/installer-logs/audit/uninstall.log
...</pre></div></div></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-msiis-6"></a>Chapter&nbsp;4.&nbsp;Installing the Microsoft IIS 6 Policy Agent</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="section"><a href="#before-iis6-agent-install">4.1. Before You Install</a></span></dt><dt><span class="section"><a href="#install-iis6-web-agent">4.2. Installing IIS 6 Web Policy Agent</a></span></dt><dt><span class="section"><a href="#custom-iis6-agent-installation">4.3. Custom IIS 6 Web Policy Agent Installation</a></span></dt><dt><span class="section"><a href="#uninstall-iis6-agent">4.4. Remove IIS 6 Web Policy Agent Software</a></span></dt></dl></div><a class="indexterm" name="d547e1079"></a><p>This chapter covers installation of the policy agent for Microsoft 
 Internet Information Services 6.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="before-iis6-agent-install"></a>4.1.&nbsp;Before You Install</h2></div></div></div><p>Make sure OpenAM is installed, running, that you can contact OpenAM
  from the system running the policy agent. Next, create a profile for your
  policy agent as described in the <em class="citetitle">Administration Guide</em>
  section on <span class="olink"><em class="citetitle">Creating Agent
  Profiles</em></span>. To protect resources with the agent also create
  at least one policy as described in the section on <span class="olink"><em class="citetitle">Configuring
  Policies</em></span>. Consider creating a simple policy, such as a
  policy that allows only authenticated users to access your resources, in order
  to test your policy agent after installation.</p><p>You must install Microsoft IIS 6 before you install the policy agent,
  and make sure that IIS 6 allows anonymous authentication. Make sure that IIS
  6 listens on the URL used during the web policy agent installation, such as
  <code class="literal">http://win2003.example.com:80/</code>. Furthermore, you
  must reset IIS 6 after installing the policy agent.</p><p>To obtain the web agent built for this server, contact ForgeRock at <a class="link" href="mailto:info@forgerock.com" target="_top">info@forgerock.com</a>.
         Make sure to get and verify the checksum of the agent binary that you get.
         Be aware, only 64-bit versions of these specialized agents are available.</p><p>Unpack the file in the directory where you plan to install the web
  policy agent. The agent you install stores its configuration and logs
  under this directory.</p><div class="variablelist"><p>When you unpack the policy agent you download, you find the following
   directories under the <code class="filename">web_agents\iis6_agent\</code>
   directory.</p><dl class="variablelist"><dt><span class="term"><code class="filename">bin</code></span></dt><dd><p>Contains the configuration creation script,
     <span class="command"><strong>IIS6CreateConfig.vbs</strong></span>; the agent administration and
     installation script, <span class="command"><strong>IIS6Admin.vbs</strong></span>; the certificate
     management tool <span class="command"><strong>certutil.exe</strong></span>; the password hashing tool
     <span class="command"><strong>cryptit.exe</strong></span>; additional .dll and support files.</p></dd><dt><span class="term"><code class="filename">config</code></span></dt><dd><p>Configuration templates used by the scripts during configuration
     and installation</p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="install-iis6-web-agent"></a>4.2.&nbsp;Installing IIS 6 Web Policy Agent</h2></div></div></div><p>Complete the following procedures to install the policy agent.</p><div class="procedure"><a name="create-iis6-agent-profile"></a><div class="procedure-title">Procedure&nbsp;4.1.&nbsp;To Create the IIS 6 Web Agent Profile</div><p>Regardless of whether you store configurations centrally in OpenAM
   or locally with your agents, the agent requires a profile so that it can
   connect to and communicate with OpenAM.</p><ol class="procedure" type="1"><li class="step"><p>In the OpenAM console, browse to Access Control &gt;
    <em class="replaceable"><code>Realm Name</code></em>&gt; Agents &gt; Web,
    and then click the New... button in the Agent table.</p></li><li class="step"><p>Complete the web form using the following hints.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Name</span></dt><dd><p>The name for the agent profile used when you install the
       agent</p></dd><dt><span class="term">Password</span></dt><dd><p>Password the agent uses to authenticate to OpenAM</p></dd><dt><span class="term">Configuration</span></dt><dd><p>Centralized configurations are stored in the OpenAM configuration
       store. You can manage the centralized configuration through the OpenAM
       console. Local configurations are stored in a file alongside the
       agent.</p></dd><dt><span class="term">Server URL</span></dt><dd><p>The full URL to an OpenAM instance, or if OpenAM is deployed in
       a site configuration (behind a load balancer) then the site URL</p><p>In centralized configuration mode, the Server URL is used to
       populate the agent profile for services such as Login, Logout, Naming,
       and Cross Domain SSO.</p></dd><dt><span class="term">Agent URL</span></dt><dd><p>The web server URL that the agent protects</p><p>In centralized configuration mode, the Agent URL is used to
       populate the Agent Profile for services such as notifications.</p></dd></dl></div></li></ol></div><div class="procedure"><a name="create-iis6-agent-pwdfile"></a><div class="procedure-title">Procedure&nbsp;4.2.&nbsp;To Create the Password File</div><ol class="procedure" type="1"><li class="step"><p>Protect the password file you will create as appropriate.</p></li><li class="step"><p>Create a text file containing only the password.</p><div class="screen"><pre>C:\&gt;notepad C:\Windows\Temp\pwd.txt</pre></div></li></ol></div><div class="procedure"><a name="configure-iis6-agent-install"></a><div class="procedure-title">Procedure&nbsp;4.3.&nbsp;To Configure Policy Agent Installation</div><ol class="procedure" type="1"><li class="step"><p>Log on as a user with Administrator privileges.</p></li><li class="step"><p>Change to the directory where you unpacked the agent download.</p><div class="screen"><pre>C:\&gt;cd web_agents\iis6_agent\bin</pre></div></li><li class="step"><p>Create a configuration file using the
    <span class="command"><strong>IIS6CreateConfig.vbs</strong></span> script.</p><div class="note"><h3 class="title">Note</h3><p>The Web Site Identifier is the value of <code class="literal">id</code>,
     not the site name.</p></div><div class="screen"><pre>C:\web_agents\iis6_agent\bin&gt;cscript IIS6CreateConfig.vbs config.txt
...
Enter the Agent Resource File Name [IIS6Resource.en] :

Enter the Agent URL (Example: http://agent.example.com:80) :
<strong>http://windows2003.example.com:80</strong>

Displaying the list of Web Sites and its corresponding Identifiers
Site Name (Site Id)
Default Web Site (1)

Web Site Identifier :
<strong>1</strong>
...
Enter the URL where the OpenAM server is running...:
<strong>http://openam.example.com:8080/openam</strong>

Please enter the Agent Profile name :
<strong>IIS 6 Web Agent</strong>

Enter the Agent profile password file :
<strong>C:\Windows\Temp\pwd.txt</strong>

-----------------------------------------------------
Agent Configuration file created : config.txt
-----------------------------------------------------</pre></div></li></ol></div><div class="procedure"><a name="install-agent-into-iis6"></a><div class="procedure-title">Procedure&nbsp;4.4.&nbsp;To Install the Policy Agent into IIS 6</div><ol class="procedure" type="1"><li class="step"><p>Log on as a user with Administrator privileges.</p></li><li class="step"><p>Make sure OpenAM is running.</p></li><li class="step"><p>Run <span class="command"><strong>IIS6Admin.vbs</strong></span> to install the agent.</p><div class="screen"><pre>C:\web_agents\iis6_agent\bin&gt;cscript IIS6Admin.vbs -config config.txt
...
Enter the Agent Resource File Name [IIS6Resource.en] :

Creating the Agent Config Directory
Creating the OpenSSOAgentBootstrap.properties and
 OpenSSOAgentConfiguration.properties File
Updating the Windows Product Registry
Loading the IIS 6.0 Agent
Completed Configuring the IIS 6.0 Agent</pre></div></li><li class="step"><p>Restart IIS 6.</p><div class="screen"><pre>C:\web_agents\iis6_agent\bin&gt;iisreset

Attempting stop...
Internet services successfully stopped
Attempting start...
Internet services successfully restarted</pre></div><div class="note"><h3 class="title">Note</h3><p>If the agent is in a different domain than the server, refer to <em class="citetitle">Administration Guide</em> procedure, <span class="olink"><em class="citetitle">Configuring Cross-Domain
   Single Sign On</em></span>.</p></div></li><li class="step"><p>Take note of the configuration files and log locations.</p><p>Each agent instance that you install on the system has its own
    configuration and logs directory. The agent protecting the Default Web
    Site (1) shown in the examples above has configuration and logs located
    under the directory
    <code class="filename">web_agents\iis6_agent\Identifier_1</code>.
    The number in the path to the agent configuration reflects the IIS site ID,
    unlike the other agents for which the number in the path is a counter.
    The number in the path therefore remains the same when you uninstall and
    then reinstall an agent to protect the same site.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="filename">config\OpenSSOAgentBootstrap.properties</code></span></dt><dd><p>Used to bootstrap the web policy agent, allowing the agent to
       connect to OpenAM and download its configuration</p></dd><dt><span class="term"><code class="filename">config\OpenSSOAgentConfiguration.properties</code></span></dt><dd><p>Only used if you configured the web policy agent to use local
       configuration</p></dd><dt><span class="term"><code class="filename">audit\</code></span></dt><dd><p>Operational audit log directory, only used if remote logging
       to OpenAM is disabled</p></dd><dt><span class="term"><code class="filename">debug\</code></span></dt><dd><p>Debug directory where the <code class="filename">amAgent</code> debug file
       resides. Useful in troubleshooting policy agent issues.</p></dd></dl></div></li><li class="step"><p>If your policy agent configuration is not in the top-level realm (/),
       then you must edit config\OpenSSOAgentBootstrap.properties to identify
       the sub-realm that has your policy agent configuration.
       Find com.sun.identity.agents.config.organization.name and change
       the / to the path to your policy agent profile. This allows the policy agent
       to properly identify itself to the OpenAM server. </p></li><li class="step"><p>If the web policy agent performs naming URL validation, which you
     can configure by setting the
     <code class="literal">com.forgerock.agents.ext.url.validation.level</code> property
     in <code class="filename">config\OpenSSOAgentBootstrap.properties</code>, then
     make sure the <code class="literal">IUSR_<em class="replaceable"><code>MachineName</code></em></code>
     user has read-write access to <code class="filename">C:\Windows\Temp\</code> before
     you start IIS.</p></li><li class="step"><p>If you have a policy configured, you can test your policy agent.
     For example, try to browse to a resource that your policy agent protects.
     You should be redirected to OpenAM to authenticate, for example as user
     <code class="literal">demo</code>, password <code class="literal">changeit</code>. After
     you authenticate, OpenAM then redirects you back to the resource you tried
     to access.</p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="custom-iis6-agent-installation"></a>4.3.&nbsp;Custom IIS 6 Web Policy Agent Installation</h2></div></div></div><p>When protecting multiple IIS 6 websites on the same host, use different
  configuration files for each site.</p><p>When preparing a scripted, silent installation, notice that the
  configuration file generated using <span class="command"><strong>IIS6CreateConfig.vbs</strong></span>
  is a text file containing all of the configuration information in clear text
  plus the encrypted password retrieved originally from the password
  file. Encrypt passwords using <span class="command"><strong>cryptit.exe</strong></span>.</p><div class="screen"><pre>C:\web_agents\iis6_agent\bin&gt;cryptit.exe <em><strong>pwd-file</strong></em> <em><strong>encryption-key</strong></em></pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="uninstall-iis6-agent"></a>4.4.&nbsp;Remove IIS 6 Web Policy Agent Software</h2></div></div></div><p>To remove the web policy agent, log on as a user with Administrator
  privileges, run <span class="command"><strong>cscript IIS6Admin.vbs -unconfig config.txt</strong></span>,
  and then run <span class="command"><strong>iisreset</strong></span>.</p></div></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-msiis-7"></a>Chapter&nbsp;5.&nbsp;Installing the Microsoft IIS 7 Policy Agent</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="section"><a href="#before-iis7-agent-install">5.1. Before You Install</a></span></dt><dt><span class="section"><a href="#install-iis7-web-agent">5.2. Installing IIS 7 Web Policy Agent</a></span></dt><dt><span class="section"><a href="#custom-iis7-agent-installation">5.3. Custom IIS 7 Web Policy Agent Installation</a></span></dt><dt><span class="section"><a href="#iis7-enable-basic-auth">5.4. Enable IIS 7 Basic Authentication &amp; Password Replay Support</a></span></dt><dt><span class="section"><a href="#uninstall-iis7-agent">5.5. Remove IIS 7 Web Policy Agent Software</a></span></dt></dl></div><a class="indexterm" name="d547e1385"></a><p>This chapter covers installation of the policy agent for Microsoft 
 Internet Information Services 7.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="before-iis7-agent-install"></a>5.1.&nbsp;Before You Install</h2></div></div></div><p>Make sure OpenAM is installed, running, that you can contact OpenAM
  from the system running the policy agent. Next, create a profile for your
  policy agent as described in the <em class="citetitle">Administration Guide</em>
  section on <span class="olink"><em class="citetitle">Creating Agent
  Profiles</em></span>. To protect resources with the agent also create
  at least one policy as described in the section on <span class="olink"><em class="citetitle">Configuring
  Policies</em></span>. Consider creating a simple policy, such as a
  policy that allows only authenticated users to access your resources, in order
  to test your policy agent after installation.</p><p>You must install Microsoft IIS 7 before you install the policy agent,
  and make sure that IIS 7 allows anonymous authentication. Make sure that IIS
  7 listens on the URL used during the web policy agent installation, such as
  <code class="literal">http://windows7.example.com:80/</code>. Furthermore, you
  must reset IIS 7 after installing the policy agent.</p><p>To obtain the web agent built for this server, contact ForgeRock at <a class="link" href="mailto:info@forgerock.com" target="_top">info@forgerock.com</a>.
         Make sure to get and verify the checksum of the agent binary that you get.
         Be aware, only 64-bit versions of these specialized agents are available.</p><p>Unpack the file in the directory where you plan to install the web
  policy agent. The agent you install stores its configuration and logs
  under this directory.</p><div class="variablelist"><p>When you unpack the policy agent you download, you find the following
   directories under the <code class="filename">web_agents\iis7_agent\</code>
   directory.</p><dl class="variablelist"><dt><span class="term"><code class="filename">bin</code></span></dt><dd><p>Contains the configuration creation script,
     <span class="command"><strong>IIS7CreateConfig.vbs</strong></span>; the agent administration and
     installation script, <span class="command"><strong>IIS7Admin.vbs</strong></span>; the certificate
     management tool <span class="command"><strong>certutil.exe</strong></span>; the password hashing tool
     <span class="command"><strong>cryptit.exe</strong></span>; additional .dll and support files.</p></dd><dt><span class="term"><code class="filename">config</code></span></dt><dd><p>Configuration templates used by the scripts during configuration
     and installation</p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="install-iis7-web-agent"></a>5.2.&nbsp;Installing IIS 7 Web Policy Agent</h2></div></div></div><p>Complete the following procedures to install the policy agent.</p><div class="procedure"><a name="create-iis7-agent-profile"></a><div class="procedure-title">Procedure&nbsp;5.1.&nbsp;To Create the IIS 7 Web Agent Profile</div><p>Regardless of whether you store configurations centrally in OpenAM
   or locally with your agents, the agent requires a profile so that it can
   connect to and communicate with OpenAM.</p><ol class="procedure" type="1"><li class="step"><p>In the OpenAM console, browse to Access Control &gt;
    <em class="replaceable"><code>Realm Name</code></em>&gt; Agents &gt; Web,
    and then click the New... button in the Agent table.</p></li><li class="step"><p>Complete the web form using the following hints.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Name</span></dt><dd><p>The name for the agent profile used when you install the
       agent</p></dd><dt><span class="term">Password</span></dt><dd><p>Password the agent uses to authenticate to OpenAM</p></dd><dt><span class="term">Configuration</span></dt><dd><p>Centralized configurations are stored in the OpenAM configuration
       store. You can manage the centralized configuration through the OpenAM
       console. Local configurations are stored in a file alongside the
       agent.</p></dd><dt><span class="term">Server URL</span></dt><dd><p>The full URL to an OpenAM instance, or if OpenAM is deployed in
       a site configuration (behind a load balancer) then the site URL</p><p>In centralized configuration mode, the Server URL is used to
       populate the agent profile for services such as Login, Logout, Naming,
       and Cross Domain SSO.</p></dd><dt><span class="term">Agent URL</span></dt><dd><p>The web server URL that the agent protects</p><p>In centralized configuration mode, the Agent URL is used to
       populate the Agent Profile for services such as notifications.</p></dd></dl></div></li></ol></div><div class="procedure"><a name="create-iis7-agent-pwdfile"></a><div class="procedure-title">Procedure&nbsp;5.2.&nbsp;To Create the Password File</div><ol class="procedure" type="1"><li class="step"><p>Protect the password file you will create as appropriate.</p></li><li class="step"><p>Create a text file containing only the password.</p><div class="screen"><pre>C:\&gt;notepad C:\Windows\Temp\pwd.txt</pre></div></li></ol></div><div class="procedure"><a name="configure-iis7-agent-install"></a><div class="procedure-title">Procedure&nbsp;5.3.&nbsp;To Configure Policy Agent Installation</div><ol class="procedure" type="1"><li class="step"><p>Log on as a user with Administrator privileges.</p></li><li class="step"><p>Change to the directory where you unpacked the agent download.</p><div class="screen"><pre>C:\&gt;cd web_agents\iis7_agent\bin</pre></div></li><li class="step"><p>Create a configuration file using the
    <span class="command"><strong>IIS7CreateConfig.vbs</strong></span> script.</p><div class="note"><h3 class="title">Note</h3><p>The Web Site Identifier is the value of <code class="literal">id</code>,
     not the site name.</p></div><div class="screen"><pre>C:\web_agents\iis7_agent\bin&gt;cscript IIS7CreateConfig.vbs config.txt
...
Enter the Agent Resource File Name [IIS7Resource.en] :

Enter the Agent URL (Example: http://agent.example.com:80) :
<strong>http://windows7.example.com:80</strong>

Displaying the list of Web Sites and its corresponding Identifiers (id)

SITE "Default Web Site" (id:1,bindings:http/*:80:,state:Started)

Web Site Identifier :
<strong>1</strong>
...
Enter the URL where the OpenAM server is running...:
<strong>http://openam.example.com:8080/openam</strong>

Please enter the Agent Profile name :
<strong>IIS 7 Web Agent</strong>

Enter the Agent profile password file :
<strong>C:\Windows\Temp\pwd.txt</strong>

-----------------------------------------------------
Agent Configuration file created : config.txt
-----------------------------------------------------</pre></div></li></ol></div><div class="procedure"><a name="install-agent-into-iis7"></a><div class="procedure-title">Procedure&nbsp;5.4.&nbsp;To Install the Policy Agent into IIS 7</div><ol class="procedure" type="1"><li class="step"><p>Log on as a user with Administrator privileges.</p></li><li class="step"><p>Make sure OpenAM is running.</p></li><li class="step"><p>Run <span class="command"><strong>IIS7Admin.vbs</strong></span> to install the agent.</p><div class="screen"><pre>C:\web_agents\iis7_agent\bin&gt;cscript IIS7Admin.vbs -config config.txt
...
Enter the Agent Resource File Name [IIS7Resource.en] :

Creating the Agent Config Directory
Creating the OpenSSOAgentBootstrap.properties and
 OpenSSOAgentConfiguration.properties File
Updating the Windows Product Registry
Installing policy web agent module in IIS (status: 0)
Adding policy web agent module to "Default Web Site" (status: 0)
Completed Configuring the IIS 7.0 Agent</pre></div></li><li class="step"><p>Make sure the authentication method for IIS 7 is set to
    anonymous.</p></li><li class="step"><p>Restart IIS 7.</p><div class="screen"><pre>C:\web_agents\iis7_agent\bin&gt;iisreset

Attempting stop...
Internet services successfully stopped
Attempting start...
Internet services successfully restarted</pre></div><div class="note"><h3 class="title">Note</h3><p>If the agent is in a different domain than the server, refer to <em class="citetitle">Administration Guide</em> procedure, <span class="olink"><em class="citetitle">Configuring Cross-Domain
   Single Sign On</em></span>.</p></div></li><li class="step"><p>Take note of the configuration files and log locations.</p><p>Each agent instance that you install on the system has its own
    configuration and logs directory. The agent protecting the Default Web
    Site (id: 1) shown in the examples above has configuration and logs located
    under the directory
    <code class="filename">web_agents\iis7_agent\Identifier_1</code>.
    The number in the path to the agent configuration reflects the IIS site ID,
    unlike the other agents for which the number in the path is a counter.
    The number in the path therefore remains the same when you uninstall and
    then reinstall an agent to protect the same site.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="filename">config\OpenSSOAgentBootstrap.properties</code></span></dt><dd><p>Used to bootstrap the web policy agent, allowing the agent to
       connect to OpenAM and download its configuration</p></dd><dt><span class="term"><code class="filename">config\OpenSSOAgentConfiguration.properties</code></span></dt><dd><p>Only used if you configured the web policy agent to use local
       configuration</p></dd><dt><span class="term"><code class="filename">audit\</code></span></dt><dd><p>Operational audit log directory, only used if remote logging
       to OpenAM is disabled</p></dd><dt><span class="term"><code class="filename">debug\</code></span></dt><dd><p>Debug directory where the <code class="filename">amAgent</code> debug file
       resides. Useful in troubleshooting policy agent issues.</p></dd></dl></div></li><li class="step"><p>If your policy agent configuration is not in the top-level realm (/),
       then you must edit config\OpenSSOAgentBootstrap.properties to identify
       the sub-realm that has your policy agent configuration.
       Find com.sun.identity.agents.config.organization.name and change
       the / to the path to your policy agent profile. This allows the policy agent
       to properly identify itself to the OpenAM server. </p></li><li class="step"><p>If you have a policy configured, you can test your policy agent.
     For example, try to browse to a resource that your policy agent protects.
     You should be redirected to OpenAM to authenticate, for example as user
     <code class="literal">demo</code>, password <code class="literal">changeit</code>. After
     you authenticate, OpenAM then redirects you back to the resource you tried
     to access.</p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="custom-iis7-agent-installation"></a>5.3.&nbsp;Custom IIS 7 Web Policy Agent Installation</h2></div></div></div><p>When protecting multiple IIS 7 websites on the same host, use different
  configuration files for each site.</p><p>When preparing a scripted, silent installation, notice that the
  configuration file generated using <span class="command"><strong>IIS7CreateConfig.vbs</strong></span>
  is a text file containing all of the configuration information in clear text
  plus the encrypted password retrieved originally from the password
  file. Encrypt passwords using <span class="command"><strong>cryptit.exe</strong></span>.</p><div class="screen"><pre>C:\web_agents\iis7_agent\bin&gt;cryptit.exe <em><strong>pwd-file</strong></em> <em><strong>encryption-key</strong></em></pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="iis7-enable-basic-auth"></a>5.4.&nbsp;Enable IIS 7 Basic Authentication &amp; Password Replay Support</h2></div></div></div><div class="itemizedlist"><p>The IIS 7 web policy agent now supports IIS 7 basic authentication and
   password replay. You must use the appropriate software versions.</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>For Microsoft Office integration, you must use Microsoft Office 2007
    SP2 or later.</p></li><li class="listitem"><p>For Microsoft SharePoint integration, you must use Microsoft
    SharePoint Server 2007 SP2 or later.</p></li></ul></div><div class="variablelist"><p>You must also apply workarounds as described for the following
   Microsoft issues.</p><dl class="variablelist"><dt><span class="term">Microsoft Support Issue: 841215</span></dt><dd><p>Link: <a class="link" href="http://support.microsoft.com/kb/841215" target="_blank">http://support.microsoft.com/kb/841215</a></p><p>Description: Error message when you try to connect to a Windows
     SharePoint document library: "System error 5 has occurred"</p><p>Summary: Enable Basic Authentication on the client computer.</p></dd><dt><span class="term">Microsoft Support Issue: 870853</span></dt><dd><p>Link: <a class="link" href="http://support.microsoft.com/kb/870853" target="_blank">http://support.microsoft.com/kb/870853</a></p><p>Description: Office 2003 and 2007 Office documents open read-only
     in Internet Explorer</p><p>Summary: Add registry keys as described in Microsoft's support
     document.</p></dd><dt><span class="term">Microsoft Support Issue: 928692</span></dt><dd><p>Link: <a class="link" href="http://support.microsoft.com/kb/928692" target="_blank">http://support.microsoft.com/kb/928692</a></p><p>Description: Error message when you open a Web site by using Basic
     authentication in Expression Web on a computer that is running Windows
     Vista: "The folder name is not valid"</p><p>Summary: Edit the registry as described in Microsoft's support
     document.</p></dd><dt><span class="term">Microsoft Support Issue: 932118</span></dt><dd><p>Link: <a class="link" href="http://support.microsoft.com/kb/932118" target="_blank">http://support.microsoft.com/kb/932118</a></p><p>Description: Persistent cookies are not shared between Internet
     Explorer and Office applications</p><p>Summary: Add the web site the list of trusted sites.</p></dd><dt><span class="term">Microsoft Support Issue: 943280</span></dt><dd><p>Link: <a class="link" href="http://support.microsoft.com/kb/943280" target="_blank">http://support.microsoft.com/kb/943280</a></p><p>Description: Prompt for Credentials When Accessing FQDN Sites From a
     Windows Vista or Windows 7 Computer</p><p>Summary: Edit the registry as described in Microsoft's support
     document.</p></dd><dt><span class="term">Microsoft Support Issue: 968851</span></dt><dd><p>Link: <a class="link" href="http://support.microsoft.com/kb/968851" target="_blank">http://support.microsoft.com/kb/968851</a></p><p>Description: SharePoint Server 2007 Cumulative Update Server
     Hotfix Package (MOSS server-package): April 30, 2009</p><p>Summary: Apply the fix from Microsoft if you use SharePoint.</p></dd><dt><span class="term">Microsoft Support Issue: 2123563</span></dt><dd><p>Link: <a class="link" href="http://support.microsoft.com/kb/2123563" target="_blank">http://support.microsoft.com/kb/2123563</a></p><p>Description: You cannot open Office file types directly from a
     server that supports only Basic authentication over a non-SSL
     connection</p><p>Summary: Enable SSL encryption on the web server.</p></dd></dl></div><div class="procedure"><a name="configure-ii7-basic-auth"></a><div class="procedure-title">Procedure&nbsp;5.5.&nbsp;To Configure IIS 7 Basic Authentication &amp; Password Replay Support</div><p>Follow these steps.</p><ol class="procedure" type="1"><li class="step"><p>Generate and store an encryption key.</p><ol type="a" class="substeps"><li class="step"><p>Generate the key using
      <code class="literal">com.sun.identity.common.DESGenKey</code> using the .jars
      where you deployed OpenAM, as in the following example.</p><div class="screen"><pre>$ cd /path/to/tomcat/webapps/openam/WEB-INF/lib
$ java -cp openam-core-11.0.0.jar:openam-shared-11.0.0.jar
 com.sun.identity.common.DESGenKey
Key ==&gt; sxVoaDRAN0o=</pre></div></li><li class="step"><p>Store the key in the agent configuration on the property in the
      OpenAM console under Access Control &gt;
      <em class="replaceable"><code>realm-name</code></em> &gt; Agents &gt; Web &gt;
      <em class="replaceable"><code>agent-name</code></em> &gt; Advanced &gt; Microsoft IIS
      Server &gt; Replay Password Key (property name:
      <code class="literal">com.sun.identity.agents.config.replaypasswd.key</code>),
      and then Save your work.</p></li><li class="step"><p>Store the key in the server configuration in the OpenAM console
      under Configuration &gt; Servers and Sites &gt;
      <em class="replaceable"><code>server-name</code></em> &gt; Advanced &gt; Add... to add
      the property <code class="literal">com.sun.am.replaypasswd.key</code> with the
      key you generated as the value, and then Save your work.</p></li></ol></li><li class="step"><p>In the OpenAM console under Access Control &gt;
      <em class="replaceable"><code>realm-name</code></em> &gt; Authentication &gt; All Core
      Settings... &gt; Authentication Post Processing Classes, add the class
      <code class="literal">com.sun.identity.authentication.spi.ReplayPasswd</code>,
      and then Save your work.</p></li><li class="step"><p>If you require Windows logon, or you need to use basic authentication
    with SharePoint or OWA, then you must configure Active Directory as a
    user date store, and you must configure the IIS 7 policy agent profile
    User ID Parameter and User ID Parameter Type so that the policy agent
    requests OpenAM to provide the appropriate account information from
    Active Directory in its policy response.</p><p>Skip this step if you do not use SharePoint or OWA and no Windows
    logon is required.</p><p>Make sure OpenAM data store is configured to use Active Directory as
    the user data store.</p><p>In the OpenAM console under Access Control &gt;
    <em class="replaceable"><code>realm-name</code></em> &gt; Agents &gt; Web &gt;
    <em class="replaceable"><code>agent-name</code></em> &gt; OpenAM Services &gt; Policy
    Client Service, set User ID Parameter and User ID Parameter Type, and then
    Save your work. For example if the real username for Windows domain logon
    in Active Directory is stored on the <code class="literal">samaccountname</code>
    attribute, then set the User ID Parameter to
    <code class="literal">samaccountname</code>, and the User ID Parameter Type to
    <code class="literal">LDAP</code>.</p><p>Setting the User ID Parameter Type to <code class="literal">LDAP</code> causes
    the policy agent to request that OpenAM get the value of the User ID
    Parameter attribute from the data store, in this case Active Directory.
    Given that information, the policy agent can set the HTTP headers
    <code class="literal">remote_user</code>, <code class="literal">auth_user</code>, or
    <code class="literal">logon_user</code> and <code class="literal">user_password</code> with
    Active Directory attribute values suitable for Windows logon, setting the
    remote user, and so forth.</p></li><li class="step"><p>To set the encrypted password in the AUTH_PASSWORD header, in the
    OpenAM console under Access Control &gt;
    <em class="replaceable"><code>realm-name</code></em> &gt; Agents &gt; Web &gt;
    <em class="replaceable"><code>agent-name</code></em> &gt; Advanced &gt; Custom Properties, 
    add <code class="literal">com.sun.identity.agents.config.iis.password.header=true</code>.</p></li><li class="step"><p>To have the agent perform Windows logon (for user token
    impersonation), in the OpenAM console under Access Control &gt;
    <em class="replaceable"><code>realm-name</code></em> &gt; Agents &gt; Web &gt;
    <em class="replaceable"><code>agent-name</code></em> &gt; Advanced &gt; Custom Properties, 
    add <code class="literal">com.sun.identity.agents.config.iis.logonuser=true</code>.</p></li><li class="step"><p>In the OpenAM console under Access Control &gt;
    <em class="replaceable"><code>realm-name</code></em> &gt; Agents &gt; Web &gt;
    <em class="replaceable"><code>agent-name</code></em> &gt; Advanced &gt; Microsoft IIS
    Server, set Authentication Type to basic, and then Save your work.</p></li><li class="step"><p>To use the agent with SharePoint or Microsoft Office, configure
    OpenAM to support the <code class="literal">iPlanetDirectoryPro</code> as a persistent
    cookie.</p><p>In the OpenAM console under Access Control &gt;
      <em class="replaceable"><code>realm-name</code></em> &gt; Authentication &gt; All Core
      Settings... &gt; Persistent Cookie Mode, select Enabled, and then Save
      your work.</p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="uninstall-iis7-agent"></a>5.5.&nbsp;Remove IIS 7 Web Policy Agent Software</h2></div></div></div><p>To remove the web policy agent, log on as a user with Administrator
  privileges, run <span class="command"><strong>cscript IIS7Admin.vbs -unconfig config.txt</strong></span>,
  and then run <span class="command"><strong>iisreset</strong></span>.</p></div></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-sun-websvr"></a>Chapter&nbsp;6.&nbsp;Installing the Oracle iPlanet/Sun Web Server Policy Agent</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="section"><a href="#before-sjsws-agent-install">6.1. Before You Install</a></span></dt><dt><span class="section"><a href="#install-sjsws-web-agent">6.2. Installing Oracle iPlanet Web Server Web Policy Agent</a></span></dt><dt><span class="section"><a href="#custom-sjsws-agent-installation">6.3. Custom Oracle iPlanet Web Policy Agent Installation</a></span></dt><dt><span class="section"><a href="#uninstall-sjsws-agent">6.4. Remove Oracle iPlanet Web Policy Agent Software</a></span></dt></dl></div><a class="indexterm" name="d547e1911"></a><a class="indexterm" name="d547e1914"></a><p>This chapter covers installation of the policy agent for Oracle iPlanet
 Web Server, formerly known as Sun Web Server.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="before-sjsws-agent-install"></a>6.1.&nbsp;Before You Install</h2></div></div></div><p>Make sure OpenAM is installed, running, that you can contact OpenAM
  from the system running the policy agent. Next, create a profile for your
  policy agent as described in the <em class="citetitle">Administration Guide</em>
  section on <span class="olink"><em class="citetitle">Creating Agent
  Profiles</em></span>. To protect resources with the agent also create
  at least one policy as described in the section on <span class="olink"><em class="citetitle">Configuring
  Policies</em></span>. Consider creating a simple policy, such as a
  policy that allows only authenticated users to access your resources, in order
  to test your policy agent after installation.</p><p>You must install Apache HTTP Server before you install the policy
  agent, and you must stop the server during installation.</p><p>You must install a supported version of the Java runtime environment.
         Please review the <a href="../web-release-notes/index.html#java-requirements-web-agents" class="link">
             <em class="citetitle">Release Notes</em></a> for the currently supported version
         of Java, and set the <code class="literal">JAVA_HOME</code> environment
         variable accordingly. The policy agent installer requires Java.</p><div class="screen"><pre>$ echo $JAVA_HOME
/path/to/java
$ which java
/usr/bin/java</pre></div><p>To obtain the web agent built for this server, contact ForgeRock at <a class="link" href="mailto:info@forgerock.com" target="_top">info@forgerock.com</a>.
         Make sure to get and verify the checksum of the agent binary that you get.
         Be aware, only 64-bit versions of these specialized agents are available.</p><p>Unzip the file in the directory where you plan to install the web
  policy agent. The agent you install stores its configuration and logs
  under this directory.</p><div class="variablelist"><p>When you unzip the policy agent .zip download, you find the following
   directories under the <code class="filename">web_agents/sjsws_agent</code>
   directory.</p><dl class="variablelist"><dt><span class="term"><code class="filename">bin</code></span></dt><dd><p>Contains the installation and configuration program,
     <span class="command"><strong>agentadmin</strong></span>; the certificate management tool
     <span class="command"><strong>certutil</strong></span> and the password hashing tool
     <span class="command"><strong>crypt_util</strong></span>.</p></dd><dt><span class="term"><code class="filename">config</code></span></dt><dd><p>Configuration templates used by the <span class="command"><strong>agentadmin</strong></span>
     command during installation</p></dd><dt><span class="term"><code class="filename">data</code></span></dt><dd><p>Not used</p></dd><dt><span class="term"><code class="filename">etc</code></span></dt><dd><p>Not used</p></dd><dt><span class="term"><code class="filename">installer-logs</code></span></dt><dd><p>Location for log files written during installation</p></dd><dt><span class="term"><code class="filename">lib</code></span></dt><dd><p>Shared libraries used by the web policy agent</p></dd><dt><span class="term"><code class="filename">locale</code></span></dt><dd><p>Property files used by the installation program</p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="install-sjsws-web-agent"></a>6.2.&nbsp;Installing Oracle iPlanet Web Server Web Policy Agent</h2></div></div></div><p>Complete the following procedures to install the policy agent.</p><div class="procedure"><a name="create-sjsws-agent-profile"></a><div class="procedure-title">Procedure&nbsp;6.1.&nbsp;To Create the Oracle iPlanet Web Server Web Agent Profile</div><p>Regardless of whether you store configurations centrally in OpenAM
   or locally with your agents, the agent requires a profile so that it can
   connect to and communicate with OpenAM.</p><ol class="procedure" type="1"><li class="step"><p>In the OpenAM console, browse to Access Control &gt;
    <em class="replaceable"><code>Realm Name</code></em>&gt; Agents &gt; Web,
    and then click the New... button in the Agent table.</p></li><li class="step"><p>Complete the web form using the following hints.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Name</span></dt><dd><p>The name for the agent profile used when you install the
       agent</p></dd><dt><span class="term">Password</span></dt><dd><p>Password the agent uses to authenticate to OpenAM</p></dd><dt><span class="term">Configuration</span></dt><dd><p>Centralized configurations are stored in the OpenAM configuration
       store. You can manage the centralized configuration through the OpenAM
       console. Local configurations are stored in a file alongside the
       agent.</p></dd><dt><span class="term">Server URL</span></dt><dd><p>The full URL to an OpenAM instance, or if OpenAM is deployed in
       a site configuration (behind a load balancer) then the site URL</p><p>In centralized configuration mode, the Server URL is used to
       populate the agent profile for services such as Login, Logout, Naming,
       and Cross Domain SSO.</p></dd><dt><span class="term">Agent URL</span></dt><dd><p>The web server URL that the agent protects</p><p>In centralized configuration mode, the Agent URL is used to
       populate the Agent Profile for services such as notifications.</p></dd></dl></div></li></ol></div><div class="procedure"><a name="create-sjsws-agent-pwdfile"></a><div class="procedure-title">Procedure&nbsp;6.2.&nbsp;To Create the Password File</div><ol class="procedure" type="1"><li class="step"><p>Create a text file containing only the password.</p><div class="screen"><pre>$ echo password &gt; /tmp/pwd.txt</pre></div></li><li class="step"><p>Protect the password file you create as appropriate for your
    operating system.</p><div class="screen"><pre>$ chmod 400 /tmp/pwd.txt</pre></div></li></ol></div><div class="procedure"><a name="install-agent-into-sjsws"></a><div class="procedure-title">Procedure&nbsp;6.3.&nbsp;To Install the Policy Agent into Oracle iPlanet Web Server</div><ol class="procedure" type="1"><li class="step"><p>Shut down Oracle iPlanet Web Server instance where you plan to install
    the agent.</p></li><li class="step"><p>Make sure OpenAM is running.</p></li><li class="step"><p>Run <span class="command"><strong>agentadmin --install</strong></span> to install the
    agent.</p><div class="screen"><pre>$ /path/to/web_agents/sjsws_agent/bin/agentadmin --install
...
-----------------------------------------------
SUMMARY OF YOUR RESPONSES
-----------------------------------------------
Sun Java System Web Server Config Directory :
/path/to/webserver7/https-www.example.com/config/
OpenAM server URL : http://openam.example.com:8080/openam
Agent URL : http://www.example.com:8080
Agent Profile name : Sun Web Server Agent
Agent Profile Password file name : /tmp/pwd.txt

...
SUMMARY OF AGENT INSTALLATION
-----------------------------
Agent instance name: Agent_001
Agent Bootstrap file location:
/path/to/web_agents/sjsws_agent/Agent_001/config/
 OpenSSOAgentBootstrap.properties
Agent Configuration Tag file location
/path/to/web_agents/sjsws_agent/Agent_001/config/
 OpenSSOAgentConfiguration.properties
Agent Audit directory location:
/path/to/web_agents/sjsws_agent/Agent_001/logs/audit
Agent Debug directory location:
/path/to/web_agents/sjsws_agent/Agent_001/logs/debug


Install log file location:
/path/to/web_agents/sjsws_agent/installer-logs/audit/install.log
...</pre></div><p>Upon successful completion, the installer has backed up and updated
    the Oracle iPlanet Web Server instance configuration, and has also set up
    configuration and log directories for the agent.</p><div class="note"><h3 class="title">Note</h3><p>If the agent is in a different domain than the server, refer to <em class="citetitle">Administration Guide</em> procedure, <span class="olink"><em class="citetitle">Configuring Cross-Domain
   Single Sign On</em></span>.</p></div></li><li class="step"><p>Take note of the configuration files and log locations.</p><p>Each agent instance that you install on the system has its own
    numbered configuration and logs directory. The first agent's configuration
    and logs are thus located under the directory
    <code class="filename">web_agents/sjsws_agent/Agent_001/</code>.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="filename">config/OpenSSOAgentBootstrap.properties</code></span></dt><dd><p>Used to bootstrap the web policy agent, allowing the agent to
       connect to OpenAM and download its configuration</p></dd><dt><span class="term"><code class="filename">config/OpenSSOAgentConfiguration.properties</code></span></dt><dd><p>Only used if you configured the web policy agent to use local
       configuration</p></dd><dt><span class="term"><code class="filename">logs/audit/</code></span></dt><dd><p>Operational audit log directory, only used if remote logging
       to OpenAM is disabled</p></dd><dt><span class="term"><code class="filename">logs/debug/</code></span></dt><dd><p>Debug log directory. Useful in troubleshooting policy agent
       issues.</p></dd></dl></div></li><li class="step"><p>If your policy agent configuration is not in the top-level realm (/),
       then you must edit config/OpenSSOAgentBootstrap.properties to identify
       the sub-realm that has your policy agent configuration.
       Find com.sun.identity.agents.config.organization.name and change
       the / to the path to your policy agent profile. This allows the policy agent
       to properly identify itself to the OpenAM server. </p></li><li class="step"><p>Set up ownership of the log directory. The default is to run as a 
    webservd user instead of root. To post its logs, the agent needs permission to 
    add the files to the directory.</p><div class="screen"><pre>chown -R webservd:webservd /opt/web_agents/sjsws_agent/Agent_<em><strong>number</strong></em>/logs</pre></div></li><li class="step"><p>Restart the Oracle iPlanet Web Server instance where you installed the
    agent.</p></li><li class="step"><p>Check that the agent protects the web site.</p><p>If you have not yet configured any policies to allow access, then
    you should receive an HTTP 403 Forbidden error. In the above example, when
    accessing <code class="literal">http://www.example.com:8080/</code>, the content of
    the page returned appears in the browser as follows.</p><div class="literallayout"><p><span class="strong"><strong>Forbidden</strong></span><br>
<br>
Your&nbsp;client&nbsp;is&nbsp;not&nbsp;allowed&nbsp;to&nbsp;access&nbsp;the&nbsp;requested&nbsp;object.</p></div><p>If it appears the protection is inadequate, complete one of the 
    following steps.</p><div class="note"><h3 class="title">Note</h3><p>A potential cause for the protection failing is updates to the 
       <code class="filename">server.xml</code> file for the <code class="literal">object-file</code>
       property. A <code class="literal">object-file</code> property refers to the 
       <code class="literal">obj.conf</code> file created during the web server installation.
       Multiple servers create their own <code class="literal">obj.conf</code> files, which can
       cause problems with protection. Also, admin changes can update the
       <code class="literal">obj.conf</code> file. For more information, checkout the <a class="link" href="http://docs.oracle.com/cd/E19146-01/821-1827/abvag/index.html" target="_blank">
       <em class="citetitle">Syntax and Use of obj.conf</em></a>.</p></div><ul class="stepalternatives">
     <li class="step"><p>This step removes the <code class="filename">obj.conf</code> file if it is 
      not needed.</p><p>Open the <code class="filename">server.xml</code> and remove the <code class="literal">object-file</code>
      property. The web server will use the default <code class="filename">obj.conf</code>
      configuration.</p><div class="note"><h3 class="title">Note</h3><p>Do not change the original file.</p></div><div class="screen"><pre>$ vi /path/to/webserver7/config/server.xml
 &lt;virtual-server&gt;
  &lt;name&gt;virtual.example.com&lt;/name&gt;
  &lt;http-listener-name&gt;http-listener-1&lt;/http-listenername&gt;
  &lt;host&gt;virtual.example.com&lt;/host&gt;
  -  &lt;object-file&gt;virtual.example.com-obj.conf&lt;/object-file&gt;
  &lt;document-root&gt;/path/to/webserver7/htdocs&lt;/document-root&gt;
  &lt;name&gt;virtual.example.com&lt;/name&gt;
 &lt;/virtual-server&gt;</pre></div></li>
     <li class="step"><p>This step updates the <code class="filename">obj.conf</code> file if it 
      is needed.</p><p>Open the <code class="filename">server.xml</code> and manually update the 
      <code class="literal">object-file</code> property to validate the location of
      the <code class="filename">obj.conf</code> file.</p><div class="note"><h3 class="title">Note</h3><p>Do not change the original file.</p></div><div class="screen"><pre>$ vi /path/to/webserver7/config/server.xml
 &lt;Object path="*/dummypost/sunpostpreserve*"&gt;
 Service type=text/* method=(GET) fn=append_post_data
 &lt;/Object&gt;
 &lt;Object path="*/UpdateAgentCacheServlet*"&gt;
 Service type=text/* method=(POST) fn=process_notification
 &lt;/Object&gt;</pre></div></li>
    </ul></li><li class="step"><p>Save the file and restart the Oracle iPlanet Web Server.</p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="custom-sjsws-agent-installation"></a>6.3.&nbsp;Custom Oracle iPlanet Web Policy Agent Installation</h2></div></div></div><p>For alternative installations, use <span class="command"><strong>agentadmin
  --custom-install</strong></span>.</p><p>When performing a scripted, silent installation, use
  <span class="command"><strong>agentadmin --install --saveResponse
  <em class="replaceable"><code>response-file</code></em></strong></span>
  to create a response file for scripted installation. Then install silently
  using <span class="command"><strong>agentadmin --install --useResponse
  <em class="replaceable"><code>response-file</code></em></strong></span>.</p><p>With <span class="command"><strong>./agentadmin --custom-install</strong></span>, you can opt to
  create the policy agent profile during installation. The OpenAM administrator
  must first create an agent administrator user, as described in <span class="olink"><em class="citetitle">Delegating Agent
  Profile Creation</em></span>, and provide you with the agent
  administrator user name and password. Before running the
  <span class="command"><strong>./agentadmin --custom-install</strong></span> command, put the password
  alone in a read-only file only the user installing can access, as for the
  agent password. When the <span class="command"><strong>agentadmin</strong></span> command prompts you to
  create the profile during installation, enter <code class="literal">true</code>, and
  then respond to the <span class="command"><strong>agentadmin</strong></span> prompts for the agent
  administrator user name and password file.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="uninstall-sjsws-agent"></a>6.4.&nbsp;Remove Oracle iPlanet Web Policy Agent Software</h2></div></div></div><p>Shut down the Oracle iPlanet Web Server before you uninstall the
    policy agent.</p><p>To remove the web policy agent, use <span class="command"><strong>agentadmin
  --uninstall</strong></span>.</p></div></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-troubleshooting"></a>Chapter&nbsp;7.&nbsp;Troubleshooting</h1></div></div></div><a class="indexterm" name="d547e2317"></a><p>This chapter offers solutions to issues during installation of OpenAM
  policy agents.</p><div class="qandaset"><h2 class="title"><a name="solutions-to-common-issues"></a>Solutions to Common Issues</h2><p>This section offers solutions to common problems when installing 
   OpenAM policy agents.</p><table border="0" style="width: 100%;"><colgroup><col align="left" width="1%"><col></colgroup><tbody><tr class="question"><td align="left" valign="top"><a name="cannot-install-over-https"></a><a name="d547e2328"></a><p><b>Q:</b></p></td><td align="left" valign="top"><p>I am trying to install a policy agent, connecting to OpenAM over
    HTTPS, and seeing the following error.</p><div class="screen"><pre>OpenAM server URL: https://openam.example.com:8443/openam

WARNING: Unable to connect to OpenAM server URL. Please specify the
correct OpenAM server URL by hitting the Back button (&lt;) or if the OpenAM
server URL is not started and you want to start it later, please proceed with
the installation.
If OpenAM server is SSL enabled and the root CA certificate for the OpenAM
server certificate has been not imported into installer JVMs key store (see
installer-logs/debug/Agent.log for detailed exception), import the root
CA certificate and restart the installer; or continue installation without
verifying OpenAM server URL.</pre></div><p>What should I do?</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>A:</b></p></td><td align="left" valign="top"><p>The Java platform includes certificates from many Certificate
    Authorities (CAs). If however you run your own CA, or you use self-signed
    certificates for HTTPS on the container where you run OpenAM, then the
    <span class="command"><strong>agentadmin</strong></span> command cannot trust the certificate
    presented during connection to OpenAM, and so cannot complete installation
    correctly.</p><p>After setting up the container where you run OpenAM to use HTTPS,
    get the certificate to trust in a certificate file. The certificate you
    want is the that of the CA who signed the container certificate, or the
    certificate itself if the container certificate is self-signed.</p><p>Copy the certificate file to the system where you plan to install the
    policy agent. Import the certificate into a trust store that you will use
    during policy agent installation. If you import the certificate into the
    default trust store for the Java platform, then the
    <span class="command"><strong>agentadmin</strong></span> command can recognize it without additional
    configuration.</p><p>Export and import of self-signed certificates is demonstrated in the
    <em class="citetitle">Administration Guide</em> chapter on <span class="olink"><em class="citetitle">Managing
    Certificates</em></span>.</p></td></tr><tr class="question"><td align="left" valign="top"><a name="debug-file-and-SELinux"></a><a name="d547e2358"></a><p><b>Q:</b></p></td><td align="left" valign="top"><p>I am trying to install the policy agent on SELinux and I am getting error messages
  after installation. What happened?</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>A:</b></p></td><td align="left" valign="top"><p>SELinux must be properly configured to connect the web policy agent and OpenAM
  nodes. Either re-configure SELinux or disable it, then reinstall the policy agent.</p></td></tr><tr class="question"><td align="left" valign="top"><a name="apache-defaults-to-port-80"></a><a name="d547e2365"></a><p><b>Q:</b></p></td><td align="left" valign="top"><p>My Apache HTTPD server is not using port 80. But when I install the
    web policy agent it defaults to port 80. How do I fix this?</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>A:</b></p></td><td align="left" valign="top"><p>You probably set <code class="literal">ServerName</code> in Apache HTTPD's
    configuration to the host name, but did not specify the port number.</p><p>Instead you must set both the host name and port number for
    <code class="literal">ServerName</code> in Apache HTTPD's configuration. For
    example, if you have Apache HTTPD configured to listen on port 8080, then
    set <code class="literal">ServerName</code> appropriately as in the following
    excerpt.</p><pre class="brush: plain;">&lt;VirtualHost *:8080&gt;
ServerName www.localhost.example:8080</pre></td></tr><tr class="question"><td align="left" valign="top"><a name="web-agent-cannot-rotate-logs"></a><a name="d547e2385"></a><p><b>Q:</b></p></td><td align="left" valign="top"><p>My web server and web policy agent are installed as root, and the
    agent cannot rotate logs. I am seeing this error.</p><pre class="literallayout">Could not rotate log file ... (error: 13)</pre><p>What should I do?</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>A:</b></p></td><td align="left" valign="top"><p>First, avoid installing the web server (and therefore also the web
    policy agent) as root, but instead create a web server user and install
    as that user.</p><p>If however you cannot avoid installing the web server and policy agent
    as root, the you must give all users read and write permissions to the
    <code class="filename">logs/</code> and <code class="filename">logs/debug</code> directories
    under the agent instance directory (
    <code class="filename">/path/to/web_agents/<em class="replaceable"><code>type</code></em>/Agent_<em class="replaceable"><code>number</code></em>/logs/</code>).
    Otherwise the web policy agent fails to rotate log files with the error
    you observed.</p></td></tr></tbody></table></div></div><div class="index"><div class="titlepage"><div><div><h1 class="title"><a name="d547e2412"></a>Index</h1></div></div></div><div class="index"><div class="indexdiv"><h3>A</h3><dl><dt>Apache HTTP Server, <a class="indexterm" href="#chap-apache-22">Installing the Apache 2.2 Policy Agent</a>, <a class="indexterm" href="#chap-apache-24">Installing the Apache 2.4 Policy Agent</a></dt></dl></div><div class="indexdiv"><h3>M</h3><dl><dt>Microsoft IIS, <a class="indexterm" href="#chap-msiis-6">Installing the Microsoft IIS 6 Policy Agent</a>, <a class="indexterm" href="#chap-msiis-7">Installing the Microsoft IIS 7 Policy Agent</a></dt></dl></div><div class="indexdiv"><h3>O</h3><dl><dt>Oracle iPlanet Web Server, <a class="indexterm" href="#chap-sun-websvr">Installing the Oracle iPlanet/Sun Web Server Policy Agent</a></dt></dl></div><div class="indexdiv"><h3>S</h3><dl><dt>Sun Web Server, <a class="indexterm" href="#chap-sun-websvr">Installing the Oracle iPlanet/Sun Web Server Policy Agent</a></dt></dl></div><div class="indexdiv"><h3>T</h3><dl><dt>Troubleshooting, <a class="indexterm" href="#chap-troubleshooting">Troubleshooting</a></dt></dl></div></div></div></div><p>&nbsp;</p><div id="footer"><p>Something wrong on this page? <a href="https://bugster.forgerock.org/jira/secure/CreateIssueDetails!init.jspa?pid=10000&components=10007&issuetype=1">Log a documentation bug.</a></p></div>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-23412190-14']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</body></html>