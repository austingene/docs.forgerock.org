<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head>

      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
   <title>OpenAM Java EE Policy Agent User's Guide</title><link rel="stylesheet" type="text/css" href="coredoc.css"><link rel="stylesheet" type="text/css" href="css/coredoc.css"><link rel="stylesheet" type="text/css" href="sh/shCore.css"><link rel="stylesheet" type="text/css" href="sh/shCoreEclipse.css"><link rel="stylesheet" type="text/css" href="sh/shThemeEclipse.css"><script src="http://code.jquery.com/jquery-1.11.0.min.js" type="text/javascript"></script><script src="uses-jquery.js" type="text/javascript"></script><script src="sh/shCore.js" type="text/javascript"></script><script src="sh/shBrushAci.js" type="text/javascript"></script><script src="sh/shBrushBash.js" type="text/javascript"></script><script src="sh/shBrushCsv.js" type="text/javascript"></script><script src="sh/shBrushHttp.js" type="text/javascript"></script><script src="sh/shBrushJava.js" type="text/javascript"></script><script src="sh/shBrushJScript.js" type="text/javascript"></script><script src="sh/shBrushLDIF.js" type="text/javascript"></script><script src="sh/shBrushPlain.js" type="text/javascript"></script><script src="sh/shBrushProperties.js" type="text/javascript"></script><script src="sh/shBrushXml.js" type="text/javascript"></script><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><meta name="description" content="Guide to installing and managing OpenAM Java EE policy agents. OpenAM provides open source Authentication, Authorization, Entitlement and Federation software."><script type="text/javascript">SyntaxHighlighter.all();</script>
<link rel="shortcut icon" href="http://forgerock.org/favicon.ico">
</head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div lang="en" class="book"><div class="titlepage"><div><div><h1 class="title"><a name="jee-users-guide"></a>OpenAM Java EE Policy Agent User's Guide</h1></div><div><h2 class="subtitle">Version 3.5.0</h2></div><div><div class="authorgroup"><div class="author"><h3 class="author"><span class="firstname">Mark </span> <span class="surname">Craig</span></h3></div><div class="author"><h3 class="author"><span class="firstname">Gene </span> <span class="surname">Hirayama</span></h3></div><div class="author"><h3 class="author"><span class="firstname">Mike </span> <span class="surname">Jang</span></h3><div lang="en" class="affiliation"><span class="orgname">ForgeRock AS<br></span><div class="address"><p><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="street">33&nbsp;New&nbsp;Montgomery&nbsp;St.</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="otheraddr">Suite&nbsp;1500</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="city">San&nbsp;Francisco</span>,&nbsp;<span class="state">CA</span>&nbsp;<span class="postcode">94105</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="country">USA</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="phone">+1&nbsp;415-599-1100&nbsp;(US)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<code class="uri">www.forgerock.com</code><br>
&nbsp;&nbsp;&nbsp;</p></div></div></div></div></div><div><p class="releaseinfo">Software release date: February 25, 2015</p></div><div><p class="copyright">Copyright &copy; 2011-2015 ForgeRock AS.</p></div><div><a href="legalnotice.html">Legal Notice</a></div><div><p class="pubdate">Publication date: February 25, 2015</p></div><div><div class="abstract"><div class="abstract-title">Abstract</div><p>Guide to installing and managing OpenAM Java EE policy agents.
    OpenAM provides open source Authentication, Authorization, Entitlement and
    Federation software.</p></div></div></div><hr></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="preface"><a href="#preface">Preface</a></span></dt><dt><span class="chapter"><a href="#chap-about-jee-agents">1. About OpenAM Java EE Policy Agents</a></span></dt><dt><span class="chapter"><a href="#chap-apache-tomcat">2. Installing the Apache Tomcat Policy Agent</a></span></dt><dt><span class="chapter"><a href="#chap-jboss-7">3. Installing the JBoss 7 Application Server Policy Agent</a></span></dt><dt><span class="chapter"><a href="#chap-jetty">4. Installing the Jetty Server Policy Agent</a></span></dt><dt><span class="chapter"><a href="#chap-weblogic">5. Installing the Oracle WebLogic Policy Agent</a></span></dt><dt><span class="chapter"><a href="#chap-websphere">6. Installing the IBM WebSphere Policy Agent</a></span></dt><dt><span class="chapter"><a href="#chap-j2ee-agents">7. Configuring Java EE Policy Agents</a></span></dt><dt><span class="chapter"><a href="#chap-lb">8. Configuring Java EE Policy Agents Behind Load Balancers</a></span></dt><dt><span class="chapter"><a href="#chap-troubleshooting">9. Troubleshooting</a></span></dt><dt><span class="index"><a href="#d0e6510">Index</a></span></dt></dl></div><div lang="en" class="preface"><div class="titlepage"><div><div><h1 class="title"><a name="preface"></a>Preface</h1></div></div></div><p>This guide shows you how to install OpenAM Java EE policy agents, as well as
 how to integrate with other access management software. Read the
 <em class="citetitle">Release Notes</em> before you get started.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e155"></a>1.&nbsp;Who Should Use this Guide</h2></div></div></div><p>This guide is written for anyone installing OpenAM policy agents to
  interface with supported Java EE application containers.</p><p>This guide covers procedures that you theoretically perform only
  once per version. This guide aims to provide you with at least some idea
  of what happens behind the scenes when you perform the steps.</p><p>You do not need to be an OpenAM wizard to learn something from
  this guide, though a background in access management and maintaining
  web application software can help. You do need some background in
  managing services on your operating systems and in your application
  servers. You can nevertheless get started with this guide, and then
  learn more as you go along.</p></div><div lang="en" class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="formatting-conventions"></a>2.&nbsp;Formatting Conventions</h2></div></div></div><p>
  Most examples in the documentation are created on GNU/Linux or Mac OS X.

  Where it is helpful to make a distinction between operating environments,
  examples for UNIX, GNU/Linux, Mac OS X, and so forth are labeled (UNIX).
  Mac OS X specific examples can be labeled (Mac OS X).
  Examples for Microsoft Windows can be labeled (Windows).

  To avoid repetition, however, file system directory names are
  often given only in UNIX format as in <code class="filename">/path/to/server</code>,
  even if the text applies to <code class="filename">C:\path\to\server</code> as well.
 </p><p>
  Absolute path names usually begin with the placeholder
  <code class="filename">/path/to/</code>.

  This path might translate to <code class="filename">/opt/</code>,
  <code class="filename">C:\Program Files\</code>, or somewhere else on your system.
 </p><p>
  Command line, terminal sessions are formatted as follows.
 </p><div class="screen"><pre>$ <strong>echo $JAVA_HOME</strong>
<em>/path/to/jdk</em></pre></div><p>
  Command output is sometimes formatted for narrower, more readable output
  even though formatting parameters are not shown in the command.
  In the following example, the query string parameter
  <code class="literal">_prettyPrint=true</code> is omitted.
 </p><div class="screen"><pre>
$ <strong>curl https://bjensen:hifalutin@opendj.example.com:8443/users/newuser</strong>
<em>{
  "_rev" : "000000005b337348",
  "schemas" : [ "urn:scim:schemas:core:1.0" ],
  "contactInformation" : {
    "telephoneNumber" : "+1 408 555 1212",
    "emailAddress" : "newuser@example.com"
  },
  "_id" : "newuser",
  "name" : {
    "familyName" : "New",
    "givenName" : "User"
  },
  "userName" : "newuser@example.com",
  "displayName" : "New User",
  "meta" : {
    "created" : "2014-06-03T09:58:27Z"
  },
  "manager" : [ {
    "_id" : "kvaughan",
    "displayName" : "Kirsten Vaughan"
  } ]
}</em>
 </pre></div><p>
  Program listings are formatted as follows.
 </p><pre class="brush: java;">class Test {
    public static void main(String [] args)  {
        System.out.println("This is a program listing.");
    }
}</pre></div><div lang="en" class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="accessing-doc-online"></a>3.&nbsp;Accessing Documentation Online</h2></div></div></div><p>
  ForgeRock core documentation, such as what you are now reading, aims to be
  technically accurate and complete with respect to the software documented.
 </p><div class="itemizedlist"><p>
   Core documentation therefore follows a three-phase review process
   designed to eliminate errors.
  </p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
    Product managers and software architects review project documentation design
    with respect to the users' software lifecycle needs.
   </p></li><li class="listitem"><p>
    Subject matter experts review proposed documentation changes for
    technical accuracy and completeness
    with respect to the corresponding software.
   </p></li><li class="listitem"><p>
    Quality experts validate implemented documentation changes for
    technical validity with respect to the software,
    technical completeness with respect to the scope of the document,
    and usability for the expected audience.
   </p></li></ul></div><p>
  The review process helps to ensure that documentation published for
  a ForgeRock release is technically accurate and complete.
 </p><p>
  Fully reviewed, published core documentation is available at
  <a class="link" href="http://docs.forgerock.org/" target="_blank">http://docs.forgerock.org/</a>.

  Use this documentation when working with a ForgeRock Enterprise release.
 </p><p>
  In-progress documentation can be found at each project site under the
  <a class="link" href="http://forgerock.org" target="_blank">Developer Community</a> projects page.

  Use this documentation when trying a nightly build.
 </p><p>
  The ForgeRock <a class="link" href="https://wikis.forgerock.org/" target="_blank">Community Wikis</a> and provide additional, user-created information.

  We encourage you to
  <a class="link" href="https://sso.forgerock.com/openam/UI/Login" target="_blank">join the community</a>, so that you can update the Wikis, too.
 </p></div><div lang="en" class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="joining-the-community"></a>4.&nbsp;Joining the ForgeRock Community</h2></div></div></div><p>
  After you
  <a class="link" href="https://backstage.forgerock.com/#/account/register" target="_blank">sign up</a> to join the ForgeRock community,
  you can edit the
  <a class="link" href="https://wikis.forgerock.org/" target="_blank">Community Wikis</a>,
  and also log bugs and feature requests in the
  <a class="link" href="https://bugster.forgerock.org/" target="_blank">issue tracker</a>.
 </p><p>
  If you have a question regarding a project but cannot find an answer
  in the project documentation or Wiki, browse to the
  <a class="link" href="http://forgerock.org" target="_blank">Developer Community</a> page for the project,
  where you can find details on joining the project mailing lists,
  and find links to mailing list archives.

  You can also suggest updates to documentation through the
  <a class="link" href="https://lists.forgerock.org/mailman/listinfo/docs" target="_blank">ForgeRock docs mailing list</a>.
 </p><p>
  The Community Wikis describe how to check out and build source code.

  Should you want to contribute a patch, test, or feature,
  or want to author part of the core documentation,
  first have a look on the ForgeRock site at
  <a class="link" href="http://forgerock.org/get_involved.html" target="_blank">how to get involved</a>.
 </p></div></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-about-jee-agents"></a>Chapter&nbsp;1.&nbsp;About OpenAM Java EE Policy Agents</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="section"><a href="#example-j2ee-agent-components">1.1. Java EE Policy Agent Components</a></span></dt><dt><span class="section"><a href="#policy-agent-properties">1.2. About Policy Agent Properties</a></span></dt><dt><span class="section"><a href="#filter-modes">1.3. Java EE Agent Filter Modes of Operation</a></span></dt><dt><span class="section"><a href="#jee-agent-not-enforced-list">1.4. Not-Enforced URI and Client IP Lists</a></span></dt><dt><span class="section"><a href="#j2ee-process-flow">1.5. Java EE Process Flow</a></span></dt><dt><span class="section"><a href="#j2ee-agent-features">1.6. Java EE Policy Agent Features</a></span></dt><dt><span class="section"><a href="#j2ee-agent-configuration">1.7. How Java EE Policy Agents are Configured</a></span></dt></dl></div><a class="indexterm" name="d0e282"></a><p>
  A <em class="firstterm">Java EE policy agent</em> is an OpenAM add-on component that
  functions as a Policy Enforcement Point (PEP) for applications
  deployed on a Java EE-based servlet container or application server.
  The policy agent protects web-based applications
  and implements single sign-on (SSO) capabilities
  for the applications deployed in the container.
 </p><p>
  OpenAM Java EE policy agents provide medium touch integration
  and run on a wide variety of servlet containers and
  application servers.

  The installation process for Java EE policy agents differ slightly for each
  container type and may
  require some configuration and code changes to the configuration files.
  The installation procedures for each container type are presented later in this
  guide.
 </p><p>
  This chapter covers what Java EE policy agents do, their key features,
  and how they work.</p><div class="note"><h3 class="title"><a name="one-agent-per-container"></a>Note</h3><p>
   A single policy agent can work with multiple applications.
   You therefore install only one policy agent per application server.
  </p><p>
   Installing more than one policy agent in an application server is not supported.
  </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="example-j2ee-agent-components"></a>1.1.&nbsp;Java EE Policy Agent Components</h2></div></div></div><a class="indexterm" name="d0e305"></a><p>The OpenAM Java EE policy agent is comprised
   of five main components: the <em class="firstterm">policy agent filter</em>,
   a container-specific <em class="firstterm">Java Authentication and Authorization Server (JAAS) realm
   implementation</em>, an agent application war file,
   <em class="firstterm">agent installer</em>, and client SDK.</p><p>
   The installer integrates the other components within the
   container, after which the components run transparently,
   connecting to OpenAM through its client SDK.
  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="bold"><strong>Java EE Policy Agent Filter</strong></span>.
     The Java EE Policy Agent filter is a
     servlet filter referenced within the deployment descriptor file,
     <code class="filename">web.xml</code> of each protected application in the
     container. Applications that do not have their deployment descriptor file
     updated to use the agent servlet filter will not be protected.
     The filter's main function is to intercept an inbound client access request
     for a protected resource and run through a set of task handlers, including
     determining if the user has a session ID or token.
     If the user does not have a session token in the browser cookie,
     <code class="literal">iPlanetDirectoryPro</code>,
     then the policy agent immediately
     redirects the user to OpenAM for authentication.
     Once the user has a session token, the agent retrieves the agent profile from
     OpenAM and continues to process the request based on the property settings
     defined in the agent profile.
    </p></li><li class="listitem"><p><span class="bold"><strong>Agent Realm</strong></span>. The Agent
     <span class="emphasis"><em>realm</em></span> is not strictly a "component," but is a container-specific
     integration to allow support for Java Authentication and Authorization Service
     (JAAS).
     The Agent Realm, or more accurately the <span class="emphasis"><em>JAAS Realm</em></span>,
     leverages the underlying
     Java EE container's ability to retrieve the user's identity and populate the
     principal in the <code class="literal">HTTPServletRequest</code> object.

     The realm also allows you to take advantage of the Java EE container's declarative and programmatic
     security settings that define role-based access control over the web resources.
     You can define the roles in the descriptor files and then define
     the user's roles within OpenAM, allowing the application to check authorization.
     JAAS support provides another powerful feature in that you can implement
     Java EE permissions-related annotations, such as @RolesAllowed and @DeclareRoles,
     which are specifically designed to secure Enterprise Java Bean (EJB) modules
     for authenticated users.
    </p></li><li class="listitem"><p><span class="bold"><strong>Agent Application</strong></span>.
     The Agent application, deployed as <code class="literal">agentapp.war</code>,
     processes notifications from OpenAM, refreshes the caches, and runs
     processes for cross-domain single sign-on (CDSSO). The <code class="literal">agentapp.war</code>
     file also displays error messages if the cross site scripting (XSS) detector is enabled.

     Note that there are some subtle container-dependent configuration differences
     that may affect the installation of <code class="literal">agentapp.war</code>.
     For certain containers, the installer installs the <code class="literal">agentapp.war</code>
     file; for others, you must manually install the file as part of the
     agent installation.
    </p><div class="note"><h3 class="title">Note</h3><p>Technically,
     the <code class="literal">agentapp.war</code> is not a required component if you have no
     plans to use CDSSO and notifications, but
     it is strongly recommended that you deploy this <code class="literal">agentapp.war</code>
     as notifications from OpenAM are extremely useful.
    </p></div></li><li class="listitem"><p><span class="bold"><strong>Agent Installer</strong></span>.
     The agent installer, invoked by the <span class="command"><strong>agentadmin</strong></span> tool,
     automates the policy agent installation within a container.
     The agent installer's configuration is set in an XML descriptor file,
     (<code class="filename">config/configure.xml</code>), defining the user interactions
     when the install, custom-install, migrate, and uninstall subcommands are
     run, and the tasks needed to complete installation process, such as
     creating the agent directory layout, creating backups for the container's
     configuration files, and encrypting the agent profile's password and saving it
     in the agent bootstrap configuration file plus other tasks.
    </p></li><li class="listitem"><p><span class="bold"><strong>openssoclientsdk.jar</strong></span>.
     Although not technically
     a part of the Java EE policy agent, the Java EE agent
     bundles the OpenAM Client SDK for the
     container. The SDK provides the set of APIs that are designed
     to work with OpenAM's service and security infrastructure.
    </p></li></ul></div><div class="figure"><a name="figure-j2ee-policy-agent"></a><div class="figure-title">Figure&nbsp;1.1.&nbsp;Java EE Policy Agent</div><div class="figure-contents"><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/j2ee-policy-agent.png" align="middle" height="360" alt="Java EE Policy Agent"></td></tr></table><div class="longdesc-link" align="right"><br clear="all"><span class="longdesc-link">[<a href="ld-d0e395.html" target="longdesc">D</a>]</span></div></div></div></div><br class="figure-break"></div><div lang="en" class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="policy-agent-properties"></a>1.2.&nbsp;About Policy Agent Properties</h2></div></div></div><a class="indexterm" name="d0e407"></a><p>All policy agent configuration settings are stored centrally by default
  in the OpenAM configuration store, which allows you
  to configure your policy agents on the OpenAM console for easier management and
  convenience.
  Any property change made
  in OpenAM using the console or the <span class="command"><strong>ssoadm</strong></span> command-line tool is
  immediately communicated to the agent via a notification.
  Many policy agent properties are hot-swap enabled, allowing the change
  to take effect immediately without a server restart.
 </p><p>Policy agent configuration settings can also be stored locally in a
  Java properties flat-file, such as
  <code class="filename">Agent_001/config/OpenSSOAgentConfiguration.properties</code>,
  which is created when you install the agent.
  If you implement a local properties file, you must make all
  configuration changes by modifying property values in the file.
 </p><p>While the majority of agent properties are hot swap-enabled, there are
  a number that are not. These non-hot swappable properties are indicated in the
  OpenAM console or local properties file as such. Any changes to these non-hot swappable
  properties require a container restart. To avoid any configuration errors that
  could take effect immediately, you can lock the properties by setting the
  <code class="literal">com.sun.identity.agents.config.lock.enable</code> to <code class="literal">true</code>
  in the OpenAM bootstrap file, <code class="filename">OpenSSOAgentBootstrap.properties</code>,
  and then re-start the container.
 </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="filter-modes"></a>1.3.&nbsp;Java EE Agent Filter Modes of Operation</h2></div></div></div><a class="indexterm" name="d0e434"></a><a class="indexterm" name="d0e439"></a><p>The agent filter intercepts all inbound client requests
    to access a protected resource and processes the request based on
    a global configuration property,
    <code class="literal">com.sun.identity.agents.config.filter.mode</code>, set in
    the policy agent profile on OpenAM.
    The configuration setting determines the
    filter mode of operation that should be carried out on the intercepted
    inbound request.
   </p><p>The filter mode property can be set to one of the following values:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="bold"><strong>NONE</strong></span>.
      Specifies that nothing should be done with the inbound request.
      This mode is primarily used in development or testing environments and
      should never be used in production.

      If logging is enabled, the agent filter
      logs all intercepted requests for auditing purposes.</p></li><li class="listitem"><p><span class="bold"><strong>SSO_ONLY</strong></span>.
      Specifies that authentication should be enforced to all users who try
      to access protected web resources. The filter invokes the OpenAM
      Authentication service to verify the identity of the user.
      If the user's identity is verified, the user is issued a session token
      through OpenAM's Session service.
     </p></li><li class="listitem"><p><span class="bold"><strong>J2EE_POLICY</strong></span>.
      Specifies that authorization should be enforced through the
      container's Java EE security
      policies, which may be configured declaratively by means of the
      XML deployment descriptor files using <code class="literal">auth-constraint</code>,
      <code class="literal">security-constraint</code> and other <code class="literal">web.xml</code>
      elements, or programmatically through methods calls to the Security APIs.
      The user identity is determined exactly in the same way as SSO_ONLY, but
      is additionally authenticated into the specific container realm, where
      authorization will be run from the container.

      When the filter mode is <code class="literal">J2EE_POLICY</code>,
      no OpenAM-based URL policies will be enforced.
      </p></li><li class="listitem"><p><span class="bold"><strong>URL_POLICY</strong></span>.
      Specifies that authorization should be enforced only
      by OpenAM's URL resource-based policies.
      When the filter mode is <code class="literal">URL_POLICY</code>,
      no Java EE policies will be enforced.

      The <code class="literal">URL_POLICY</code> mode is commonly used
      in production deployments.
     </p></li><li class="listitem"><p><span class="bold"><strong>ALL</strong></span>.
      Specifies that SSO_ONLY, J2EE_POLICY, and URL_POLICY should be
      enforced. This setting ensures that the user gets properly authenticated
      with a valid session token ID and then authorized through the Java EE container's
      declarative or programmatic security settings and OpenAM's URL-based
      policies to access the web resource.
     </p></li></ul></div><p>For more information, see
    <a href="../jee-users-guide/index.html#j2ee-agent-general-properties" class="link"><em class="citetitle">Configuring J2EE Policy Agent Global Properties</em></a>.
   </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="jee-agent-not-enforced-list"></a>1.4.&nbsp;Not-Enforced URI and Client IP Lists</h2></div></div></div><a class="indexterm" name="d0e502"></a><a class="indexterm" name="d0e507"></a><a class="indexterm" name="d0e510"></a><a class="indexterm" name="d0e515"></a><p>The Java EE policy agent supports properties to bypass authentication
    and grant immediate access to resources not requiring protection, such
    as images, stylesheets, or static HTML pages.</p><p>
    You can configure a Not-Enforced URI List using the
    <code class="literal">com.sun.identity.agents.config.notenforced.uri</code> property
    that grants the user access to resources whose URIs match those in the list.
   </p><p>
    For example, you can set URI patterns with wildcards in the OpenAM console
    using the following patterns:</p><div class="screen"><pre>
     /logout.html
     /images/*
     /css/-*-
     /*.jsp?locale=*
    </pre></div><p>For more information on wildcard usage, see
    <a class="link" href="http://openam.forgerock.org/doc/admin-guide/#wildcard-syntax" target="_blank">Wildcard Usage</a>.</p><p>The Java EE policy agent also supports a Not-Enforced Client IP List, which
      specifies the client IP addresses that can be excluded from authentication
      and authorization. This property is useful to allow administrators access
      to the web site from a certain IP address or allow a search engine access
      to the web resources.
    </p><p>For more information on the Not-Enforced URI and Not-Enforced Client IP
    Lists and other related properties, see
    <a href="../jee-users-guide/index.html#j2ee-agent-not-enforced-uri-properties" class="link"><em class="citetitle">Not Enforced URI Processing Properties</em></a>.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="j2ee-process-flow"></a>1.5.&nbsp;Java EE Process Flow</h2></div></div></div><a class="indexterm" name="d0e545"></a><p>To illustrate how Java EE policy agents work, it is first instructive to understand
   a simplified and generic web application example with OpenAM. While the specific
   configuration settings differ depending on the container or application server,
   the architectural components that make up the OpenAM Java EE policy agent are the
   same.</p><p>
   Imagine a web application, such as an e-commerce site,
   deployed in multiple containers: a client application server (not fully displayed),
   a web container and an Enterprise Java Bean
   (EJB) container for the business logic.
   After the user is granted access to a resource through the Java EE policy agent
   and OpenAM,
   the servlet instance processes the request and
   determines which business logic objects or Java bean classes to invoke
   from the Enterprise Java Beans (EJB) container.
   The EJB container may have dedicated EJB components that provide specific transactions,
   such as sales order creation or processing.
   The EJB processes the transactions and retrieves any data from the database.
   The servlet constructs a response and then forwards a JavaServer Page (JSP)
   or JavaServer Face page to the client.
  </p><div class="figure"><a name="figure-j2ee-components"></a><div class="figure-title">Figure&nbsp;1.2.&nbsp;Java EE Policy Agent</div><div class="figure-contents"><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/j2ee-components.png" align="middle" height="360" alt="Java EE Policy Agent"></td></tr></table><div class="longdesc-link" align="right"><br clear="all"><span class="longdesc-link">[<a href="ld-d0e557.html" target="longdesc">D</a>]</span></div></div></div></div><br class="figure-break"><div class="important"><h3 class="title">Important</h3><p>Do not install the Java EE policy agent in the same container as OpenAM.

    OpenAM must be up and running before the Java EE policy agent starts.
    This cannot be guaranteed when both run in the same container.

    ForgeRock does not support configurations where
    OpenAM and the Java EE policy agent are installed in the same container.
   </p></div><p>The following sequence diagram shows how the pieces fit together when a Java
   EE client accesses a resource protected by a policy agent. This diagram is
   simplified to show only the Java EE policy agent steps rather than to describe
   every possible case.</p><div class="figure"><a name="figure-jee-agent-process-flow"></a><div class="figure-title">Figure&nbsp;1.3.&nbsp;Java EE Policy Agent Process Flow</div><div class="figure-contents"><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/jee-agent-process-flow.png" align="middle" height="360" alt="Java EE Policy Agent Process Flow"></td></tr></table><div class="longdesc-link" align="right"><br clear="all"><span class="longdesc-link">[<a href="ld-d0e573.html" target="longdesc">D</a>]</span></div></div></div></div><br class="figure-break"><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>The web client or user attempts to access a protected resource
     at <code class="literal">www.example.com</code> by pointing her browser to a page
     in a protected application. The agent filter intercepts the inbound
     request to the server.
    </p></li><li class="listitem"><p>The agent filter authenticates the agent account and retrieves the
     agent profile from OpenAM.
    </p></li><li class="listitem"><p>The agent profile is returned. For this example, we assume that the
     filter mode is set to <code class="literal">ALL</code>.</p></li><li class="listitem"><p>The agent filter checks if the requested resource is on the Not-Enforced
     URI list. If yes, skip to step 18.
    </p></li><li class="listitem"><p>The agent filter checks if the session cookie, <code class="literal">iPlanetDirectoryPro</code>,
     is present. If yes, skip to step 11.
    </p></li><li class="listitem"><p>The filter redirects the client browser to the OpenAM Authentication
     Service, which displays a login page.</p></li><li class="listitem"><p>The client must input her credentials.</p></li><li class="listitem"><p>Once the client has been authenticated, create a session ID.
     Re-direct back to the web server with a newly issued session ID,
     contained in the <code class="literal">iPlanetDirectoryPro</code> browser cookie.</p></li><li class="listitem"><p>The request is once again intercepted by the servlet filter.
    </p></li><li class="listitem"><p>The agent filter checks for the session cookie, which is found.</p></li><li class="listitem"><p>The session cookie gets validated by OpenAM's Session Service. If not valid,
     go back to step 5.</p></li><li class="listitem"><p>OpenAM validates the session cookie.</p></li><li class="listitem"><p>The agent filter authenticates into the container's security realm
     and has the correct roles assigned, the container determines if the
     user's role has authorization to access the resource.
    </p></li><li class="listitem"><p>Internal authentication is successful.</p></li><li class="listitem"><p>The agent filter checks the URL_BASED policy in OpenAM.
    </p></li><li class="listitem"><p>OpenAM's Policy Service
     is called to return an authorization decision to allow the client or user
     access to the protected resource. The Policy Service returns an
     <code class="literal">ALLOW</code>.
    </p></li><li class="listitem"><p>The agent filter writes the policy decision to an audit log.</p></li><li class="listitem"><p>Pass through to the web resource.
    </p></li><li class="listitem"><p>The web resource performs the Java EE security checks.</p></li><li class="listitem"><p>Response returns the resource from <code class="literal">www.example.com</code></p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="j2ee-agent-features"></a>1.6.&nbsp;Java EE Policy Agent Features</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#jee-agent-attribute-fetching">1.6.1. Attribute Fetch Modes</a></span></dt><dt><span class="section"><a href="#agent-login-attempt-limits">1.6.2. Login Attempt Limits</a></span></dt><dt><span class="section"><a href="#fqdn-checking">1.6.3. FQDN Checking</a></span></dt><dt><span class="section"><a href="#cookie-reset">1.6.4. Cookie Reset Properties</a></span></dt><dt><span class="section"><a href="#agent-cdsso">1.6.5. Cross Domain Single Sign-On</a></span></dt></dl></div><a class="indexterm" name="d0e663"></a><p>The Java EE policy agent provides a number of additional features
   useful for your deployment.
  </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="jee-agent-attribute-fetching"></a>1.6.1.&nbsp;Attribute Fetch Modes</h3></div></div></div><p>Java EE policy agents provides the capability
    to fetch and inject user information into HTTP headers, request objects, and
    cookies and pass them on to the protected client applications.
    The client applications can then personalize content using these attributes
    in their web pages or responses.
   </p><p>Specifically, you can configure the type of
    attributes to be fetched and the associated mappings for the attributes
    names used on OpenAM to those values used in the containers. The Java EE
    policy agent securely fetches the user and session data from the
    authenticated user as well as policy response attributes.
   </p><p>For more details, see
    <a href="../jee-users-guide/index.html#chap-j2ee-agents" class="link">
     <em class="citetitle">Configuring Java EE Policy Agents</em></a>.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="agent-login-attempt-limits"></a>1.6.2.&nbsp;Login Attempt Limits</h3></div></div></div><a class="indexterm" name="d0e688"></a><a class="indexterm" name="d0e693"></a><p>When the user-agent does not present a valid SSO token, the agent
    will redirect the user to the login URL configured in OpenAM.

    The Java EE policy agent can be configured to limit the login attempts
    made to the policy agent to mitigate against any redirect loops that may result
    in an error page presented to the end-user.</p><p>
    You can use the <code class="literal">com.sun.identity.agents.config.login.attempt.limit</code>
    property to specify a non-zero value for the number of login attempts.
    For example, if the property is set to 3, then the agent will block the access
    request to the protected resource on the fourth login request.
   </p><p>
    You can also limit the number of redirections the agent can take for a single
    browser session by setting the
    <code class="literal">com.sun.identity.agents.config.redirect.attempt.limit</code>.
   </p><p>For more details, see
    <a href="../jee-users-guide/index.html#j2ee-agent-general-properties" class="link">
     <em class="citetitle">General Properties</em></a>.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="fqdn-checking"></a>1.6.3.&nbsp;FQDN Checking</h3></div></div></div><a class="indexterm" name="d0e718"></a><a class="indexterm" name="d0e723"></a><p>The Java EE policy agent requires that clients accessing
    protected resources use valid URLs with fully qualified domain names (FQDNs).
    If invalid URLs are referenced, policy evaluation can
    fail as the fully qualified domain name (FQDN) will not match the requested
    URL, leading to blocked access to the resource.
    Misconfigured URLs can also result in incorrect policy evaluation for
    subsequent access requests.
   </p><p>There are cases where clients may specify resource URLs that differ from
    the FQDNs stored in OpenAM policies, for example, in load
    balanced and virtual host environments. To handle these cases,
    the Java EE policy agent supports FQDN Checking properties:
    <code class="literal">FQDN Default</code>
    and <code class="literal">FQDN Virtual Host Map</code> properties.
   </p><p>The <code class="literal">FQDN Default</code> property specifies the default URL
    with valid hostname.
    The property ensures that the policy agent can redirect to
    a URL with a valid hostname should it discover an invalid URL in the client request.</p><p>The <code class="literal">FQDN Virtual Host Map</code> property stores map keys
    and their corresponding values, allowing invalid URLs, load balanced URLs,
    and virtual host URLs to be correctly mapped to valid URLs.
    Each entry in the Map has precedence over the <code class="literal">FQDN Default</code>
    setting, so that if no valid URLs exist in the <code class="literal">FQDN Virtual Host Map</code>
    property, the agent redirects to
    the value specified in the <code class="literal">FQDN Default</code> property.
   </p><p>If you want the agent to redirect to a URL other than the one specified
    in the <code class="literal">FQDN Default</code> property, then it is good practice to
    include any anticipated invalid URLs in the <code class="literal">FQDN Virtual Host Map</code> property
    and map it to a valid URL.
   </p><p>For more details, see
    <a href="../jee-users-guide/index.html#j2ee-agent-fqdn-properties" class="link">
     <em class="citetitle">Fully Qualified Domain Name Checking Properties</em></a>.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="cookie-reset"></a>1.6.4.&nbsp;Cookie Reset Properties</h3></div></div></div><a class="indexterm" name="d0e773"></a><a class="indexterm" name="d0e778"></a><p>OpenAM provides cookie reset properties that the agent carries out
    prior to redirecting the client to a login page for authentication.
   </p><p>Cookie reset is typically used when multiple parallel authentication
    mechanisms are in play with the policy agent and another authentication system.
    The policy agent can reset the cookies set by the other mechanism before
    redirecting the client to a login page.
   </p><p>The cookie reset properties include a name list specifying all of the
    cookies that will reset, a domain map specifying the domains set for each cookie,
    and a path map specifying the path from which the cookie will be reset.
   </p><p>If you have enabled attribute fetching using cookies to retrieve user
    data, it is good practice to use cookie reset, which will reset once you want
    to access an enforced URL without a valid session.
   </p><p>For more details, see
    <a href="../jee-users-guide/index.html#j2ee-agent-cookie-reset-properties" class="link">
     <em class="citetitle">Cookie Reset Properties</em></a>.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="agent-cdsso"></a>1.6.5.&nbsp;Cross Domain Single Sign-On</h3></div></div></div><a class="indexterm" name="d0e800"></a><a class="indexterm" name="d0e805"></a><p>Cross domain single sign-on (CDSSO) allows the Java EE policy agent
    to transfer a validated session ID between an OpenAM domain and an application
    domain using a proprietary OpenAM mechanism.
    Normally, single sign-on cannot be implemented across domains as the session
    cookie from one domain (for example, website.com) is not accessible from
    another domain (for example, website.net).
   </p><p>
    OpenAM's CDSSO solves this cross-domain problem and is best implemented in environments
    where all the domains are managed ultimately by the same organization.
   </p><p>
    The Java EE policy agent works with an OpenAM component called
    a <code class="literal">CDCServlet</code> that generates a
    self-submitting form containing
    the valid session token from one domain.
    The form gets auto-submitted to the policy agent endpoint via a POST
    operation.
    The policy agent processes the request and extracts the session ID, which is
    again validated by OpenAM. If validation is successful,
    the policy agent sets the cookie in alternate domain. The
    client can then access a resource in that domain.
   </p><p>For more details, see
    <a class="link" href="http://openam.forgerock.org/doc/admin-guide/#chap-cdsso" target="_blank">
     <em class="citetitle">Configuring Cross Domain Single Sign-On</em></a>.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="j2ee-agent-configuration"></a>1.7.&nbsp;How Java EE Policy Agents are Configured</h2></div></div></div><a class="indexterm" name="d0e827"></a><p>You install Java EE policy agents in the web application containers
   serving web applications that you want to protect. Java EE policy agents are
   themselves web applications running in the container whose applications you
   configure OpenAM to protect. By default, the Java EE policy agent has only
   enough configuration at installation time to connect to OpenAM in order to
   get the rest of its configuration from the OpenAM configuration store. With
   nearly all configuration stored centrally, you can manage policy agents
   centrally from the OpenAM console.<a href="#ftn.d0e834" class="footnote" name="d0e834"><sup class="footnote">[1]</sup></a></p><p>
   For each web application that you protect,
   you also configure at least the deployment descriptor
   to filter requests through the policy agent.
   ForgeRock delivers the Java EE policy agents with a sample application .war file
   under
   <code class="filename">j2ee_agents/<em class="replaceable"><code>container</code></em>_agent/sampleapp/</code>
   demonstrating the configuration to use to protect your web application.
   In the <code class="filename">WEB-INF/web.xml</code> deployment descriptor file
   for the sample application,
   you find an example of the filter configuration
   that you must add to the deployment descriptors of your applications.
  </p><p>You configure Java EE policy agents per OpenAM realm. Thus to access
   centralized configuration, you select Access Control &gt; <em class="replaceable"><code>Realm
    Name</code></em> &gt; Agents &gt; Java EE &gt; <em class="replaceable"><code>Agent
    Name</code></em>. Java EE policy agent configuration is distinct from
   policy configuration. The only policy-like configuration that you apply to
   Java EE policy agents is indicating which URLs in the web server can be
   ignored (<em class="firstterm">not enforced URLs</em>) and which client IP
   address are exempt from policy enforcement (<em class="firstterm">not enforced
    IPs</em>).</p><p>For each aspect of Java EE policy agent configuration, you can configure
   the policy agent through the OpenAM console during testing, and then
   export the resulting configuration in order to script configuration in
   your production environment.</p></div><div class="footnotes"><br><hr class="footnote-hr"><div id="ftn.d0e834" class="footnote"><p><a href="#d0e834" class="para"><sup class="para">[1] </sup></a>You can opt to store the
    agent configuration locally if necessary.</p></div></div></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-apache-tomcat"></a>Chapter&nbsp;2.&nbsp;Installing the Apache Tomcat Policy Agent</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="section"><a href="#before-tomcat-agent-install">2.1. Before You Install</a></span></dt><dt><span class="section"><a href="#install-tomcat-agent">2.2. Installing the Tomcat Policy Agent</a></span></dt><dt><span class="section"><a href="#silent-tomcat-agent-installation">2.3. Silent Tomcat Policy Agent Installation</a></span></dt><dt><span class="section"><a href="#uninstall-tomcat-agent">2.4. Remove Tomcat Policy Agent Software</a></span></dt></dl></div><a class="indexterm" name="d0e868"></a><p>
  This chapter covers installation of the policy agent for Apache Tomcat.
 </p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="before-tomcat-agent-install"></a>2.1.&nbsp;Before You Install</h2></div></div></div><a class="indexterm" name="d0e876"></a><a class="indexterm" name="d0e881"></a><p>Make sure OpenAM is installed and running, and that you can contact OpenAM
  from the system running the policy agent. Next, create a profile for your
  policy agent as described in the <em class="citetitle">Administration Guide</em>
  section on <a class="link" href="http://openam.forgerock.org/doc/admin-guide/#create-agent-profiles" target="_blank"><em class="citetitle">Creating Agent
  Profiles</em></a>. To protect resources with the agent also create
  at least one policy as described in the section on <a class="link" href="http://openam.forgerock.org/doc/admin-guide/#configure-authz-policy" target="_blank"><em class="citetitle">Configuring
  Policies</em></a>. Consider creating a simple policy, such as a
  policy that allows only authenticated users to access your resources, in order
  to test your policy agent after installation.</p><p>You must install Apache Tomcat before you install the policy
  agent, and you must stop the server during installation.</p><p>All of the Tomcat scripts must be present in
   <code class="filename">$CATALINA_HOME/bin</code>. The Tomcat Windows executable
   installer does not include the scripts, for example. If the scripts
   are not present in your installation, copy the contents of the
   <code class="filename">bin</code> directory from a .zip download of Tomcat of
   the same version as the one you installed.
  </p><p lang="en">
 You must install a supported version of the Java runtime environment.
 See the <em class="citetitle">Release Notes</em> section,
 <a href="../jee-release-notes/index.html#java-requirements-javaee-agents" class="link"><em class="citetitle">Java EE Agents Java Requirements</em></a>,
 and set the <code class="literal">JAVA_HOME</code> environment variable accordingly.
 The policy agent installer requires Java.
</p><div class="screen"><pre>
$ <strong>echo $JAVA_HOME</strong>
<em>/path/to/java</em>
      </pre></div><p lang="en">
 See the OpenAM <em class="citetitle">Installation Guide</em> section,
 <a class="link" href="http://openam.forgerock.org/doc/install-guide/#download-openam-software" target="_blank"><em class="citetitle">Obtaining OpenAM Software</em></a>
 to determine which version of the agent to download, and download the agent.
 Also verify the checksum of the file you download
 against the checksum posted on the download page.
</p><p>
   Unzip the file in the directory where you plan to install the J2EE
   policy agent. The agent you install stores its configuration and logs
   under this directory.
  </p><p>When you unzip the policy agent, you find the following directories
   under the <code class="filename">j2ee_agents/tomcat_v6_agent</code> directory.
  </p><p lang="en">
 Despite the directory name,
 the policy agent supports multiple container versions.
 For details, see the <em class="citetitle">Release Notes</em> section,
 <a href="../jee-release-notes/index.html#jee-pa-platform-requirements" class="link"><em class="citetitle">Java EE Agents Platform Requirements</em></a>.
</p><div lang="en" class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="filename">bin</code></span></dt><dd><p>The installation and configuration program
    <span class="command"><strong>agentadmin</strong></span> and a password hashing tool
    <span class="command"><strong>crypt_util</strong></span>.</p></dd><dt><span class="term"><code class="filename">config</code></span></dt><dd><p>Configuration templates used by the <span class="command"><strong>agentadmin</strong></span>
   command during installation</p></dd><dt><span class="term"><code class="filename">data</code></span></dt><dd><p>Not used</p></dd><dt><span class="term"><code class="filename">etc</code></span></dt><dd><p>Configuration templates used during installation</p></dd><dt><span class="term"><code class="filename">installer-logs</code></span></dt><dd><p>Location for log files written during installation</p></dd><dt><span class="term"><code class="filename">legal-notices</code></span></dt><dd><p>Contains licensing information including third-party licenses</p></dd><dt><span class="term"><code class="filename">lib</code></span></dt><dd><p>Shared libraries used by the Java EE policy agent</p></dd><dt><span class="term"><code class="filename">locale</code></span></dt><dd><p>Property files used by the installation program</p></dd><dt><span class="term"><code class="filename">README</code></span></dt><dd><p>README file containing platform and install information for the agent</p></dd></dl></div><p>
   The web application deployment descriptor file, <code class="filename">web.xml</code>,
   is the basic configuration file for web applications.
   As such, the specific content of the <code class="filename">web.xml</code> file
   depends on the application.
   Apache Tomcat also provides a global
   <code class="filename">/path/to/tomcat/conf/web.xml</code> deployment descriptor,
   which sets defaults for all deployed applications.
   When you install the Apache Tomcat policy agent,
   you should be concerned with <code class="filename">/path/to/tomcat/conf/web.xml</code>,
   and also with the <code class="filename">WEB-INF/web.xml</code> files
   in each protected application.
  </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="install-tomcat-agent"></a>2.2.&nbsp;Installing the Tomcat Policy Agent</h2></div></div></div><p>This chapter covers installation of the policy agent for Tomcat.</p><div lang="en" class="procedure"><a name="d0e1055"></a><div class="procedure-title">Procedure&nbsp;2.1.&nbsp;To Create the Agent Profile</div><p>Regardless of whether you store configurations centrally in OpenAM
        or locally with your agents, the agent requires a profile so that it can
        connect to and communicate with OpenAM.</p><ol class="procedure" type="1"><li class="step"><p>In the OpenAM console, browse to Access Control &gt;
            <em class="replaceable"><code>Realm Name</code></em> &gt; Agents &gt; J2EE,
            and then click the New... button in the Agent table.</p></li><li class="step"><p>Complete the web form using the following hints.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Name</span></dt><dd><p>The name for the agent profile used when you install the
                        agent</p></dd><dt><span class="term">Password</span></dt><dd><p>Password the agent uses to authenticate to OpenAM</p></dd><dt><span class="term">Configuration</span></dt><dd><p>Centralized configurations are stored in the OpenAM configuration
                        store. You can manage the centralized configuration through the OpenAM
                        console. Local configurations are stored in a file alongside the
                        agent.</p></dd><dt><span class="term">Server URL</span></dt><dd><p>The full URL to an OpenAM instance, or if OpenAM is deployed in
                        a site configuration (behind a load balancer) then the site URL</p><p>In centralized configuration mode, the Server URL is used to
                        populate the agent profile for services such as Login, Logout, Naming,
                        and Cross Domain SSO.</p></dd><dt><span class="term">Agent URL</span></dt><dd><p>The URL to the J2EE agent application, such as
                        <code class="literal">http://www.example.com:8080/agentapp</code></p><p>In centralized configuration mode, the Agent URL is used to
                        populate the Agent Profile for services such as notifications.</p></dd></dl></div></li></ol></div><div lang="en" class="procedure"><a name="d0e1107"></a><div class="procedure-title">Procedure&nbsp;2.2.&nbsp;To Create the Password File</div><a class="indexterm" name="d0e1110"></a><ol class="procedure" type="1"><li class="step"><p>
   Create a text file containing only the password.
  </p><div class="screen"><pre>
$ <strong>echo password &gt; /tmp/pwd.txt</strong>
  </pre></div></li><li class="step"><p>
   Protect the password file you create as appropriate for your operating system.
  </p><div class="screen"><pre>
$ <strong>chmod 400 /tmp/pwd.txt</strong>
 </pre></div></li></ol></div><div class="procedure"><a name="install-agent-into-tomcat6"></a><div class="procedure-title">Procedure&nbsp;2.3.&nbsp;To Install the Policy Agent into Tomcat 6</div><a class="indexterm" name="d0e1134"></a><p>
    The steps required for policy agent installation into Tomcat 6 are subtly
    different from those required for Tomcat 7. For Tomcat 6, you have the option
    to include a global <code class="filename">web.xml</code> file during the installation
    process if you plan to project every application within the container.
   </p><ol class="procedure" type="1"><li class="step"><p>Shut down the Tomcat server where you plan to install the agent.</p><div class="screen"><pre>
$ <strong>/path/to/tomcat/bin/shutdown.sh</strong>
    </pre></div></li><li class="step"><p>Make sure OpenAM is running.</p></li><li class="step"><p>Run <span class="command"><strong>agentadmin --install</strong></span> to install the agent.</p><div class="screen"><pre>
$ <strong>/path/to/j2ee_agents/tomcat_v6_agent/bin/agentadmin --install --acceptLicense</strong>
    </pre></div><ol type="a" class="substeps"><li class="step"><p lang="en">When you run the command, you will be prompted to read and accept the
  software license agreement for the agent installation.
  You can suppress the license agreement prompt by including the
  <code class="option">--acceptLicense</code> option on the command line.
  The inclusion of the option indicates that you have read and accepted
  the terms stated in the license.
  To view the license agreement, open <code class="filename">&lt;server-root&gt;/legal-notices/license.txt</code>.
 </p></li><li class="step"><p>
      Enter the path to the Tomcat configuration folder. For example,
      <code class="literal">/path/to/apache-tomcat/conf</code>.
     </p></li><li class="step"><p>
      Enter the OpenAM URL. For example, <code class="literal">http://openam.example.com:8080/openam</code>.
      The installer attempts to connect with the OpenAM server. If OpenAM is
      not running, you can continue with the installation.
     </p></li><li class="step"><p>
      Enter the <code class="literal">$CATALINA_HOME</code> environment variable specifying
      the path to the root of the Tomcat server.
      For example, <code class="literal">/path/to/apache-tomcat/</code>.
     </p></li><li class="step"><p>
      For Tomcat 6 Installs Only: you will be prompted if you want
      the installer to deploy the agent filter in the global web.xml.
      Press Enter to accept the default: <code class="literal">true</code> if you want
      to protect all applications in the container. If you want to protect
      only a few applications, enter <code class="literal">false</code>.
      For this example, accept the default.
     </p><div class="screen"><pre>
Choose yes to deploy the policy agent in the global web.xml file.
[ ? : Help, &lt; : Back, ! : Exit ]
Install agent filter in global web.xml ? [true]:
      </pre></div></li><li class="step"><p>
       Enter the agent URL. For example, <code class="literal">http://openam.example.com:8080/agentapp</code>.
      </p></li><li class="step"><p>
       Enter the agent profile name that you created in OpenAM. For example,
       <code class="literal">Tomcat Agent</code>.
      </p></li><li class="step"><p>Enter the path to the password file. For example,
       <code class="literal">/tmp/pwd.txt</code>.
      </p></li></ol></li><li class="step"><p>Next, review a summary of your responses and select an action
     to continue, go back a step, start over, or exit from the install.
    </p><div class="screen"><pre><em>
-----------------------------------------------
SUMMARY OF YOUR RESPONSES
-----------------------------------------------
Tomcat Server Config Directory : /path/to/tomcat/conf
OpenAM server URL : http://openam.example.com:8080/openam
$CATALINA_HOME environment variable : /path/to/tomcat

Tomcat global web.xml filter install : true
Agent URL : http://www.example.com:8080/agentapp
Agent Profile name : Tomcat Agent
Agent Profile Password file name : /tmp/pwd.txt

Verify your settings above and decide from the choices below.
1. Continue with Installation
2. Back to the last interaction
3. Start Over
4. Exit
Please make your selection [1]:
...

SUMMARY OF AGENT INSTALLATION
-----------------------------
Agent instance name: Agent_001
Agent Bootstrap file location:
/path/to/j2ee_agents/tomcat_v6_agent/Agent_001/config/
OpenSSOAgentBootstrap.properties
Agent Configuration file location
/path/to/j2ee_agents/tomcat_v6_agent/Agent_001/config/
OpenSSOAgentConfiguration.properties
Agent Audit directory location:
/path/to/j2ee_agents/tomcat_v6_agent/Agent_001/logs/audit
Agent Debug directory location:
/path/to/j2ee_agents/tomcat_v6_agent/Agent_001/logs/debug

Install log file location:
/path/to/j2ee_agents/tomcat_v6_agent/installer-logs/audit/install.log

Thank you for using OpenAM Policy Agent</em>
    </pre></div><p>
     Upon successful completion, the installer has added the agent
     configuration to the Tomcat configuration, and also set up the configuration
     and log directories for the agent.
    </p><div class="note"><h3 class="title">Note</h3><p>
      If the agent is in a different domain than the server, refer to
      the <em class="citetitle">Administration Guide</em> procedure,
      <a class="link" href="http://openam.forgerock.org/doc/admin-guide/#chap-cdsso" target="_blank">
       <em class="citetitle">Configuring Cross-Domain Single Sign On</em></a>.
     </p></div></li><li class="step"><p>
     Take note of the configuration files and log locations.
    </p><p>
     Each agent instance that you install on the system has its own
     numbered configuration and logs directory. The first agent's configuration
     and logs are thus located under the directory
     <code class="filename">j2ee_agents/tomcat_v6_agent/Agent_001/</code>.
    </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="filename">config/OpenSSOAgentBootstrap.properties</code></span></dt><dd><p>Used to bootstrap the Java EE policy agent, allowing the agent to
        connect to OpenAM and download its configuration</p></dd><dt><span class="term"><code class="filename">config/OpenSSOAgentConfiguration.properties</code></span></dt><dd><p>Only used if you configured the Java EE policy agent to use local
        configuration</p></dd><dt><span class="term"><code class="filename">logs/audit/</code></span></dt><dd><p>Operational audit log directory, only used if remote logging
        to OpenAM is disabled</p></dd><dt><span class="term"><code class="filename">logs/debug/</code></span></dt><dd><p>Debug directory where the <code class="filename">debug.out</code> debug
        file resides. Useful in troubleshooting policy agent issues.</p></dd></dl></div></li><li class="step"><p>If your policy agent configuration is not in the top-level realm (/),
     then you must edit config/OpenSSOAgentBootstrap.properties to identify
     the sub-realm that has your policy agent configuration.
     Find com.sun.identity.agents.config.organization.name and change
     the "/" to the path to your policy agent profile. This allows the policy agent
     to properly identify itself to the OpenAM server. </p></li><li class="step"><p>Start the Tomcat server where you installed the agent.</p><div class="screen"><pre>
$ <strong>/path/to/tomcat/bin/startup.sh</strong>
    </pre></div></li></ol></div><div class="procedure"><a name="install-agent-into-tomcat7"></a><div class="procedure-title">Procedure&nbsp;2.4.&nbsp;To Install the Policy Agent into Tomcat 7</div><a class="indexterm" name="d0e1301"></a><p>The steps required for policy agent installation into Tomcat 7 are subtly
    different from those required for Tomcat 6. For Tomcat 7, you do not install
    the global <code class="filename">web.xml</code> file, but configure the
    application-specific <code class="filename">WEB-INF/web.xml</code> file after basic
    installation is complete. The <code class="filename">agentapp.war</code>
    is automatically copied to the Tomcat <code class="literal">webapps</code> folder.
    The Tomcat 8 install is identical to the Tomcat 7 installation process.
   </p><ol class="procedure" type="1"><li class="step"><p>Shut down the Tomcat server where you plan to install the
     agent.</p><div class="screen"><pre>
$ <strong>/path/to/tomcat/bin/shutdown.sh</strong>
    </pre></div></li><li class="step"><p>Make sure OpenAM is running.</p></li><li class="step"><p>Run <span class="command"><strong>agentadmin --install</strong></span> to install the agent.</p><div class="screen"><pre>
$ <strong>/path/to/j2ee_agents/tomcat_v6_agent/bin/agentadmin --install --acceptLicense</strong>
   </pre></div><ol type="a" class="substeps"><li class="step"><p lang="en">When you run the command, you will be prompted to read and accept the
  software license agreement for the agent installation.
  You can suppress the license agreement prompt by including the
  <code class="option">--acceptLicense</code> option on the command line.
  The inclusion of the option indicates that you have read and accepted
  the terms stated in the license.
  To view the license agreement, open <code class="filename">&lt;server-root&gt;/legal-notices/license.txt</code>.
 </p></li><li class="step"><p>
     Enter the path to the Tomcat configuration folder. For example,
     <code class="literal">/path/to/apache-tomcat/conf</code>.
    </p></li><li class="step"><p>
     Enter the OpenAM URL. For example, <code class="literal">http://openam.example.com:8080/openam</code>.
    </p></li><li class="step"><p>
     Enter the <code class="literal">$CATALINA_HOME</code> environment variable specifying
     the path to the root of the Tomcat server.
     For example, <code class="literal">/path/to/apache-tomcat/</code>.
    </p></li><li class="step"><p>
      Enter the agent URL. For example, <code class="literal">http://openam.example.com:8080/agentapp</code>.
     </p></li><li class="step"><p>
      Enter the agent profile name that you created in OpenAM. For example,
      <code class="literal">Tomcat Agent</code>.
     </p></li><li class="step"><p>Enter the path to the password file. For example,
      <code class="literal">/tmp/pwd.txt</code>.
     </p></li></ol></li><li class="step"><p>Next, review a summary of your responses and select an action
     to continue, go back a step, start over, or exit from the install.
    </p><div class="screen"><pre><em>
-----------------------------------------------
SUMMARY OF YOUR RESPONSES
-----------------------------------------------
Tomcat Server Config Directory : /path/to/tomcat/conf
OpenAM server URL : http://openam.example.com:8080/openam
$CATALINA_HOME environment variable : /path/to/tomcat

Tomcat global web.xml filter install : false
Agent URL : http://www.example.com:8080/agentapp
Agent Profile name : Tomcat Agent
Agent Profile Password file name : /tmp/pwd.txt

Verify your settings above and decide from the choices below.
1. Continue with Installation
2. Back to the last interaction
3. Start Over
4. Exit
Please make your selection [1]:
...

SUMMARY OF AGENT INSTALLATION
-----------------------------
Agent instance name: Agent_001
Agent Bootstrap file location:
/path/to/j2ee_agents/tomcat_v6_agent/Agent_001/config/
OpenSSOAgentBootstrap.properties
Agent Configuration file location
/path/to/j2ee_agents/tomcat_v6_agent/Agent_001/config/
OpenSSOAgentConfiguration.properties
Agent Audit directory location:
/path/to/j2ee_agents/tomcat_v6_agent/Agent_001/logs/audit
Agent Debug directory location:
/path/to/j2ee_agents/tomcat_v6_agent/Agent_001/logs/debug

Install log file location:
/path/to/j2ee_agents/tomcat_v6_agent/installer-logs/audit/install.log

Thank you for using OpenAM Policy Agent</em>
    </pre></div><p>
     Upon successful completion, the installer has added the agent
     configuration to the Tomcat configuration, and also set up the configuration
     and log directories for the agent.
    </p><div class="note"><h3 class="title">Note</h3><p>
      If the agent is in a different domain than the server, refer to
      the <em class="citetitle">Administration Guide</em> procedure,
      <a class="link" href="http://openam.forgerock.org/doc/admin-guide/#chap-cdsso" target="_blank">
       <em class="citetitle">Configuring Cross-Domain Single Sign On</em></a>.
     </p></div></li><li class="step"><p>
     Take note of the configuration files and log locations.
    </p><p>
     Each agent instance that you install on the system has its own
     numbered configuration and logs directory. The first agent's configuration
     and logs are thus located under the directory
     <code class="filename">j2ee_agents/tomcat_v6_agent/Agent_001/</code>.
    </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="filename">config/OpenSSOAgentBootstrap.properties</code></span></dt><dd><p>Used to bootstrap the Java EE policy agent, allowing the agent to
        connect to OpenAM and download its configuration</p></dd><dt><span class="term"><code class="filename">config/OpenSSOAgentConfiguration.properties</code></span></dt><dd><p>Only used if you configured the Java EE policy agent to use local
        configuration</p></dd><dt><span class="term"><code class="filename">logs/audit/</code></span></dt><dd><p>Operational audit log directory, only used if remote logging
        to OpenAM is disabled</p></dd><dt><span class="term"><code class="filename">logs/debug/</code></span></dt><dd><p>Debug directory where the <code class="filename">debug.out</code> debug
        file resides. Useful in troubleshooting policy agent issues.</p></dd></dl></div></li><li class="step"><p>If your policy agent configuration is not in the top-level realm (/),
     then you must edit config/OpenSSOAgentBootstrap.properties to identify
     the sub-realm that has your policy agent configuration.
     Find com.sun.identity.agents.config.organization.name and change
     the "/" to the path to your policy agent profile. This allows the policy agent
     to properly identify itself to the OpenAM server. </p></li><li class="step"><p>
     If you want to protect all applications in the container, you must
     add a filter manually for each protected application's
     <code class="literal">WEB-INF/web.xml</code>
     deployment descriptor file, following the opening &lt;web-app&gt; tag.
     Make sure that the agent filter is first in the filter chain.
    </p><pre class="brush: xml;">
&lt;filter&gt;
 &lt;filter-name&gt;Agent&lt;/filter-name&gt;
 &lt;display-name&gt;Agent&lt;/display-name&gt;
 &lt;description&gt;OpenAM Policy Agent Filter&lt;/description&gt;
 &lt;filter-class&gt;com.sun.identity.agents.filter.AmAgentFilter&lt;/filter-class&gt;
&lt;/filter&gt;
&lt;filter-mapping&gt;
 &lt;filter-name&gt;Agent&lt;/filter-name&gt;
 &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
 &lt;dispatcher&gt;REQUEST&lt;/dispatcher&gt;
 &lt;dispatcher&gt;INCLUDE&lt;/dispatcher&gt;
 &lt;dispatcher&gt;FORWARD&lt;/dispatcher&gt;
 &lt;dispatcher&gt;ERROR&lt;/dispatcher&gt;
&lt;/filter-mapping&gt;
    </pre></li><li class="step"><p>Start the Tomcat server where you installed the agent.</p><div class="screen"><pre>
$ <strong>/path/to/tomcat/bin/startup.sh</strong>
    </pre></div></li></ol></div><div class="procedure"><a name="check-tomcat-agent-installation"></a><div class="procedure-title">Procedure&nbsp;2.5.&nbsp;To Check the Policy Agent Installation</div><a class="indexterm" name="d0e1474"></a><ol class="procedure" type="1"><li class="step"><p>Check the Tomcat server log after you start the server to make
    sure startup completed successfully.</p><div class="screen"><pre>
$ <strong>tail -n 1 /path/to/tomcat/logs/catalina.out</strong>
<em>INFO: Server startup in 810 ms</em>
    </pre></div></li><li class="step"><p>Check the <code class="filename">debug.out</code> debug log to verify that
    the agent did start up.</p><div class="screen"><pre>
$ <strong>tail -n 7 /path/to/j2ee_agents/tomcat_v6_agent/Agent_001/logs/debug/debug.out</strong>
<em>=======================================
Version: ...
Revision: 3111
Build Date: 20120915
Build Machine: builds.forgerock.org
=======================================</em>
    </pre></div></li><li class="step"><p>If you have a policy configured, you can test your policy agent.
    For example, try to browse to a resource that your policy agent protects.
    You should be redirected to OpenAM to authenticate, for example as user
    <code class="literal">demo</code>, password <code class="literal">changeit</code>. After
    you authenticate, OpenAM then redirects you back to the resource you tried
    to access.</p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="silent-tomcat-agent-installation"></a>2.3.&nbsp;Silent Tomcat Policy Agent Installation</h2></div></div></div><a class="indexterm" name="d0e1516"></a><p>When performing a scripted, silent installation, use
  <span class="command"><strong>agentadmin --install --saveResponse
  <em class="replaceable"><code>response-file</code></em></strong></span>
  to create a response file for scripted installation. Then install silently
  using <span class="command"><strong>agentadmin --install --acceptLicense --useResponse
  <em class="replaceable"><code>response-file</code></em></strong></span>.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="uninstall-tomcat-agent"></a>2.4.&nbsp;Remove Tomcat Policy Agent Software</h2></div></div></div><a class="indexterm" name="d0e1536"></a><p>Shut down the Tomcat server before you uninstall the
    policy agent.</p><div class="screen"><pre>
$ <strong>/path/to/tomcat/bin/shutdown.sh</strong>
  </pre></div><p>To remove the Java EE policy agent, use <span class="command"><strong>agentadmin
  --uninstall</strong></span>. You must provide the Tomcat server configuration
  directory location.</p><p>Uninstall does not remove the agent instance directory, but you can
  do so manually after removing the agent configuration from Tomcat.</p></div></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-jboss-7"></a>Chapter&nbsp;3.&nbsp;Installing the JBoss 7 Application Server Policy Agent</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="section"><a href="#before-jboss7-agent-install">3.1. Before You Install</a></span></dt><dt><span class="section"><a href="#install-jboss7-agent">3.2. Installing the JBoss Policy Agent</a></span></dt><dt><span class="section"><a href="#silent-jboss7-agent-installation">3.3. Silent JBoss Policy Agent Installation</a></span></dt><dt><span class="section"><a href="#uninstall-jboss7-agent">3.4. Removing JBoss Policy Agent Software</a></span></dt></dl></div><a class="indexterm" name="d0e1561"></a><p>This chapter covers installation of the policy agent for JBoss
 Application Server.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="before-jboss7-agent-install"></a>3.1.&nbsp;Before You Install</h2></div></div></div><a class="indexterm" name="d0e1569"></a><a class="indexterm" name="d0e1574"></a><p>Make sure OpenAM is installed and running, and that you can contact OpenAM
  from the system running the policy agent. Next, create a profile for your
  policy agent as described in the <em class="citetitle">Administration Guide</em>
  section on <a class="link" href="http://openam.forgerock.org/doc/admin-guide/#create-agent-profiles" target="_blank"><em class="citetitle">Creating Agent
  Profiles</em></a>. To protect resources with the agent also create
  at least one policy as described in the section on <a class="link" href="http://openam.forgerock.org/doc/admin-guide/#configure-authz-policy" target="_blank"><em class="citetitle">Configuring
  Policies</em></a>. Consider creating a simple policy, such as a
  policy that allows only authenticated users to access your resources, in order
  to test your policy agent after installation.</p><p>You must install JBoss before installing the policy agent.</p><p lang="en">
 You must install a supported version of the Java runtime environment.
 See the <em class="citetitle">Release Notes</em> section,
 <a href="../jee-release-notes/index.html#java-requirements-javaee-agents" class="link"><em class="citetitle">Java EE Agents Java Requirements</em></a>,
 and set the <code class="literal">JAVA_HOME</code> environment variable accordingly.
 The policy agent installer requires Java.
</p><div class="screen"><pre>
$ <strong>echo $JAVA_HOME</strong>
<em>/path/to/java</em>
      </pre></div><p lang="en">
 See the OpenAM <em class="citetitle">Installation Guide</em> section,
 <a class="link" href="http://openam.forgerock.org/doc/install-guide/#download-openam-software" target="_blank"><em class="citetitle">Obtaining OpenAM Software</em></a>
 to determine which version of the agent to download, and download the agent.
 Also verify the checksum of the file you download
 against the checksum posted on the download page.
</p><p>Unzip the file in the directory where you plan to install the J2EE
  policy agent. The agent you install stores its configuration and logs
  under this directory.</p><p>When you unzip the policy agent, you find the following directories
   under the <code class="filename">j2ee_agents/jboss_v7_agent</code> directory.</p><p lang="en">
 Despite the directory name,
 the policy agent supports multiple container versions.
 For details, see the <em class="citetitle">Release Notes</em> section,
 <a href="../jee-release-notes/index.html#jee-pa-platform-requirements" class="link"><em class="citetitle">Java EE Agents Platform Requirements</em></a>.
</p><div lang="en" class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="filename">bin</code></span></dt><dd><p>The installation and configuration program
    <span class="command"><strong>agentadmin</strong></span> and a password hashing tool
    <span class="command"><strong>crypt_util</strong></span>.</p></dd><dt><span class="term"><code class="filename">config</code></span></dt><dd><p>Configuration templates used by the <span class="command"><strong>agentadmin</strong></span>
   command during installation</p></dd><dt><span class="term"><code class="filename">data</code></span></dt><dd><p>Not used</p></dd><dt><span class="term"><code class="filename">etc</code></span></dt><dd><p>Configuration templates used during installation</p></dd><dt><span class="term"><code class="filename">installer-logs</code></span></dt><dd><p>Location for log files written during installation</p></dd><dt><span class="term"><code class="filename">legal-notices</code></span></dt><dd><p>Contains licensing information including third-party licenses</p></dd><dt><span class="term"><code class="filename">lib</code></span></dt><dd><p>Shared libraries used by the Java EE policy agent</p></dd><dt><span class="term"><code class="filename">locale</code></span></dt><dd><p>Property files used by the installation program</p></dd><dt><span class="term"><code class="filename">README</code></span></dt><dd><p>README file containing platform and install information for the agent</p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="install-jboss7-agent"></a>3.2.&nbsp;Installing the JBoss Policy Agent</h2></div></div></div><a class="indexterm" name="d0e1720"></a><p>Complete the following procedures to install the policy agent.</p><div lang="en" class="procedure"><a name="d0e1728"></a><div class="procedure-title">Procedure&nbsp;3.1.&nbsp;To Create the Agent Profile</div><p>Regardless of whether you store configurations centrally in OpenAM
        or locally with your agents, the agent requires a profile so that it can
        connect to and communicate with OpenAM.</p><ol class="procedure" type="1"><li class="step"><p>In the OpenAM console, browse to Access Control &gt;
            <em class="replaceable"><code>Realm Name</code></em> &gt; Agents &gt; J2EE,
            and then click the New... button in the Agent table.</p></li><li class="step"><p>Complete the web form using the following hints.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Name</span></dt><dd><p>The name for the agent profile used when you install the
                        agent</p></dd><dt><span class="term">Password</span></dt><dd><p>Password the agent uses to authenticate to OpenAM</p></dd><dt><span class="term">Configuration</span></dt><dd><p>Centralized configurations are stored in the OpenAM configuration
                        store. You can manage the centralized configuration through the OpenAM
                        console. Local configurations are stored in a file alongside the
                        agent.</p></dd><dt><span class="term">Server URL</span></dt><dd><p>The full URL to an OpenAM instance, or if OpenAM is deployed in
                        a site configuration (behind a load balancer) then the site URL</p><p>In centralized configuration mode, the Server URL is used to
                        populate the agent profile for services such as Login, Logout, Naming,
                        and Cross Domain SSO.</p></dd><dt><span class="term">Agent URL</span></dt><dd><p>The URL to the J2EE agent application, such as
                        <code class="literal">http://www.example.com:8080/agentapp</code></p><p>In centralized configuration mode, the Agent URL is used to
                        populate the Agent Profile for services such as notifications.</p></dd></dl></div></li></ol></div><div lang="en" class="procedure"><a name="d0e1780"></a><div class="procedure-title">Procedure&nbsp;3.2.&nbsp;To Create the Password File</div><a class="indexterm" name="d0e1783"></a><ol class="procedure" type="1"><li class="step"><p>
   Create a text file containing only the password.
  </p><div class="screen"><pre>
$ <strong>echo password &gt; /tmp/pwd.txt</strong>
  </pre></div></li><li class="step"><p>
   Protect the password file you create as appropriate for your operating system.
  </p><div class="screen"><pre>
$ <strong>chmod 400 /tmp/pwd.txt</strong>
 </pre></div></li></ol></div><div class="procedure"><a name="install-agent-into-jboss7"></a><div class="procedure-title">Procedure&nbsp;3.3.&nbsp;To Install the Policy Agent into JBoss</div><a class="indexterm" name="d0e1807"></a><p>
     If you want to include an application-specific module, make sure to
     type in <code class="literal">false</code> when prompted with the following question:
    </p><pre class="literallayout">Install agent as global module? [true]:</pre><ol class="procedure" type="1"><li class="step"><p>Shut down the JBoss server where you plan to install the
    agent.</p></li><li class="step"><p>Make sure OpenAM is running.</p></li><li class="step"><p>Run <span class="command"><strong>agentadmin --install</strong></span> to install the agent.</p><p lang="en">When you run the command, you will be prompted to read and accept the
  software license agreement for the agent installation.
  You can suppress the license agreement prompt by including the
  <code class="option">--acceptLicense</code> option on the command line.
  The inclusion of the option indicates that you have read and accepted
  the terms stated in the license.
  To view the license agreement, open <code class="filename">&lt;server-root&gt;/legal-notices/license.txt</code>.
 </p><div class="screen"><pre>
$ <strong>/path/to/j2ee_agents/jboss_v7_agent/bin/agentadmin --install --acceptLicense</strong>
<em>...
-----------------------------------------------
SUMMARY OF YOUR RESPONSES
-----------------------------------------------
JBoss home directory : /path/to/jboss/
JBoss deployment mode: standalone
Install agent as global module: true
OpenAM server URL : http://openam.example.com:8080/openam
Agent URL : http://www.example.com:8080/agentapp
Agent Profile name : JBossAgent
Agent Profile Password file name : /tmp/pwd.txt

...
SUMMARY OF AGENT INSTALLATION
-----------------------------
Agent instance name: Agent_001
Agent Bootstrap file location:
/path/to/j2ee_agents/jboss_v7_agent/Agent_001/config/
 OpenSSOAgentBootstrap.properties
Agent Configuration file location
/path/to/j2ee_agents/jboss_v7_agent/Agent_001/config/
 OpenSSOAgentConfiguration.properties
Agent Audit directory location:
/path/to/j2ee_agents/jboss_v7_agent/Agent_001/logs/audit
Agent Debug directory location:
/path/to/j2ee_agents/jboss_v7_agent/Agent_001/logs/debug


Install log file location:
/path/to/j2ee_agents/jboss_v7_agent/installer-logs/audit/install.log
...</em>
    </pre></div><p>Upon successful completion, the installer has updated the JBoss
    configuration, added the agent web application under
    <code class="filename">JBOSS_HOME/server/standalone/deployments</code>, and also set up
    configuration and log directories for the agent.</p><div class="note"><h3 class="title">Note</h3><p>If the agent is in a different domain than the server, refer to <em class="citetitle">Administration Guide</em> procedure, <a class="link" href="http://openam.forgerock.org/doc/admin-guide/#chap-cdsso" target="_blank"><em class="citetitle">Configuring Cross-Domain
   Single Sign On</em></a>.</p></div></li><li class="step"><p>Take note of the configuration files and log locations.</p><p>Each agent instance that you install on the system has its own
    numbered configuration and logs directory. The first agent's configuration
    and logs are thus located under the directory
    <code class="filename">j2ee_agents/jboss_v7_agent/Agent_001/</code>.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="filename">config/OpenSSOAgentBootstrap.properties</code></span></dt><dd><p>Used to bootstrap the Java EE policy agent, allowing the agent to
       connect to OpenAM and download its configuration</p></dd><dt><span class="term"><code class="filename">config/OpenSSOAgentConfiguration.properties</code></span></dt><dd><p>Only used if you configured the Java EE policy agent to use local
       configuration</p></dd><dt><span class="term"><code class="filename">logs/audit/</code></span></dt><dd><p>Operational audit log directory, only used if remote logging
       to OpenAM is disabled</p></dd><dt><span class="term"><code class="filename">logs/debug/</code></span></dt><dd><p>Debug directory where the debug file resides. Useful in
       troubleshooting policy agent issues.</p></dd></dl></div></li><li class="step"><p>If your policy agent configuration is not in the top-level realm (/),
       then you must edit config/OpenSSOAgentBootstrap.properties to identify
       the sub-realm that has your policy agent configuration.
       Find com.sun.identity.agents.config.organization.name and change
       the / to the realm to your policy agent profile. This allows the policy agent
       to properly identify itself to the OpenAM server. </p></li><li class="step"><p>To protect a web application, you must add the following filter
    to the application's <code class="filename">WEB-INF/web.xml</code> deployment descriptor,
    following the opening &lt;web-app&gt; tag.</p><pre class="brush: xml;"> &lt;filter&gt;
  &lt;filter-name&gt;Agent&lt;/filter-name&gt;
  &lt;display-name&gt;Agent&lt;/display-name&gt;
  &lt;description&gt;OpenAM Policy Agent Filter&lt;/description&gt;
 &lt;filter-class&gt;com.sun.identity.agents.filter.AmAgentFilter&lt;/filter-class&gt;
 &lt;/filter&gt;
 &lt;filter-mapping&gt;
  &lt;filter-name&gt;Agent&lt;/filter-name&gt;
  &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
  &lt;dispatcher&gt;REQUEST&lt;/dispatcher&gt;
  &lt;dispatcher&gt;INCLUDE&lt;/dispatcher&gt;
  &lt;dispatcher&gt;FORWARD&lt;/dispatcher&gt;
  &lt;dispatcher&gt;ERROR&lt;/dispatcher&gt;
 &lt;/filter-mapping&gt;</pre><p>
     You also need to add the following security constraint specification to the
     application's <code class="filename">WEB-INF/web.xml</code> file.
    </p><pre class="brush: xml;">&lt;security-constraint&gt;
  &lt;web-resource-collection&gt;
   &lt;web-resource-name&gt;All resources&lt;/web-resource-name&gt;
    &lt;description&gt;Protects all resources&lt;/description&gt;
    &lt;url-pattern&gt;*.do&lt;/url-pattern&gt;
   &lt;/web-resource-collection&gt;
  &lt;/security-constraint&gt;</pre><p>You must also add the following security domain specification to the
    <code class="filename">jboss-web.xml</code> configuration file of the application.</p><pre class="brush: xml;">&lt;security-domain&gt;java:/jaas/AMRealm&lt;/security-domain&gt;</pre><p>
     You can find that file packed in the <code class="filename">agentsample.ear</code>
     archive in the
     <code class="filename">/path/to/j2ee_agents/jboss_v7_agent/sampleapp/dist</code>
     directory. Once unpacked, you can find the file in the
     <code class="filename">WEB-INF</code> subdirectory.
    </p></li><li class="step"><p>
     If you typed in <code class="literal">false</code> to the <code class="literal">Install
     agent as global module</code> question during the installation process,
     you will need to add the following line to the
     <code class="filename">META-INF/MANIFEST.MF</code> file of the application.
    </p><pre class="brush: xml;">Dependencies: org.forgerock.openam.agent</pre></li></ol></div><div class="procedure"><a name="run-jboss7-after-agent-installation"></a><div class="procedure-title">Procedure&nbsp;3.4.&nbsp;To Run JBoss After Agent Installation</div><a class="indexterm" name="d0e1953"></a><ol class="procedure" type="1"><li class="step"><p>Run JBoss.</p></li><li class="step"><p>If you have a policy configured, you can test your policy agent.
    For example, try to browse to a resource that your policy agent protects.
    You should be redirected to OpenAM to authenticate, for example as user
    <code class="literal">demo</code>, password <code class="literal">changeit</code>. After
    you authenticate, OpenAM then redirects you back to the resource you tried
    to access.</p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="silent-jboss7-agent-installation"></a>3.3.&nbsp;Silent JBoss Policy Agent Installation</h2></div></div></div><a class="indexterm" name="d0e1973"></a><p>When performing a scripted, silent installation, use
  <span class="command"><strong>agentadmin --install --saveResponse
  <em class="replaceable"><code>response-file</code></em></strong></span>
  to create a response file for scripted installation. Then install silently
  using <span class="command"><strong>agentadmin --install --acceptLicense --useResponse
  <em class="replaceable"><code>response-file</code></em></strong></span>.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="uninstall-jboss7-agent"></a>3.4.&nbsp;Removing JBoss Policy Agent Software</h2></div></div></div><a class="indexterm" name="d0e1993"></a><p>Shut down the JBoss server before you uninstall the
    policy agent.</p><p>To remove the Java EE policy agent, use <span class="command"><strong>agentadmin
  --uninstall</strong></span>. You must provide the JBoss configuration directory
  location.</p><p>Uninstall does not remove the agent instance directory, but you can
  do so manually after removing the agent configuration from JBoss.</p></div></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-jetty"></a>Chapter&nbsp;4.&nbsp;Installing the Jetty Server Policy Agent</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="section"><a href="#before-jetty-agent-install">4.1. Before You Install</a></span></dt><dt><span class="section"><a href="#install-jetty-agent">4.2. Installing the Jetty Policy Agent</a></span></dt><dt><span class="section"><a href="#silent-jetty-agent-installation">4.3. Silent Jetty Policy Agent Installation</a></span></dt><dt><span class="section"><a href="#uninstall-jetty-agent">4.4. Removing Jetty Policy Agent Software</a></span></dt></dl></div><a class="indexterm" name="d0e2011"></a><a class="indexterm" name="d0e2016"></a><p>This chapter covers installation of the policy agent for Jetty.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="before-jetty-agent-install"></a>4.1.&nbsp;Before You Install</h2></div></div></div><a class="indexterm" name="d0e2024"></a><p>Make sure OpenAM is installed and running, and that you can contact OpenAM
  from the system running the policy agent. Next, create a profile for your
  policy agent as described in the <em class="citetitle">Administration Guide</em>
  section on <a class="link" href="http://openam.forgerock.org/doc/admin-guide/#create-agent-profiles" target="_blank"><em class="citetitle">Creating Agent
  Profiles</em></a>. To protect resources with the agent also create
  at least one policy as described in the section on <a class="link" href="http://openam.forgerock.org/doc/admin-guide/#configure-authz-policy" target="_blank"><em class="citetitle">Configuring
  Policies</em></a>. Consider creating a simple policy, such as a
  policy that allows only authenticated users to access your resources, in order
  to test your policy agent after installation.</p><p>You must install Jetty before you install the policy agent, and you
  must stop the server during installation.</p><p lang="en">
 You must install a supported version of the Java runtime environment.
 See the <em class="citetitle">Release Notes</em> section,
 <a href="../jee-release-notes/index.html#java-requirements-javaee-agents" class="link"><em class="citetitle">Java EE Agents Java Requirements</em></a>,
 and set the <code class="literal">JAVA_HOME</code> environment variable accordingly.
 The policy agent installer requires Java.
</p><div class="screen"><pre>
$ <strong>echo $JAVA_HOME</strong>
<em>/path/to/java</em>
      </pre></div><p lang="en">
 See the OpenAM <em class="citetitle">Installation Guide</em> section,
 <a class="link" href="http://openam.forgerock.org/doc/install-guide/#download-openam-software" target="_blank"><em class="citetitle">Obtaining OpenAM Software</em></a>
 to determine which version of the agent to download, and download the agent.
 Also verify the checksum of the file you download
 against the checksum posted on the download page.
</p><div class="note"><h3 class="title">Note</h3><p>
    Command line examples in this chapter show Jetty accessed remotely. If
    you are following the examples and have issues accessing Jetty remotely,
    you might have to change filter settings in the deployment descriptor file,
    such as <code class="filename">/path/to/jetty/webapps/test/WEB-INF/web.xml</code>,
    as shown in the following example.
   </p><pre class="brush: xml;">&lt;filter&gt;
 &lt;filter-name&gt;TestFilter&lt;/filter-name&gt;
 &lt;filter-class&gt;com.acme.TestFilter&lt;/filter-class&gt;
 &lt;init-param&gt;
  &lt;param-name&gt;remote&lt;/param-name&gt;
  &lt;param-value&gt;true&lt;/param-value&gt; &lt;!-- default: false --&gt;
 &lt;/init-param&gt;
&lt;/filter&gt;</pre></div><p>Unzip the file in the directory where you plan to install the J2EE
  policy agent. The agent you install stores its configuration and logs
  under this directory.</p><p>When you unzip the policy agent, you find the following directories
   under the <code class="filename">j2ee_agents/jetty_v61_agent</code> directory.</p><p lang="en">
 Despite the directory name,
 the policy agent supports multiple container versions.
 For details, see the <em class="citetitle">Release Notes</em> section,
 <a href="../jee-release-notes/index.html#jee-pa-platform-requirements" class="link"><em class="citetitle">Java EE Agents Platform Requirements</em></a>.
</p><div lang="en" class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="filename">bin</code></span></dt><dd><p>The installation and configuration program
    <span class="command"><strong>agentadmin</strong></span> and a password hashing tool
    <span class="command"><strong>crypt_util</strong></span>.</p></dd><dt><span class="term"><code class="filename">config</code></span></dt><dd><p>Configuration templates used by the <span class="command"><strong>agentadmin</strong></span>
   command during installation</p></dd><dt><span class="term"><code class="filename">data</code></span></dt><dd><p>Not used</p></dd><dt><span class="term"><code class="filename">etc</code></span></dt><dd><p>Configuration templates used during installation</p></dd><dt><span class="term"><code class="filename">installer-logs</code></span></dt><dd><p>Location for log files written during installation</p></dd><dt><span class="term"><code class="filename">legal-notices</code></span></dt><dd><p>Contains licensing information including third-party licenses</p></dd><dt><span class="term"><code class="filename">lib</code></span></dt><dd><p>Shared libraries used by the Java EE policy agent</p></dd><dt><span class="term"><code class="filename">locale</code></span></dt><dd><p>Property files used by the installation program</p></dd><dt><span class="term"><code class="filename">README</code></span></dt><dd><p>README file containing platform and install information for the agent</p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="install-jetty-agent"></a>4.2.&nbsp;Installing the Jetty Policy Agent</h2></div></div></div><a class="indexterm" name="d0e2178"></a><p>Complete the following procedures to install the policy agent.</p><div lang="en" class="procedure"><a name="d0e2186"></a><div class="procedure-title">Procedure&nbsp;4.1.&nbsp;To Create the Agent Profile</div><p>Regardless of whether you store configurations centrally in OpenAM
        or locally with your agents, the agent requires a profile so that it can
        connect to and communicate with OpenAM.</p><ol class="procedure" type="1"><li class="step"><p>In the OpenAM console, browse to Access Control &gt;
            <em class="replaceable"><code>Realm Name</code></em> &gt; Agents &gt; J2EE,
            and then click the New... button in the Agent table.</p></li><li class="step"><p>Complete the web form using the following hints.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Name</span></dt><dd><p>The name for the agent profile used when you install the
                        agent</p></dd><dt><span class="term">Password</span></dt><dd><p>Password the agent uses to authenticate to OpenAM</p></dd><dt><span class="term">Configuration</span></dt><dd><p>Centralized configurations are stored in the OpenAM configuration
                        store. You can manage the centralized configuration through the OpenAM
                        console. Local configurations are stored in a file alongside the
                        agent.</p></dd><dt><span class="term">Server URL</span></dt><dd><p>The full URL to an OpenAM instance, or if OpenAM is deployed in
                        a site configuration (behind a load balancer) then the site URL</p><p>In centralized configuration mode, the Server URL is used to
                        populate the agent profile for services such as Login, Logout, Naming,
                        and Cross Domain SSO.</p></dd><dt><span class="term">Agent URL</span></dt><dd><p>The URL to the J2EE agent application, such as
                        <code class="literal">http://www.example.com:8080/agentapp</code></p><p>In centralized configuration mode, the Agent URL is used to
                        populate the Agent Profile for services such as notifications.</p></dd></dl></div></li></ol></div><div lang="en" class="procedure"><a name="d0e2238"></a><div class="procedure-title">Procedure&nbsp;4.2.&nbsp;To Create the Password File</div><a class="indexterm" name="d0e2241"></a><ol class="procedure" type="1"><li class="step"><p>
   Create a text file containing only the password.
  </p><div class="screen"><pre>
$ <strong>echo password &gt; /tmp/pwd.txt</strong>
  </pre></div></li><li class="step"><p>
   Protect the password file you create as appropriate for your operating system.
  </p><div class="screen"><pre>
$ <strong>chmod 400 /tmp/pwd.txt</strong>
 </pre></div></li></ol></div><div class="procedure"><a name="install-agent-into-jetty"></a><div class="procedure-title">Procedure&nbsp;4.3.&nbsp;To Install the Policy Agent into Jetty</div><ol class="procedure" type="1"><li class="step"><p>Shut down the Jetty server where you plan to install the
    agent.</p></li><li class="step"><p>Make sure OpenAM is running.</p></li><li class="step"><p>Run <span class="command"><strong>agentadmin --install</strong></span> to install the agent.</p><p lang="en">When you run the command, you will be prompted to read and accept the
  software license agreement for the agent installation.
  You can suppress the license agreement prompt by including the
  <code class="option">--acceptLicense</code> option on the command line.
  The inclusion of the option indicates that you have read and accepted
  the terms stated in the license.
  To view the license agreement, open <code class="filename">&lt;server-root&gt;/legal-notices/license.txt</code>.
 </p><div class="screen"><pre>
$ <strong>/path/to/j2ee_agents/jetty_v61_agent/bin/agentadmin --install --acceptLicense</strong>
<em>...
-----------------------------------------------
SUMMARY OF YOUR RESPONSES
-----------------------------------------------
Jetty Server Config Directory : /path/to/jetty/etc
OpenAM server URL : http://openam.example.com:8080/openam
Jetty installation directory. : /path/to/jetty
Agent URL : http://www.example.com:8080/agentapp
Agent Profile name : Jetty Agent
Agent Profile Password file name : /tmp/pwd.txt

...
SUMMARY OF AGENT INSTALLATION
-----------------------------
Agent instance name: Agent_001
Agent Bootstrap file location:
/path/to/j2ee_agents/jetty_v61_agent/Agent_001/config/
 OpenSSOAgentBootstrap.properties
Agent Configuration file location
/path/to/j2ee_agents/jetty_v61_agent/Agent_001/config/
 OpenSSOAgentConfiguration.properties
Agent Audit directory location:
/path/to/j2ee_agents/jetty_v61_agent/Agent_001/logs/audit
Agent Debug directory location:
/path/to/j2ee_agents/jetty_v61_agent/Agent_001/logs/debug


Install log file location:
/path/to/j2ee_agents/jetty_v61_agent/installer-logs/audit/install.log
...</em>
    </pre></div><p>Upon successful completion, the installer has updated Jetty's
    <code class="filename">start.jar</code> to reference the agent, set up the agent
    web application, and also set up configuration and log directories for the
    agent.</p><div class="note"><h3 class="title">Note</h3><p>If the agent is in a different domain than the server, refer to
      <em class="citetitle">Administration Guide</em> procedure, <a class="link" href="http://openam.forgerock.org/doc/admin-guide/#chap-cdsso" target="_blank"><em class="citetitle">Configuring Cross-Domain
   Single Sign On</em></a>.</p></div></li><li class="step"><p>Take note of the configuration files and log locations.</p><p>Each agent instance that you install on the system has its own
    numbered configuration and logs directory. The first agent's configuration
    and logs are thus located under the directory
    <code class="filename">j2ee_agents/jetty_v61_agent/Agent_001/</code>.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="filename">config/OpenSSOAgentBootstrap.properties</code></span></dt><dd><p>Used to bootstrap the Java EE policy agent, allowing the agent to
       connect to OpenAM and download its configuration</p></dd><dt><span class="term"><code class="filename">config/OpenSSOAgentConfiguration.properties</code></span></dt><dd><p>Only used if you configured the Java EE policy agent to use local
       configuration</p></dd><dt><span class="term"><code class="filename">logs/audit/</code></span></dt><dd><p>Operational audit log directory, only used if remote logging
       to OpenAM is disabled</p></dd><dt><span class="term"><code class="filename">logs/debug/</code></span></dt><dd><p>Debug directory where the <code class="filename">debug.out</code> debug
       file resides. Useful in troubleshooting policy agent issues.</p></dd></dl></div></li><li class="step"><p>If your policy agent configuration is not in the top-level realm (/),
       then you must edit config/OpenSSOAgentBootstrap.properties to identify
       the sub-realm that has your policy agent configuration.
       Find com.sun.identity.agents.config.organization.name and change
       the / to the path to your policy agent profile. This allows the policy agent
       to properly identify itself to the OpenAM server. </p></li><li class="step"><p>To protect a web application, you must add the following filter
    to the application's <code class="filename">WEB-INF/web.xml</code> deployment descriptor,
    following the opening &lt;web-app&gt; tag.</p><pre class="brush: xml;"> &lt;filter&gt;
  &lt;filter-name&gt;Agent&lt;/filter-name&gt;
  &lt;display-name&gt;Agent&lt;/display-name&gt;
  &lt;description&gt;OpenAM Policy Agent Filter&lt;/description&gt;
 &lt;filter-class&gt;com.sun.identity.agents.filter.AmAgentFilter&lt;/filter-class&gt;
 &lt;/filter&gt;
 &lt;filter-mapping&gt;
  &lt;filter-name&gt;Agent&lt;/filter-name&gt;
  &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
  &lt;dispatcher&gt;REQUEST&lt;/dispatcher&gt;
  &lt;dispatcher&gt;INCLUDE&lt;/dispatcher&gt;
  &lt;dispatcher&gt;FORWARD&lt;/dispatcher&gt;
  &lt;dispatcher&gt;ERROR&lt;/dispatcher&gt;
 &lt;/filter-mapping&gt;</pre></li><li class="step"><p>Start the Jetty server where you installed the agent.</p><div class="screen"><pre>
$ <strong>cd /path/to/jetty ; java -jar start.jar</strong>
<em>...
2011-09-15 12:49:55.469:INFO::Extract file:/path/to/jetty/webapps/agentapp.war
...
2011-09-15 12:50:14.163:INFO::Started SelectChannelConnector@0.0.0.0:8080</em>
    </pre></div></li><li class="step"><p>If you have a policy configured, you can test your policy agent.
    For example, try to browse to a resource that your policy agent protects.
    You should be redirected to OpenAM to authenticate, for example as user
    <code class="literal">demo</code>, password <code class="literal">changeit</code>. After
    you authenticate, OpenAM then redirects you back to the resource you tried
    to access.</p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="silent-jetty-agent-installation"></a>4.3.&nbsp;Silent Jetty Policy Agent Installation</h2></div></div></div><a class="indexterm" name="d0e2383"></a><p>When performing a scripted, silent installation, use
  <span class="command"><strong>agentadmin --acceptLicense --saveResponse
  <em class="replaceable"><code>response-file</code></em></strong></span>
  to create a response file for scripted installation. Then install silently
  using <span class="command"><strong>agentadmin --install --acceptLicense --useResponse
  <em class="replaceable"><code>response-file</code></em></strong></span>.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="uninstall-jetty-agent"></a>4.4.&nbsp;Removing Jetty Policy Agent Software</h2></div></div></div><a class="indexterm" name="d0e2403"></a><p>Shut down the Jetty server before you uninstall the
    policy agent.</p><p>To remove the Java EE policy agent, use <span class="command"><strong>agentadmin
  --uninstall</strong></span>. You must provide the Jetty configuration directory
  location.</p><p>Uninstall does not remove the agent instance directory, but you can
  do so manually after removing the agent configuration from Jetty.</p></div></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-weblogic"></a>Chapter&nbsp;5.&nbsp;Installing the Oracle WebLogic Policy Agent</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="section"><a href="#before-weblogic-agent-install">5.1. Before You Install</a></span></dt><dt><span class="section"><a href="#install-weblogic-agent">5.2. Installing the WebLogic Policy Agent</a></span></dt><dt><span class="section"><a href="#silent-weblogic-agent-installation">5.3. Silent WebLogic Policy Agent Installation</a></span></dt><dt><span class="section"><a href="#post-weblogic-agent-installation">5.4. Post Installation of WebLogic Policy Agent</a></span></dt><dt><span class="section"><a href="#weblogic-agents-multi-server">5.5. Installing WebLogic Policy Agents in Multi-Server Domains</a></span></dt><dt><span class="section"><a href="#uninstall-weblogic-agent">5.6. Removing WebLogic Policy Agent Software</a></span></dt></dl></div><a class="indexterm" name="d0e2421"></a><p>This chapter covers installation of the policy agent for Oracle
 WebLogic.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="before-weblogic-agent-install"></a>5.1.&nbsp;Before You Install</h2></div></div></div><a class="indexterm" name="d0e2429"></a><p>Make sure OpenAM is installed and running, and that you can contact OpenAM
  from the system running the policy agent. Next, create a profile for your
  policy agent as described in the <em class="citetitle">Administration Guide</em>
  section on <a class="link" href="http://openam.forgerock.org/doc/admin-guide/#create-agent-profiles" target="_blank"><em class="citetitle">Creating Agent
  Profiles</em></a>. To protect resources with the agent also create
  at least one policy as described in the section on <a class="link" href="http://openam.forgerock.org/doc/admin-guide/#configure-authz-policy" target="_blank"><em class="citetitle">Configuring
  Policies</em></a>. Consider creating a simple policy, such as a
  policy that allows only authenticated users to access your resources, in order
  to test your policy agent after installation.</p><p>You must install WebLogic before you install the policy agent, and you
  must stop the server during installation.</p><p lang="en">
 You must install a supported version of the Java runtime environment.
 See the <em class="citetitle">Release Notes</em> section,
 <a href="../jee-release-notes/index.html#java-requirements-javaee-agents" class="link"><em class="citetitle">Java EE Agents Java Requirements</em></a>,
 and set the <code class="literal">JAVA_HOME</code> environment variable accordingly.
 The policy agent installer requires Java.
</p><div class="screen"><pre>
$ <strong>echo $JAVA_HOME</strong>
<em>/path/to/java</em>
      </pre></div><p lang="en">
 See the OpenAM <em class="citetitle">Installation Guide</em> section,
 <a class="link" href="http://openam.forgerock.org/doc/install-guide/#download-openam-software" target="_blank"><em class="citetitle">Obtaining OpenAM Software</em></a>
 to determine which version of the agent to download, and download the agent.
 Also verify the checksum of the file you download
 against the checksum posted on the download page.
</p><p>Unzip the file in the directory where you plan to install the J2EE
  policy agent. The agent you install stores its configuration and logs
  under this directory.</p><p>When you unzip the policy agent, you find the following directories
   under the <code class="filename">j2ee_agents/weblogic_v10_agent</code> directory.</p><p lang="en">
 Despite the directory name,
 the policy agent supports multiple container versions.
 For details, see the <em class="citetitle">Release Notes</em> section,
 <a href="../jee-release-notes/index.html#jee-pa-platform-requirements" class="link"><em class="citetitle">Java EE Agents Platform Requirements</em></a>.
</p><div lang="en" class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="filename">bin</code></span></dt><dd><p>The installation and configuration program
    <span class="command"><strong>agentadmin</strong></span> and a password hashing tool
    <span class="command"><strong>crypt_util</strong></span>.</p></dd><dt><span class="term"><code class="filename">config</code></span></dt><dd><p>Configuration templates used by the <span class="command"><strong>agentadmin</strong></span>
   command during installation</p></dd><dt><span class="term"><code class="filename">data</code></span></dt><dd><p>Not used</p></dd><dt><span class="term"><code class="filename">etc</code></span></dt><dd><p>Configuration templates used during installation</p></dd><dt><span class="term"><code class="filename">installer-logs</code></span></dt><dd><p>Location for log files written during installation</p></dd><dt><span class="term"><code class="filename">legal-notices</code></span></dt><dd><p>Contains licensing information including third-party licenses</p></dd><dt><span class="term"><code class="filename">lib</code></span></dt><dd><p>Shared libraries used by the Java EE policy agent</p></dd><dt><span class="term"><code class="filename">locale</code></span></dt><dd><p>Property files used by the installation program</p></dd><dt><span class="term"><code class="filename">README</code></span></dt><dd><p>README file containing platform and install information for the agent</p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="install-weblogic-agent"></a>5.2.&nbsp;Installing the WebLogic Policy Agent</h2></div></div></div><a class="indexterm" name="d0e2575"></a><p>Complete the following procedures to install the policy agent.</p><div lang="en" class="procedure"><a name="d0e2583"></a><div class="procedure-title">Procedure&nbsp;5.1.&nbsp;To Create the Agent Profile</div><p>Regardless of whether you store configurations centrally in OpenAM
        or locally with your agents, the agent requires a profile so that it can
        connect to and communicate with OpenAM.</p><ol class="procedure" type="1"><li class="step"><p>In the OpenAM console, browse to Access Control &gt;
            <em class="replaceable"><code>Realm Name</code></em> &gt; Agents &gt; J2EE,
            and then click the New... button in the Agent table.</p></li><li class="step"><p>Complete the web form using the following hints.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Name</span></dt><dd><p>The name for the agent profile used when you install the
                        agent</p></dd><dt><span class="term">Password</span></dt><dd><p>Password the agent uses to authenticate to OpenAM</p></dd><dt><span class="term">Configuration</span></dt><dd><p>Centralized configurations are stored in the OpenAM configuration
                        store. You can manage the centralized configuration through the OpenAM
                        console. Local configurations are stored in a file alongside the
                        agent.</p></dd><dt><span class="term">Server URL</span></dt><dd><p>The full URL to an OpenAM instance, or if OpenAM is deployed in
                        a site configuration (behind a load balancer) then the site URL</p><p>In centralized configuration mode, the Server URL is used to
                        populate the agent profile for services such as Login, Logout, Naming,
                        and Cross Domain SSO.</p></dd><dt><span class="term">Agent URL</span></dt><dd><p>The URL to the J2EE agent application, such as
                        <code class="literal">http://www.example.com:8080/agentapp</code></p><p>In centralized configuration mode, the Agent URL is used to
                        populate the Agent Profile for services such as notifications.</p></dd></dl></div></li></ol></div><div lang="en" class="procedure"><a name="d0e2635"></a><div class="procedure-title">Procedure&nbsp;5.2.&nbsp;To Create the Password File</div><a class="indexterm" name="d0e2638"></a><ol class="procedure" type="1"><li class="step"><p>
   Create a text file containing only the password.
  </p><div class="screen"><pre>
$ <strong>echo password &gt; /tmp/pwd.txt</strong>
  </pre></div></li><li class="step"><p>
   Protect the password file you create as appropriate for your operating system.
  </p><div class="screen"><pre>
$ <strong>chmod 400 /tmp/pwd.txt</strong>
 </pre></div></li></ol></div><div class="procedure"><a name="install-agent-into-weblogic"></a><div class="procedure-title">Procedure&nbsp;5.3.&nbsp;To Install the Policy Agent into WebLogic</div><ol class="procedure" type="1"><li class="step"><p>Shut down the WebLogic server where you plan to install the
    agent.</p></li><li class="step"><p>Make sure OpenAM is running.</p></li><li class="step"><p>Run <span class="command"><strong>agentadmin --install</strong></span> to install the agent.</p><p lang="en">When you run the command, you will be prompted to read and accept the
  software license agreement for the agent installation.
  You can suppress the license agreement prompt by including the
  <code class="option">--acceptLicense</code> option on the command line.
  The inclusion of the option indicates that you have read and accepted
  the terms stated in the license.
  To view the license agreement, open <code class="filename">&lt;server-root&gt;/legal-notices/license.txt</code>.
 </p><div class="screen"><pre>
$ <strong>/path/to/j2ee_agents/weblogic_v10_agent/bin/agentadmin --install --acceptLicense</strong>
<em>...
-----------------------------------------------
SUMMARY OF YOUR RESPONSES
-----------------------------------------------
Startup script location :
/path/to/domain/mydomain/bin/startWebLogic.sh
WebLogic Server instance name : AdminServer
WebLogic home directory : /path/to/wlserver
OpenAM server URL : http://openam.example.com:8080/openam
Agent URL : http://www.example.com:7001/agentapp
Agent Profile name : WebLogic Agent
Agent Profile Password file name : /tmp/pwd.txt

...
SUMMARY OF AGENT INSTALLATION
-----------------------------
Agent instance name: Agent_001
Agent Bootstrap file location:
/path/to/j2ee_agents/weblogic_v10_agent/Agent_001/config/
 OpenSSOAgentBootstrap.properties
Agent Configuration file location
/path/to/j2ee_agents/weblogic_v10_agent/Agent_001/config/
 OpenSSOAgentConfiguration.properties
Agent Audit directory location:
/path/to/j2ee_agents/weblogic_v10_agent/Agent_001/logs/audit
Agent Debug directory location:
/path/to/j2ee_agents/weblogic_v10_agent/Agent_001/logs/debug


Install log file location:
/path/to/j2ee_agents/weblogic_v10_agent/installer-logs/audit/install.log
...</em>
    </pre></div><p>Upon successful completion, the installer has updated the WebLogic
    configuration, copied the agent libraries to WebLogic's library directory,
    and also set up configuration and log directories for the agent.</p><div class="note"><h3 class="title">Note</h3><p>If the agent is in a different domain than the server, refer to
      the <em class="citetitle">Administration Guide</em> procedure, <a class="link" href="http://openam.forgerock.org/doc/admin-guide/#chap-cdsso" target="_blank"><em class="citetitle">Configuring Cross-Domain
   Single Sign On</em></a>.</p></div></li><li class="step"><p>Take note of the configuration files and log locations.</p><p>Each agent instance that you install on the system has its own
    numbered configuration and logs directory. The first agent's configuration
    and logs are thus located under the directory
    <code class="filename">j2ee_agents/weblogic_v10_agent/Agent_001/</code>.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="filename">config/OpenSSOAgentBootstrap.properties</code></span></dt><dd><p>Used to bootstrap the Java EE policy agent, allowing the agent to
       connect to OpenAM and download its configuration</p></dd><dt><span class="term"><code class="filename">config/OpenSSOAgentConfiguration.properties</code></span></dt><dd><p>Only used if you configured the Java EE policy agent to use local
       configuration</p></dd><dt><span class="term"><code class="filename">logs/audit/</code></span></dt><dd><p>Operational audit log directory, only used if remote logging
       to OpenAM is disabled</p></dd><dt><span class="term"><code class="filename">logs/debug/</code></span></dt><dd><p>Debug directory where the debug file resides. Useful in
       troubleshooting policy agent issues.</p></dd></dl></div></li><li class="step"><p>If your policy agent configuration is not in the top-level realm (/),
       then you must edit config/OpenSSOAgentBootstrap.properties to identify
       the sub-realm that has your policy agent configuration.
       Find com.sun.identity.agents.config.organization.name and change
       the / to the path to your policy agent profile. This allows the policy agent
       to properly identify itself to the OpenAM server. </p></li><li class="step"><p>The agent requires sourcing before it will work properly. There are two
    ways to source.</p><ul class="stepalternatives">
     <li class="step"><p>Manually source the file containing the policy agent environment settings for
      WebLogic before starting the application server. </p><div class="screen"><pre>
$ <strong>. /path/to/setAgentEnv_AdminServer.sh</strong>
      </pre></div></li>
     <li class="step"><p>Or edit the <code class="filename">startWebLogic.sh</code> script to set the sourcing
      needed for the agent, by adding these lines after the code block shown. Add the
      setAgentEnv_AdminServer.sh line to the following location in the file. The drawback
      to this approach is that it could be overwritten, as noted in the file.</p><div class="screen"><pre>
$ <strong>cat /path/to/startWebLogic.sh</strong>
<em>...
# Any changes to this script may be lost when adding extensions to this
# configuration.
DOMAIN_HOME="/opt/Oracle/Middleware/user_projects/domains/base_domain"
 . /path/to/setAgentEnv_AdminServer.sh
${DOMAIN_HOME}/bin/startWebLogic.sh $*</em>
      </pre></div></li>
    </ul><div class="note"><h3 class="title">Note</h3><p>If the sourcing is not properly set, the following message appears.</p><div class="screen"><pre>
<em>&lt;Error&gt; &lt;HTTP&gt; &lt;cent.example.com&gt;
&lt;AdminServer&gt; &lt;[STANDBY] ExecuteThread: '5' for queue: 'weblogic.kernel.
Default (self-tuning)'&gt; &lt;&lt;WLS Kernel&gt;&gt; &lt;&gt;&lt;&gt; &lt;&gt; &lt;1360800613441&gt;
&lt;BEA-101165&gt; &lt;Could not load user defined filter in web.xml:
ServletContext@1761850405[app:agentapp module:agentapp.war path:null
spec-version:null] com.sun.identity.agents.filter.AmAgentFilter.
java.lang.ClassNotFoundException:
com.sun.identity.agents.filter.AmAgentFilter</em>
     </pre></div></div></li><li class="step"><p>Start the WebLogic server.</p></li></ol></div><div class="procedure"><a name="protect-weblogic-apps-after-agent-installation"></a><div class="procedure-title">Procedure&nbsp;5.4.&nbsp;To Protect Applications After Agent Installation</div><ol class="procedure" type="1"><li class="step"><p>Deploy the
    <code class="filename">/path/to/j2ee_agents/weblogic_v10_agent/etc/agentapp.war</code>
    agent application in WebLogic.</p></li><li class="step"><p>For each web application to protect, add the following filter
    to the application's <code class="filename">WEB-INF/web.xml</code> deployment descriptor,
    following the opening &lt;web-app&gt; tag.</p><pre class="brush: xml;"> &lt;filter&gt;
  &lt;filter-name&gt;Agent&lt;/filter-name&gt;
  &lt;display-name&gt;Agent&lt;/display-name&gt;
  &lt;description&gt;OpenAM Policy Agent Filter&lt;/description&gt;
 &lt;filter-class&gt;com.sun.identity.agents.filter.AmAgentFilter&lt;/filter-class&gt;
 &lt;/filter&gt;
 &lt;filter-mapping&gt;
  &lt;filter-name&gt;Agent&lt;/filter-name&gt;
  &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
  &lt;dispatcher&gt;REQUEST&lt;/dispatcher&gt;
  &lt;dispatcher&gt;INCLUDE&lt;/dispatcher&gt;
  &lt;dispatcher&gt;FORWARD&lt;/dispatcher&gt;
  &lt;dispatcher&gt;ERROR&lt;/dispatcher&gt;
 &lt;/filter-mapping&gt;</pre><p>You might also have to update additional configuration files. See
    the sample application located under
    <code class="filename">/path/to/j2ee_agents/weblogic_v10_agent/sampleapp</code>
    for examples.</p></li><li class="step"><p>If you have a policy configured, you can test your policy agent.
    For example, try to browse to a resource that your policy agent protects.
    You should be redirected to OpenAM to authenticate, for example as user
    <code class="literal">demo</code>, password <code class="literal">changeit</code>. After
    you authenticate, OpenAM then redirects you back to the resource you tried
    to access.</p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="silent-weblogic-agent-installation"></a>5.3.&nbsp;Silent WebLogic Policy Agent Installation</h2></div></div></div><a class="indexterm" name="d0e2817"></a><p>When performing a scripted, silent installation, use
  <span class="command"><strong>agentadmin --install --saveResponse
  <em class="replaceable"><code>response-file</code></em></strong></span>
  to create a response file for scripted installation. Then install silently
  using <span class="command"><strong>agentadmin --install --acceptLicense --useResponse
  <em class="replaceable"><code>response-file</code></em></strong></span>.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="post-weblogic-agent-installation"></a>5.4.&nbsp;Post Installation of WebLogic Policy Agent</h2></div></div></div><a class="indexterm" name="d0e2837"></a><p>After installing WebLogic, some configuration is required before
  the policy agent will work.</p><div class="procedure"><a name="configure-weblogic-agent"></a><div class="procedure-title">Procedure&nbsp;5.5.&nbsp;To Configure the WebLogic Policy Agent</div><p>WebLogic is unique in that it requires additional configuration
   after the installation is complete.</p><ol class="procedure" type="1"><li class="step"><p>Go to the WebLogic Server Administration Console and login.</p></li><li class="step"><p>Click <code class="literal">Security realms</code>.</p></li><li class="step"><p>Click the name of the realm to use for OpenAM.</p></li><li class="step"><p>Click <code class="literal">Providers</code> &gt; <code class="literal">Authentication</code>.</p></li><li class="step"><p>Click <code class="literal">Lock &amp; Edit</code> &gt; <code class="literal">New</code>.</p></li><li class="step"><p>Enter the desired type in <code class="literal">Type as AgentAuthenticator</code>,
    provide a name, and click <code class="literal">OK</code>.</p></li><li class="step"><p>Click on the name of the agent authenticator you just created.</p></li><li class="step"><p>Use <code class="literal">OPTIONAL</code> for the control flag and save.</p></li><li class="step"><p>Click on <code class="literal">Providers</code> to display the Authentication
    Providers Table.</p></li><li class="step"><p>Click on <code class="literal">Default Authenticator</code>, use <code class="literal">OPTIONAL</code>
    for the control flag, and save.</p></li><li class="step"><p>Activate the changes once the default authenticator is done saving.</p><p>You will need to restart the WebLogic Server to implement the changes.</p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="weblogic-agents-multi-server"></a>5.5.&nbsp;Installing WebLogic Policy Agents in Multi-Server Domains</h2></div></div></div><a class="indexterm" name="d0e2920"></a><p>
   In many WebLogic domains, the administration server provides
   a central point for controlling and managing the configuration of
   the managed servers that host protected applications.
  </p><p>
   If WebLogic managed servers run on different hosts,
   you must create separate agent profiles
   and perform separate installations for each
   so that OpenAM can send notifications to the appropriate addresses.
  </p><div class="procedure"><a name="web-logic-agents-for-admin-and-managed-servers"></a><div class="procedure-title">Procedure&nbsp;5.6.&nbsp;To Install the Policy Agent on Administration &amp; Managed Servers</div><p>
    For multi-server WebLogic domains, install policy agent as follows.
   </p><ol class="procedure" type="1"><li class="step"><p>
     If servers are on different hosts, create agent profiles for each server
     where you plan to install the policy agent.
    </p><p>
     The steps are described under <a class="xref" href="#install-weblogic-agent" title="5.2.&nbsp;Installing the WebLogic Policy Agent">Section&nbsp;5.2, &#8220;Installing the WebLogic Policy Agent&#8221;</a>.
    </p></li><li class="step"><p>
     Prepare your protected web applications
     by adding the policy agent filter configuration as described in
     <a class="xref" href="#protect-weblogic-apps-after-agent-installation" title="Procedure&nbsp;5.4.&nbsp;To Protect Applications After Agent Installation">Procedure&nbsp;5.4, &#8220;To Protect Applications After Agent Installation&#8221;</a>.
    </p></li><li class="step"><p>
     Use the <span class="command"><strong>agentadmin</strong></span> command to install
     the policy agent either interactively, or silently
     on each server in the domain.
    </p><ul class="stepalternatives">
     <li class="step"><p>
       For interactive installation,
       prepare password files for the servers as described under
       <a class="xref" href="#install-weblogic-agent" title="5.2.&nbsp;Installing the WebLogic Policy Agent">Section&nbsp;5.2, &#8220;Installing the WebLogic Policy Agent&#8221;</a>.
      </p><p>
       Then install the policy agent on the servers as described in
       <a class="xref" href="#install-agent-into-weblogic" title="Procedure&nbsp;5.3.&nbsp;To Install the Policy Agent into WebLogic">Procedure&nbsp;5.3, &#8220;To Install the Policy Agent into WebLogic&#8221;</a>.
     </p></li>

     <li class="step"><p>
       For silent installation, follow the instructions in
       <a class="xref" href="#silent-weblogic-agent-installation" title="5.3.&nbsp;Silent WebLogic Policy Agent Installation">Section&nbsp;5.3, &#8220;Silent WebLogic Policy Agent Installation&#8221;</a>.
      </p></li>
    </ul></li><li class="step"><p>
     Start WebLogic, and then set up an authentication provider
     as described in <a class="xref" href="#configure-weblogic-agent" title="Procedure&nbsp;5.5.&nbsp;To Configure the WebLogic Policy Agent">Procedure&nbsp;5.5, &#8220;To Configure the WebLogic Policy Agent&#8221;</a>.
    </p></li><li class="step"><p>
     On each server in the domain, deploy the policy agent
     <code class="filename">agentapp.war</code>.
    </p></li><li class="step"><p>
     On each managed server in the domain,
     update the classpath to include policy agent .jar files.
    </p><p>
     In WebLogic Node Manager console, browse to
     Environment &gt; Servers &gt; <em class="replaceable"><code>server</code></em>
     &gt; Server Start &gt; Class Path,
     and then edit the classpath as in the following example,
     but all on a single line.
    </p><pre class="brush: shell;">/path/to/j2ee_agents/weblogic_v10_agent/lib/agent.jar:
/path/to/j2ee_agents/weblogic_v10_agent/lib/openssoclientsdk.jar:
/path/to/j2ee_agents/weblogic_v10_agent/locale:
/path/to/j2ee_agents/weblogic_v10_agent/Agent_001/config:
$CLASSPATH</pre><p>
     Replace the paths in the example with the actual paths for your domain.
    </p></li><li class="step"><p>
     Restart the managed servers.
    </p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="uninstall-weblogic-agent"></a>5.6.&nbsp;Removing WebLogic Policy Agent Software</h2></div></div></div><a class="indexterm" name="d0e2999"></a><p>Shut down the WebLogic server before you uninstall the
    policy agent.</p><p>To remove the Java EE policy agent, use <span class="command"><strong>agentadmin
  --uninstall</strong></span>. You must provide the WebLogic configuration directory
  location.</p><p>Uninstall does not remove the agent instance directory, but you can
  do so manually after removing the agent configuration from WebLogic.</p></div></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-websphere"></a>Chapter&nbsp;6.&nbsp;Installing the IBM WebSphere Policy Agent</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="section"><a href="#before-websphere-agent-install">6.1. Before You Install</a></span></dt><dt><span class="section"><a href="#install-websphere-agent">6.2. Installing the WebSphere Policy Agent</a></span></dt><dt><span class="section"><a href="#silent-websphere-agent-installation">6.3. Silent WebSphere Policy Agent Installation</a></span></dt><dt><span class="section"><a href="#uninstall-websphere-agent">6.4. Removing WebSphere Policy Agent Software</a></span></dt><dt><span class="section"><a href="#websphere-network-deployment">6.5. Notes About WebSphere Network Deployment</a></span></dt></dl></div><a class="indexterm" name="d0e3017"></a><p>This chapter covers installation of the policy agent for IBM
 WebSphere.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="before-websphere-agent-install"></a>6.1.&nbsp;Before You Install</h2></div></div></div><a class="indexterm" name="d0e3025"></a><a class="indexterm" name="d0e3030"></a><p>Make sure OpenAM is installed and running, and that you can contact OpenAM
  from the system running the policy agent. Next, create a profile for your
  policy agent as described in the <em class="citetitle">Administration Guide</em>
  section on <a class="link" href="http://openam.forgerock.org/doc/admin-guide/#create-agent-profiles" target="_blank"><em class="citetitle">Creating Agent
  Profiles</em></a>. To protect resources with the agent also create
  at least one policy as described in the section on <a class="link" href="http://openam.forgerock.org/doc/admin-guide/#configure-authz-policy" target="_blank"><em class="citetitle">Configuring
  Policies</em></a>. Consider creating a simple policy, such as a
  policy that allows only authenticated users to access your resources, in order
  to test your policy agent after installation.</p><p>You must install WebSphere before you install the policy agent, and you
  must stop the server during installation.</p><p lang="en">
 You must install a supported version of the Java runtime environment.
 See the <em class="citetitle">Release Notes</em> section,
 <a href="../jee-release-notes/index.html#java-requirements-javaee-agents" class="link"><em class="citetitle">Java EE Agents Java Requirements</em></a>,
 and set the <code class="literal">JAVA_HOME</code> environment variable accordingly.
 The policy agent installer requires Java.
</p><div class="screen"><pre>
$ <strong>echo $JAVA_HOME</strong>
<em>/path/to/java</em>
      </pre></div><p>If you are using IBM Java, see <a class="xref" href="#install-with-ibm-jvm" title="Procedure&nbsp;6.1.&nbsp;To Install With IBM Java">Procedure&nbsp;6.1, &#8220;To Install With IBM Java&#8221;</a>.</p><p lang="en">
 See the OpenAM <em class="citetitle">Installation Guide</em> section,
 <a class="link" href="http://openam.forgerock.org/doc/install-guide/#download-openam-software" target="_blank"><em class="citetitle">Obtaining OpenAM Software</em></a>
 to determine which version of the agent to download, and download the agent.
 Also verify the checksum of the file you download
 against the checksum posted on the download page.
</p><p>Unzip the file in the directory where you plan to install the J2EE
  policy agent. The agent you install stores its configuration and logs
  under this directory.</p><p>When you unzip the policy agent, you find the following directories
   under the <code class="filename">j2ee_agents/websphere_v61_agent</code> directory.</p><p lang="en">
 Despite the directory name,
 the policy agent supports multiple container versions.
 For details, see the <em class="citetitle">Release Notes</em> section,
 <a href="../jee-release-notes/index.html#jee-pa-platform-requirements" class="link"><em class="citetitle">Java EE Agents Platform Requirements</em></a>.
</p><div lang="en" class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="filename">bin</code></span></dt><dd><p>The installation and configuration program
    <span class="command"><strong>agentadmin</strong></span> and a password hashing tool
    <span class="command"><strong>crypt_util</strong></span>.</p></dd><dt><span class="term"><code class="filename">config</code></span></dt><dd><p>Configuration templates used by the <span class="command"><strong>agentadmin</strong></span>
   command during installation</p></dd><dt><span class="term"><code class="filename">data</code></span></dt><dd><p>Not used</p></dd><dt><span class="term"><code class="filename">etc</code></span></dt><dd><p>Configuration templates used during installation</p></dd><dt><span class="term"><code class="filename">installer-logs</code></span></dt><dd><p>Location for log files written during installation</p></dd><dt><span class="term"><code class="filename">legal-notices</code></span></dt><dd><p>Contains licensing information including third-party licenses</p></dd><dt><span class="term"><code class="filename">lib</code></span></dt><dd><p>Shared libraries used by the Java EE policy agent</p></dd><dt><span class="term"><code class="filename">locale</code></span></dt><dd><p>Property files used by the installation program</p></dd><dt><span class="term"><code class="filename">README</code></span></dt><dd><p>README file containing platform and install information for the agent</p></dd></dl></div><div class="procedure"><a name="install-with-ibm-jvm"></a><div class="procedure-title">Procedure&nbsp;6.1.&nbsp;To Install With IBM Java</div><a class="indexterm" name="d0e3181"></a><p>The WebSphere policy agent runs with IBM Java. In order to install
   the policy agent using IBM Java on platforms other than AIX, you must first
   change the <span class="command"><strong>agentadmin</strong></span> script to use IBMJCE.</p><ol class="procedure" type="1"><li class="step"><p>Open the file, <code class="filename">bin/agentadmin</code>
    (<code class="filename">bin/agentadmin.bat</code> on Windows), for editing.</p></li><li class="step"><p>Edit the line specifying <code class="literal">AGENT_OPTS</code> on platforms
    other than AIX.</p><pre class="literallayout">AGENT_OPTS="-DamKeyGenDescriptor.provider=IBMJCE \
 -DamCryptoDescriptor.provider=IBMJCE -DamRandomGenProvider=IBMJCE"</pre></li><li class="step"><p>Edit the last line to include the IBMJCE settings before the
    classpath is set.</p><pre class="literallayout">$JAVA_VM \
 -DamCryptoDescriptor.provider=IBMJCE -DamKeyGenDescriptor.provider=IBMJCE \
 -classpath "$AGENT_CLASSPATH" $AGENT_OPTS \
 com.sun.identity.install.tools.launch.AdminToolLauncher $*</pre></li><li class="step"><p>Save your work.</p><p>You can now install the WebSphere policy agent with IBM Java as
    described in <a class="xref" href="#install-websphere-agent" title="6.2.&nbsp;Installing the WebSphere Policy Agent">Section&nbsp;6.2, &#8220;Installing the WebSphere Policy Agent&#8221;</a>.</p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="install-websphere-agent"></a>6.2.&nbsp;Installing the WebSphere Policy Agent</h2></div></div></div><a class="indexterm" name="d0e3223"></a><p>Complete the following procedures to install the policy agent.</p><div lang="en" class="procedure"><a name="d0e3231"></a><div class="procedure-title">Procedure&nbsp;6.2.&nbsp;To Create the Agent Profile</div><p>Regardless of whether you store configurations centrally in OpenAM
        or locally with your agents, the agent requires a profile so that it can
        connect to and communicate with OpenAM.</p><ol class="procedure" type="1"><li class="step"><p>In the OpenAM console, browse to Access Control &gt;
            <em class="replaceable"><code>Realm Name</code></em> &gt; Agents &gt; J2EE,
            and then click the New... button in the Agent table.</p></li><li class="step"><p>Complete the web form using the following hints.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Name</span></dt><dd><p>The name for the agent profile used when you install the
                        agent</p></dd><dt><span class="term">Password</span></dt><dd><p>Password the agent uses to authenticate to OpenAM</p></dd><dt><span class="term">Configuration</span></dt><dd><p>Centralized configurations are stored in the OpenAM configuration
                        store. You can manage the centralized configuration through the OpenAM
                        console. Local configurations are stored in a file alongside the
                        agent.</p></dd><dt><span class="term">Server URL</span></dt><dd><p>The full URL to an OpenAM instance, or if OpenAM is deployed in
                        a site configuration (behind a load balancer) then the site URL</p><p>In centralized configuration mode, the Server URL is used to
                        populate the agent profile for services such as Login, Logout, Naming,
                        and Cross Domain SSO.</p></dd><dt><span class="term">Agent URL</span></dt><dd><p>The URL to the J2EE agent application, such as
                        <code class="literal">http://www.example.com:8080/agentapp</code></p><p>In centralized configuration mode, the Agent URL is used to
                        populate the Agent Profile for services such as notifications.</p></dd></dl></div></li></ol></div><div lang="en" class="procedure"><a name="d0e3283"></a><div class="procedure-title">Procedure&nbsp;6.3.&nbsp;To Create the Password File</div><a class="indexterm" name="d0e3286"></a><ol class="procedure" type="1"><li class="step"><p>
   Create a text file containing only the password.
  </p><div class="screen"><pre>
$ <strong>echo password &gt; /tmp/pwd.txt</strong>
  </pre></div></li><li class="step"><p>
   Protect the password file you create as appropriate for your operating system.
  </p><div class="screen"><pre>
$ <strong>chmod 400 /tmp/pwd.txt</strong>
 </pre></div></li></ol></div><div class="procedure"><a name="install-agent-into-websphere"></a><div class="procedure-title">Procedure&nbsp;6.4.&nbsp;To Install the Policy Agent into WebSphere</div><a class="indexterm" name="d0e3310"></a><ol class="procedure" type="1"><li class="step"><p>Shut down the WebSphere server where you plan to install the
    agent.</p></li><li class="step"><p>Make sure OpenAM is running.</p></li><li class="step"><p>Run <span class="command"><strong>agentadmin --install</strong></span> to install the agent.</p><p lang="en">When you run the command, you will be prompted to read and accept the
  software license agreement for the agent installation.
  You can suppress the license agreement prompt by including the
  <code class="option">--acceptLicense</code> option on the command line.
  The inclusion of the option indicates that you have read and accepted
  the terms stated in the license.
  To view the license agreement, open <code class="filename">&lt;server-root&gt;/legal-notices/license.txt</code>.
 </p><div class="screen"><pre>
$ <strong>/path/to/j2ee_agents/websphere_v61_agent/bin/agentadmin --install \
  --acceptLicense</strong>
<em>...
-----------------------------------------------
SUMMARY OF YOUR RESPONSES
-----------------------------------------------
Instance Config Directory :
/path/to/WebSphere/AppServer/profiles/AppSrv01/config/cells/wwwNode01Cell/
 nodes/wwwNode01/servers/server1

Instance Server name : server1
WebSphere Install Root Directory : /path/to/WebSphere/AppServer
OpenAM server URL : http://openam.example.com:8080/openam
Agent URL : http://www.example.com:9080/agentapp
Agent Profile name : WebSphere Agent
Agent Profile Password file name : /tmp/pwd.txt

...
SUMMARY OF AGENT INSTALLATION
-----------------------------
Agent instance name: Agent_001
Agent Bootstrap file location:
/path/to/j2ee_agents/websphere_v61_agent/Agent_001/config/
 OpenSSOAgentBootstrap.properties
Agent Configuration file location
/path/to/j2ee_agents/websphere_v61_agent/Agent_001/config/
 OpenSSOAgentConfiguration.properties
Agent Audit directory location:
/path/to/j2ee_agents/websphere_v61_agent/Agent_001/logs/audit
Agent Debug directory location:
/path/to/j2ee_agents/websphere_v61_agent/Agent_001/logs/debug


Install log file location:
/path/to/j2ee_agents/websphere_v61_agent/installer-logs/audit/install.log
...</em>
    </pre></div><p>Upon successful completion, the installer has updated the WebSphere
    configuration, copied the agent libraries to WebSphere's external library
    directory, and also set up configuration and log directories for the
    agent.</p><div class="note"><h3 class="title">Note</h3><p>If the agent is in a different domain than the server, refer to
      the <em class="citetitle">Administration Guide</em> procedure, <a class="link" href="http://openam.forgerock.org/doc/admin-guide/#chap-cdsso" target="_blank"><em class="citetitle">Configuring Cross-Domain
   Single Sign On</em></a>.</p></div></li><li class="step"><p>Take note of the configuration files and log locations.</p><p>Each agent instance that you install on the system has its own
    numbered configuration and logs directory. The first agent's configuration
    and logs are thus located under the directory
    <code class="filename">j2ee_agents/websphere_v61_agent/Agent_001/</code>.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="filename">config/OpenSSOAgentBootstrap.properties</code></span></dt><dd><p>Used to bootstrap the Java EE policy agent, allowing the agent to
       connect to OpenAM and download its configuration</p></dd><dt><span class="term"><code class="filename">config/OpenSSOAgentConfiguration.properties</code></span></dt><dd><p>Only used if you configured the Java EE policy agent to use local
       configuration</p></dd><dt><span class="term"><code class="filename">logs/audit/</code></span></dt><dd><p>Operational audit log directory, only used if remote logging
       to OpenAM is disabled</p></dd><dt><span class="term"><code class="filename">logs/debug/</code></span></dt><dd><p>Debug directory where the debug file resides. Useful in
       troubleshooting policy agent issues.</p></dd></dl></div></li><li class="step"><p>If your policy agent configuration is not in the top-level realm (/),
       then you must edit config/OpenSSOAgentBootstrap.properties to identify
       the sub-realm that has your policy agent configuration.
       Find com.sun.identity.agents.config.organization.name and change
       the / to the path to your policy agent profile. This allows the policy agent
       to properly identify itself to the OpenAM server. </p></li><li class="step"><p>Restart the WebSphere server.</p></li></ol></div><div class="procedure"><a name="protect-websphere-apps-after-agent-installation"></a><div class="procedure-title">Procedure&nbsp;6.5.&nbsp;To Protect Applications After Agent Installation</div><a class="indexterm" name="d0e3402"></a><ol class="procedure" type="1"><li class="step"><p>Deploy the
    <code class="filename">/path/to/j2ee_agents/websphere_v61_agent/etc/agentapp.war</code>
    agent application in WebSphere.</p></li><li class="step"><p>For each web application to protect, add the following filter
    to the application's <code class="filename">WEB-INF/web.xml</code> deployment descriptor,
    following the opening &lt;web-app&gt; tag.</p><pre class="brush: xml;"> &lt;filter&gt;
  &lt;filter-name&gt;Agent&lt;/filter-name&gt;
  &lt;display-name&gt;Agent&lt;/display-name&gt;
  &lt;description&gt;OpenAM Policy Agent Filter&lt;/description&gt;
 &lt;filter-class&gt;com.sun.identity.agents.filter.AmAgentFilter&lt;/filter-class&gt;
 &lt;/filter&gt;
 &lt;filter-mapping&gt;
  &lt;filter-name&gt;Agent&lt;/filter-name&gt;
  &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
  &lt;dispatcher&gt;REQUEST&lt;/dispatcher&gt;
  &lt;dispatcher&gt;INCLUDE&lt;/dispatcher&gt;
  &lt;dispatcher&gt;FORWARD&lt;/dispatcher&gt;
  &lt;dispatcher&gt;ERROR&lt;/dispatcher&gt;
 &lt;/filter-mapping&gt;</pre><p>You might also have to update additional configuration files. See
    the sample application located under
    <code class="filename">/path/to/j2ee_agents/websphere_v61_agent/sampleapp</code>
    for examples.</p></li><li class="step"><p>If you have a policy configured, you can test your policy agent.
    For example, try to browse to a resource that your policy agent protects.
    You should be redirected to OpenAM to authenticate, for example as user
    <code class="literal">demo</code>, password <code class="literal">changeit</code>. After
    you authenticate, OpenAM then redirects you back to the resource you tried
    to access.</p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="silent-websphere-agent-installation"></a>6.3.&nbsp;Silent WebSphere Policy Agent Installation</h2></div></div></div><a class="indexterm" name="d0e3438"></a><p>When performing a scripted, silent installation, use
  <span class="command"><strong>agentadmin --install --saveResponse
  <em class="replaceable"><code>response-file</code></em></strong></span>
  to create a response file for scripted installation. Then install silently
  using <span class="command"><strong>agentadmin --install --acceptLicense --useResponse
  <em class="replaceable"><code>response-file</code></em></strong></span>.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="uninstall-websphere-agent"></a>6.4.&nbsp;Removing WebSphere Policy Agent Software</h2></div></div></div><p>Shut down the WebSphere server before you uninstall the
    policy agent.</p><p>To remove the Java EE policy agent, use <span class="command"><strong>agentadmin
  --uninstall</strong></span>. You must provide the WebSphere configuration directory
  location.</p><p>Uninstall does not remove the agent instance directory, but you can
  do so manually after removing the agent configuration from WebSphere.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="websphere-network-deployment"></a>6.5.&nbsp;Notes About WebSphere Network Deployment</h2></div></div></div><a class="indexterm" name="d0e3470"></a><p>When using WebSphere Application Server Network Deployment, you must
  install policy agents on the Deployment Manager, on each Node Agent, and
  on each Application Server. Installation requires that you stop and then
  restart the Deployment Manager, each Node Agent, and each Application Server
  in the Network Deployment.</p><p>Before installation, synchronize each server configuration with the
  profile saved by the Deployment Manager using the <span class="command"><strong>syncNode</strong></span>
  command. After agent installation, copy the server configuration for each
  node, stored in <code class="filename">server.xml</code>, to the corresponding
  Deployment Manager profile. After you have synchronized the configurations,
  you must restart the Deployment Manager for the Network Deployment.</p></div></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-j2ee-agents"></a>Chapter&nbsp;7.&nbsp;Configuring Java EE Policy Agents</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="section"><a href="#gateway-or-policy-agent">7.1. Open Identity Gateway or Policy Agent?</a></span></dt><dt><span class="section"><a href="#kinds-of-agent-profiles">7.2. Kinds of Agent Profiles</a></span></dt><dt><span class="section"><a href="#configure-22-policy-agent">7.3. Configuring Version 2.2 Policy Agents</a></span></dt><dt><span class="section"><a href="#create-agent-profiles">7.4. Creating Agent Profiles</a></span></dt><dt><span class="section"><a href="#delegate-agent-profile-creation">7.5. Delegating Agent Profile Creation</a></span></dt><dt><span class="section"><a href="#configure-j2ee-policy-agent">7.6. Configuring Java EE Policy Agents</a></span></dt><dt><span class="section"><a href="#configure-agent-auth">7.7. Configuring Agent Authenticators</a></span></dt></dl></div><a class="indexterm" name="d0e3489"></a><p> You install policy agents in web servers and web application containers
  to enforce access policies OpenAM applies to protected web sites and web
  applications. Policy agents depend on OpenAM for all authentication and
  authorization decisions. Their primary responsibility consists in enforcing
  what OpenAM decides in a way that is unobtrusive to the user. In organizations
  with many servers, you might well install many policy agents.</p><p>Policy agents can have local configurations where they are installed,
  but usually you store all policy agent configuration information in the
  OpenAM configuration store, defining policy agent profiles for each, and then
  you let the policy agents access their profiles through OpenAM such that you
  manage all agent configuration changes centrally. This chapter describes how
  to set up policy agent profiles in OpenAM for centralized configuration.</p><div lang="en" class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="gateway-or-policy-agent"></a>7.1.&nbsp;Open Identity Gateway or Policy Agent?</h2></div></div></div><a class="indexterm" name="d0e3502"></a><p>OpenAM includes both the
  <a class="link" href="http://openig.forgerock.org/" target="_blank">Open Identity
  Gateway (OpenIG)</a> and also a variety of policy agents.
  Both OpenIG
  and also the policy agents enforce policy, redirecting users to authenticate
  when necessary, and controlling access to protected resources. Yet, the
  Identity Gateway runs as a self-contained reverse proxy located between the
  users and the protected applications. Policy agents are installed into the
  servers where applications run, intercepting requests in that context.</p><p>The OpenIG allows you to protect access to applications not
  suited for a policy agent. Not all web servers and Java EE applications have
  policy agents. Not all operating systems work with policy agents.</p><p>Policy agents have the advantage, where you can install them,
  of sitting within your existing server infrastructure. Once you have
  agents installed into the servers with web applications or sites to protect,
  then you can manage their configurations centrally from OpenAM.</p><p>Of course, for organizations with both servers where you can install
  policy agents and also applications that you must protect without touching
  the server, you can use policy agents on the former and the OpenIG
  for the latter.</p></div><div lang="en" class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="kinds-of-agent-profiles"></a>7.2.&nbsp;Kinds of Agent Profiles</h2></div></div></div><a class="indexterm" name="d0e3520"></a><p>When you open the OpenAM console to configure agents for the top level
  realm, you can choose from a number of different types of agents. Web and J2EE policy
  agents are the most common, requiring the least integration effort.</p><a class="indexterm" name="d0e3527"></a><div class="variablelist"><dl class="variablelist"><dt><span class="term">Web</span></dt><dd><p>You install web agents in web servers to protect web sites.</p></dd><dt><span class="term">J2EE</span></dt><dd><p>You install J2EE agents in web application containers to protect
     web applications.</p></dd><dt><span class="term">Web Service Provider</span></dt><dd><p>WSP agents are for use with Web Services Security.</p></dd><dt><span class="term">Web Service Client</span></dt><dd><p>WSC agents are for use with Web Services Security.</p></dd><dt><span class="term">STS Client</span></dt><dd><p>The Security Token Service client agent is for securing
     requests to the Security Token Service.</p></dd><dt><span class="term">2.2 Agents</span></dt><dd><p>Version 2.2 web and Java EE policy agents hold their configuration
     locally, connecting to OpenAM with a user name, password combination.
     This kind of agent is provided for backwards compatibility.</p></dd><dt><span class="term">OAuth 2.0 Client Agent</span></dt><dd><p>OAuth 2.0 clients are registered using this type of policy agent
     profile.</p></dd><dt><span class="term">Agent Authenticator</span></dt><dd><p>The agent authenticator can read agent profiles by connecting
     to OpenAM with a user name, password combination, but unlike the
     agent profile administrator, cannot change agent configuration.</p></dd></dl></div></div><div lang="en" class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="configure-22-policy-agent"></a>7.3.&nbsp;Configuring Version 2.2 Policy Agents</h2></div></div></div><a class="indexterm" name="d0e3585"></a><p>This section covers version 2.2 agent properties. Version 2.2 agents
  store their configurations locally, with a user name, password combination
  used to connect to OpenAM.</p><div class="warning"><h3 class="title">Warning</h3><p>ForgeRock no longer supports 2.2 agents. Documentation exists only for
   legacy systems. Do not use 2.2 policy agents for new deployments.
  </p></div><p>After creating the agent profile, you access agent properties in the
  OpenAM console under Access Control &gt; <em class="replaceable"><code>Realm Name</code></em>
  &gt; Agents &gt; 2.2 Agents &gt; <em class="replaceable"><code>Agent Name</code></em>.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Password</span></dt><dd><p>Specifies the password the agent uses to connect to OpenAM.</p></dd><dt><span class="term">Status</span></dt><dd><p>Specifies whether the agent profile is active, and so can be
     used.</p></dd><dt><span class="term">Description</span></dt><dd><p>Specifies a short description for the agent.</p></dd><dt><span class="term">Agent Key Value(s)</span></dt><dd><p>Additional key-value pairs that OpenAM uses to receive agent
     requests concerning credential assertions.</p><p>OpenAM currently supports one property,
     <code class="literal">agentRootURL=<em class="replaceable"><code>protocol</code></em>://<em class="replaceable"><code>host</code></em>:<em class="replaceable"><code>port</code></em>/</code>
     where the key is case-sensitive.</p></dd></dl></div></div><div lang="en" class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="create-agent-profiles"></a>7.4.&nbsp;Creating Agent Profiles</h2></div></div></div><a class="indexterm" name="d0e3646"></a><p>This section concerns creating agent profiles, and creating groups
  that let agents inherit settings when you have many agents with nearly
  the same profile settings.</p><div class="procedure"><a name="create-agent-profile"></a><div class="procedure-title">Procedure&nbsp;7.1.&nbsp;To Create an Agent Profile</div><p>To create a new Java EE policy agent profile, you need a name and
   password for the agent, and the URLs to OpenAM and the application to
   protect.</p><ol class="procedure" type="1"><li class="step"><p>On the Access Control tab page of the OpenAM console, click the link
    for the realm in which you manage agents.</p></li><li class="step"><p>Click the Agents tab, click the tab page for the kind of agent you
    want to create, and then click the New... button in the Agent table.</p></li><li class="step"><p>Provide a name for the agent, and also the URLs to OpenAM and to
    the application to protect, then click Create.
    Note that for Java EE policy agents, an example URL must include
    the <code class="literal">agentapp</code> context:
    <code class="uri">http://www.example.com:8080/agentapp</code>.
   </p><div class="mediaobject" align="center"><a name="figure-create-agent"></a><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/create-agent.png" align="middle" height="360" alt="Creating a new agent profile"></td></tr></table><div class="longdesc-link" align="right"><br clear="all"><span class="longdesc-link">[<a href="figure-create-agent.html" target="longdesc">D</a>]</span></div></div></li><li class="step"><p>After creating the agent profile, you can click the link to the
    new profile to adjust and export the configuration.</p></li></ol></div><div class="procedure"><a name="create-agent-group"></a><div class="procedure-title">Procedure&nbsp;7.2.&nbsp;To Create an Agent Profile Group &amp; Inherit Settings</div><a class="indexterm" name="d0e3689"></a><p>Agent profile groups let you set up multiple agents to inherit
   settings from the group. To create a new Java EE agent profile group,
   you need a name and the URL to the OpenAM server in which you store the
   profile.</p><ol class="procedure" type="1"><li class="step"><p>On the Access Control tab page of the OpenAM console, click the link
    for the realm in which you manage agents.</p></li><li class="step"><p>Click the Agents tab, click the tab page for the kind of agent you
    want to create, and then click the New... button in the Group table.</p><p>After creating the group profile, you can click the link to the new
    group profile to fine-tune or export the configuration.</p></li><li class="step"><p>Inherit group settings by selecting your agent profile, and then
    selecting the group name in the Group drop-down list near the top of
    the profile page.</p><p>You can then adjust inheritance by clicking Inheritance Settings
    on the agent profile page.</p></li></ol></div><div class="procedure"><a name="create-agent-profile-cli"></a><div class="procedure-title">Procedure&nbsp;7.3.&nbsp;To Create an Agent Profile Using the Command Line</div><p>You can create a policy agent profile in OpenAM using the
   <span class="command"><strong>ssoadm</strong></span> command-line tool. You do so by specifying
   the agent properties either as a list of attributes, or by using an
   agent properties file as shown below. Export an existing policy
   agent configuration before you start to see what properties you
   want to set when creating the agent profile.</p><p>The following procedure demonstrates creating a policy agent
   profile using the <span class="command"><strong>ssoadm</strong></span> command.</p><ol class="procedure" type="1"><li class="step"><p>Make sure the <span class="command"><strong>ssoadm</strong></span> command is installed as
    described in the <em class="citetitle">Installation Guide</em> procedure,
    <span class="olink"><em class="citetitle">To Set Up
     Administration Tools</em></span>.</p></li><li class="step"><p>Determine the list of properties to set in the agent profile.</p><p>The following properties file shows a minimal configuration for a
    policy agent profile.</p><div class="screen"><pre>
$ <strong>cat myAgent.properties</strong>
com.sun.identity.agents.config.agenturi.prefix=http://www.example.com:80/amagent
com.sun.identity.agents.config.cdsso.cdcservlet.url[0]=https://openam.example.com:8443/
  openam/cdcservlet
com.sun.identity.agents.config.fqdn.default=www.example.com
com.sun.identity.agents.config.login.url[0]=http://openam.example.com:8443/
  openam/UI/Login
com.sun.identity.agents.config.logout.url[0]=http://openam.example.com:8443/
  openam/UI/Logout
com.sun.identity.agents.config.remote.logfile=amAgent_www_example_com_80.log
com.sun.identity.agents.config.repository.location=centralized
com.sun.identity.client.notification.url=http://www.example.com:80/
  UpdateAgentCacheServlet?shortcircuit=false
com.sun.identity.client.notification.url=http://www.example.com:80/
  UpdateAgentCacheServlet?shortcircuit=false
sunIdentityServerDeviceKeyValue[0]=agentRootURL=http://www.example.com:80/
sunIdentityServerDeviceStatus=Active
userpassword=password
    </pre></div></li><li class="step"><p>Set up a password file used when authenticating to OpenAM.
    The password file must be read-only for the user who creates the policy
    agent profile, and must not be accessible to other users.
   </p><div class="screen"><pre>
    $ <strong>echo password &gt; /tmp/pwd.txt</strong>
    $ <strong>chmod 400 /tmp/pwd.txt</strong>
   </pre></div></li><li class="step"><p>Create the profile in OpenAM.</p><div class="screen"><pre>
    $ <strong>ssoadm \
    create-agent \
    --realm / \
    --agentname myAgent \
    --agenttype J2EE \
    --adminid amadmin
    --password-file /tmp/pwd.txt \
    --datafile myAgent.properties</strong>

    <em>Agent configuration was created.</em>
   </pre></div><p>At this point you can view the profile in OpenAM Console under
    Access Control &gt; <em class="replaceable"><code>Realm Name</code></em> &gt; Agents to make
    sure the configuration is what you expect.</p></li></ol></div></div><div lang="en" class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="delegate-agent-profile-creation"></a>7.5.&nbsp;Delegating Agent Profile Creation</h2></div></div></div><a class="indexterm" name="d0e3777"></a><p>If you want to create policy agent profiles when installing policy
  agents, then you need the credentials of an OpenAM user who can read and
  write agent profiles.</p><p>You can use the OpenAM administrator account when creating policy agent
  profiles. If however you delegate policy agent installation, then you might
  not want to share OpenAM administrator credentials with everyone who
  installs policy agents.</p><div class="procedure"><a name="create-agent-administrators"></a><div class="procedure-title">Procedure&nbsp;7.4.&nbsp;To Create Agent Administrators for a Realm</div><a class="indexterm" name="d0e3789"></a><p>Follow these steps to create <em class="firstterm">agent administrator</em>
   users for a realm.</p><ol class="procedure" type="1"><li class="step"><p>In OpenAM console, browse to Access Control &gt; <em class="replaceable"><code>Realm
    Name</code></em> &gt; Subjects.</p></li><li class="step"><p>Under Group click New... and create a group for agent
    administrators.</p></li><li class="step"><p>Switch to the Privileges tab for the realm, and click the name of the
    group you created.</p></li><li class="step"><p>Select "Read and write access to all configured Agents," and then
    Save your work.</p></li><li class="step"><p>Return to the Subjects tab, and under User create as many agent
    administrator users as needed.</p></li><li class="step"><p>For each agent administrator user, edit the user profile.</p><p>Under the Group tab of the user profile, add the user to agent
    profile administrator group, and then Save your work.</p></li><li class="step"><p>Provide each system administrator who installs policy agents with
    their agent administrator credentials.</p><p>When installing the policy agent with the
    <code class="option">--custom-install</code> option, the system administrator can
    choose the option to create the profile during installation, and then
    provide the agent administrator user name and the path to a read-only
    file containing the agent administrator password. For silent installs,
    you can add the <code class="option">--acceptLicense</code> option to auto-accept the
    software license agreement. </p></li></ol></div></div><div lang="en" class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="configure-j2ee-policy-agent"></a>7.6.&nbsp;Configuring Java EE Policy Agents</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#configure-j2ee-pa-global-props">7.6.1. Configuring Java EE Policy Agent Global Properties</a></span></dt><dt><span class="section"><a href="#configure-j2ee-pa-application-props">7.6.2. Configuring Java EE policy agent Application Properties</a></span></dt><dt><span class="section"><a href="#configure-j2ee-pa-sso-props">7.6.3. Configuring Java EE policy agent SSO Properties</a></span></dt><dt><span class="section"><a href="#configure-j2ee-pa-services-props">7.6.4. Configuring Java EE policy agent OpenAM Services Properties</a></span></dt><dt><span class="section"><a href="#configure-j2ee-pa-misc-props">7.6.5. Configuring Java EE policy agent Miscellaneous Properties</a></span></dt><dt><span class="section"><a href="#configure-j2ee-pa-advanced-props">7.6.6. Configuring Java EE policy agent Advanced Properties</a></span></dt></dl></div><a class="indexterm" name="d0e3839"></a><p>When you create a Java EE policy agent profile and install the agent,
  you can choose to store the agent configuration centrally and configure
  the agent through OpenAM console. Alternatively, you can choose to store
  the agent configuration locally and configure the agent by changing
  values in the properties file. This section covers centralized configuration,
  indicating the corresponding properties for use in a local configuration
  file where applicable.

  <a href="#ftn.d0e3846" class="footnote" name="d0e3846"><sup class="footnote">[2]</sup></a></p><div class="tip"><h3 class="title">Tip</h3><p>To show the agent properties in configuration file format that
   correspond to what you see in the console, click Export Configuration
   after editing agent properties.</p></div><p>After changing properties specified as "Hot swap: no" you must
  restart the application server or web server, or the agent's container.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="configure-j2ee-pa-global-props"></a>7.6.1.&nbsp;Configuring Java EE Policy Agent Global Properties</h3></div></div></div><p>This section covers global Java EE agent properties. After creating the
   agent profile, you access these properties in the OpenAM console under
   Access Control &gt; <em class="replaceable"><code>Realm Name</code></em> &gt; Agents &gt;
   Java EE &gt; <em class="replaceable"><code>Agent Name</code></em> &gt; Global.</p><div class="variablelist"><a name="j2ee-agent-profile-properties"></a><div class="variablelist-title">Profile properties</div><dl class="variablelist"><dt><span class="term">Group</span></dt><dd><p>For assigning the agent to a previously configured Java EE agent group
      in order to inherit selected properties from the group.</p></dd><dt><span class="term">Password</span></dt><dd><p>Agent password used when creating the password file and when
      installing the agent.</p></dd><dt><span class="term">Status</span></dt><dd><p>Status of the agent configuration.</p></dd><dt><span class="term">Agent Notification URL</span></dt><dd><p>URL used by agent to register notification listeners.</p><p>Property: <code class="literal">com.sun.identity.client.notification.url</code></p><p>Hot swap: no</p></dd><dt><span class="term">Location of Agent Configuration Repository</span></dt><dd><p>Indicates agent's configuration located either on agent's host or
      centrally on OpenAM server.</p><p>If you change this to a local configuration, you can no longer
      manage the policy agent configuration through OpenAM console.</p><p>Property: <code class="literal">com.sun.identity.agents.config.repository.location</code></p></dd><dt><span class="term">Configuration Reload Interval</span></dt><dd><p>Interval in seconds to fetch agent configuration from OpenAM. Used
      if notifications are disabled. Default: 0</p><p>Property: <code class="literal">com.sun.identity.agents.config.load.interval</code></p></dd><dt><span class="term">Agent Configuration Change Notification</span></dt><dd><p>Enable agent to receive notification messages from OpenAM server for
      configuration changes.</p><p>Property: <code class="literal">com.sun.identity.agents.config.change.notification.enable</code></p></dd><dt><span class="term">Agent Root URL for CDSSO</span></dt><dd><p>The agent root URL for CDSSO. The valid value is in the format
      <code class="literal"><em class="replaceable"><code>protocol</code></em>://<em class="replaceable"><code>hostname</code></em>:<em class="replaceable"><code>port</code></em>/</code>
      where <em class="replaceable"><code>protocol</code></em> represents the protocol used,
      such as <code class="literal">http</code> or <code class="literal">https</code>,
      <em class="replaceable"><code>hostname</code></em> represents the host name of the
      system where the agent resides, and <em class="replaceable"><code>port</code></em>
      represents the port number on which the agent is installed.
      The slash following the port number is required.</p><p>If your agent system also has virtual host names, add URLs with
      the virtual host names to this list as well. OpenAM checks that
      <code class="literal">goto</code> URLs match one of the agent root URLs for
      CDSSO.</p></dd></dl></div><div class="variablelist"><a name="j2ee-agent-general-properties"></a><div class="variablelist-title">General properties</div><dl class="variablelist"><dt><span class="term">Agent Filter Mode</span></dt><dd><p>Specifies how the agent filters requests to protected web
      applications. The global value functions as a default, and applies for
      protected applications that do not have their own filter settings.
      Valid settings include the following.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">ALL</code></span></dt><dd><p>Enforce both the Java EE policy defined for the web container where
         the protected application runs, and also OpenAM policies.</p><p>When setting the filter mode to <code class="literal">ALL</code>, set the
         Map Key, but do not set any Corresponding Map Value.</p></dd><dt><span class="term"><code class="literal">J2EE_POLICY</code></span></dt><dd><p>Enforce only the J2EE policy defined for the web container where
         the protected application runs.</p></dd><dt><span class="term"><code class="literal">NONE</code></span></dt><dd><p>Do not enforce policies to protect resources. In other words,
         turn off access management. Not for use in production.</p></dd><dt><span class="term"><code class="literal">SSO_ONLY</code></span></dt><dd><p>Enforce only authentication, not policies.</p></dd><dt><span class="term"><code class="literal">URL_POLICY</code></span></dt><dd><p>Enforce only URL resource-based policies defined in OpenAM.</p><p>When setting the filter mode to <code class="literal">URL_POLICY</code>,
         set the Map Key to the application name and the Corresponding Map
         Value to <code class="literal">URL_POLICY</code>.</p></dd></dl></div><p>Property: <code class="literal">com.sun.identity.agents.config.filter.mode</code></p><p>Hot swap: no</p></dd><dt><span class="term">HTTP Session Binding</span></dt><dd><p>When enabled the agent invalidates the HTTP session upon login
      failure, when the user has no SSO session, or when the principal user
      name does not match the SSO user name.</p><p>Property: <code class="literal">com.sun.identity.agents.config.httpsession.binding</code></p></dd><dt><span class="term">Login Attempt Limit</span></dt><dd><p>When set to a value other than zero, this defines the maximum
      number of failed login attempts allowed during a single browser session,
      after which the agent blocks requests from the user.</p><p>Property: <code class="literal">com.sun.identity.agents.config.login.attempt.limit</code></p></dd><dt><span class="term">Custom Response Header</span></dt><dd><p>Specifies the custom headers the agent sets for the client. The
      key is the header name. The value is the header value.</p><p>Property: <code class="literal">com.sun.identity.agents.config.response.header</code></p><p>For example,
      <code class="literal">com.sun.identity.agents.config.response.header[Cache-Control]=no-cache</code>.</p></dd><dt><span class="term">Redirect Attempt Limit</span></dt><dd><p>When set to a value other than zero, this defines the maximum number
      of redirects allowed for a single browser session, after which the agent
      blocks the request.</p><p>Property: <code class="literal">com.sun.identity.agents.config.redirect.attempt.limit</code></p></dd><dt><span class="term">Agent Debug Level</span></dt><dd><p>Default is <code class="literal">Error</code>. Increase to
      <code class="literal">Message</code> for fine-grained detail.</p><p>Property: <code class="literal">com.iplanet.services.debug.level</code></p></dd></dl></div><div class="variablelist"><a name="j2ee-user-mapping-properties"></a><div class="variablelist-title">User Mapping properties</div><dl class="variablelist"><dt><span class="term">User Mapping Mode</span></dt><dd><p>Specifies the mechanism used to determine the user ID.</p><p>Property: <code class="literal">com.sun.identity.agents.config.user.mapping.mode</code></p></dd><dt><span class="term">User Attribute Name</span></dt><dd><p>Specifies the data store attribute that contains the user ID.</p><p>Property: <code class="literal">com.sun.identity.agents.config.user.attribute.name</code></p></dd><dt><span class="term">User Principal Flag</span></dt><dd><p>When enabled, OpenAM uses both the principal user name and also the
      user ID for authentication.</p><p>Property: <code class="literal">com.sun.identity.agents.config.user.principal</code></p></dd><dt><span class="term">User Token Name</span></dt><dd><p>Specifies the session property name for the authenticated user's
      ID. Default: <code class="literal">UserToken</code>.</p><p>Property: <code class="literal">com.sun.identity.agents.config.user.token</code></p></dd></dl></div><div class="variablelist"><a name="j2ee-agent-audit-properties"></a><div class="variablelist-title">Audit properties</div><dl class="variablelist"><dt><span class="term">Audit Access Types</span></dt><dd><p>Types of messages to log based on user URL access attempts.</p><p>Property: <code class="literal">com.sun.identity.agents.config.audit.accesstype</code></p><p>Valid values for the configuration file property include
      <code class="literal">LOG_NONE</code>, <code class="literal">LOG_ALLOW</code>,
      <code class="literal">LOG_DENY</code>, and <code class="literal">LOG_BOTH</code>.</p></dd><dt><span class="term">Audit Log Location</span></dt><dd><p>Specifies where audit messages are logged. By default, audit
      messages are logged remotely.</p><p>Property: <code class="literal">com.sun.identity.agents.config.log.disposition</code></p><p>Valid values for the configuration file property include
      <code class="literal">REMOTE</code>, <code class="literal">LOCAL</code>, and
      <code class="literal">ALL</code>.</p></dd><dt><span class="term">Remote Log Filename</span></dt><dd><p>Name of file stored on OpenAM server that contains agent audit
      messages if log location is remote or all.</p><p>Property: <code class="literal">com.sun.identity.agents.config.remote.logfile</code></p><p>Hot swap: no</p></dd><dt><span class="term">Rotate Local Audit Log</span></dt><dd><p>When enabled, audit log files are rotated when reaching the
      specified size.</p><p>Property: <code class="literal">com.sun.identity.agents.config.local.log.rotate</code></p></dd><dt><span class="term">Local Audit Log Rotation Size</span></dt><dd><p>Beyond this size limit in bytes the agent rotates the local audit
      log file if rotation is enabled.</p><p>Property: <code class="literal">com.sun.identity.agents.config.local.log.size</code></p><p>Default: 50 MB</p></dd></dl></div><div class="variablelist"><a name="j2ee-agent-fqdn-properties"></a><div class="variablelist-title">Fully Qualified Domain Name Checking properties</div><dl class="variablelist"><dt><span class="term">FQDN Check</span></dt><dd><p>Enables checking of FQDN default value and FQDN map values.</p><p>Property: <code class="literal">com.sun.identity.agents.config.fqdn.check.enable</code></p></dd><dt><span class="term">FQDN Default</span></dt><dd><p>Fully qualified domain name that the users should use in order to
      access resources.</p><p>This property ensures that when users access protected resources
      on the web server without specifying the FQDN, the agent can redirect
      the users to URLs containing the correct FQDN.</p><p>Property: <code class="literal">com.sun.identity.agents.config.fqdn.default</code></p></dd><dt><span class="term">FQDN Virtual Host Map</span></dt><dd><p>Enables virtual hosts, partial hostname and IP address to access
      protected resources. Maps invalid or virtual name keys to valid FQDN
      values so the agent can properly redirect users and the agents receive
      cookies belonging to the domain.</p><p>To map <code class="literal">myserver</code> to
      <code class="literal">myserver.mydomain.example</code>, enter
      <code class="literal">myserver</code> in the Map Key field, and enter
      <code class="literal">myserver.mydomain.example</code> in the Corresponding Map Value
      field. This corresponds to
      <code class="literal">com.sun.identity.agents.config.fqdn.mapping[myserver]= myserver.mydomain.example</code>.</p><p>Property: <code class="literal">com.sun.identity.agents.config.fqdn.mapping</code></p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="configure-j2ee-pa-application-props"></a>7.6.2.&nbsp;Configuring Java EE policy agent Application Properties</h3></div></div></div><p>This section covers application J2EE agent properties. After creating
   the agent profile, you access these properties in the OpenAM console under
   Access Control &gt; <em class="replaceable"><code>Realm Name</code></em> &gt; Agents &gt;
   J2EE &gt; <em class="replaceable"><code>Agent Name</code></em> &gt; Application.</p><div class="variablelist"><a name="j2ee-agent-login-processing-properties"></a><div class="variablelist-title">Login Processing properties</div><dl class="variablelist"><dt><span class="term">Login Form URI</span></dt><dd><p>Specifies the list of absolute URIs corresponding to a protected
      application's <code class="filename">web.xml</code>
      <code class="literal">form-login-page</code> element, such as
      <code class="literal">/myApp/jsp/login.jsp</code>.</p><p>Property: <code class="literal">com.sun.identity.agents.config.login.form</code></p></dd><dt><span class="term">Login Error URI</span></dt><dd><p>Specifies the list of absolute URIs corresponding to a protected
      application's <code class="filename">web.xml</code>
      <code class="literal">form-error-page</code> element, such as
      <code class="literal">/myApp/jsp/error.jsp</code>.</p><p>Property: <code class="literal">com.sun.identity.agents.config.login.error.uri</code></p></dd><dt><span class="term">Use Internal Login</span></dt><dd><p>When enabled, the agent uses the internal default content file
      for the login.</p><p>Property: <code class="literal">com.sun.identity.agents.config.login.use.internal</code></p></dd><dt><span class="term">Login Content File Name</span></dt><dd><p>Full path name to the file containing custom login content when
      Use Internal Login is enabled.</p><p>Property: <code class="literal">com.sun.identity.agents.config.login.content.file</code></p></dd></dl></div><div class="variablelist"><a name="j2ee-agent-logout-processing-properties"></a><div class="variablelist-title">Logout Processing properties</div><dl class="variablelist"><dt><span class="term">Application Logout Handler</span></dt><dd><p>Specifies how logout handlers map to specific applications. The key
      is the web application name. The value is the logout handler class.</p><p>To set a global logout handler for applications without other
      logout handlers defined, leave the key empty and set the value to the
      global logout handler class name,
      <code class="literal">GlobalApplicationLogoutHandler</code>.</p><p>To set a logout handler for a specific application, set the key
      to the name of the application, and the value to the logout handler class
      name.</p><p>Property: <code class="literal">com.sun.identity.agents.config.logout.application.handler</code></p></dd><dt><span class="term">Application Logout URI</span></dt><dd><p>Specifies request URIs that indicate logout events. The key is the
      web application name. The value is the application logout URI.</p><p>To set a global logout URI for applications without other logout
      URIs defined, leave the key empty and set the value to the global logout
      URI, <code class="literal">/logout.jsp</code>.</p><p>To set a logout URI for a specific application, set the key to the
      name of the application, and the value to the application logout
      page.</p><p>Property: <code class="literal">com.sun.identity.agents.config.logout.uri</code></p></dd><dt><span class="term">Logout Request Parameter</span></dt><dd><p>Specifies parameters in the HTTP request that indicate logout
      events. The key is the web application name. The value is the logout
      request parameter.</p><p>To set a global logout request parameter for applications without
      other logout request parameters defined, leave the key empty and set the
      value to the global logout request parameter,
      <code class="literal">logoutparam</code>.</p><p>To set a logout request parameter for a specific application, set
      the key to the name of the application, and the value to the application
      logout request parameter, such as <code class="literal">logoutparam</code>.</p><p>Property: <code class="literal">com.sun.identity.agents.config.logout.request.param</code></p></dd><dt><span class="term">Logout Introspect Enabled</span></dt><dd><p>When enabled, the agent checks the HTTP request body to locate the
      Logout Request Parameter you set.</p><p>Property: <code class="literal">com.sun.identity.agents.config.logout.introspect.enabled</code></p></dd><dt><span class="term">Logout Entry URI</span></dt><dd><p>Specifies the URIs to return after successful logout and subsequent
      authentication. The key is the web application name. The value is the
      URI to return.</p><p>To set a global logout entry URI for applications without other
      logout entry URIs defined, leave the key empty and set the value to the
      global logout entry URI, <code class="literal">/welcome.html</code>.</p><p>To set a logout entry URI for a specific application, set the key
      to the name of the application, and the value to the application
      logout entry URI, such as <code class="literal">/myApp/welcome.html</code>.</p><p>Property: <code class="literal">com.sun.identity.agents.config.logout.entry.uri</code></p></dd></dl></div><div class="variablelist"><a name="j2ee-agent-access-denied-uri-processing-properties"></a><div class="variablelist-title">Access Denied URI Processing properties</div><dl class="variablelist"><dt><span class="term">Resource Access Denied URI</span></dt><dd><p>Specifies the URIs of custom pages to return when access is denied.
      The key is the web application name. The value is the custom URI.</p><p>To set a global custom access denied URI for applications without
      other custom access denied URIs defined, leave the key empty and set the
      value to the global custom access denied URI,
      <code class="literal">/sample/accessdenied.html</code>.</p><p>To set a custom access denied URI for a specific application, set
      the key to the name of the application, and the value to the application
      access denied URI, such as <code class="literal">/myApp/accessdenied.html</code>.</p><p>Property: <code class="literal">com.sun.identity.agents.config.access.denied.uri</code></p></dd></dl></div><div class="variablelist"><a name="j2ee-agent-not-enforced-uri-properties"></a><div class="variablelist-title">Not Enforced URI Processing properties</div><dl class="variablelist"><dt><span class="term">Not Enforced URIs</span></dt><dd><p>List of URIs for which no authentication is required, and the agent
      does not protect access. You can use wildcards to define a pattern for a
      URI.</p><p>The <code class="literal">*</code> wildcard matches all characters except
      question mark (<code class="literal">?</code>), cannot be escaped, and spans
      multiple levels in a URI. Multiple forward slashes do not match a
      single forward slash, so <code class="literal">*</code> matches
      <code class="literal">mult/iple/dirs</code>, yet <code class="literal">mult/*/dirs</code>
      does not match <code class="literal">mult/dirs</code>.</p><p>The <code class="literal">-*-</code> wildcard matches all characters except
      forward slash (<code class="literal">/</code>) or question mark
      (<code class="literal">?</code>), and cannot be escaped. As it does not match
      <code class="literal">/</code>, <code class="literal">-*-</code> does not span multiple
      levels in a URI.</p><p>OpenAM does not let you mix <code class="literal">*</code> and
      <code class="literal">-*-</code> in the same URI.</p><p>Examples include <code class="literal">/logout.html</code>,
      <code class="literal">/images/*</code>, <code class="literal">/css/-*-</code>, and
      <code class="literal">/*.jsp?locale=*</code>.</p><p>Trailing forward slashes are not recognized as part of a resource
      name. Therefore <code class="literal">/images//</code> and
      <code class="literal">/images</code> are equivalent.</p><p>Property: <code class="literal">com.sun.identity.agents.config.notenforced.uri</code></p></dd><dt><span class="term">Invert Not Enforced URIs</span></dt><dd><p>Only enforce not enforced list of URIs. In other words, enforce
      policy only for those URIs and patterns specified in the list.</p><p>Property: <code class="literal">com.sun.identity.agents.config.notenforced.uri.invert</code></p></dd><dt><span class="term">Not Enforced URIs Cache Enabled</span></dt><dd><p>When enabled, the agent caches evaluation of the not enforced URI
      list.</p><p>Property: <code class="literal">com.sun.identity.agents.config.notenforced.uri.cache.enable</code></p></dd><dt><span class="term">Not Enforced URIs Cache Size</span></dt><dd><p>When caching is enabled, this limits the number of not enforced
      URIs cached.</p><p>Property: <code class="literal">com.sun.identity.agents.config.notenforced.uri.cache.size</code></p><p>Default: 1000</p></dd><dt><span class="term">Refresh Session Idle Time</span></dt><dd><p>When enabled, the agent reset the session idle time when granting
      access to a not enforced URI, prolonging the time before the user must
      authenticate again.</p><p>Property: <code class="literal">com.sun.identity.agents.config.notenforced.refresh.session.idletime</code></p></dd></dl></div><div class="variablelist"><a name="j2ee-agent-not-enforced-ip-properties"></a><div class="variablelist-title">Not Enforced IP Processing properties</div><dl class="variablelist"><dt><span class="term">Not Enforced Client IP List</span></dt><dd><p>No authentication and authorization are required for the requests
      coming from these client IP addresses.</p><p>Property: <code class="literal">com.sun.identity.agents.config.notenforced.ip</code></p><div class="note"><h3 class="title">Note</h3><p>
       Loopback addresses are not considered valid IPs on the Not Enforced IP list.
       If specified, the policy agent ignores the loopback address.
      </p></div></dd><dt><span class="term">Not Enforced IP Invert List</span></dt><dd><p>Only enforce the not enforced list of IP addresses. In other words,
      enforce policy only for those client addresses and patterns specified in
      the list.</p><p>Property: <code class="literal">com.sun.identity.agents.config.notenforced.ip.invert</code></p></dd><dt><span class="term">Not Enforced IP Cache Flag</span></dt><dd><p>When enabled, the agent caches evaluation of the not enforced IP
      list.</p><p>Property: <code class="literal">com.sun.identity.agents.config.notenforced.ip.cache.enable</code></p></dd><dt><span class="term">Not Enforced IP Cache Size</span></dt><dd><p>When caching is enabled, this limits the number of not enforced
      addresses cached.</p><p>Property: <code class="literal">com.sun.identity.agents.config.notenforced.ip.cache.size</code></p><p>Default: 1000</p></dd></dl></div><div class="variablelist"><a name="j2ee-agent-profile-attributes-processing-properties"></a><div class="variablelist-title">Profile Attributes Processing properties</div><dl class="variablelist"><dt><span class="term">Profile Attribute Fetch Mode</span></dt><dd><p>When set to <code class="literal">HTTP_COOKIE</code> or
      <code class="literal">HTTP_HEADER</code>, profile attributes are introduced into
      the cookie or the headers, respectively. When set to
      <code class="literal">REQUEST_ATTRIBUTE</code>, profile attributes are part
      of the HTTP request.</p><p>Property: <code class="literal">com.sun.identity.agents.config.profile.attribute.fetch.mode</code></p></dd><dt><span class="term">Profile Attribute Map</span></dt><dd><p>Maps the profile attributes to HTTP headers for the currently
      authenticated user. Map Keys are attribute names, and Map Values
      are HTTP header names. The user profile can be stored in LDAP or any
      other arbitrary data store.
     </p><p>To populate the value of profile attribute CN under
      <code class="literal">CUSTOM-Common-Name</code>: enter CN in the Map Key field,
      and enter <code class="literal">CUSTOM-Common-Name</code> in the Corresponding
      Map Value field. This corresponds to
      <code class="literal">com.sun.identity.agents.config.profile.attribute.mapping[cn]=CUSTOM-Common-Name</code>.</p><p>In most cases, in a destination application where an HTTP header
      name shows up as a request header, it is prefixed by
      <code class="literal">HTTP_</code>, lower case letters become upper case, and
      hyphens (<code class="literal">-</code>) become underscores (<code class="literal">_</code>).
      For example, <code class="literal">common-name</code> becomes
      <code class="literal">HTTP_COMMON_NAME</code>.</p><p>Property: <code class="literal">com.sun.identity.agents.config.profile.attribute.mapping</code></p></dd></dl></div><div class="variablelist"><a name="j2ee-agent-response-attributes-processing-properties"></a><div class="variablelist-title">Response Attributes Processing properties</div><dl class="variablelist"><dt><span class="term">Response Attribute Fetch Mode</span></dt><dd><p>When set to <code class="literal">HTTP_COOKIE</code> or
      <code class="literal">HTTP_HEADER</code>, response attributes are introduced into
      the cookie or the headers, respectively. When set to
      <code class="literal">REQUEST_ATTRIBUTE</code>, response attributes are part
      of the HTTP request.</p><p>Property: <code class="literal">com.sun.identity.agents.config.response.attribute.fetch.mode</code></p></dd><dt><span class="term">Response Attribute Map</span></dt><dd><p>Maps the policy response attributes to HTTP headers for the
      currently authenticated user. The response attribute is
      the attribute in the policy response to be fetched.</p><p>To populate the value of response attribute <code class="literal">uid</code>
      under <code class="literal">CUSTOM-User-Name</code>: enter <code class="literal">uid</code>
      in the Map Key field, and enter <code class="literal">CUSTOM-User-Name</code> in
      the Corresponding Map Value field. This corresponds to
      <code class="literal">com.sun.identity.agents.config.response.attribute.mapping[uid]=Custom-User-Name</code>.</p><p>In most cases, in a destination application where an HTTP header
      name shows up as a request header, it is prefixed by
      <code class="literal">HTTP_</code>, lower case letters become upper case, and
      hyphens (<code class="literal">-</code>) become underscores (<code class="literal">_</code>).
      For example, <code class="literal">response-attr-one</code> becomes
      <code class="literal">HTTP_RESPONSE_ATTR_ONE</code>.</p><p>Property: <code class="literal">com.sun.identity.agents.config.response.attribute.mapping</code></p></dd></dl></div><div class="variablelist"><a name="j2ee-agent-common-attributes-fetching-properties"></a><div class="variablelist-title">Common Attributes Fetching Processing properties</div><dl class="variablelist"><dt><span class="term">Cookie Separator Character</span></dt><dd><p>Specifies the separator for multiple values of the same attribute
      when it is set as a cookie. Default: <code class="literal">|</code> (also known as the vertical bar character).</p><p>Property: <code class="literal">com.sun.identity.agents.config.attribute.cookie.separator</code></p></dd><dt><span class="term">Fetch Attribute Date Format</span></dt><dd><p>Specifies the <code class="literal">java.text.SimpleDateFormat</code> of date
      attribute values used when an attribute is set in an HTTP header. Default:
      <code class="literal">EEE, d MMM yyyy hh:mm:ss z</code>.</p><p>Property: <code class="literal">com.sun.identity.agents.config.attribute.date.format</code></p></dd><dt><span class="term">Attribute Cookie Encode</span></dt><dd><p>When enabled, attribute values are URL encoded before being set as
      a cookie.</p><p>Property: <code class="literal">com.sun.identity.agents.config.attribute.cookie.encode</code></p></dd></dl></div><div class="variablelist"><a name="j2ee-agent-session-attributes-processing-properties"></a><div class="variablelist-title">Session Attributes Processing properties</div><dl class="variablelist"><dt><span class="term">Session Attribute Fetch Mode</span></dt><dd><p>When set to <code class="literal">HTTP_COOKIE</code> or
      <code class="literal">HTTP_HEADER</code>, session attributes are introduced into the
      cookie or the headers, respectively. When set to
      <code class="literal">REQUEST_ATTRIBUTE</code>, session attributes are part
      of the HTTP request.</p><p>Property: <code class="literal">com.sun.identity.agents.config.session.attribute.fetch.mode</code></p></dd><dt><span class="term">Session Attribute Map</span></dt><dd><p>Maps session attributes to HTTP headers for the currently
      authenticated user. The session attribute is the attribute in the session
      to be fetched.</p><p>To populate the value of session attribute
      <code class="literal">UserToken</code> under <code class="literal">CUSTOM-userid</code>:
      enter <code class="literal">UserToken</code> in the Map Key field, and enter
      <code class="literal">CUSTOM-userid</code> in
      the Corresponding Map Value field. This corresponds to
      <code class="literal">com.sun.identity.agents.config.session.attribute.mapping[UserToken]=CUSTOM-userid</code>.</p><p>In most cases, in a destination application where an HTTP header
      name shows up as a request header, it is prefixed by
      <code class="literal">HTTP_</code>, lower case letters become upper case, and
      hyphens (<code class="literal">-</code>) become underscores (<code class="literal">_</code>).
      For example, <code class="literal">success-url</code> becomes
      <code class="literal">HTTP_SUCCESS_URL</code>.</p><p>Property: <code class="literal">com.sun.identity.agents.config.session.attribute.mapping</code></p></dd></dl></div><div class="variablelist"><a name="j2ee-agent-privilege-attributes-properties"></a><div class="variablelist-title">Privilege Attributes Processing properties</div><p>Privileged attributes are sued when the agent is running in
    <code class="literal">ALL</code> or <code class="literal">J2EE_POLICY</code> filter mode.
    Privileged attributes contain the list of declarative Java EE roles that the
    user can have.
   </p><dl class="variablelist"><dt><span class="term">Default Privileged Attribute</span></dt><dd><p>Specifies that every authenticated user
      with a valid OpenAM session will have the
      <code class="literal">AUTHENTICATED_USERS</code> role.</p><p>Property: <code class="literal">com.sun.identity.agents.config.default.privileged.attribute</code></p></dd><dt><span class="term">Privileged Attribute Type</span></dt><dd><p>Specifies the group and role memberships that will be turned into roles for each
      user.</p><p>Property: <code class="literal">com.sun.identity.agents.config.privileged.attribute.type</code></p></dd><dt><span class="term">Privileged Attributes To Lower Case</span></dt><dd><p>Specifies how privileged attribute types should be converted to
      lower case.</p><p>Property: <code class="literal">com.sun.identity.agents.config.privileged.attribute.tolowercase</code></p></dd><dt><span class="term">Privileged Session Attribute</span></dt><dd><p>Specifies the list of session property names when an authenticated
      user's roles are store within a session property.
     </p><p>Property: <code class="literal">com.sun.identity.agents.config.privileged.session.attribute</code></p></dd><dt><span class="term">Enable Privileged Attribute Mapping</span></dt><dd><p>When enabled, lets you use Privileged Attribute Mapping.</p><p>Property: <code class="literal">com.sun.identity.agents.config.privileged.attribute.mapping.enable</code></p></dd><dt><span class="term">Privileged Attribute Mapping</span></dt><dd><p>OpenAM allows original attribute values to be mapped to other
      values. For example, you can map UUIDs to principal names in roles
      specified in a web application's deployment descriptor. For example, to
      map the UUID <code class="literal">id=employee,ou=group,o=openam</code> to the
      principal name <code class="literal">am_employee_role</code> in the deployment
      descriptor, set the key to
      <code class="literal">id=employee,ou=group,o=openam</code>, and the value to
      <code class="literal">am_employee_role</code>.</p><p>Property: <code class="literal">com.sun.identity.agents.config.privileged.attribute.mapping</code></p></dd></dl></div><div class="variablelist"><a name="j2ee-agent-custom-authentication-properties"></a><div class="variablelist-title">Custom Authentication Processing properties</div><dl class="variablelist"><dt><span class="term">Custom Authentication Handler</span></dt><dd><p>Specifies custom authentication handler classes for users
      authenticated with the application server. The key is the web application
      name and the value is the authentication handler class name.</p><p>Property: <code class="literal">com.sun.identity.agents.config.auth.handler</code></p></dd><dt><span class="term">Custom Logout Handler</span></dt><dd><p>Specifies custom logout handler classes to log users out of the
      application server. The key is the web application name and the value is
      the logout handler class name.</p><p>Property: <code class="literal">com.sun.identity.agents.config.logout.handler</code></p></dd><dt><span class="term">Custom Verification Handler</span></dt><dd><p>Specifies custom verification classes to validate user credentials
      with the local user repository. The key is the web application name and
      the value is the validation handler class name.</p><p>Property: <code class="literal">com.sun.identity.agents.config.verification.handler</code></p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="configure-j2ee-pa-sso-props"></a>7.6.3.&nbsp;Configuring Java EE policy agent SSO Properties</h3></div></div></div><p>This section covers SSO J2EE agent properties. After creating the
   agent profile, you access these properties in the OpenAM console under
   Access Control &gt; <em class="replaceable"><code>Realm Name</code></em> &gt; Agents &gt;
   J2EE &gt; <em class="replaceable"><code>Agent Name</code></em> &gt; SSO</p><div class="variablelist"><a name="j2ee-agent-cookie-properties"></a><div class="variablelist-title">Cookie properties</div><dl class="variablelist"><dt><span class="term">Cookie Name</span></dt><dd><p>Name of the SSO Token cookie used between the OpenAM server and
      the agent. Default: <code class="literal">iPlanetDirectoryPro</code>.</p><p>Property: <code class="literal">com.iplanet.am.cookie.name</code></p><p>Hot swap: no</p></dd></dl></div><div class="variablelist"><a name="j2ee-agent-caching-properties"></a><div class="variablelist-title">Caching properties</div><dl class="variablelist"><dt><span class="term">SSO Cache Enable</span></dt><dd><p>When enabled, the agent exposes SSO Cache through the agent SDK
      APIs.</p><p>Property: <code class="literal">com.sun.identity.agents.config.amsso.cache.enable</code></p></dd></dl></div><div class="variablelist"><a name="j2ee-agent-cdsso-properties"></a><div class="variablelist-title">Cross Domain SSO properties</div><dl class="variablelist"><dt><span class="term">Cross Domain SSO</span></dt><dd><p>Enables Cross Domain Single Sign On.</p><p>Property: <code class="literal">com.sun.identity.agents.config.cdsso.enable</code></p></dd><dt><span class="term">CDSSO Redirect URI</span></dt><dd><p>Specifies a URI the agent uses to process CDSSO requests.</p><p>Property: <code class="literal">com.sun.identity.agents.config.cdsso.redirect.uri</code></p></dd><dt><span class="term">CDSSO Servlet URL</span></dt><dd><p>List of URLs of the available CDSSO controllers that the agent can
      use for CDSSO processing. For example,
      <code class="literal">http://openam.example.com:8080/openam/cdcservlet</code>.</p><p>Property: <code class="literal">com.sun.identity.agents.config.cdsso.cdcservlet.url</code></p></dd><dt><span class="term">CDSSO Clock Skew</span></dt><dd><p>When set to a value other than zero, specifies the clock skew in
      seconds that the agent accepts when determining the validity of the CDSSO
      authentication response assertion.</p><p>Property: <code class="literal">com.sun.identity.agents.config.cdsso.clock.skew</code></p></dd><dt><span class="term">CDSSO Trusted ID Provider</span></dt><dd><p>Specifies the list of OpenAM servers or identity providers the
      agent trusts when evaluating CDC Liberty Responses.</p><p>Property: <code class="literal">com.sun.identity.agents.config.cdsso.trusted.id.provider</code></p></dd><dt><span class="term">CDSSO Secure Enable</span></dt><dd><p>When enabled, the agent marks the SSO Token cookie as secure, thus
      the cookie is only transmitted over secure connections.</p><p>Property: <code class="literal">com.sun.identity.agents.config.cdsso.secure.enable</code></p></dd><dt><span class="term">CDSSO Domain List</span></dt><dd><p>List of domains, such as <code class="literal">.example.com</code>, in which
      cookies have to be set in CDSSO.</p><p>Property: <code class="literal">com.sun.identity.agents.config.cdsso.domain</code></p></dd></dl></div><div class="variablelist"><a name="j2ee-agent-cookie-reset-properties"></a><div class="variablelist-title">Cookie Reset properties</div><dl class="variablelist"><dt><span class="term">Cookie Reset</span></dt><dd><p>When enabled, agent resets cookies in the response before
      redirecting to authentication.</p><p>Property: <code class="literal">com.sun.identity.agents.config.cookie.reset.enable</code></p></dd><dt><span class="term">Cookie Reset Name List</span></dt><dd><p>List of cookies to reset if Cookie Reset is enabled.</p><p>Property: <code class="literal">com.sun.identity.agents.config.cookie.reset.name</code></p></dd><dt><span class="term">Cookie Reset Domain Map</span></dt><dd><p>Specifies how names from the Cookie Reset Name List correspond to
      cookie domain values when the cookie is reset.</p><p>Property: <code class="literal">com.sun.identity.agents.config.cookie.reset.domain</code></p></dd><dt><span class="term">Cookie Reset Path Map</span></dt><dd><p>Specifies how names from the Cookie Reset Name List correspond to
      cookie paths when the cookie is reset.</p><p>Property: <code class="literal">com.sun.identity.agents.config.cookie.reset.path</code></p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="configure-j2ee-pa-services-props"></a>7.6.4.&nbsp;Configuring Java EE policy agent OpenAM Services Properties</h3></div></div></div><p>This section covers OpenAM services J2EE agent properties. After
   creating the agent profile, you access these properties in the OpenAM console
   under Access Control &gt; <em class="replaceable"><code>Realm Name</code></em> &gt;
   Agents &gt; J2EE &gt; <em class="replaceable"><code>Agent Name</code></em> &gt; OpenAM
   Services.</p><div class="variablelist"><a name="j2ee-agent-login-url-properties"></a><div class="variablelist-title">Login URL properties</div><dl class="variablelist"><dt><span class="term">OpenAM Login URL</span></dt><dd><p>OpenAM login page URL, such as
      <code class="literal">http://openam.example.com:8080/openam/UI/Login</code>, to
      which the agent redirects incoming users without sufficient credentials
      so that they can authenticate.
      If CDSSO is enabled, this property is not used, instead the CDCServlet URL
      will be used.
     </p><p>Property: <code class="literal">com.sun.identity.agents.config.login.url</code></p></dd><dt><span class="term">OpenAM Conditional Login URL (Not yet in OpenAM console)</span></dt><dd><p>
  To conditionally redirect users based on the incoming request URL,
  set this property.
 </p><p>
  This takes the incoming request domain to match,
  a vertical bar ( <code class="literal">|</code> ),
  and then a comma-separated list of URLs to which to redirect incoming users.
 </p><p>
  If the domain before the vertical bar matches an incoming request URL,
  then the policy agent uses the list of URLs
  to determine how to redirect the user-agent.

  If the global property FQDN Check
  (<code class="literal">com.sun.identity.agents.config.fqdn.check.enable</code>)
  is enabled for the policy agent,
  then the policy agent iterates through the list
  until it finds an appropriate redirect URL that matches the FQDN check.

  Otherwise, the policy agent redirects the user-agent
  to the first URL in the list.
 </p><p>
  Property: <code class="literal">com.sun.identity.agents.config.conditional.login.url</code>
 </p><p>
  Examples:

  <code class="literal">com.sun.identity.agents.config.conditional.login.url[0]=
  login.example.com|http://openam1.example.com/openam/UI/Login,
  http://openam2.example.com/openam/UI/Login</code>,

  <code class="literal">com.sun.identity.agents.config.conditional.login.url[1]=
  signin.example.com|http://openam3.example.com/openam/UI/Login,
  http://openam4.example.com/openam/UI/Login</code>
 </p><p>
  If CDSSO is enabled for the policy agent,
  then this property takes CDSSO Servlet URLs for its values
  (<code class="literal">com.sun.identity.agents.config.cdsso.cdcservlet.url</code>),
  rather than OpenAM login URLs.
 </p><p>
  CDSSO examples:

  <code class="literal">com.sun.identity.agents.config.conditional.login.url[0]=
  login.example.com|http://openam1.example.com/openam/cdcservlet,
  http://openam2.example.com/openam/cdcservlet</code>,

  <code class="literal">com.sun.identity.agents.config.conditional.login.url[1]=
  signin.example.com|http://openam3.example.com/openam/cdcservlet,
  http://openam4.example.com/openam/cdcservlet</code>
 </p></dd><dt><span class="term">Login URL Prioritized</span></dt><dd><p>When enabled, OpenAM uses the priority defined in the OpenAM Login
      URL list as the priority for Login and CDSSO URLs when handling
      failover.</p><p>Property: <code class="literal">com.sun.identity.agents.config.login.url.prioritized</code></p></dd><dt><span class="term">Login URL Probe</span></dt><dd><p>When enabled, OpenAM checks the availability of OpenAM Login URLs
      before redirecting to them.</p><p>Property: <code class="literal">com.sun.identity.agents.config.login.url.probe.enabled</code></p></dd><dt><span class="term">Login URL Probe Timeout</span></dt><dd><p>Timeout period in milliseconds for OpenAM to determine whether
      to failover between Login URLs when Login URL Probe is enabled.</p><p>Property: <code class="literal">com.sun.identity.agents.config.login.url.probe.timeout</code></p><p>Default: 2000</p></dd></dl></div><div class="variablelist"><a name="j2ee-agent-logout-url-properties"></a><div class="variablelist-title">Logout URL properties</div><dl class="variablelist"><dt><span class="term">OpenAM Logout URL</span></dt><dd><p>OpenAM logout page URLs, such as
      <code class="literal">http://openam.example.com:8080/openam/UI/Logout</code>. The
      user is logged out of the OpenAM session when accessing these URLs.</p><p>Property: <code class="literal">com.sun.identity.agents.config.logout.url</code></p></dd><dt><span class="term">OpenAM Conditional Logout URL (Not yet in OpenAM console)</span></dt><dd><p>The values take the incoming request URL to match and a
      comma-separated list of URLs to which to redirect users logging
      out.</p><p>Property: <code class="literal">com.sun.identity.agents.config.conditional.logout.url</code></p><p>Example: <code class="literal">com.sun.identity.agents.config.conditional.logout.url[0]=
      logout.example.com|http://openam1.example.com/openam/UI/Logout,
      http://openam2.example.com/openam/UI/Logout</code></p></dd><dt><span class="term">Logout URL Prioritized</span></dt><dd><p>When enabled, OpenAM uses the priority defined in the OpenAM Logout
      URL list as the priority for Logout URLs when handling failover.</p><p>Property: <code class="literal">com.sun.identity.agents.config.logout.url.prioritized</code></p></dd><dt><span class="term">Logout URL Probe</span></dt><dd><p>When enabled, OpenAM checks the availability of OpenAM Logout URLs
      before redirecting to them.</p><p>Property: <code class="literal">com.sun.identity.agents.config.logout.url.probe.enabled</code></p></dd><dt><span class="term">Logout URL Probe Timeout</span></dt><dd><p>Timeout period in milliseconds for OpenAM to determine whether
      to failover between Logout URLs when Logout URL Probe is enabled.</p><p>Property: <code class="literal">com.sun.identity.agents.config.logout.url.probe.timeout</code></p><p>Default: 2000</p></dd></dl></div><div class="variablelist"><a name="j2ee-agent-agent-authn-service-properties"></a><div class="variablelist-title">Authentication Service properties</div><dl class="variablelist"><dt><span class="term">OpenAM Authentication Service Protocol</span></dt><dd><p>Specifies the protocol used by the OpenAM authentication
      service.</p><p>Property: <code class="literal">com.iplanet.am.server.protocol</code></p><p>Hot swap: no</p></dd><dt><span class="term">OpenAM Authentication Service Host Name</span></dt><dd><p>Specifies the OpenAM authentication service host name.</p><p>Property: <code class="literal">com.iplanet.am.server.host</code></p><p>Hot swap: no</p></dd><dt><span class="term">OpenAM Authentication Service Port</span></dt><dd><p>Specifies the OpenAM authentication service port number.</p><p>Property: <code class="literal">com.iplanet.am.server.port</code></p><p>Hot swap: no</p></dd></dl></div><div class="variablelist"><a name="j2ee-agent-policy-client-service-properties"></a><div class="variablelist-title">Policy Client Service properties</div><dl class="variablelist"><dt><span class="term">Realm</span></dt><dd><p>
      Realm where OpenAM starts policy evaluation for this policy agent.
     </p><p>
      Default: / (top level realm)
     </p><p>
      Edit this property when OpenAM should start policy evaluation
      in a realm other than the top level realm, <code class="literal">/</code>,
      when handling policy decision requests from this policy agent.
     </p><p>
      This property is recognized by OpenAM, not the policy agent.
     </p><p>
      Property: <code class="literal">org.forgerock.openam.agents.config.policy.evaluation.realm</code>
     </p><p>
      Hot swap: yes
     </p></dd><dt><span class="term">Application</span></dt><dd><p>
      Application where OpenAM looks for policies to evaluate
      for this policy agent.
     </p><p>
      Default: <code class="literal">iPlanetAMWebAgentService</code>
     </p><p>
      Edit this property when OpenAM should look for policies
      that belong to an application other than
      <code class="literal">iPlanetAMWebAgentService</code>
      when handling policy decision requests from this policy agent.
     </p><p>
      This property is recognized by OpenAM, not the policy agent.
     </p><p>
      Property: <code class="literal">org.forgerock.openam.agents.config.policy.evaluation.application</code>
     </p><p>
      Hot swap: yes
     </p></dd><dt><span class="term">Enable Policy Notifications</span></dt><dd><p>When enabled, OpenAM sends notification about changes to policy.</p><p>Property: <code class="literal">com.sun.identity.agents.notification.enabled</code></p><p>Hot swap: no</p></dd><dt><span class="term">Policy Client Polling Interval</span></dt><dd><p>Specifies the time in minutes after which the policy cache is
      refreshed.</p><p>Property: <code class="literal">com.sun.identity.agents.polling.interval</code></p><p>Default: 3</p><p>Hot swap: no</p></dd><dt><span class="term">Policy Client Cache Mode</span></dt><dd><p>Set to cache mode subtree when only a small number of policy rules
      are defined. For large numbers of policy rules, set to self.</p><p>Property: <code class="literal">com.sun.identity.policy.client.cacheMode</code></p><p>Default: self</p><p>Hot swap: no</p></dd><dt><span class="term">Policy Client Boolean Action Values</span></dt><dd><p>Specifies the values, such as <code class="literal">allow</code> and
      <code class="literal">deny</code>, that are associated with boolean policy
      decisions. The string is presented below in multiple lines for readability
      purposes.
     </p><p>Default: <code class="literal">iPlanetAMWebAgentService|GET|allow|deny:
      iPlanetAMWebAgentService|POST|allow|deny:
      iPlanetAMWebAgentService|PUT|allow|deny:
      iPlanetAMWebAgentService|DELETE|allow|deny:
      iPlanetAMWebAgentService|HEAD|allow|deny:
      iPlanetAMWebAgentService|OPTIONS|allow|deny:
      iPlanetAMWebAgentService|PATCH|allow|deny</code></p><p>Property: <code class="literal">com.sun.identity.policy.client.booleanActionValues</code></p><p>Hot swap: no</p></dd><dt><span class="term">Policy Client Resource Comparators</span></dt><dd><p>Specifies the comparators used for service names in policy.</p><p>Default: <code class="literal">serviceType=iPlanetAMWebAgentService|
      class=com.sun.identity.policy.plugins.HttpURLResourceName|wildcard=*|
      delimiter=/|caseSensitive=false</code></p><p>Property: <code class="literal">com.sun.identity.policy.client.resourceComparators</code></p><p>Hot swap: no</p></dd><dt><span class="term">Policy Client Clock Skew</span></dt><dd><p>Time in seconds used to adjust time difference between agent system
      and OpenAM. Clock skew in seconds = AgentTime - OpenAMServerTime.</p><p>Default: 10.</p><p>Property: <code class="literal">com.sun.identity.policy.client.clockSkew</code></p><p>Hot swap: no</p></dd><dt><span class="term">URL Policy Env GET Parameters</span></dt><dd><p>Specifies the list of HTTP GET request parameters whose names and
      values the agents sets in the environment map for URL policy evaluation
      by the OpenAM server.</p><p>Property: <code class="literal">com.sun.identity.agents.config.policy.env.get.param</code></p></dd><dt><span class="term">URL Policy Env POST Parameters</span></dt><dd><p>Specifies the list of HTTP POST request parameters whose names and
      values the agents sets in the environment map for URL policy evaluation
      by the OpenAM server.</p><p>Property: <code class="literal">com.sun.identity.agents.config.policy.env.post.param</code></p></dd><dt><span class="term">URL Policy Env jsession Parameters</span></dt><dd><p>Specifies the list of HTTP session attributes whose names and
      values the agents sets in the environment map for URL policy evaluation
      by the OpenAM server.</p><p>Property: <code class="literal">com.sun.identity.agents.config.policy.env.jsession.param</code></p></dd><dt><span class="term">Use HTTP-Redirect for composite advice</span></dt><dd><p>When enabled, the remote policy client is configured to use
      HTTP-Redirect instead of HTTP-POST for composite advice.</p><p>Property: <code class="literal">com.sun.identity.agents.config.policy.advice.use.redirect</code></p></dd></dl></div><div class="variablelist"><a name="j2ee-agent-user-data-cache-service-properties"></a><div class="variablelist-title">User Data Cache Service properties</div><dl class="variablelist"><dt><span class="term">Enable Notification of User Data Caches</span></dt><dd><p>When enabled, receive notification from OpenAM to update user
      management data caches.</p><p>Property: <code class="literal">com.sun.identity.idm.remote.notification.enabled</code></p><p>Hot swap: no</p></dd><dt><span class="term">User Data Cache Polling Time</span></dt><dd><p>If notifications are not enabled and set to a value other than zero,
      specifies the time in minutes after which the agent polls to update
      cached user management data.</p><p>Property: <code class="literal">com.iplanet.am.sdk.remote.pollingTime</code></p><p>Default: 1</p><p>Hot swap: no</p></dd><dt><span class="term">Enable Notification of Service Data Caches</span></dt><dd><p>When enabled, receive notification from OpenAM to update service
      configuration data caches.</p><p>Property: <code class="literal">com.sun.identity.sm.notification.enabled</code></p><p>Hot swap: no</p></dd><dt><span class="term">Service Data Cache Time</span></dt><dd><p>If notifications are not enabled and set to a value other than zero,
      specifies the time in minutes after which the agent polls to update
      cached service configuration data.</p><p>Property: <code class="literal">com.sun.identity.sm.cacheTime</code></p><p>Default: 1</p><p>Hot swap: no</p></dd></dl></div><div class="variablelist"><a name="j2ee-agent-session-client-service-properties"></a><div class="variablelist-title">Session Client Service properties</div><dl class="variablelist"><dt><span class="term">Enable Client Polling</span></dt><dd><p>When enabled, the session client polls to update the session cache
      rather than relying on notifications from OpenAM.</p><p>Property: <code class="literal">com.iplanet.am.session.client.polling.enable</code></p><p>Hot swap: no</p></dd><dt><span class="term">Client Polling Period</span></dt><dd><p>Specifies the time in seconds after which the session client
      requests an update from OpenAM for cached session information.</p><p>Property: <code class="literal">com.iplanet.am.session.client.polling.period</code></p><p>Default: 180</p><p>Hot swap: no</p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="configure-j2ee-pa-misc-props"></a>7.6.5.&nbsp;Configuring Java EE policy agent Miscellaneous Properties</h3></div></div></div><p>This section covers miscellaneous J2EE agent properties. After creating
   the agent profile, you access these properties in the OpenAM console under
   Access Control &gt; <em class="replaceable"><code>Realm Name</code></em> &gt; Agents &gt;
   J2EE &gt; <em class="replaceable"><code>Agent Name</code></em> &gt; Miscellaneous.</p><div class="variablelist"><a name="j2ee-agent-locale-properties"></a><div class="variablelist-title">Locale properties</div><dl class="variablelist"><dt><span class="term">Locale Language</span></dt><dd><p>The default language for the agent.</p><p>Property: <code class="literal">com.sun.identity.agents.config.locale.language</code></p><p>Hot swap: no</p></dd><dt><span class="term">Locale Country</span></dt><dd><p>The default country for the agent.</p><p>Property: <code class="literal">com.sun.identity.agents.config.locale.country</code></p><p>Hot swap: no</p></dd></dl></div><div class="variablelist"><a name="j2ee-agent-port-check-properties"></a><div class="variablelist-title">Port Check Processing properties</div><dl class="variablelist"><dt><span class="term">Port Check Enable</span></dt><dd><p>When enabled, activate port checking, correcting requests on the
      wrong port.</p><p>Property: <code class="literal">com.sun.identity.agents.config.port.check.enable</code></p></dd><dt><span class="term">Port Check File</span></dt><dd><p>Specifies the name of the file containing the content to handle
      requests on the wrong port when port checking is enabled.</p><p>Property: <code class="literal">com.sun.identity.agents.config.port.check.file</code></p></dd><dt><span class="term">Port Check Setting</span></dt><dd><p>Specifies which ports correspond to which protocols. The agent uses
      the map when handling requests with invalid port numbers during port
      checking.</p><p>Property: <code class="literal">com.sun.identity.agents.config.port.check.setting</code></p></dd></dl></div><div class="variablelist"><a name="j2ee-agent-bypass-principal-list-properties"></a><div class="variablelist-title">Bypass Principal List properties</div><dl class="variablelist"><dt><span class="term">Bypass Principal List</span></dt><dd><p>Specifies a list of principals the agent bypasses for
      authentication and search purposes, such as <code class="literal">guest</code>
      or <code class="literal">testuser</code>.</p><p>Property: <code class="literal">com.sun.identity.agents.config.bypass.principal</code></p></dd></dl></div><div class="variablelist"><a name="j2ee-agent-password-encryptor-properties"></a><div class="variablelist-title">Agent Password Encryptor properties</div><dl class="variablelist"><dt><span class="term">Encryption Provider</span></dt><dd><p>Specifies the agent's encryption provider class.</p><p>Default: <code class="literal">com.iplanet.services.util.JCEEncryption</code></p><p>Property: <code class="literal">com.iplanet.security.encryptor</code></p><p>Hot swap: no</p></dd></dl></div><div class="variablelist"><a name="j2ee-agent-ignore-path-info-properties"></a><div class="variablelist-title">Ignore Path Info properties</div><dl class="variablelist"><dt><span class="term">Ignore Path Info in Request URL</span></dt><dd><p>When enabled, strip path info from the request URL while doing the
      Not Enforced List check, and URL policy evaluation. This is designed
      to prevent a user from accessing a URI by appending the matching pattern
      in the policy or not enforced list.</p><p>For example, if the not enforced list includes
      <code class="literal">/*.gif</code>, then stripping path info from the request URL
      prevents access to <code class="literal">http://host/index.html</code> by using
      <code class="literal">http://host/index.html?hack.gif</code>.</p><p>Property: <code class="literal">com.sun.identity.agents.config.ignore.path.info</code></p></dd></dl></div><div class="variablelist"><a name="j2ee-agent-deprecated-properties"></a><div class="variablelist-title">Deprecated Client Browser User Agent Properties</div><dl class="variablelist"><dt><span class="term">Goto Parameter Name</span></dt><dd><p>Property used only when CDSSO is enabled. Only change the default
      value, <code class="literal">goto</code> when the login URL has a landing page
      specified such as,
      <code class="literal">com.sun.identity.agents.config.cdsso.cdcservlet.url
       = http://openam.example.com:8080/openam/cdcservlet?goto=
       http://www.example.com/landing.jsp</code>.
      The agent uses this parameter to append the original request URL
      to this cdcservlet URL. The landing page consumes this parameter to
      redirect to the original URL.</p><p>As an example, if you set this value to <code class="literal">goto2</code>,
      then the complete URL sent for authentication is
      <code class="literal">http://openam.example.com:8080/openam/cdcservlet?goto=
       http://www.example.com/landing.jsp?goto2=http://www.example.com/original.jsp</code>.</p><p>Property: <code class="literal">com.sun.identity.agents.config.redirect.param</code></p></dd><dt><span class="term">Legacy User Agent Support Enable</span></dt><dd><p>When enabled, provide support for legacy browsers.</p><p>Property: <code class="literal">com.sun.identity.agents.config.legacy.support.enable</code></p></dd><dt><span class="term">Legacy User Agent List</span></dt><dd><p>List of header values that identify legacy browsers. Entries can
      use the wildcard character, <code class="literal">*</code>.</p><p>Property: <code class="literal">com.sun.identity.agents.config.legacy.user.agent</code></p></dd><dt><span class="term">Legacy User Agent Redirect URI</span></dt><dd><p>Specifies a URI the agent uses to redirect legacy user agent
      requests.</p><p>Property: <code class="literal">com.sun.identity.agents.config.legacy.redirect.uri</code></p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="configure-j2ee-pa-advanced-props"></a>7.6.6.&nbsp;Configuring Java EE policy agent Advanced Properties</h3></div></div></div><p>This section covers advanced J2EE agent properties. After creating the
   agent profile, you access these properties in the OpenAM console under
   Access Control &gt; <em class="replaceable"><code>Realm Name</code></em> &gt; Agents &gt;
   J2EE &gt; <em class="replaceable"><code>Agent Name</code></em> &gt; Advanced.</p><div class="variablelist"><a name="j2ee-agent-client-identification-properties"></a><div class="variablelist-title">Client Identification properties</div><p>If the agent is behind a proxy or load balancer, then the agent can
    get client IP and host name values from the proxy or load balancer. For
    proxies and load balancer that support providing the client IP and host
    name in HTTP headers, you can use the following properties.</p><p>When multiple proxies or load balancers sit in the request path,
    the header values can include a comma-separated list of values with the
    first value representing the client, as in
    <code class="literal">client,next-proxy,first-proxy</code>.</p><dl class="variablelist"><dt><span class="term">Client IP Address Header</span></dt><dd><p>HTTP header name that holds the IP address of the client.</p><p>Property: <code class="literal">com.sun.identity.agents.config.client.ip.header</code></p></dd><dt><span class="term">Client Hostname Header</span></dt><dd><p>HTTP header name that holds the hostname of the client.</p><p>Property: <code class="literal">com.sun.identity.agents.config.client.hostname.header</code></p></dd></dl></div><div class="variablelist"><a name="j2ee-agent-web-service-processing-properties"></a><div class="variablelist-title">Web Service Processing properties</div><dl class="variablelist"><dt><span class="term">Web Service Enable</span></dt><dd><p>Enable web service processing.</p><p>Property: <code class="literal">com.sun.identity.agents.config.webservice.enable</code></p></dd><dt><span class="term">Web Service End Points</span></dt><dd><p>Specifies a list of web application end points that represent web
      services.</p><p>Property: <code class="literal">com.sun.identity.agents.config.webservice.endpoint</code></p></dd><dt><span class="term">Web Service Process GET Enable</span></dt><dd><p>When enabled, the agent processes HTTP GET requests for web service
      endpoints.</p><p>Property: <code class="literal">com.sun.identity.agents.config.webservice.process.get.enable</code></p></dd><dt><span class="term">Web Service Authenticator</span></dt><dd><p>Specifies a class implementing
      <code class="literal">com.sun.identity.agents.filter.IWebServiceAuthenticator</code>,
      used to authenticate web service requests.</p><p>Property: <code class="literal">com.sun.identity.agents.config.webservice.authenticator</code></p></dd><dt><span class="term">Web Service Response Processor</span></dt><dd><p>Specifies a class implementing
      <code class="literal">com.sun.identity.agents.filter.IWebServiceResponseProcessor</code>,
      used to process web service responses.</p><p>Property: <code class="literal">com.sun.identity.agents.config.webservice.responseprocessor</code></p></dd><dt><span class="term">Web Service Internal Error Content File</span></dt><dd><p>Specifies a file the agent uses to generate an internal error fault
      for the client application.</p><p>Property: <code class="literal">com.sun.identity.agents.config.webservice.internalerror.content</code></p></dd><dt><span class="term">Web Service Authorization Error Content File</span></dt><dd><p>Specifies a file the agent uses to generate an authorization error
      fault for the client application.</p><p>Property: <code class="literal">com.sun.identity.agents.config.webservice.autherror.content</code></p></dd></dl></div><div class="variablelist"><a name="j2ee-agent-alternate-url-properties"></a><div class="variablelist-title">Alternate Agent URL properties</div><dl class="variablelist"><dt><span class="term">Alternative Agent Host Name</span></dt><dd><p>Specifies the host name of the agent protected server to show to
      client browsers, rather than the actual host name.</p><p>Property: <code class="literal">com.sun.identity.agents.config.agent.host</code></p></dd><dt><span class="term">Alternative Agent Port Name</span></dt><dd><p>Specifies the port number of the agent protected server to show to
      client browsers, rather than the actual port number.</p><p>Property: <code class="literal">com.sun.identity.agents.config.agent.port</code></p></dd><dt><span class="term">Alternative Agent Protocol</span></dt><dd><p>Specifies the protocol used to contact the agent from the browser
      client browsers, rather than the actual protocol used by the server.
      Either <code class="literal">http</code> or <code class="literal">https</code>.</p><p>Property: <code class="literal">com.sun.identity.agents.config.agent.protocol</code></p></dd></dl></div><div class="variablelist"><a name="j2ee-agent-jboss-properties"></a><div class="variablelist-title">JBoss Application Server properties</div><dl class="variablelist"><dt><span class="term">WebAuthentication Available</span></dt><dd><p>When enabled, allow programmatic authentication with the JBoss
      container using the WebAuthentication feature. This feature works only with
      certain versions of JBoss when the <code class="literal">J2EE_POLICY</code> or
      <code class="literal">ALL</code> filter mode is in use.</p><p>Property: <code class="literal">com.sun.identity.agents.config.jboss.webauth.available</code></p><div class="note"><h3 class="title">Note</h3><p>This setting is not necessary for the JBoss v7 agent.</p></div></dd></dl></div><div class="variablelist"><a name="j2ee-agent-xss-detection-properties"></a><div class="variablelist-title">Cross Site Scripting Detection properties</div><dl class="variablelist"><dt><span class="term">Possible XSS code elements</span></dt><dd><p>Specifies strings that, when found in the request, cause the agent
      to redirect the client to an error page.</p><p>Property: <code class="literal">com.sun.identity.agents.config.xss.code.elements</code></p></dd><dt><span class="term">XSS detection redirect URI</span></dt><dd><p>Maps applications to URIs of customized pages to which to redirect
      clients upon detection of XSS code elements.</p><p>For example, to redirect clients of MyApp to
      <code class="literal">/myapp/error.html</code>, enter MyApp as the Map Key and
      <code class="literal">/myapp/error.html</code> as the Corresponding Map
      Value.</p><p>Property: <code class="literal">com.sun.identity.agents.config.xss.redirect.uri</code></p></dd></dl></div><div class="variablelist"><a name="j2ee-agent-post-data-preservation-properties"></a><div class="variablelist-title">Post Data Preservation properties</div><dl class="variablelist"><dt><span class="term">POST Data Preservation</span></dt><dd><p>Enables HTTP POST data preservation, storing POST data before
      redirecting the browser to the login screen, and then autosubmitting
      the same POST after successful authentication to the original URL.</p><p>Property: <code class="literal">com.sun.identity.agents.config.postdata.preserve.enable</code></p></dd><dt><span class="term">Missing PDP entry URI</span></dt><dd><p>Specifies a list of application-specific URIs if the referenced
      Post Data Preservation entry cannot be found in the local cache because
      it has exceeded its POST entry TTL. Either the agent redirects to a
      URI in this list, or it shows an HTTP 403 Forbidden error.</p><p>Property: <code class="literal">com.sun.identity.agents.config.postdata.preserve.cache.noentry.url</code></p></dd><dt><span class="term">POST entry TTL</span></dt><dd><p>POST data storage lifetime in milliseconds. Default: 300000.</p><p>Property: <code class="literal">com.sun.identity.agents.config.postdata.preserve.cache.entry.ttl</code></p></dd><dt><span class="term">PDP Stickysession mode</span></dt><dd><p>Specifies whether to create a cookie, or to append a query string to
      the URL to assist with sticky load balancing.</p><p>Property: <code class="literal">com.sun.identity.agents.config.postdata.preserve.stickysession.mode</code></p></dd><dt><span class="term">PDP Stickysession key-value</span></dt><dd><p>Specifies the key-value pair for stickysession mode. For example,
      a setting of <code class="literal">lb=myserver</code> either sets an
      <code class="literal">lb</code> cookie with <code class="literal">myserver</code> value, or
      adds <code class="literal">lb=myserver</code> to the URL query string.</p><p>Property: <code class="literal">com.sun.identity.agents.config.postdata.preserve.stickysession.value</code></p></dd></dl></div><div class="variablelist"><a name="j2ee-agent-custom-properties"></a><div class="variablelist-title">Custom properties</div><dl class="variablelist"><dt><span class="term">Custom Properties</span></dt><dd><p>Additional properties to augment the set of properties supported
      by agent. Such properties take the following forms.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">customproperty=custom-value1</code></p></li><li class="listitem"><p><code class="literal">customlist[0]=customlist-value-0</code></p></li><li class="listitem"><p><code class="literal">customlist[1]=customlist-value-1</code></p></li><li class="listitem"><p><code class="literal">custommap[key1]=custommap-value-1</code></p></li><li class="listitem"><p><code class="literal">custommap[key2]=custommap-value-2</code></p></li></ul></div><p>Property: <code class="literal">com.sun.identity.agents.config.freeformproperties</code></p></dd></dl></div></div></div><div lang="en" class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="configure-agent-auth"></a>7.7.&nbsp;Configuring Agent Authenticators</h2></div></div></div><a class="indexterm" name="d0e6121"></a><p>An <em class="firstterm">agent authenticator</em> has read-only access to
  multiple agent profiles defined in the same realm, typically allowing an
  agent to read web service agent profiles.</p><p>After creating the agent profile, you access agent properties in the
  OpenAM console under Access Control &gt; <em class="replaceable"><code>Realm Name</code></em>
  &gt; Agents &gt; Agent Authenticator &gt; <em class="replaceable"><code>Agent
   Name</code></em>.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Password</span></dt><dd><p>Specifies the password the agent uses to connect to OpenAM.</p></dd><dt><span class="term">Status</span></dt><dd><p>Specifies whether the agent profile is active, and so can be
     used.</p></dd><dt><span class="term">Agent Profiles allow to Read</span></dt><dd><p>Specifies which agent profiles in the realm the agent authenticator
     can read.</p></dd><dt><span class="term">Agent Root URL for CDSSO</span></dt><dd><p>Specifies the list of agent root URLs for CDSSO. The valid value is
     in the format
     <code class="literal"><em class="replaceable"><code>protocol</code></em>://<em class="replaceable"><code>hostname</code></em>:<em class="replaceable"><code>port</code></em>/</code>
     where <em class="replaceable"><code>protocol</code></em> represents the protocol used,
     such as <code class="literal">http</code> or <code class="literal">https</code>,
     <em class="replaceable"><code>hostname</code></em> represents the host name of the
     system where the agent resides, and <em class="replaceable"><code>port</code></em>
     represents the port number on which the agent is installed.
     The slash following the port number is required.</p><p>If your agent system also has virtual host names, add URLs with
     the virtual host names to this list as well. OpenAM checks that
     <code class="literal">goto</code> URLs match one of the agent root URLs for
     CDSSO.</p></dd></dl></div></div><div class="footnotes"><br><hr class="footnote-hr"><div id="ftn.d0e3846" class="footnote"><p><a href="#d0e3846" class="para"><sup class="para">[2] </sup></a>The configuration file syntax is that
   of a standard Java properties file. See
   <a class="link" href="http://download.oracle.com/javase/6/docs/api/java/util/Properties.html#load%28java.io.Reader%29" target="_top">java.util.Properties.load()</a>
   for a description of the format. The value of a property specified multiple
   times is not defined.</p></div></div></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-lb"></a>Chapter&nbsp;8.&nbsp;Configuring Java EE Policy Agents Behind Load Balancers</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="section"><a href="#lb-scenarios">8.1. The Role of the Load Balancing Layer</a></span></dt><dt><span class="section"><a href="#lb-configure-agent">8.2. Configuring the Agent Behind the Load Balancer</a></span></dt></dl></div><a class="indexterm" name="d0e6199"></a><p>
  This chapter addresses the question of configuring policy agents
  on protected application servers that operate behind network load balancers.
 </p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="lb-scenarios"></a>8.1.&nbsp;The Role of the Load Balancing Layer</h2></div></div></div><a class="indexterm" name="d0e6207"></a><p>
   A load balancing layer that stands between clients and protected servers
   can distribute the client load,
   and fail client traffic over when a protected server goes offline.
   In the simplest case, the load balancing layer passes requests
   from the clients to servers and responses from servers to clients,
   managing the traffic so the client experience
   is as smooth as possible.
  </p><div class="figure"><a name="figure-lb-jee-agents"></a><div class="figure-title">Figure&nbsp;8.1.&nbsp;Load Balancing With Same Protocol and Port</div><div class="figure-contents"><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/lb-jee-agents.png" align="middle" height="360" alt="Diagram showing matching protocols and port numbers"></td></tr></table><div class="longdesc-link" align="right"><br clear="all"><span class="longdesc-link">[<a href="ld-d0e6217.html" target="longdesc">D</a>]</span></div></div></div></div><br class="figure-break"><p>
   A load balancing layer can also offload processor-intensive
   public-key encryption algorithms involved in SSL transactions
   to a hardware accelerator, reducing the load on the protected servers.
   The client connects to the load balancer over HTTPS,
   but the load balancer connects to the servers over HTTP.
  </p><div class="figure"><a name="figure-lb-jee-agents-ssl-offload"></a><div class="figure-title">Figure&nbsp;8.2.&nbsp;Load Balancing With SSL Offloading</div><div class="figure-contents"><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/lb-jee-agents-ssl-offload.png" align="middle" height="360" alt="Diagram showing SSL offloading"></td></tr></table><div class="longdesc-link" align="right"><br clear="all"><span class="longdesc-link">[<a href="ld-d0e6230.html" target="longdesc">D</a>]</span></div></div></div></div><br class="figure-break"></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="lb-configure-agent"></a>8.2.&nbsp;Configuring the Agent Behind the Load Balancer</h2></div></div></div><a class="indexterm" name="d0e6241"></a><p>
   Configure your agent to map the agent host name
   to the load balancer host name,
   and to set alternate agent URL properties.
   Follow the steps in <a class="xref" href="#lb-fqdn-mapping" title="Procedure&nbsp;8.1.&nbsp;To Map the Agent Host Name to the Load Balancer Host Name">Procedure&nbsp;8.1, &#8220;To Map the Agent Host Name to the Load Balancer Host Name&#8221;</a>
   and <a class="xref" href="#lb-alternate-agent-url" title="Procedure&nbsp;8.2.&nbsp;To Set Alternate Agent URL Properties">Procedure&nbsp;8.2, &#8220;To Set Alternate Agent URL Properties&#8221;</a>.
  </p><div class="procedure"><a name="lb-fqdn-mapping"></a><div class="procedure-title">Procedure&nbsp;8.1.&nbsp;To Map the Agent Host Name to the Load Balancer Host Name</div><a class="indexterm" name="d0e6255"></a><p>
    Follow these steps to map the agent host name to
    the fully qualified domain name (FQDN) of the load balancer.
   </p><p>
    This procedure explains how to do so
    for a centralized Java EE policy agent profile configured in OpenAM Console.
    The steps also mention the properties for
    Java EE agent profiles that rely on local, file-based configurations.
   </p><ol class="procedure" type="1"><li class="step"><p>
     Login to OpenAM Console as an administrative user
     with rights to modify the policy agent profile.
    </p></li><li class="step"><p>
     Browse to Access Control &gt; <em class="replaceable"><code>Realm Name</code></em>
     &gt; Agents &gt; J2EE &gt; <em class="replaceable"><code>Agent Name</code></em>
     to open the Java EE agent profile for editing.
    </p></li><li class="step"><p>
     In the Global tab page section Fully Qualified Domain Name Checking,
     make sure FQDN checking is selected (the default).
    </p><p>
     The equivalent property setting is
     <code class="literal">com.sun.identity.agents.config.fqdn.check.enable=true</code>.
    </p></li><li class="step"><p>
     Set FQDN Default to the fully qualified domain name of the load balancer,
     such as <code class="literal">lb.example.com</code>,
     rather than the protected server FQDN where the policy agent is installed.
    </p><p>
     The equivalent property setting is
     <code class="literal">com.sun.identity.agents.config.fqdn.default=lb.example.com</code>.
    </p></li><li class="step"><p>
     Set FQDN Virtual Host Map to map the protected server FQDN
     to the load balancer FQDN, for example where
     the key <code class="literal">agent.example.com</code> (protected server)
     has value <code class="literal">lb.example.com</code> (load balancer).
    </p><p>
     The equivalent property setting is
     <code class="literal">com.sun.identity.agents.config.fqdn.mapping[agent.example.com]=lb.example.com</code>.
    </p></li><li class="step"><p>
     Save your work, and then restart the agent or the protected server.
    </p></li></ol></div><div class="procedure"><a name="lb-alternate-agent-url"></a><div class="procedure-title">Procedure&nbsp;8.2.&nbsp;To Set Alternate Agent URL Properties</div><a class="indexterm" name="d0e6315"></a><p>
    Use the alternate agent URL properties to show the load balancer
    protocol, host, and port to show client browsers.
   </p><p>
    This procedure explains how to do so
    for a centralized Java EE policy agent profile configured in OpenAM Console.
    The steps also mention the properties for
    Java EE agent profiles that rely on local, file-based configurations.
   </p><ol class="procedure" type="1"><li class="step"><p>
     Login to OpenAM Console as an administrative user
     with rights to modify the policy agent profile.
    </p></li><li class="step"><p>
     Browse to Access Control &gt; <em class="replaceable"><code>Realm Name</code></em>
     &gt; Agents &gt; J2EE &gt; <em class="replaceable"><code>Agent Name</code></em>
     to open the Java EE agent profile for editing.
    </p></li><li class="step"><p>
     In the Advanced tab page section Alternate Agent URL,
     set the Alternative Agent Host Name to that of the load balancer
     such as <code class="literal">lb</code>.
    </p><p>
     The equivalent property setting is similar to the following:
     <code class="literal">com.sun.identity.agents.config.agent.host=lb</code>.
    </p></li><li class="step"><p>
     If the host name is different on the load balancer,
     in the Advanced tab page section Alternate Agent URL,
     set the Alternative Agent Port number to that of the load balancer
     such as <code class="literal">80</code>.
    </p><p>
     The equivalent property setting is similar to the following:
     <code class="literal">com.sun.identity.agents.config.agent.port=80</code>.
    </p></li><li class="step"><p>
     If the protocol is different on the load balancer,
     in the Advanced tab page section Alternate Agent URL,
     set the Alternative Agent Protocol
     to either <code class="literal">http</code> or <code class="literal">https</code>.
    </p><p>
     The equivalent property setting is similar to the following:
     <code class="literal">com.sun.identity.agents.config.agent.protocol=https</code>.
    </p></li><li class="step"><p>
     Save your work, and then restart the agent or the protected server.
    </p></li></ol></div></div></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-troubleshooting"></a>Chapter&nbsp;9.&nbsp;Troubleshooting</h1></div></div></div><a class="indexterm" name="d0e6379"></a><a class="indexterm" name="d0e6384"></a><p>This chapter offers solutions to issues during installation of OpenAM
  policy agents.</p><div class="qandaset"><h2 class="title"><a name="solutions-to-common-issues"></a>Solutions to Common Issues</h2><a class="indexterm" name="d0e6392"></a><p>This section offers solutions to common problems when installing
   OpenAM policy agents.</p><table border="0" style="width: 100%;"><colgroup><col align="left" width="1%"><col></colgroup><tbody><tr class="question"><td align="left" valign="top"><a name="cannot-install-over-https"></a><a name="d0e6400"></a><p><b>Q:</b></p></td><td align="left" valign="top"><p>I am trying to install a policy agent, connecting to OpenAM over
    HTTPS, and seeing the following error.</p><div class="screen"><pre>OpenAM server URL: https://openam.example.com:8443/openam

WARNING: Unable to connect to OpenAM server URL. Please specify the
correct OpenAM server URL by hitting the Back button (&lt;) or if the OpenAM
server URL is not started and you want to start it later, please proceed with
the installation.
If OpenAM server is SSL enabled and the root CA certificate for the OpenAM
server certificate has been not imported into installer JVMs key store (see
installer-logs/debug/Agent.log for detailed exception), import the root
CA certificate and restart the installer; or continue installation without
verifying OpenAM server URL.</pre></div><p>What should I do?</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>A:</b></p></td><td align="left" valign="top"><p>The Java platform includes certificates from many Certificate
    Authorities (CAs). If however you run your own CA, or you use self-signed
    certificates for HTTPS on the container where you run OpenAM, then the
    <span class="command"><strong>agentadmin</strong></span> command cannot trust the certificate
    presented during connection to OpenAM, and so cannot complete installation
    correctly.</p><p>After setting up the container where you run OpenAM to use HTTPS,
    get the certificate to trust in a certificate file. The certificate you
    want is the that of the CA who signed the container certificate, or the
    certificate itself if the container certificate is self-signed.</p><p>Copy the certificate file to the system where you plan to install the
    policy agent. Import the certificate into a trust store that you will use
    during policy agent installation. If you import the certificate into the
    default trust store for the Java platform, then the
    <span class="command"><strong>agentadmin</strong></span> command can recognize it without additional
    configuration.</p><p>Export and import of self-signed certificates is demonstrated in the
    <em class="citetitle">Administration Guide</em> chapter on <a class="link" href="http://openam.forgerock.org/doc/admin-guide/#chap-certs-keystores" target="_blank"><em class="citetitle">Managing Certificates</em></a>.</p></td></tr><tr class="question"><td align="left" valign="top"><a name="cannot-install-with-ibm-java"></a><a name="d0e6430"></a><p><b>Q:</b></p></td><td align="left" valign="top"><p>I am trying to install the WebSphere policy agent on Linux.
    The system has IBM Java. When I run <span class="command"><strong>agentadmin --install</strong></span>,
    the script fails to encrypt the password from the password file, ending
    with this message:</p><pre class="literallayout">ERROR: An unknown error has occurred (null). Please try again.</pre><p>What should I do?</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>A:</b></p></td><td align="left" valign="top"><p>You must edit <span class="command"><strong>agentadmin</strong></span> to use IBMJCE, and then
    try again.</p><p>See <a href="../jee-users-guide/index.html#install-with-ibm-jvm" class="link"><em class="citetitle">To Install
    With IBM Java</em></a>.</p></td></tr><tr class="question"><td align="left" valign="top"><a name="websphere-SRVE0190E-file-not-found"></a><a name="d0e6453"></a><p><b>Q:</b></p></td><td align="left" valign="top"><p>After installing a Java EE policy agent on WebSphere AS 7 or 8,
    accessing a URL for a folder in a protected application such as
    <code class="literal">http://openam.example.com:9080/test/</code> results in
    <code class="literal">Error 404: SRVE0190E: File not found: {0}</code>, and
    redirection fails. What should I do to work around this problem?</p></td></tr><tr class="answer"><td align="left" valign="top"><p><b>A:</b></p></td><td align="left" valign="top"><p>Perform the following steps to work around the problem, by setting
    the WebSphere custom property
    <code class="literal">com.ibm.ws.webcontainer.invokeFiltersCompatibility=true</code>.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>In the administration console, browse to Servers &gt; Server Types,
      and then click WebSphere application servers.</p></li><li class="listitem"><p>Click the server for which to apply the custom property.</p></li><li class="listitem"><p>Browse to Configuration &gt; Container settings &gt; Web Container
      Settings &gt; Web container.</p></li><li class="listitem"><p>Under Configuration &gt; Additional Properties, click Custom
      Properties.</p></li><li class="listitem"><p>In the Custom Properties page, click New.</p></li><li class="listitem"><p>In the settings page, enter the Name
      <code class="literal">com.ibm.ws.webcontainer.invokeFiltersCompatibility</code> and
      Value <code class="literal">true</code> for the custom property.</p><p>Some properties are case sensitive.</p></li><li class="listitem"><p>Click Apply or OK as applicable.</p></li><li class="listitem"><p>Click Save in the Message box that appears.</p></li><li class="listitem"><p>Restart the server for the custom property to take effect.</p></li></ol></div><p>See the IBM documentation on <a class="link" href="http://www-01.ibm.com/support/docview.wss?uid=swg21284395" target="_blank"><em class="citetitle">Setting webcontainer custom properties</em></a>
    for additional information.</p></td></tr></tbody></table></div></div><div class="index"><div class="titlepage"><div><div><h1 class="title"><a name="d0e6510"></a>Index</h1></div></div></div><div class="index"><div class="indexdiv"><h3>A</h3><dl><dt>Apache Tomcat Server, <a class="indexterm" href="#chap-apache-tomcat">Installing the Apache Tomcat Policy Agent</a></dt></dl></div><div class="indexdiv"><h3>C</h3><dl><dt>cookie reset, <a class="indexterm" href="#cookie-reset">Cookie Reset Properties</a></dt><dt>cross domain single sign-on (CDSSO), <a class="indexterm" href="#agent-cdsso">Cross Domain Single Sign-On</a></dt></dl></div><div class="indexdiv"><h3>F</h3><dl><dt>filter modes, <a class="indexterm" href="#filter-modes">Java EE Agent Filter Modes of Operation</a></dt><dt>fully-qualified domain checking, <a class="indexterm" href="#fqdn-checking">FQDN Checking</a></dt></dl></div><div class="indexdiv"><h3>I</h3><dl><dt>IBM WebSphere, <a class="indexterm" href="#chap-websphere">Installing the IBM WebSphere Policy Agent</a></dt><dd><dl><dt>before you install, <a class="indexterm" href="#before-websphere-agent-install">Before You Install</a></dt><dt>installing into, <a class="indexterm" href="#install-websphere-agent">Installing the WebSphere Policy Agent</a></dt></dl></dd><dt>IBM WebSphere agent</dt><dd><dl><dt>about network deployment, <a class="indexterm" href="#websphere-network-deployment">Notes About WebSphere Network Deployment</a></dt><dt>installing, <a class="indexterm" href="#install-websphere-agent">Installing the WebSphere Policy Agent</a></dt><dt>installing with IBM Java, <a class="indexterm" href="#before-websphere-agent-install">Before You Install</a></dt><dt>protecting applications, <a class="indexterm" href="#install-websphere-agent">Installing the WebSphere Policy Agent</a></dt><dt>silent install, <a class="indexterm" href="#silent-websphere-agent-installation">Silent WebSphere Policy Agent Installation</a></dt></dl></dd></dl></div><div class="indexdiv"><h3>J</h3><dl><dt>Java EE policy agents</dt><dd><dl><dt>about, <a class="indexterm" href="#chap-about-jee-agents">About OpenAM Java EE Policy Agents</a></dt><dt>components, <a class="indexterm" href="#example-j2ee-agent-components">Java EE Policy Agent Components</a></dt><dt>cookie reset, <a class="indexterm" href="#cookie-reset">Cookie Reset Properties</a></dt><dt>cross domain single sign-on (CDSSO), <a class="indexterm" href="#agent-cdsso">Cross Domain Single Sign-On</a></dt><dt>features, <a class="indexterm" href="#j2ee-agent-features">Java EE Policy Agent Features</a></dt><dt>filter modes, <a class="indexterm" href="#filter-modes">Java EE Agent Filter Modes of Operation</a></dt><dt>fully-qualified domain checking, <a class="indexterm" href="#fqdn-checking">FQDN Checking</a></dt><dt>how agents are configured, <a class="indexterm" href="#j2ee-agent-configuration">How Java EE Policy Agents are Configured</a></dt><dt>IBM WebSphere, <a class="indexterm" href="#before-websphere-agent-install">Before You Install</a></dt><dt>JBoss 7, <a class="indexterm" href="#before-jboss7-agent-install">Before You Install</a></dt><dt>Jetty, <a class="indexterm" href="#chap-jetty">Installing the Jetty Server Policy Agent</a></dt><dt>login attempt limits, <a class="indexterm" href="#agent-login-attempt-limits">Login Attempt Limits</a></dt><dt>Not-Enforced Client IP lists, <a class="indexterm" href="#jee-agent-not-enforced-list">Not-Enforced URI and Client IP Lists</a></dt><dt>Not-Enforced URI lists, <a class="indexterm" href="#jee-agent-not-enforced-list">Not-Enforced URI and Client IP Lists</a></dt><dt>process flow, <a class="indexterm" href="#j2ee-process-flow">Java EE Process Flow</a></dt><dt>Tomcat, <a class="indexterm" href="#before-tomcat-agent-install">Before You Install</a></dt><dt>troubleshooting, <a class="indexterm" href="#chap-troubleshooting">Troubleshooting</a></dt></dl></dd><dt>JBoss 7</dt><dd><dl><dt>installing into, <a class="indexterm" href="#install-jboss7-agent">Installing the JBoss Policy Agent</a></dt></dl></dd><dt>JBoss 7 agent</dt><dd><dl><dt>before you install, <a class="indexterm" href="#before-jboss7-agent-install">Before You Install</a></dt><dt>installing, <a class="indexterm" href="#install-jboss7-agent">Installing the JBoss Policy Agent</a></dt><dt>removing, <a class="indexterm" href="#uninstall-jboss7-agent">Removing JBoss Policy Agent Software</a></dt><dt>running after install, <a class="indexterm" href="#install-jboss7-agent">Installing the JBoss Policy Agent</a></dt><dt>silent install, <a class="indexterm" href="#silent-jboss7-agent-installation">Silent JBoss Policy Agent Installation</a></dt></dl></dd><dt>JBoss Application Server, <a class="indexterm" href="#chap-jboss-7">Installing the JBoss 7 Application Server Policy Agent</a></dt><dt>Jetty, <a class="indexterm" href="#chap-jetty">Installing the Jetty Server Policy Agent</a></dt><dd><dl><dt>before you install, <a class="indexterm" href="#before-jetty-agent-install">Before You Install</a></dt></dl></dd><dt>Jetty agent</dt><dd><dl><dt>installing, <a class="indexterm" href="#install-jetty-agent">Installing the Jetty Policy Agent</a></dt><dt>removing, <a class="indexterm" href="#uninstall-jetty-agent">Removing Jetty Policy Agent Software</a></dt><dt>silent install, <a class="indexterm" href="#silent-jetty-agent-installation">Silent Jetty Policy Agent Installation</a></dt></dl></dd></dl></div><div class="indexdiv"><h3>L</h3><dl><dt>load balancers, <a class="indexterm" href="#chap-lb">Configuring Java EE Policy Agents Behind Load Balancers</a></dt><dd><dl><dt>configuring agent behind, <a class="indexterm" href="#lb-configure-agent">Configuring the Agent Behind the Load Balancer</a></dt><dt>map agent host name to, <a class="indexterm" href="#lb-configure-agent">Configuring the Agent Behind the Load Balancer</a></dt><dt>role of, <a class="indexterm" href="#lb-scenarios">The Role of the Load Balancing Layer</a></dt><dt>setting alternate agent URL properties, <a class="indexterm" href="#lb-configure-agent">Configuring the Agent Behind the Load Balancer</a></dt></dl></dd><dt>login attempt limits, <a class="indexterm" href="#agent-login-attempt-limits">Login Attempt Limits</a></dt></dl></div><div class="indexdiv"><h3>N</h3><dl><dt>Not-Enforced Client IP list, <a class="indexterm" href="#jee-agent-not-enforced-list">Not-Enforced URI and Client IP Lists</a></dt><dt>Not-Enforced URI list, <a class="indexterm" href="#jee-agent-not-enforced-list">Not-Enforced URI and Client IP Lists</a></dt></dl></div><div class="indexdiv"><h3>O</h3><dl><dt>Open Identity Gateway, <a class="indexterm" href="#gateway-or-policy-agent">Open Identity Gateway or Policy Agent?</a></dt><dt>Oracle WebLogic, <a class="indexterm" href="#chap-weblogic">Installing the Oracle WebLogic Policy Agent</a></dt><dt>Oracle WebLogic agent</dt><dd><dl><dt>before your install, <a class="indexterm" href="#before-weblogic-agent-install">Before You Install</a></dt><dt>installing, <a class="indexterm" href="#install-weblogic-agent">Installing the WebLogic Policy Agent</a></dt><dt>installing in multi-server domains, <a class="indexterm" href="#weblogic-agents-multi-server">Installing WebLogic Policy Agents in Multi-Server Domains</a></dt><dt>post-install, <a class="indexterm" href="#post-weblogic-agent-installation">Post Installation of WebLogic Policy Agent</a></dt><dt>removing, <a class="indexterm" href="#uninstall-weblogic-agent">Removing WebLogic Policy Agent Software</a></dt><dt>silent install, <a class="indexterm" href="#silent-weblogic-agent-installation">Silent WebLogic Policy Agent Installation</a></dt></dl></dd></dl></div><div class="indexdiv"><h3>P</h3><dl><dt>password file</dt><dd><dl><dt>creating, <a class="indexterm" href="#install-tomcat-agent">Installing the Tomcat Policy Agent</a>, <a class="indexterm" href="#install-jboss7-agent">Installing the JBoss Policy Agent</a>, <a class="indexterm" href="#install-jetty-agent">Installing the Jetty Policy Agent</a>, <a class="indexterm" href="#install-weblogic-agent">Installing the WebLogic Policy Agent</a>, <a class="indexterm" href="#install-websphere-agent">Installing the WebSphere Policy Agent</a></dt></dl></dd><dt>policy agent profiles</dt><dd><dl><dt>agent administrators</dt><dd><dl><dt>creating, <a class="indexterm" href="#delegate-agent-profile-creation">Delegating Agent Profile Creation</a></dt></dl></dd><dt>creating, <a class="indexterm" href="#create-agent-profiles">Creating Agent Profiles</a></dt><dt>delegating creation of, <a class="indexterm" href="#delegate-agent-profile-creation">Delegating Agent Profile Creation</a></dt><dt>kinds of, <a class="indexterm" href="#kinds-of-agent-profiles">Kinds of Agent Profiles</a></dt></dl></dd><dt>Policy agents, <a class="indexterm" href="#chap-j2ee-agents">Configuring Java EE Policy Agents</a></dt><dd><dl><dt>Configuring, <a class="indexterm" href="#configure-22-policy-agent">Configuring Version 2.2 Policy Agents</a>, <a class="indexterm" href="#configure-j2ee-policy-agent">Configuring Java EE Policy Agents</a>, <a class="indexterm" href="#configure-agent-auth">Configuring Agent Authenticators</a></dt><dt>Group inheritance, <a class="indexterm" href="#create-agent-profiles">Creating Agent Profiles</a></dt><dt>Profiles, <a class="indexterm" href="#kinds-of-agent-profiles">Kinds of Agent Profiles</a></dt></dl></dd><dt>properties, <a class="indexterm" href="#policy-agent-properties">About Policy Agent Properties</a></dt></dl></div><div class="indexdiv"><h3>T</h3><dl><dt>Tomcat 6</dt><dd><dl><dt>installing into, <a class="indexterm" href="#install-tomcat-agent">Installing the Tomcat Policy Agent</a></dt><dt>silent install, <a class="indexterm" href="#silent-tomcat-agent-installation">Silent Tomcat Policy Agent Installation</a></dt></dl></dd><dt>Tomcat 7</dt><dd><dl><dt>installing into, <a class="indexterm" href="#install-tomcat-agent">Installing the Tomcat Policy Agent</a></dt></dl></dd><dt>Tomcat agent</dt><dd><dl><dt>before you install, <a class="indexterm" href="#before-tomcat-agent-install">Before You Install</a></dt><dt>checking install, <a class="indexterm" href="#install-tomcat-agent">Installing the Tomcat Policy Agent</a></dt><dt>removing, <a class="indexterm" href="#uninstall-tomcat-agent">Remove Tomcat Policy Agent Software</a></dt></dl></dd><dt>troubleshooting, <a class="indexterm" href="#chap-troubleshooting">Troubleshooting</a></dt><dd><dl><dt>solutions to common issues, <a class="indexterm" href="#chap-troubleshooting">Troubleshooting</a></dt></dl></dd></dl></div></div></div></div><p>&nbsp;</p><div id="footer"><p>Something wrong on this page? <a href="https://bugster.forgerock.org/jira/secure/CreateIssueDetails!init.jspa?pid=10000&components=10007&issuetype=1">Log a documentation bug.</a></p></div>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-23412190-7']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</body></html>
