<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
   <title>OpenAM 10.1.0 Developer's Guide</title><link rel="stylesheet" type="text/css" href="css/coredoc.css"><meta name="generator" content="DocBook XSL-NS Stylesheets V1.76.1"><meta name="description" content="Guide to developing OpenAM client applications and service providers. OpenAM provides open source Authentication, Authorization, Entitlement and Federation software."><script type="text/javascript">
/*! jQuery v1.7.1 jquery.com | jquery.org/license */
(function(a,b){function cy(a){return f.isWindow(a)?a:a.nodeType===9?a.defaultView||a.parentWindow:!1}function cv(a){if(!ck[a]){var b=c.body,d=f("<"+a+">").appendTo(b),e=d.css("display");d.remove();if(e==="none"||e===""){cl||(cl=c.createElement("iframe"),cl.frameBorder=cl.width=cl.height=0),b.appendChild(cl);if(!cm||!cl.createElement)cm=(cl.contentWindow||cl.contentDocument).document,cm.write((c.compatMode==="CSS1Compat"?"<!doctype html>":"")+"<html><body>"),cm.close();d=cm.createElement(a),cm.body.appendChild(d),e=f.css(d,"display"),b.removeChild(cl)}ck[a]=e}return ck[a]}function cu(a,b){var c={};f.each(cq.concat.apply([],cq.slice(0,b)),function(){c[this]=a});return c}function ct(){cr=b}function cs(){setTimeout(ct,0);return cr=f.now()}function cj(){try{return new a.ActiveXObject("Microsoft.XMLHTTP")}catch(b){}}function ci(){try{return new a.XMLHttpRequest}catch(b){}}function cc(a,c){a.dataFilter&&(c=a.dataFilter(c,a.dataType));var d=a.dataTypes,e={},g,h,i=d.length,j,k=d[0],l,m,n,o,p;for(g=1;g<i;g++){if(g===1)for(h in a.converters)typeof h=="string"&&(e[h.toLowerCase()]=a.converters[h]);l=k,k=d[g];if(k==="*")k=l;else if(l!=="*"&&l!==k){m=l+" "+k,n=e[m]||e["* "+k];if(!n){p=b;for(o in e){j=o.split(" ");if(j[0]===l||j[0]==="*"){p=e[j[1]+" "+k];if(p){o=e[o],o===!0?n=p:p===!0&&(n=o);break}}}}!n&&!p&&f.error("No conversion from "+m.replace(" "," to ")),n!==!0&&(c=n?n(c):p(o(c)))}}return c}function cb(a,c,d){var e=a.contents,f=a.dataTypes,g=a.responseFields,h,i,j,k;for(i in g)i in d&&(c[g[i]]=d[i]);while(f[0]==="*")f.shift(),h===b&&(h=a.mimeType||c.getResponseHeader("content-type"));if(h)for(i in e)if(e[i]&&e[i].test(h)){f.unshift(i);break}if(f[0]in d)j=f[0];else{for(i in d){if(!f[0]||a.converters[i+" "+f[0]]){j=i;break}k||(k=i)}j=j||k}if(j){j!==f[0]&&f.unshift(j);return d[j]}}function ca(a,b,c,d){if(f.isArray(b))f.each(b,function(b,e){c||bE.test(a)?d(a,e):ca(a+"["+(typeof e=="object"||f.isArray(e)?b:"")+"]",e,c,d)});else if(!c&&b!=null&&typeof b=="object")for(var e in b)ca(a+"["+e+"]",b[e],c,d);else d(a,b)}function b_(a,c){var d,e,g=f.ajaxSettings.flatOptions||{};for(d in c)c[d]!==b&&((g[d]?a:e||(e={}))[d]=c[d]);e&&f.extend(!0,a,e)}function b$(a,c,d,e,f,g){f=f||c.dataTypes[0],g=g||{},g[f]=!0;var h=a[f],i=0,j=h?h.length:0,k=a===bT,l;for(;i<j&&(k||!l);i++)l=h[i](c,d,e),typeof l=="string"&&(!k||g[l]?l=b:(c.dataTypes.unshift(l),l=b$(a,c,d,e,l,g)));(k||!l)&&!g["*"]&&(l=b$(a,c,d,e,"*",g));return l}function bZ(a){return function(b,c){typeof b!="string"&&(c=b,b="*");if(f.isFunction(c)){var d=b.toLowerCase().split(bP),e=0,g=d.length,h,i,j;for(;e<g;e++)h=d[e],j=/^\+/.test(h),j&&(h=h.substr(1)||"*"),i=a[h]=a[h]||[],i[j?"unshift":"push"](c)}}}function bC(a,b,c){var d=b==="width"?a.offsetWidth:a.offsetHeight,e=b==="width"?bx:by,g=0,h=e.length;if(d>0){if(c!=="border")for(;g<h;g++)c||(d-=parseFloat(f.css(a,"padding"+e[g]))||0),c==="margin"?d+=parseFloat(f.css(a,c+e[g]))||0:d-=parseFloat(f.css(a,"border"+e[g]+"Width"))||0;return d+"px"}d=bz(a,b,b);if(d<0||d==null)d=a.style[b]||0;d=parseFloat(d)||0;if(c)for(;g<h;g++)d+=parseFloat(f.css(a,"padding"+e[g]))||0,c!=="padding"&&(d+=parseFloat(f.css(a,"border"+e[g]+"Width"))||0),c==="margin"&&(d+=parseFloat(f.css(a,c+e[g]))||0);return d+"px"}function bp(a,b){b.src?f.ajax({url:b.src,async:!1,dataType:"script"}):f.globalEval((b.text||b.textContent||b.innerHTML||"").replace(bf,"/*$0*/")),b.parentNode&&b.parentNode.removeChild(b)}function bo(a){var b=c.createElement("div");bh.appendChild(b),b.innerHTML=a.outerHTML;return b.firstChild}function bn(a){var b=(a.nodeName||"").toLowerCase();b==="input"?bm(a):b!=="script"&&typeof a.getElementsByTagName!="undefined"&&f.grep(a.getElementsByTagName("input"),bm)}function bm(a){if(a.type==="checkbox"||a.type==="radio")a.defaultChecked=a.checked}function bl(a){return typeof a.getElementsByTagName!="undefined"?a.getElementsByTagName("*"):typeof a.querySelectorAll!="undefined"?a.querySelectorAll("*"):[]}function bk(a,b){var c;if(b.nodeType===1){b.clearAttributes&&b.clearAttributes(),b.mergeAttributes&&b.mergeAttributes(a),c=b.nodeName.toLowerCase();if(c==="object")b.outerHTML=a.outerHTML;else if(c!=="input"||a.type!=="checkbox"&&a.type!=="radio"){if(c==="option")b.selected=a.defaultSelected;else if(c==="input"||c==="textarea")b.defaultValue=a.defaultValue}else a.checked&&(b.defaultChecked=b.checked=a.checked),b.value!==a.value&&(b.value=a.value);b.removeAttribute(f.expando)}}function bj(a,b){if(b.nodeType===1&&!!f.hasData(a)){var c,d,e,g=f._data(a),h=f._data(b,g),i=g.events;if(i){delete h.handle,h.events={};for(c in i)for(d=0,e=i[c].length;d<e;d++)f.event.add(b,c+(i[c][d].namespace?".":"")+i[c][d].namespace,i[c][d],i[c][d].data)}h.data&&(h.data=f.extend({},h.data))}}function bi(a,b){return f.nodeName(a,"table")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function U(a){var b=V.split("|"),c=a.createDocumentFragment();if(c.createElement)while(b.length)c.createElement(b.pop());return c}function T(a,b,c){b=b||0;if(f.isFunction(b))return f.grep(a,function(a,d){var e=!!b.call(a,d,a);return e===c});if(b.nodeType)return f.grep(a,function(a,d){return a===b===c});if(typeof b=="string"){var d=f.grep(a,function(a){return a.nodeType===1});if(O.test(b))return f.filter(b,d,!c);b=f.filter(b,d)}return f.grep(a,function(a,d){return f.inArray(a,b)>=0===c})}function S(a){return!a||!a.parentNode||a.parentNode.nodeType===11}function K(){return!0}function J(){return!1}function n(a,b,c){var d=b+"defer",e=b+"queue",g=b+"mark",h=f._data(a,d);h&&(c==="queue"||!f._data(a,e))&&(c==="mark"||!f._data(a,g))&&setTimeout(function(){!f._data(a,e)&&!f._data(a,g)&&(f.removeData(a,d,!0),h.fire())},0)}function m(a){for(var b in a){if(b==="data"&&f.isEmptyObject(a[b]))continue;if(b!=="toJSON")return!1}return!0}function l(a,c,d){if(d===b&&a.nodeType===1){var e="data-"+c.replace(k,"-$1").toLowerCase();d=a.getAttribute(e);if(typeof d=="string"){try{d=d==="true"?!0:d==="false"?!1:d==="null"?null:f.isNumeric(d)?parseFloat(d):j.test(d)?f.parseJSON(d):d}catch(g){}f.data(a,c,d)}else d=b}return d}function h(a){var b=g[a]={},c,d;a=a.split(/\s+/);for(c=0,d=a.length;c<d;c++)b[a[c]]=!0;return b}var c=a.document,d=a.navigator,e=a.location,f=function(){function J(){if(!e.isReady){try{c.documentElement.doScroll("left")}catch(a){setTimeout(J,1);return}e.ready()}}var e=function(a,b){return new e.fn.init(a,b,h)},f=a.jQuery,g=a.$,h,i=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,j=/\S/,k=/^\s+/,l=/\s+$/,m=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,n=/^[\],:{}\s]*$/,o=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,p=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,q=/(?:^|:|,)(?:\s*\[)+/g,r=/(webkit)[ \/]([\w.]+)/,s=/(opera)(?:.*version)?[ \/]([\w.]+)/,t=/(msie) ([\w.]+)/,u=/(mozilla)(?:.*? rv:([\w.]+))?/,v=/-([a-z]|[0-9])/ig,w=/^-ms-/,x=function(a,b){return(b+"").toUpperCase()},y=d.userAgent,z,A,B,C=Object.prototype.toString,D=Object.prototype.hasOwnProperty,E=Array.prototype.push,F=Array.prototype.slice,G=String.prototype.trim,H=Array.prototype.indexOf,I={};e.fn=e.prototype={constructor:e,init:function(a,d,f){var g,h,j,k;if(!a)return this;if(a.nodeType){this.context=this[0]=a,this.length=1;return this}if(a==="body"&&!d&&c.body){this.context=c,this[0]=c.body,this.selector=a,this.length=1;return this}if(typeof a=="string"){a.charAt(0)!=="<"||a.charAt(a.length-1)!==">"||a.length<3?g=i.exec(a):g=[null,a,null];if(g&&(g[1]||!d)){if(g[1]){d=d instanceof e?d[0]:d,k=d?d.ownerDocument||d:c,j=m.exec(a),j?e.isPlainObject(d)?(a=[c.createElement(j[1])],e.fn.attr.call(a,d,!0)):a=[k.createElement(j[1])]:(j=e.buildFragment([g[1]],[k]),a=(j.cacheable?e.clone(j.fragment):j.fragment).childNodes);return e.merge(this,a)}h=c.getElementById(g[2]);if(h&&h.parentNode){if(h.id!==g[2])return f.find(a);this.length=1,this[0]=h}this.context=c,this.selector=a;return this}return!d||d.jquery?(d||f).find(a):this.constructor(d).find(a)}if(e.isFunction(a))return f.ready(a);a.selector!==b&&(this.selector=a.selector,this.context=a.context);return e.makeArray(a,this)},selector:"",jquery:"1.7.1",length:0,size:function(){return this.length},toArray:function(){return F.call(this,0)},get:function(a){return a==null?this.toArray():a<0?this[this.length+a]:this[a]},pushStack:function(a,b,c){var d=this.constructor();e.isArray(a)?E.apply(d,a):e.merge(d,a),d.prevObject=this,d.context=this.context,b==="find"?d.selector=this.selector+(this.selector?" ":"")+c:b&&(d.selector=this.selector+"."+b+"("+c+")");return d},each:function(a,b){return e.each(this,a,b)},ready:function(a){e.bindReady(),A.add(a);return this},eq:function(a){a=+a;return a===-1?this.slice(a):this.slice(a,a+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(F.apply(this,arguments),"slice",F.call(arguments).join(","))},map:function(a){return this.pushStack(e.map(this,function(b,c){return a.call(b,c,b)}))},end:function(){return this.prevObject||this.constructor(null)},push:E,sort:[].sort,splice:[].splice},e.fn.init.prototype=e.fn,e.extend=e.fn.extend=function(){var a,c,d,f,g,h,i=arguments[0]||{},j=1,k=arguments.length,l=!1;typeof i=="boolean"&&(l=i,i=arguments[1]||{},j=2),typeof i!="object"&&!e.isFunction(i)&&(i={}),k===j&&(i=this,--j);for(;j<k;j++)if((a=arguments[j])!=null)for(c in a){d=i[c],f=a[c];if(i===f)continue;l&&f&&(e.isPlainObject(f)||(g=e.isArray(f)))?(g?(g=!1,h=d&&e.isArray(d)?d:[]):h=d&&e.isPlainObject(d)?d:{},i[c]=e.extend(l,h,f)):f!==b&&(i[c]=f)}return i},e.extend({noConflict:function(b){a.$===e&&(a.$=g),b&&a.jQuery===e&&(a.jQuery=f);return e},isReady:!1,readyWait:1,holdReady:function(a){a?e.readyWait++:e.ready(!0)},ready:function(a){if(a===!0&&!--e.readyWait||a!==!0&&!e.isReady){if(!c.body)return setTimeout(e.ready,1);e.isReady=!0;if(a!==!0&&--e.readyWait>0)return;A.fireWith(c,[e]),e.fn.trigger&&e(c).trigger("ready").off("ready")}},bindReady:function(){if(!A){A=e.Callbacks("once memory");if(c.readyState==="complete")return setTimeout(e.ready,1);if(c.addEventListener)c.addEventListener("DOMContentLoaded",B,!1),a.addEventListener("load",e.ready,!1);else if(c.attachEvent){c.attachEvent("onreadystatechange",B),a.attachEvent("onload",e.ready);var b=!1;try{b=a.frameElement==null}catch(d){}c.documentElement.doScroll&&b&&J()}}},isFunction:function(a){return e.type(a)==="function"},isArray:Array.isArray||function(a){return e.type(a)==="array"},isWindow:function(a){return a&&typeof a=="object"&&"setInterval"in a},isNumeric:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},type:function(a){return a==null?String(a):I[C.call(a)]||"object"},isPlainObject:function(a){if(!a||e.type(a)!=="object"||a.nodeType||e.isWindow(a))return!1;try{if(a.constructor&&!D.call(a,"constructor")&&!D.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(c){return!1}var d;for(d in a);return d===b||D.call(a,d)},isEmptyObject:function(a){for(var b in a)return!1;return!0},error:function(a){throw new Error(a)},parseJSON:function(b){if(typeof b!="string"||!b)return null;b=e.trim(b);if(a.JSON&&a.JSON.parse)return a.JSON.parse(b);if(n.test(b.replace(o,"@").replace(p,"]").replace(q,"")))return(new Function("return "+b))();e.error("Invalid JSON: "+b)},parseXML:function(c){var d,f;try{a.DOMParser?(f=new DOMParser,d=f.parseFromString(c,"text/xml")):(d=new ActiveXObject("Microsoft.XMLDOM"),d.async="false",d.loadXML(c))}catch(g){d=b}(!d||!d.documentElement||d.getElementsByTagName("parsererror").length)&&e.error("Invalid XML: "+c);return d},noop:function(){},globalEval:function(b){b&&j.test(b)&&(a.execScript||function(b){a.eval.call(a,b)})(b)},camelCase:function(a){return a.replace(w,"ms-").replace(v,x)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toUpperCase()===b.toUpperCase()},each:function(a,c,d){var f,g=0,h=a.length,i=h===b||e.isFunction(a);if(d){if(i){for(f in a)if(c.apply(a[f],d)===!1)break}else for(;g<h;)if(c.apply(a[g++],d)===!1)break}else if(i){for(f in a)if(c.call(a[f],f,a[f])===!1)break}else for(;g<h;)if(c.call(a[g],g,a[g++])===!1)break;return a},trim:G?function(a){return a==null?"":G.call(a)}:function(a){return a==null?"":(a+"").replace(k,"").replace(l,"")},makeArray:function(a,b){var c=b||[];if(a!=null){var d=e.type(a);a.length==null||d==="string"||d==="function"||d==="regexp"||e.isWindow(a)?E.call(c,a):e.merge(c,a)}return c},inArray:function(a,b,c){var d;if(b){if(H)return H.call(b,a,c);d=b.length,c=c?c<0?Math.max(0,d+c):c:0;for(;c<d;c++)if(c in b&&b[c]===a)return c}return-1},merge:function(a,c){var d=a.length,e=0;if(typeof c.length=="number")for(var f=c.length;e<f;e++)a[d++]=c[e];else while(c[e]!==b)a[d++]=c[e++];a.length=d;return a},grep:function(a,b,c){var d=[],e;c=!!c;for(var f=0,g=a.length;f<g;f++)e=!!b(a[f],f),c!==e&&d.push(a[f]);return d},map:function(a,c,d){var f,g,h=[],i=0,j=a.length,k=a instanceof e||j!==b&&typeof j=="number"&&(j>0&&a[0]&&a[j-1]||j===0||e.isArray(a));if(k)for(;i<j;i++)f=c(a[i],i,d),f!=null&&(h[h.length]=f);else for(g in a)f=c(a[g],g,d),f!=null&&(h[h.length]=f);return h.concat.apply([],h)},guid:1,proxy:function(a,c){if(typeof c=="string"){var d=a[c];c=a,a=d}if(!e.isFunction(a))return b;var f=F.call(arguments,2),g=function(){return a.apply(c,f.concat(F.call(arguments)))};g.guid=a.guid=a.guid||g.guid||e.guid++;return g},access:function(a,c,d,f,g,h){var i=a.length;if(typeof c=="object"){for(var j in c)e.access(a,j,c[j],f,g,d);return a}if(d!==b){f=!h&&f&&e.isFunction(d);for(var k=0;k<i;k++)g(a[k],c,f?d.call(a[k],k,g(a[k],c)):d,h);return a}return i?g(a[0],c):b},now:function(){return(new Date).getTime()},uaMatch:function(a){a=a.toLowerCase();var b=r.exec(a)||s.exec(a)||t.exec(a)||a.indexOf("compatible")<0&&u.exec(a)||[];return{browser:b[1]||"",version:b[2]||"0"}},sub:function(){function a(b,c){return new a.fn.init(b,c)}e.extend(!0,a,this),a.superclass=this,a.fn=a.prototype=this(),a.fn.constructor=a,a.sub=this.sub,a.fn.init=function(d,f){f&&f instanceof e&&!(f instanceof a)&&(f=a(f));return e.fn.init.call(this,d,f,b)},a.fn.init.prototype=a.fn;var b=a(c);return a},browser:{}}),e.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(a,b){I["[object "+b+"]"]=b.toLowerCase()}),z=e.uaMatch(y),z.browser&&(e.browser[z.browser]=!0,e.browser.version=z.version),e.browser.webkit&&(e.browser.safari=!0),j.test(" ")&&(k=/^[\s\xA0]+/,l=/[\s\xA0]+$/),h=e(c),c.addEventListener?B=function(){c.removeEventListener("DOMContentLoaded",B,!1),e.ready()}:c.attachEvent&&(B=function(){c.readyState==="complete"&&(c.detachEvent("onreadystatechange",B),e.ready())});return e}(),g={};f.Callbacks=function(a){a=a?g[a]||h(a):{};var c=[],d=[],e,i,j,k,l,m=function(b){var d,e,g,h,i;for(d=0,e=b.length;d<e;d++)g=b[d],h=f.type(g),h==="array"?m(g):h==="function"&&(!a.unique||!o.has(g))&&c.push(g)},n=function(b,f){f=f||[],e=!a.memory||[b,f],i=!0,l=j||0,j=0,k=c.length;for(;c&&l<k;l++)if(c[l].apply(b,f)===!1&&a.stopOnFalse){e=!0;break}i=!1,c&&(a.once?e===!0?o.disable():c=[]:d&&d.length&&(e=d.shift(),o.fireWith(e[0],e[1])))},o={add:function(){if(c){var a=c.length;m(arguments),i?k=c.length:e&&e!==!0&&(j=a,n(e[0],e[1]))}return this},remove:function(){if(c){var b=arguments,d=0,e=b.length;for(;d<e;d++)for(var f=0;f<c.length;f++)if(b[d]===c[f]){i&&f<=k&&(k--,f<=l&&l--),c.splice(f--,1);if(a.unique)break}}return this},has:function(a){if(c){var b=0,d=c.length;for(;b<d;b++)if(a===c[b])return!0}return!1},empty:function(){c=[];return this},disable:function(){c=d=e=b;return this},disabled:function(){return!c},lock:function(){d=b,(!e||e===!0)&&o.disable();return this},locked:function(){return!d},fireWith:function(b,c){d&&(i?a.once||d.push([b,c]):(!a.once||!e)&&n(b,c));return this},fire:function(){o.fireWith(this,arguments);return this},fired:function(){return!!e}};return o};var i=[].slice;f.extend({Deferred:function(a){var b=f.Callbacks("once memory"),c=f.Callbacks("once memory"),d=f.Callbacks("memory"),e="pending",g={resolve:b,reject:c,notify:d},h={done:b.add,fail:c.add,progress:d.add,state:function(){return e},isResolved:b.fired,isRejected:c.fired,then:function(a,b,c){i.done(a).fail(b).progress(c);return this},always:function(){i.done.apply(i,arguments).fail.apply(i,arguments);return this},pipe:function(a,b,c){return f.Deferred(function(d){f.each({done:[a,"resolve"],fail:[b,"reject"],progress:[c,"notify"]},function(a,b){var c=b[0],e=b[1],g;f.isFunction(c)?i[a](function(){g=c.apply(this,arguments),g&&f.isFunction(g.promise)?g.promise().then(d.resolve,d.reject,d.notify):d[e+"With"](this===i?d:this,[g])}):i[a](d[e])})}).promise()},promise:function(a){if(a==null)a=h;else for(var b in h)a[b]=h[b];return a}},i=h.promise({}),j;for(j in g)i[j]=g[j].fire,i[j+"With"]=g[j].fireWith;i.done(function(){e="resolved"},c.disable,d.lock).fail(function(){e="rejected"},b.disable,d.lock),a&&a.call(i,i);return i},when:function(a){function m(a){return function(b){e[a]=arguments.length>1?i.call(arguments,0):b,j.notifyWith(k,e)}}function l(a){return function(c){b[a]=arguments.length>1?i.call(arguments,0):c,--g||j.resolveWith(j,b)}}var b=i.call(arguments,0),c=0,d=b.length,e=Array(d),g=d,h=d,j=d<=1&&a&&f.isFunction(a.promise)?a:f.Deferred(),k=j.promise();if(d>1){for(;c<d;c++)b[c]&&b[c].promise&&f.isFunction(b[c].promise)?b[c].promise().then(l(c),j.reject,m(c)):--g;g||j.resolveWith(j,b)}else j!==a&&j.resolveWith(j,d?[a]:[]);return k}}),f.support=function(){var b,d,e,g,h,i,j,k,l,m,n,o,p,q=c.createElement("div"),r=c.documentElement;q.setAttribute("className","t"),q.innerHTML="   <link/><table></table><a href='/a' style='top:1px;float:left;opacity:.55;'>a</a><input type='checkbox'/>",d=q.getElementsByTagName("*"),e=q.getElementsByTagName("a")[0];if(!d||!d.length||!e)return{};g=c.createElement("select"),h=g.appendChild(c.createElement("option")),i=q.getElementsByTagName("input")[0],b={leadingWhitespace:q.firstChild.nodeType===3,tbody:!q.getElementsByTagName("tbody").length,htmlSerialize:!!q.getElementsByTagName("link").length,style:/top/.test(e.getAttribute("style")),hrefNormalized:e.getAttribute("href")==="/a",opacity:/^0.55/.test(e.style.opacity),cssFloat:!!e.style.cssFloat,checkOn:i.value==="on",optSelected:h.selected,getSetAttribute:q.className!=="t",enctype:!!c.createElement("form").enctype,html5Clone:c.createElement("nav").cloneNode(!0).outerHTML!=="<:nav></:nav>",submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0},i.checked=!0,b.noCloneChecked=i.cloneNode(!0).checked,g.disabled=!0,b.optDisabled=!h.disabled;try{delete q.test}catch(s){b.deleteExpando=!1}!q.addEventListener&&q.attachEvent&&q.fireEvent&&(q.attachEvent("onclick",function(){b.noCloneEvent=!1}),q.cloneNode(!0).fireEvent("onclick")),i=c.createElement("input"),i.value="t",i.setAttribute("type","radio"),b.radioValue=i.value==="t",i.setAttribute("checked","checked"),q.appendChild(i),k=c.createDocumentFragment(),k.appendChild(q.lastChild),b.checkClone=k.cloneNode(!0).cloneNode(!0).lastChild.checked,b.appendChecked=i.checked,k.removeChild(i),k.appendChild(q),q.innerHTML="",a.getComputedStyle&&(j=c.createElement("div"),j.style.width="0",j.style.marginRight="0",q.style.width="2px",q.appendChild(j),b.reliableMarginRight=(parseInt((a.getComputedStyle(j,null)||{marginRight:0}).marginRight,10)||0)===0);if(q.attachEvent)for(o in{submit:1,change:1,focusin:1})n="on"+o,p=n in q,p||(q.setAttribute(n,"return;"),p=typeof q[n]=="function"),b[o+"Bubbles"]=p;k.removeChild(q),k=g=h=j=q=i=null,f(function(){var a,d,e,g,h,i,j,k,m,n,o,r=c.getElementsByTagName("body")[0];!r||(j=1,k="position:absolute;top:0;left:0;width:1px;height:1px;margin:0;",m="visibility:hidden;border:0;",n="style='"+k+"border:5px solid #000;padding:0;'",o="<div "+n+"><div></div></div>"+"<table "+n+" cellpadding='0' cellspacing='0'>"+"<tr><td></td></tr></table>",a=c.createElement("div"),a.style.cssText=m+"width:0;height:0;position:static;top:0;margin-top:"+j+"px",r.insertBefore(a,r.firstChild),q=c.createElement("div"),a.appendChild(q),q.innerHTML="<table><tr><td style='padding:0;border:0;display:none'></td><td>t</td></tr></table>",l=q.getElementsByTagName("td"),p=l[0].offsetHeight===0,l[0].style.display="",l[1].style.display="none",b.reliableHiddenOffsets=p&&l[0].offsetHeight===0,q.innerHTML="",q.style.width=q.style.paddingLeft="1px",f.boxModel=b.boxModel=q.offsetWidth===2,typeof q.style.zoom!="undefined"&&(q.style.display="inline",q.style.zoom=1,b.inlineBlockNeedsLayout=q.offsetWidth===2,q.style.display="",q.innerHTML="<div style='width:4px;'></div>",b.shrinkWrapBlocks=q.offsetWidth!==2),q.style.cssText=k+m,q.innerHTML=o,d=q.firstChild,e=d.firstChild,h=d.nextSibling.firstChild.firstChild,i={doesNotAddBorder:e.offsetTop!==5,doesAddBorderForTableAndCells:h.offsetTop===5},e.style.position="fixed",e.style.top="20px",i.fixedPosition=e.offsetTop===20||e.offsetTop===15,e.style.position=e.style.top="",d.style.overflow="hidden",d.style.position="relative",i.subtractsBorderForOverflowNotVisible=e.offsetTop===-5,i.doesNotIncludeMarginInBodyOffset=r.offsetTop!==j,r.removeChild(a),q=a=null,f.extend(b,i))});return b}();var j=/^(?:\{.*\}|\[.*\])$/,k=/([A-Z])/g;f.extend({cache:{},uuid:0,expando:"jQuery"+(f.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(a){a=a.nodeType?f.cache[a[f.expando]]:a[f.expando];return!!a&&!m(a)},data:function(a,c,d,e){if(!!f.acceptData(a)){var g,h,i,j=f.expando,k=typeof c=="string",l=a.nodeType,m=l?f.cache:a,n=l?a[j]:a[j]&&j,o=c==="events";if((!n||!m[n]||!o&&!e&&!m[n].data)&&k&&d===b)return;n||(l?a[j]=n=++f.uuid:n=j),m[n]||(m[n]={},l||(m[n].toJSON=f.noop));if(typeof c=="object"||typeof c=="function")e?m[n]=f.extend(m[n],c):m[n].data=f.extend(m[n].data,c);g=h=m[n],e||(h.data||(h.data={}),h=h.data),d!==b&&(h[f.camelCase(c)]=d);if(o&&!h[c])return g.events;k?(i=h[c],i==null&&(i=h[f.camelCase(c)])):i=h;return i}},removeData:function(a,b,c){if(!!f.acceptData(a)){var d,e,g,h=f.expando,i=a.nodeType,j=i?f.cache:a,k=i?a[h]:h;if(!j[k])return;if(b){d=c?j[k]:j[k].data;if(d){f.isArray(b)||(b in d?b=[b]:(b=f.camelCase(b),b in d?b=[b]:b=b.split(" ")));for(e=0,g=b.length;e<g;e++)delete d[b[e]];if(!(c?m:f.isEmptyObject)(d))return}}if(!c){delete j[k].data;if(!m(j[k]))return}f.support.deleteExpando||!j.setInterval?delete j[k]:j[k]=null,i&&(f.support.deleteExpando?delete a[h]:a.removeAttribute?a.removeAttribute(h):a[h]=null)}},_data:function(a,b,c){return f.data(a,b,c,!0)},acceptData:function(a){if(a.nodeName){var b=f.noData[a.nodeName.toLowerCase()];if(b)return b!==!0&&a.getAttribute("classid")===b}return!0}}),f.fn.extend({data:function(a,c){var d,e,g,h=null;if(typeof a=="undefined"){if(this.length){h=f.data(this[0]);if(this[0].nodeType===1&&!f._data(this[0],"parsedAttrs")){e=this[0].attributes;for(var i=0,j=e.length;i<j;i++)g=e[i].name,g.indexOf("data-")===0&&(g=f.camelCase(g.substring(5)),l(this[0],g,h[g]));f._data(this[0],"parsedAttrs",!0)}}return h}if(typeof a=="object")return this.each(function(){f.data(this,a)});d=a.split("."),d[1]=d[1]?"."+d[1]:"";if(c===b){h=this.triggerHandler("getData"+d[1]+"!",[d[0]]),h===b&&this.length&&(h=f.data(this[0],a),h=l(this[0],a,h));return h===b&&d[1]?this.data(d[0]):h}return this.each(function(){var b=f(this),e=[d[0],c];b.triggerHandler("setData"+d[1]+"!",e),f.data(this,a,c),b.triggerHandler("changeData"+d[1]+"!",e)})},removeData:function(a){return this.each(function(){f.removeData(this,a)})}}),f.extend({_mark:function(a,b){a&&(b=(b||"fx")+"mark",f._data(a,b,(f._data(a,b)||0)+1))},_unmark:function(a,b,c){a!==!0&&(c=b,b=a,a=!1);if(b){c=c||"fx";var d=c+"mark",e=a?0:(f._data(b,d)||1)-1;e?f._data(b,d,e):(f.removeData(b,d,!0),n(b,c,"mark"))}},queue:function(a,b,c){var d;if(a){b=(b||"fx")+"queue",d=f._data(a,b),c&&(!d||f.isArray(c)?d=f._data(a,b,f.makeArray(c)):d.push(c));return d||[]}},dequeue:function(a,b){b=b||"fx";var c=f.queue(a,b),d=c.shift(),e={};d==="inprogress"&&(d=c.shift()),d&&(b==="fx"&&c.unshift("inprogress"),f._data(a,b+".run",e),d.call(a,function(){f.dequeue(a,b)},e)),c.length||(f.removeData(a,b+"queue "+b+".run",!0),n(a,b,"queue"))}}),f.fn.extend({queue:function(a,c){typeof a!="string"&&(c=a,a="fx");if(c===b)return f.queue(this[0],a);return this.each(function(){var b=f.queue(this,a,c);a==="fx"&&b[0]!=="inprogress"&&f.dequeue(this,a)})},dequeue:function(a){return this.each(function(){f.dequeue(this,a)})},delay:function(a,b){a=f.fx?f.fx.speeds[a]||a:a,b=b||"fx";return this.queue(b,function(b,c){var d=setTimeout(b,a);c.stop=function(){clearTimeout(d)}})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,c){function m(){--h||d.resolveWith(e,[e])}typeof a!="string"&&(c=a,a=b),a=a||"fx";var d=f.Deferred(),e=this,g=e.length,h=1,i=a+"defer",j=a+"queue",k=a+"mark",l;while(g--)if(l=f.data(e[g],i,b,!0)||(f.data(e[g],j,b,!0)||f.data(e[g],k,b,!0))&&f.data(e[g],i,f.Callbacks("once memory"),!0))h++,l.add(m);m();return d.promise()}});var o=/[\n\t\r]/g,p=/\s+/,q=/\r/g,r=/^(?:button|input)$/i,s=/^(?:button|input|object|select|textarea)$/i,t=/^a(?:rea)?$/i,u=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,v=f.support.getSetAttribute,w,x,y;f.fn.extend({attr:function(a,b){return f.access(this,a,b,!0,f.attr)},removeAttr:function(a){return this.each(function(){f.removeAttr(this,a)})},prop:function(a,b){return f.access(this,a,b,!0,f.prop)},removeProp:function(a){a=f.propFix[a]||a;return this.each(function(){try{this[a]=b,delete this[a]}catch(c){}})},addClass:function(a){var b,c,d,e,g,h,i;if(f.isFunction(a))return this.each(function(b){f(this).addClass(a.call(this,b,this.className))});if(a&&typeof a=="string"){b=a.split(p);for(c=0,d=this.length;c<d;c++){e=this[c];if(e.nodeType===1)if(!e.className&&b.length===1)e.className=a;else{g=" "+e.className+" ";for(h=0,i=b.length;h<i;h++)~g.indexOf(" "+b[h]+" ")||(g+=b[h]+" ");e.className=f.trim(g)}}}return this},removeClass:function(a){var c,d,e,g,h,i,j;if(f.isFunction(a))return this.each(function(b){f(this).removeClass(a.call(this,b,this.className))});if(a&&typeof a=="string"||a===b){c=(a||"").split(p);for(d=0,e=this.length;d<e;d++){g=this[d];if(g.nodeType===1&&g.className)if(a){h=(" "+g.className+" ").replace(o," ");for(i=0,j=c.length;i<j;i++)h=h.replace(" "+c[i]+" "," ");g.className=f.trim(h)}else g.className=""}}return this},toggleClass:function(a,b){var c=typeof a,d=typeof b=="boolean";if(f.isFunction(a))return this.each(function(c){f(this).toggleClass(a.call(this,c,this.className,b),b)});return this.each(function(){if(c==="string"){var e,g=0,h=f(this),i=b,j=a.split(p);while(e=j[g++])i=d?i:!h.hasClass(e),h[i?"addClass":"removeClass"](e)}else if(c==="undefined"||c==="boolean")this.className&&f._data(this,"__className__",this.className),this.className=this.className||a===!1?"":f._data(this,"__className__")||""})},hasClass:function(a){var b=" "+a+" ",c=0,d=this.length;for(;c<d;c++)if(this[c].nodeType===1&&(" "+this[c].className+" ").replace(o," ").indexOf(b)>-1)return!0;return!1},val:function(a){var c,d,e,g=this[0];{if(!!arguments.length){e=f.isFunction(a);return this.each(function(d){var g=f(this),h;if(this.nodeType===1){e?h=a.call(this,d,g.val()):h=a,h==null?h="":typeof h=="number"?h+="":f.isArray(h)&&(h=f.map(h,function(a){return a==null?"":a+""})),c=f.valHooks[this.nodeName.toLowerCase()]||f.valHooks[this.type];if(!c||!("set"in c)||c.set(this,h,"value")===b)this.value=h}})}if(g){c=f.valHooks[g.nodeName.toLowerCase()]||f.valHooks[g.type];if(c&&"get"in c&&(d=c.get(g,"value"))!==b)return d;d=g.value;return typeof d=="string"?d.replace(q,""):d==null?"":d}}}}),f.extend({valHooks:{option:{get:function(a){var b=a.attributes.value;return!b||b.specified?a.value:a.text}},select:{get:function(a){var b,c,d,e,g=a.selectedIndex,h=[],i=a.options,j=a.type==="select-one";if(g<0)return null;c=j?g:0,d=j?g+1:i.length;for(;c<d;c++){e=i[c];if(e.selected&&(f.support.optDisabled?!e.disabled:e.getAttribute("disabled")===null)&&(!e.parentNode.disabled||!f.nodeName(e.parentNode,"optgroup"))){b=f(e).val();if(j)return b;h.push(b)}}if(j&&!h.length&&i.length)return f(i[g]).val();return h},set:function(a,b){var c=f.makeArray(b);f(a).find("option").each(function(){this.selected=f.inArray(f(this).val(),c)>=0}),c.length||(a.selectedIndex=-1);return c}}},attrFn:{val:!0,css:!0,html:!0,text:!0,data:!0,width:!0,height:!0,offset:!0},attr:function(a,c,d,e){var g,h,i,j=a.nodeType;if(!!a&&j!==3&&j!==8&&j!==2){if(e&&c in f.attrFn)return f(a)[c](d);if(typeof a.getAttribute=="undefined")return f.prop(a,c,d);i=j!==1||!f.isXMLDoc(a),i&&(c=c.toLowerCase(),h=f.attrHooks[c]||(u.test(c)?x:w));if(d!==b){if(d===null){f.removeAttr(a,c);return}if(h&&"set"in h&&i&&(g=h.set(a,d,c))!==b)return g;a.setAttribute(c,""+d);return d}if(h&&"get"in h&&i&&(g=h.get(a,c))!==null)return g;g=a.getAttribute(c);return g===null?b:g}},removeAttr:function(a,b){var c,d,e,g,h=0;if(b&&a.nodeType===1){d=b.toLowerCase().split(p),g=d.length;for(;h<g;h++)e=d[h],e&&(c=f.propFix[e]||e,f.attr(a,e,""),a.removeAttribute(v?e:c),u.test(e)&&c in a&&(a[c]=!1))}},attrHooks:{type:{set:function(a,b){if(r.test(a.nodeName)&&a.parentNode)f.error("type property can't be changed");else if(!f.support.radioValue&&b==="radio"&&f.nodeName(a,"input")){var c=a.value;a.setAttribute("type",b),c&&(a.value=c);return b}}},value:{get:function(a,b){if(w&&f.nodeName(a,"button"))return w.get(a,b);return b in a?a.value:null},set:function(a,b,c){if(w&&f.nodeName(a,"button"))return w.set(a,b,c);a.value=b}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(a,c,d){var e,g,h,i=a.nodeType;if(!!a&&i!==3&&i!==8&&i!==2){h=i!==1||!f.isXMLDoc(a),h&&(c=f.propFix[c]||c,g=f.propHooks[c]);return d!==b?g&&"set"in g&&(e=g.set(a,d,c))!==b?e:a[c]=d:g&&"get"in g&&(e=g.get(a,c))!==null?e:a[c]}},propHooks:{tabIndex:{get:function(a){var c=a.getAttributeNode("tabindex");return c&&c.specified?parseInt(c.value,10):s.test(a.nodeName)||t.test(a.nodeName)&&a.href?0:b}}}}),f.attrHooks.tabindex=f.propHooks.tabIndex,x={get:function(a,c){var d,e=f.prop(a,c);return e===!0||typeof e!="boolean"&&(d=a.getAttributeNode(c))&&d.nodeValue!==!1?c.toLowerCase():b},set:function(a,b,c){var d;b===!1?f.removeAttr(a,c):(d=f.propFix[c]||c,d in a&&(a[d]=!0),a.setAttribute(c,c.toLowerCase()));return c}},v||(y={name:!0,id:!0},w=f.valHooks.button={get:function(a,c){var d;d=a.getAttributeNode(c);return d&&(y[c]?d.nodeValue!=="":d.specified)?d.nodeValue:b},set:function(a,b,d){var e=a.getAttributeNode(d);e||(e=c.createAttribute(d),a.setAttributeNode(e));return e.nodeValue=b+""}},f.attrHooks.tabindex.set=w.set,f.each(["width","height"],function(a,b){f.attrHooks[b]=f.extend(f.attrHooks[b],{set:function(a,c){if(c===""){a.setAttribute(b,"auto");return c}}})}),f.attrHooks.contenteditable={get:w.get,set:function(a,b,c){b===""&&(b="false"),w.set(a,b,c)}}),f.support.hrefNormalized||f.each(["href","src","width","height"],function(a,c){f.attrHooks[c]=f.extend(f.attrHooks[c],{get:function(a){var d=a.getAttribute(c,2);return d===null?b:d}})}),f.support.style||(f.attrHooks.style={get:function(a){return a.style.cssText.toLowerCase()||b},set:function(a,b){return a.style.cssText=""+b}}),f.support.optSelected||(f.propHooks.selected=f.extend(f.propHooks.selected,{get:function(a){var b=a.parentNode;b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex);return null}})),f.support.enctype||(f.propFix.enctype="encoding"),f.support.checkOn||f.each(["radio","checkbox"],function(){f.valHooks[this]={get:function(a){return a.getAttribute("value")===null?"on":a.value}}}),f.each(["radio","checkbox"],function(){f.valHooks[this]=f.extend(f.valHooks[this],{set:function(a,b){if(f.isArray(b))return a.checked=f.inArray(f(a).val(),b)>=0}})});var z=/^(?:textarea|input|select)$/i,A=/^([^\.]*)?(?:\.(.+))?$/,B=/\bhover(\.\S+)?\b/,C=/^key/,D=/^(?:mouse|contextmenu)|click/,E=/^(?:focusinfocus|focusoutblur)$/,F=/^(\w*)(?:#([\w\-]+))?(?:\.([\w\-]+))?$/,G=function(a){var b=F.exec(a);b&&(b[1]=(b[1]||"").toLowerCase(),b[3]=b[3]&&new RegExp("(?:^|\\s)"+b[3]+"(?:\\s|$)"));return b},H=function(a,b){var c=a.attributes||{};return(!b[1]||a.nodeName.toLowerCase()===b[1])&&(!b[2]||(c.id||{}).value===b[2])&&(!b[3]||b[3].test((c["class"]||{}).value))},I=function(a){return f.event.special.hover?a:a.replace(B,"mouseenter$1 mouseleave$1")};
f.event={add:function(a,c,d,e,g){var h,i,j,k,l,m,n,o,p,q,r,s;if(!(a.nodeType===3||a.nodeType===8||!c||!d||!(h=f._data(a)))){d.handler&&(p=d,d=p.handler),d.guid||(d.guid=f.guid++),j=h.events,j||(h.events=j={}),i=h.handle,i||(h.handle=i=function(a){return typeof f!="undefined"&&(!a||f.event.triggered!==a.type)?f.event.dispatch.apply(i.elem,arguments):b},i.elem=a),c=f.trim(I(c)).split(" ");for(k=0;k<c.length;k++){l=A.exec(c[k])||[],m=l[1],n=(l[2]||"").split(".").sort(),s=f.event.special[m]||{},m=(g?s.delegateType:s.bindType)||m,s=f.event.special[m]||{},o=f.extend({type:m,origType:l[1],data:e,handler:d,guid:d.guid,selector:g,quick:G(g),namespace:n.join(".")},p),r=j[m];if(!r){r=j[m]=[],r.delegateCount=0;if(!s.setup||s.setup.call(a,e,n,i)===!1)a.addEventListener?a.addEventListener(m,i,!1):a.attachEvent&&a.attachEvent("on"+m,i)}s.add&&(s.add.call(a,o),o.handler.guid||(o.handler.guid=d.guid)),g?r.splice(r.delegateCount++,0,o):r.push(o),f.event.global[m]=!0}a=null}},global:{},remove:function(a,b,c,d,e){var g=f.hasData(a)&&f._data(a),h,i,j,k,l,m,n,o,p,q,r,s;if(!!g&&!!(o=g.events)){b=f.trim(I(b||"")).split(" ");for(h=0;h<b.length;h++){i=A.exec(b[h])||[],j=k=i[1],l=i[2];if(!j){for(j in o)f.event.remove(a,j+b[h],c,d,!0);continue}p=f.event.special[j]||{},j=(d?p.delegateType:p.bindType)||j,r=o[j]||[],m=r.length,l=l?new RegExp("(^|\\.)"+l.split(".").sort().join("\\.(?:.*\\.)?")+"(\\.|$)"):null;for(n=0;n<r.length;n++)s=r[n],(e||k===s.origType)&&(!c||c.guid===s.guid)&&(!l||l.test(s.namespace))&&(!d||d===s.selector||d==="**"&&s.selector)&&(r.splice(n--,1),s.selector&&r.delegateCount--,p.remove&&p.remove.call(a,s));r.length===0&&m!==r.length&&((!p.teardown||p.teardown.call(a,l)===!1)&&f.removeEvent(a,j,g.handle),delete o[j])}f.isEmptyObject(o)&&(q=g.handle,q&&(q.elem=null),f.removeData(a,["events","handle"],!0))}},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(c,d,e,g){if(!e||e.nodeType!==3&&e.nodeType!==8){var h=c.type||c,i=[],j,k,l,m,n,o,p,q,r,s;if(E.test(h+f.event.triggered))return;h.indexOf("!")>=0&&(h=h.slice(0,-1),k=!0),h.indexOf(".")>=0&&(i=h.split("."),h=i.shift(),i.sort());if((!e||f.event.customEvent[h])&&!f.event.global[h])return;c=typeof c=="object"?c[f.expando]?c:new f.Event(h,c):new f.Event(h),c.type=h,c.isTrigger=!0,c.exclusive=k,c.namespace=i.join("."),c.namespace_re=c.namespace?new RegExp("(^|\\.)"+i.join("\\.(?:.*\\.)?")+"(\\.|$)"):null,o=h.indexOf(":")<0?"on"+h:"";if(!e){j=f.cache;for(l in j)j[l].events&&j[l].events[h]&&f.event.trigger(c,d,j[l].handle.elem,!0);return}c.result=b,c.target||(c.target=e),d=d!=null?f.makeArray(d):[],d.unshift(c),p=f.event.special[h]||{};if(p.trigger&&p.trigger.apply(e,d)===!1)return;r=[[e,p.bindType||h]];if(!g&&!p.noBubble&&!f.isWindow(e)){s=p.delegateType||h,m=E.test(s+h)?e:e.parentNode,n=null;for(;m;m=m.parentNode)r.push([m,s]),n=m;n&&n===e.ownerDocument&&r.push([n.defaultView||n.parentWindow||a,s])}for(l=0;l<r.length&&!c.isPropagationStopped();l++)m=r[l][0],c.type=r[l][1],q=(f._data(m,"events")||{})[c.type]&&f._data(m,"handle"),q&&q.apply(m,d),q=o&&m[o],q&&f.acceptData(m)&&q.apply(m,d)===!1&&c.preventDefault();c.type=h,!g&&!c.isDefaultPrevented()&&(!p._default||p._default.apply(e.ownerDocument,d)===!1)&&(h!=="click"||!f.nodeName(e,"a"))&&f.acceptData(e)&&o&&e[h]&&(h!=="focus"&&h!=="blur"||c.target.offsetWidth!==0)&&!f.isWindow(e)&&(n=e[o],n&&(e[o]=null),f.event.triggered=h,e[h](),f.event.triggered=b,n&&(e[o]=n));return c.result}},dispatch:function(c){c=f.event.fix(c||a.event);var d=(f._data(this,"events")||{})[c.type]||[],e=d.delegateCount,g=[].slice.call(arguments,0),h=!c.exclusive&&!c.namespace,i=[],j,k,l,m,n,o,p,q,r,s,t;g[0]=c,c.delegateTarget=this;if(e&&!c.target.disabled&&(!c.button||c.type!=="click")){m=f(this),m.context=this.ownerDocument||this;for(l=c.target;l!=this;l=l.parentNode||this){o={},q=[],m[0]=l;for(j=0;j<e;j++)r=d[j],s=r.selector,o[s]===b&&(o[s]=r.quick?H(l,r.quick):m.is(s)),o[s]&&q.push(r);q.length&&i.push({elem:l,matches:q})}}d.length>e&&i.push({elem:this,matches:d.slice(e)});for(j=0;j<i.length&&!c.isPropagationStopped();j++){p=i[j],c.currentTarget=p.elem;for(k=0;k<p.matches.length&&!c.isImmediatePropagationStopped();k++){r=p.matches[k];if(h||!c.namespace&&!r.namespace||c.namespace_re&&c.namespace_re.test(r.namespace))c.data=r.data,c.handleObj=r,n=((f.event.special[r.origType]||{}).handle||r.handler).apply(p.elem,g),n!==b&&(c.result=n,n===!1&&(c.preventDefault(),c.stopPropagation()))}}return c.result},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){a.which==null&&(a.which=b.charCode!=null?b.charCode:b.keyCode);return a}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,d){var e,f,g,h=d.button,i=d.fromElement;a.pageX==null&&d.clientX!=null&&(e=a.target.ownerDocument||c,f=e.documentElement,g=e.body,a.pageX=d.clientX+(f&&f.scrollLeft||g&&g.scrollLeft||0)-(f&&f.clientLeft||g&&g.clientLeft||0),a.pageY=d.clientY+(f&&f.scrollTop||g&&g.scrollTop||0)-(f&&f.clientTop||g&&g.clientTop||0)),!a.relatedTarget&&i&&(a.relatedTarget=i===a.target?d.toElement:i),!a.which&&h!==b&&(a.which=h&1?1:h&2?3:h&4?2:0);return a}},fix:function(a){if(a[f.expando])return a;var d,e,g=a,h=f.event.fixHooks[a.type]||{},i=h.props?this.props.concat(h.props):this.props;a=f.Event(g);for(d=i.length;d;)e=i[--d],a[e]=g[e];a.target||(a.target=g.srcElement||c),a.target.nodeType===3&&(a.target=a.target.parentNode),a.metaKey===b&&(a.metaKey=a.ctrlKey);return h.filter?h.filter(a,g):a},special:{ready:{setup:f.bindReady},load:{noBubble:!0},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(a,b,c){f.isWindow(this)&&(this.onbeforeunload=c)},teardown:function(a,b){this.onbeforeunload===b&&(this.onbeforeunload=null)}}},simulate:function(a,b,c,d){var e=f.extend(new f.Event,c,{type:a,isSimulated:!0,originalEvent:{}});d?f.event.trigger(e,null,b):f.event.dispatch.call(b,e),e.isDefaultPrevented()&&c.preventDefault()}},f.event.handle=f.event.dispatch,f.removeEvent=c.removeEventListener?function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)}:function(a,b,c){a.detachEvent&&a.detachEvent("on"+b,c)},f.Event=function(a,b){if(!(this instanceof f.Event))return new f.Event(a,b);a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||a.returnValue===!1||a.getPreventDefault&&a.getPreventDefault()?K:J):this.type=a,b&&f.extend(this,b),this.timeStamp=a&&a.timeStamp||f.now(),this[f.expando]=!0},f.Event.prototype={preventDefault:function(){this.isDefaultPrevented=K;var a=this.originalEvent;!a||(a.preventDefault?a.preventDefault():a.returnValue=!1)},stopPropagation:function(){this.isPropagationStopped=K;var a=this.originalEvent;!a||(a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=K,this.stopPropagation()},isDefaultPrevented:J,isPropagationStopped:J,isImmediatePropagationStopped:J},f.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(a,b){f.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c=this,d=a.relatedTarget,e=a.handleObj,g=e.selector,h;if(!d||d!==c&&!f.contains(c,d))a.type=e.origType,h=e.handler.apply(this,arguments),a.type=b;return h}}}),f.support.submitBubbles||(f.event.special.submit={setup:function(){if(f.nodeName(this,"form"))return!1;f.event.add(this,"click._submit keypress._submit",function(a){var c=a.target,d=f.nodeName(c,"input")||f.nodeName(c,"button")?c.form:b;d&&!d._submit_attached&&(f.event.add(d,"submit._submit",function(a){this.parentNode&&!a.isTrigger&&f.event.simulate("submit",this.parentNode,a,!0)}),d._submit_attached=!0)})},teardown:function(){if(f.nodeName(this,"form"))return!1;f.event.remove(this,"._submit")}}),f.support.changeBubbles||(f.event.special.change={setup:function(){if(z.test(this.nodeName)){if(this.type==="checkbox"||this.type==="radio")f.event.add(this,"propertychange._change",function(a){a.originalEvent.propertyName==="checked"&&(this._just_changed=!0)}),f.event.add(this,"click._change",function(a){this._just_changed&&!a.isTrigger&&(this._just_changed=!1,f.event.simulate("change",this,a,!0))});return!1}f.event.add(this,"beforeactivate._change",function(a){var b=a.target;z.test(b.nodeName)&&!b._change_attached&&(f.event.add(b,"change._change",function(a){this.parentNode&&!a.isSimulated&&!a.isTrigger&&f.event.simulate("change",this.parentNode,a,!0)}),b._change_attached=!0)})},handle:function(a){var b=a.target;if(this!==b||a.isSimulated||a.isTrigger||b.type!=="radio"&&b.type!=="checkbox")return a.handleObj.handler.apply(this,arguments)},teardown:function(){f.event.remove(this,"._change");return z.test(this.nodeName)}}),f.support.focusinBubbles||f.each({focus:"focusin",blur:"focusout"},function(a,b){var d=0,e=function(a){f.event.simulate(b,a.target,f.event.fix(a),!0)};f.event.special[b]={setup:function(){d++===0&&c.addEventListener(a,e,!0)},teardown:function(){--d===0&&c.removeEventListener(a,e,!0)}}}),f.fn.extend({on:function(a,c,d,e,g){var h,i;if(typeof a=="object"){typeof c!="string"&&(d=c,c=b);for(i in a)this.on(i,c,d,a[i],g);return this}d==null&&e==null?(e=c,d=c=b):e==null&&(typeof c=="string"?(e=d,d=b):(e=d,d=c,c=b));if(e===!1)e=J;else if(!e)return this;g===1&&(h=e,e=function(a){f().off(a);return h.apply(this,arguments)},e.guid=h.guid||(h.guid=f.guid++));return this.each(function(){f.event.add(this,a,e,d,c)})},one:function(a,b,c,d){return this.on.call(this,a,b,c,d,1)},off:function(a,c,d){if(a&&a.preventDefault&&a.handleObj){var e=a.handleObj;f(a.delegateTarget).off(e.namespace?e.type+"."+e.namespace:e.type,e.selector,e.handler);return this}if(typeof a=="object"){for(var g in a)this.off(g,c,a[g]);return this}if(c===!1||typeof c=="function")d=c,c=b;d===!1&&(d=J);return this.each(function(){f.event.remove(this,a,d,c)})},bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},live:function(a,b,c){f(this.context).on(a,this.selector,b,c);return this},die:function(a,b){f(this.context).off(a,this.selector||"**",b);return this},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return arguments.length==1?this.off(a,"**"):this.off(b,a,c)},trigger:function(a,b){return this.each(function(){f.event.trigger(a,b,this)})},triggerHandler:function(a,b){if(this[0])return f.event.trigger(a,b,this[0],!0)},toggle:function(a){var b=arguments,c=a.guid||f.guid++,d=0,e=function(c){var e=(f._data(this,"lastToggle"+a.guid)||0)%d;f._data(this,"lastToggle"+a.guid,e+1),c.preventDefault();return b[e].apply(this,arguments)||!1};e.guid=c;while(d<b.length)b[d++].guid=c;return this.click(e)},hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)}}),f.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){f.fn[b]=function(a,c){c==null&&(c=a,a=null);return arguments.length>0?this.on(b,null,a,c):this.trigger(b)},f.attrFn&&(f.attrFn[b]=!0),C.test(b)&&(f.event.fixHooks[b]=f.event.keyHooks),D.test(b)&&(f.event.fixHooks[b]=f.event.mouseHooks)}),function(){function x(a,b,c,e,f,g){for(var h=0,i=e.length;h<i;h++){var j=e[h];if(j){var k=!1;j=j[a];while(j){if(j[d]===c){k=e[j.sizset];break}if(j.nodeType===1){g||(j[d]=c,j.sizset=h);if(typeof b!="string"){if(j===b){k=!0;break}}else if(m.filter(b,[j]).length>0){k=j;break}}j=j[a]}e[h]=k}}}function w(a,b,c,e,f,g){for(var h=0,i=e.length;h<i;h++){var j=e[h];if(j){var k=!1;j=j[a];while(j){if(j[d]===c){k=e[j.sizset];break}j.nodeType===1&&!g&&(j[d]=c,j.sizset=h);if(j.nodeName.toLowerCase()===b){k=j;break}j=j[a]}e[h]=k}}}var a=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^\[\]]*\]|['"][^'"]*['"]|[^\[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,d="sizcache"+(Math.random()+"").replace(".",""),e=0,g=Object.prototype.toString,h=!1,i=!0,j=/\\/g,k=/\r\n/g,l=/\W/;[0,0].sort(function(){i=!1;return 0});var m=function(b,d,e,f){e=e||[],d=d||c;var h=d;if(d.nodeType!==1&&d.nodeType!==9)return[];if(!b||typeof b!="string")return e;var i,j,k,l,n,q,r,t,u=!0,v=m.isXML(d),w=[],x=b;do{a.exec(""),i=a.exec(x);if(i){x=i[3],w.push(i[1]);if(i[2]){l=i[3];break}}}while(i);if(w.length>1&&p.exec(b))if(w.length===2&&o.relative[w[0]])j=y(w[0]+w[1],d,f);else{j=o.relative[w[0]]?[d]:m(w.shift(),d);while(w.length)b=w.shift(),o.relative[b]&&(b+=w.shift()),j=y(b,j,f)}else{!f&&w.length>1&&d.nodeType===9&&!v&&o.match.ID.test(w[0])&&!o.match.ID.test(w[w.length-1])&&(n=m.find(w.shift(),d,v),d=n.expr?m.filter(n.expr,n.set)[0]:n.set[0]);if(d){n=f?{expr:w.pop(),set:s(f)}:m.find(w.pop(),w.length===1&&(w[0]==="~"||w[0]==="+")&&d.parentNode?d.parentNode:d,v),j=n.expr?m.filter(n.expr,n.set):n.set,w.length>0?k=s(j):u=!1;while(w.length)q=w.pop(),r=q,o.relative[q]?r=w.pop():q="",r==null&&(r=d),o.relative[q](k,r,v)}else k=w=[]}k||(k=j),k||m.error(q||b);if(g.call(k)==="[object Array]")if(!u)e.push.apply(e,k);else if(d&&d.nodeType===1)for(t=0;k[t]!=null;t++)k[t]&&(k[t]===!0||k[t].nodeType===1&&m.contains(d,k[t]))&&e.push(j[t]);else for(t=0;k[t]!=null;t++)k[t]&&k[t].nodeType===1&&e.push(j[t]);else s(k,e);l&&(m(l,h,e,f),m.uniqueSort(e));return e};m.uniqueSort=function(a){if(u){h=i,a.sort(u);if(h)for(var b=1;b<a.length;b++)a[b]===a[b-1]&&a.splice(b--,1)}return a},m.matches=function(a,b){return m(a,null,null,b)},m.matchesSelector=function(a,b){return m(b,null,null,[a]).length>0},m.find=function(a,b,c){var d,e,f,g,h,i;if(!a)return[];for(e=0,f=o.order.length;e<f;e++){h=o.order[e];if(g=o.leftMatch[h].exec(a)){i=g[1],g.splice(1,1);if(i.substr(i.length-1)!=="\\"){g[1]=(g[1]||"").replace(j,""),d=o.find[h](g,b,c);if(d!=null){a=a.replace(o.match[h],"");break}}}}d||(d=typeof b.getElementsByTagName!="undefined"?b.getElementsByTagName("*"):[]);return{set:d,expr:a}},m.filter=function(a,c,d,e){var f,g,h,i,j,k,l,n,p,q=a,r=[],s=c,t=c&&c[0]&&m.isXML(c[0]);while(a&&c.length){for(h in o.filter)if((f=o.leftMatch[h].exec(a))!=null&&f[2]){k=o.filter[h],l=f[1],g=!1,f.splice(1,1);if(l.substr(l.length-1)==="\\")continue;s===r&&(r=[]);if(o.preFilter[h]){f=o.preFilter[h](f,s,d,r,e,t);if(!f)g=i=!0;else if(f===!0)continue}if(f)for(n=0;(j=s[n])!=null;n++)j&&(i=k(j,f,n,s),p=e^i,d&&i!=null?p?g=!0:s[n]=!1:p&&(r.push(j),g=!0));if(i!==b){d||(s=r),a=a.replace(o.match[h],"");if(!g)return[];break}}if(a===q)if(g==null)m.error(a);else break;q=a}return s},m.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)};var n=m.getText=function(a){var b,c,d=a.nodeType,e="";if(d){if(d===1||d===9){if(typeof a.textContent=="string")return a.textContent;if(typeof a.innerText=="string")return a.innerText.replace(k,"");for(a=a.firstChild;a;a=a.nextSibling)e+=n(a)}else if(d===3||d===4)return a.nodeValue}else for(b=0;c=a[b];b++)c.nodeType!==8&&(e+=n(c));return e},o=m.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF\-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF\-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF\-]|\\.)+)\s*(?:(\S?=)\s*(?:(['"])(.*?)\3|(#?(?:[\w\u00c0-\uFFFF\-]|\\.)*)|)|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*\-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\(\s*(even|odd|(?:[+\-]?\d+|(?:[+\-]?\d*)?n\s*(?:[+\-]\s*\d+)?))\s*\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^\-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF\-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(a){return a.getAttribute("href")},type:function(a){return a.getAttribute("type")}},relative:{"+":function(a,b){var c=typeof b=="string",d=c&&!l.test(b),e=c&&!d;d&&(b=b.toLowerCase());for(var f=0,g=a.length,h;f<g;f++)if(h=a[f]){while((h=h.previousSibling)&&h.nodeType!==1);a[f]=e||h&&h.nodeName.toLowerCase()===b?h||!1:h===b}e&&m.filter(b,a,!0)},">":function(a,b){var c,d=typeof b=="string",e=0,f=a.length;if(d&&!l.test(b)){b=b.toLowerCase();for(;e<f;e++){c=a[e];if(c){var g=c.parentNode;a[e]=g.nodeName.toLowerCase()===b?g:!1}}}else{for(;e<f;e++)c=a[e],c&&(a[e]=d?c.parentNode:c.parentNode===b);d&&m.filter(b,a,!0)}},"":function(a,b,c){var d,f=e++,g=x;typeof b=="string"&&!l.test(b)&&(b=b.toLowerCase(),d=b,g=w),g("parentNode",b,f,a,d,c)},"~":function(a,b,c){var d,f=e++,g=x;typeof b=="string"&&!l.test(b)&&(b=b.toLowerCase(),d=b,g=w),g("previousSibling",b,f,a,d,c)}},find:{ID:function(a,b,c){if(typeof b.getElementById!="undefined"&&!c){var d=b.getElementById(a[1]);return d&&d.parentNode?[d]:[]}},NAME:function(a,b){if(typeof b.getElementsByName!="undefined"){var c=[],d=b.getElementsByName(a[1]);for(var e=0,f=d.length;e<f;e++)d[e].getAttribute("name")===a[1]&&c.push(d[e]);return c.length===0?null:c}},TAG:function(a,b){if(typeof b.getElementsByTagName!="undefined")return b.getElementsByTagName(a[1])}},preFilter:{CLASS:function(a,b,c,d,e,f){a=" "+a[1].replace(j,"")+" ";if(f)return a;for(var g=0,h;(h=b[g])!=null;g++)h&&(e^(h.className&&(" "+h.className+" ").replace(/[\t\n\r]/g," ").indexOf(a)>=0)?c||d.push(h):c&&(b[g]=!1));return!1},ID:function(a){return a[1].replace(j,"")},TAG:function(a,b){return a[1].replace(j,"").toLowerCase()},CHILD:function(a){if(a[1]==="nth"){a[2]||m.error(a[0]),a[2]=a[2].replace(/^\+|\s*/g,"");var b=/(-?)(\d*)(?:n([+\-]?\d*))?/.exec(a[2]==="even"&&"2n"||a[2]==="odd"&&"2n+1"||!/\D/.test(a[2])&&"0n+"+a[2]||a[2]);a[2]=b[1]+(b[2]||1)-0,a[3]=b[3]-0}else a[2]&&m.error(a[0]);a[0]=e++;return a},ATTR:function(a,b,c,d,e,f){var g=a[1]=a[1].replace(j,"");!f&&o.attrMap[g]&&(a[1]=o.attrMap[g]),a[4]=(a[4]||a[5]||"").replace(j,""),a[2]==="~="&&(a[4]=" "+a[4]+" ");return a},PSEUDO:function(b,c,d,e,f){if(b[1]==="not")if((a.exec(b[3])||"").length>1||/^\w/.test(b[3]))b[3]=m(b[3],null,null,c);else{var g=m.filter(b[3],c,d,!0^f);d||e.push.apply(e,g);return!1}else if(o.match.POS.test(b[0])||o.match.CHILD.test(b[0]))return!0;return b},POS:function(a){a.unshift(!0);return a}},filters:{enabled:function(a){return a.disabled===!1&&a.type!=="hidden"},disabled:function(a){return a.disabled===!0},checked:function(a){return a.checked===!0},selected:function(a){a.parentNode&&a.parentNode.selectedIndex;return a.selected===!0},parent:function(a){return!!a.firstChild},empty:function(a){return!a.firstChild},has:function(a,b,c){return!!m(c[3],a).length},header:function(a){return/h\d/i.test(a.nodeName)},text:function(a){var b=a.getAttribute("type"),c=a.type;return a.nodeName.toLowerCase()==="input"&&"text"===c&&(b===c||b===null)},radio:function(a){return a.nodeName.toLowerCase()==="input"&&"radio"===a.type},checkbox:function(a){return a.nodeName.toLowerCase()==="input"&&"checkbox"===a.type},file:function(a){return a.nodeName.toLowerCase()==="input"&&"file"===a.type},password:function(a){return a.nodeName.toLowerCase()==="input"&&"password"===a.type},submit:function(a){var b=a.nodeName.toLowerCase();return(b==="input"||b==="button")&&"submit"===a.type},image:function(a){return a.nodeName.toLowerCase()==="input"&&"image"===a.type},reset:function(a){var b=a.nodeName.toLowerCase();return(b==="input"||b==="button")&&"reset"===a.type},button:function(a){var b=a.nodeName.toLowerCase();return b==="input"&&"button"===a.type||b==="button"},input:function(a){return/input|select|textarea|button/i.test(a.nodeName)},focus:function(a){return a===a.ownerDocument.activeElement}},setFilters:{first:function(a,b){return b===0},last:function(a,b,c,d){return b===d.length-1},even:function(a,b){return b%2===0},odd:function(a,b){return b%2===1},lt:function(a,b,c){return b<c[3]-0},gt:function(a,b,c){return b>c[3]-0},nth:function(a,b,c){return c[3]-0===b},eq:function(a,b,c){return c[3]-0===b}},filter:{PSEUDO:function(a,b,c,d){var e=b[1],f=o.filters[e];if(f)return f(a,c,b,d);if(e==="contains")return(a.textContent||a.innerText||n([a])||"").indexOf(b[3])>=0;if(e==="not"){var g=b[3];for(var h=0,i=g.length;h<i;h++)if(g[h]===a)return!1;return!0}m.error(e)},CHILD:function(a,b){var c,e,f,g,h,i,j,k=b[1],l=a;switch(k){case"only":case"first":while(l=l.previousSibling)if(l.nodeType===1)return!1;if(k==="first")return!0;l=a;case"last":while(l=l.nextSibling)if(l.nodeType===1)return!1;return!0;case"nth":c=b[2],e=b[3];if(c===1&&e===0)return!0;f=b[0],g=a.parentNode;if(g&&(g[d]!==f||!a.nodeIndex)){i=0;for(l=g.firstChild;l;l=l.nextSibling)l.nodeType===1&&(l.nodeIndex=++i);g[d]=f}j=a.nodeIndex-e;return c===0?j===0:j%c===0&&j/c>=0}},ID:function(a,b){return a.nodeType===1&&a.getAttribute("id")===b},TAG:function(a,b){return b==="*"&&a.nodeType===1||!!a.nodeName&&a.nodeName.toLowerCase()===b},CLASS:function(a,b){return(" "+(a.className||a.getAttribute("class"))+" ").indexOf(b)>-1},ATTR:function(a,b){var c=b[1],d=m.attr?m.attr(a,c):o.attrHandle[c]?o.attrHandle[c](a):a[c]!=null?a[c]:a.getAttribute(c),e=d+"",f=b[2],g=b[4];return d==null?f==="!=":!f&&m.attr?d!=null:f==="="?e===g:f==="*="?e.indexOf(g)>=0:f==="~="?(" "+e+" ").indexOf(g)>=0:g?f==="!="?e!==g:f==="^="?e.indexOf(g)===0:f==="$="?e.substr(e.length-g.length)===g:f==="|="?e===g||e.substr(0,g.length+1)===g+"-":!1:e&&d!==!1},POS:function(a,b,c,d){var e=b[2],f=o.setFilters[e];if(f)return f(a,c,b,d)}}},p=o.match.POS,q=function(a,b){return"\\"+(b-0+1)};for(var r in o.match)o.match[r]=new RegExp(o.match[r].source+/(?![^\[]*\])(?![^\(]*\))/.source),o.leftMatch[r]=new RegExp(/(^(?:.|\r|\n)*?)/.source+o.match[r].source.replace(/\\(\d+)/g,q));var s=function(a,b){a=Array.prototype.slice.call(a,0);if(b){b.push.apply(b,a);return b}return a};try{Array.prototype.slice.call(c.documentElement.childNodes,0)[0].nodeType}catch(t){s=function(a,b){var c=0,d=b||[];if(g.call(a)==="[object Array]")Array.prototype.push.apply(d,a);else if(typeof a.length=="number")for(var e=a.length;c<e;c++)d.push(a[c]);else for(;a[c];c++)d.push(a[c]);return d}}var u,v;c.documentElement.compareDocumentPosition?u=function(a,b){if(a===b){h=!0;return 0}if(!a.compareDocumentPosition||!b.compareDocumentPosition)return a.compareDocumentPosition?-1:1;return a.compareDocumentPosition(b)&4?-1:1}:(u=function(a,b){if(a===b){h=!0;return 0}if(a.sourceIndex&&b.sourceIndex)return a.sourceIndex-b.sourceIndex;var c,d,e=[],f=[],g=a.parentNode,i=b.parentNode,j=g;if(g===i)return v(a,b);if(!g)return-1;if(!i)return 1;while(j)e.unshift(j),j=j.parentNode;j=i;while(j)f.unshift(j),j=j.parentNode;c=e.length,d=f.length;for(var k=0;k<c&&k<d;k++)if(e[k]!==f[k])return v(e[k],f[k]);return k===c?v(a,f[k],-1):v(e[k],b,1)},v=function(a,b,c){if(a===b)return c;var d=a.nextSibling;while(d){if(d===b)return-1;d=d.nextSibling}return 1}),function(){var a=c.createElement("div"),d="script"+(new Date).getTime(),e=c.documentElement;a.innerHTML="<a name='"+d+"'/>",e.insertBefore(a,e.firstChild),c.getElementById(d)&&(o.find.ID=function(a,c,d){if(typeof c.getElementById!="undefined"&&!d){var e=c.getElementById(a[1]);return e?e.id===a[1]||typeof e.getAttributeNode!="undefined"&&e.getAttributeNode("id").nodeValue===a[1]?[e]:b:[]}},o.filter.ID=function(a,b){var c=typeof a.getAttributeNode!="undefined"&&a.getAttributeNode("id");return a.nodeType===1&&c&&c.nodeValue===b}),e.removeChild(a),e=a=null}(),function(){var a=c.createElement("div");a.appendChild(c.createComment("")),a.getElementsByTagName("*").length>0&&(o.find.TAG=function(a,b){var c=b.getElementsByTagName(a[1]);if(a[1]==="*"){var d=[];for(var e=0;c[e];e++)c[e].nodeType===1&&d.push(c[e]);c=d}return c}),a.innerHTML="<a href='#'></a>",a.firstChild&&typeof a.firstChild.getAttribute!="undefined"&&a.firstChild.getAttribute("href")!=="#"&&(o.attrHandle.href=function(a){return a.getAttribute("href",2)}),a=null}(),c.querySelectorAll&&function(){var a=m,b=c.createElement("div"),d="__sizzle__";b.innerHTML="<p class='TEST'></p>";if(!b.querySelectorAll||b.querySelectorAll(".TEST").length!==0){m=function(b,e,f,g){e=e||c;if(!g&&!m.isXML(e)){var h=/^(\w+$)|^\.([\w\-]+$)|^#([\w\-]+$)/.exec(b);if(h&&(e.nodeType===1||e.nodeType===9)){if(h[1])return s(e.getElementsByTagName(b),f);if(h[2]&&o.find.CLASS&&e.getElementsByClassName)return s(e.getElementsByClassName(h[2]),f)}if(e.nodeType===9){if(b==="body"&&e.body)return s([e.body],f);if(h&&h[3]){var i=e.getElementById(h[3]);if(!i||!i.parentNode)return s([],f);if(i.id===h[3])return s([i],f)}try{return s(e.querySelectorAll(b),f)}catch(j){}}else if(e.nodeType===1&&e.nodeName.toLowerCase()!=="object"){var k=e,l=e.getAttribute("id"),n=l||d,p=e.parentNode,q=/^\s*[+~]/.test(b);l?n=n.replace(/'/g,"\\$&"):e.setAttribute("id",n),q&&p&&(e=e.parentNode);try{if(!q||p)return s(e.querySelectorAll("[id='"+n+"'] "+b),f)}catch(r){}finally{l||k.removeAttribute("id")}}}return a(b,e,f,g)};for(var e in a)m[e]=a[e];b=null}}(),function(){var a=c.documentElement,b=a.matchesSelector||a.mozMatchesSelector||a.webkitMatchesSelector||a.msMatchesSelector;if(b){var d=!b.call(c.createElement("div"),"div"),e=!1;try{b.call(c.documentElement,"[test!='']:sizzle")}catch(f){e=!0}m.matchesSelector=function(a,c){c=c.replace(/\=\s*([^'"\]]*)\s*\]/g,"='$1']");if(!m.isXML(a))try{if(e||!o.match.PSEUDO.test(c)&&!/!=/.test(c)){var f=b.call(a,c);if(f||!d||a.document&&a.document.nodeType!==11)return f}}catch(g){}return m(c,null,null,[a]).length>0}}}(),function(){var a=c.createElement("div");a.innerHTML="<div class='test e'></div><div class='test'></div>";if(!!a.getElementsByClassName&&a.getElementsByClassName("e").length!==0){a.lastChild.className="e";if(a.getElementsByClassName("e").length===1)return;o.order.splice(1,0,"CLASS"),o.find.CLASS=function(a,b,c){if(typeof b.getElementsByClassName!="undefined"&&!c)return b.getElementsByClassName(a[1])},a=null}}(),c.documentElement.contains?m.contains=function(a,b){return a!==b&&(a.contains?a.contains(b):!0)}:c.documentElement.compareDocumentPosition?m.contains=function(a,b){return!!(a.compareDocumentPosition(b)&16)}:m.contains=function(){return!1},m.isXML=function(a){var b=(a?a.ownerDocument||a:0).documentElement;return b?b.nodeName!=="HTML":!1};var y=function(a,b,c){var d,e=[],f="",g=b.nodeType?[b]:b;while(d=o.match.PSEUDO.exec(a))f+=d[0],a=a.replace(o.match.PSEUDO,"");a=o.relative[a]?a+"*":a;for(var h=0,i=g.length;h<i;h++)m(a,g[h],e,c);return m.filter(f,e)};m.attr=f.attr,m.selectors.attrMap={},f.find=m,f.expr=m.selectors,f.expr[":"]=f.expr.filters,f.unique=m.uniqueSort,f.text=m.getText,f.isXMLDoc=m.isXML,f.contains=m.contains}();var L=/Until$/,M=/^(?:parents|prevUntil|prevAll)/,N=/,/,O=/^.[^:#\[\.,]*$/,P=Array.prototype.slice,Q=f.expr.match.POS,R={children:!0,contents:!0,next:!0,prev:!0};f.fn.extend({find:function(a){var b=this,c,d;if(typeof a!="string")return f(a).filter(function(){for(c=0,d=b.length;c<d;c++)if(f.contains(b[c],this))return!0});var e=this.pushStack("","find",a),g,h,i;for(c=0,d=this.length;c<d;c++){g=e.length,f.find(a,this[c],e);if(c>0)for(h=g;h<e.length;h++)for(i=0;i<g;i++)if(e[i]===e[h]){e.splice(h--,1);break}}return e},has:function(a){var b=f(a);return this.filter(function(){for(var a=0,c=b.length;a<c;a++)if(f.contains(this,b[a]))return!0})},not:function(a){return this.pushStack(T(this,a,!1),"not",a)},filter:function(a){return this.pushStack(T(this,a,!0),"filter",a)},is:function(a){return!!a&&(typeof a=="string"?Q.test(a)?f(a,this.context).index(this[0])>=0:f.filter(a,this).length>0:this.filter(a).length>0)},closest:function(a,b){var c=[],d,e,g=this[0];if(f.isArray(a)){var h=1;while(g&&g.ownerDocument&&g!==b){for(d=0;d<a.length;d++)f(g).is(a[d])&&c.push({selector:a[d],elem:g,level:h});g=g.parentNode,h++}return c}var i=Q.test(a)||typeof a!="string"?f(a,b||this.context):0;for(d=0,e=this.length;d<e;d++){g=this[d];while(g){if(i?i.index(g)>-1:f.find.matchesSelector(g,a)){c.push(g);break}g=g.parentNode;if(!g||!g.ownerDocument||g===b||g.nodeType===11)break}}c=c.length>1?f.unique(c):c;return this.pushStack(c,"closest",a)},index:function(a){if(!a)return this[0]&&this[0].parentNode?this.prevAll().length:-1;if(typeof a=="string")return f.inArray(this[0],f(a));return f.inArray(a.jquery?a[0]:a,this)},add:function(a,b){var c=typeof a=="string"?f(a,b):f.makeArray(a&&a.nodeType?[a]:a),d=f.merge(this.get(),c);return this.pushStack(S(c[0])||S(d[0])?d:f.unique(d))},andSelf:function(){return this.add(this.prevObject)}}),f.each({parent:function(a){var b=a.parentNode;return b&&b.nodeType!==11?b:null},parents:function(a){return f.dir(a,"parentNode")},parentsUntil:function(a,b,c){return f.dir(a,"parentNode",c)},next:function(a){return f.nth(a,2,"nextSibling")},prev:function(a){return f.nth(a,2,"previousSibling")},nextAll:function(a){return f.dir(a,"nextSibling")},prevAll:function(a){return f.dir(a,"previousSibling")},nextUntil:function(a,b,c){return f.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return f.dir(a,"previousSibling",c)},siblings:function(a){return f.sibling(a.parentNode.firstChild,a)},children:function(a){return f.sibling(a.firstChild)},contents:function(a){return f.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:f.makeArray(a.childNodes)}},function(a,b){f.fn[a]=function(c,d){var e=f.map(this,b,c);L.test(a)||(d=c),d&&typeof d=="string"&&(e=f.filter(d,e)),e=this.length>1&&!R[a]?f.unique(e):e,(this.length>1||N.test(d))&&M.test(a)&&(e=e.reverse());return this.pushStack(e,a,P.call(arguments).join(","))}}),f.extend({filter:function(a,b,c){c&&(a=":not("+a+")");return b.length===1?f.find.matchesSelector(b[0],a)?[b[0]]:[]:f.find.matches(a,b)},dir:function(a,c,d){var e=[],g=a[c];while(g&&g.nodeType!==9&&(d===b||g.nodeType!==1||!f(g).is(d)))g.nodeType===1&&e.push(g),g=g[c];return e},nth:function(a,b,c,d){b=b||1;var e=0;for(;a;a=a[c])if(a.nodeType===1&&++e===b)break;return a},sibling:function(a,b){var c=[];for(;a;a=a.nextSibling)a.nodeType===1&&a!==b&&c.push(a);return c}});var V="abbr|article|aside|audio|canvas|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",W=/ jQuery\d+="(?:\d+|null)"/g,X=/^\s+/,Y=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/ig,Z=/<([\w:]+)/,$=/<tbody/i,_=/<|&#?\w+;/,ba=/<(?:script|style)/i,bb=/<(?:script|object|embed|option|style)/i,bc=new RegExp("<(?:"+V+")","i"),bd=/checked\s*(?:[^=]|=\s*.checked.)/i,be=/\/(java|ecma)script/i,bf=/^\s*<!(?:\[CDATA\[|\-\-)/,bg={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},bh=U(c);bg.optgroup=bg.option,bg.tbody=bg.tfoot=bg.colgroup=bg.caption=bg.thead,bg.th=bg.td,f.support.htmlSerialize||(bg._default=[1,"div<div>","</div>"]),f.fn.extend({text:function(a){if(f.isFunction(a))return this.each(function(b){var c=f(this);c.text(a.call(this,b,c.text()))});if(typeof a!="object"&&a!==b)return this.empty().append((this[0]&&this[0].ownerDocument||c).createTextNode(a));return f.text(this)},wrapAll:function(a){if(f.isFunction(a))return this.each(function(b){f(this).wrapAll(a.call(this,b))});if(this[0]){var b=f(a,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){var a=this;while(a.firstChild&&a.firstChild.nodeType===1)a=a.firstChild;return a}).append(this)}return this},wrapInner:function(a){if(f.isFunction(a))return this.each(function(b){f(this).wrapInner(a.call(this,b))});return this.each(function(){var b=f(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=f.isFunction(a);return this.each(function(c){f(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){f.nodeName(this,"body")||f(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(a){this.nodeType===1&&this.appendChild(a)})},prepend:function(){return this.domManip(arguments,!0,function(a){this.nodeType===1&&this.insertBefore(a,this.firstChild)})},before:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this)});if(arguments.length){var a=f.clean(arguments);a.push.apply(a,this.toArray());return this.pushStack(a,"before",arguments)}},after:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,!1,function(a){this.parentNode.insertBefore(a,this.nextSibling)});if(arguments.length){var a=this.pushStack(this,"after",arguments);a.push.apply(a,f.clean(arguments));return a}},remove:function(a,b){for(var c=0,d;(d=this[c])!=null;c++)if(!a||f.filter(a,[d]).length)!b&&d.nodeType===1&&(f.cleanData(d.getElementsByTagName("*")),f.cleanData([d])),d.parentNode&&d.parentNode.removeChild(d);return this},empty:function()
{for(var a=0,b;(b=this[a])!=null;a++){b.nodeType===1&&f.cleanData(b.getElementsByTagName("*"));while(b.firstChild)b.removeChild(b.firstChild)}return this},clone:function(a,b){a=a==null?!1:a,b=b==null?a:b;return this.map(function(){return f.clone(this,a,b)})},html:function(a){if(a===b)return this[0]&&this[0].nodeType===1?this[0].innerHTML.replace(W,""):null;if(typeof a=="string"&&!ba.test(a)&&(f.support.leadingWhitespace||!X.test(a))&&!bg[(Z.exec(a)||["",""])[1].toLowerCase()]){a=a.replace(Y,"<$1></$2>");try{for(var c=0,d=this.length;c<d;c++)this[c].nodeType===1&&(f.cleanData(this[c].getElementsByTagName("*")),this[c].innerHTML=a)}catch(e){this.empty().append(a)}}else f.isFunction(a)?this.each(function(b){var c=f(this);c.html(a.call(this,b,c.html()))}):this.empty().append(a);return this},replaceWith:function(a){if(this[0]&&this[0].parentNode){if(f.isFunction(a))return this.each(function(b){var c=f(this),d=c.html();c.replaceWith(a.call(this,b,d))});typeof a!="string"&&(a=f(a).detach());return this.each(function(){var b=this.nextSibling,c=this.parentNode;f(this).remove(),b?f(b).before(a):f(c).append(a)})}return this.length?this.pushStack(f(f.isFunction(a)?a():a),"replaceWith",a):this},detach:function(a){return this.remove(a,!0)},domManip:function(a,c,d){var e,g,h,i,j=a[0],k=[];if(!f.support.checkClone&&arguments.length===3&&typeof j=="string"&&bd.test(j))return this.each(function(){f(this).domManip(a,c,d,!0)});if(f.isFunction(j))return this.each(function(e){var g=f(this);a[0]=j.call(this,e,c?g.html():b),g.domManip(a,c,d)});if(this[0]){i=j&&j.parentNode,f.support.parentNode&&i&&i.nodeType===11&&i.childNodes.length===this.length?e={fragment:i}:e=f.buildFragment(a,this,k),h=e.fragment,h.childNodes.length===1?g=h=h.firstChild:g=h.firstChild;if(g){c=c&&f.nodeName(g,"tr");for(var l=0,m=this.length,n=m-1;l<m;l++)d.call(c?bi(this[l],g):this[l],e.cacheable||m>1&&l<n?f.clone(h,!0,!0):h)}k.length&&f.each(k,bp)}return this}}),f.buildFragment=function(a,b,d){var e,g,h,i,j=a[0];b&&b[0]&&(i=b[0].ownerDocument||b[0]),i.createDocumentFragment||(i=c),a.length===1&&typeof j=="string"&&j.length<512&&i===c&&j.charAt(0)==="<"&&!bb.test(j)&&(f.support.checkClone||!bd.test(j))&&(f.support.html5Clone||!bc.test(j))&&(g=!0,h=f.fragments[j],h&&h!==1&&(e=h)),e||(e=i.createDocumentFragment(),f.clean(a,i,e,d)),g&&(f.fragments[j]=h?e:1);return{fragment:e,cacheable:g}},f.fragments={},f.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){f.fn[a]=function(c){var d=[],e=f(c),g=this.length===1&&this[0].parentNode;if(g&&g.nodeType===11&&g.childNodes.length===1&&e.length===1){e[b](this[0]);return this}for(var h=0,i=e.length;h<i;h++){var j=(h>0?this.clone(!0):this).get();f(e[h])[b](j),d=d.concat(j)}return this.pushStack(d,a,e.selector)}}),f.extend({clone:function(a,b,c){var d,e,g,h=f.support.html5Clone||!bc.test("<"+a.nodeName)?a.cloneNode(!0):bo(a);if((!f.support.noCloneEvent||!f.support.noCloneChecked)&&(a.nodeType===1||a.nodeType===11)&&!f.isXMLDoc(a)){bk(a,h),d=bl(a),e=bl(h);for(g=0;d[g];++g)e[g]&&bk(d[g],e[g])}if(b){bj(a,h);if(c){d=bl(a),e=bl(h);for(g=0;d[g];++g)bj(d[g],e[g])}}d=e=null;return h},clean:function(a,b,d,e){var g;b=b||c,typeof b.createElement=="undefined"&&(b=b.ownerDocument||b[0]&&b[0].ownerDocument||c);var h=[],i;for(var j=0,k;(k=a[j])!=null;j++){typeof k=="number"&&(k+="");if(!k)continue;if(typeof k=="string")if(!_.test(k))k=b.createTextNode(k);else{k=k.replace(Y,"<$1></$2>");var l=(Z.exec(k)||["",""])[1].toLowerCase(),m=bg[l]||bg._default,n=m[0],o=b.createElement("div");b===c?bh.appendChild(o):U(b).appendChild(o),o.innerHTML=m[1]+k+m[2];while(n--)o=o.lastChild;if(!f.support.tbody){var p=$.test(k),q=l==="table"&&!p?o.firstChild&&o.firstChild.childNodes:m[1]==="<table>"&&!p?o.childNodes:[];for(i=q.length-1;i>=0;--i)f.nodeName(q[i],"tbody")&&!q[i].childNodes.length&&q[i].parentNode.removeChild(q[i])}!f.support.leadingWhitespace&&X.test(k)&&o.insertBefore(b.createTextNode(X.exec(k)[0]),o.firstChild),k=o.childNodes}var r;if(!f.support.appendChecked)if(k[0]&&typeof (r=k.length)=="number")for(i=0;i<r;i++)bn(k[i]);else bn(k);k.nodeType?h.push(k):h=f.merge(h,k)}if(d){g=function(a){return!a.type||be.test(a.type)};for(j=0;h[j];j++)if(e&&f.nodeName(h[j],"script")&&(!h[j].type||h[j].type.toLowerCase()==="text/javascript"))e.push(h[j].parentNode?h[j].parentNode.removeChild(h[j]):h[j]);else{if(h[j].nodeType===1){var s=f.grep(h[j].getElementsByTagName("script"),g);h.splice.apply(h,[j+1,0].concat(s))}d.appendChild(h[j])}}return h},cleanData:function(a){var b,c,d=f.cache,e=f.event.special,g=f.support.deleteExpando;for(var h=0,i;(i=a[h])!=null;h++){if(i.nodeName&&f.noData[i.nodeName.toLowerCase()])continue;c=i[f.expando];if(c){b=d[c];if(b&&b.events){for(var j in b.events)e[j]?f.event.remove(i,j):f.removeEvent(i,j,b.handle);b.handle&&(b.handle.elem=null)}g?delete i[f.expando]:i.removeAttribute&&i.removeAttribute(f.expando),delete d[c]}}}});var bq=/alpha\([^)]*\)/i,br=/opacity=([^)]*)/,bs=/([A-Z]|^ms)/g,bt=/^-?\d+(?:px)?$/i,bu=/^-?\d/,bv=/^([\-+])=([\-+.\de]+)/,bw={position:"absolute",visibility:"hidden",display:"block"},bx=["Left","Right"],by=["Top","Bottom"],bz,bA,bB;f.fn.css=function(a,c){if(arguments.length===2&&c===b)return this;return f.access(this,a,c,!0,function(a,c,d){return d!==b?f.style(a,c,d):f.css(a,c)})},f.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=bz(a,"opacity","opacity");return c===""?"1":c}return a.style.opacity}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":f.support.cssFloat?"cssFloat":"styleFloat"},style:function(a,c,d,e){if(!!a&&a.nodeType!==3&&a.nodeType!==8&&!!a.style){var g,h,i=f.camelCase(c),j=a.style,k=f.cssHooks[i];c=f.cssProps[i]||i;if(d===b){if(k&&"get"in k&&(g=k.get(a,!1,e))!==b)return g;return j[c]}h=typeof d,h==="string"&&(g=bv.exec(d))&&(d=+(g[1]+1)*+g[2]+parseFloat(f.css(a,c)),h="number");if(d==null||h==="number"&&isNaN(d))return;h==="number"&&!f.cssNumber[i]&&(d+="px");if(!k||!("set"in k)||(d=k.set(a,d))!==b)try{j[c]=d}catch(l){}}},css:function(a,c,d){var e,g;c=f.camelCase(c),g=f.cssHooks[c],c=f.cssProps[c]||c,c==="cssFloat"&&(c="float");if(g&&"get"in g&&(e=g.get(a,!0,d))!==b)return e;if(bz)return bz(a,c)},swap:function(a,b,c){var d={};for(var e in b)d[e]=a.style[e],a.style[e]=b[e];c.call(a);for(e in b)a.style[e]=d[e]}}),f.curCSS=f.css,f.each(["height","width"],function(a,b){f.cssHooks[b]={get:function(a,c,d){var e;if(c){if(a.offsetWidth!==0)return bC(a,b,d);f.swap(a,bw,function(){e=bC(a,b,d)});return e}},set:function(a,b){if(!bt.test(b))return b;b=parseFloat(b);if(b>=0)return b+"px"}}}),f.support.opacity||(f.cssHooks.opacity={get:function(a,b){return br.test((b&&a.currentStyle?a.currentStyle.filter:a.style.filter)||"")?parseFloat(RegExp.$1)/100+"":b?"1":""},set:function(a,b){var c=a.style,d=a.currentStyle,e=f.isNumeric(b)?"alpha(opacity="+b*100+")":"",g=d&&d.filter||c.filter||"";c.zoom=1;if(b>=1&&f.trim(g.replace(bq,""))===""){c.removeAttribute("filter");if(d&&!d.filter)return}c.filter=bq.test(g)?g.replace(bq,e):g+" "+e}}),f(function(){f.support.reliableMarginRight||(f.cssHooks.marginRight={get:function(a,b){var c;f.swap(a,{display:"inline-block"},function(){b?c=bz(a,"margin-right","marginRight"):c=a.style.marginRight});return c}})}),c.defaultView&&c.defaultView.getComputedStyle&&(bA=function(a,b){var c,d,e;b=b.replace(bs,"-$1").toLowerCase(),(d=a.ownerDocument.defaultView)&&(e=d.getComputedStyle(a,null))&&(c=e.getPropertyValue(b),c===""&&!f.contains(a.ownerDocument.documentElement,a)&&(c=f.style(a,b)));return c}),c.documentElement.currentStyle&&(bB=function(a,b){var c,d,e,f=a.currentStyle&&a.currentStyle[b],g=a.style;f===null&&g&&(e=g[b])&&(f=e),!bt.test(f)&&bu.test(f)&&(c=g.left,d=a.runtimeStyle&&a.runtimeStyle.left,d&&(a.runtimeStyle.left=a.currentStyle.left),g.left=b==="fontSize"?"1em":f||0,f=g.pixelLeft+"px",g.left=c,d&&(a.runtimeStyle.left=d));return f===""?"auto":f}),bz=bA||bB,f.expr&&f.expr.filters&&(f.expr.filters.hidden=function(a){var b=a.offsetWidth,c=a.offsetHeight;return b===0&&c===0||!f.support.reliableHiddenOffsets&&(a.style&&a.style.display||f.css(a,"display"))==="none"},f.expr.filters.visible=function(a){return!f.expr.filters.hidden(a)});var bD=/%20/g,bE=/\[\]$/,bF=/\r?\n/g,bG=/#.*$/,bH=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,bI=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,bJ=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,bK=/^(?:GET|HEAD)$/,bL=/^\/\//,bM=/\?/,bN=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,bO=/^(?:select|textarea)/i,bP=/\s+/,bQ=/([?&])_=[^&]*/,bR=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,bS=f.fn.load,bT={},bU={},bV,bW,bX=["*/"]+["*"];try{bV=e.href}catch(bY){bV=c.createElement("a"),bV.href="",bV=bV.href}bW=bR.exec(bV.toLowerCase())||[],f.fn.extend({load:function(a,c,d){if(typeof a!="string"&&bS)return bS.apply(this,arguments);if(!this.length)return this;var e=a.indexOf(" ");if(e>=0){var g=a.slice(e,a.length);a=a.slice(0,e)}var h="GET";c&&(f.isFunction(c)?(d=c,c=b):typeof c=="object"&&(c=f.param(c,f.ajaxSettings.traditional),h="POST"));var i=this;f.ajax({url:a,type:h,dataType:"html",data:c,complete:function(a,b,c){c=a.responseText,a.isResolved()&&(a.done(function(a){c=a}),i.html(g?f("<div>").append(c.replace(bN,"")).find(g):c)),d&&i.each(d,[c,b,a])}});return this},serialize:function(){return f.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?f.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||bO.test(this.nodeName)||bI.test(this.type))}).map(function(a,b){var c=f(this).val();return c==null?null:f.isArray(c)?f.map(c,function(a,c){return{name:b.name,value:a.replace(bF,"\r\n")}}):{name:b.name,value:c.replace(bF,"\r\n")}}).get()}}),f.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(a,b){f.fn[b]=function(a){return this.on(b,a)}}),f.each(["get","post"],function(a,c){f[c]=function(a,d,e,g){f.isFunction(d)&&(g=g||e,e=d,d=b);return f.ajax({type:c,url:a,data:d,success:e,dataType:g})}}),f.extend({getScript:function(a,c){return f.get(a,b,c,"script")},getJSON:function(a,b,c){return f.get(a,b,c,"json")},ajaxSetup:function(a,b){b?b_(a,f.ajaxSettings):(b=a,a=f.ajaxSettings),b_(a,b);return a},ajaxSettings:{url:bV,isLocal:bJ.test(bW[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":bX},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":a.String,"text html":!0,"text json":f.parseJSON,"text xml":f.parseXML},flatOptions:{context:!0,url:!0}},ajaxPrefilter:bZ(bT),ajaxTransport:bZ(bU),ajax:function(a,c){function w(a,c,l,m){if(s!==2){s=2,q&&clearTimeout(q),p=b,n=m||"",v.readyState=a>0?4:0;var o,r,u,w=c,x=l?cb(d,v,l):b,y,z;if(a>=200&&a<300||a===304){if(d.ifModified){if(y=v.getResponseHeader("Last-Modified"))f.lastModified[k]=y;if(z=v.getResponseHeader("Etag"))f.etag[k]=z}if(a===304)w="notmodified",o=!0;else try{r=cc(d,x),w="success",o=!0}catch(A){w="parsererror",u=A}}else{u=w;if(!w||a)w="error",a<0&&(a=0)}v.status=a,v.statusText=""+(c||w),o?h.resolveWith(e,[r,w,v]):h.rejectWith(e,[v,w,u]),v.statusCode(j),j=b,t&&g.trigger("ajax"+(o?"Success":"Error"),[v,d,o?r:u]),i.fireWith(e,[v,w]),t&&(g.trigger("ajaxComplete",[v,d]),--f.active||f.event.trigger("ajaxStop"))}}typeof a=="object"&&(c=a,a=b),c=c||{};var d=f.ajaxSetup({},c),e=d.context||d,g=e!==d&&(e.nodeType||e instanceof f)?f(e):f.event,h=f.Deferred(),i=f.Callbacks("once memory"),j=d.statusCode||{},k,l={},m={},n,o,p,q,r,s=0,t,u,v={readyState:0,setRequestHeader:function(a,b){if(!s){var c=a.toLowerCase();a=m[c]=m[c]||a,l[a]=b}return this},getAllResponseHeaders:function(){return s===2?n:null},getResponseHeader:function(a){var c;if(s===2){if(!o){o={};while(c=bH.exec(n))o[c[1].toLowerCase()]=c[2]}c=o[a.toLowerCase()]}return c===b?null:c},overrideMimeType:function(a){s||(d.mimeType=a);return this},abort:function(a){a=a||"abort",p&&p.abort(a),w(0,a);return this}};h.promise(v),v.success=v.done,v.error=v.fail,v.complete=i.add,v.statusCode=function(a){if(a){var b;if(s<2)for(b in a)j[b]=[j[b],a[b]];else b=a[v.status],v.then(b,b)}return this},d.url=((a||d.url)+"").replace(bG,"").replace(bL,bW[1]+"//"),d.dataTypes=f.trim(d.dataType||"*").toLowerCase().split(bP),d.crossDomain==null&&(r=bR.exec(d.url.toLowerCase()),d.crossDomain=!(!r||r[1]==bW[1]&&r[2]==bW[2]&&(r[3]||(r[1]==="http:"?80:443))==(bW[3]||(bW[1]==="http:"?80:443)))),d.data&&d.processData&&typeof d.data!="string"&&(d.data=f.param(d.data,d.traditional)),b$(bT,d,c,v);if(s===2)return!1;t=d.global,d.type=d.type.toUpperCase(),d.hasContent=!bK.test(d.type),t&&f.active++===0&&f.event.trigger("ajaxStart");if(!d.hasContent){d.data&&(d.url+=(bM.test(d.url)?"&":"?")+d.data,delete d.data),k=d.url;if(d.cache===!1){var x=f.now(),y=d.url.replace(bQ,"$1_="+x);d.url=y+(y===d.url?(bM.test(d.url)?"&":"?")+"_="+x:"")}}(d.data&&d.hasContent&&d.contentType!==!1||c.contentType)&&v.setRequestHeader("Content-Type",d.contentType),d.ifModified&&(k=k||d.url,f.lastModified[k]&&v.setRequestHeader("If-Modified-Since",f.lastModified[k]),f.etag[k]&&v.setRequestHeader("If-None-Match",f.etag[k])),v.setRequestHeader("Accept",d.dataTypes[0]&&d.accepts[d.dataTypes[0]]?d.accepts[d.dataTypes[0]]+(d.dataTypes[0]!=="*"?", "+bX+"; q=0.01":""):d.accepts["*"]);for(u in d.headers)v.setRequestHeader(u,d.headers[u]);if(d.beforeSend&&(d.beforeSend.call(e,v,d)===!1||s===2)){v.abort();return!1}for(u in{success:1,error:1,complete:1})v[u](d[u]);p=b$(bU,d,c,v);if(!p)w(-1,"No Transport");else{v.readyState=1,t&&g.trigger("ajaxSend",[v,d]),d.async&&d.timeout>0&&(q=setTimeout(function(){v.abort("timeout")},d.timeout));try{s=1,p.send(l,w)}catch(z){if(s<2)w(-1,z);else throw z}}return v},param:function(a,c){var d=[],e=function(a,b){b=f.isFunction(b)?b():b,d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};c===b&&(c=f.ajaxSettings.traditional);if(f.isArray(a)||a.jquery&&!f.isPlainObject(a))f.each(a,function(){e(this.name,this.value)});else for(var g in a)ca(g,a[g],c,e);return d.join("&").replace(bD,"+")}}),f.extend({active:0,lastModified:{},etag:{}});var cd=f.now(),ce=/(\=)\?(&|$)|\?\?/i;f.ajaxSetup({jsonp:"callback",jsonpCallback:function(){return f.expando+"_"+cd++}}),f.ajaxPrefilter("json jsonp",function(b,c,d){var e=b.contentType==="application/x-www-form-urlencoded"&&typeof b.data=="string";if(b.dataTypes[0]==="jsonp"||b.jsonp!==!1&&(ce.test(b.url)||e&&ce.test(b.data))){var g,h=b.jsonpCallback=f.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,i=a[h],j=b.url,k=b.data,l="$1"+h+"$2";b.jsonp!==!1&&(j=j.replace(ce,l),b.url===j&&(e&&(k=k.replace(ce,l)),b.data===k&&(j+=(/\?/.test(j)?"&":"?")+b.jsonp+"="+h))),b.url=j,b.data=k,a[h]=function(a){g=[a]},d.always(function(){a[h]=i,g&&f.isFunction(i)&&a[h](g[0])}),b.converters["script json"]=function(){g||f.error(h+" was not called");return g[0]},b.dataTypes[0]="json";return"script"}}),f.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(a){f.globalEval(a);return a}}}),f.ajaxPrefilter("script",function(a){a.cache===b&&(a.cache=!1),a.crossDomain&&(a.type="GET",a.global=!1)}),f.ajaxTransport("script",function(a){if(a.crossDomain){var d,e=c.head||c.getElementsByTagName("head")[0]||c.documentElement;return{send:function(f,g){d=c.createElement("script"),d.async="async",a.scriptCharset&&(d.charset=a.scriptCharset),d.src=a.url,d.onload=d.onreadystatechange=function(a,c){if(c||!d.readyState||/loaded|complete/.test(d.readyState))d.onload=d.onreadystatechange=null,e&&d.parentNode&&e.removeChild(d),d=b,c||g(200,"success")},e.insertBefore(d,e.firstChild)},abort:function(){d&&d.onload(0,1)}}}});var cf=a.ActiveXObject?function(){for(var a in ch)ch[a](0,1)}:!1,cg=0,ch;f.ajaxSettings.xhr=a.ActiveXObject?function(){return!this.isLocal&&ci()||cj()}:ci,function(a){f.extend(f.support,{ajax:!!a,cors:!!a&&"withCredentials"in a})}(f.ajaxSettings.xhr()),f.support.ajax&&f.ajaxTransport(function(c){if(!c.crossDomain||f.support.cors){var d;return{send:function(e,g){var h=c.xhr(),i,j;c.username?h.open(c.type,c.url,c.async,c.username,c.password):h.open(c.type,c.url,c.async);if(c.xhrFields)for(j in c.xhrFields)h[j]=c.xhrFields[j];c.mimeType&&h.overrideMimeType&&h.overrideMimeType(c.mimeType),!c.crossDomain&&!e["X-Requested-With"]&&(e["X-Requested-With"]="XMLHttpRequest");try{for(j in e)h.setRequestHeader(j,e[j])}catch(k){}h.send(c.hasContent&&c.data||null),d=function(a,e){var j,k,l,m,n;try{if(d&&(e||h.readyState===4)){d=b,i&&(h.onreadystatechange=f.noop,cf&&delete ch[i]);if(e)h.readyState!==4&&h.abort();else{j=h.status,l=h.getAllResponseHeaders(),m={},n=h.responseXML,n&&n.documentElement&&(m.xml=n),m.text=h.responseText;try{k=h.statusText}catch(o){k=""}!j&&c.isLocal&&!c.crossDomain?j=m.text?200:404:j===1223&&(j=204)}}}catch(p){e||g(-1,p)}m&&g(j,k,m,l)},!c.async||h.readyState===4?d():(i=++cg,cf&&(ch||(ch={},f(a).unload(cf)),ch[i]=d),h.onreadystatechange=d)},abort:function(){d&&d(0,1)}}}});var ck={},cl,cm,cn=/^(?:toggle|show|hide)$/,co=/^([+\-]=)?([\d+.\-]+)([a-z%]*)$/i,cp,cq=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]],cr;f.fn.extend({show:function(a,b,c){var d,e;if(a||a===0)return this.animate(cu("show",3),a,b,c);for(var g=0,h=this.length;g<h;g++)d=this[g],d.style&&(e=d.style.display,!f._data(d,"olddisplay")&&e==="none"&&(e=d.style.display=""),e===""&&f.css(d,"display")==="none"&&f._data(d,"olddisplay",cv(d.nodeName)));for(g=0;g<h;g++){d=this[g];if(d.style){e=d.style.display;if(e===""||e==="none")d.style.display=f._data(d,"olddisplay")||""}}return this},hide:function(a,b,c){if(a||a===0)return this.animate(cu("hide",3),a,b,c);var d,e,g=0,h=this.length;for(;g<h;g++)d=this[g],d.style&&(e=f.css(d,"display"),e!=="none"&&!f._data(d,"olddisplay")&&f._data(d,"olddisplay",e));for(g=0;g<h;g++)this[g].style&&(this[g].style.display="none");return this},_toggle:f.fn.toggle,toggle:function(a,b,c){var d=typeof a=="boolean";f.isFunction(a)&&f.isFunction(b)?this._toggle.apply(this,arguments):a==null||d?this.each(function(){var b=d?a:f(this).is(":hidden");f(this)[b?"show":"hide"]()}):this.animate(cu("toggle",3),a,b,c);return this},fadeTo:function(a,b,c,d){return this.filter(":hidden").css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){function g(){e.queue===!1&&f._mark(this);var b=f.extend({},e),c=this.nodeType===1,d=c&&f(this).is(":hidden"),g,h,i,j,k,l,m,n,o;b.animatedProperties={};for(i in a){g=f.camelCase(i),i!==g&&(a[g]=a[i],delete a[i]),h=a[g],f.isArray(h)?(b.animatedProperties[g]=h[1],h=a[g]=h[0]):b.animatedProperties[g]=b.specialEasing&&b.specialEasing[g]||b.easing||"swing";if(h==="hide"&&d||h==="show"&&!d)return b.complete.call(this);c&&(g==="height"||g==="width")&&(b.overflow=[this.style.overflow,this.style.overflowX,this.style.overflowY],f.css(this,"display")==="inline"&&f.css(this,"float")==="none"&&(!f.support.inlineBlockNeedsLayout||cv(this.nodeName)==="inline"?this.style.display="inline-block":this.style.zoom=1))}b.overflow!=null&&(this.style.overflow="hidden");for(i in a)j=new f.fx(this,b,i),h=a[i],cn.test(h)?(o=f._data(this,"toggle"+i)||(h==="toggle"?d?"show":"hide":0),o?(f._data(this,"toggle"+i,o==="show"?"hide":"show"),j[o]()):j[h]()):(k=co.exec(h),l=j.cur(),k?(m=parseFloat(k[2]),n=k[3]||(f.cssNumber[i]?"":"px"),n!=="px"&&(f.style(this,i,(m||1)+n),l=(m||1)/j.cur()*l,f.style(this,i,l+n)),k[1]&&(m=(k[1]==="-="?-1:1)*m+l),j.custom(l,m,n)):j.custom(l,h,""));return!0}var e=f.speed(b,c,d);if(f.isEmptyObject(a))return this.each(e.complete,[!1]);a=f.extend({},a);return e.queue===!1?this.each(g):this.queue(e.queue,g)},stop:function(a,c,d){typeof a!="string"&&(d=c,c=a,a=b),c&&a!==!1&&this.queue(a||"fx",[]);return this.each(function(){function h(a,b,c){var e=b[c];f.removeData(a,c,!0),e.stop(d)}var b,c=!1,e=f.timers,g=f._data(this);d||f._unmark(!0,this);if(a==null)for(b in g)g[b]&&g[b].stop&&b.indexOf(".run")===b.length-4&&h(this,g,b);else g[b=a+".run"]&&g[b].stop&&h(this,g,b);for(b=e.length;b--;)e[b].elem===this&&(a==null||e[b].queue===a)&&(d?e[b](!0):e[b].saveState(),c=!0,e.splice(b,1));(!d||!c)&&f.dequeue(this,a)})}}),f.each({slideDown:cu("show",1),slideUp:cu("hide",1),slideToggle:cu("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){f.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),f.extend({speed:function(a,b,c){var d=a&&typeof a=="object"?f.extend({},a):{complete:c||!c&&b||f.isFunction(a)&&a,duration:a,easing:c&&b||b&&!f.isFunction(b)&&b};d.duration=f.fx.off?0:typeof d.duration=="number"?d.duration:d.duration in f.fx.speeds?f.fx.speeds[d.duration]:f.fx.speeds._default;if(d.queue==null||d.queue===!0)d.queue="fx";d.old=d.complete,d.complete=function(a){f.isFunction(d.old)&&d.old.call(this),d.queue?f.dequeue(this,d.queue):a!==!1&&f._unmark(this)};return d},easing:{linear:function(a,b,c,d){return c+d*a},swing:function(a,b,c,d){return(-Math.cos(a*Math.PI)/2+.5)*d+c}},timers:[],fx:function(a,b,c){this.options=b,this.elem=a,this.prop=c,b.orig=b.orig||{}}}),f.fx.prototype={update:function(){this.options.step&&this.options.step.call(this.elem,this.now,this),(f.fx.step[this.prop]||f.fx.step._default)(this)},cur:function(){if(this.elem[this.prop]!=null&&(!this.elem.style||this.elem.style[this.prop]==null))return this.elem[this.prop];var a,b=f.css(this.elem,this.prop);return isNaN(a=parseFloat(b))?!b||b==="auto"?0:b:a},custom:function(a,c,d){function h(a){return e.step(a)}var e=this,g=f.fx;this.startTime=cr||cs(),this.end=c,this.now=this.start=a,this.pos=this.state=0,this.unit=d||this.unit||(f.cssNumber[this.prop]?"":"px"),h.queue=this.options.queue,h.elem=this.elem,h.saveState=function(){e.options.hide&&f._data(e.elem,"fxshow"+e.prop)===b&&f._data(e.elem,"fxshow"+e.prop,e.start)},h()&&f.timers.push(h)&&!cp&&(cp=setInterval(g.tick,g.interval))},show:function(){var a=f._data(this.elem,"fxshow"+this.prop);this.options.orig[this.prop]=a||f.style(this.elem,this.prop),this.options.show=!0,a!==b?this.custom(this.cur(),a):this.custom(this.prop==="width"||this.prop==="height"?1:0,this.cur()),f(this.elem).show()},hide:function(){this.options.orig[this.prop]=f._data(this.elem,"fxshow"+this.prop)||f.style(this.elem,this.prop),this.options.hide=!0,this.custom(this.cur(),0)},step:function(a){var b,c,d,e=cr||cs(),g=!0,h=this.elem,i=this.options;if(a||e>=i.duration+this.startTime){this.now=this.end,this.pos=this.state=1,this.update(),i.animatedProperties[this.prop]=!0;for(b in i.animatedProperties)i.animatedProperties[b]!==!0&&(g=!1);if(g){i.overflow!=null&&!f.support.shrinkWrapBlocks&&f.each(["","X","Y"],function(a,b){h.style["overflow"+b]=i.overflow[a]}),i.hide&&f(h).hide();if(i.hide||i.show)for(b in i.animatedProperties)f.style(h,b,i.orig[b]),f.removeData(h,"fxshow"+b,!0),f.removeData(h,"toggle"+b,!0);d=i.complete,d&&(i.complete=!1,d.call(h))}return!1}i.duration==Infinity?this.now=e:(c=e-this.startTime,this.state=c/i.duration,this.pos=f.easing[i.animatedProperties[this.prop]](this.state,c,0,1,i.duration),this.now=this.start+(this.end-this.start)*this.pos),this.update();return!0}},f.extend(f.fx,{tick:function(){var a,b=f.timers,c=0;for(;c<b.length;c++)a=b[c],!a()&&b[c]===a&&b.splice(c--,1);b.length||f.fx.stop()},interval:13,stop:function(){clearInterval(cp),cp=null},speeds:{slow:600,fast:200,_default:400},step:{opacity:function(a){f.style(a.elem,"opacity",a.now)},_default:function(a){a.elem.style&&a.elem.style[a.prop]!=null?a.elem.style[a.prop]=a.now+a.unit:a.elem[a.prop]=a.now}}}),f.each(["width","height"],function(a,b){f.fx.step[b]=function(a){f.style(a.elem,b,Math.max(0,a.now)+a.unit)}}),f.expr&&f.expr.filters&&(f.expr.filters.animated=function(a){return f.grep(f.timers,function(b){return a===b.elem}).length});var cw=/^t(?:able|d|h)$/i,cx=/^(?:body|html)$/i;"getBoundingClientRect"in c.documentElement?f.fn.offset=function(a){var b=this[0],c;if(a)return this.each(function(b){f.offset.setOffset(this,a,b)});if(!b||!b.ownerDocument)return null;if(b===b.ownerDocument.body)return f.offset.bodyOffset(b);try{c=b.getBoundingClientRect()}catch(d){}var e=b.ownerDocument,g=e.documentElement;if(!c||!f.contains(g,b))return c?{top:c.top,left:c.left}:{top:0,left:0};var h=e.body,i=cy(e),j=g.clientTop||h.clientTop||0,k=g.clientLeft||h.clientLeft||0,l=i.pageYOffset||f.support.boxModel&&g.scrollTop||h.scrollTop,m=i.pageXOffset||f.support.boxModel&&g.scrollLeft||h.scrollLeft,n=c.top+l-j,o=c.left+m-k;return{top:n,left:o}}:f.fn.offset=function(a){var b=this[0];if(a)return this.each(function(b){f.offset.setOffset(this,a,b)});if(!b||!b.ownerDocument)return null;if(b===b.ownerDocument.body)return f.offset.bodyOffset(b);var c,d=b.offsetParent,e=b,g=b.ownerDocument,h=g.documentElement,i=g.body,j=g.defaultView,k=j?j.getComputedStyle(b,null):b.currentStyle,l=b.offsetTop,m=b.offsetLeft;while((b=b.parentNode)&&b!==i&&b!==h){if(f.support.fixedPosition&&k.position==="fixed")break;c=j?j.getComputedStyle(b,null):b.currentStyle,l-=b.scrollTop,m-=b.scrollLeft,b===d&&(l+=b.offsetTop,m+=b.offsetLeft,f.support.doesNotAddBorder&&(!f.support.doesAddBorderForTableAndCells||!cw.test(b.nodeName))&&(l+=parseFloat(c.borderTopWidth)||0,m+=parseFloat(c.borderLeftWidth)||0),e=d,d=b.offsetParent),f.support.subtractsBorderForOverflowNotVisible&&c.overflow!=="visible"&&(l+=parseFloat(c.borderTopWidth)||0,m+=parseFloat(c.borderLeftWidth)||0),k=c}if(k.position==="relative"||k.position==="static")l+=i.offsetTop,m+=i.offsetLeft;f.support.fixedPosition&&k.position==="fixed"&&(l+=Math.max(h.scrollTop,i.scrollTop),m+=Math.max(h.scrollLeft,i.scrollLeft));return{top:l,left:m}},f.offset={bodyOffset:function(a){var b=a.offsetTop,c=a.offsetLeft;f.support.doesNotIncludeMarginInBodyOffset&&(b+=parseFloat(f.css(a,"marginTop"))||0,c+=parseFloat(f.css(a,"marginLeft"))||0);return{top:b,left:c}},setOffset:function(a,b,c){var d=f.css(a,"position");d==="static"&&(a.style.position="relative");var e=f(a),g=e.offset(),h=f.css(a,"top"),i=f.css(a,"left"),j=(d==="absolute"||d==="fixed")&&f.inArray("auto",[h,i])>-1,k={},l={},m,n;j?(l=e.position(),m=l.top,n=l.left):(m=parseFloat(h)||0,n=parseFloat(i)||0),f.isFunction(b)&&(b=b.call(a,c,g)),b.top!=null&&(k.top=b.top-g.top+m),b.left!=null&&(k.left=b.left-g.left+n),"using"in b?b.using.call(a,k):e.css(k)}},f.fn.extend({position:function(){if(!this[0])return null;var a=this[0],b=this.offsetParent(),c=this.offset(),d=cx.test(b[0].nodeName)?{top:0,left:0}:b.offset();c.top-=parseFloat(f.css(a,"marginTop"))||0,c.left-=parseFloat(f.css(a,"marginLeft"))||0,d.top+=parseFloat(f.css(b[0],"borderTopWidth"))||0,d.left+=parseFloat(f.css(b[0],"borderLeftWidth"))||0;return{top:c.top-d.top,left:c.left-d.left}},offsetParent:function(){return this.map(function(){var a=this.offsetParent||c.body;while(a&&!cx.test(a.nodeName)&&f.css(a,"position")==="static")a=a.offsetParent;return a})}}),f.each(["Left","Top"],function(a,c){var d="scroll"+c;f.fn[d]=function(c){var e,g;if(c===b){e=this[0];if(!e)return null;g=cy(e);return g?"pageXOffset"in g?g[a?"pageYOffset":"pageXOffset"]:f.support.boxModel&&g.document.documentElement[d]||g.document.body[d]:e[d]}return this.each(function(){g=cy(this),g?g.scrollTo(a?f(g).scrollLeft():c,a?c:f(g).scrollTop()):this[d]=c})}}),f.each(["Height","Width"],function(a,c){var d=c.toLowerCase();f.fn["inner"+c]=function(){var a=this[0];return a?a.style?parseFloat(f.css(a,d,"padding")):this[d]():null},f.fn["outer"+c]=function(a){var b=this[0];return b?b.style?parseFloat(f.css(b,d,a?"margin":"border")):this[d]():null},f.fn[d]=function(a){var e=this[0];if(!e)return a==null?null:this;if(f.isFunction(a))return this.each(function(b){var c=f(this);c[d](a.call(this,b,c[d]()))});if(f.isWindow(e)){var g=e.document.documentElement["client"+c],h=e.document.body;return e.document.compatMode==="CSS1Compat"&&g||h&&h["client"+c]||g}if(e.nodeType===9)return Math.max(e.documentElement["client"+c],e.body["scroll"+c],e.documentElement["scroll"+c],e.body["offset"+c],e.documentElement["offset"+c]);if(a===b){var i=f.css(e,d),j=parseFloat(i);return f.isNumeric(j)?j:i}return this.css(d,typeof a=="string"?a:a+"px")}}),a.jQuery=a.$=f,typeof define=="function"&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return f})})(window);
</script>
<script type="text/javascript">
/* On double-click, reformat <div class="screen"> for easy copying. */
var minus = "<img alt=\"minus\" class=\"toggle\" width=\"18\" height=\"10\" src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAAKCAYAAAC5Sw6hAAADHmlDQ1BJQ0MgUHJvZmlsZQAAeAGFVN9r01AU/tplnbDhizpnEQk+aJFuZFN0Q5y2a1e6zVrqNrchSJumbVyaxiTtfrAH2YtvOsV38Qc++QcM2YNve5INxhRh+KyIIkz2IrOemzRNJ1MDufe73/nuOSfn5F6g+XFa0xQvDxRVU0/FwvzE5BTf8gFeHEMr/GhNi4YWSiZHQA/Tsnnvs/MOHsZsdO5v36v+Y9WalQwR8BwgvpQ1xCLhWaBpXNR0E+DWie+dMTXCzUxzWKcECR9nOG9jgeGMjSOWZjQ1QJoJwgfFQjpLuEA4mGng8w3YzoEU5CcmqZIuizyrRVIv5WRFsgz28B9zg/JfsKiU6Zut5xCNbZoZTtF8it4fOX1wjOYA1cE/Xxi9QbidcFg246M1fkLNJK4RJr3n7nRpmO1lmpdZKRIlHCS8YlSuM2xp5gsDiZrm0+30UJKwnzS/NDNZ8+PtUJUE6zHF9fZLRvS6vdfbkZMH4zU+pynWf0D+vff1corleZLw67QejdX0W5I6Vtvb5M2mI8PEd1E/A0hCgo4cZCjgkUIMYZpjxKr4TBYZIkqk0ml0VHmyONY7KJOW7RxHeMlfDrheFvVbsrj24Pue3SXXjrwVhcW3o9hR7bWB6bqyE5obf3VhpaNu4Te55ZsbbasLCFH+iuWxSF5lyk+CUdd1NuaQU5f8dQvPMpTuJXYSWAy6rPBe+CpsCk+FF8KXv9TIzt6tEcuAcSw+q55TzcbsJdJM0utkuL+K9ULGGPmQMUNanb4kTZyKOfLaUAsnBneC6+biXC/XB567zF3h+rkIrS5yI47CF/VFfCHwvjO+Pl+3b4hhp9u+02TrozFa67vTkbqisXqUj9sn9j2OqhMZsrG+sX5WCCu0omNqSrN0TwADJW1Ol/MFk+8RhAt8iK4tiY+rYleQTysKb5kMXpcMSa9I2S6wO4/tA7ZT1l3maV9zOfMqcOkb/cPrLjdVBl4ZwNFzLhegM3XkCbB8XizrFdsfPJ63gJE722OtPW1huos+VqvbdC5bHgG7D6vVn8+q1d3n5H8LeKP8BqkjCtbCoV8yAAAAUklEQVQoFWO8HyrynwEKFFa9ZoSxiaEfhInC9TKADAICBkowyAwmYmwmRg3VDGLBZtvHPGmE37Eo4J/0FCMsaesibDZicRiKENVcRDWDGKmVIAFsW0aIsyjVzwAAAABJRU5ErkJggg%3D%3D\">";
var plus = "<img alt=\"plus\" class=\"toggle\" width=\"18\" height=\"10\" src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAAKCAYAAAC5Sw6hAAADHmlDQ1BJQ0MgUHJvZmlsZQAAeAGFVN9r01AU/tplnbDhizpnEQk+aJFuZFN0Q5y2a1e6zVrqNrchSJumbVyaxiTtfrAH2YtvOsV38Qc++QcM2YNve5INxhRh+KyIIkz2IrOemzRNJ1MDufe73/nuOSfn5F6g+XFa0xQvDxRVU0/FwvzE5BTf8gFeHEMr/GhNi4YWSiZHQA/Tsnnvs/MOHsZsdO5v36v+Y9WalQwR8BwgvpQ1xCLhWaBpXNR0E+DWie+dMTXCzUxzWKcECR9nOG9jgeGMjSOWZjQ1QJoJwgfFQjpLuEA4mGng8w3YzoEU5CcmqZIuizyrRVIv5WRFsgz28B9zg/JfsKiU6Zut5xCNbZoZTtF8it4fOX1wjOYA1cE/Xxi9QbidcFg246M1fkLNJK4RJr3n7nRpmO1lmpdZKRIlHCS8YlSuM2xp5gsDiZrm0+30UJKwnzS/NDNZ8+PtUJUE6zHF9fZLRvS6vdfbkZMH4zU+pynWf0D+vff1corleZLw67QejdX0W5I6Vtvb5M2mI8PEd1E/A0hCgo4cZCjgkUIMYZpjxKr4TBYZIkqk0ml0VHmyONY7KJOW7RxHeMlfDrheFvVbsrj24Pue3SXXjrwVhcW3o9hR7bWB6bqyE5obf3VhpaNu4Te55ZsbbasLCFH+iuWxSF5lyk+CUdd1NuaQU5f8dQvPMpTuJXYSWAy6rPBe+CpsCk+FF8KXv9TIzt6tEcuAcSw+q55TzcbsJdJM0utkuL+K9ULGGPmQMUNanb4kTZyKOfLaUAsnBneC6+biXC/XB567zF3h+rkIrS5yI47CF/VFfCHwvjO+Pl+3b4hhp9u+02TrozFa67vTkbqisXqUj9sn9j2OqhMZsrG+sX5WCCu0omNqSrN0TwADJW1Ol/MFk+8RhAt8iK4tiY+rYleQTysKb5kMXpcMSa9I2S6wO4/tA7ZT1l3maV9zOfMqcOkb/cPrLjdVBl4ZwNFzLhegM3XkCbB8XizrFdsfPJ63gJE722OtPW1huos+VqvbdC5bHgG7D6vVn8+q1d3n5H8LeKP8BqkjCtbCoV8yAAAAYElEQVQoFWO8HyrynwEKFFa9ZoSxiaEfhInC9TKADAICBlz4Q67UfxDGJQ8SB5nBRIzNxKihmkEs2Gz7mCeN8DtUAbIY/6SnGGFJWxch2whzCbIYNl9QzUVUM4iRWgkSAKcsS/O6iJF0AAAAAElFTkSuQmCC\">";

$(document).ready(function() {

  /*
   * DOCS-36: HTML output should wrap large images in links to themselves at
   *          full size
   *
   * It would be cool if when you click (large) images in HTML output, you get
   * the same effect as right-click &gt; copy image location + new tab &gt;
   * paste copied image location and go.
   *
   * Run this before inserting [-] and [+] images below, otherwise clicking
   * [-] opens a new browser tab with the [-] image.
   */
  $("img").wrap(function() {
    return "<a target=\"_blank\" href=\"" + $(this).attr('src') + "\" />";
  });

   /*
    Include both a wrapped (.screen) and unwrapped (.flat) version of
    each screen element, with [-] image to collapse and [+] image
    to expand content.
   */
  $(".screen").each(function () {
    $(this).replaceWith(
      "<div class=\"screen\" title=\"Click [-] to flatten lines.\">"
        + minus + $(this).html() + "</div>" +
      "<div class=\"flat nodisplay\" title=\"Click [+] to wrap long lines.\">"
        + plus + $(this).html().replace(/(\n|\r\n) /g," ") + "</div>"
    )});

  /*
   * COMMWEB-73: Make it easier to copy links to anchors in the HTML core docs
   *
   * On mouseover, prepend a ↪ to titles which links to the element.
   *
   * This code works for elements that are class="title". To affect procedures
   * as well for example, change $(".title") to $(".title, .procedure"). Then
   * also change the code to insert the ↪ in the procedure title, rather than
   * outside the entire procedure, which is a block. The same applies to
   * example and probably other block-formatted elements.
   */
  $(".title").each(function() {
    var href = $(this).children("a").attr("name");
    $(this).prepend('<a href=\"#' + href
      + '\" class=\"showlink\" style=\"display: none;\">&#x021AA; </a>');
    $(this).mouseenter(function() {
      $(this).children('a.showlink').show();
    }).mouseleave(function() {
      $(this).children('a.showlink').hide();
    });
  });

});

/*
  Add class="nodisplay" to parent div; remove from parent's sibling.
  If the current parent is .screen, then next sibling is .flat.
*/
$(".toggle").live("click", function() {
  $(this).parent().toggleClass("nodisplay");
  if ($(this).parent().hasClass("screen")) {
    $(this).parent().next().toggleClass("nodisplay");
  } else {
    $(this).parent().prev().toggleClass("nodisplay");
  }
});
</script>
<!-- START SyntaxHighlighter 3.0.83 -->
<!-- shCore.js -->
<script type="text/javascript">/**
 * SyntaxHighlighter
 * http://alexgorbatchev.com/SyntaxHighlighter
 *
 * SyntaxHighlighter is donationware. If you are using it, please donate.
 * http://alexgorbatchev.com/SyntaxHighlighter/donate.html
 *
 * @version
 * 3.0.83 (July 02 2010)
 * 
 * @copyright
 * Copyright (C) 2004-2010 Alex Gorbatchev.
 *
 * @license
 * Dual licensed under the MIT and GPL licenses.
 */
eval(function(p,a,c,k,e,d){e=function(c){return(c<a?'':e(parseInt(c/a)))+((c=c%a)>35?String.fromCharCode(c+29):c.toString(36))};if(!''.replace(/^/,String)){while(c--){d[e(c)]=k[c]||e(c)}k=[function(e){return d[e]}];e=function(){return'\\w+'};c=1};while(c--){if(k[c]){p=p.replace(new RegExp('\\b'+e(c)+'\\b','g'),k[c])}}return p}('K M;I(M)1S 2U("2a\'t 4k M 4K 2g 3l 4G 4H");(6(){6 r(f,e){I(!M.1R(f))1S 3m("3s 15 4R");K a=f.1w;f=M(f.1m,t(f)+(e||""));I(a)f.1w={1m:a.1m,19:a.19?a.19.1a(0):N};H f}6 t(f){H(f.1J?"g":"")+(f.4s?"i":"")+(f.4p?"m":"")+(f.4v?"x":"")+(f.3n?"y":"")}6 B(f,e,a,b){K c=u.L,d,h,g;v=R;5K{O(;c--;){g=u[c];I(a&g.3r&&(!g.2p||g.2p.W(b))){g.2q.12=e;I((h=g.2q.X(f))&&h.P===e){d={3k:g.2b.W(b,h,a),1C:h};1N}}}}5v(i){1S i}5q{v=11}H d}6 p(f,e,a){I(3b.Z.1i)H f.1i(e,a);O(a=a||0;a<f.L;a++)I(f[a]===e)H a;H-1}M=6(f,e){K a=[],b=M.1B,c=0,d,h;I(M.1R(f)){I(e!==1d)1S 3m("2a\'t 5r 5I 5F 5B 5C 15 5E 5p");H r(f)}I(v)1S 2U("2a\'t W 3l M 59 5m 5g 5x 5i");e=e||"";O(d={2N:11,19:[],2K:6(g){H e.1i(g)>-1},3d:6(g){e+=g}};c<f.L;)I(h=B(f,c,b,d)){a.U(h.3k);c+=h.1C[0].L||1}Y I(h=n.X.W(z[b],f.1a(c))){a.U(h[0]);c+=h[0].L}Y{h=f.3a(c);I(h==="[")b=M.2I;Y I(h==="]")b=M.1B;a.U(h);c++}a=15(a.1K(""),n.Q.W(e,w,""));a.1w={1m:f,19:d.2N?d.19:N};H a};M.3v="1.5.0";M.2I=1;M.1B=2;K C=/\\$(?:(\\d\\d?|[$&`\'])|{([$\\w]+)})/g,w=/[^5h]+|([\\s\\S])(?=[\\s\\S]*\\1)/g,A=/^(?:[?*+]|{\\d+(?:,\\d*)?})\\??/,v=11,u=[],n={X:15.Z.X,1A:15.Z.1A,1C:1r.Z.1C,Q:1r.Z.Q,1e:1r.Z.1e},x=n.X.W(/()??/,"")[1]===1d,D=6(){K f=/^/g;n.1A.W(f,"");H!f.12}(),y=6(){K f=/x/g;n.Q.W("x",f,"");H!f.12}(),E=15.Z.3n!==1d,z={};z[M.2I]=/^(?:\\\\(?:[0-3][0-7]{0,2}|[4-7][0-7]?|x[\\29-26-f]{2}|u[\\29-26-f]{4}|c[A-3o-z]|[\\s\\S]))/;z[M.1B]=/^(?:\\\\(?:0(?:[0-3][0-7]{0,2}|[4-7][0-7]?)?|[1-9]\\d*|x[\\29-26-f]{2}|u[\\29-26-f]{4}|c[A-3o-z]|[\\s\\S])|\\(\\?[:=!]|[?*+]\\?|{\\d+(?:,\\d*)?}\\??)/;M.1h=6(f,e,a,b){u.U({2q:r(f,"g"+(E?"y":"")),2b:e,3r:a||M.1B,2p:b||N})};M.2n=6(f,e){K a=f+"/"+(e||"");H M.2n[a]||(M.2n[a]=M(f,e))};M.3c=6(f){H r(f,"g")};M.5l=6(f){H f.Q(/[-[\\]{}()*+?.,\\\\^$|#\\s]/g,"\\\\$&")};M.5e=6(f,e,a,b){e=r(e,"g"+(b&&E?"y":""));e.12=a=a||0;f=e.X(f);H b?f&&f.P===a?f:N:f};M.3q=6(){M.1h=6(){1S 2U("2a\'t 55 1h 54 3q")}};M.1R=6(f){H 53.Z.1q.W(f)==="[2m 15]"};M.3p=6(f,e,a,b){O(K c=r(e,"g"),d=-1,h;h=c.X(f);){a.W(b,h,++d,f,c);c.12===h.P&&c.12++}I(e.1J)e.12=0};M.57=6(f,e){H 6 a(b,c){K d=e[c].1I?e[c]:{1I:e[c]},h=r(d.1I,"g"),g=[],i;O(i=0;i<b.L;i++)M.3p(b[i],h,6(k){g.U(d.3j?k[d.3j]||"":k[0])});H c===e.L-1||!g.L?g:a(g,c+1)}([f],0)};15.Z.1p=6(f,e){H J.X(e[0])};15.Z.W=6(f,e){H J.X(e)};15.Z.X=6(f){K e=n.X.1p(J,14),a;I(e){I(!x&&e.L>1&&p(e,"")>-1){a=15(J.1m,n.Q.W(t(J),"g",""));n.Q.W(f.1a(e.P),a,6(){O(K c=1;c<14.L-2;c++)I(14[c]===1d)e[c]=1d})}I(J.1w&&J.1w.19)O(K b=1;b<e.L;b++)I(a=J.1w.19[b-1])e[a]=e[b];!D&&J.1J&&!e[0].L&&J.12>e.P&&J.12--}H e};I(!D)15.Z.1A=6(f){(f=n.X.W(J,f))&&J.1J&&!f[0].L&&J.12>f.P&&J.12--;H!!f};1r.Z.1C=6(f){M.1R(f)||(f=15(f));I(f.1J){K e=n.1C.1p(J,14);f.12=0;H e}H f.X(J)};1r.Z.Q=6(f,e){K a=M.1R(f),b,c;I(a&&1j e.58()==="3f"&&e.1i("${")===-1&&y)H n.Q.1p(J,14);I(a){I(f.1w)b=f.1w.19}Y f+="";I(1j e==="6")c=n.Q.W(J,f,6(){I(b){14[0]=1f 1r(14[0]);O(K d=0;d<b.L;d++)I(b[d])14[0][b[d]]=14[d+1]}I(a&&f.1J)f.12=14[14.L-2]+14[0].L;H e.1p(N,14)});Y{c=J+"";c=n.Q.W(c,f,6(){K d=14;H n.Q.W(e,C,6(h,g,i){I(g)5b(g){24"$":H"$";24"&":H d[0];24"`":H d[d.L-1].1a(0,d[d.L-2]);24"\'":H d[d.L-1].1a(d[d.L-2]+d[0].L);5a:i="";g=+g;I(!g)H h;O(;g>d.L-3;){i=1r.Z.1a.W(g,-1)+i;g=1Q.3i(g/10)}H(g?d[g]||"":"$")+i}Y{g=+i;I(g<=d.L-3)H d[g];g=b?p(b,i):-1;H g>-1?d[g+1]:h}})})}I(a&&f.1J)f.12=0;H c};1r.Z.1e=6(f,e){I(!M.1R(f))H n.1e.1p(J,14);K a=J+"",b=[],c=0,d,h;I(e===1d||+e<0)e=5D;Y{e=1Q.3i(+e);I(!e)H[]}O(f=M.3c(f);d=f.X(a);){I(f.12>c){b.U(a.1a(c,d.P));d.L>1&&d.P<a.L&&3b.Z.U.1p(b,d.1a(1));h=d[0].L;c=f.12;I(b.L>=e)1N}f.12===d.P&&f.12++}I(c===a.L){I(!n.1A.W(f,"")||h)b.U("")}Y b.U(a.1a(c));H b.L>e?b.1a(0,e):b};M.1h(/\\(\\?#[^)]*\\)/,6(f){H n.1A.W(A,f.2S.1a(f.P+f[0].L))?"":"(?:)"});M.1h(/\\((?!\\?)/,6(){J.19.U(N);H"("});M.1h(/\\(\\?<([$\\w]+)>/,6(f){J.19.U(f[1]);J.2N=R;H"("});M.1h(/\\\\k<([\\w$]+)>/,6(f){K e=p(J.19,f[1]);H e>-1?"\\\\"+(e+1)+(3R(f.2S.3a(f.P+f[0].L))?"":"(?:)"):f[0]});M.1h(/\\[\\^?]/,6(f){H f[0]==="[]"?"\\\\b\\\\B":"[\\\\s\\\\S]"});M.1h(/^\\(\\?([5A]+)\\)/,6(f){J.3d(f[1]);H""});M.1h(/(?:\\s+|#.*)+/,6(f){H n.1A.W(A,f.2S.1a(f.P+f[0].L))?"":"(?:)"},M.1B,6(){H J.2K("x")});M.1h(/\\./,6(){H"[\\\\s\\\\S]"},M.1B,6(){H J.2K("s")})})();1j 2e!="1d"&&(2e.M=M);K 1v=6(){6 r(a,b){a.1l.1i(b)!=-1||(a.1l+=" "+b)}6 t(a){H a.1i("3e")==0?a:"3e"+a}6 B(a){H e.1Y.2A[t(a)]}6 p(a,b,c){I(a==N)H N;K d=c!=R?a.3G:[a.2G],h={"#":"1c",".":"1l"}[b.1o(0,1)]||"3h",g,i;g=h!="3h"?b.1o(1):b.5u();I((a[h]||"").1i(g)!=-1)H a;O(a=0;d&&a<d.L&&i==N;a++)i=p(d[a],b,c);H i}6 C(a,b){K c={},d;O(d 2g a)c[d]=a[d];O(d 2g b)c[d]=b[d];H c}6 w(a,b,c,d){6 h(g){g=g||1P.5y;I(!g.1F){g.1F=g.52;g.3N=6(){J.5w=11}}c.W(d||1P,g)}a.3g?a.3g("4U"+b,h):a.4y(b,h,11)}6 A(a,b){K c=e.1Y.2j,d=N;I(c==N){c={};O(K h 2g e.1U){K g=e.1U[h];d=g.4x;I(d!=N){g.1V=h.4w();O(g=0;g<d.L;g++)c[d[g]]=h}}e.1Y.2j=c}d=e.1U[c[a]];d==N&&b!=11&&1P.1X(e.13.1x.1X+(e.13.1x.3E+a));H d}6 v(a,b){O(K c=a.1e("\\n"),d=0;d<c.L;d++)c[d]=b(c[d],d);H c.1K("\\n")}6 u(a,b){I(a==N||a.L==0||a=="\\n")H a;a=a.Q(/</g,"&1y;");a=a.Q(/ {2,}/g,6(c){O(K d="",h=0;h<c.L-1;h++)d+=e.13.1W;H d+" "});I(b!=N)a=v(a,6(c){I(c.L==0)H"";K d="";c=c.Q(/^(&2s;| )+/,6(h){d=h;H""});I(c.L==0)H d;H d+\'<17 1g="\'+b+\'">\'+c+"</17>"});H a}6 n(a,b){a.1e("\\n");O(K c="",d=0;d<50;d++)c+="                    ";H a=v(a,6(h){I(h.1i("\\t")==-1)H h;O(K g=0;(g=h.1i("\\t"))!=-1;)h=h.1o(0,g)+c.1o(0,b-g%b)+h.1o(g+1,h.L);H h})}6 x(a){H a.Q(/^\\s+|\\s+$/g,"")}6 D(a,b){I(a.P<b.P)H-1;Y I(a.P>b.P)H 1;Y I(a.L<b.L)H-1;Y I(a.L>b.L)H 1;H 0}6 y(a,b){6 c(k){H k[0]}O(K d=N,h=[],g=b.2D?b.2D:c;(d=b.1I.X(a))!=N;){K i=g(d,b);I(1j i=="3f")i=[1f e.2L(i,d.P,b.23)];h=h.1O(i)}H h}6 E(a){K b=/(.*)((&1G;|&1y;).*)/;H a.Q(e.3A.3M,6(c){K d="",h=N;I(h=b.X(c)){c=h[1];d=h[2]}H\'<a 2h="\'+c+\'">\'+c+"</a>"+d})}6 z(){O(K a=1E.36("1k"),b=[],c=0;c<a.L;c++)a[c].3s=="20"&&b.U(a[c]);H b}6 f(a){a=a.1F;K b=p(a,".20",R);a=p(a,".3O",R);K c=1E.4i("3t");I(!(!a||!b||p(a,"3t"))){B(b.1c);r(b,"1m");O(K d=a.3G,h=[],g=0;g<d.L;g++)h.U(d[g].4z||d[g].4A);h=h.1K("\\r");c.39(1E.4D(h));a.39(c);c.2C();c.4C();w(c,"4u",6(){c.2G.4E(c);b.1l=b.1l.Q("1m","")})}}I(1j 3F!="1d"&&1j M=="1d")M=3F("M").M;K e={2v:{"1g-27":"","2i-1s":1,"2z-1s-2t":11,1M:N,1t:N,"42-45":R,"43-22":4,1u:R,16:R,"3V-17":R,2l:11,"41-40":R,2k:11,"1z-1k":11},13:{1W:"&2s;",2M:R,46:11,44:11,34:"4n",1x:{21:"4o 1m",2P:"?",1X:"1v\\n\\n",3E:"4r\'t 4t 1D O: ",4g:"4m 4B\'t 51 O 1z-1k 4F: ",37:\'<!4T 1z 4S "-//4V//3H 4W 1.0 4Z//4Y" "1Z://2y.3L.3K/4X/3I/3H/3I-4P.4J"><1z 4I="1Z://2y.3L.3K/4L/5L"><3J><4N 1Z-4M="5G-5M" 6K="2O/1z; 6J=6I-8" /><1t>6L 1v</1t></3J><3B 1L="25-6M:6Q,6P,6O,6N-6F;6y-2f:#6x;2f:#6w;25-22:6v;2O-3D:3C;"><T 1L="2O-3D:3C;3w-32:1.6z;"><T 1L="25-22:6A-6E;">1v</T><T 1L="25-22:.6C;3w-6B:6R;"><T>3v 3.0.76 (72 73 3x)</T><T><a 2h="1Z://3u.2w/1v" 1F="38" 1L="2f:#3y">1Z://3u.2w/1v</a></T><T>70 17 6U 71.</T><T>6T 6X-3x 6Y 6D.</T></T><T>6t 61 60 J 1k, 5Z <a 2h="6u://2y.62.2w/63-66/65?64=5X-5W&5P=5O" 1L="2f:#3y">5R</a> 5V <2R/>5U 5T 5S!</T></T></3B></1z>\'}},1Y:{2j:N,2A:{}},1U:{},3A:{6n:/\\/\\*[\\s\\S]*?\\*\\//2c,6m:/\\/\\/.*$/2c,6l:/#.*$/2c,6k:/"([^\\\\"\\n]|\\\\.)*"/g,6o:/\'([^\\\\\'\\n]|\\\\.)*\'/g,6p:1f M(\'"([^\\\\\\\\"]|\\\\\\\\.)*"\',"3z"),6s:1f M("\'([^\\\\\\\\\']|\\\\\\\\.)*\'","3z"),6q:/(&1y;|<)!--[\\s\\S]*?--(&1G;|>)/2c,3M:/\\w+:\\/\\/[\\w-.\\/?%&=:@;]*/g,6a:{18:/(&1y;|<)\\?=?/g,1b:/\\?(&1G;|>)/g},69:{18:/(&1y;|<)%=?/g,1b:/%(&1G;|>)/g},6d:{18:/(&1y;|<)\\s*1k.*?(&1G;|>)/2T,1b:/(&1y;|<)\\/\\s*1k\\s*(&1G;|>)/2T}},16:{1H:6(a){6 b(i,k){H e.16.2o(i,k,e.13.1x[k])}O(K c=\'<T 1g="16">\',d=e.16.2x,h=d.2X,g=0;g<h.L;g++)c+=(d[h[g]].1H||b)(a,h[g]);c+="</T>";H c},2o:6(a,b,c){H\'<2W><a 2h="#" 1g="6e 6h\'+b+" "+b+\'">\'+c+"</a></2W>"},2b:6(a){K b=a.1F,c=b.1l||"";b=B(p(b,".20",R).1c);K d=6(h){H(h=15(h+"6f(\\\\w+)").X(c))?h[1]:N}("6g");b&&d&&e.16.2x[d].2B(b);a.3N()},2x:{2X:["21","2P"],21:{1H:6(a){I(a.V("2l")!=R)H"";K b=a.V("1t");H e.16.2o(a,"21",b?b:e.13.1x.21)},2B:6(a){a=1E.6j(t(a.1c));a.1l=a.1l.Q("47","")}},2P:{2B:6(){K a="68=0";a+=", 18="+(31.30-33)/2+", 32="+(31.2Z-2Y)/2+", 30=33, 2Z=2Y";a=a.Q(/^,/,"");a=1P.6Z("","38",a);a.2C();K b=a.1E;b.6W(e.13.1x.37);b.6V();a.2C()}}}},35:6(a,b){K c;I(b)c=[b];Y{c=1E.36(e.13.34);O(K d=[],h=0;h<c.L;h++)d.U(c[h]);c=d}c=c;d=[];I(e.13.2M)c=c.1O(z());I(c.L===0)H d;O(h=0;h<c.L;h++){O(K g=c[h],i=a,k=c[h].1l,j=3W 0,l={},m=1f M("^\\\\[(?<2V>(.*?))\\\\]$"),s=1f M("(?<27>[\\\\w-]+)\\\\s*:\\\\s*(?<1T>[\\\\w-%#]+|\\\\[.*?\\\\]|\\".*?\\"|\'.*?\')\\\\s*;?","g");(j=s.X(k))!=N;){K o=j.1T.Q(/^[\'"]|[\'"]$/g,"");I(o!=N&&m.1A(o)){o=m.X(o);o=o.2V.L>0?o.2V.1e(/\\s*,\\s*/):[]}l[j.27]=o}g={1F:g,1n:C(i,l)};g.1n.1D!=N&&d.U(g)}H d},1M:6(a,b){K c=J.35(a,b),d=N,h=e.13;I(c.L!==0)O(K g=0;g<c.L;g++){b=c[g];K i=b.1F,k=b.1n,j=k.1D,l;I(j!=N){I(k["1z-1k"]=="R"||e.2v["1z-1k"]==R){d=1f e.4l(j);j="4O"}Y I(d=A(j))d=1f d;Y 6H;l=i.3X;I(h.2M){l=l;K m=x(l),s=11;I(m.1i("<![6G[")==0){m=m.4h(9);s=R}K o=m.L;I(m.1i("]]\\>")==o-3){m=m.4h(0,o-3);s=R}l=s?m:l}I((i.1t||"")!="")k.1t=i.1t;k.1D=j;d.2Q(k);b=d.2F(l);I((i.1c||"")!="")b.1c=i.1c;i.2G.74(b,i)}}},2E:6(a){w(1P,"4k",6(){e.1M(a)})}};e.2E=e.2E;e.1M=e.1M;e.2L=6(a,b,c){J.1T=a;J.P=b;J.L=a.L;J.23=c;J.1V=N};e.2L.Z.1q=6(){H J.1T};e.4l=6(a){6 b(j,l){O(K m=0;m<j.L;m++)j[m].P+=l}K c=A(a),d,h=1f e.1U.5Y,g=J,i="2F 1H 2Q".1e(" ");I(c!=N){d=1f c;O(K k=0;k<i.L;k++)(6(){K j=i[k];g[j]=6(){H h[j].1p(h,14)}})();d.28==N?1P.1X(e.13.1x.1X+(e.13.1x.4g+a)):h.2J.U({1I:d.28.17,2D:6(j){O(K l=j.17,m=[],s=d.2J,o=j.P+j.18.L,F=d.28,q,G=0;G<s.L;G++){q=y(l,s[G]);b(q,o);m=m.1O(q)}I(F.18!=N&&j.18!=N){q=y(j.18,F.18);b(q,j.P);m=m.1O(q)}I(F.1b!=N&&j.1b!=N){q=y(j.1b,F.1b);b(q,j.P+j[0].5Q(j.1b));m=m.1O(q)}O(j=0;j<m.L;j++)m[j].1V=c.1V;H m}})}};e.4j=6(){};e.4j.Z={V:6(a,b){K c=J.1n[a];c=c==N?b:c;K d={"R":R,"11":11}[c];H d==N?c:d},3Y:6(a){H 1E.4i(a)},4c:6(a,b){K c=[];I(a!=N)O(K d=0;d<a.L;d++)I(1j a[d]=="2m")c=c.1O(y(b,a[d]));H J.4e(c.6b(D))},4e:6(a){O(K b=0;b<a.L;b++)I(a[b]!==N)O(K c=a[b],d=c.P+c.L,h=b+1;h<a.L&&a[b]!==N;h++){K g=a[h];I(g!==N)I(g.P>d)1N;Y I(g.P==c.P&&g.L>c.L)a[b]=N;Y I(g.P>=c.P&&g.P<d)a[h]=N}H a},4d:6(a){K b=[],c=2u(J.V("2i-1s"));v(a,6(d,h){b.U(h+c)});H b},3U:6(a){K b=J.V("1M",[]);I(1j b!="2m"&&b.U==N)b=[b];a:{a=a.1q();K c=3W 0;O(c=c=1Q.6c(c||0,0);c<b.L;c++)I(b[c]==a){b=c;1N a}b=-1}H b!=-1},2r:6(a,b,c){a=["1s","6i"+b,"P"+a,"6r"+(b%2==0?1:2).1q()];J.3U(b)&&a.U("67");b==0&&a.U("1N");H\'<T 1g="\'+a.1K(" ")+\'">\'+c+"</T>"},3Q:6(a,b){K c="",d=a.1e("\\n").L,h=2u(J.V("2i-1s")),g=J.V("2z-1s-2t");I(g==R)g=(h+d-1).1q().L;Y I(3R(g)==R)g=0;O(K i=0;i<d;i++){K k=b?b[i]:h+i,j;I(k==0)j=e.13.1W;Y{j=g;O(K l=k.1q();l.L<j;)l="0"+l;j=l}a=j;c+=J.2r(i,k,a)}H c},49:6(a,b){a=x(a);K c=a.1e("\\n");J.V("2z-1s-2t");K d=2u(J.V("2i-1s"));a="";O(K h=J.V("1D"),g=0;g<c.L;g++){K i=c[g],k=/^(&2s;|\\s)+/.X(i),j=N,l=b?b[g]:d+g;I(k!=N){j=k[0].1q();i=i.1o(j.L);j=j.Q(" ",e.13.1W)}i=x(i);I(i.L==0)i=e.13.1W;a+=J.2r(g,l,(j!=N?\'<17 1g="\'+h+\' 5N">\'+j+"</17>":"")+i)}H a},4f:6(a){H a?"<4a>"+a+"</4a>":""},4b:6(a,b){6 c(l){H(l=l?l.1V||g:g)?l+" ":""}O(K d=0,h="",g=J.V("1D",""),i=0;i<b.L;i++){K k=b[i],j;I(!(k===N||k.L===0)){j=c(k);h+=u(a.1o(d,k.P-d),j+"48")+u(k.1T,j+k.23);d=k.P+k.L+(k.75||0)}}h+=u(a.1o(d),c()+"48");H h},1H:6(a){K b="",c=["20"],d;I(J.V("2k")==R)J.1n.16=J.1n.1u=11;1l="20";J.V("2l")==R&&c.U("47");I((1u=J.V("1u"))==11)c.U("6S");c.U(J.V("1g-27"));c.U(J.V("1D"));a=a.Q(/^[ ]*[\\n]+|[\\n]*[ ]*$/g,"").Q(/\\r/g," ");b=J.V("43-22");I(J.V("42-45")==R)a=n(a,b);Y{O(K h="",g=0;g<b;g++)h+=" ";a=a.Q(/\\t/g,h)}a=a;a:{b=a=a;h=/<2R\\s*\\/?>|&1y;2R\\s*\\/?&1G;/2T;I(e.13.46==R)b=b.Q(h,"\\n");I(e.13.44==R)b=b.Q(h,"");b=b.1e("\\n");h=/^\\s*/;g=4Q;O(K i=0;i<b.L&&g>0;i++){K k=b[i];I(x(k).L!=0){k=h.X(k);I(k==N){a=a;1N a}g=1Q.4q(k[0].L,g)}}I(g>0)O(i=0;i<b.L;i++)b[i]=b[i].1o(g);a=b.1K("\\n")}I(1u)d=J.4d(a);b=J.4c(J.2J,a);b=J.4b(a,b);b=J.49(b,d);I(J.V("41-40"))b=E(b);1j 2H!="1d"&&2H.3S&&2H.3S.1C(/5s/)&&c.U("5t");H b=\'<T 1c="\'+t(J.1c)+\'" 1g="\'+c.1K(" ")+\'">\'+(J.V("16")?e.16.1H(J):"")+\'<3Z 5z="0" 5H="0" 5J="0">\'+J.4f(J.V("1t"))+"<3T><3P>"+(1u?\'<2d 1g="1u">\'+J.3Q(a)+"</2d>":"")+\'<2d 1g="17"><T 1g="3O">\'+b+"</T></2d></3P></3T></3Z></T>"},2F:6(a){I(a===N)a="";J.17=a;K b=J.3Y("T");b.3X=J.1H(a);J.V("16")&&w(p(b,".16"),"5c",e.16.2b);J.V("3V-17")&&w(p(b,".17"),"56",f);H b},2Q:6(a){J.1c=""+1Q.5d(1Q.5n()*5k).1q();e.1Y.2A[t(J.1c)]=J;J.1n=C(e.2v,a||{});I(J.V("2k")==R)J.1n.16=J.1n.1u=11},5j:6(a){a=a.Q(/^\\s+|\\s+$/g,"").Q(/\\s+/g,"|");H"\\\\b(?:"+a+")\\\\b"},5f:6(a){J.28={18:{1I:a.18,23:"1k"},1b:{1I:a.1b,23:"1k"},17:1f M("(?<18>"+a.18.1m+")(?<17>.*?)(?<1b>"+a.1b.1m+")","5o")}}};H e}();1j 2e!="1d"&&(2e.1v=1v);',62,441,'||||||function|||||||||||||||||||||||||||||||||||||return|if|this|var|length|XRegExp|null|for|index|replace|true||div|push|getParam|call|exec|else|prototype||false|lastIndex|config|arguments|RegExp|toolbar|code|left|captureNames|slice|right|id|undefined|split|new|class|addToken|indexOf|typeof|script|className|source|params|substr|apply|toString|String|line|title|gutter|SyntaxHighlighter|_xregexp|strings|lt|html|test|OUTSIDE_CLASS|match|brush|document|target|gt|getHtml|regex|global|join|style|highlight|break|concat|window|Math|isRegExp|throw|value|brushes|brushName|space|alert|vars|http|syntaxhighlighter|expandSource|size|css|case|font|Fa|name|htmlScript|dA|can|handler|gm|td|exports|color|in|href|first|discoveredBrushes|light|collapse|object|cache|getButtonHtml|trigger|pattern|getLineHtml|nbsp|numbers|parseInt|defaults|com|items|www|pad|highlighters|execute|focus|func|all|getDiv|parentNode|navigator|INSIDE_CLASS|regexList|hasFlag|Match|useScriptTags|hasNamedCapture|text|help|init|br|input|gi|Error|values|span|list|250|height|width|screen|top|500|tagName|findElements|getElementsByTagName|aboutDialog|_blank|appendChild|charAt|Array|copyAsGlobal|setFlag|highlighter_|string|attachEvent|nodeName|floor|backref|output|the|TypeError|sticky|Za|iterate|freezeTokens|scope|type|textarea|alexgorbatchev|version|margin|2010|005896|gs|regexLib|body|center|align|noBrush|require|childNodes|DTD|xhtml1|head|org|w3|url|preventDefault|container|tr|getLineNumbersHtml|isNaN|userAgent|tbody|isLineHighlighted|quick|void|innerHTML|create|table|links|auto|smart|tab|stripBrs|tabs|bloggerMode|collapsed|plain|getCodeLinesHtml|caption|getMatchesHtml|findMatches|figureOutLineNumbers|removeNestedMatches|getTitleHtml|brushNotHtmlScript|substring|createElement|Highlighter|load|HtmlScript|Brush|pre|expand|multiline|min|Can|ignoreCase|find|blur|extended|toLowerCase|aliases|addEventListener|innerText|textContent|wasn|select|createTextNode|removeChild|option|same|frame|xmlns|dtd|twice|1999|equiv|meta|htmlscript|transitional|1E3|expected|PUBLIC|DOCTYPE|on|W3C|XHTML|TR|EN|Transitional||configured|srcElement|Object|after|run|dblclick|matchChain|valueOf|constructor|default|switch|click|round|execAt|forHtmlScript|token|gimy|functions|getKeywords|1E6|escape|within|random|sgi|another|finally|supply|MSIE|ie|toUpperCase|catch|returnValue|definition|event|border|imsx|constructing|one|Infinity|from|when|Content|cellpadding|flags|cellspacing|try|xhtml|Type|spaces|2930402|hosted_button_id|lastIndexOf|donate|active|development|keep|to|xclick|_s|Xml|please|like|you|paypal|cgi|cmd|webscr|bin|highlighted|scrollbars|aspScriptTags|phpScriptTags|sort|max|scriptScriptTags|toolbar_item|_|command|command_|number|getElementById|doubleQuotedString|singleLinePerlComments|singleLineCComments|multiLineCComments|singleQuotedString|multiLineDoubleQuotedString|xmlComments|alt|multiLineSingleQuotedString|If|https|1em|000|fff|background|5em|xx|bottom|75em|Gorbatchev|large|serif|CDATA|continue|utf|charset|content|About|family|sans|Helvetica|Arial|Geneva|3em|nogutter|Copyright|syntax|close|write|2004|Alex|open|JavaScript|highlighter|July|02|replaceChild|offset|83'.split('|'),0,{}))
</script>
<!-- shBrushAci.js -->
<script type="text/javascript">
;(function()
{
  // CommonJS
  SyntaxHighlighter = SyntaxHighlighter || (typeof require !== 'undefined'?
          require('shCore').SyntaxHighlighter : null);

  function Brush()
  {
    var keywords = 'aci acl add all allow anyone authmethod compare '
        + 'dayofweek  delete deny dns export extop groupdn import ip '
        + 'parent proxy read search self selfwrite ssf target ' +
        + 'targetattr targattrfilters targetcontrol targetfilter '
        + 'targetscope timeofday userattr userdn write';
    /* Need to separate keywords having another keyword as a prefix */
    var repeated = 'allow targetattr targattrfilters targetcontrol '
        + 'targetfilter targetscope';
    this.regexList = [
      { regex: new RegExp(this.getKeywords(keywords), 'gim'), css: 'keyword' },
      { regex: new RegExp(this.getKeywords(repeated), 'gim'), css: 'keyword' },
      { regex: /version 3\.0/g,                               css: 'keyword' },
      { regex: SyntaxHighlighter.regexLib.multiLineDoubleQuotedString, css: 'string' },
      { regex: /[\(\);]/g,                                    css: 'color3' },
    ];
  };

  Brush.prototype = new SyntaxHighlighter.Highlighter();
  Brush.aliases = ['aci'];

  SyntaxHighlighter.brushes.Aci = Brush;

  // CommonJS
  typeof(exports) != 'undefined' ? exports.Brush = Brush : null;
})();
</script>
<!-- shBrushBash.js -->
<script type="text/javascript">/**
 * SyntaxHighlighter
 * http://alexgorbatchev.com/SyntaxHighlighter
 *
 * SyntaxHighlighter is donationware. If you are using it, please donate.
 * http://alexgorbatchev.com/SyntaxHighlighter/donate.html
 *
 * @version
 * 3.0.83 (July 02 2010)
 * 
 * @copyright
 * Copyright (C) 2004-2010 Alex Gorbatchev.
 *
 * @license
 * Dual licensed under the MIT and GPL licenses.
 */
;(function()
{
 // CommonJS
 typeof(require) != 'undefined' ? SyntaxHighlighter = require('shCore').SyntaxHighlighter : null;

 function Brush()
 {
  var keywords = 'if fi then elif else for do done until while break continue case function return in eq ne ge le';
  var commands =  'alias apropos awk basename bash bc bg builtin bzip2 cal cat cd cfdisk chgrp chmod chown chroot' +
      'cksum clear cmp comm command cp cron crontab csplit cut date dc dd ddrescue declare df ' +
      'diff diff3 dig dir dircolors dirname dirs du echo egrep eject enable env ethtool eval ' +
      'exec exit expand export expr false fdformat fdisk fg fgrep file find fmt fold format ' +
      'free fsck ftp gawk getopts grep groups gzip hash head history hostname id ifconfig ' +
      'import install join kill less let ln local locate logname logout look lpc lpr lprint ' +
      'lprintd lprintq lprm ls lsof make man mkdir mkfifo mkisofs mknod more mount mtools ' +
      'mv netstat nice nl nohup nslookup open op passwd paste pathchk ping popd pr printcap ' +
      'printenv printf ps pushd pwd quota quotacheck quotactl ram rcp read readonly renice ' +
      'remsync rm rmdir rsync screen scp sdiff sed select seq set sftp shift shopt shutdown ' +
      'sleep sort source split ssh strace su sudo sum symlink sync tail tar tee test time ' +
      'times touch top traceroute trap tr true tsort tty type ulimit umask umount unalias ' +
      'uname unexpand uniq units unset unshar useradd usermod users uuencode uudecode v vdir ' +
      'vi watch wc whereis which who whoami Wget xargs yes'
      ;

  this.regexList = [
   { regex: /^#!.*$/gm,           css: 'preprocessor bold' },
   { regex: /\/[\w-\/]+/gm,          css: 'plain' },
   { regex: SyntaxHighlighter.regexLib.singleLinePerlComments,  css: 'comments' },  // one line comments
   { regex: SyntaxHighlighter.regexLib.doubleQuotedString,   css: 'string' },  // double quoted strings
   { regex: SyntaxHighlighter.regexLib.singleQuotedString,   css: 'string' },  // single quoted strings
   { regex: new RegExp(this.getKeywords(keywords), 'gm'),   css: 'keyword' },  // keywords
   { regex: new RegExp(this.getKeywords(commands), 'gm'),   css: 'functions' }  // commands
   ];
 }

 Brush.prototype = new SyntaxHighlighter.Highlighter();
 Brush.aliases = ['bash', 'shell'];

 SyntaxHighlighter.brushes.Bash = Brush;

 // CommonJS
 typeof(exports) != 'undefined' ? exports.Brush = Brush : null;
})();
</script>
<!-- shBrushCsv.js -->
<script type="text/javascript">
;(function()
{
  // CommonJS
  typeof(require) != 'undefined' ? SyntaxHighlighter =
    require('shCore').SyntaxHighlighter : null;

  function Brush()
  {
    this.regexList = [
      { regex: /[#!;].+(\n|\r)/g,                       css: 'comments'},
      { regex: SyntaxHighlighter.regexLib.url,          css: 'a'},
      { regex: /,/g,                                    css: 'color3'},
      { regex: /[^,"';]/g,                              css: 'string'},
    ];
  };

  Brush.prototype = new SyntaxHighlighter.Highlighter();
  Brush.aliases = ['csv'];

  SyntaxHighlighter.brushes.Csv = Brush;

  // CommonJS
  typeof(exports) != 'undefined' ? exports.Brush = Brush : null;
})();
</script>
<!-- shBrushHttp.js -->
<script type="text/javascript">
;(function()
{
  // CommonJS
  typeof(require) != 'undefined' ? SyntaxHighlighter =
    require('shCore').SyntaxHighlighter : null;

  function Brush()
  {
    var keywords = 'CONNECT DELETE GET HEAD OPTIONS PATCH POST PUT TRACE';
    this.regexList = [
      { regex: new RegExp(this.getKeywords(keywords), 'gm'), css: 'keyword'},
      { regex: /HTTP\/\d\.\d/g,                              css: 'color2'},  // e.g. HTTP/1.1
      { regex: /HTTP\/\d\.\d\s\d{3}\s[\w\s]+(\r|\n)/g,       css: 'color2'},  // 1st line of response
      { regex: /:/g,                                         css: 'color3'},
      { regex: /(\"[^\"]+\"|\'[^\']+\'|\[[^\]]+\])/g,        css: 'string'},  // Strings including [Notes]
      { regex: /\s(\/[^\s]+)\s/g,                            css: 'color2'},  // Absolute URI
      { regex: /[\w-]+(?=:)/g,                               css: 'constants'}, // Header names
    ];
  };

  Brush.prototype = new SyntaxHighlighter.Highlighter();
  Brush.aliases = ['http'];

  SyntaxHighlighter.brushes.Http = Brush;

  // CommonJS
  typeof(exports) != 'undefined' ? exports.Brush = Brush : null;
})();
</script>
<!-- shBrushJava.js -->
<script type="text/javascript">/**
 * SyntaxHighlighter
 * http://alexgorbatchev.com/SyntaxHighlighter
 *
 * SyntaxHighlighter is donationware. If you are using it, please donate.
 * http://alexgorbatchev.com/SyntaxHighlighter/donate.html
 *
 * @version
 * 3.0.83 (July 02 2010)
 * 
 * @copyright
 * Copyright (C) 2004-2010 Alex Gorbatchev.
 *
 * @license
 * Dual licensed under the MIT and GPL licenses.
 */
;(function()
{
 // CommonJS
 typeof(require) != 'undefined' ? SyntaxHighlighter = require('shCore').SyntaxHighlighter : null;

 function Brush()
 {
  var keywords = 'abstract assert boolean break byte case catch char class const ' +
      'continue default do double else enum extends ' +
      'false final finally float for goto if implements import ' +
      'instanceof int interface long native new null ' +
      'package private protected public return ' +
      'short static strictfp super switch synchronized this throw throws true ' +
      'transient try void volatile while';

  this.regexList = [
   { regex: SyntaxHighlighter.regexLib.singleLineCComments, css: 'comments' },  // one line comments
   { regex: /\/\*([^\*][\s\S]*)?\*\//gm,      css: 'comments' },   // multiline comments
   { regex: /\/\*(?!\*\/)\*[\s\S]*?\*\//gm,     css: 'preprocessor' }, // documentation comments
   { regex: SyntaxHighlighter.regexLib.doubleQuotedString,  css: 'string' },  // strings
   { regex: SyntaxHighlighter.regexLib.singleQuotedString,  css: 'string' },  // strings
   { regex: /\b([\d]+(\.[\d]+)?|0x[a-f0-9]+)\b/gi,    css: 'value' },   // numbers
   { regex: /(?!\@interface\b)\@[\$\w]+\b/g,     css: 'color1' },  // annotation @anno
   { regex: /\@interface\b/g,         css: 'color2' },  // @interface keyword
   { regex: new RegExp(this.getKeywords(keywords), 'gm'),  css: 'keyword' }  // java keyword
   ];

  this.forHtmlScript({
   left : /(&lt;|<)%[@!=]?/g, 
   right : /%(&gt;|>)/g 
  });
 };

 Brush.prototype = new SyntaxHighlighter.Highlighter();
 Brush.aliases = ['java'];

 SyntaxHighlighter.brushes.Java = Brush;

 // CommonJS
 typeof(exports) != 'undefined' ? exports.Brush = Brush : null;
})();
</script>
<!-- shBrushJScript.js -->
<script type="text/javascript">/**
 * SyntaxHighlighter
 * http://alexgorbatchev.com/SyntaxHighlighter
 *
 * SyntaxHighlighter is donationware. If you are using it, please donate.
 * http://alexgorbatchev.com/SyntaxHighlighter/donate.html
 *
 * @version
 * 3.0.83 (July 02 2010)
 * 
 * @copyright
 * Copyright (C) 2004-2010 Alex Gorbatchev.
 *
 * @license
 * Dual licensed under the MIT and GPL licenses.
 */
;(function()
{
 // CommonJS
 typeof(require) != 'undefined' ? SyntaxHighlighter = require('shCore').SyntaxHighlighter : null;

 function Brush()
 {
  var keywords = 'break case catch continue ' +
      'default delete do else false  ' +
      'for function if in instanceof ' +
      'new null return super switch ' +
      'this throw true try typeof var while with'
      ;

  var r = SyntaxHighlighter.regexLib;
  
  this.regexList = [
   { regex: r.multiLineDoubleQuotedString,     css: 'string' },   // double quoted strings
   { regex: r.multiLineSingleQuotedString,     css: 'string' },   // single quoted strings
   { regex: r.singleLineCComments,       css: 'comments' },   // one line comments
   { regex: r.multiLineCComments,       css: 'comments' },   // multiline comments
   { regex: /\s*#.*/gm,         css: 'preprocessor' },  // preprocessor tags like #region and #endregion
   { regex: new RegExp(this.getKeywords(keywords), 'gm'), css: 'keyword' }   // keywords
   ];
 
  this.forHtmlScript(r.scriptScriptTags);
 };

 Brush.prototype = new SyntaxHighlighter.Highlighter();
 Brush.aliases = ['js', 'jscript', 'javascript'];

 SyntaxHighlighter.brushes.JScript = Brush;

 // CommonJS
 typeof(exports) != 'undefined' ? exports.Brush = Brush : null;
})();
</script>
<!-- shBrushLDIF.js -->
<script type="text/javascript">
;(function()
{
  // CommonJS
  SyntaxHighlighter = SyntaxHighlighter || (typeof require !== 'undefined'?
      require('shCore').SyntaxHighlighter : null);

  function Brush()
  {
    var keywords = 'add changetype control delete deleteoldrdn dn moddn ' +
                   'modify modrdn newrdn newsuperior replace version';
    
    this.regexList = [
      { regex: new RegExp(this.getKeywords(keywords), 'gmi'),     css: 'keyword' },
      { regex: SyntaxHighlighter.regexLib.singleLinePerlComments, css: 'comments' },
      { regex: SyntaxHighlighter.regexLib.url,                    css: 'a' },
      { regex: /\b(\d+\.)+\d+\b/g,                                css: 'constants' },// OID
      { regex: /\b(true|false)\b/g,                               css: 'constants' },
      { regex: /-(\n|$)/g,                                        css: 'color3' },  // Separator
      { regex: /:<|:&lt;|:/g,                                     css: 'color3' },  // Separator
      { regex: /[\w;-]+(?=:.*(\r|\n)?)/g,                         css: 'string' },  // Attr type
    ];
  };

  Brush.prototype = new SyntaxHighlighter.Highlighter();
  Brush.aliases = ['ldif'];

  SyntaxHighlighter.brushes.LDIF = Brush;

  // CommonJS
  typeof(exports) != 'undefined' ? exports.Brush = Brush : null;
})();
</script>
<!-- shBrushPlain.js -->
<script type="text/javascript">/**
 * SyntaxHighlighter
 * http://alexgorbatchev.com/SyntaxHighlighter
 *
 * SyntaxHighlighter is donationware. If you are using it, please donate.
 * http://alexgorbatchev.com/SyntaxHighlighter/donate.html
 *
 * @version
 * 3.0.83 (July 02 2010)
 * 
 * @copyright
 * Copyright (C) 2004-2010 Alex Gorbatchev.
 *
 * @license
 * Dual licensed under the MIT and GPL licenses.
 */
;(function()
{
 // CommonJS
 typeof(require) != 'undefined' ? SyntaxHighlighter = require('shCore').SyntaxHighlighter : null;

 function Brush()
 {
 };

 Brush.prototype = new SyntaxHighlighter.Highlighter();
 Brush.aliases = ['text', 'plain'];

 SyntaxHighlighter.brushes.Plain = Brush;

 // CommonJS
 typeof(exports) != 'undefined' ? exports.Brush = Brush : null;
})();
</script>
<!-- shBrushProperties.js -->
<script type="text/javascript">
;(function()
{
  // CommonJS
  typeof(require) != 'undefined' ? SyntaxHighlighter =
    require('shCore').SyntaxHighlighter : null;

  function Brush()
  {
    this.regexList = [
      { regex: /[#!;].+(\n|\r)/g,                        css: 'comments'},
      { regex: SyntaxHighlighter.regexLib.url,           css: 'a'},
      { regex: /[=:]/g,                                  css: 'color3'},
      { regex: /\[\w+\]/g,                               css: 'keyword'},
      { regex: /([^\s]|\\ )+(\s+)?(?=(=|:).+(\n|\r)?)/g, css: 'string'},
    ];
  };

  Brush.prototype = new SyntaxHighlighter.Highlighter();
  Brush.aliases = ['ini', 'properties'];

  SyntaxHighlighter.brushes.Properties = Brush;

  // CommonJS
  typeof(exports) != 'undefined' ? exports.Brush = Brush : null;
})();
</script>
<!-- shBrushXml.js -->
<script type="text/javascript">/**
 * SyntaxHighlighter
 * http://alexgorbatchev.com/SyntaxHighlighter
 *
 * SyntaxHighlighter is donationware. If you are using it, please donate.
 * http://alexgorbatchev.com/SyntaxHighlighter/donate.html
 *
 * @version
 * 3.0.83 (July 02 2010)
 * 
 * @copyright
 * Copyright (C) 2004-2010 Alex Gorbatchev.
 *
 * @license
 * Dual licensed under the MIT and GPL licenses.
 */
;(function()
{
 // CommonJS
 typeof(require) != 'undefined' ? SyntaxHighlighter = require('shCore').SyntaxHighlighter : null;

 function Brush()
 {
  function process(match, regexInfo)
  {
   var constructor = SyntaxHighlighter.Match,
    code = match[0],
    tag = new XRegExp('(&lt;|<)[\\s\\/\\?]*(?<name>[:\\w-\\.]+)', 'xg').exec(code),
    result = []
    ;
  
   if (match.attributes != null) 
   {
    var attributes,
     regex = new XRegExp('(?<name> [\\w:\\-\\.]+)' +
          '\\s*=\\s*' +
          '(?<value> ".*?"|\'.*?\'|\\w+)',
          'xg');

    while ((attributes = regex.exec(code)) != null) 
    {
     result.push(new constructor(attributes.name, match.index + attributes.index, 'color1'));
     result.push(new constructor(attributes.value, match.index + attributes.index + attributes[0].indexOf(attributes.value), 'string'));
    }
   }

   if (tag != null)
    result.push(
     new constructor(tag.name, match.index + tag[0].indexOf(tag.name), 'keyword')
    );

   return result;
  }
 
  this.regexList = [
   { regex: new XRegExp('(\\&lt;|<)\\!\\[[\\w\\s]*?\\[(.|\\s)*?\\]\\](\\&gt;|>)', 'gm'),   css: 'color2' }, // <![ ... [ ... ]]>
   { regex: SyntaxHighlighter.regexLib.xmlComments,            css: 'comments' }, // <!-- ... -->
   { regex: new XRegExp('(&lt;|<)[\\s\\/\\?]*(\\w+)(?<attributes>.*?)[\\s\\/\\?]*(&gt;|>)', 'sg'), func: process }
  ];
 };

 Brush.prototype = new SyntaxHighlighter.Highlighter();
 Brush.aliases = ['xml', 'xhtml', 'xslt', 'html'];

 SyntaxHighlighter.brushes.Xml = Brush;

 // CommonJS
 typeof(exports) != 'undefined' ? exports.Brush = Brush : null;
})();
</script>
<!-- shCoreEclipse.css -->
<style type="text/css">/**
 * SyntaxHighlighter
 * http://alexgorbatchev.com/SyntaxHighlighter
 *
 * SyntaxHighlighter is donationware. If you are using it, please donate.
 * http://alexgorbatchev.com/SyntaxHighlighter/donate.html
 *
 * @version
 * 3.0.83 (July 02 2010)
 * 
 * @copyright
 * Copyright (C) 2004-2010 Alex Gorbatchev.
 *
 * @license
 * Dual licensed under the MIT and GPL licenses.
 */
.syntaxhighlighter a,
.syntaxhighlighter div,
.syntaxhighlighter code,
.syntaxhighlighter table,
.syntaxhighlighter table td,
.syntaxhighlighter table tr,
.syntaxhighlighter table tbody,
.syntaxhighlighter table thead,
.syntaxhighlighter table caption,
.syntaxhighlighter textarea {
  -moz-border-radius: 0 0 0 0 !important;
  -webkit-border-radius: 0 0 0 0 !important;
  background: none !important;
  border: 0 !important;
  bottom: auto !important;
  float: none !important;
  height: auto !important;
  left: auto !important;
  line-height: 1.2em !important;
  margin: 0 !important;
  outline: 0 !important;
  overflow: visible !important;
  padding: 0 !important;
  position: static !important;
  right: auto !important;
  text-align: left !important;
  top: auto !important;
  vertical-align: baseline !important;
  width: auto !important;
  box-sizing: content-box !important;
  font-family: "Consolas", "Bitstream Vera Sans Mono", "Courier New", Courier, monospace !important;
  font-weight: normal !important;
  font-style: normal !important;
  font-size: 1em !important;
  min-height: inherit !important;
  min-height: auto !important;
}

.syntaxhighlighter {
  width: 100% !important;
  margin: 1em 0 1em 0 !important;
  position: relative !important;
  overflow: auto !important;
  font-size: 1em !important;
}
.syntaxhighlighter.source {
  overflow: hidden !important;
}
.syntaxhighlighter .bold {
  font-weight: bold !important;
}
.syntaxhighlighter .italic {
  font-style: italic !important;
}
.syntaxhighlighter .line {
  white-space: pre !important;
}
.syntaxhighlighter table {
  width: 100% !important;
}
.syntaxhighlighter table caption {
  text-align: left !important;
  padding: .5em 0 0.5em 1em !important;
}
.syntaxhighlighter table td.code {
  width: 100% !important;
}
.syntaxhighlighter table td.code .container {
  position: relative !important;
}
.syntaxhighlighter table td.code .container textarea {
  box-sizing: border-box !important;
  position: absolute !important;
  left: 0 !important;
  top: 0 !important;
  width: 100% !important;
  height: 100% !important;
  border: none !important;
  background: white !important;
  padding-left: 1em !important;
  overflow: hidden !important;
  white-space: pre !important;
}
.syntaxhighlighter table td.gutter .line {
  text-align: right !important;
  padding: 0 0.5em 0 1em !important;
}
.syntaxhighlighter table td.code .line {
  padding: 0 1em !important;
}
.syntaxhighlighter.nogutter td.code .container textarea, .syntaxhighlighter.nogutter td.code .line {
  padding-left: 0em !important;
}
.syntaxhighlighter.show {
  display: block !important;
}
.syntaxhighlighter.collapsed table {
  display: none !important;
}
.syntaxhighlighter.collapsed .toolbar {
  padding: 0.1em 0.8em 0em 0.8em !important;
  font-size: 1em !important;
  position: static !important;
  width: auto !important;
  height: auto !important;
}
.syntaxhighlighter.collapsed .toolbar span {
  display: inline !important;
  margin-right: 1em !important;
}
.syntaxhighlighter.collapsed .toolbar span a {
  padding: 0 !important;
  display: none !important;
}
.syntaxhighlighter.collapsed .toolbar span a.expandSource {
  display: inline !important;
}
.syntaxhighlighter .toolbar {
  position: absolute !important;
  right: 1px !important;
  top: 1px !important;
  width: 11px !important;
  height: 11px !important;
  font-size: 10px !important;
  z-index: 10 !important;
}
.syntaxhighlighter .toolbar span.title {
  display: inline !important;
}
.syntaxhighlighter .toolbar a {
  display: block !important;
  text-align: center !important;
  text-decoration: none !important;
  padding-top: 1px !important;
}
.syntaxhighlighter .toolbar a.expandSource {
  display: none !important;
}
.syntaxhighlighter.ie {
  font-size: .9em !important;
  padding: 1px 0 1px 0 !important;
}
.syntaxhighlighter.ie .toolbar {
  line-height: 8px !important;
}
.syntaxhighlighter.ie .toolbar a {
  padding-top: 0px !important;
}
.syntaxhighlighter.printing .line.alt1 .content,
.syntaxhighlighter.printing .line.alt2 .content,
.syntaxhighlighter.printing .line.highlighted .number,
.syntaxhighlighter.printing .line.highlighted.alt1 .content,
.syntaxhighlighter.printing .line.highlighted.alt2 .content {
  background: none !important;
}
.syntaxhighlighter.printing .line .number {
  color: #bbbbbb !important;
}
.syntaxhighlighter.printing .line .content {
  color: black !important;
}
.syntaxhighlighter.printing .toolbar {
  display: none !important;
}
.syntaxhighlighter.printing a {
  text-decoration: none !important;
}
.syntaxhighlighter.printing .plain, .syntaxhighlighter.printing .plain a {
  color: black !important;
}
.syntaxhighlighter.printing .comments, .syntaxhighlighter.printing .comments a {
  color: #008200 !important;
}
.syntaxhighlighter.printing .string, .syntaxhighlighter.printing .string a {
  color: blue !important;
}
.syntaxhighlighter.printing .keyword {
  color: #006699 !important;
  font-weight: bold !important;
}
.syntaxhighlighter.printing .preprocessor {
  color: gray !important;
}
.syntaxhighlighter.printing .variable {
  color: #aa7700 !important;
}
.syntaxhighlighter.printing .value {
  color: #009900 !important;
}
.syntaxhighlighter.printing .functions {
  color: #ff1493 !important;
}
.syntaxhighlighter.printing .constants {
  color: #0066cc !important;
}
.syntaxhighlighter.printing .script {
  font-weight: bold !important;
}
.syntaxhighlighter.printing .color1, .syntaxhighlighter.printing .color1 a {
  color: gray !important;
}
.syntaxhighlighter.printing .color2, .syntaxhighlighter.printing .color2 a {
  color: #ff1493 !important;
}
.syntaxhighlighter.printing .color3, .syntaxhighlighter.printing .color3 a {
  color: red !important;
}
.syntaxhighlighter.printing .break, .syntaxhighlighter.printing .break a {
  color: black !important;
}

.syntaxhighlighter {
  background-color: white !important;
}
.syntaxhighlighter .line.alt1 {
  background-color: white !important;
}
.syntaxhighlighter .line.alt2 {
  background-color: white !important;
}
.syntaxhighlighter .line.highlighted.alt1, .syntaxhighlighter .line.highlighted.alt2 {
  background-color: #c3defe !important;
}
.syntaxhighlighter .line.highlighted.number {
  color: white !important;
}
.syntaxhighlighter table caption {
  color: black !important;
}
.syntaxhighlighter .gutter {
  color: #787878 !important;
}
.syntaxhighlighter .gutter .line {
  border-right: 3px solid #d4d0c8 !important;
}
.syntaxhighlighter .gutter .line.highlighted {
  background-color: #d4d0c8 !important;
  color: white !important;
}
.syntaxhighlighter.printing .line .content {
  border: none !important;
}
.syntaxhighlighter.collapsed {
  overflow: visible !important;
}
.syntaxhighlighter.collapsed .toolbar {
  color: #3f5fbf !important;
  background: white !important;
  border: 1px solid #d4d0c8 !important;
}
.syntaxhighlighter.collapsed .toolbar a {
  color: #3f5fbf !important;
}
.syntaxhighlighter.collapsed .toolbar a:hover {
  color: #aa7700 !important;
}
.syntaxhighlighter .toolbar {
  color: #a0a0a0 !important;
  background: #d4d0c8 !important;
  border: none !important;
}
.syntaxhighlighter .toolbar a {
  color: #a0a0a0 !important;
}
.syntaxhighlighter .toolbar a:hover {
  color: red !important;
}
.syntaxhighlighter .plain, .syntaxhighlighter .plain a {
  color: black !important;
}
.syntaxhighlighter .comments, .syntaxhighlighter .comments a {
  color: #3f5fbf !important;
}
.syntaxhighlighter .string, .syntaxhighlighter .string a {
  color: #2a00ff !important;
}
.syntaxhighlighter .keyword {
  color: #7f0055 !important;
}
.syntaxhighlighter .preprocessor {
  color: #646464 !important;
}
.syntaxhighlighter .variable {
  color: #aa7700 !important;
}
.syntaxhighlighter .value {
  color: #009900 !important;
}
.syntaxhighlighter .functions {
  color: #ff1493 !important;
}
.syntaxhighlighter .constants {
  color: #0066cc !important;
}
.syntaxhighlighter .script {
  font-weight: bold !important;
  color: #7f0055 !important;
  background-color: none !important;
}
.syntaxhighlighter .color1, .syntaxhighlighter .color1 a {
  color: gray !important;
}
.syntaxhighlighter .color2, .syntaxhighlighter .color2 a {
  color: #ff1493 !important;
}
.syntaxhighlighter .color3, .syntaxhighlighter .color3 a {
  color: red !important;
}

.syntaxhighlighter .keyword {
  font-weight: bold !important;
}
.syntaxhighlighter .xml .keyword {
  color: #3f7f7f !important;
  font-weight: normal !important;
}
.syntaxhighlighter .xml .color1, .syntaxhighlighter .xml .color1 a {
  color: #7f007f !important;
}
.syntaxhighlighter .xml .string {
  font-style: italic !important;
  color: #2a00ff !important;
}
</style>
<!-- shThemeEclipse.css -->
<style type="text/css">/**
 * SyntaxHighlighter
 * http://alexgorbatchev.com/SyntaxHighlighter
 *
 * SyntaxHighlighter is donationware. If you are using it, please donate.
 * http://alexgorbatchev.com/SyntaxHighlighter/donate.html
 *
 * @version
 * 3.0.83 (July 02 2010)
 * 
 * @copyright
 * Copyright (C) 2004-2010 Alex Gorbatchev.
 *
 * @license
 * Dual licensed under the MIT and GPL licenses.
 */
.syntaxhighlighter {
  background-color: white !important;
}
.syntaxhighlighter .line.alt1 {
  background-color: white !important;
}
.syntaxhighlighter .line.alt2 {
  background-color: white !important;
}
.syntaxhighlighter .line.highlighted.alt1, .syntaxhighlighter .line.highlighted.alt2 {
  background-color: #c3defe !important;
}
.syntaxhighlighter .line.highlighted.number {
  color: white !important;
}
.syntaxhighlighter table caption {
  color: black !important;
}
.syntaxhighlighter .gutter {
  color: #787878 !important;
}
.syntaxhighlighter .gutter .line {
  border-right: 3px solid #d4d0c8 !important;
}
.syntaxhighlighter .gutter .line.highlighted {
  background-color: #d4d0c8 !important;
  color: white !important;
}
.syntaxhighlighter.printing .line .content {
  border: none !important;
}
.syntaxhighlighter.collapsed {
  overflow: visible !important;
}
.syntaxhighlighter.collapsed .toolbar {
  color: #3f5fbf !important;
  background: white !important;
  border: 1px solid #d4d0c8 !important;
}
.syntaxhighlighter.collapsed .toolbar a {
  color: #3f5fbf !important;
}
.syntaxhighlighter.collapsed .toolbar a:hover {
  color: #aa7700 !important;
}
.syntaxhighlighter .toolbar {
  color: #a0a0a0 !important;
  background: #d4d0c8 !important;
  border: none !important;
}
.syntaxhighlighter .toolbar a {
  color: #a0a0a0 !important;
}
.syntaxhighlighter .toolbar a:hover {
  color: red !important;
}
.syntaxhighlighter .plain, .syntaxhighlighter .plain a {
  color: black !important;
}
.syntaxhighlighter .comments, .syntaxhighlighter .comments a {
  color: #3f5fbf !important;
}
.syntaxhighlighter .string, .syntaxhighlighter .string a {
  color: #2a00ff !important;
}
.syntaxhighlighter .keyword {
  color: #7f0055 !important;
}
.syntaxhighlighter .preprocessor {
  color: #646464 !important;
}
.syntaxhighlighter .variable {
  color: #aa7700 !important;
}
.syntaxhighlighter .value {
  color: #009900 !important;
}
.syntaxhighlighter .functions {
  color: #ff1493 !important;
}
.syntaxhighlighter .constants {
  color: #0066cc !important;
}
.syntaxhighlighter .script {
  font-weight: bold !important;
  color: #7f0055 !important;
  background-color: none !important;
}
.syntaxhighlighter .color1, .syntaxhighlighter .color1 a {
  color: gray !important;
}
.syntaxhighlighter .color2, .syntaxhighlighter .color2 a {
  color: #ff1493 !important;
}
.syntaxhighlighter .color3, .syntaxhighlighter .color3 a {
  color: red !important;
}

.syntaxhighlighter .keyword {
  font-weight: bold !important;
}
.syntaxhighlighter .xml .keyword {
  color: #3f7f7f !important;
  font-weight: normal !important;
}
.syntaxhighlighter .xml .color1, .syntaxhighlighter .xml .color1 a {
  color: #7f007f !important;
}
.syntaxhighlighter .xml .string {
  font-style: italic !important;
  color: #2a00ff !important;
}
</style>
<script type="text/javascript">SyntaxHighlighter.all();</script>
<!-- END SyntaxHighlighter 3.0.83 -->
<link rel="shortcut icon" href="http://forgerock.org/favicon.ico">
</head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div lang="en" class="book" title="OpenAM 10.1.0 Developer's Guide"><div class="titlepage"><div><div><h1 class="title"><a name="dev-guide"></a>OpenAM 10.1.0 Developer's Guide</h1></div><div><div class="authorgroup"><div class="author"><h3 class="author"><span class="firstname">Mark</span> <span class="surname">Craig</span></h3></div></div></div><div><p class="releaseinfo">Software release date: February 20, 2013</p></div><div><p class="copyright">Copyright &copy; 2011-2013 ForgeRock AS</p></div><div><a href="legalnotice.html">Legal Notice</a></div><div><p class="pubdate">Publication date: March&nbsp;07,&nbsp;2013</p></div><div><div class="abstract" title="Abstract"><div class="abstract-title">Abstract</div><p>Guide to developing OpenAM client applications and service providers.
   OpenAM provides open source Authentication, Authorization, Entitlement and
   Federation software.</p></div></div></div><hr></div><div class="toc"><div class="toc-title">Table of Contents</div><dl><dt><span class="preface"><a href="#preface">Preface</a></span></dt><dt><span class="chapter"><a href="#chap-api-overview">1. OpenAM APIs and Protocols</a></span></dt><dt><span class="chapter"><a href="#chap-client-dev">2. Developing Client Applications</a></span></dt><dt><span class="chapter"><a href="#chap-rest">3. Using RESTful Web Services</a></span></dt><dt><span class="chapter"><a href="#chap-jdk">4. Using the OpenAM Java SDK</a></span></dt><dt><span class="chapter"><a href="#chap-authentication">5. Authenticating Using OpenAM Java SDK</a></span></dt><dt><span class="chapter"><a href="#chap-session">6. Handling Single Sign On Using OpenAM Java SDK</a></span></dt><dt><span class="chapter"><a href="#chap-policy-decisions">7. Requesting Policy Decisions Using OpenAM Java SDK</a></span></dt><dt><span class="chapter"><a href="#chap-fedlet-java">8. Using Fedlets in Java Web Applications</a></span></dt><dt><span class="chapter"><a href="#chap-fedlet-dotnet">9. Using Fedlets in .NET Applications</a></span></dt><dt><span class="chapter"><a href="#chap-sae">10. Using Secure Attribute Exchange</a></span></dt><dt><span class="chapter"><a href="#chap-csdk">11. Using the OpenAM C API</a></span></dt><dt><span class="chapter"><a href="#chap-extending">12. Extending OpenAM</a></span></dt><dt><span class="chapter"><a href="#chap-custom-attr">13. Customizing Profile Attributes</a></span></dt><dt><span class="chapter"><a href="#chap-oauth2-scopes">14. Customizing OAuth 2.0 Scope Handling</a></span></dt><dt><span class="chapter"><a href="#chap-auth-spi">15. Customizing Authentication Modules</a></span></dt><dt><span class="chapter"><a href="#chap-post-auth">16. Creating a Post Authentication Plugin</a></span></dt><dt><span class="chapter"><a href="#chap-policy-spi">17. Customizing Policy Evaluation</a></span></dt><dt><span class="chapter"><a href="#chap-identity-repo-spi">18. Customizing Identity Data Storage</a></span></dt><dt><span class="index"><a href="#d2063e4086">Index</a></span></dt></dl></div><div lang="en" class="preface" title="Preface"><div class="titlepage"><div><div><h2 class="title"><a name="preface"></a>Preface</h2></div></div></div><p>This guide demonstrates how to handle sessions to permit single sign
 on and single log out in OpenAM client applications. This guide further
 demonstrates how to use the OpenAM APIs including both APIs for client
 applications, and also SPIs for authentication, policy, service management,
 delegation, and identity storage. Finally, this guide demonstrates how to
 write your own web policy agent.</p><div class="section" title="1.&nbsp;Who Should Use this Guide"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d2063e98"></a>1.&nbsp;Who Should Use this Guide</h2></div></div></div><p>This guide is written for developers who adapt client applications
  to use OpenAM access management capabilities. It is also written for
  designers and developers extending and integrating OpenAM services for
  their organizations.</p><p>You do not need to be an OpenAM wizard to learn something from
  this guide, though a background in access management and developing
  web applications or developing for web and application servers can help.
  You can nevertheless get started with this guide, and then learn more as you
  go along.</p></div><div lang="en" class="section" title="2.&nbsp;Formatting Conventions"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="formatting-conventions"></a>2.&nbsp;Formatting Conventions</h2></div></div></div><p>Some items are formatted differently from other text, like
 <code class="filename">filenames</code>, <span class="command"><strong>commands</strong></span>, and
 <code class="literal">literal values</code>.</p><div class="screen"><pre class="brush: plain;">$ echo Command line sessions are formatted with lines folded for easier reading.
 In HTML documents click the [-] image for a flat, copy-paste version. Click
 the [+] image for an expanded, line-wrapped version. &gt; /dev/null</pre></div><p>In many cases, sections pertaining to UNIX, GNU/Linux, Mac OS X, BSD,
 and so forth are marked (UNIX). Sections pertaining to Microsoft Windows
 might be marked (Windows). To avoid repetition, however, file system
 directory names are often given only in UNIX format as in
 <code class="filename">/path/to/OpenAM</code>, even if the text applies to
 <code class="filename">C:\path\to\OpenAM</code> as well.</p><p>Absolute path names usually begin with the placeholder
 <code class="filename">/path/to/</code>, which might translate to
 <code class="filename">/opt/</code>, <code class="filename">C:\Program Files\</code>, or
 somewhere else on your system. Unless you install from native packages,
 you create this location before you install.</p><pre class="brush: java;">class Test
{
    public static void main(String [] args)
    {
        System.out.println("This is a program listing.");
    }
}</pre></div><div lang="en" class="section" title="3.&nbsp;Accessing OpenAM Documentation Online"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="accessing-doc-online"></a>3.&nbsp;Accessing OpenAM Documentation Online</h2></div></div></div><p>Core documentation, such as what you are now reading, aims to
 be technically accurate and complete with respect to the software
 documented. Core documentation therefore follows a <a class="link" href="https://wikis.forgerock.org/confluence/display/devcom/Review+Process" target="_blank">three-phase review process</a> designed to eliminate errors. The
 review process should slow authors down enough that documentation you get
 with a stable release has had time to bake fully.</p><p>Fully baked core documentation is available at <a class="link" href="http://docs.forgerock.org/" target="_top">docs.forgerock.org</a>.</p><p>The <a class="link" href="https://wikis.forgerock.org/confluence/display/OPENAM/Home" target="_blank">OpenAM Wiki</a> regularly brings you more, fresh content.
 In addition, you are welcome to <a class="link" href="https://idp.forgerock.org/openam/UI/Login?service=register" target="_blank">sign up</a> and then edit the Wiki if you notice an error, or if you
 have something to share.</p></div><div lang="en" class="section" title="4.&nbsp;Joining the OpenAM Community"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="joining-the-community"></a>4.&nbsp;Joining the OpenAM Community</h2></div></div></div><p>After you <a class="link" href="https://idp.forgerock.org/openam/UI/Login?service=register" target="_blank">sign up</a> at ForgeRock, you can also login to the Wiki and the issue
 database to follow what is happening with the project.</p><p>If you have questions regarding OpenAM which are not answered by the
 documentation, there is a mailing list which can be found at
 <a class="link" href="https://lists.forgerock.org/mailman/listinfo/openam" target="_blank">https://lists.forgerock.org/mailman/listinfo/openam</a>
 where you are likely to find an answer. You can also make suggestions 
 regarding updates at the documentation mailing list 
 (<a class="link" href="https://lists.forgerock.org/mailman/listinfo/docs" target="_blank">https://lists.forgerock.org/mailman/listinfo/docs</a>).</p><p>The Wiki has information on how to check out OpenAM source code.
 There is also a mailing list for OpenAM development that can be found at
 <a class="link" href="https://lists.forgerock.org/mailman/listinfo/openam-dev" target="_blank">https://lists.forgerock.org/mailman/listinfo/openam-dev</a>.
 Should you want to contribute a patch, test, or feature, or want to author
 part of the core documentation, first have a look on the ForgeRock site
 at <a class="link" href="http://www.forgerock.org/get_involved.html" target="_blank">how to get involved</a>.</p></div></div><div lang="en" class="chapter" title="Chapter&nbsp;1.&nbsp;OpenAM APIs and Protocols"><div class="titlepage"><div><div><h2 class="title"><a name="chap-api-overview"></a>Chapter&nbsp;1.&nbsp;OpenAM APIs and Protocols</h2></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl><dt><span class="section"><a href="#openam-apis">1.1. OpenAM APIs</a></span></dt><dt><span class="section"><a href="#openam-spis">1.2. OpenAM SPIs</a></span></dt></dl></div><p>Although policy agents and standards support make it possible for
 applications to use OpenAM for access management without changing your
 code, some deployments require tighter integration, or direct use of
 supported protocols and OpenAM APIs.</p><p>OpenAM supports a range of protocols and APIs that allow you not
 only to define specifically how access is managed in your client
 applications, but also to extend OpenAM capabilities to meet even
 those deployment requirements not yet covered in OpenAM.</p><p>This short chapter presents an overview of the APIs and protocols that
 OpenAM supports.</p><div class="mediaobject" title="High-level view of OpenAM APIs and SPIs"><a name="figure-openam-apis-overview"></a><img src="images/openam-apis-overview.png" longdesc="/Users/mark/Downloads/openam/openam-documentation/openam-doc-source/target/docbkx/html/dev-guide/figure-openam-apis-overview.html"><div class="longdesc-link" align="right"><br clear="all"><span class="longdesc-link">[<a href="figure-openam-apis-overview.html" target="longdesc">D</a>]</span></div></div><p>This guide primarily covers the OpenAM client APIs and SPIs, with
 emphasis on the Java APIs.</p><div class="section" title="1.1.&nbsp;OpenAM APIs"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="openam-apis"></a>1.1.&nbsp;OpenAM APIs</h2></div></div></div><p>OpenAM provides client application programming interfaces for a variety
  of needs.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>The OpenAM Java APIs provided through the OpenAM Java SDK let your
    Java and Java EE applications call on OpenAM for authentication, and
    authorization in both OpenAM and federated environments.</p><p>Detailed reference information is provided in the <a class="link" href="http://openam.forgerock.org/apidocs/index.html" target="_top"><em class="citetitle">OpenAM Java SDK API Specification</em></a>.</p></li><li class="listitem"><p>The C SDK also provides APIs for native applications, such as new
    web server policy agents. The C SDK is delivered with OpenAM for Linux,
    Solaris, and Windows platforms.</p></li><li class="listitem"><p>OpenAM exposes a RESTful API that can return JSON or XML over HTTP,
    allowing you to access authentication, authorization, and identity
    services from your web applications using REST clients in the language of
    your choice.</p></li></ul></div></div><div class="section" title="1.2.&nbsp;OpenAM SPIs"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="openam-spis"></a>1.2.&nbsp;OpenAM SPIs</h2></div></div></div><p>OpenAM provides Java based service provider interfaces to let you
  extend services for the requirements of your particular deployment.</p><div class="itemizedlist"><p>Some examples of the plugins you can write follow in the list below.
   This guide demonstrates how to implement such plugins.</p><ul class="itemizedlist" type="disc"><li class="listitem"><p>Custom OAuth 2.0 scopes plugins define how OpenAM playing the role
    of authorization server handles scopes, including what token information to
    return regarding scopes set when authorization was granted.</p></li><li class="listitem"><p>Custom authentication plugins let OpenAM authenticate users against
    a new authentication service or an authentication service specific to your
    deployment</p></li><li class="listitem"><p>Post authentication plugins perform additional processing at the end
    of the authentication process, but before the subject is authenticated.
    Post authentication plugins can for example store information about the
    authentication in the user's profile, or call another system for audit
    logging purposes.</p></li><li class="listitem"><p>Policy evaluation plugins implement new policy conditions, send
    attributes from the user profile as part of a policy response, extend the
    definition of the subjects to whom the policy applies, or customize how
    policy management is delegated.</p></li><li class="listitem"><p>Identity repository plugins let OpenAM employ a new or custom user
    data store, other than a directory server or JDBC-accessible
    database.</p></li></ul></div></div></div><div lang="en" class="chapter" title="Chapter&nbsp;2.&nbsp;Developing Client Applications"><div class="titlepage"><div><div><h2 class="title"><a name="chap-client-dev"></a>Chapter&nbsp;2.&nbsp;Developing Client Applications</h2></div></div></div><p>Client applications access OpenAM services for authentication,
 authorization, and single sign on/single log out through the use of
 sessions. Client applications can also be allowed to manage authorization
 policies.</p><p>Client application integration with OpenAM can be coupled loosely,
 as in the case of an application running in a web server with an OpenAM
 policy agent to handle interaction with OpenAM service, more directly,
 as in the case where the client interacts with OpenAM over protocol, or
 tightly, as in the case of an application using the OpenAM Java or C API
 to interact with OpenAM services.</p><p>This part of the guide covers client interaction with OpenAM
 over supported protocols and using OpenAM APIs.</p></div><div lang="en" class="chapter" title="Chapter&nbsp;3.&nbsp;Using RESTful Web Services"><div class="titlepage"><div><div><h2 class="title"><a name="chap-rest"></a>Chapter&nbsp;3.&nbsp;Using RESTful Web Services</h2></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl><dt><span class="section"><a href="#about-openam-rest-api">3.1. About the RESTful API</a></span></dt><dt><span class="section"><a href="#rest-api-auth">3.2. Authentication &amp; Logout</a></span></dt><dt><span class="section"><a href="#rest-api-tokens">3.3. Token Validation &amp; Attribute Retrieval</a></span></dt><dt><span class="section"><a href="#rest-api-authz">3.4. Authorization</a></span></dt><dt><span class="section"><a href="#rest-api-oauth2">3.5. OAuth 2.0 Authorization</a></span></dt><dt><span class="section"><a href="#rest-api-logging">3.6. Logging</a></span></dt><dt><span class="section"><a href="#rest-api-crud-identity">3.7. Identity Management</a></span></dt></dl></div><a class="indexterm" name="d2063e270"></a><p>This chapter shows how to use the OpenAM RESTful interfaces for direct
 integration between web client applications and OpenAM.</p><div class="section" title="3.1.&nbsp;About the RESTful API"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="about-openam-rest-api"></a>3.1.&nbsp;About the RESTful API</h2></div></div></div><p>OpenAM offers a RESTful API for these access and identity management
  operations:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="link" href="#rest-api-auth" title="3.2.&nbsp;Authentication &amp; Logout">Authentication</a> (login)</p></li><li class="listitem"><p><a class="link" href="#rest-api-auth" title="3.2.&nbsp;Authentication &amp; Logout">Logout</a></p></li><li class="listitem"><p><a class="link" href="#rest-api-tokens" title="3.3.&nbsp;Token Validation &amp; Attribute Retrieval">Token attribute retrieval</a></p></li><li class="listitem"><p><a class="link" href="#rest-api-tokens" title="3.3.&nbsp;Token Validation &amp; Attribute Retrieval">Token validation</a></p></li><li class="listitem"><p><a class="link" href="#rest-api-authz" title="3.4.&nbsp;Authorization">Authorization</a></p></li><li class="listitem"><p><a class="link" href="#rest-api-oauth2" title="3.5.&nbsp;OAuth 2.0 Authorization">OAuth 2.0 Authorization</a></p></li><li class="listitem"><p><a class="link" href="#rest-api-logging" title="3.6.&nbsp;Logging">Logging</a></p></li><li class="listitem"><p><a class="link" href="#rest-api-crud-identity" title="3.7.&nbsp;Identity Management">Identity management</a> (creating,
    reading, updating, deleting identities)</p></li></ul></div><p>To call the API, access URLs under <code class="literal">identity/</code> where
  OpenAM is deployed, such as
  <code class="literal">https://openam.example.com:8443/openam/identity/</code>.</p><p>You can select the output format returned by specifying
  <code class="literal">json/</code> or <code class="literal">xml/</code> in the URL after
  <code class="literal">identity/</code>. For example, to return JSON, specify
  <code class="literal">https://openam.example.com:8443/openam/identity/json/</code>.</p><p>For the examples in this chapter, OpenAM has c66Encode for cookies
  activated. The encoding ensures that OpenAM tokens need not be percent
  encoded before being submitted with a request. Thus, an example token
  looks like this.</p><pre class="literallayout">token.id=AQIC5wM2LY4SfczntBbXvEAOuECbqMY3J4NW3byH6xwgkGE.*AAJTSQACMDE.*</pre><p>Without c66Encode activated, the same token might look like this.</p><pre class="literallayout">token.id=AQIC5wM2LY4SfczntBbXvEAOuECbqMY3J4NW3byH6xwgkGE=@AAJTSQACMDE=#</pre><p>In the latter example, you would have to <a class="link" href="http://en.wikipedia.org/wiki/Percent-encoding" target="_top">percent
  encode</a> the <code class="literal">=</code>, <code class="literal">@</code>, and
  <code class="literal">#</code> characters in your requests.</p><p>In this chapter, long URLs are wrapped to fit the printed page.</p></div><div class="section" title="3.2.&nbsp;Authentication &amp; Logout"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="rest-api-auth"></a>3.2.&nbsp;Authentication &amp; Logout</h2></div></div></div><a class="indexterm" name="d2063e364"></a><a class="indexterm" name="d2063e369"></a><p>Simple authentication with a user name and password returns a
  token.</p><div class="screen"><pre class="brush: plain;">$ curl "https://openam.example.com:8443/openam/identity/authenticate?
 username=bjensen
 &amp;password=hifalutin"
token.id=AQIC5wM2LY4SfcxvdvHOXjtC_eWSs2RB54tgvgK8SuYi7aQ.*AAJTSQACMDE.*</pre></div><p>If you must specify parameters as when authenticating to
  <code class="literal">/UI/Login</code>, you provide a percent encoded string of the
  parameters as the value of the <code class="literal">uri</code> parameter. The 
  <code class="literal">/UI/Login</code> parameter deals with the <code class="literal">realm</code>,
  <code class="literal">module</code>, and <code class="literal">service</code> parameters. Setting the   
  <code class="literal">client</code> parameter sets the user's IP address as part of the 
  token following successful authentication. The default for the <code class="literal">client</code>
  parameter is the IP of the machine making the REST request.</p><div class="screen"><pre class="brush: plain;">$ curl "https://openam.example.com:8443/openam/identity/authenticate?
 username=bjensen
 &amp;password=hifalutin
 &amp;uri=realm%3D%2F%26module%3DDataStore
 &amp;client=192.168.1.1"
token.id=AQIC5wM2LY4SfcxvdvHOXjtC_eWSs2RB54tgvgK8SuYi7aQ.*AAJTSQACMDE.*</pre></div><p>You log out using the token to end the user session.</p><div class="screen"><pre class="brush: plain;">$ curl "https://openam.example.com:8443/openam/identity/logout?
 subjectid=AQIC5wM2LY4SfcxvdvHOXjtC_eWSs2RB54tgvgK8SuYi7aQ.*AAJTSQACMDE.*"</pre></div></div><div class="section" title="3.3.&nbsp;Token Validation &amp; Attribute Retrieval"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="rest-api-tokens"></a>3.3.&nbsp;Token Validation &amp; Attribute Retrieval</h2></div></div></div><p>You check whether a token is valid as follows.</p><div class="screen"><pre class="brush: plain;">$ curl "https://openam.example.com:8443/openam/identity/isTokenValid?
 tokenid=AQIC5wM2LY4SfcxuxIP0VnP2lVjs7ypEM6VDx6srk56CN1Q.*AAJTSQACMDE.*"
boolean=true</pre></div><p>An invalid token returns <code class="literal">boolean=false</code>.</p><div class="screen"><pre class="brush: plain;">$ curl "https://openam.example.com:8443/openam/identity/isTokenValid?
 tokenid=INVALID"
boolean=false</pre></div><p>With a valid token, you can retrieve attributes about the subject.
  OpenAM returns a series of <em class="replaceable"><code>name</code></em>,
  <em class="replaceable"><code>value</code></em> pairs.</p><a class="indexterm" name="d2063e432"></a><div class="screen"><pre class="brush: plain;">$ curl "https://openam.example.com:8443/openam/identity/attributes?
 subjectid=AQIC5wM2LY4SfcxuxIP0VnP2lVjs7ypEM6VDx6srk56CN1Q.*AAJTSQACMDE.*"
userdetails.token.id=
 AQIC5wM2LY4SfcxuxIP0VnP2lVjs7ypEM6VDx6srk56CN1Q.*AAJTSQACMDE.*
userdetails.attribute.name=uid
userdetails.attribute.value=bjensen
userdetails.attribute.name=mail
userdetails.attribute.value=bjensen@example.com
userdetails.attribute.name=sn
userdetails.attribute.value=Jensen
userdetails.attribute.name=userpassword
userdetails.attribute.value={SSHA}rhusOfYpkapDWEHcfT2Y7y83LMuC++F4Abqvig==
userdetails.attribute.name=cn
userdetails.attribute.value=Babs Jensen
userdetails.attribute.value=Barbara Jensen
userdetails.attribute.name=givenname
userdetails.attribute.value=Barbara
userdetails.attribute.name=dn
userdetails.attribute.value=uid=bjensen,ou=people,dc=example,dc=com
userdetails.attribute.name=telephonenumber
userdetails.attribute.value=+1 408 555 1862
userdetails.attribute.name=objectclass
userdetails.attribute.value=organizationalPerson
userdetails.attribute.value=person
userdetails.attribute.value=posixAccount
userdetails.attribute.value=inetOrgPerson
userdetails.attribute.value=krbprincipalaux
userdetails.attribute.value=krbTicketPolicyAux
userdetails.attribute.value=top</pre></div><p>You can specify attributes to limit what you retrieve.</p><div class="screen"><pre class="brush: plain;">$ curl "https://openam.example.com:8443/openam/identity/attributes?
 subjectid=AQIC5wM2LY4SfcxuxIP0VnP2lVjs7ypEM6VDx6srk56CN1Q.*AAJTSQACMDE.*
 &amp;attributenames=mail
 &amp;attributenames=uid"
userdetails.token.id=
 AQIC5wM2LY4SfcxuxIP0VnP2lVjs7ypEM6VDx6srk56CN1Q.*AAJTSQACMDE.*
userdetails.attribute.name=uid
userdetails.attribute.value=bjensen
userdetails.attribute.name=mail
userdetails.attribute.value=bjensen@example.com</pre></div><p>When retrieving attributes, you can refresh the session thus setting
  the idle time to 0, by adding the boolean parameter
  <code class="literal">refresh=true</code> to the query string.</p><div class="screen"><pre class="brush: plain;">$ curl "https://openam.example.com:8443/openam/identity/attributes?
 subjectid=AQIC5wM2LY4SfcxuxIP0VnP2lVjs7ypEM6VDx6srk56CN1Q.*AAJTSQACMDE.*
 &amp;attributenames=cn
 &amp;refresh=true"
userdetails.token.id=
 AQIC5wM2LY4SfcxuxIP0VnP2lVjs7ypEM6VDx6srk56CN1Q.*AAJTSQACMDE.*
userdetails.attribute.name=cn
userdetails.attribute.value=Babs Jensen
userdetails.attribute.value=Barbara Jensen</pre></div></div><div class="section" title="3.4.&nbsp;Authorization"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="rest-api-authz"></a>3.4.&nbsp;Authorization</h2></div></div></div><a class="indexterm" name="d2063e453"></a><p>You can call on OpenAM to decide whether to authorize access to a
  protected resource based on a valid token. Of course, you must percent
  encode the resource URI.</p><div class="screen"><pre class="brush: plain;">$ curl "https://openam.example.com:8443/openam/identity/authorize?
 uri=http%3A%2F%2Fwww.example.com%3A8080%2Fexamples%2Findex.html
 &amp;subjectid=AQIC5wM2LY4SfcxuxIP0VnP2lVjs7ypEM6VDx6srk56CN1Q.*AAJTSQACMDE.*"
boolean=true</pre></div><p>To indicate access denied, OpenAM returns
  <code class="literal">boolean=false</code>.</p><p>Additionally, you can access entitlements and entitlement policy
  decisions using the REST interface. In order to access the entitlements
  interface, you cannot however use the authentication token as is.
  Instead you must encode the token as performed in
  <a class="link" href="http://sources.forgerock.org/browse/~raw,r=6/openam/trunk/opensso/www/public/use/docs/fampdf/Encoder.java" target="_top"><code class="filename">Encoder.java</code></a>, and then URL-encode the
  result.</p><p>The entitlements REST interface uses the following path suffixes and
  query string parameters.</p><div class="itemizedlist"><p>Path suffixes for entitlements include the following.</p><ul class="itemizedlist" type="disc"><li class="listitem"><p><code class="literal">ws/1/entitlement/decision</code>: request a decision
    pertaining to a single resource</p></li><li class="listitem"><p><code class="literal">ws/1/entitlement/decisions</code>: request decisions
    pertaining to multiple resources</p></li><li class="listitem"><p><code class="literal">ws/1/entitlement/entitlement</code>: request decisions
    for a specified resource URL and all resources underneath</p></li></ul></div><div class="itemizedlist"><p>Query string parameters for entitlements include the following.</p><ul class="itemizedlist" type="disc"><li class="listitem"><p><code class="literal">subject=<em class="replaceable"><code>encoded-token</code></em></code>,
    where the encoded token is as describe above.</p></li><li class="listitem"><p><code class="literal">action=get</code>, or <code class="literal">action=post</code>,
    which identifies the user agent action when requesting a decision.</p></li><li class="listitem"><p><code class="literal">application=iPlanetAMWebAgentService</code></p></li><li class="listitem"><p><code class="literal">resource=<em class="replaceable"><code>resource-url</code></em></code>,
    or multiple <code class="literal">resources=<em class="replaceable"><code>resource-url</code></em></code>
    parameters for multiple decisions.</p></li><li class="listitem"><p><code class="literal">env=<em class="replaceable"><code>requestDnsName%3Dfqdn</code></em></code>,
    <code class="literal">env=<em class="replaceable"><code>requestIP%3Ddotted-quads</code></em></code>,
    <code class="literal">env=<em class="replaceable"><code>requestTime%3Dseconds-since-epoch</code></em></code>,
    and <code class="literal">env=<em class="replaceable"><code>requestDnsName%3Dtime-zone</code></em></code>
    where <em class="replaceable"><code>time-zone</code></em> is from Java
    <code class="literal">TimeZone.getTimeZone().getID()</code>. The
    <code class="literal">env</code> parameters thus express conditions.</p></li></ul></div></div><div class="section" title="3.5.&nbsp;OAuth 2.0 Authorization"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="rest-api-oauth2"></a>3.5.&nbsp;OAuth 2.0 Authorization</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#rest-api-oauth2-client-endpoints">3.5.1. OAuth 2.0 Client &amp; Resource Server Endpoints</a></span></dt><dt><span class="section"><a href="#rest-api-oauth2-token-admin-endpoint">3.5.2. OAuth 2.0 Token Administration Endpoint</a></span></dt><dt><span class="section"><a href="#rest-api-oauth2-client-admin-endpoint">3.5.3. OAuth 2.0 Client Administration Endpoint</a></span></dt></dl></div><a class="indexterm" name="d2063e561"></a><div class="itemizedlist"><p>OpenAM exposes the following REST endpoints for different OAuth 2.0
   purposes.</p><ul class="itemizedlist" type="disc"><li class="listitem"><p>Endpoints for <a class="link" href="#rest-api-oauth2-client-endpoints" title="3.5.1.&nbsp;OAuth 2.0 Client &amp; Resource Server Endpoints">OAuth
    2.0 clients and resource servers</a>, mostly defined in RFC 6749,
    <a class="link" href="http://tools.ietf.org/html/rfc6749" target="_blank"><em class="citetitle">The OAuth 2.0 Authorization Framework</em></a>, with
    an additional <code class="literal">tokeninfo</code> endpoint useful to resource
    servers.</p></li><li class="listitem"><p>An endpoint for <a class="link" href="#rest-api-oauth2-token-admin-endpoint" title="3.5.2.&nbsp;OAuth 2.0 Token Administration Endpoint">OAuth 2.0 token administration</a>. This is specific to OpenAM.</p></li><li class="listitem"><p>An endpoint for <a class="link" href="#rest-api-oauth2-client-admin-endpoint" title="3.5.3.&nbsp;OAuth 2.0 Client Administration Endpoint">OAuth 2.0 client administration</a>. This is specific to OpenAM.</p></li></ul></div><p>When accessing the APIs, browser-based REST clients can rely on OpenAM
  to handle the session as usual. First authenticate with OpenAM. Then perform
  the operations in the browser session.</p><p>Clients not running in a browser can authenticate as described in
  <a class="xref" href="#rest-api-auth" title="3.2.&nbsp;Authentication &amp; Logout">Section&nbsp;3.2, &#8220;Authentication &amp; Logout&#8221;</a>, whereby OpenAM returns a
  <code class="literal">token.id</code> value. Clients pass the
  <code class="literal">token.id</code> value in a header named after the
  authentication cookie, by default <code class="literal">iplanetDirectoryPro</code>.</p><div class="section" title="3.5.1.&nbsp;OAuth 2.0 Client &amp; Resource Server Endpoints"><div class="titlepage"><div><div><h3 class="title"><a name="rest-api-oauth2-client-endpoints"></a>3.5.1.&nbsp;OAuth 2.0 Client &amp; Resource Server Endpoints</h3></div></div></div><p>As described in the <em class="citetitle">Administration Guide</em> chapter
   on <a href="../admin-guide/index.html#chap-oauth2" class="link"><em class="citetitle">Managing OAuth
   2.0 Authorization</em></a>, OpenAM exposes REST endpoints for
   making calls to OpenAM acting as an authorization server.</p><div lang="en" class="variablelist" title="OpenAM OAuth 2.0 Endpoints"><div class="variablelist-title">OpenAM OAuth 2.0 Endpoints</div><p>In addition to the standard authorization and token endpoints
 described in RFC 6749, OpenAM also exposes a token information endpoint
 for resource servers to get information about access tokens so they can
 determine how to respond to requests for protected resources. OpenAM as
 authorization server exposes the following endpoints for clients and
 resource servers.</p><dl><dt><span class="term"><code class="literal">/oauth2/authorize</code></span></dt><dd><p>Authorization endpoint defined in RFC 6749, used to obtain an
   authorization grant from the resource owner</p><p>Example: <code class="literal">https://openam.example.com:8443/openam/oauth2/authorize</code></p></dd><dt><span class="term"><code class="literal">/oauth2/access_token</code></span></dt><dd><p>Token endpoint defined in RFC 6749, used to obtain an access token
   from the authorization server</p><p>Example: <code class="literal">https://openam.example.com:8443/openam/oauth2/access_token</code></p></dd><dt><span class="term"><code class="literal">/oauth2/tokeninfo</code></span></dt><dd><p>Endpoint not defined in RFC 6749, used to validate tokens, and to
   retrieve information such as scopes</p><p>Given an access token, a resource server can perform an HTTP GET on
   <code class="literal">/oauth2/tokeninfo?access_token=<em class="replaceable"><code>token-id</code></em></code>
   to retrieve a JSON object indicating <code class="literal">token_type</code>,
   <code class="literal">expires_in</code>, <code class="literal">scope</code>, and the
   <code class="literal">access_token</code> ID.</p><p>Example: <code class="literal">https://openam.example.com:8443/openam/oauth2/tokeninfo</code></p></dd></dl></div><p>The <code class="literal">/oauth2/authorize</code>, and
   <code class="literal">/oauth2/access_token</code> endpoints function as described
   in RFC 6749.</p><p>The <code class="literal">/oauth2/authorize</code> endpoint is protected by the
   policy created during OAuth 2.0 authorization server configuration, which
   grants all authenticated users access.</p><p>The <code class="literal">/oauth2/tokeninfo</code> endpoint takes an HTTP GET
   on <code class="literal">/oauth2/tokeninfo?access_token=<em class="replaceable"><code>token-id</code></em></code>, and returns information about the
   token.</p><p>Resource servers &#8212; or any party having the token ID &#8212; can
   get token information through this endpoint without authenticating. This
   means any application or user can validate the token without having to be
   registered with OpenAM.</p><p>The following example shows OpenAM issuing an access token, and
   then returning token information.</p><div class="screen"><pre class="brush: plain;">$ curl
 --request POST
 --user "myClientID:password"
 --data "grant_type=password&amp;username=demo&amp;password=changeit&amp;scope=cn%20mail"
 https://openam.example.com:8443/openam/oauth2/access_token
{
    "expires_in": 599,
    "token_type": "Bearer",
    "refresh_token": "f6dcf133-f00b-4943-a8d4-ee939fc1bf29",
    "access_token": "f9063e26-3a29-41ec-86de-1d0d68aa85e9"
}
$ curl https://openam.example.com:8443/openam/oauth2/tokeninfo
 ?access_token=f9063e26-3a29-41ec-86de-1d0d68aa85e9
{
    "mail": "demo@example.com",
    "scope": [
        "mail",
        "cn"
    ],
    "cn": "demo",
    "realm": "/",
    "token_type": "Bearer",
    "expires_in": 577,
    "access_token": "f9063e26-3a29-41ec-86de-1d0d68aa85e9"
}</pre></div><p>The resource server making decisions about whether the token is valid
   can thus use the <code class="literal">/oauth2/tokeninfo</code> endpoint to retrieve
   expiration information about the token. Depending on the scopes
   implementation, the JSON response about the token can also contain scope
   information. As described in the <em class="citetitle">Administration Guide</em>,
   the default scopes implementation in OpenAM considers scopes to be names of
   attributes in the resource owner's user profile. Notice that the JSON
   response contains the values for those attributes from the user's profile,
   as in the preceding example, with scopes set to <code class="literal">mail</code> and
   <code class="literal">cn</code>.</p></div><div class="section" title="3.5.2.&nbsp;OAuth 2.0 Token Administration Endpoint"><div class="titlepage"><div><div><h3 class="title"><a name="rest-api-oauth2-token-admin-endpoint"></a>3.5.2.&nbsp;OAuth 2.0 Token Administration Endpoint</h3></div></div></div><p>The OpenAM-specific OAuth 2.0 token administration endpoint lets
   administrators read, list, and delete OAuth 2.0 tokens. OAuth 2.0 clients
   can also manage their own tokens.</p><p>OpenAM exposes the token administration endpoint at
   <code class="literal">/frrest/oauth2/token</code>, such as
   <code class="literal">https://openam.example.com:8443/openam/frrest/oauth2/token</code>.</p><div class="note" title="Note" style="font-style: italic;"><h3 class="title">Note</h3><p>This endpoint location is likely to change in the future.</p></div><p>To get a token, perform an HTTP GET on
   <code class="literal">/frrest/oauth2/token/<em class="replaceable"><code>token-id</code></em></code>,
   as in the following example.</p><div class="screen"><pre class="brush: plain;">$ curl "https://openam.example.com:8443/openam/identity/authenticate?
 username=amadmin&amp;password=password"
token.id=AQIC5wM2LY4Sfcxs...EwNDU2NjE0*
$ curl
 --request POST
 --user "myClientID:password"
 --data "grant_type=password&amp;username=demo&amp;password=changeit&amp;scope=cn%20mail"
 https://openam.example.com:8443/openam/oauth2/access_token
{
    "expires_in": 599,
    "token_type": "Bearer",
    "refresh_token": "f838e7d4-7e84-4743-af7c-9a9c42c2969e",
    "access_token": "9c6a48fc-44b1-4a0c-b4f0-672fba468b0f"
}
$ curl
 --header "iplanetDirectoryPro: AQIC5wM2LY4Sfcxs...EwNDU2NjE0*"
 https://openam.example.com:8443/openam/frrest/oauth2/token/9c6a48fc...fba468b0f
{
    "scope": [
        "mail",
        "cn"
    ],
    "type": [
        "access_token"
    ],
    "username": [
        "demo"
    ],
    "realm": [
        "/"
    ],
    "id": [
        "9c6a48fc-44b1-4a0c-b4f0-672fba468b0f"
    ],
    "parent": [
        "f838e7d4-7e84-4743-af7c-9a9c42c2969e"
    ],
    "expiry_time": [
        "1355741494888"
    ],
    "client_id": [
        "myClientID"
    ]
}</pre></div><p>To list tokens, perform an HTTP GET on
   <code class="literal">/frrest/oauth2/token/?_query_id=<em class="replaceable"><code>conditions</code></em></code>,
   where <em class="replaceable"><code>conditions</code></em> is a comma-separated list of
   <code class="literal"><em class="replaceable"><code>field</code></em>=<em class="replaceable"><code>value</code></em></code>
   conditions. The <em class="replaceable"><code>field</code></em>s are taken from the fields
   returned in the token object through this endpoint.</p><div class="variablelist"><dl><dt><span class="term"><code class="literal">"expiry_time"</code></span></dt><dd><p>Token expiration time in milliseconds since 00:00:00 UTC, January 1,
      1970.</p></dd><dt><span class="term"><code class="literal">"type"</code></span></dt><dd><p>Either <code class="literal">"access_token"</code> or
      <code class="literal">"refresh_token"</code>.</p></dd><dt><span class="term"><code class="literal">"username"</code></span></dt><dd><p>OAuth 2.0 client to whom the token was issued.</p></dd><dt><span class="term"><code class="literal">"realm"</code></span></dt><dd><p>The realm for which the token was issued.</p></dd><dt><span class="term"><code class="literal">"id"</code></span></dt><dd><p>Unique ID of the token.</p></dd></dl></div><p>The following example shows a search for current access tokens that
   were issued to <code class="literal">myClientID</code>.</p><div class="screen"><pre class="brush: plain;">$ curl
 --header "iplanetDirectoryPro: AQIC5wM2LY4Sfcxs...EwNDU2NjE0*"
 https://openam.example.com:8443/openam/frrest/oauth2/token/?_queryID
 =username%3DmyClientID%2Ctype%3Daccess_token
{
    "result": [
        {
            "scope": [
                "mail",
                "cn"
            ],
            "id": [
                "1b836369-4fcf-4fb2-b819-ee4b1314d4f1"
            ],
            "type": [
                "access_token"
            ],
            "username": [
                "myClientID"
            ],
            "realm": [
                "/"
            ],
            "expiry_time": [
                "1355741986154"
            ]
        },
        {
            "scope": [
                "mail",
                "cn"
            ],
            "type": [
                "access_token"
            ],
            "username": [
                "myClientID"
            ],
            "realm": [
                "/"
            ],
            "id": [
                "5f1763fc-37ae-4698-9e84-d301d49e1f7e"
            ],
            "expiry_time": [
                "1355741982091"
            ]
        }
    ],
    "pagedResultsCookie": null,
    "remainingPagedResults": -1
}</pre></div><p>To delete a token, perform an HTTP DELETE on
   <code class="literal">/frrest/oauth2/token/<em class="replaceable"><code>token-id</code></em></code>,
   as in the following example.</p><div class="screen"><pre class="brush: plain;">$ curl
 --request POST
 --data "grant_type=client_credentials&amp;username=demo&amp;password=changeit
 &amp;client_id=myClientID&amp;client_secret=password&amp;scope=cn%20mail"
 https://openam.example.com:8443/openam/oauth2/access_token
{
    "expires_in": 599,
    "token_type": "Bearer",
    "access_token": "867aaab2-61d7-4b78-9b80-4f9098034540"
}
$ curl
 --request DELETE
 --header "iplanetDirectoryPro: AQIC5wM2LY4Sfcxs...EwNDU2NjE0*"
 https://openam.example.com:8443/openam/frrest/oauth2/token/867aaab2..098034540
{
    "success": "true"
}</pre></div></div><div class="section" title="3.5.3.&nbsp;OAuth 2.0 Client Administration Endpoint"><div class="titlepage"><div><div><h3 class="title"><a name="rest-api-oauth2-client-admin-endpoint"></a>3.5.3.&nbsp;OAuth 2.0 Client Administration Endpoint</h3></div></div></div><p>The OAuth 2.0 administration endpoint lets OpenAM administrators and
   agent administrators create (that is, register) and delete OAuth 2.0
   clients.</p><p>OpenAM exposes this endpoint at <code class="literal">/frrest/oauth2/client</code>,
   such as
   <code class="literal">https://openam.example.com:8443/openam/frrest/oauth2/client</code>.</p><div class="note" title="Note" style="font-style: italic;"><h3 class="title">Note</h3><p>This endpoint location is likely to change in the future.</p></div><p>To create an OAuth 2.0 client, perform an HTTP POST to
   <code class="literal">/frrest/oauth2/client/?_action=create</code>
   with a JSON object fully specifying the client, as in the following
   example.</p><div class="screen"><pre class="brush: plain;">$ curl "https://openam.example.com:8443/openam/identity/authenticate
 ?username=amadmin&amp;password=password"
token.id=AQIC5wM...3MTYxOA..*
$ curl --request POST --header "iplanetDirectoryPro: AQIC5wM...3MTYxOA..*"
 --header "Content-Type: application/json"
 --data '{"client_id":["testClient"],
          "realm":["/"]
          "userpassword":["secret12"],
          "com.forgerock.openam.oauth2provider.clientType":["Confidential"],
          "com.forgerock.openam.oauth2provider.redirectionURIs":
            ["www.client.com","www.example.com"],
          "com.forgerock.openam.oauth2provider.scopes":["cn","sn"],
          "com.forgerock.openam.oauth2provider.defaultScopes":["cn"],
          "com.forgerock.openam.oauth2provider.name":["My Test Client"],
          "com.forgerock.openam.oauth2provider.description":["OAuth 2.0 Client"]
         }'
 http://openam.example.com:8080/openam/frrest/oauth2/client/?_action=create
 {"success":"true"}</pre></div><div class="variablelist"><p>When creating an OAuth 2.0 client, use the following fields in your
    JSON object.</p><dl><dt><span class="term"><code class="literal">"client_id"</code></span></dt><dd><p>(Required) This field takes an array containing the client
      identifier as defined in RFC 6749.</p></dd><dt><span class="term"><code class="literal">"realm"</code></span></dt><dd><p>(Required) This field takes an array containing the OpenAM realm
      in which to create the client as defined in RFC 6749.</p></dd><dt><span class="term"><code class="literal">"userpassword"</code></span></dt><dd><p>(Required) This field takes an array containing the client
      secret as defined in RFC 6749.</p></dd><dt><span class="term"><code class="literal">"com.forgerock.openam.oauth2provider.clientType"</code></span></dt><dd><p>(Required) This field takes an array containing the client
      type, either <code class="literal">"Confidential"</code> or
      <code class="literal">"Public"</code> as defined in RFC 6749.</p></dd><dt><span class="term"><code class="literal">"com.forgerock.openam.oauth2provider.redirectionURIs"</code></span></dt><dd><p>(Optional for confidential clients) This field takes an array of
      client redirection endpoints as defined in RFC 6749.</p></dd><dt><span class="term"><code class="literal">"com.forgerock.openam.oauth2provider.scopes"</code></span></dt><dd><p>(Optional) This field takes an array of scopes as defined in RFC
      6749. The default scopes implementation takes scopes to be names of
      attributes in the resource owner profile.</p><p>Specify localized scopes in <code class="literal"><em class="replaceable"><code>scope</code></em>|<em class="replaceable"><code>locale</code></em>|<em class="replaceable"><code>localized description</code></em></code> format.</p></dd><dt><span class="term"><code class="literal">"com.forgerock.openam.oauth2provider.defaultScopes"</code></span></dt><dd><p>(Optional) This field takes an array of default scopes set
      automatically when tokens are issued.</p></dd><dt><span class="term"><code class="literal">"com.forgerock.openam.oauth2provider.name"</code></span></dt><dd><p>(Optional) This field takes an array containing the client name to
      display to the resource owner when the resource owner must authorize
      client access to protected resources.</p><p>Specify localized names in <code class="literal"><em class="replaceable"><code>locale</code></em>|<em class="replaceable"><code>localized name</code></em></code>
      format.</p></dd><dt><span class="term"><code class="literal">"com.forgerock.openam.oauth2provider.description"</code></span></dt><dd><p>(Optional) This field takes an array containing the description to
      display to the resource owner when the resource owner must authorize
      client access to protected resources.</p><p>Specify localized descriptions in <code class="literal"><em class="replaceable"><code>locale</code></em>|<em class="replaceable"><code>localized description</code></em></code>
      format.</p></dd></dl></div><p>To delete an OAuth 2.0 client, perform an HTTP DELETE on
   <code class="literal">/frrest/oauth2/client/<em class="replaceable"><code>client-id</code></em></code>,
   as in the following example.</p><div class="screen"><pre class="brush: plain;">$ curl --request DELETE
 --header "iplanetDirectoryPro: AQIC5wM...3MTYxOA..*"
 https://openam.example.com:8443/openam/frrest/oauth2/client/testClient
{"success":"true"}</pre></div></div></div><div class="section" title="3.6.&nbsp;Logging"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="rest-api-logging"></a>3.6.&nbsp;Logging</h2></div></div></div><p>You can send OpenAM messages to log, specifying the message content
  and the log file in which to write your message.</p><div class="screen"><pre class="brush: plain;">$ curl "https://openam.example.com:8443/openam/identity/authenticate?
 username=amadmin
 &amp;password=password"
token.id=AQIC5wM2LY4SfcwyCZkk-1JXzx6q1EzgagabHfBjMidb5jI.*AAJTSQACMDE.*
$ curl "https://openam.example.com:8443/openam/identity/log?
 appid=AQIC5wM2LY4SfcwyCZkk-1JXzx6q1EzgagabHfBjMidb5jI.*AAJTSQACMDE.*
 &amp;subjectid=AQIC5wM2LY4SfcxuxIP0VnP2lVjs7ypEM6VDx6srk56CN1Q.*AAJTSQACMDE.*
 &amp;logname=rest.access
 &amp;message=Hello%20World"</pre></div><p>Logging takes a valid <code class="literal">appid</code> token for the subject
  with access to log the message, and also a <code class="literal">subjectid</code> token
  for the user whom the message concerns. If the tokens are valid and the
  access rights correct, your message ends up in the log specified.</p><div class="screen"><pre class="brush: plain;">$ cat openam/openam/log/rest.access 
#Version: 1.0
#Fields: time   Data    LoginID ContextID   IPAddr  LogLevel    Domain 
 LoggedBy    MessageID   ModuleName  NameID  HostName    
"2011-09-14 16:38:17"   /home/mark/openam/openam/log/
   "cn=dsameuser,ou=DSAME Users,o=openam"  aa307b2dcb721d4201
   "Not Available" INFO    o=openam    "cn=dsameuser,ou=DSAME Users,o=openam"
   LOG-1   rest.access "Not Available"192.168.56.2 
"2011-09-14 16:38:17"   "Hello World"   id=bjensen,ou=user,o=openam
   8a4025a2b3af291d01  "Not Available" INFO    o=openam
   id=amadmin,ou=user,o=openam "Not Available" rest.access "Not Available"
   192.168.56.2</pre></div></div><div class="section" title="3.7.&nbsp;Identity Management"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="rest-api-crud-identity"></a>3.7.&nbsp;Identity Management</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#rest-api-create-identity">3.7.1. Creating Identities</a></span></dt><dt><span class="section"><a href="#rest-api-read-identity">3.7.2. Reading Identities</a></span></dt><dt><span class="section"><a href="#rest-api-update-identity">3.7.3. Updating Identities</a></span></dt><dt><span class="section"><a href="#rest-api-delete-identity">3.7.4. Deleting Identities</a></span></dt><dt><span class="section"><a href="#rest-api-create-legacy">3.7.5. Creating Identities (Legacy API)</a></span></dt><dt><span class="section"><a href="#rest-api-read-legacy">3.7.6. Reading &amp; Searching for Identities (Legacy API)</a></span></dt><dt><span class="section"><a href="#rest-api-update-legacy">3.7.7. Updating Identities (Legacy API)</a></span></dt><dt><span class="section"><a href="#rest-api-delete-legacy">3.7.8. Deleting Identities (Legacy API)</a></span></dt></dl></div><a class="indexterm" name="d2063e980"></a><p>This section shows how to create, read, update, and delete identities
  using the RESTful APIs.</p><div class="itemizedlist"><p>OpenAM has two REST APIs for managing identities.</p><ul class="itemizedlist" type="disc"><li class="listitem"><p>Under the <code class="literal">/json/users</code>, you find the newer 
    JSON-based API.</p><p>Examples in this section show authentication using the API described
    in <a class="xref" href="#rest-api-auth" title="3.2.&nbsp;Authentication &amp; Logout">Section&nbsp;3.2, &#8220;Authentication &amp; Logout&#8221;</a>. For browser-based clients, you
    can rely on OpenAM cookies rather than construct the header in your
    application.</p><div class="itemizedlist"><p>The following sections cover this JSON-based API.</p><ul class="itemizedlist" type="circle"><li class="listitem"><p><a class="xref" href="#rest-api-create-identity" title="3.7.1.&nbsp;Creating Identities">Section&nbsp;3.7.1, &#8220;Creating Identities&#8221;</a></p></li><li class="listitem"><p><a class="xref" href="#rest-api-read-identity" title="3.7.2.&nbsp;Reading Identities">Section&nbsp;3.7.2, &#8220;Reading Identities&#8221;</a></p></li><li class="listitem"><p><a class="xref" href="#rest-api-update-identity" title="3.7.3.&nbsp;Updating Identities">Section&nbsp;3.7.3, &#8220;Updating Identities&#8221;</a></p></li><li class="listitem"><p><a class="xref" href="#rest-api-delete-identity" title="3.7.4.&nbsp;Deleting Identities">Section&nbsp;3.7.4, &#8220;Deleting Identities&#8221;</a></p></li></ul></div></li><li class="listitem"><p>Under the <code class="literal">/identity</code> endpoint, you find the
    backwards-compatible, legacy API.</p><div class="itemizedlist"><p>The following sections cover this backwards-compatible API.</p><ul class="itemizedlist" type="circle"><li class="listitem"><p><a class="xref" href="#rest-api-create-legacy" title="3.7.5.&nbsp;Creating Identities (Legacy API)">Section&nbsp;3.7.5, &#8220;Creating Identities (Legacy API)&#8221;</a></p></li><li class="listitem"><p><a class="xref" href="#rest-api-read-legacy" title="3.7.6.&nbsp;Reading &amp; Searching for Identities (Legacy API)">Section&nbsp;3.7.6, &#8220;Reading &amp; Searching for Identities (Legacy API)&#8221;</a></p></li><li class="listitem"><p><a class="xref" href="#rest-api-update-legacy" title="3.7.7.&nbsp;Updating Identities (Legacy API)">Section&nbsp;3.7.7, &#8220;Updating Identities (Legacy API)&#8221;</a></p></li><li class="listitem"><p><a class="xref" href="#rest-api-delete-legacy" title="3.7.8.&nbsp;Deleting Identities (Legacy API)">Section&nbsp;3.7.8, &#8220;Deleting Identities (Legacy API)&#8221;</a></p></li></ul></div></li></ul></div><div class="section" title="3.7.1.&nbsp;Creating Identities"><div class="titlepage"><div><div><h3 class="title"><a name="rest-api-create-identity"></a>3.7.1.&nbsp;Creating Identities</h3></div></div></div><p>OpenAM lets administrators create a user profile by making 
   an HTTP POST of the JSON representation of the profile to
   <code class="literal">/json/users/?_action=create</code>.</p><p>The following example shows an administrator creating a new user. The 
    only required fields are <code class="literal">name</code> and 
    <code class="literal">userpassword</code>. If no other name is provided, the entry
    you make for <code class="literal">name</code> defaults to both the user id and the
    user's last name.</p><div class="screen"><pre class="brush: plain;">$ curl "https://openam.example.com:8443/openam/identity/authenticate
 ?username=amadmin&amp;password=password"
token.id=AQIC5w...2NzEz*
$ curl --request POST --header "iplanetDirectoryPro: AQIC5w...2NzEz*"
 --header "Content-Type: application/json"
 --data '{ "name": "bjensen", "userpassword": "secret12",
           "mail": "bjensen@example.com" }'
 https://openam.example.com:8443/openam/json/users/?_action=create
{
    "name": "bjensen",
    "realm": "/",
    "uid": [
        "bjensen"
    ],
    "mail": [
        "bjensen@example.com"
    ],
    "sn": [
        "bjensen"
    ],
    "userpassword": [
        "{SSHA}0pXpKLPRKCGY7g3YqZygJmKMW6IC2BLJimmlwg=="
    ],
    "cn": [
        "bjensen"
    ],
    "inetuserstatus": [
        "Active"
    ],
    "dn": [
        "uid=bjensen,ou=people,dc=openam,dc=forgerock,dc=org"
    ],
    "objectclass": [
        "person",
        "sunIdentityServerLibertyPPService",
        "sunFederationManagerDataStore",
        "inetorgperson",
        "iPlanetPreferences",
        "iplanet-am-auth-configuration-service",
        "organizationalperson",
        "sunFMSAML2NameIdentifier",
        "inetuser",
        "iplanet-am-managed-person",
        "sunAMAuthAccountLockout",
        "iplanet-am-user-service",
        "top"
    ],
    "universalid": [
        "id=bjensen,ou=user,dc=openam,dc=forgerock,dc=org"
    ]
}</pre></div><p>Alternatively, administrators can create user profiles with specific
    user IDs by doing an HTTP PUT of the JSON representation of the changes to
    <code class="literal">/json/users/<em class="replaceable"><code>user-id</code></em></code>, as
    shown in the following example.</p><div class="screen"><pre class="brush: plain;">$ curl "https://openam.example.com:8443/openam/identity/authenticate
 ?username=amadmin&amp;password=password"
token.id=AQIC5w...2NzEz*
$ curl --request PUT --header "iplanetDirectoryPro: AQIC5w...2NzEz*"
 --header "Content-Type: application/json"
 --data '{ "userpassword": "secret12", "mail": "bjensen@example.com" }'
 https://openam.example.com:8443/openam/json/users/bjensen
{
    "name": "bjensen",
    "realm": "/",
    "uid": [
        "bjensen"
    ],
    "mail": [
        "bjensen@example.com"
    ],
    "sn": [
        "bjensen"
    ],
    "userpassword": [
        "{SSHA}e4DJoxvYVW/nsp62XJf29ZADE16YQgrxK+XuKA=="
    ],
    "cn": [
        "bjensen"
    ],
    "inetuserstatus": [
        "Active"
    ],
    "dn": [
        "uid=bjensen,ou=people,dc=openam,dc=forgerock,dc=org"
    ],
    "objectclass": [
        "person",
        "sunIdentityServerLibertyPPService",
        "sunFederationManagerDataStore",
        "inetorgperson",
        "iPlanetPreferences",
        "iplanet-am-auth-configuration-service",
        "organizationalperson",
        "sunFMSAML2NameIdentifier",
        "inetuser",
        "iplanet-am-managed-person",
        "sunAMAuthAccountLockout",
        "iplanet-am-user-service",
        "top"
    ],
    "universalid": [
        "id=bjensen,ou=user,dc=openam,dc=forgerock,dc=org"
    ]
}</pre></div><p>As shown in the examples, OpenAM returns the JSON representation of
    the profile on successful creation. On failure, OpenAM returns a JSON
    representation of the error including the
    <a class="link" href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html" target="_blank">HTTP status code</a>.</p></div><div class="section" title="3.7.2.&nbsp;Reading Identities"><div class="titlepage"><div><div><h3 class="title"><a name="rest-api-read-identity"></a>3.7.2.&nbsp;Reading Identities</h3></div></div></div><p>OpenAM lets users and administrators read profiles by requesting an HTTP
   GET on <code class="literal">/json/users/<em class="replaceable"><code>user-id</code></em></code>.
   This allows users and administrators to verify user data, status, and directory.
   If users or administrators see missing or incorrect information, they can write 
   down the correct information and add it using <a class="xref" href="#rest-api-update-identity" title="3.7.3.&nbsp;Updating Identities">Section&nbsp;3.7.3, &#8220;Updating Identities&#8221;</a>.</p><p>Users can review the data associated with their accounts and administrators 
   can read other user's profiles. The following example shows an administrator 
   accessing user data. Users can view their information by changing
   <code class="literal">username=amadmin</code> to <code class="literal"><em class="replaceable"><code>user-id</code></em></code>.</p><div class="screen"><pre class="brush: plain;">$ curl "https://openam.example.com:8443/openam/identity/authenticate
 ?username=amadmin&amp;password=password"
token.id=AQIC5w...2NzEz*
$ curl --header "iplanetDirectoryPro: AQIC5w...2NzEz*"
 https://openam.example.com:8443/openam/json/users/demo
{
    "name": "demo",
    "realm": "/",
    "uid": [
        "demo"
    ],
    "sn": [
        "demo"
    ],
    "userpassword": [
        "{SSHA}S14oR2gusLWtiDkAS4twj63slXNNaMKpwrOWdw=="
    ],
    "cn": [
        "demo"
    ],
    "inetuserstatus": [
        "Active"
    ],
    "dn": [
        "uid=demo,ou=people,dc=openam,dc=forgerock,dc=org"
    ],
    "objectclass": [
        "person",
        "sunIdentityServerLibertyPPService",
        "sunFederationManagerDataStore",
        "inetorgperson",
        "iPlanetPreferences",
        "iplanet-am-auth-configuration-service",
        "organizationalperson",
        "sunFMSAML2NameIdentifier",
        "inetuser",
        "iplanet-am-managed-person",
        "sunAMAuthAccountLockout",
        "iplanet-am-user-service",
        "top"
    ],
    "universalid": [
        "id=demo,ou=user,dc=openam,dc=forgerock,dc=org"
    ]
}</pre></div><p>As shown in the example, OpenAM returns the JSON representation of the
    profile on success. On failure, OpenAM returns a JSON representation of the
    error including the
    <a class="link" href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html" target="_blank">HTTP status code</a>.</p></div><div class="section" title="3.7.3.&nbsp;Updating Identities"><div class="titlepage"><div><div><h3 class="title"><a name="rest-api-update-identity"></a>3.7.3.&nbsp;Updating Identities</h3></div></div></div><p>OpenAM lets users update their own profiles, and lets administrators
   update other users' profiles. To update an identity do an HTTP PUT of the JSON 
   representation of the changes to <code class="literal">/json/users/<em class="replaceable"><code>user-id</code></em></code>.</p><p>The following example shows how users can update their own
    profiles.</p><div class="screen"><pre class="brush: plain;">$ curl "https://openam.example.com:8443/openam/identity/authenticate
 ?username=demo&amp;password=changeit"
token.id=AQIC5...Y3MTAx*
$ curl --request PUT --header "iplanetDirectoryPro: AQIC5...Y3MTAx*"
 --header "Content-Type: application/json"
 --data '{ "mail": "demo@example.com" }'
 https://openam.example.com:8443/openam/json/users/demo
{
    "name": "demo",
    "realm": "/",
    "uid": [
        "demo"
    ],
    "mail": [
        "demo@example.com"
    ],
    "sn": [
        "demo"
    ],
    "userpassword": [
        "{SSHA}S14oR2gusLWtiDkAS4twj63slXNNaMKpwrOWdw=="
    ],
    "cn": [
        "demo"
    ],
    "inetuserstatus": [
        "Active"
    ],
    "dn": [
        "uid=demo,ou=people,dc=openam,dc=forgerock,dc=org"
    ],
    "objectclass": [
        "person",
        "sunIdentityServerLibertyPPService",
        "sunFederationManagerDataStore",
        "inetorgperson",
        "iPlanetPreferences",
        "iplanet-am-auth-configuration-service",
        "organizationalperson",
        "sunFMSAML2NameIdentifier",
        "inetuser",
        "iplanet-am-managed-person",
        "sunAMAuthAccountLockout",
        "iplanet-am-user-service",
        "top"
    ],
    "universalid": [
        "id=demo,ou=user,dc=openam,dc=forgerock,dc=org"
    ]
}</pre></div><p>As shown in the example, OpenAM returns the JSON representation of the
    profile on success. On failure, OpenAM returns a JSON representation of the
    error including the
    <a class="link" href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html" target="_blank">HTTP status code</a>.</p></div><div class="section" title="3.7.4.&nbsp;Deleting Identities"><div class="titlepage"><div><div><h3 class="title"><a name="rest-api-delete-identity"></a>3.7.4.&nbsp;Deleting Identities</h3></div></div></div><p>OpenAM lets administrators delete a user profile by making an HTTP DELETE 
   call to <code class="literal">/json/users/<em class="replaceable"><code>user-id</code></em></code>.</p><p>The following example removes a user from the top level
    realm. Only administrators should delete users. The user id is the only 
    field required to delete a user.</p><div class="screen"><pre class="brush: plain;">$ curl "https://openam.example.com:8443/openam/identity/authenticate
 ?username=amadmin&amp;password=password"
token.id=AQIC5w...2NzEz*
$ curl --request DELETE --header "iplanetDirectoryPro: AQIC5w...2NzEz*"
 https://openam.example.com:8443/openam/json/users/bjensen
{"success":"true"}</pre></div><p>On success, OpenAM returns a JSON object indicating success. On
    failure, OpenAM returns a JSON representation of the error including the
    <a class="link" href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html" target="_blank">HTTP status code</a>.</p></div><div class="section" title="3.7.5.&nbsp;Creating Identities (Legacy API)"><div class="titlepage"><div><div><h3 class="title"><a name="rest-api-create-legacy"></a>3.7.5.&nbsp;Creating Identities (Legacy API)</h3></div></div></div><p>OpenAM lets you create user profiles, and also create web and J2EE
   policy agent profiles. When you create an entry, you must provide the
   following parameters.</p><div class="variablelist"><dl><dt><span class="term">admin</span></dt><dd><p>Valid token for the user with permissions to add the identity</p></dd><dt><span class="term">identity_name</span></dt><dd><p>A unique name for the identity to create</p></dd><dt><span class="term">identity_attribute_names</span></dt><dd><p>LDAP attribute names for attributes to create</p></dd><dt><span class="term">identity_attribute_values_<em class="replaceable"><code>name</code></em></span></dt><dd><p>LDAP attribute values for the identity to create. For example,
      <code class="literal">identity_attribute_names=sn&amp;identity_attribute_values_sn=Jensen</code>.</p></dd><dt><span class="term">identity_realm</span></dt><dd><p>The realm in which to create the identity</p></dd><dt><span class="term">identity_type</span></dt><dd><p>Either <code class="literal">user</code> or <code class="literal">AgentOnly</code></p></dd></dl></div><div class="screen"><pre class="brush: plain;">$ curl "https://openam.example.com:8443/openam/identity/authenticate?
 username=amadmin
 &amp;password=password"
token.id=AQIC5wM2LY4SfcxSYA8eG-vrNHb_W7nG8XkfAGyRyuaebDY.*AAJTSQACMDE.*
$ curl "https://openam.example.com:8443/openam/identity/create?
 admin=AQIC5wM2LY4SfcxSYA8eG-vrNHb_W7nG8XkfAGyRyuaebDY.*AAJTSQACMDE.*
 &amp;identity_name=testuser
 &amp;identity_attribute_names=cn
 &amp;identity_attribute_values_cn=Test%20User
 &amp;identity_attribute_names=sn
 &amp;identity_attribute_values_sn=User
 &amp;identity_attribute_names=userpassword
 &amp;identity_attribute_values_userpassword=secret12
 &amp;identity_realm=%2F
 &amp;identity_type=user"</pre></div></div><div class="section" title="3.7.6.&nbsp;Reading &amp; Searching for Identities (Legacy API)"><div class="titlepage"><div><div><h3 class="title"><a name="rest-api-read-legacy"></a>3.7.6.&nbsp;Reading &amp; Searching for Identities (Legacy API)</h3></div></div></div><p>Reading is similar to attribute retrieval, as described in
   <a class="xref" href="#rest-api-tokens" title="3.3.&nbsp;Token Validation &amp; Attribute Retrieval">Section&nbsp;3.3, &#8220;Token Validation &amp; Attribute Retrieval&#8221;</a>, but obtained using the token of
   a user with permissions to perform the search, as shown in the following
   example.</p><div class="screen"><pre class="brush: plain;">$ curl "https://openam.example.com:8443/openam/identity/read?
 admin=AQIC5wM2LY4SfcxSYA8eG-vrNHb_W7nG8XkfAGyRyuaebDY.*AAJTSQACMDE.*
 &amp;name=testuser
 &amp;attributes_names=realm
 &amp;attributes_values_realm=%2F"
identitydetails.name=testuser
identitydetails.type=user
identitydetails.realm=o=openam
identitydetails.attribute=
identitydetails.attribute.name=uid
identitydetails.attribute.value=testuser
identitydetails.attribute=
identitydetails.attribute.name=sn
identitydetails.attribute.value=User
identitydetails.attribute=
identitydetails.attribute.name=userpassword
identitydetails.attribute.value={SSHA}AzpT+N1sjrQhL1wfX2ETWh/Aqbd+lH9LOlhDqg==
identitydetails.attribute=
identitydetails.attribute.name=cn
identitydetails.attribute.value=Test User
identitydetails.attribute=
identitydetails.attribute.name=inetuserstatus
identitydetails.attribute.value=Active
identitydetails.attribute=
identitydetails.attribute.name=dn
identitydetails.attribute.value=uid=testuser,ou=people,dc=example,dc=com
identitydetails.attribute=
identitydetails.attribute.name=objectclass
identitydetails.attribute.value=person
identitydetails.attribute.value=sunIdentityServerLibertyPPService
identitydetails.attribute.value=inetorgperson
identitydetails.attribute.value=sunFederationManagerDataStore
identitydetails.attribute.value=iPlanetPreferences
identitydetails.attribute.value=iplanet-am-auth-configuration-service
identitydetails.attribute.value=organizationalperson
identitydetails.attribute.value=sunFMSAML2NameIdentifier
identitydetails.attribute.value=inetuser
identitydetails.attribute.value=iplanet-am-managed-person
identitydetails.attribute.value=iplanet-am-user-service
identitydetails.attribute.value=sunAMAuthAccountLockout
identitydetails.attribute.value=top
identitydetails.attribute=
identitydetails.attribute.name=universalid
identitydetails.attribute.value=id=testuser,ou=user,o=openam</pre></div><p>You can search for user IDs by providing the following
   parameters.</p><div class="variablelist"><dl><dt><span class="term">admin</span></dt><dd><p>Valid token for the user with access to perform the search</p></dd><dt><span class="term">attributes_names</span></dt><dd><p>LDAP attribute names for attributes to search</p></dd><dt><span class="term">attributes_values_<em class="replaceable"><code>name</code></em></span></dt><dd><p>LDAP attribute values for the identity to search. For example,
      <code class="literal">attribute_names=sn&amp;attribute_values_sn=Jensen</code>.</p></dd><dt><span class="term">filter</span></dt><dd><p>Additional LDAP filter component to limit the search results
      returned</p></dd></dl></div><div class="screen"><pre class="brush: plain;">$ curl "https://openam.example.com:8443/openam/identity/search?
 admin=AQIC5wM2LY4SfcxSYA8eG-vrNHb_W7nG8XkfAGyRyuaebDY.*AAJTSQACMDE.*
 &amp;attributes_names=sn
 &amp;attributes_values_sn=Jensen
 &amp;attributes_names=mail
 &amp;attributes_values_mail=bjensen*
 &amp;attributes_names=realm
 &amp;attributes_values_realm=%2F"
string=bjensen</pre></div></div><div class="section" title="3.7.7.&nbsp;Updating Identities (Legacy API)"><div class="titlepage"><div><div><h3 class="title"><a name="rest-api-update-legacy"></a>3.7.7.&nbsp;Updating Identities (Legacy API)</h3></div></div></div><p>You can update an identity with the same parameters used to create
   identities, provided the token corresponds to a user with access to
   update the identity.</p><div class="screen"><pre class="brush: plain;">$ curl "https://openam.example.com:8443/openam/identity/update?
 admin=AQIC5wM2LY4SfcxSYA8eG-vrNHb_W7nG8XkfAGyRyuaebDY.*AAJTSQACMDE.*
 &amp;identity_name=testuser
 &amp;identity_attribute_names=mail
 &amp;identity_attribute_values_mail=testuser%40example.com
 &amp;identity_realm=%2F
 &amp;identity_type=user"</pre></div></div><div class="section" title="3.7.8.&nbsp;Deleting Identities (Legacy API)"><div class="titlepage"><div><div><h3 class="title"><a name="rest-api-delete-legacy"></a>3.7.8.&nbsp;Deleting Identities (Legacy API)</h3></div></div></div><p>You can also delete an identity.</p><div class="screen"><pre class="brush: plain;">$ curl "https://openam.example.com:8443/openam/identity/delete?
 admin=AQIC5wM2LY4SfcxSYA8eG-vrNHb_W7nG8XkfAGyRyuaebDY.*AAJTSQACMDE.*
 &amp;identity_name=testuser
 &amp;identity_realm=%2F
 &amp;identity_type=user"</pre></div></div></div></div><div lang="en" class="chapter" title="Chapter&nbsp;4.&nbsp;Using the OpenAM Java SDK"><div class="titlepage"><div><div><h2 class="title"><a name="chap-jdk"></a>Chapter&nbsp;4.&nbsp;Using the OpenAM Java SDK</h2></div></div></div><a class="indexterm" name="d2063e1254"></a><div class="important" title="Important" style="font-style: italic;"><h3 class="title">Important</h3><p>This samples mentioned in this chapter are not available in the current release.</p></div><p>This chapter introduces OpenAM Java SDK. OpenAM Java SDK is delivered
 in the <code class="filename">samples/opensso-client.zip</code> where you unpacked
 the full version of OpenAM, such as
 <code class="filename">~/Downloads/opensso/samples/opensso-client.zip</code>. To prepare
 to install the OpenAM Java SDK, first unzip
 <code class="filename">opensso-client.zip</code>.</p><div class="screen"><pre class="brush: plain;">$ mkdir -p /path/to/openam-client ; cd /path/to/openam-client
$ unzip ~/Downloads/opensso/samples/opensso-client.zip</pre></div><p>As a result, you have two directories that include the SDK and also
 sample command-line and web-based client applications.</p><div class="variablelist"><dl><dt><span class="term"><code class="filename">src/</code></span></dt><dd><p>This directory contains the SDK and client sample commands.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><code class="filename">classes/</code>: compiled samples</p></li><li class="listitem"><p><code class="filename">lib/</code>: SDK and required libraries</p></li><li class="listitem"><p><code class="filename">resources/</code>: properties configuration for
      the SDK and samples</p></li><li class="listitem"><p><code class="filename">scripts/</code>: installation scripts and scripts
      to run the samples on UNIX, Linux, and Windows systems</p></li><li class="listitem"><p><code class="filename">sources/</code>: sample code</p></li></ul></div></dd><dt><span class="term"><code class="filename">war/</code></span></dt><dd><p>This directory contains a web application archive with client
    samples accessible through the browser after you install the .war in a
    web application container.</p></dd></dl></div><div class="procedure" title="Procedure&nbsp;4.1.&nbsp;To Install OpenAM SDK Command-Line Examples"><a name="install-openam-jdk-cli-client"></a><div class="procedure-title">Procedure&nbsp;4.1.&nbsp;To Install OpenAM SDK Command-Line Examples</div><p>The command-line samples access OpenAM over HTTP or HTTPS.</p><ol class="procedure" type="1"><li class="step" title="Step 1"><p>Compile the samples.</p><div class="screen"><pre class="brush: plain;">$ cd sdk/
$ chmod +x scripts/*.sh
$ ./scripts/compile-samples.sh</pre></div></li><li class="step" title="Step 2"><p>Set up the samples to connect to OpenAM.</p><div class="screen"><pre class="brush: plain;">$ mkdir /path/to/openam-client/debug
$ ./scripts/setup.sh
Debug directory (make sure this directory exists): /path/to/openam-client/debug
Application user (e.g. URLAccessAgent) password: secret12
Protocol of the server: http
Host name of the server: openam.example.com
Port of the server: 8080
Server's deployment URI: openam
Naming URL (hit enter to accept default value,
http://openam.example.com:8080/openam/namingservice):
$</pre></div><p>This sets up the configuration file for the samples,
   <code class="filename">resources/AMConfig.properties</code>. Read the comments in
   the file to see the configuration settings, many of which are similar
   to those used by OpenAM on the server side.</p></li><li class="step" title="Step 3"><p>Check that the login sample works.</p><div class="screen"><pre class="brush: plain;">$ ./scripts/Login.sh
Realm (e.g. /):
Login module name (e.g. DataStore or LDAP): DataStore
Login locale (e.g. en_US or fr_FR): en_US
DataStore: Obtained login context
User Name:amadmin
Password:password
Login succeeded.
Logged Out!!</pre></div></li></ol></div><div class="procedure" title="Procedure&nbsp;4.2.&nbsp;To Install OpenAM SDK Web-Based Samples"><a name="install-openam-jdk-web-client"></a><div class="procedure-title">Procedure&nbsp;4.2.&nbsp;To Install OpenAM SDK Web-Based Samples</div><p>The web-based samples also access OpenAM over HTTP or HTTPS.</p><ol class="procedure" type="1"><li class="step" title="Step 1"><p>Deploy the web application.</p><div class="screen"><pre class="brush: plain;">$ mv war/opensso-client-jdk15.war /path/to/tomcat/webapps/openam-client.war</pre></div></li><li class="step" title="Step 2"><p>Browse to the application you deployed to configure access to
   OpenAM.</p><div class="mediaobject" title="Configuring web-based samples to access OpenAM"><a name="figure-web-samples"></a><img src="images/web-samples.png" longdesc="/Users/mark/Downloads/openam/openam-documentation/openam-doc-source/target/docbkx/html/dev-guide/figure-web-samples.html"><div class="longdesc-link" align="right"><br clear="all"><span class="longdesc-link">[<a href="figure-web-samples.html" target="longdesc">D</a>]</span></div></div><div class="variablelist"><p>Use the following hints to complete the configuration.</p><dl><dt><span class="term">Server Protocol</span></dt><dd><p>Protocol to access OpenAM (<code class="literal">http</code> or
      <code class="literal">https</code>)</p></dd><dt><span class="term">Server Host</span></dt><dd><p>Fully qualified domain name for OpenAM, such as
      <code class="literal">openam.example.com</code></p></dd><dt><span class="term">Server Port</span></dt><dd><p>OpenAM port number such as 8080 or 8443</p></dd><dt><span class="term">Server Deployment URI</span></dt><dd><p>URI entry point to OpenAM such as <code class="literal">/openam</code></p></dd><dt><span class="term">Debug directory</span></dt><dd><p>Where to write the debug messages for the client samples</p></dd><dt><span class="term">Application user name</span></dt><dd><p>An user agent configured to access OpenAM, such as
      <code class="literal">UrlAccessAgent</code> set up when OpenAM was installed</p></dd><dt><span class="term">Application user password</span></dt><dd><p>The user agent password</p></dd></dl></div></li><li class="step" title="Step 3"><p>After successful configuration, click the link to return to the URL
   where you deployed the application to view the available sample
   clients.</p></li></ol></div></div><div lang="en" class="chapter" title="Chapter&nbsp;5.&nbsp;Authenticating Using OpenAM Java SDK"><div class="titlepage"><div><div><h2 class="title"><a name="chap-authentication"></a>Chapter&nbsp;5.&nbsp;Authenticating Using OpenAM Java SDK</h2></div></div></div><a class="indexterm" name="d2063e1429"></a><p>This chapter looks at authentication with the OpenAM Java SDK and at the
 sample client, <code class="filename">Login.java</code>, which demonstrates
 authenticating to OpenAM from a client application, provided a realm, user
 name, and password.</p><div class="orderedlist"><p>With OpenAM, your client application performs the following steps
  to handle authentication.</p><ol class="orderedlist" type="1"><li class="listitem"><p>Sets up an <code class="literal">AuthContext</code>, based on the realm in
   which the user authenticates.</p></li><li class="listitem"><p>Starts the login process by calling the <code class="literal">AuthContext</code>
   <code class="literal">login()</code> method.</p></li><li class="listitem"><p>Handling authentication callbacks to retrieve credentials from the
   user who is authenticating.</p><p>Your application loops through the authentication callbacks by using
   the <code class="literal">AuthContext</code> <code class="literal">getRequirements()</code> and
   <code class="literal">hasMoreRequirements()</code> methods. Each time it finishes
   populating a callback with the credentials retrieved, your application calls
   <code class="literal">submitRequirements()</code> to send the credentials to
   OpenAM's Authentication Service.</p></li><li class="listitem"><p>After handling all authentication callbacks, your application
   calls the <code class="literal">AuthContext</code> <code class="literal">getStatus()</code>
   method.</p><p>On login success, OpenAM sets up an <code class="literal">SSOToken</code> that
   holds information about the authentication, and also about the user's
   environment and session.</p></li><li class="listitem"><p>When the user logs out, your application can end the session by
   calling the <code class="literal">AuthContext</code> <code class="literal">logout()</code>
   method.</p></li></ol></div><p>The <code class="literal">AuthContext</code> class is provided by the
 <code class="literal">com.sun.identity.authentication</code> package, part of the
 OpenAM client API. Callback classes are provided by the
 <code class="literal">javax.security.auth.callback</code> package, which provides
 callbacks for choices, confirmations, locales, names, passwords, text input,
 and text output.</p><p>See the <a class="link" href="http://openam.forgerock.org/apidocs/index.html" target="_top"><em class="citetitle">OpenAM Java SDK API Specification</em></a> for
 reference.</p><p>As the sample client gets the realm (called organization in the sample),
 locale, and authentication module to set up the authentication context,
 there is not need for a language callback to get the local afterwards. The
 <code class="filename">Login.java</code> example does, however, show simple ways of
 handling callbacks for the command-line context. The implementation of
 the sample client follows.</p><pre class="brush: java;">package com.sun.identity.samples.authentication;

import java.io.BufferedReader;
import java.io.InputStreamReader;
import java.io.IOException;
import javax.security.auth.callback.Callback;
import javax.security.auth.callback.ChoiceCallback;
import javax.security.auth.callback.NameCallback;
import javax.security.auth.callback.PasswordCallback;
import javax.security.auth.callback.TextInputCallback;
import javax.security.auth.callback.TextOutputCallback;
import javax.security.auth.callback.UnsupportedCallbackException;
import com.sun.identity.authentication.AuthContext;
import com.sun.identity.authentication.spi.AuthLoginException;
import com.sun.identity.shared.debug.Debug;

public class Login {
    private String loginIndexName;
    private String orgName;
    private String locale;
    
    private Login(String loginIndexName, String orgName) {
        this.loginIndexName = loginIndexName;
        this.orgName = orgName;
    }
    
    private Login(String loginIndexName, String orgName, String locale) {
        this.loginIndexName = loginIndexName;
        this.orgName = orgName;
        this.locale = locale;
    }
    
    protected AuthContext getAuthContext()
        throws AuthLoginException {
        AuthContext lc = new AuthContext(orgName);
        AuthContext.IndexType indexType = AuthContext.IndexType.MODULE_INSTANCE;
        if (locale == null || locale.length() == 0) {
            lc.login(indexType, loginIndexName);
        } else {
            lc.login(indexType, loginIndexName, locale);
        }
        debugMessage(loginIndexName + ": Obtained login context");
        return lc;
    }
    
    private void addLoginCallbackMessage(Callback[] callbacks)
    throws UnsupportedCallbackException {
        int i = 0;
        try {
            for (i = 0; i &lt; callbacks.length; i++) {
                if (callbacks[i] instanceof TextOutputCallback) {
                    handleTextOutputCallback((TextOutputCallback)callbacks[i]);
                } else if (callbacks[i] instanceof NameCallback) {
                    handleNameCallback((NameCallback)callbacks[i]);
                } else if (callbacks[i] instanceof PasswordCallback) {
                    handlePasswordCallback((PasswordCallback)callbacks[i]);
                } else if (callbacks[i] instanceof TextInputCallback) {
                    handleTextInputCallback((TextInputCallback)callbacks[i]);
                } else if (callbacks[i] instanceof ChoiceCallback) {
                    handleChoiceCallback((ChoiceCallback)callbacks[i]);
                }
            }
        } catch (IOException e) {
            e.printStackTrace();
            throw new UnsupportedCallbackException(callbacks[i],e.getMessage());
        }
    }
    
    private void handleTextOutputCallback(TextOutputCallback toc) {
        debugMessage("Got TextOutputCallback");
        // display the message according to the specified type
        
        switch (toc.getMessageType()) {
            case TextOutputCallback.INFORMATION:
                debugMessage(toc.getMessage());
                break;
            case TextOutputCallback.ERROR:
                debugMessage("ERROR: " + toc.getMessage());
                break;
            case TextOutputCallback.WARNING:
                debugMessage("WARNING: " + toc.getMessage());
                break;
            default:
                debugMessage("Unsupported message type: " +
                    toc.getMessageType());
        }
    }
    
    private void handleNameCallback(NameCallback nc)
        throws IOException {
        // prompt the user for a username
        System.out.print(nc.getPrompt());
        System.out.flush();
        nc.setName((new BufferedReader
            (new InputStreamReader(System.in))).readLine());
    }
    
    private void handleTextInputCallback(TextInputCallback tic)
        throws IOException {
        // prompt for text input
        System.out.print(tic.getPrompt());
        System.out.flush();
        tic.setText((new BufferedReader
            (new InputStreamReader(System.in))).readLine());
    }
    
    private void handlePasswordCallback(PasswordCallback pc)
        throws IOException {
        // prompt the user for sensitive information
        System.out.print(pc.getPrompt());
        System.out.flush();
        String passwd = (new BufferedReader(new InputStreamReader(System.in))).
            readLine();
        pc.setPassword(passwd.toCharArray());
    }
    
    private void handleChoiceCallback(ChoiceCallback cc)
        throws IOException {
        // ignore the provided defaultValue
        System.out.print(cc.getPrompt());
        
        String[] strChoices = cc.getChoices();
        for (int j = 0; j &lt; strChoices.length; j++) {
            System.out.print("choice[" + j + "] : " + strChoices[j]);
        }
        System.out.flush();
        cc.setSelectedIndex(Integer.parseInt((new BufferedReader
            (new InputStreamReader(System.in))).readLine()));
    }
    
    protected boolean login(AuthContext lc)
        throws UnsupportedCallbackException {
        boolean succeed = false;
        Callback[] callbacks = null;
        
        // get information requested from module
        while (lc.hasMoreRequirements()) {
            callbacks = lc.getRequirements();
            if (callbacks != null) {
                addLoginCallbackMessage(callbacks);
                lc.submitRequirements(callbacks);
            }
        }
        
        if (lc.getStatus() == AuthContext.Status.SUCCESS) {
            System.out.println("Login succeeded.");
            succeed = true;
        } else if (lc.getStatus() == AuthContext.Status.FAILED) {
            System.out.println("Login failed.");
        } else {
            System.out.println("Unknown status: " + lc.getStatus());
        }
        
        return succeed;
    }
    
    protected void logout(AuthContext lc)
        throws AuthLoginException {
        lc.logout();
        System.out.println("Logged Out!!");
    }
    
    static void debugMessage(String msg) {
        System.out.println(msg);
    }
    
    public static void main(String[] args) {
        try {
            System.out.print("Realm (e.g. /): ");
            String orgName = (new BufferedReader(
                new InputStreamReader(System.in))).readLine();

            System.out.print("Login module name (e.g. DataStore or LDAP): ");
            String moduleName = (new BufferedReader(
                new InputStreamReader(System.in))).readLine();
            
            System.out.print("Login locale (e.g. en_US or fr_FR): ");
            String locale = (new BufferedReader(
                new InputStreamReader(System.in))).readLine();
            
            Login login = new Login(moduleName, orgName, locale);
            AuthContext lc = login.getAuthContext();
            if (login.login(lc)) {
                login.logout(lc);
            }
        } catch (IOException e) {
            e.printStackTrace();
        } catch (AuthLoginException e) {
            e.printStackTrace();
        } catch (UnsupportedCallbackException e) {
            e.printStackTrace();
        }
        System.exit(0);
    }
}</pre><p>For instructions on building the sample clients, see the chapter <a href="../dev-guide/index.html#chap-jdk" class="link"><em class="citetitle">Using the OpenAM
 Java SDK</em></a>.</p></div><div lang="en" class="chapter" title="Chapter&nbsp;6.&nbsp;Handling Single Sign On Using OpenAM Java SDK"><div class="titlepage"><div><div><h2 class="title"><a name="chap-session"></a>Chapter&nbsp;6.&nbsp;Handling Single Sign On Using OpenAM Java SDK</h2></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl><dt><span class="section"><a href="#session-receiving-notifications">6.1. Receiving Notifications</a></span></dt></dl></div><a class="indexterm" name="d2063e1531"></a><div class="important" title="Important" style="font-style: italic;"><h3 class="title">Important</h3><p>This samples mentioned in this chapter are not available in the current release.</p></div><p>This chapter looks at handling session tokens with the OpenAM Java SDK
 using the sample client <code class="filename">SSOTokenSample.java</code>.</p><p>When a user authenticates successfully, OpenAM sets up a single sign on
 session for the user. The session is associated with an SSO token that holds
 information about the authentication, and also about the user's environment
 and session. OpenAM disposes of the session when the authentication context
 <code class="literal">logout()</code> method is called, or when a session timeout is
 reached. At that point the SSO token is no longer valid.</p><p>When your application has an <code class="literal">AuthContext</code> after
 successful authentication, you can retrieve the SSO token from the context.
 You also can get the token as shown in the sample client by passing an SSO
 token ID from OpenAM to an <code class="literal">SSOTokenManager</code>.</p><p>If your application needs to be notified of changes, you can register
 an <code class="literal">SSOTokenListener</code> on the token by using the token's
 <code class="literal">addSSOTokenListener()</code> method. OpenAM then calls your
 <code class="literal">SSOTokenListener</code> <code class="literal">ssoTokenChanged()</code>
 method when the session times out, is disposed of, or has a property that
 changes.</p><p>The sample client takes an SSO token ID to get the token from OpenAM,
 and then displays some information from the SSO token. The implementation of
 the sample client follows.</p><pre class="brush: java;">package com.sun.identity.samples.sso;

import java.io.BufferedReader;
import java.io.InputStreamReader;
import java.io.IOException;
import java.net.InetAddress;
import com.iplanet.sso.SSOException;
import com.iplanet.sso.SSOToken;
import com.iplanet.sso.SSOTokenID;
import com.iplanet.sso.SSOTokenManager;

public class SSOTokenSample {
    private SSOTokenManager manager;
    private SSOToken token;

    private SSOTokenSample(String tokenID)
        throws SSOException
    {
        if (validateToken(tokenID)) {
            setGetProperties(token);
        }
    }

    private boolean validateToken(String tokenID)
        throws SSOException
    {
        boolean validated = false;
        manager = SSOTokenManager.getInstance();
        token = manager.createSSOToken(tokenID);

        // isValid method returns true for valid token.
        if (manager.isValidToken(token)) {
                // let us get all the values from the token
            String host = token.getHostName();
            java.security.Principal principal = token.getPrincipal();
            String authType = token.getAuthType();
            int level = token.getAuthLevel();
            InetAddress ipAddress = token.getIPAddress();
            long maxTime = token.getMaxSessionTime();
            long idleTime = token.getIdleTime();
            long maxIdleTime = token.getMaxIdleTime();
                
            System.out.println("SSOToken host name: " + host);
            System.out.println("SSOToken Principal name: " +
                principal.getName());
            System.out.println("Authentication type used: " + authType);
            System.out.println("IPAddress of the host: " +
                ipAddress.getHostAddress());
            validated = true;
        }

        return validated;
    }

    private void setGetProperties(SSOToken token)
        throws SSOException
    {
        /*
         * Validate the token again, with another method
         * if token is invalid, this method throws an exception
         */
        manager.validateToken(token);
        System.out.println("SSO Token validation test Succeeded.");
            
        // Get the SSOTokenID associated with the token and print it.
        SSOTokenID id = token.getTokenID();
        String tokenId = id.toString();
        System.out.println("Token ID: " + tokenId);

        // Set and get properties in the token.
        token.setProperty("TimeZone", "PST");
        token.setProperty("County", "SantaClara");
        String tZone = token.getProperty("TimeZone");
        String county = token.getProperty("County");

        System.out.println("Property: TimeZone: " + tZone); 
        System.out.println("Property: County: " + county); 
    }

    public static void main(String[] args) {
        try {
            System.out.print("Enter SSOToken ID: ");
            String ssoTokenID = (new BufferedReader(
                new InputStreamReader(System.in))).readLine();
            new SSOTokenSample(ssoTokenID.trim());
        } catch (SSOException e) {
            e.printStackTrace();
        } catch (IOException e) {
            e.printStackTrace();
        }
        System.exit(0);
    }

}</pre><p>Before you run the script that calls the sample, authenticate to OpenAM
 in order to have OpenAM generate the SSO token ID. To see the SSO token ID,
 you can either authenticate on the command line using the RESTful
 <code class="literal">authenticate</code> command, or alternatively run the
 <code class="literal">SSOTokenSampleServlet</code> web-based sample.</p><div class="screen"><pre class="brush: plain;">$ scripts/SSOTokenSample.sh
Enter SSOToken ID:
 AQIC5wM2LY4Sfcxsdru55RwePLUIbY8xTjeHf3Xnw6hphOE.*AAJTSQACMDE.*
SSOToken host name: 192.168.56.1
SSOToken Principal name:
 id=bjensen,ou=user,o=realm,ou=services,dc=openam,dc=forgerock,dc=org
Authentication type used: DataStore
IPAddress of the host: 192.168.56.1
SSO Token validation test Succeeded.
Token ID: AQIC5wM2LY4Sfcxsdru55RwePLUIbY8xTjeHf3Xnw6hphOE.*AAJTSQACMDE.*
Property: TimeZone: PST
Property: County: SantaClara</pre></div><p>Notice both the properties populated by OpenAM, and also the two
 properties, <code class="literal">TimeZone</code> and <code class="literal">County</code>, that
 are set by the sample client.</p><div class="section" title="6.1.&nbsp;Receiving Notifications"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="session-receiving-notifications"></a>6.1.&nbsp;Receiving Notifications</h2></div></div></div><p>If your application implements a listener for change notification, such
  as a <code class="literal">SessionListener</code> to handle notification when a session
  is invalidated, then you must configure the following settings in the
  <code class="filename">AMConfig.properties</code> configuration file for your
  application.</p><div class="variablelist"><dl><dt><span class="term">com.iplanet.am.notification.url</span></dt><dd><p>Set this parameter to
     <code class="literal">http://<em class="replaceable"><code>host</code></em>:<em class="replaceable"><code>port</code></em>/<em class="replaceable"><code>context</code></em>/notificationservice</code>.</p></dd><dt><span class="term">com.iplanet.am.sdk.caching.enabled</span></dt><dd><p>Set this parameter to <code class="literal">true</code>.</p></dd><dt><span class="term">com.iplanet.am.serverMode</span></dt><dd><p>Set this parameter to <code class="literal">false</code>.</p></dd><dt><span class="term">com.sun.identity.client.notification.url</span></dt><dd><p>Set this parameter to
     <code class="literal">http://<em class="replaceable"><code>host</code></em>:<em class="replaceable"><code>port</code></em>/<em class="replaceable"><code>context</code></em>/notificationservice</code>.</p></dd><dt><span class="term">com.sun.identity.idm.cache.enabled</span></dt><dd><p>Set this parameter to <code class="literal">true</code>.</p></dd><dt><span class="term">com.sun.identity.idm.remote.notification.enabled</span></dt><dd><p>Set this parameter to <code class="literal">true</code>.</p></dd><dt><span class="term">com.sun.identity.sm.cache.enabled</span></dt><dd><p>Set this parameter to <code class="literal">true</code>.</p></dd><dt><span class="term">com.sun.identity.sm.enableDataStoreNotification</span></dt><dd><p>Set this parameter to <code class="literal">true</code>.</p></dd></dl></div><p>The above configuration to access the notification service also applies
  for other types of listeners, such as <code class="literal">ServiceListener</code>, and
  <code class="literal">IdEventListener</code> implementations. See the <a class="link" href="http://openam.forgerock.org/apidocs/index.html" target="_top"><em class="citetitle">OpenAM Java SDK API Specification</em></a> for details
  on the available listener interfaces.</p></div></div><div lang="en" class="chapter" title="Chapter&nbsp;7.&nbsp;Requesting Policy Decisions Using OpenAM Java SDK"><div class="titlepage"><div><div><h2 class="title"><a name="chap-policy-decisions"></a>Chapter&nbsp;7.&nbsp;Requesting Policy Decisions Using OpenAM Java SDK</h2></div></div></div><a class="indexterm" name="d2063e1717"></a><div class="important" title="Important" style="font-style: italic;"><h3 class="title">Important</h3><p>This samples mentioned in this chapter are not available in the current release.</p></div><p>This chapter shows how to request policy decision by using OpenAM Java
 SDK. The chapter focuses on the sample client,
 <code class="filename">PolicyEvaluationSample.java</code>, which demonstrates making a
 request to OpenAM for a policy decision about access to a web resource.</p><p>OpenAM centralizes policy administration, policy evaluation, and policy
 decision making so that your applications do not have to do so. In many
 deployments, OpenAM policy agents and the Open Identity gateway can handle
 policy enforcement independently from your application code.</p><p>If your application does need to request a policy decision from OpenAM,
 then your application can retrieve a <code class="literal">PolicyEvaluator</code> from
 a client-side <code class="literal">PolicyEvaluatorFactory</code>, and then call the
 <code class="literal">PolicyEvaluator</code> <code class="literal">getPolicyDecision()</code>
 method. For boolean decisions such as allow or deny, your application can also
 call the <code class="literal">isAllowed()</code> method.</p><p>To make a policy decision, OpenAM needs an <code class="literal">SSOToken</code>,
 the resource to access, the action the user wants to perform on the resource
 such as HTTP <code class="literal">GET</code> or <code class="literal">POST</code>, and a
 <code class="literal">Map</code> of environment settings you can use to specify
 conditions and attributes in the session or can pass back as an empty
 <code class="literal">Map</code> if your policy does not include conditions and
 response attributes.</p><p>The <code class="literal">PolicyEvaluationSample</code> class takes as its
 configuration the user credentials, service name, resource, and action that
 you provide in a Java properties file. It then authenticates the user to get
 an <code class="literal">SSOToken</code> using the <code class="filename">TokenUtils.java</code>
 helper methods. At that point it has sufficient information to request a
 policy decision.</p><p>The implementation of the sample client follows.</p><pre class="brush: java;">package samples.policy;

import com.iplanet.sso.SSOToken;
import com.iplanet.sso.SSOTokenManager;

import com.sun.identity.policy.PolicyDecision;
import com.sun.identity.policy.client.PolicyEvaluator;
import com.sun.identity.policy.client.PolicyEvaluatorFactory;

import samples.policy.TokenUtils;

import java.util.Enumeration;
import java.util.HashMap;
import java.util.Map;
import java.util.HashSet;
import java.util.Properties;
import java.util.MissingResourceException;
import java.util.ResourceBundle;
import java.util.Set;

public class PolicyEvaluationSample {


    public PolicyEvaluationSample() {
    }

    public static void main(String[] args) throws Exception {
        PolicyEvaluationSample clientSample = new PolicyEvaluationSample();
        clientSample.runSample(args);
        System.exit(0);
    }

    public void runSample(String[] args) throws Exception {
        if (args.length == 0 || args.length &gt; 1) {
            System.out.println("Missing argument:"
                    + "properties file name not specified");
        } else {
            System.out.println("Using properties file:" + args[0]);
            Properties sampleProperties = getProperties(args[0]);
            SSOToken ssoToken = getSSOToken(
                (String)sampleProperties.get("user.name"),
                (String)sampleProperties.get("user.password")
            );
            getPolicyDecision(
                ssoToken,
                (String)sampleProperties.get("service.name"),
                (String)sampleProperties.get("resource.name"),
                (String)sampleProperties.get("action.name")
            );
        }
    }

    private SSOToken getSSOToken(
            String userName, String password) throws Exception {
        System.out.println("Entering getSSOToken():"
                + "userName=" + userName + ","
                + "password=" + password);
        SSOToken ssoToken = TokenUtils.getSessionToken("/",
                userName, password);
        System.out.println("TokenID:" + ssoToken.getTokenID().toString());
        System.out.println("returning from getSSOToken()");
        return ssoToken;
    }

    private void getPolicyDecision(
            SSOToken ssoToken,
            String serviceName,
            String resourceName,
            String actionName)
            throws Exception {

        System.out.println("Entering getPolicyDecision():"
                + "resourceName=" + resourceName + ","
                + "serviceName=" + serviceName + ","
                + "actionName=" + actionName);
        PolicyEvaluator pe = PolicyEvaluatorFactory.getInstance().
                    getPolicyEvaluator(serviceName);

        Map env = new HashMap();
        Set attrSet = new HashSet();
        Set actions = new HashSet();
        actions.add(actionName);
        PolicyDecision pd = pe.getPolicyDecision(ssoToken, resourceName,
                actions, env);
        System.out.println("policyDecision:" + pd.toXML());

        System.out.println("returning from getPolicyDecision()");
    }

    private Properties getProperties(String file)
      throws MissingResourceException {
        Properties properties = new Properties();
        ResourceBundle bundle = ResourceBundle.getBundle(file);
        Enumeration e = bundle.getKeys();
        System.out.println("sample properties:");
        while (e.hasMoreElements()) {
            String key = (String) e.nextElement();
            String value = bundle.getString(key);
            properties.put(key, value);
            System.out.println(key + ":" + value);
        }
        return properties;
    }
}</pre><p>Before you run the script that calls the sample, edit the properties
 file, <code class="filename">resources/policyEvaluationSample.properties</code>, to
 indicate the user credentials, resource to access, and HTTP method to
 use. You can use a resource that might not exist for the purposes of this
 example.</p><pre class="brush: java;">user.name=demo
user.password=changeit
service.name=iPlanetAMWebAgentService
resource.name=http://www.example.com:80/banner.html
action.name=GET</pre><p>Also, set up a policy in OpenAM that corresponds to the resource in
 question. You can set up the policy in OpenAM console under Access Control
 &gt; <em class="replaceable"><code>Realm Name</code></em> &gt; Policies. Concerning the
 <em class="replaceable"><code>Realm Name</code></em>, notice that unless you change the code,
 the sample uses the top-level realm, <code class="literal">/</code> to authenticate the
 user.</p><p>With the properties configured and policy in place, get the decision
 from OpenAM using the script,
 <code class="filename">scripts/run-policy-evaluation-sample.sh</code>.</p><div class="screen"><pre class="brush: plain;">$ scripts/run-policy-evaluation-sample.sh
Using properties file:policyEvaluationSample
sample properties:
user.password:changeit
service.name:iPlanetAMWebAgentService
user.name:demo
resource.name:http://www.example.com:80/banner.html
action.name:GET
------------------------------------------------------------------------------:
Entering getSSOToken():userName=demo,password=changeit
TokenID:AQIC5wM2LY4Sfcwu-JzDtYKCaxP-DxROXYd73zLlDt3fCh4.*AAJTSQACMDE.*
returning from getSSOToken()
Entering getPolicyDecision():
 resourceName=http://www.example.com:80/banner.html,
 serviceName=iPlanetAMWebAgentService,
 actionName=GET
policyDecision:&lt;PolicyDecision&gt;
&lt;ResponseAttributes&gt;
&lt;/ResponseAttributes&gt;
&lt;ActionDecision timeToLive="9223372036854775807"&gt;
&lt;AttributeValuePair&gt;
&lt;Attribute name="GET"/&gt;
&lt;Value&gt;allow&lt;/Value&gt;
&lt;/AttributeValuePair&gt;
&lt;Advices&gt;
&lt;/Advices&gt;
&lt;/ActionDecision&gt;
&lt;/PolicyDecision&gt;

returning from getPolicyDecision()</pre></div><p>As you see, the policy decision response is formatted here as an XML
 document.<sup>[<a name="d2063e1808" href="#ftn.d2063e1808" class="footnote">1</a>]</sup> Notice here the line showing that
 OpenAM has allowed access to the resource.</p><pre class="literallayout">&lt;Value&gt;allow&lt;/Value&gt;</pre><div class="footnotes"><br><hr width="100" align="left"><div class="footnote"><p><sup>[<a id="ftn.d2063e1808" href="#d2063e1808" class="para">1</a>] </sup>The <code class="literal">PolicyDecision</code> element is
 defined in
 <code class="filename"><em class="replaceable"><code>openam</code></em>/WEB-INF/remoteInterface.dtd</code>
 where <em class="replaceable"><code>openam</code></em> is the location where the OpenAM web
 application is deployed.</p></div></div></div><div lang="en" class="chapter" title="Chapter&nbsp;8.&nbsp;Using Fedlets in Java Web Applications"><div class="titlepage"><div><div><h2 class="title"><a name="chap-fedlet-java"></a>Chapter&nbsp;8.&nbsp;Using Fedlets in Java Web Applications</h2></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl><dt><span class="section"><a href="#fedlet-signing-encryption">8.1. Signing &amp; Encryption</a></span></dt></dl></div><a class="indexterm" name="d2063e1830"></a><p>This chapter introduces OpenAM Fedlets, and shows how to use the Fedlet
 as part of your Java web application.</p><p>An OpenAM <em class="firstterm">Fedlet</em> is a small web application that
 can do federation in your service provider application with OpenAM acting as
 the identity provider. The Fedlet does not require an entire OpenAM
 installation alongside your application, but instead can redirect to OpenAM
 for single sign on, and to retrieve SAML assertions.</p><div class="procedure" title="Procedure&nbsp;8.1.&nbsp;To Create a Fedlet"><a name="create-a-java-fedlet"></a><div class="procedure-title">Procedure&nbsp;8.1.&nbsp;To Create a Fedlet</div><p>The OpenAM administrator running the identity provider server creates
  a <code class="filename">Fedlet.zip</code> file for your service provider application,
  and then sends you the .zip.</p><ol class="procedure" type="1"><li class="step" title="Step 1"><p>Before creating the Fedlet, create a Hosted Identity Provider if
   you have not already done so.</p></li><li class="step" title="Step 2"><p>On the Common Tasks page of the OpenAM console, click Create
   Fedlet.</p></li><li class="step" title="Step 3"><p>Note that the Circle of Trust includes your hosted identity provider,
   and that Identity Provider is set to your to hosted identity
   provider.</p></li><li class="step" title="Step 4"><p>Name the Fedlet, and also set the Destination URL.</p><p>You can use the deployment URL, such as
   <code class="literal">http://www.example.com:8080/fedlet</code> as both the name and
   the destination URL.</p></li><li class="step" title="Step 5"><p>If you must map attributes to match profiles on the service provider,
   set up the attribute mapping.</p><p>To prepare to perform the Fedlet Attribute Query example, set
   <code class="literal">CommonName=cn</code>, <code class="literal">GivenName=sn</code>, and
   <code class="literal">UserStatus=inetUserStatus</code>.</p></li><li class="step" title="Step 6"><p>Click create to generate the Fedlet.zip file, such as
   <code class="filename">$HOME/openam/myfedlets/httpwwwexamplecom8080fedlet/Fedlet.zip</code>.</p></li><li class="step" title="Step 7"><p>Provide the Fedlet to the service provider.</p></li></ol></div><div class="procedure" title="Procedure&nbsp;8.2.&nbsp;To Install the Fedlet as a Demo Application"><a name="install-fedlet-as-demo"></a><div class="procedure-title">Procedure&nbsp;8.2.&nbsp;To Install the Fedlet as a Demo Application</div><p><code class="filename">Fedlet.zip</code> includes the
  <code class="filename">fedlet.war</code> archive corresponding to the identity
  provider, and a <code class="filename">README</code> file.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>The <code class="filename">fedlet.war</code> archive contains both the Fedlet
    as a demo web application, and also the files you use to include the Fedlet
    in your service provider application.</p></li><li class="listitem"><p>The README file describes how to use the Fedlet.</p></li></ul></div><ol class="procedure" type="1"><li class="step" title="Step 1"><p>Deploy the Fedlet in your web container.</p><div class="screen"><pre class="brush: plain;">$ unzip Fedlet.zip
$ mv fedlet.war /path/to/tomcat/webapps</pre></div></li><li class="step" title="Step 2"><p>Browse to the Fedlet URL, and then click the links to set up the
   configuration directory in <code class="filename">$HOME/fedlet</code>, where $HOME
   corresponds to the user running the web application container.</p></li><li class="step" title="Step 3"><p>In the Fedlet configuration directory, set up a JKS keystore file,
   keystore password file, and key password file.</p><p>For demo purposes, you can copy the test
   <code class="filename">keystore.jks</code>, <code class="filename">.keypass</code>, and
   <code class="filename">.storepass</code> from the OpenAM identity provider.</p><div class="screen"><pre class="brush: plain;">$ cd /home/user/openam/openam
$ scp keystore.jks .keypass .storepass www.example.com:/home/user/fedlet/
user@www.example.com's password:
keystore.jks                                   100% 1348     1.3KB/s   00:00
.keypass                                       100%   36     0.0KB/s   00:00
.storepass                                     100%   36     0.0KB/s   00:00</pre></div></li><li class="step" title="Step 4"><p>Try one or more examples from the Fedlet home page to validate Fedlet
   setup.</p><div class="mediaobject" title="Home page for demo Fedlet"><a name="figure-fedlet-demo"></a><img src="images/fedlet-demo.png" longdesc="/Users/mark/Downloads/openam/openam-documentation/openam-doc-source/target/docbkx/html/dev-guide/figure-fedlet-demo.html"><div class="longdesc-link" align="right"><br clear="all"><span class="longdesc-link">[<a href="figure-fedlet-demo.html" target="longdesc">D</a>]</span></div></div><p>After setting up OpenAM with the default subjects, you can login on
   the identity provider with user name <code class="literal">demo</code> and password
   <code class="literal">changeit</code>.</p></li></ol></div><div class="procedure" title="Procedure&nbsp;8.3.&nbsp;To Add Your Application"><a name="hello-world-with-fedlet"></a><div class="procedure-title">Procedure&nbsp;8.3.&nbsp;To Add Your Application</div><div class="variablelist"><p>The Fedlet includes the following files that you use when building
   your own service provider application based on the demo web application,
   including a set of JavaServer Pages (JSP) examples.</p><dl><dt><span class="term"><code class="filename">conf/</code></span></dt><dd><p>Configuration files copied to <code class="filename">$HOME/fedlet</code> when
     you first deploy and configure the Fedlet. When deploying your application,
     you can move these to an alternate location passed to the Java virtual
     machine for the web application container at startup. For example, if
     you store the configuration under <code class="filename">/export/fedlet/</code>,
     then you could pass the following property to the JVM.</p><pre class="literallayout">-Dcom.sun.identity.fedlet.home=/export/fedlet/conf</pre><p>You do not need to include these files in your application.</p></dd><dt><span class="term"><code class="filename">fedletAttrQuery.jsp</code>, </span><span class="term"><code class="filename">fedletAttrResp.jsp</code></span></dt><dd><p>Sample SAML attribute query and response handlers. See the Fedlet
     README file for more information.</p></dd><dt><span class="term"><code class="filename">fedletEncode.jsp</code></span></dt><dd><p>Utility JSP to encode a password, such as the password used to
     protect a Java keystore</p></dd><dt><span class="term"><code class="filename">fedletSampleApp.jsp</code>, </span><span class="term"><code class="filename">index.jsp</code></span></dt><dd><p>Demo application. You can remove these before deployment to replace
     them with your application.</p></dd><dt><span class="term"><code class="filename">fedletXACMLQuery.jsp</code>, </span><span class="term"><code class="filename">fedletXACMLResp.jsp</code></span></dt><dd><p>Sample SAML XACML query and response handlers. See the Fedlet
     README file for more information.</p></dd><dt><span class="term"><code class="filename">logout.jsp</code></span></dt><dd><p>Utility page to perform single log out</p></dd><dt><span class="term"><code class="filename">saml2/jsp/</code></span></dt><dd><p>JSPs to initiate single sign on and single logout, and to handle
     error, and also a JSP for obtaining Fedlet metadata,
     <code class="filename">saml2/jsp/exportmetadata.jsp</code></p></dd><dt><span class="term"><code class="filename">WEB-INF/classes/</code></span></dt><dd><p>Localized Java properties files for strings used in the Fedlet user
     interface</p></dd><dt><span class="term"><code class="filename">WEB-INF/lib/</code></span></dt><dd><p>Fedlet libraries required by your application</p></dd><dt><span class="term"><code class="filename">WEB-INF/web.xml</code></span></dt><dd><p>Fedlet web application configuration, showing how JSPs map to URLs
     used in the Fedlet. Add mappings for your application before
     deployment.</p><p>In the <code class="filename">web.xml</code> mappings, your application must
     be mapped to <code class="literal">/fedletapplication</code>, as this is the
     assertion consumer URL set in the Fedlet metadata.</p><pre class="brush: xml;">&lt;servlet&gt;
    &lt;servlet-name&gt;yourApp&lt;/servlet-name&gt;
    &lt;jsp-file&gt;/fedletSampleApp.jsp&lt;/jsp-file&gt;
&lt;/servlet&gt;
&lt;servlet-mapping&gt;
    &lt;servlet-name&gt;yourApp&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/fedletapplication&lt;/url-pattern&gt;
&lt;/servlet-mapping&gt;</pre></dd></dl></div><p>Follow these steps for a very simple demonstration of how to customize
  the Fedlet.</p><ol class="procedure" type="1"><li class="step" title="Step 1"><p>Backup <code class="filename">fedletSampleApp.jsp</code>.</p><div class="screen"><pre class="brush: plain;">$ cd /path/to/tomcat/webapps/fedlet/
$ cp fedletSampleApp.jsp fedletSampleApp.jsp.orig</pre></div></li><li class="step" title="Step 2"><p>Edit <code class="filename">fedletSampleApp.jsp</code> to reduce it to a single
   redirection to <code class="filename">myapp.jsp</code>. An implementation of the
   &lt;html&gt; element of the file follows below.</p><pre class="brush: html;">&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Fedlet Sample Application&lt;/title&gt;
    &lt;meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /&gt;
&lt;/head&gt;

&lt;body&gt;
&lt;%
    // BEGIN : following code is a must for Fedlet (SP) side application
    Map map;
    try {
        // invoke the Fedlet processing logic. this will do all the
        // necessary processing conforming to SAMLv2 specifications,
        // such as XML signature validation, Audience and Recipient
        // validation etc.  
        map = SPACSUtils.processResponseForFedlet(request, response);
        response.sendRedirect("myapp.jsp");
    } catch (SAML2Exception sme) {
        SAMLUtils.sendError(request, response,
            response.SC_INTERNAL_SERVER_ERROR, "failedToProcessSSOResponse",
            sme.getMessage());
        return;
    } catch (IOException ioe) {
        SAMLUtils.sendError(request, response,
            response.SC_INTERNAL_SERVER_ERROR, "failedToProcessSSOResponse",
            ioe.getMessage());
        return;
    } catch (SessionException se) {
        SAMLUtils.sendError(request, response, 
            response.SC_INTERNAL_SERVER_ERROR, "failedToProcessSSOResponse",
            se.getMessage());
        return;
    } catch (ServletException se) {
        SAMLUtils.sendError(request, response,
            response.SC_BAD_REQUEST, "failedToProcessSSOResponse",
            se.getMessage());
        return;
    }
    // END : code is a must for Fedlet (SP) side application
%&gt;
&lt;/body&gt;
&lt;/html&gt;</pre></li><li class="step" title="Step 3"><p>Add a <code class="filename">myapp.jsp</code> page to the Fedlet, such as the
   following.</p><pre class="brush: html;">&lt;html&gt;
&lt;head&gt;
&lt;title&gt;My Application&lt;/title&gt;
&lt;meta http-equiv="Content-Type" content="text/html" /&gt;
&lt;/head&gt;

&lt;body&gt;
&lt;h1&gt;My Application&lt;/h1&gt;
&lt;p&gt;After you change the &lt;code&gt;fedletSampleApp.jsp&lt;/code&gt;,
   all it does is redirect to this home page after
   successful login.&lt;/p&gt;
&lt;p&gt;See the fedlet README file and example JSPs for hints
   on how to retrieve attributes from OpenAM, or to send
   XACML queries for policy decisions.&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;</pre></li><li class="step" title="Step 4"><p>Browse to the Fedlet URL, such as
   <code class="literal">http://www.example.com:8080/fedlet/</code>, and try one
   of the login methods.</p><p>After login you are redirected to <code class="filename">myapp.jsp</code>.</p></li></ol></div><div class="section" title="8.1.&nbsp;Signing &amp; Encryption"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="fedlet-signing-encryption"></a>8.1.&nbsp;Signing &amp; Encryption</h2></div></div></div><p>By default when you create the Java Fedlet, signing and encryption are
  not configured. You can however set up OpenAM and the fedlet to sign and
  to verify XML signatures and to encrypt and to decrypt data such as SAML
  assertions.</p><div class="itemizedlist"><p>Enable signing and encryption for the Java Fedlet involves the
   following high level stages.</p><ul class="itemizedlist" type="disc"><li class="listitem"><p>Before you create the Fedlet, configure the IDP to sign and encrypt
    data. See Federation &gt; Entity Providers &gt; <em class="replaceable"><code>IDP
    Name</code></em> &gt; Signing and Encryption in the OpenAM console.</p><p>For evaluation, you can use the <code class="literal">test</code> certificate
    delivered with OpenAM.</p></li><li class="listitem"><p>Initially deploy and configure the Fedlet, but do not use the Fedlet
    until you finish.</p></li><li class="listitem"><p>On the Fedlet side set up a JKS keystore used for signing and
    encryption. For evaluation, you can use copy the
    <code class="filename">keystore.jks</code> file delivered with OpenAM. You can find
    the file under the configuration directory for OpenAM, such as
    <code class="filename">$HOME/openam/openam/</code> for a server instance with
    base URI <code class="literal">openam</code>. The built-in keystore includes the
    <code class="literal">test</code> certificate.</p><p>You must also set up <code class="filename">.storepass</code> and
    <code class="filename">.keypass</code> files using the
    <code class="filename">fedletEncode.jsp</code> page, such as
    <code class="literal">http://www.example.com:8080/fedlet/fedletEncode.jsp</code>, to
    encode passwords on the Fedlet side. The passwords for the test key store
    and private key are both <code class="literal">changeit</code>.</p></li><li class="listitem"><p>Configure the Fedlet to perform signing and encryption by ensuring
    the Fedlet has access to the key store, and by updating the SP metadata
    for the Fedlet.</p></li><li class="listitem"><p>Import the updated SP metadata into the IDP to replace the default
    Fedlet configuration.</p></li><li class="listitem"><p>Restart the Fedlet or container in which the Fedlet runs for the
    changes you made on the Fedlet side to take effect.</p></li></ul></div><div class="procedure" title="Procedure&nbsp;8.4.&nbsp;To Configure the Fedlet For Signing &amp; Encryption"><a name="fedlet-conf-signing-encryption"></a><div class="procedure-title">Procedure&nbsp;8.4.&nbsp;To Configure the Fedlet For Signing &amp; Encryption</div><p>The <code class="filename">FederationConfig.properties</code> file specifies
   the paths to the JKS keystore holding the signing or encryption keys for
   the Fedlet, the keystore password file, and the private key password
   file.</p><ol class="procedure" type="1"><li class="step" title="Step 1"><p>After setting up your keystore and password files as described above,
    edit the properties file in the configuration directory, such as
    <code class="filename">$HOME/fedlet/FederationConfig.properties</code>, to point
    to the keystore and password files.</p></li><li class="step" title="Step 2"><p>Export the certificate to use for signing and encryption
    purposes.</p><div class="screen"><pre class="brush: plain;">$ keytool -export -rfc -keystore keystore.jks -alias test
Enter keystore password:
-----BEGIN CERTIFICATE-----
MIICQDCCAakCBEeNB0swDQYJKoZIhvcNAQEEBQAwZzELMAkGA1UEBhMCVVMxEzARBgNVBAgTCkNh
bGlmb3JuaWExFDASBgNVBAcTC1NhbnRhIENsYXJhMQwwCgYDVQQKEwNTdW4xEDAOBgNVBAsTB09w
ZW5TU08xDTALBgNVBAMTBHRlc3QwHhcNMDgwMTE1MTkxOTM5WhcNMTgwMTEyMTkxOTM5WjBnMQsw
CQYDVQQGEwJVUzETMBEGA1UECBMKQ2FsaWZvcm5pYTEUMBIGA1UEBxMLU2FudGEgQ2xhcmExDDAK
BgNVBAoTA1N1bjEQMA4GA1UECxMHT3BlblNTTzENMAsGA1UEAxMEdGVzdDCBnzANBgkqhkiG9w0B
AQEFAAOBjQAwgYkCgYEArSQc/U75GB2AtKhbGS5piiLkmJzqEsp64rDxbMJ+xDrye0EN/q1U5Of+
RkDsaN/igkAvV1cuXEgTL6RlafFPcUX7QxDhZBhsYF9pbwtMzi4A4su9hnxIhURebGEmxKW9qJNY
Js0Vo5+IgjxuEWnjnnVgHTs1+mq5QYTA7E6ZyL8CAwEAATANBgkqhkiG9w0BAQQFAAOBgQB3Pw/U
QzPKTPTYi9upbFXlrAKMwtFf2OW4yvGWWvlcwcNSZJmTJ8ARvVYOMEVNbsT4OFcfu2/PeYoAdiDA
cGy/F2Zuj8XJJpuQRSE6PtQqBuDEHjjmOQJ0rV/r8mO1ZCtHRhpZ5zYRjhRC9eCbjx9VrFax0JDC
/FfwWigmrW0Y0Q==</pre></div></li><li class="step" title="Step 3"><p>Edit the standard metadata file for the Fedlet, such as
    <code class="filename">$HOME/fedlet/sp.xml</code>, to include the certificate
    in KeyDescriptor elements, that are children of the SPSSODescriptor
    element.</p><pre class="brush: xml;">&lt;EntityDescriptor
 xmlns="urn:oasis:names:tc:SAML:2.0:metadata"
 entityID="http://www.example.com:8080/fedlet"&gt;
 &lt;SPSSODescriptor
  AuthnRequestsSigned="true"
  WantAssertionsSigned="true"
  protocolSupportEnumeration="urn:oasis:names:tc:SAML:2.0:protocol"&gt;
  &lt;KeyDescriptor use="signing"&gt;
   &lt;ds:KeyInfo xmlns:ds="http://www.w3.org/2000/09/xmldsig#"&gt;
    &lt;ds:X509Data&gt;
     &lt;ds:X509Certificate&gt;
MIICQDCCAakCBEeNB0swDQYJKoZIhvcNAQEEBQAwZzELMAkGA1UEBhMCVVMxEzARBgNVBAgTCkNh
bGlmb3JuaWExFDASBgNVBAcTC1NhbnRhIENsYXJhMQwwCgYDVQQKEwNTdW4xEDAOBgNVBAsTB09w
ZW5TU08xDTALBgNVBAMTBHRlc3QwHhcNMDgwMTE1MTkxOTM5WhcNMTgwMTEyMTkxOTM5WjBnMQsw
CQYDVQQGEwJVUzETMBEGA1UECBMKQ2FsaWZvcm5pYTEUMBIGA1UEBxMLU2FudGEgQ2xhcmExDDAK
BgNVBAoTA1N1bjEQMA4GA1UECxMHT3BlblNTTzENMAsGA1UEAxMEdGVzdDCBnzANBgkqhkiG9w0B
AQEFAAOBjQAwgYkCgYEArSQc/U75GB2AtKhbGS5piiLkmJzqEsp64rDxbMJ+xDrye0EN/q1U5Of+
RkDsaN/igkAvV1cuXEgTL6RlafFPcUX7QxDhZBhsYF9pbwtMzi4A4su9hnxIhURebGEmxKW9qJNY
Js0Vo5+IgjxuEWnjnnVgHTs1+mq5QYTA7E6ZyL8CAwEAATANBgkqhkiG9w0BAQQFAAOBgQB3Pw/U
QzPKTPTYi9upbFXlrAKMwtFf2OW4yvGWWvlcwcNSZJmTJ8ARvVYOMEVNbsT4OFcfu2/PeYoAdiDA
cGy/F2Zuj8XJJpuQRSE6PtQqBuDEHjjmOQJ0rV/r8mO1ZCtHRhpZ5zYRjhRC9eCbjx9VrFax0JDC
/FfwWigmrW0Y0Q==
     &lt;/ds:X509Certificate&gt;
    &lt;/ds:X509Data&gt;
   &lt;/ds:KeyInfo&gt;
  &lt;/KeyDescriptor&gt;
  &lt;KeyDescriptor use="encryption"&gt;
   &lt;ds:KeyInfo xmlns:ds="http://www.w3.org/2000/09/xmldsig#"&gt;
    &lt;ds:X509Data&gt;
     &lt;ds:X509Certificate&gt;
MIICQDCCAakCBEeNB0swDQYJKoZIhvcNAQEEBQAwZzELMAkGA1UEBhMCVVMxEzARBgNVBAgTCkNh
bGlmb3JuaWExFDASBgNVBAcTC1NhbnRhIENsYXJhMQwwCgYDVQQKEwNTdW4xEDAOBgNVBAsTB09w
ZW5TU08xDTALBgNVBAMTBHRlc3QwHhcNMDgwMTE1MTkxOTM5WhcNMTgwMTEyMTkxOTM5WjBnMQsw
CQYDVQQGEwJVUzETMBEGA1UECBMKQ2FsaWZvcm5pYTEUMBIGA1UEBxMLU2FudGEgQ2xhcmExDDAK
BgNVBAoTA1N1bjEQMA4GA1UECxMHT3BlblNTTzENMAsGA1UEAxMEdGVzdDCBnzANBgkqhkiG9w0B
AQEFAAOBjQAwgYkCgYEArSQc/U75GB2AtKhbGS5piiLkmJzqEsp64rDxbMJ+xDrye0EN/q1U5Of+
RkDsaN/igkAvV1cuXEgTL6RlafFPcUX7QxDhZBhsYF9pbwtMzi4A4su9hnxIhURebGEmxKW9qJNY
Js0Vo5+IgjxuEWnjnnVgHTs1+mq5QYTA7E6ZyL8CAwEAATANBgkqhkiG9w0BAQQFAAOBgQB3Pw/U
QzPKTPTYi9upbFXlrAKMwtFf2OW4yvGWWvlcwcNSZJmTJ8ARvVYOMEVNbsT4OFcfu2/PeYoAdiDA
cGy/F2Zuj8XJJpuQRSE6PtQqBuDEHjjmOQJ0rV/r8mO1ZCtHRhpZ5zYRjhRC9eCbjx9VrFax0JDC
/FfwWigmrW0Y0Q==
     &lt;/ds:X509Certificate&gt;
    &lt;/ds:X509Data&gt;
   &lt;/ds:KeyInfo&gt;
   &lt;EncryptionMethod Algorithm="http://www.w3.org/2001/04/xmlenc#aes128-cbc"&gt;
    &lt;xenc:KeySize xmlns:xenc="http://www.w3.org/2001/04/xmlenc#"&gt;
     128
    &lt;/xenc:KeySize&gt;
   &lt;/EncryptionMethod&gt;
  &lt;/KeyDescriptor&gt;
  &lt;SingleLogoutService
   Binding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect"
   Location="http://www.example.com:8080/fedlet/fedletSloRedirect"
   ResponseLocation="http://www.example.com:8080/fedlet/fedletSloRedirect" /&gt;
  &lt;SingleLogoutService
   Binding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST"
   Location="http://www.example.com:8080/fedlet/fedletSloPOST"
   ResponseLocation="http://www.example.com:8080/fedlet/fedletSloPOST" /&gt;
  &lt;SingleLogoutService
   Binding="urn:oasis:names:tc:SAML:2.0:bindings:SOAP"
   Location="http://www.example.com:8080/fedlet/fedletSloSoap" /&gt;
  &lt;NameIDFormat&gt;
   urn:oasis:names:tc:SAML:2.0:nameid-format:transient
  &lt;/NameIDFormat&gt;
  &lt;AssertionConsumerService
   index="0"
   isDefault="true"
   Binding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST"
   Location="http://www.example.com:8080/fedlet/fedletapplication" /&gt;
  &lt;AssertionConsumerService
   index="1"
   Binding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Artifact"
   Location="http://www.example.com:8080/fedlet/fedletapplication" /&gt;
 &lt;/SPSSODescriptor&gt;
 &lt;RoleDescriptor
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:query="urn:oasis:names:tc:SAML:metadata:ext:query"
  xsi:type="query:AttributeQueryDescriptorType"
  protocolSupportEnumeration="urn:oasis:names:tc:SAML:2.0:protocol"&gt;
 &lt;/RoleDescriptor&gt;
 &lt;XACMLAuthzDecisionQueryDescriptor
  WantAssertionsSigned="false"
  protocolSupportEnumeration="urn:oasis:names:tc:SAML:2.0:protocol" /&gt;
&lt;/EntityDescriptor&gt;</pre></li><li class="step" title="Step 4"><p>Edit the extended metadata file for the Fedlet, such as
    <code class="filename">$HOME/fedlet/sp-extended.xml</code>, to set the certificate
    alias names to the alias for the Fedlet certificate, and the
    <code class="literal">want*Signed</code> and <code class="literal">want*Encrypted</code> values
    to <code class="literal">true</code>.</p><p>If you reformat the file, take care not to add white space around
    string values in elements.</p><pre class="brush: xml;">
&lt;EntityConfig xmlns="urn:sun:fm:SAML:2.0:entityconfig"
 xmlns:fm="urn:sun:fm:SAML:2.0:entityconfig" hosted="1"
 entityID="http://www.example.com:8080/fedlet"&gt;
 &lt;SPSSOConfig metaAlias="/sp"&gt;
  &lt;Attribute name="description"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="signingCertAlias"&gt;
   &lt;Value&gt;test&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="encryptionCertAlias"&gt;
   &lt;Value&gt;test&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="basicAuthOn"&gt;
   &lt;Value&gt;false&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="basicAuthUser"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="basicAuthPassword"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="autofedEnabled"&gt;
   &lt;Value&gt;false&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="autofedAttribute"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="transientUser"&gt;
   &lt;Value&gt;anonymous&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="spAdapter"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="spAdapterEnv"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="fedletAdapter"&gt;
   &lt;Value&gt;com.sun.identity.saml2.plugins.DefaultFedletAdapter&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="fedletAdapterEnv"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="spAccountMapper"&gt;
   &lt;Value&gt;com.sun.identity.saml2.plugins.DefaultLibrarySPAccountMapper&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="useNameIDAsSPUserID"&gt;
   &lt;Value&gt;false&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="spAttributeMapper"&gt;
   &lt;Value&gt;com.sun.identity.saml2.plugins.DefaultSPAttributeMapper&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="spAuthncontextMapper"&gt;
   &lt;Value&gt;com.sun.identity.saml2.plugins.DefaultSPAuthnContextMapper&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="spAuthncontextClassrefMapping"&gt;
   &lt;Value
   &gt;urn:oasis:names:tc:SAML:2.0:ac:classes:PasswordProtectedTransport|0|default&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="spAuthncontextComparisonType"&gt;
   &lt;Value&gt;exact&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="attributeMap"&gt;
   &lt;Value&gt;*=*&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="saml2AuthModuleName"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="localAuthURL"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="intermediateUrl"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="defaultRelayState"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="appLogoutUrl"&gt;
   &lt;Value&gt;http://www.example.com:8080/fedlet/logout&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="assertionTimeSkew"&gt;
   &lt;Value&gt;300&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="wantAttributeEncrypted"&gt;
   &lt;Value&gt;true&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="wantAssertionEncrypted"&gt;
   &lt;Value&gt;true&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="wantNameIDEncrypted"&gt;
   &lt;Value&gt;true&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="wantPOSTResponseSigned"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="wantArtifactResponseSigned"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="wantLogoutRequestSigned"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="wantLogoutResponseSigned"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="wantMNIRequestSigned"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="wantMNIResponseSigned"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="responseArtifactMessageEncoding"&gt;
   &lt;Value&gt;URI&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="cotlist"&gt;
   &lt;Value&gt;fedlet-cot&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="saeAppSecretList"&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="saeSPUrl"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="saeSPLogoutUrl"&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="ECPRequestIDPListFinderImpl"&gt;
   &lt;Value&gt;com.sun.identity.saml2.plugins.ECPIDPFinder&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="ECPRequestIDPList"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="ECPRequestIDPListGetComplete"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="enableIDPProxy"&gt;
   &lt;Value&gt;false&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="idpProxyList"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="idpProxyCount"&gt;
   &lt;Value&gt;0&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="useIntroductionForIDPProxy"&gt;
   &lt;Value&gt;false&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="spSessionSyncEnabled"&gt;
   &lt;Value&gt;false&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="relayStateUrlList"&gt;
  &lt;/Attribute&gt;
 &lt;/SPSSOConfig&gt;
 &lt;AttributeQueryConfig metaAlias="/attrQuery"&gt;
  &lt;Attribute name="signingCertAlias"&gt;
   &lt;Value&gt;test&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="encryptionCertAlias"&gt;
   &lt;Value&gt;test&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="wantNameIDEncrypted"&gt;
   &lt;Value&gt;true&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="cotlist"&gt;
   &lt;Value&gt;fedlet-cot&lt;/Value&gt;
  &lt;/Attribute&gt;
 &lt;/AttributeQueryConfig&gt;
 &lt;XACMLAuthzDecisionQueryConfig metaAlias="/pep"&gt;
  &lt;Attribute name="signingCertAlias"&gt;
   &lt;Value&gt;test&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="encryptionCertAlias"&gt;
   &lt;Value&gt;test&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="basicAuthOn"&gt;
   &lt;Value&gt;false&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="basicAuthUser"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="basicAuthPassword"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="wantXACMLAuthzDecisionResponseSigned"&gt;
   &lt;Value&gt;false&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="wantAssertionEncrypted"&gt;
   &lt;Value&gt;true&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="cotlist"&gt;
   &lt;Value&gt;fedlet-cot&lt;/Value&gt;
  &lt;/Attribute&gt;
 &lt;/XACMLAuthzDecisionQueryConfig&gt;
&lt;/EntityConfig&gt;</pre></li><li class="step" title="Step 5"><p>In OpenAM console delete the original SP entity configuration for the
    Fedlet, and then import the updated metadata for the new configuration into
    OpenAM on the IDP side.</p></li><li class="step" title="Step 6"><p>Restart the Fedlet or the container in which it runs in order for
    the Fedlet to pick up the changes to the configuration properties and the
    metadata.</p></li></ol></div></div></div><div lang="en" class="chapter" title="Chapter&nbsp;9.&nbsp;Using Fedlets in .NET Applications"><div class="titlepage"><div><div><h2 class="title"><a name="chap-fedlet-dotnet"></a>Chapter&nbsp;9.&nbsp;Using Fedlets in .NET Applications</h2></div></div></div><a class="indexterm" name="d2063e2227"></a><p>This chapter explains how to use the Fedlet in your .NET application.
 You must configure the OpenAM .NET Fedlet to work with the identity provider.
 Before creating the Fedlet, therefore, set up a Hosted Identity Provider in
 OpenAM.</p><div class="procedure" title="Procedure&nbsp;9.1.&nbsp;To Install the .NET Fedlet as a Demo Application"><a name="install-dotnet-fedlet"></a><div class="procedure-title">Procedure&nbsp;9.1.&nbsp;To Install the .NET Fedlet as a Demo Application</div><p>Before you start, create the hosted identity provider, and the Circle
  of Trust to which you plan to add the Fedlet. You can perform these steps
  using the Create Hosted Identity Provider wizard on the Common Tasks page of
  the OpenAM console. The .NET Fedlet demo requires a signing key for the
  Identity Provider. For evaluation, use the <code class="literal">test</code>
  certificate installed with OpenAM.</p><p>Follow these steps to configure and install the .NET Fedlet demo
  application.</p><ol class="procedure" type="1"><li class="step" title="Step 1"><p>Download the .NET Fedlet (<code class="filename">Fedlet-aspnet.zip</code>) from
   the <a class="link" href="http://forgerock.org/openam.html" target="_blank">OpenAM download page</a>. Unpack the contents of the .zip file into a
   working directory.</p><div class="variablelist"><dl><dt><span class="term"><code class="filename">bin\</code></span></dt><dd><p>This folder contains the <code class="filename">Fedlet.dll</code> library,
      that you copy to your application's <code class="filename">bin\</code>
      folder.</p></dd><dt><span class="term"><code class="filename">conf\</code></span></dt><dd><p>This folder contains the templates you edit to prepare your Fedlet
      configuration, including the identity provider and Fedlet (SP) metadata
      for federation. The completed configuration files belong in your
      application's <code class="filename">App_Data\</code> folder.</p></dd><dt><span class="term"><code class="filename">readme.txt</code></span></dt><dd><p>This file describes how to set up and configure .NET Fedlets.</p></dd><dt><span class="term"><code class="filename">SampleApp\</code></span></dt><dd><p>This folder contains the demo application.</p></dd></dl></div></li><li class="step" title="Step 2"><p>Edit the template files in the <code class="filename">SampleApp\App_Data\</code>
   folder based on where you deploy the Fedlet demo application, and on how your
   identity provider is configured.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>Edit <code class="filename">fedlet.cot</code> to set
     <code class="literal">cot-name</code> to the name of the Circle of Trust, and to set
     <code class="literal">sun-fm-trusted-providers</code> to include the entity ID of
     the identity provider, and the entity ID of the Fedlet service
     provider.</p></li><li class="listitem"><p>Edit <code class="filename">sp.xml</code> and
     <code class="filename">sp-extended.xml</code> to configure the entity IDs, URLs,
     and Circle of Trust names to correspond to your sample application.</p></li></ul></div></li><li class="step" title="Step 3"><p>Export the identity provider metadata from OpenAM, and copy the
   resulting <code class="filename">idp.xml</code> and
   <code class="filename">idp-extended.xml</code> metadata to the Fedlet
   <code class="filename">SampleApp\App_Data\</code> folder.</p><div class="screen"><pre class="brush: plain;">$ ssoadm
 create-metadata-templ
 --entityid "http://idp.example.com:8080/openam"
 --adminid amadmin
 --password-file /tmp/pwd.txt
 --identityprovider /idp
 --meta-data-file idp.xml
 --extended-data-file idp-extended.xml
 --idpscertalias test

Hosted entity configuration was written to idp-extended.xml.
Hosted entity descriptor was written to idp.xml.</pre></div></li><li class="step" title="Step 4"><p>Register the Fedlet with OpenAM as a remote service provider using the
   <code class="filename">sp.xml</code> and <code class="filename">sp-extended.xml</code>
   metadata.</p><div class="screen"><pre class="brush: plain;">$ ssoadm
 import-entity
 --adminid amadmin
 --password-file /tmp/pwd.txt
 --cot fedlet-cot
 --meta-data-file sp.xml
 --extended-data-file sp-extended.xml

Import file, sp.xml.
Import file, sp-extended.xml.</pre></div></li><li class="step" title="Step 5"><p>Deploy the demo application in Internet Information Server.</p><div class="note" title="Note" style="font-style: italic;"><h3 class="title">Note</h3><p>IIS must be installed with ASP.NET and additional application
    support necessary for web applications beyond static web sites. The
    additional support is not necessarily installed by default when you
    activate IIS as a Windows feature.</p></div></li><li class="step" title="Step 6"><p>Try the demo application links to run Fedlet initiated single sign
   on using HTTP POST binding and HTTP Artifact binding.</p><p>If you are using the embedded directory as a user store, you can
   authenticate to OpenAM using the <code class="literal">demo</code> user whose password
   is <code class="literal">changeit</code>.</p></li></ol></div></div><div lang="en" class="chapter" title="Chapter&nbsp;10.&nbsp;Using Secure Attribute Exchange"><div class="titlepage"><div><div><h2 class="title"><a name="chap-sae"></a>Chapter&nbsp;10.&nbsp;Using Secure Attribute Exchange</h2></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl><dt><span class="section"><a href="#sae-install-prerequisites">10.1. Installing the Samples</a></span></dt><dt><span class="section"><a href="#sae-security-prerequisites">10.2. Preparing to Secure SAE Communications</a></span></dt><dt><span class="section"><a href="#sae-secure-idp">10.3. Securing the Identity Provider Side</a></span></dt><dt><span class="section"><a href="#sae-secure-sp">10.4. Securing the Service Provider Side</a></span></dt><dt><span class="section"><a href="#sae-trying-it-out">10.5. Trying It Out</a></span></dt></dl></div><a class="indexterm" name="d2063e2366"></a><div class="important" title="Important" style="font-style: italic;"><h3 class="title">Important</h3><p>This samples mentioned in this chapter are not available in the current release.</p></div><p>Most deployments can rely on OpenAM to handle authentication and provide
 identity assertions. Not only does OpenAM support a wide variety of
 authentication scenarios out of the box, but OpenAM also makes it possible to
 add custom authentication modules. Furthermore OpenIG lets you integrate
 legacy systems into your access management deployment.</p><p>In a deployment where you need OpenAM to act as a SAML 2.0 gateway to a
 legacy application that serves as an identity provider, you can use OpenAM
 Secure Attribute Exchange (SAE). On the identity provider side, SAE lets
 OpenAM retrieve the information needed to create assertions from an external
 authentication service, bypassing OpenAM authentication and trusting the
 external service as the authoritative source of authentication. On the service
 provider side, SAE lets OpenAM securely provide attributes to an application
 that makes its own policy decision based on the attributes rather than rely on
 OpenAM for the policy decision.</p><div class="mediaobject" title="External applications use SAE to participate in federation."><a name="figure-sae"></a><img src="images/sae.png" longdesc="/Users/mark/Downloads/openam/openam-documentation/openam-doc-source/target/docbkx/html/dev-guide/figure-sae.html"><div class="longdesc-link" align="right"><br clear="all"><span class="longdesc-link">[<a href="figure-sae.html" target="longdesc">D</a>]</span></div></div><p>When you use SAE on the identity provider side, an external application
 acts as the authoritative source of authentication. After a user authenticates
 successfully, the application lets OpenAM know to create a session by sending
 a secure HTTP GET or POST to OpenAM that asserts the identity of the user.
 OpenAM processes the assertion to create a session for the user. If the user
 is already authenticated and comes back to access the application, the
 application sends a secure HTTP POST to OpenAM to assert both the user's
 identity and also any necessary attributes related to the user. OpenAM
 processes the assertion to create the session for the user and populate the
 attributes in the user's session. When the user logs out, the external
 authentication application can initiate single logout from the identity
 provider OpenAM server by sending the <code class="literal">sun.cmd=logout</code>
 attribute to OpenAM using SAE.</p><p>On the service provider side OpenAM communicates using SAML 2.0 with
 OpenAM on the identity provider side. OpenAM can use SAE to transmit
 attributes to an application through a secure HTTP POST.</p><p>SAE relies either on shared keys and symmetric encryption, or on public
 and private keys and asymmetric encryption to protect attributes communicated
 between OpenAM and external applications.</p><p>OpenAM ships with sample JSPs that demonstrate secure attribute
 exchange. In order to try the sample, you must set up an OpenAM circle of
 trust to include an identity provider and a service provider, install the SDK
 sample web application on each provider and then configure the providers
 appropriately as described in this chapter to secure communications with the
 sample SAE applications on both the identity provider and service provider
 sides.</p><div class="section" title="10.1.&nbsp;Installing the Samples"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sae-install-prerequisites"></a>10.1.&nbsp;Installing the Samples</h2></div></div></div><p>Set up an OpenAM server as an identity provider, and another as a
  service provider, connecting the two in a circle of trust called
  <code class="literal">samplesaml2cot</code>. Configure both the hosted providers and
  also the remote providers as described in <a href="../admin-guide/index.html#set-up-federation" class="link"><em class="citetitle">Setting Up SAML
  2.0 SSO</em></a>. This chapter assumes you set up the hosted
  identity provider at <code class="literal">http://idp.example.com:8080/openam</code>
  and the hosted service provider at
  <code class="literal">http://sp.example.com:8080/openam</code>. Use Common Tasks &gt;
  Test Federation Connectivity in OpenAM console to make sure Federation is
  working before you add secure attribute exchange applications that rely
  on functioning SAML 2.0 communications between the providers.</p><p>Set up the sample web application as described in <a href="../install-guide/index.html#chap-install-samples" class="link"><em class="citetitle">Installing OpenAM
  Client SDK Samples</em></a>, both on the identity provider side
  and also on the service provider side. The SAE samples are found under
  <code class="filename">/saml2/sae</code> where you installed the samples.
  <code class="filename">saeIDPApp.jsp</code> is the identity provider side external
  application. <code class="filename">saeSPApp.jsp</code> is the service provider side
  external application.</p></div><div class="section" title="10.2.&nbsp;Preparing to Secure SAE Communications"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sae-security-prerequisites"></a>10.2.&nbsp;Preparing to Secure SAE Communications</h2></div></div></div><p>In order for SAE to be secure, you must both set up a trust
  relationship between the application on the identity provider side and
  the OpenAM server acting as identity provider, and also set up a trust
  relationship between the application on the service provider side and
  the OpenAM server acting as the service provider. These trust
  relationships can be based on a shared secret and symmetric encryption,
  or on public and private key pairs and asymmetric encryption. The trust
  relationships on either side are independent. In other words you can for
  example use a shared secret on the identity provider side and
  certificates on the service provider side if you chose.</p><p>When using symmetric encryption, you must define a shared secret
  string used both for the application and the provider. The sample uses
  <code class="literal">secret12</code> as the shared secret. To simplify
  configuration, the sample uses the same shared secret, and thus
  symmetric encryption, for both trust relationships.</p><p>When using symmetric encryption, you must also use the encoded
  version of your shared secret. To get the encoded version of a shared
  secret string, use the <code class="filename">encode.jsp</code> page on the
  provider, as in
  <code class="literal">http://idp.example.com:8080/openam/encode.jsp</code> and
  <code class="literal">http://sp.example.com:8080/openam/encode.jsp</code>. An
  encoded version of <code class="literal">secret12</code> looks something like
  <code class="literal">AQICEcFhDWmb6sVmMuCJuVh43306HVacDte9</code>.</p><p>When using asymmetric encryption, you must obtain a public-private
  key pair for the application, and store the keys in a key store on the
  application side. Also store the public key from OpenAM which is acting
  as the provider in the application's key store. Make note of the
  certificate aliases for your application's private key, and for OpenAM's
  public key. Also note the path to the key store for your application,
  the key store password, and the private key password.</p></div><div class="section" title="10.3.&nbsp;Securing the Identity Provider Side"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sae-secure-idp"></a>10.3.&nbsp;Securing the Identity Provider Side</h2></div></div></div><p>This configuration uses the default sample settings with a shared
  secret of <code class="literal">secret12</code>, without encryption of the
  attributes.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Login as <code class="literal">amadmin</code> to the OpenAM server console
    where you set up the hosted identity provider (IDP).</p></li><li class="listitem"><p>As the sample includes a <code class="literal">branch</code> attribute not
    found in user profiles by default, under Access Control &gt;
    <em class="replaceable"><code>Realm Name</code></em> &gt; Authentication &gt; All Core
    Settings..., set User Profile to Ignored, and then Save your work.</p></li><li class="listitem"><div class="itemizedlist"><p>Under Federation &gt; Entity Providers, click the name for the
     Hosted IDP in order to access the IDP configuration.</p><ul class="itemizedlist" type="disc"><li class="listitem"><p>Under Assertion Processing &gt; Attribute Mapper, add both
      <code class="literal">mail=mail</code> and <code class="literal">branch=branch</code> to
      the attribute map, and then Save your work.</p></li><li class="listitem"><p>Under Advanced &gt; SAE Configuration, make sure the IDP URL
      reflects an endpoint on the IDP such as
      <code class="literal">http://idp.example.com:8080/openam/idpsaehandler/metaAlias/idp</code>,
      and then Save your work.</p></li><li class="listitem"><p>Also under Advanced &gt; SAE Configuration &gt; Application
      Security Configuration, add the URL value for the kind of encryption you
      are using, and then Save your work.</p><p>When using the defaults, the value is something like
      <code class="literal">url=http://idp.example.com:8080/samples/saml2/sae/saeIDPApp.jsp|type=symmetric|secret=<em class="replaceable"><code>encoded-secret</code></em></code>, where the OpenAM SDK sample web
      application is deployed on the IDP side with context root
      <code class="literal">/samples</code> and the
      <em class="replaceable"><code>encoded-secret</code></em> is something like
      <code class="literal">AQICEcFhDWmb6sVmMuCJuVh43306HVacDte9</code>.</p><p>If you use a different mechanism to secure the communications
      between the SAE application and the provider, read the online help in the
      console to see how to construct your URL value.</p></li></ul></div></li><li class="listitem"><div class="itemizedlist"><p>Under Federation &gt; Entity Providers, click the name for the
     Remote SP in order to access the SP configuration on the IDP side.</p><ul class="itemizedlist" type="disc"><li class="listitem"><p>Under Assertion Processing &gt; Attribute Mapper, add both
      <code class="literal">mail=mail</code> and <code class="literal">branch=branch</code> to
      the attribute map, and then Save your work.</p></li><li class="listitem"><p>Under Advanced &gt; SAE Configuration, make sure the SP URL
      reflects an endpoint on the SP such as
      <code class="literal">http://sp.example.com:8080/openam/spsaehandler/metaAlias/sp</code>,
      and then Save your work.</p></li><li class="listitem"><p>Also under Advanced &gt; SAE Configuration, add the URL to the
      sample SAE application as the SP Logout URL such as
      <code class="literal">http://sp.example.com:8080/samples/saml2/sae/saeSPApp.jsp</code>,
      and then Save your work.</p></li></ul></div></li></ol></div></div><div class="section" title="10.4.&nbsp;Securing the Service Provider Side"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sae-secure-sp"></a>10.4.&nbsp;Securing the Service Provider Side</h2></div></div></div><p>This configuration uses the default sample setting of symmetric
  encryption, with a shared secret of <code class="literal">secret12</code>.</p><div class="orderedlist"><p>Login as <code class="literal">amadmin</code> to the OpenAM server console where
   you set up the hosted service provider (SP).</p><ol class="orderedlist" type="1"><li class="listitem"><p>As the sample includes a <code class="literal">branch</code> attribute not
    found in user profiles by default, under Access Control &gt;
    <em class="replaceable"><code>Realm Name</code></em> &gt; Authentication &gt; All Core
    Settings..., set User Profile to Ignored, and then Save your work.</p></li><li class="listitem"><div class="itemizedlist"><p>Under Federation &gt; Entity Providers, click the name for the
     Hosted SP in order to access the SP configuration.</p><ul class="itemizedlist" type="disc"><li class="listitem"><p>Under Assertion Processing &gt; Attribute Mapper, add both
      <code class="literal">mail=mail</code> and <code class="literal">branch=branch</code> to
      the attribute map, and then Save your work.</p></li><li class="listitem"><p>Also under Assertion Processing &gt; Attribute Mapper &gt; Auto
      Federation, select Enabled, set the Attribute to <code class="literal">mail</code>,
      and then Save your work.</p></li><li class="listitem"><p>Under Advanced &gt; SAE Configuration, make sure the SP URL
      reflects an endpoint on the SP such as
      <code class="literal">http://sp.example.com:8080/openam/spsaehandler/metaAlias/sp</code>,
      and then Save your work.</p></li><li class="listitem"><p>Furthermore, under Advanced &gt; SAE Configuration, add the URL to
      the sample SAE application as the SP Logout URL such as
      <code class="literal">http://sp.example.com:8080/samples/saml2/sae/saeSPApp.jsp</code>,
      and then Save your work.</p></li><li class="listitem"><p>Also under Advanced &gt; SAE Configuration &gt; Application Security
      Configuration, add the URL value for the kind of encryption you are using,
      and then Save your work.</p><p>When using the defaults, the value is something like
      <code class="literal">url=http://sp.example.com:8080/samples/saml2/sae/saeSPApp.jsp|type=symmetric|secret=<em class="replaceable"><code>encoded-secret</code></em></code>, where the OpenAM SDK sample web
      application is deployed on the IDP side with context root
      <code class="literal">/samples</code> and the
      <em class="replaceable"><code>encoded-secret</code></em> is something like
      <code class="literal">AQICkX24RbZboAVgr2FG1kWoqRv1zM2a6KEH</code>.</p><p>If you use a different mechanism to secure the communications
      between the SAE application and the provider, read the online help in the
      console to see how to construct your URL value.</p></li></ul></div></li></ol></div></div><div class="section" title="10.5.&nbsp;Trying It Out"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sae-trying-it-out"></a>10.5.&nbsp;Trying It Out</h2></div></div></div><p>After completing the setup described above, navigate to the IDP side
  SAE application, for example at
  <code class="literal">http://idp.example.com:8080/samples/saml2/sae/saeIDPApp.jsp</code>.</p><div class="variablelist"><p>Make sure you set at least the "SP App URL" and "SAE URL on IDP end"
   to fit your configuration. For example if you used the settings above then
   use the following values.</p><dl><dt><span class="term">SP App URL</span></dt><dd><p><code class="literal">http://sp.example.com:8080/samples/saml2/sae/saeSPApp.jsp</code></p></dd><dt><span class="term">SAE URL on IDP end</span></dt><dd><p><code class="literal">http://idp.example.com:8080/openam/idpsaehandler/metaAlias/idp</code></p></dd></dl></div><p>Check the settings, and then click Generate URL to open the Secure
  Attributes Exchange IDP APP SAMPLE page.</p><p>Click the <code class="literal">ssourl</code> link in the page to start the
  exchange.</p><p>The resulting web page shows the attributes exchanged, including the
  mail and branch values used. The text of that page is something like the
  following.</p><pre class="brush: plain;">SAE SP APP SAMPLE

Secure Attrs :
mail            testuser@foo.com
sun.idpentityid http://idp.example.com:8080/openam
sun.spentityid  http://sp.example.com:8080/openam
branch          mainbranch
sun.authlevel   0</pre></div></div><div lang="en" class="chapter" title="Chapter&nbsp;11.&nbsp;Using the OpenAM C API"><div class="titlepage"><div><div><h2 class="title"><a name="chap-csdk"></a>Chapter&nbsp;11.&nbsp;Using the OpenAM C API</h2></div></div></div><a class="indexterm" name="d2063e2662"></a><div class="important" title="Important" style="font-style: italic;"><h3 class="title">Important</h3><p>This samples mentioned in this chapter are not available in the current release.</p></div><p>This chapter introduces OpenAM C SDK. OpenAM C SDK is delivered for
 selected platforms in
 <code class="filename">libraries/native/agent-csdk/agent-csdk.zip</code> where you
 unpacked the full version of OpenAM. To prepare to install OpenAM C SDK, first
 unzip <code class="filename">agent-csdk.zip</code>.</p><div class="screen"><pre class="brush: plain;">$ unzip ~/Downloads/opensso/libraries/native/agent-csdk/agent-csdk.zip
Archive:  ~/Downloads/opensso/libraries/native/agent-csdk/agent-csdk.zip
  inflating: README
  inflating: agent-csdk-linux-32.tar.gz
  inflating: agent-csdk-linux-64.tar.gz
  inflating: agent-csdk-solaris-sparc-32.tar.gz
  inflating: agent-csdk-solaris-sparc-64.tar.gz
  inflating: agent-csdk-solaris-x86-32.tar.gz
  inflating: agent-csdk-solaris-x86-64.tar.gz
 extracting: agent-csdk-windows-32.zip
 extracting: agent-csdk-windows-64.zip</pre></div><p>Unpack the archive for your platform.</p><div class="screen"><pre class="brush: plain;">$ mkdir -p /path/to/openam-client ; cd /path/to/openam-client
$ tar xzvf /path/to/agent-csdk-linux-32.tar.gz</pre></div><div class="variablelist"><p>As a result, you have several directories that include the SDK and also
  sample client applications.</p><dl><dt><span class="term"><code class="filename">bin/</code></span></dt><dd><p>The <span class="command"><strong>crypt_util</strong></span> or <span class="command"><strong>cryptit.exe</strong></span>
    command for encrypting passwords</p></dd><dt><span class="term"><code class="filename">config/</code></span></dt><dd><p>Configuration data for the SDK</p></dd><dt><span class="term"><code class="filename">include/</code></span></dt><dd><p>Header files for the SDK</p></dd><dt><span class="term"><code class="filename">lib/</code></span></dt><dd><p>SDK and other required libraries</p></dd><dt><span class="term"><code class="filename">samples/</code></span></dt><dd><p>Sample code</p></dd></dl></div><div class="procedure" title="Procedure&nbsp;11.1.&nbsp;To Build OpenAM C SDK Samples"><a name="build-openam-csdk-client"></a><div class="procedure-title">Procedure&nbsp;11.1.&nbsp;To Build OpenAM C SDK Samples</div><ol class="procedure" type="1"><li class="step" title="Step 1"><p>Review the <code class="filename">samples/README.TXT</code> file to complete
   any specific instructions required for your platform.</p><div class="screen"><pre class="brush: plain;">$ uname -s
Linux
$ cd ../lib
$ ln -s libamsdk.so.3 libamsdk.so
$ ln -s libxml2.so.2 libxml2.so
$ cd ../samples</pre></div></li><li class="step" title="Step 2"><p>Build the samples in the appropriate way for your platform.</p><div class="screen"><pre class="brush: plain;">$ LD_LIBRARY_PATH=../lib gmake</pre></div><p>On recent systems, you might need to install compatibility libraries
   for the build to complete successfully. You might make the following change
   on Linux, for example.</p><div class="screen"><pre class="brush: plain;">$ diff Makefile Makefile.orig 
115c115
&lt; LDFLAGS = -L$(AM_LIB_DIR) $(LIBS) /usr/lib/libstdc++.so.5
---
&gt; LDFLAGS = -L$(AM_LIB_DIR) $(LIBS)</pre></div></li><li class="step" title="Step 3"><p>Set up <code class="filename">OpenSSOAgentBootstrap.properties</code>
   and <code class="filename">OpenSSOAgentConfiguration.properties</code> as appropriate
   for your environment.</p><p>Base your work on the template files in the
   <code class="filename">config/</code> directory. You can find the Password Encryption
   Key in the OpenAM console under Configuration &gt; Servers and Sites &gt;
   <em class="replaceable"><code>Server Name</code></em> &gt; Security.</p></li><li class="step" title="Step 4"><p>Try one of the samples you built to test your build.</p><div class="screen"><pre class="brush: plain;">$ LD_LIBRARY_PATH=../lib
 ./am_auth_test
 -f ../config/OpenSSOAgentBootstrap.properties
 -u demo
 -p changeit
 -o /
   Login  1 Succeeded!
      SSOToken = AQIC5wM2LY4SfcxZfk4EzC9Y46P9cXG9ogwf2ixnYOeZ0K0.*AAJTSQACMDE.*
      Organization = /
      Module Instance Name [0] = SAE
      Module Instance Name [1] = LDAP
      Module Instance Name [2] = WSSAuthModule
      Module Instance Name [3] = Federation
      Module Instance Name [4] = HOTP
      Module Instance Name [5] = DataStore
   Logout 1 Succeeded!</pre></div></li></ol></div></div><div lang="en" class="chapter" title="Chapter&nbsp;12.&nbsp;Extending OpenAM"><div class="titlepage"><div><div><h2 class="title"><a name="chap-extending"></a>Chapter&nbsp;12.&nbsp;Extending OpenAM</h2></div></div></div><p>OpenAM services solve a wide range of access and federation
 management problems out of the box. Yet, OpenAM also exposes APIs and
 SPIs that enable you extend OpenAM services when built-in functionality
 does not fit your deployment.</p><p>This part of the guide covers OpenAM mechanisms for plugging in
 additional functionality not available out of the box.</p></div><div lang="en" class="chapter" title="Chapter&nbsp;13.&nbsp;Customizing Profile Attributes"><div class="titlepage"><div><div><h2 class="title"><a name="chap-custom-attr"></a>Chapter&nbsp;13.&nbsp;Customizing Profile Attributes</h2></div></div></div><a class="indexterm" name="d2063e2782"></a><p>You can extend user profiles by adding custom attributes. This chapter
 demonstrates how to add a custom attribute to a user profile when storing
 user profiles in the embedded LDAP directory.</p><p>Adding a custom attribute involves both updating the
 <code class="literal">iPlanetAMUserService</code>, and also updating the identity
 repository schema to hold the new attribute. Furthermore, to allow users
 to update the attribute in their own profiles, you must also update the
 OpenAM policy configuration stored in the configuration directory.</p><div class="procedure" title="Procedure&nbsp;13.1.&nbsp;To Update the AMUser Service For the New Attribute"><a name="add-attr-to-service-description"></a><div class="procedure-title">Procedure&nbsp;13.1.&nbsp;To Update the AMUser Service For the New Attribute</div><p>Follow the steps below to create a custom attribute in OpenAM.</p><ol class="procedure" type="1"><li class="step" title="Step 1"><p>Create a backup copy of the configuration file for the
   <code class="literal">iPlanetAmUserService</code>.</p><div class="screen"><pre class="brush: plain;">$ cd $HOME
$ cp openam/config/xml/amUser.xml openam/config/xml/amUser.xml.orig</pre></div></li><li class="step" title="Step 2"><p>Edit the file to add your attribute as one of the list of
   <code class="literal">&lt;User&gt;</code> attributes.</p><pre class="brush: xml;">&lt;AttributeSchema name="customAttribute"
    type="single"
    syntax="string"
    any="display"
    i18nKey="Custom Attribute"&gt;
&lt;/AttributeSchema&gt;</pre><p>Here, the name refers to the attribute type name used in LDAP. The
   <code class="literal">i18nKey</code> holds either the reference, or in this case the
   content, of the text that appears in the user interface.</p></li><li class="step" title="Step 3"><p>Delete <code class="literal">iPlanetAMUserService</code>, and then create it
   from your updated configuration file.</p><div class="screen"><pre class="brush: plain;">$ cd /path/to/tools/openam/bin/
$ ssoadm
 delete-svc
 --adminid amadmin
 --password-file /tmp/pwd.txt
 --servicename iPlanetAMUserService

Service was deleted.
$ ssoadm
 create-svc
 --adminid amadmin
 --password-file /tmp/pwd.txt
 --xmlfile $HOME/openam/config/xml/amUser.xml

Service was added.</pre></div></li></ol></div><div class="procedure" title="Procedure&nbsp;13.2.&nbsp;To Update the Identity Repository For the New Attribute"><a name="add-attr-to-identity-repository"></a><div class="procedure-title">Procedure&nbsp;13.2.&nbsp;To Update the Identity Repository For the New Attribute</div><p>Follow the steps below to update the identity repository LDAP schema
  for the custom attribute, and then update OpenAM to use the custom attribute
  and object class.</p><div class="tip" title="Tip" style="font-style: italic;"><h3 class="title">Tip</h3><p>If you are using OpenDJ as the identity repository, you can update the
   schema through OpenDJ Control Panel &gt; Schema &gt; Manage Schema, as
   described in the <a class="link" href="http://opendj.forgerock.org/doc/admin-guide/index.html#update-schema" target="_blank">OpenDJ documentation</a>.</p></div><ol class="procedure" type="1"><li class="step" title="Step 1"><p>Prepare the attribute type object class definitions in LDIF
   format.</p><div class="screen"><pre class="brush: plain;">$ cat custom-attr.ldif 
dn: cn=schema
changetype: modify
add: attributeTypes
attributeTypes: ( temp-custom-attr-oid NAME 'customAttribute' EQUALITY case
 IgnoreMatch ORDERING caseIgnoreOrderingMatch SUBSTR caseIgnoreSubstrings
 Match SYNTAX 1.3.6.1.4.1.1466.115.121.1.15 USAGE userApplications )
-
add: objectClasses
objectClasses: ( temp-custom-oc-oid NAME 'customObjectclass' SUP top AUX
 ILIARY MAY customAttribute )
</pre></div></li><li class="step" title="Step 2"><p>Add the schema definitions to the directory.</p><div class="screen"><pre class="brush: plain;">$ /path/to/OpenDJ/bin/ldapmodify
 --port 1389
 --hostname openam.example.com
 --bindDN "cn=Directory Manager"
 --bindPassword password
 --filename custom-attr.ldif
Processing MODIFY request for cn=schema
MODIFY operation successful for DN cn=schema</pre></div></li><li class="step" title="Step 3"><p>In OpenAM console, browse to Access Control &gt; <em class="replaceable"><code>Realm
   Name</code></em> &gt; Data Stores &gt; <em class="replaceable"><code>Data Store
   Name</code></em>.</p></li><li class="step" title="Step 4"><p>Add the object class, here <code class="literal">customObjectclass</code>, to
   the LDAP User Object Class list.</p></li><li class="step" title="Step 5"><p>Add the attribute type, here <code class="literal">customAttribute</code>, to
   the LDAP User Attributes list.</p></li><li class="step" title="Step 6"><p>Save your work.</p></li></ol></div><div class="procedure" title="Procedure&nbsp;13.3.&nbsp;To Allow Users To Update the New Attribute"><a name="allow-users-to-update-attr"></a><div class="procedure-title">Procedure&nbsp;13.3.&nbsp;To Allow Users To Update the New Attribute</div><p>Follow these steps to make the new attribute editable by users. The
  steps imply use of the embedded configuration directory. If you use a
  different directory server to store the configuration, then adapt them for
  your tools.</p><ol class="procedure" type="1"><li class="step" title="Step 1"><p>Login to the control panel for the embedded configuration
   directory.</p><div class="screen"><pre class="brush: plain;">$ ./openam/opends/bin/control-panel &amp;</pre></div><p>Connect using bind DN <code class="literal">cn=Directory Manager</code> and the
   the password for <code class="literal">amadmin</code>.</p></li><li class="step" title="Step 2"><p>Select Manage Entries to open the LDAP browser.</p></li><li class="step" title="Step 3"><p>Search with <code class="literal">LDAP Filter:</code> set to
   <code class="literal">ou=SelfWriteAttributes</code>, and then expand the tree views
   to see the two entries found.</p></li><li class="step" title="Step 4"><p>In the entry under <code class="literal">iPlanetAMPolicyService</code>, edit
   the <code class="literal">sunKeyValue</code> attribute to add your custom attribute to
   the list of self-writable attributes, as in
   <code class="literal">&lt;Value&gt;customAttribute&lt;/Value&gt;</code>.</p></li><li class="step" title="Step 5"><p>In the entry under <code class="literal">sunEntitlementIndexes</code>, edit
   the <code class="literal">sunKeyValue</code> attribute to add your custom attribute to
   the list of self-writable attributes, as in replacing the last
   <code class="literal">\n</code> in the list with <code class="literal">,\n
   \"customAttribute\"\n</code>.</p></li><li class="step" title="Step 6"><p>Restart OpenAM or the web container where it runs.</p><div class="screen"><pre class="brush: plain;">$ /etc/init.d/tomcat stop
$ /etc/init.d/tomcat start</pre></div></li><li class="step" title="Step 7"><p>Login to OpenAM console as a user to check that a user can save a
   value for your new, custom attribute.</p><div class="mediaobject" title="Saving Babs Jensen's profile with a custom attribute"><a name="figure-bjensen-with-custom-attribute"></a><img src="images/bjensen-with-custom-attribute.png" longdesc="/Users/mark/Downloads/openam/openam-documentation/openam-doc-source/target/docbkx/html/dev-guide/figure-bjensen-with-custom-attribute.html"><div class="longdesc-link" align="right"><br clear="all"><span class="longdesc-link">[<a href="figure-bjensen-with-custom-attribute.html" target="longdesc">D</a>]</span></div></div></li></ol></div></div><div lang="en" class="chapter" title="Chapter&nbsp;14.&nbsp;Customizing OAuth 2.0 Scope Handling"><div class="titlepage"><div><div><h2 class="title"><a name="chap-oauth2-scopes"></a>Chapter&nbsp;14.&nbsp;Customizing OAuth 2.0 Scope Handling</h2></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl><dt><span class="section"><a href="#design-oauth2-scopes-plugin">14.1. Designing an OAuth 2.0 Scopes Plugin</a></span></dt><dt><span class="section"><a href="#build-oauth2-scopes-plugin">14.2. Building an OAuth 2.0 Scopes Plugin</a></span></dt><dt><span class="section"><a href="#configure-oauth2-scopes-plugin">14.3. Configuring OpenAM to Use the Plugin</a></span></dt><dt><span class="section"><a href="#try-oauth2-scopes-plugin">14.4. Trying the Example Plugin</a></span></dt></dl></div><a class="indexterm" name="d2063e2950"></a><p>RFC 6749, <a class="link" href="http://tools.ietf.org/html/rfc6749" target="_blank"><em class="citetitle">The OAuth 2.0 Authorization Framework</em></a>,
 describes access token scopes as a set of case-sensitive strings defined by
 the authorization server. Clients can request scopes, and resource owners can
 authorize them.</p><p>The default scopes implementation in OpenAM treats scopes as profile
 attributes for the resource owner. When a resource server or other entity uses
 the access token to get token information from OpenAM, OpenAM populates the
 scopes with profile attribute values. For example, if one of the scopes
 is <code class="literal">mail</code>, OpenAM sets <code class="literal">mail</code> to the
 resource owner's email address in the token information returned.</p><p>You can change this behavior by writing your own scopes plugin. This
 chapter shows how to write a custom OAuth 2.0 scopes plugin for use in an
 OAuth 2.0 provider (authorization server) configuration.</p><div class="section" title="14.1.&nbsp;Designing an OAuth 2.0 Scopes Plugin"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="design-oauth2-scopes-plugin"></a>14.1.&nbsp;Designing an OAuth 2.0 Scopes Plugin</h2></div></div></div><p>A scopes plugin implements the
  <code class="literal">org.forgerock.openam.oauth2.provider.Scope</code> interface. The
  <code class="literal">Scope</code> interface has four methods that your plugin
  overrides.</p><pre class="brush: java;">public Set&lt;String&gt; scopeToPresentOnAuthorizationPage(
        Set&lt;String&gt; requestedScope,
        Set&lt;String&gt; availableScopes,
        Set&lt;String&gt; defaultScopes);

public Set&lt;String&gt; scopeRequestedForAccessToken(
        Set&lt;String&gt; requestedScope,
        Set&lt;String&gt; availableScopes,
        Set&lt;String&gt; defaultScopes);

public Set&lt;String&gt; scopeRequestedForRefreshToken(
        Set&lt;String&gt; requestedScope,
        Set&lt;String&gt; availableScopes,
        Set&lt;String&gt; allScopes,
        Set&lt;String&gt; defaultScopes);

public Map&lt;String, Object&gt; evaluateScope(AccessToken token);</pre><p>The first three methods return the scopes to display when the resource
  owner makes the authorization decision, or when an access token or refresh
  token is granted, respectively. The fourth method,
  <code class="literal">evaluateScope</code> can be used to set values for scopes
  returned when token information is requested.</p><p>The following example plugin sets whether <code class="literal">read</code> and
  <code class="literal">write</code> permissions were granted.</p><pre class="brush: java;">package org.forgerock.openam.examples;

import java.util.HashMap;
import java.util.HashSet;
import java.util.Map;
import java.util.Set;

import org.forgerock.openam.oauth2.model.AccessToken;
import org.forgerock.openam.oauth2.provider.Scope;

/**
 * Custom scope providers implement the
 * {@link org.forgerock.openam.oauth2.provider.Scope} interface.
 *
 * This custom scope implementation follows the OpenAM default scope
 * implementation for all methods except {@link #evaluateScope}.
 *
 * The {@code evaluateScope} method is called when a client accesses
 * the {@code /tokeninfo} endpoint to retrieve token information.
 *
 * In this example, the method populates scope values returned in the
 * JSON with the token information.
 */
public class CustomScope implements Scope {

    @Override
    public Set&lt;String&gt; scopeToPresentOnAuthorizationPage(
            Set&lt;String&gt; requestedScope,
            Set&lt;String&gt; availableScopes,
            Set&lt;String&gt; defaultScopes) {

        if (requestedScope == null) {
            return defaultScopes;
        }

        Set&lt;String&gt; scopes = new HashSet&lt;String&gt;(availableScopes);
        scopes.retainAll(requestedScope);
        return scopes;
    }

    @Override
    public Set&lt;String&gt; scopeRequestedForAccessToken(
            Set&lt;String&gt; requestedScope,
            Set&lt;String&gt; availableScopes,
            Set&lt;String&gt; defaultScopes) {

        if (requestedScope == null){
            return defaultScopes;
        }

        Set&lt;String&gt; scopes = new HashSet&lt;String&gt;(availableScopes);
        scopes.retainAll(requestedScope);
        return scopes;
    }

    @Override
    public Set&lt;String&gt; scopeRequestedForRefreshToken(
            Set&lt;String&gt; requestedScope,
            Set&lt;String&gt; availableScopes,
            Set&lt;String&gt; allScopes,
            Set&lt;String&gt; defaultScopes) {

        if (requestedScope == null){
            return defaultScopes;
        }

        Set&lt;String&gt; scopes = new HashSet&lt;String&gt;(availableScopes);
        scopes.retainAll(requestedScope);
        return scopes;
    }

    @Override
    public Map&lt;String, Object&gt; evaluateScope(AccessToken token) {
        Set&lt;String&gt; scopes = token.getScope();

        Map&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;();
        String[] permissions = {"read", "write"};

        for (String scope : permissions) {
            if (scopes.contains(scope)) {
               map.put(scope, true);
            } else {
                map.put(scope, false);
            }
        }

        return map;
    }
}</pre></div><div class="section" title="14.2.&nbsp;Building an OAuth 2.0 Scopes Plugin"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="build-oauth2-scopes-plugin"></a>14.2.&nbsp;Building an OAuth 2.0 Scopes Plugin</h2></div></div></div><p>As the plugin imports at least
  <code class="literal">org.forgerock.openam.oauth2.model.AccessToken</code>
  and <code class="literal">org.forgerock.openam.oauth2.provider.Scope</code>, add
  <code class="filename">openam-oauth2-common-10.1.0-Xpress.jar</code> to
  the classpath.</p><p>After compiling, put it in a .jar file that you can deploy with
  OpenAM.</p><div class="screen"><pre class="brush: plain;">$ mkdir classes
$ javac -d classes
 -cp /path/to/.../openam/WEB-INF/lib/openam-oauth2-common-10.1.0-Xpress.jar
 CustomScope.java
$ cd classes/
$ jar cf ../CustomScope.jar</pre></div></div><div class="section" title="14.3.&nbsp;Configuring OpenAM to Use the Plugin"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="configure-oauth2-scopes-plugin"></a>14.3.&nbsp;Configuring OpenAM to Use the Plugin</h2></div></div></div><p>After building your plugin jar file, add the file under
  <code class="filename">WEB-INF/lib/</code> where you deployed OpenAM.</p><p>Restart OpenAM.</p><p>In OpenAM console, you can either configure a specific OAuth 2.0
  provider to use your plugin, or configure your plugin as the default for new
  OAuth 2.0 providers. To configure a specific OAuth 2.0 provider to use your
  plugin, add the class name of your scopes plugin under Access Control &gt;
  <em class="replaceable"><code>Realm Name</code></em> &gt; Services &gt; <em class="replaceable"><code>OAuth2
  Provider Name</code></em> &gt; Scope Implementation Class. To configure your
  plugin as the default for new providers, add the class name of your scopes
  plugin under Configuration &gt; Global &gt; OAuth2 Provider &gt; Scope
  Implementation Class.</p></div><div class="section" title="14.4.&nbsp;Trying the Example Plugin"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="try-oauth2-scopes-plugin"></a>14.4.&nbsp;Trying the Example Plugin</h2></div></div></div><p>If you build the example plugin shown above in
  <a class="xref" href="#design-oauth2-scopes-plugin" title="14.1.&nbsp;Designing an OAuth 2.0 Scopes Plugin">Section&nbsp;14.1, &#8220;Designing an OAuth 2.0 Scopes Plugin&#8221;</a>, and then create an OAuth 2.0
  client that takes scopes <code class="literal">read</code> and <code class="literal">write</code>,
  you can configure OpenAM to use the plugin, and then try it as shown in the
  following example.</p><div class="screen"><pre class="brush: plain;">$ curl
 -d "grant_type=client_credentials&amp;username=demo&amp;password=changeit
 &amp;client_id=myClientID&amp;client_secret=password&amp;scope=read"
 http://oauth2.example.com:8080/openam/oauth2/access_token
{
  "expires_in": 599,
  "token_type": "Bearer",
  "access_token": "84122d5e-0462-4d81-93c3-7bc58bd416b3"
}
$ curl http://oauth2.example.com:8080/openam/oauth2/tokeninfo
 ?access_token=84122d5e-0462-4d81-93c3-7bc58bd416b3
{
  "write": false,
  "read": true,
  "token_type": "Bearer",
  "expires_in": 539,
  "access_token": "84122d5e-0462-4d81-93c3-7bc58bd416b3"
}</pre></div></div></div><div lang="en" class="chapter" title="Chapter&nbsp;15.&nbsp;Customizing Authentication Modules"><div class="titlepage"><div><div><h2 class="title"><a name="chap-auth-spi"></a>Chapter&nbsp;15.&nbsp;Customizing Authentication Modules</h2></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl><dt><span class="section"><a href="#about-custom-auth-module">15.1. About the Sample Authentication Module</a></span></dt><dt><span class="section"><a href="#callbacks-file-sample-auth-module">15.2. The Sample Auth Callbacks</a></span></dt><dt><span class="section"><a href="#authentication-logic-sample-auth-module">15.3. The Sample Authentication Logic</a></span></dt><dt><span class="section"><a href="#principal-sample-auth-module">15.4. The Sample Auth Principal</a></span></dt><dt><span class="section"><a href="#service-conf-sample-auth-module">15.5. The Sample Auth Service Configuration</a></span></dt><dt><span class="section"><a href="#properties-sample-auth-module">15.6. The Sample Auth Properties</a></span></dt><dt><span class="section"><a href="#build-config-sample-auth-module">15.7. Building &amp; Installing the Sample Auth Module</a></span></dt><dt><span class="section"><a href="#configuring-testing-sample-auth-module">15.8. Configuring &amp; Testing the Sample Auth Module</a></span></dt></dl></div><a class="indexterm" name="d2063e3052"></a><p>This chapter shows how to customize authentication with a sample custom
 authentication module. For deployments with particular requirements not met by
 existing OpenAM authentication modules, determine whether you can adapt one of
 the built-in or extension modules for your needs. If not, build the
 functionality into a custom authentication module.</p><div class="section" title="15.1.&nbsp;About the Sample Authentication Module"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="about-custom-auth-module"></a>15.1.&nbsp;About the Sample Authentication Module</h2></div></div></div><p>The sample authentication module prompts for a user name and password
  to authenticate the user, and handles error conditions. The sample shows how
  you integrate an authentication module into OpenAM such that you can
  configure the module through OpenAM console, and also localize the user
  interface.</p><p>The name for the sample authentication module is
  <code class="literal">SampleAuth</code>. Notice how this name is used to form module
  component names according to OpenAM conventions.</p><p>An OpenAM authentication module is comprised of five components.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>The authentication logic, which is a class that extends the
    <code class="literal">com.sun.identity.authentication.spi.AMLoginModule</code>
    class. In this case, <code class="filename">SampleAuth.java</code>.</p></li><li class="listitem"><p>The principal, which is a class that implements the
    <code class="literal">java.security.Principal</code> interface. In this case,
    <code class="filename">SampleAuthPrincipal.java</code>.</p></li><li class="listitem"><p>The callbacks XML file, which describes the states of authentication
    logic and the user input needed for each state. In this case there is one
    file, <code class="filename">SampleAuth.xml</code>.</p></li><li class="listitem"><p>The service configuration XML file, which defines how the
    authentication module is configured in OpenAM. In this case,
    <code class="filename">amAuthSampleAuth.xml</code>.</p></li><li class="listitem"><p>The properties files for the module, which map localized strings
    to identifiers used elsewhere in the module. In this case,
    <code class="filename">amAuthSampleAuth.properties</code>.</p></li></ul></div></div><div class="section" title="15.2.&nbsp;The Sample Auth Callbacks"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="callbacks-file-sample-auth-module"></a>15.2.&nbsp;The Sample Auth Callbacks</h2></div></div></div><p>OpenAM callbacks XML files prompt the user for identity information
  needed to process the authentication. The document type for a callback XML
  file is described in
  <code class="filename"><em class="replaceable"><code>war-file-name</code></em>/WEB-INF/Auth_Module_Properties.dtd</code>.</p><div class="tip" title="Tip" style="font-style: italic;"><h3 class="title">Tip</h3><p>Callback files for built-in modules are under
   <code class="filename"><em class="replaceable"><code>war-file-name</code></em>/config/auth/default/</code>;
   extension modules are stored in the OpenAM source tree.</p></div><div class="example"><a name="simplified-callbacks-file"></a><div class="example-title">Example&nbsp;15.1.&nbsp;Simplified Callbacks File</div><div class="example-contents"><p>This example shows a simplified sample auth callbacks XML file that
   does no error handling. The file specifies only one state (order="1"), and
   prompts the user for two pieces of information: user name and password. All
   strings for the user interface are hard coded into the file.</p><pre class="brush: xml;">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE ModuleProperties PUBLIC
 "=//iPlanet//Authentication Module Properties XML Interface 1.0 DTD//EN"
        "jar://com/sun/identity/authentication/Auth_Module_Properties.dtd"&gt;

&lt;ModuleProperties moduleName="SampleAuth" version="1.0" &gt;
    &lt;Callbacks length="2" order="1" timeout="600" header="Please Login" &gt;
        &lt;NameCallback isRequired="true"&gt;
            &lt;Prompt&gt; User Name: &lt;/Prompt&gt;
        &lt;/NameCallback&gt;
        &lt;PasswordCallback echoPassword="false" &gt;
            &lt;Prompt&gt; Password: &lt;/Prompt&gt;
        &lt;/PasswordCallback&gt;
    &lt;/Callbacks&gt;
&lt;/ModuleProperties&gt;</pre></div></div><br class="example-break"><div class="example"><a name="full-callbacks-file"></a><div class="example-title">Example&nbsp;15.2.&nbsp;Full Callbacks File</div><div class="example-contents"><p>This example shows a full callbacks file with dynamic text and error
   handling. Use this as your <code class="filename">SimpleAuth.xml</code> file.</p><pre class="brush: xml;">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE ModuleProperties PUBLIC
 "=//iPlanet//Authentication Module Properties XML Interface 1.0 DTD//EN"
        "jar://com/sun/identity/authentication/Auth_Module_Properties.dtd"&gt;

&lt;ModuleProperties moduleName="SampleAuth" version="1.0" &gt;
    &lt;Callbacks length="0" order="1" timeout="600" header="#NOT SHOWN#" /&gt;
    &lt;Callbacks length="2" order="2" timeout="600" header="#TO BE SUBSTITUTED#"&gt;
        &lt;NameCallback isRequired="true"&gt;
            &lt;Prompt&gt;#USERNAME#&lt;/Prompt&gt;
        &lt;/NameCallback&gt;
        &lt;PasswordCallback echoPassword="false" &gt;
            &lt;Prompt&gt;#PASSWORD#&lt;/Prompt&gt;
        &lt;/PasswordCallback&gt;
    &lt;/Callbacks&gt;
    &lt;Callbacks length="1" order="3" timeout="600" header="#TO BE SUBSTITUTED#"
        error="true" &gt;
        &lt;NameCallback&gt;
            &lt;Prompt&gt;#THE DUMMY WILL NEVER BE SHOWN#&lt;/Prompt&gt;
        &lt;/NameCallback&gt;
    &lt;/Callbacks&gt;
&lt;/ModuleProperties&gt;</pre><div class="orderedlist"><p>This file specifies three states.</p><ol class="orderedlist" type="1"><li class="listitem"><p>The initial state (order="1") is used dynamically to replace the
     dummy strings shown between hashes (for example,
     <code class="literal">#USERNAME#</code>) by the
     <code class="literal">substituteUIStrings()</code> method in
     <code class="filename">SampleAuth.java</code>.</p></li><li class="listitem"><p>The next state (order="2") handles prompting the user for
     authentication information.</p></li><li class="listitem"><p>The last state (order="3") has the attribute
     <code class="literal">error="true"</code>. If the authentication module state
     machine reaches this order then the authentication has failed. The
     <code class="literal">NameCallback</code> is not used and not displayed to user.
     OpenAM requires that the callbacks array have at least one element.
     Otherwise OpenAM does not permit header substitution.</p></li></ol></div></div></div><br class="example-break"></div><div class="section" title="15.3.&nbsp;The Sample Authentication Logic"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="authentication-logic-sample-auth-module"></a>15.3.&nbsp;The Sample Authentication Logic</h2></div></div></div><p>An OpenAM authentication module must extend the
  <code class="literal">com.sun.identity.authentication.spi.AMLoginModule</code> abstract
  class, and must implement the methods shown below.</p><p>See the <a class="link" href="http://openam.forgerock.org/apidocs/index.html" target="_top"><em class="citetitle">OpenAM Java SDK API Specification</em></a> for
  reference.</p><pre class="brush: java;">
// OpenAM calls the init() method once when the module is created.
public void init(Subject subject, Map sharedState, Map options)

// OpenAM calls the process() method when the user submits authentication
// information. The process() method determines what happens next:
// success, failure, or the next state specified by the order
// attribute in the callbacks XML file.
public int process(Callback[] callbacks, int state) throws LoginException

// OpenAM expects the getPrincipal() method to return an implementation of
// the java.security.Principal interface.
public Principal getPrincipal()</pre><p>OpenAM does not reuse authentication module instances. This means that
  you can store information specific to the authentication process in the
  instance.</p><p>The implementation, <code class="filename">SimpleAuth.java</code>, is shown
  below.</p><pre class="brush: java;">/**
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS HEADER.
 *
 * Copyright (c) 2011 ForgeRock AS. All Rights Reserved
 *
 * The contents of this file are subject to the terms
 * of the Common Development and Distribution License
 * (the License). You may not use this file except in
 * compliance with the License.
 *
 * You can obtain a copy of the License at
 * http://forgerock.org/license/CDDLv1.0.html
 * See the License for the specific language governing
 * permission and limitations under the License.
 *
 * When distributing Covered Code, include this CDDL
 * Header Notice in each file and include the License file
 * at http://forgerock.org/license/CDDLv1.0.html
 * If applicable, add the following below the CDDL Header,
 * with the fields enclosed by brackets [] replaced by
 * your own identifying information:
 * "Portions Copyrighted [year] [name of copyright owner]"
 *
 */

package com.forgerock.openam.examples;

import java.security.Principal;
import java.util.Map;
import java.util.ResourceBundle;

import javax.security.auth.Subject;
import javax.security.auth.callback.Callback;
import javax.security.auth.callback.NameCallback;
import javax.security.auth.callback.PasswordCallback;
import javax.security.auth.login.LoginException;

import com.sun.identity.authentication.spi.AMLoginModule;
import com.sun.identity.authentication.spi.AuthLoginException;
import com.sun.identity.authentication.spi.InvalidPasswordException;
import com.sun.identity.authentication.util.ISAuthConstants;
import com.sun.identity.shared.datastruct.CollectionHelper;
import com.sun.identity.shared.debug.Debug;



public class SampleAuth extends AMLoginModule
{

  // Name for the debug-log
  private final static String DEBUG_NAME = "SampleAuth";

  // Name of the resource bundle
  private final static String amAuthSampleAuth = "amAuthSampleAuth";

  // User names for authentication logic
  private final static String USERNAME = "test";
  private final static String ERROR_1_NAME = "test1";
  private final static String ERROR_2_NAME = "test2";

  // Orders defined in the callbacks file
  private final static int STATE_BEGIN = 1;
  private final static int STATE_AUTH = 2;
  private final static int STATE_ERROR = 3;

  private final static Debug debug = Debug.getInstance(DEBUG_NAME);

  private Map options;
  private ResourceBundle bundle;



  public SampleAuth()
  {
    super();
  }



  @Override
  // This method stores service attributes and localized properties
  // for later use.
  public void init(Subject subject, Map sharedState, Map options)
  {
    if (debug.messageEnabled())
    {
      debug.message("SampleAuth::init");
    }
    this.options = options;
    bundle = amCache.getResBundle(amAuthSampleAuth, getLoginLocale());
  }



  @Override
  public int process(Callback[] callbacks, int state) throws LoginException
  {

    if (debug.messageEnabled())
    {
      debug.message("SampleAuth::process state: " + state);
    }

    switch (state)
    {

    case STATE_BEGIN:
      // No time wasted here - simply modify the UI and
      // proceed to next state
      substituteUIStrings();
      return STATE_AUTH;

    case STATE_AUTH:
      // Get data from callbacks. Refer to callbacks XML file.
      NameCallback nc = (NameCallback) callbacks[0];
      PasswordCallback pc = (PasswordCallback) callbacks[1];
      String username = nc.getName();
      String password = new String(pc.getPassword());

      // First errorstring is stored in "sampleauth-error-1" property.
      if (username.equals(ERROR_1_NAME))
      {
        setErrorText("sampleauth-error-1");
        return STATE_ERROR;
      }

      // Second errorstring is stored in "sampleauth-error-2" property.
      if (username.equals(ERROR_2_NAME))
      {
        setErrorText("sampleauth-error-2");
        return STATE_ERROR;
      }

      if (username.equals(USERNAME) &amp;&amp; password.equals("password"))
      {
        return ISAuthConstants.LOGIN_SUCCEED;
      }

      throw new InvalidPasswordException("password is wrong", USERNAME);

    case STATE_ERROR:
      return STATE_ERROR;
    default:
      throw new AuthLoginException("invalid state");

    }
  }



  @Override
  public Principal getPrincipal()
  {
    return new SampleAuthPrincipal(USERNAME);
  }



  private void setErrorText(String err) throws AuthLoginException
  {
    // Receive correct string from properties and substitute the
    // header in callbacks order 3.
    substituteHeader(STATE_ERROR, bundle.getString(err));
  }



  private void substituteUIStrings() throws AuthLoginException
  {
    // Get service specific attribute configured in OpenAM
    String ssa = CollectionHelper.getMapAttr(options,
        "sampleauth-service-specific-attribute");

    // Get property from bundle
    String new_hdr = ssa + " "
        + bundle.getString("sampleauth-ui-login-header");
    substituteHeader(STATE_AUTH, new_hdr);

    replaceCallback(STATE_AUTH, 0, new NameCallback(bundle
      .getString("sampleauth-ui-username-prompt")));

    replaceCallback(STATE_AUTH, 1, new PasswordCallback(bundle
            .getString("sampleauth-ui-password-prompt"), false));
  }

}</pre></div><div class="section" title="15.4.&nbsp;The Sample Auth Principal"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="principal-sample-auth-module"></a>15.4.&nbsp;The Sample Auth Principal</h2></div></div></div><p>The implementation, <code class="filename">SimpleAuthPrincipal.java</code>, is
  shown below.</p><pre class="brush: java;">/**
 * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS HEADER.
 *
 * Copyright (c) 2011 ForgeRock AS. All Rights Reserved
 *
 * The contents of this file are subject to the terms
 * of the Common Development and Distribution License
 * (the License). You may not use this file except in
 * compliance with the License.
 *
 * You can obtain a copy of the License at
 * http://forgerock.org/license/CDDLv1.0.html
 * See the License for the specific language governing
 * permission and limitations under the License.
 *
 * When distributing Covered Code, include this CDDL
 * Header Notice in each file and include the License file
 * at http://forgerock.org/license/CDDLv1.0.html
 * If applicable, add the following below the CDDL Header,
 * with the fields enclosed by brackets [] replaced by
 * your own identifying information:
 * "Portions Copyrighted [year] [name of copyright owner]"
 *
 */

package com.forgerock.openam.examples;



import java.io.Serializable;
import java.security.Principal;



public class SampleAuthPrincipal implements Principal, Serializable
{
  private final String name;
  private final static String CLASSNAME = "SampleAuthPrincipal";
  private final static String COLON = " : ";



  public SampleAuthPrincipal(String name)
  {
    if (name == null)
    {
      throw new NullPointerException("illegal null input");
    }

    this.name = name;
  }



  /**
   * Return the LDAP username for this &lt;code&gt; SampleAuthPrincipal &lt;/code&gt;.
   *
   * @return the LDAP username for this &lt;code&gt; SampleAuthPrincipal &lt;/code&gt;
   */
  @Override
  public String getName()
  {
    return name;
  }



  /**
   * Return a string representation of this &lt;code&gt; SampleAuthPrincipal &lt;/code&gt;.
   *
   * @return a string representation of this
   *         &lt;code&gt;TestAuthModulePrincipal&lt;/code&gt;.
   */
  @Override
  public String toString()
  {
    return new StringBuilder().append(CLASSNAME).append(COLON)
        .append(name).toString();
  }



  /**
   * Compares the specified Object with this &lt;code&gt; SampleAuthPrincipal &lt;/code&gt;
   * for equality. Returns true if the given object is also a
   * &lt;code&gt; SampleAuthPrincipal &lt;/code&gt; and the two SampleAuthPrincipal have
   * the same username.
   *
   * @param o Object to be compared for equality with this
   *          &lt;code&gt; SampleAuthPrincipal &lt;/code&gt;.
   * @return true if the specified Object is equal equal to this
   *         &lt;code&gt; SampleAuthPrincipal &lt;/code&gt;.
   */
  @Override
  public boolean equals(Object o)
  {
    if (o == null)
    {
      return false;
    }

    if (this == o)
    {
      return true;
    }

    if (!(o instanceof SampleAuthPrincipal))
    {
      return false;
    }
    SampleAuthPrincipal that = (SampleAuthPrincipal) o;

    if (this.getName().equals(that.getName()))
    {
      return true;
    }
    return false;
  }



  /**
   * Return a hash code for this &lt;code&gt; SampleAuthPrincipal &lt;/code&gt;.
   *
   * @return a hash code for this &lt;code&gt; SampleAuthPrincipal &lt;/code&gt;.
   */
  @Override
  public int hashCode()
  {
    return name.hashCode();
  }
}</pre></div><div class="section" title="15.5.&nbsp;The Sample Auth Service Configuration"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="service-conf-sample-auth-module"></a>15.5.&nbsp;The Sample Auth Service Configuration</h2></div></div></div><p>OpenAM requires that all authentication modules be configured by means
  of an OpenAM service. At minimum, the service must include an authentication
  level attribute. Your module can access these configuration attributes in
  the <code class="literal">options</code> parameter passed to the
  <code class="literal">init()</code> method.</p><div class="itemizedlist"><p>Some observations about the service configuration file follow in the
   list below.</p><ul class="itemizedlist" type="disc"><li class="listitem"><p>The document type for a service configuration file is described in
    <code class="filename"><em class="replaceable"><code>war-file-name</code></em>/WEB-INF/sms.dtd</code>.</p></li><li class="listitem"><p>The service name is taken from the module name:
    <code class="literal">iPlanetAMAuth<em class="replaceable"><code>module-name</code></em>Service</code>.
    In this case, the service name is
    <code class="literal">iPlanetAMAuthSampleAuthService</code>.</p></li><li class="listitem"><p>The service must have a localized description, retrieved from a
    properties file.</p></li><li class="listitem"><p>The <code class="literal">i18nFileName</code> attribute in the service
    configuration holds the default (non-localized) base name of the Java
    properties file. The <code class="literal">i18nKey</code> attributes indicate
    properties keys to string values in the Java properties file.</p></li><li class="listitem"><p>The authentication level attribute name is taken from the module name:
    <code class="literal">iplanet-am-auth-<em class="replaceable"><code>module-name</code></em>-auth-level</code>,
    where the <em class="replaceable"><code>module-name</code></em> is all lower case. Here,
    the authentication level attribute is named
    <code class="literal">iplanet-am-auth-sampleauth-auth-level</code>.</p></li><li class="listitem"><p>The Sample Auth service configuration includes an example
    <code class="literal">sampleauth-service-specific-attribute</code>, which can be
    configured through OpenAM console.</p></li></ul></div><p>The service configuration file,
  <code class="filename">amAuthSampleAuth.xml</code>, is shown below.</p><pre class="brush: xml;">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!--
   DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS HEADER.

   Copyright (c) 2011 ForgeRock AS. All Rights Reserved

   The contents of this file are subject to the terms
   of the Common Development and Distribution License
   (the License). You may not use this file except in
   compliance with the License.

   You can obtain a copy of the License at
   http://forgerock.org/license/CDDLv1.0.html
   See the License for the specific language governing
   permission and limitations under the License.

   When distributing Covered Code, include this CDDL
   Header Notice in each file and include the License file
   at http://forgerock.org/license/CDDLv1.0.html
   If applicable, add the following below the CDDL Header,
   with the fields enclosed by brackets [] replaced by
   your own identifying information:
   "Portions Copyrighted [year] [name of copyright owner]"
--&gt;
&lt;!DOCTYPE ServicesConfiguration
    PUBLIC "=//iPlanet//Service Management Services (SMS) 1.0 DTD//EN"
    "jar://com/sun/identity/sm/sms.dtd"&gt;

&lt;ServicesConfiguration&gt;
 &lt;Service name="iPlanetAMAuthSampleAuthService" version="1.0"&gt;
  &lt;Schema
   serviceHierarchy="/DSAMEConfig/authentication/iPlanetAMAuthSampleAuthService"
   i18nFileName="amAuthSampleAuth" revisionNumber="10"
   i18nKey="sampleauth-service-description"&gt;
   &lt;Organization&gt;
    &lt;AttributeSchema name="iplanet-am-auth-sampleauth-auth-level"
     type="single" syntax="number_range" rangeStart="0" rangeEnd="2147483647"
     i18nKey="a500"&gt;
     &lt;DefaultValues&gt;
      &lt;Value&gt;1&lt;/Value&gt;
     &lt;/DefaultValues&gt;
    &lt;/AttributeSchema&gt;

    &lt;AttributeSchema name="sampleauth-service-specific-attribute"
     type="single" syntax="string" validator="no" i18nKey="a501"&gt;
     &lt;DefaultValues&gt;
      &lt;Value&gt;&lt;/Value&gt;
     &lt;/DefaultValues&gt;
    &lt;/AttributeSchema&gt;

    &lt;SubSchema name="serverconfig" inheritance="multiple"&gt;
     &lt;AttributeSchema name="iplanet-am-auth-sampleauth-auth-level"
      type="single" syntax="number_range" rangeStart="0" rangeEnd="2147483647"
      i18nKey="a500"&gt;
      &lt;DefaultValues&gt;
       &lt;Value&gt;1&lt;/Value&gt;
      &lt;/DefaultValues&gt;
     &lt;/AttributeSchema&gt;

     &lt;AttributeSchema name="sampleauth-service-specific-attribute"
      type="single" syntax="string" validator="no" i18nKey="a501"&gt;
      &lt;DefaultValues&gt;
       &lt;Value&gt;&lt;/Value&gt;
      &lt;/DefaultValues&gt;
     &lt;/AttributeSchema&gt;

    &lt;/SubSchema&gt;
   &lt;/Organization&gt;
  &lt;/Schema&gt;
 &lt;/Service&gt;
&lt;/ServicesConfiguration&gt;</pre></div><div class="section" title="15.6.&nbsp;The Sample Auth Properties"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="properties-sample-auth-module"></a>15.6.&nbsp;The Sample Auth Properties</h2></div></div></div><p>OpenAM uses a Java properties file per locale to retrieve the
  appropriate, localized strings for the authentication module. The default
  properties file,
  <code class="filename">amAuthSampleAuth.properties</code>, is shown below.</p><pre class="brush: java;">sampleauth-service-description=Sample Authentication Module
a500=Authentication Level
a501=Service Specific Attribute

sampleauth-ui-login-header=Login
sampleauth-ui-username-prompt=User Name:
sampleauth-ui-password-prompt=Password:

sampleauth-error-1=Error 1 occured during the authentication
sampleauth-error-2=Error 2 occured during the authentication</pre></div><div class="section" title="15.7.&nbsp;Building &amp; Installing the Sample Auth Module"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="build-config-sample-auth-module"></a>15.7.&nbsp;Building &amp; Installing the Sample Auth Module</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#building-sample-auth-module">15.7.1. Building the Module</a></span></dt><dt><span class="section"><a href="#installing-sample-auth-module">15.7.2. Installing the Module</a></span></dt></dl></div><p>Once you have the files for the sample authentication module, build
  the module, and then install the module into OpenAM.</p><div class="section" title="15.7.1.&nbsp;Building the Module"><div class="titlepage"><div><div><h3 class="title"><a name="building-sample-auth-module"></a>15.7.1.&nbsp;Building the Module</h3></div></div></div><p>The sample authentication module code relies on three .jar files, two
   of which are deployed with OpenAM, and the third which is provided by your
   web application container.</p><div class="variablelist"><dl><dt><span class="term"><code class="filename">amserver.jar</code></span></dt><dd><p>When you deploy OpenAM, the file is
      <code class="filename"><em class="replaceable"><code>war-file-name</code></em>/WEB-INF/lib/amserver.jar</code>.</p></dd><dt><span class="term"><code class="filename">opensso-sharedlib.jar</code></span></dt><dd><p>When you deploy OpenAM, the file is
      <code class="filename"><em class="replaceable"><code>war-file-name</code></em>/WEB-INF/lib/opensso-sharedlib.jar</code>.</p></dd><dt><span class="term"><code class="filename">servlet-api.jar</code></span></dt><dd><p>This .jar provides the Java EE Servlet API.</p><p>If you use Apache Tomcat as your web application container, the file
      is <code class="filename">/path/to/tomcat/lib/servlet-api.jar</code>.</p></dd></dl></div><p>Put these libraries for example in a <code class="filename">lib/</code>
   directory, and then put them on your CLASSPATH to compile the custom
   authentication authentication module classes.</p><div class="screen"><pre class="brush: plain;">$ mkdir classes
$ javac -d classes -cp lib/servlet-api.jar:lib/amserver.jar:
 lib/opensso-sharedlib.jar src/com/forgerock/openam/examples/SampleAuth*.java</pre></div><p>Add the resulting classes to a new <code class="filename">sampleauth.jar</code>
   file.</p><div class="screen"><pre class="brush: plain;">$ cd classes/
$ jar cf ../sampleauth.jar .</pre></div></div><div class="section" title="15.7.2.&nbsp;Installing the Module"><div class="titlepage"><div><div><h3 class="title"><a name="installing-sample-auth-module"></a>15.7.2.&nbsp;Installing the Module</h3></div></div></div><p>Installing the sample authentication module consists of putting the
   .jar and other files in the right places, registering the module with OpenAM,
   and then restarting the web application or the web application
   container.</p><p>Copy the <code class="filename">sampleauth.jar</code> file to
   <code class="filename"><em class="replaceable"><code>war-file-name</code></em>/WEB-INF/lib/</code>
   where OpenAM is deployed.</p><div class="screen"><pre class="brush: plain;">$ cp sampleauth.jar /path/to/tomcat/webapps/openam/WEB-INF/lib/</pre></div><p>Copy the <code class="filename">amAuthSampleAuth.properties</code> file to
   <code class="filename"><em class="replaceable"><code>war-file-name</code></em>/WEB-INF/classes/</code>
   where OpenAM is deployed.</p><div class="screen"><pre class="brush: plain;">$ cp amAuthSampleAuth.properties /path/to/tomcat/webapps/openam/WEB-INF/classes/</pre></div><p>Copy the <code class="filename">amAuthSampleAuth.xml</code> service definition
   file to
   <code class="filename"><em class="replaceable"><code>war-file-name</code></em>/WEB-INF/classes/</code>
   where OpenAM is deployed.</p><div class="screen"><pre class="brush: plain;">$ cp amAuthSampleAuth.xml /path/to/tomcat/webapps/openam/WEB-INF/classes/</pre></div><p>Copy the <code class="filename">SimpleAuth.xml</code> callbacks file to
   <code class="filename"><em class="replaceable"><code>war-file-name</code></em>/config/auth/default/</code>
   where OpenAM is deployed.</p><div class="screen"><pre class="brush: plain;">$ cp SampleAuth.xml /path/to/tomcat/webapps/openam/config/auth/default/</pre></div><p>Register the module with OpenAM using the <span class="command"><strong>ssoadm</strong></span>
   command.</p><div class="screen"><pre class="brush: plain;">$ ssoadm
 create-svc
 --adminid amadmin
 --password-file /tmp/pwd.txt
 --xmlfile amAuthSampleAuth.xml 

Service was added.
$ ssoadm
 register-auth-module
 --adminid amadmin
 --password-file /tmp/pwd.txt
 --authmodule com.forgerock.openam.examples.SampleAuth

Authentication module was registered.</pre></div><p>See the <span class="olink"><span class="command"><strong>ssoadm</strong></span>
  reference</span> a full list of Authentication Service Management
  subcommands.</p><p>Restart OpenAM, or the web applications container where it runs.</p><div class="screen"><pre class="brush: plain;">$ /path/to/tomcat/bin/shutdown.sh
$ /path/to/tomcat/bin/startup.sh
$ tail -1 /path/to/tomcat/logs/catalina.out
INFO: Server startup in 32746 ms</pre></div></div></div><div class="section" title="15.8.&nbsp;Configuring &amp; Testing the Sample Auth Module"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="configuring-testing-sample-auth-module"></a>15.8.&nbsp;Configuring &amp; Testing the Sample Auth Module</h2></div></div></div><p>Login to the console as OpenAM administrator,
  <code class="literal">amadmin</code>, and browse to Access Control &gt;
  <em class="replaceable"><code>Realm Name</code></em> &gt; Authentication &gt; Module
  Instances. Click New, and then create an instance of your Sample
  Authentication Module.</p><p>After creating the module, click the name in the Module Instances
  list, and configure as appropriate.</p><div class="mediaobject" title="SampleAuth module configuration"><a name="figure-sampleauth-conf"></a><img src="images/sampleauth-conf.png" longdesc="/Users/mark/Downloads/openam/openam-documentation/openam-doc-source/target/docbkx/html/dev-guide/figure-sampleauth-conf.html"><div class="longdesc-link" align="right"><br clear="all"><span class="longdesc-link">[<a href="figure-sampleauth-conf.html" target="longdesc">D</a>]</span></div></div><p>Add your module to the top of the default authentication chain
  so that OpenAM considers the module sufficient to login. Also, under
  All Core Settings... for the realm, set User Profile creation to Dynamic
  so that successful login results</p><p>Now that your module is configured, logout of OpenAM console, to
  return to the login page.</p><div class="mediaobject" title="SampleAuth module testing"><a name="figure-sampleauth-test"></a><img src="images/sampleauth-test.png" longdesc="/Users/mark/Downloads/openam/openam-documentation/openam-doc-source/target/docbkx/html/dev-guide/figure-sampleauth-test.html"><div class="longdesc-link" align="right"><br clear="all"><span class="longdesc-link">[<a href="figure-sampleauth-test.html" target="longdesc">D</a>]</span></div></div><p>You can try different combinations as seen in
  <code class="filename">SimpleAuth.java</code>. Unless you create a
  <code class="literal">test</code> subject with a user profile in OpenAM or set User
  Profile creation to Dynamic for the login realm, successful login results
  in an "User has no profile in this organization" error. This is because
  OpenAM attempts to redirect the authenticated test user to a profile page
  that does not exist.</p></div></div><div lang="en" class="chapter" title="Chapter&nbsp;16.&nbsp;Creating a Post Authentication Plugin"><div class="titlepage"><div><div><h2 class="title"><a name="chap-post-auth"></a>Chapter&nbsp;16.&nbsp;Creating a Post Authentication Plugin</h2></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl><dt><span class="section"><a href="#design-post-authentication-plugin">16.1. Designing Your Post Authentication Plugin</a></span></dt><dt><span class="section"><a href="#build-post-authentication-plugin">16.2. Building Your Sample Post Authentication Plugin</a></span></dt><dt><span class="section"><a href="#configure-post-authentication-plugin">16.3. Configuring Your Post Authentication Plugin</a></span></dt><dt><span class="section"><a href="#test-post-authentication-plugin">16.4. Testing Your Post Authentication Plugin</a></span></dt></dl></div><a class="indexterm" name="d2063e3467"></a><p>Post authentication plugins (PAP) let you include custom processing at
 the end of the authentication process, immediately before the subject is
 authenticated. Common uses of post authentication plugins include setting
 cookies and session variables. Post authentication plugins are often used in
 conjunction with policy agents. The post authentication plugin sets custom
 session properties, and then the policy agent injects the custom properties
 into the request header to the protected application.</p><p>This chapter explains how to create a post authentication plugin.</p><div class="section" title="16.1.&nbsp;Designing Your Post Authentication Plugin"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="design-post-authentication-plugin"></a>16.1.&nbsp;Designing Your Post Authentication Plugin</h2></div></div></div><p>Your post authentication plugin class implements the
  <code class="literal">AMPostAuthProcessInterface</code> interface, and in particular
  the following three methods.</p><pre class="brush: java;">public void onLoginSuccess(
  Map requestParamsMap, 
  HttpServletRequest request,
  HttpServletResponse response,
  SSOToken token
) throws AuthenticationException

public void onLoginFailure(
  Map requestParamsMap, 
  HttpServletRequest request,
  HttpServletResponse response
) throws AuthenticationException

public void onLogout(
  HttpServletRequest request, 
  HttpServletResponse response,
  SSOToken token
) throws AuthenticationException</pre><p>OpenAM calls the <code class="literal">onLoginSuccess()</code> and
  <code class="literal">onLoginFailure()</code> methods immediately before informing the
  user of login success or failure, respectively. OpenAM calls the
  <code class="literal">onLogout()</code> method only when the user actively logs out,
  not when a user's session times out.</p><p>See the <a class="link" href="http://openam.forgerock.org/apidocs/index.html" target="_top"><em class="citetitle">OpenAM Java SDK API Specification</em></a> for
  reference.</p><p>These methods can perform whatever processing you require. Yet, know
  that OpenAM calls your methods synchronously as part of the authentication
  process. Therefore, if your methods take a long time to complete, you will
  keep users waiting. Minimize the processing done in your post authentication
  methods.</p></div><div class="section" title="16.2.&nbsp;Building Your Sample Post Authentication Plugin"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="build-post-authentication-plugin"></a>16.2.&nbsp;Building Your Sample Post Authentication Plugin</h2></div></div></div><p>The following example post authentication plugin sets a session
  property during successful login, writing to its debug log if the operation
  fails.</p><pre class="brush: java;">package com.forgerock.openam.examples;

import java.util.Map;

import com.iplanet.sso.SSOException;
import com.iplanet.sso.SSOToken;

import com.sun.identity.authentication.spi.AMPostAuthProcessInterface;
import com.sun.identity.authentication.spi.AuthenticationException;
import com.sun.identity.shared.debug.Debug;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

public class SamplePAP implements AMPostAuthProcessInterface
{
  private final static String PROP_NAME = "MyProperty";
  private final static String PROP_VALUE = "MyValue";
  private final static String DEBUG_FILE = "SamplePAP";

  protected Debug debug = Debug.getInstance(DEBUG_FILE);

  public void onLoginSuccess(
    Map requestParamsMap, 
    HttpServletRequest request,
    HttpServletResponse response,
    SSOToken token
  ) throws AuthenticationException
  {
    try {
      token.setProperty(PROP_NAME, PROP_VALUE);
    } catch (SSOException ssoe) {
      debug.error("Unable to set property");
    }
  }

  public void onLoginFailure(
    Map requestParamsMap, 
    HttpServletRequest request,
    HttpServletResponse response
  ) throws AuthenticationException
  {
    ; // Not used
  }

  public void onLogout(
    HttpServletRequest request, 
    HttpServletResponse response,
    SSOToken token
  ) throws AuthenticationException
  {
    ; // Not used
  }
}</pre><p>A post authentication plugin code relies on three .jar files, two
  of which are deployed with OpenAM, and the third which is provided by your
  web application container.</p><div class="variablelist"><dl><dt><span class="term"><code class="filename">amserver.jar</code></span></dt><dd><p>When you deploy OpenAM, the file is
     <code class="filename"><em class="replaceable"><code>war-file-name</code></em>/WEB-INF/lib/amserver.jar</code>.</p></dd><dt><span class="term"><code class="filename">opensso-sharedlib.jar</code></span></dt><dd><p>When you deploy OpenAM, the file is
     <code class="filename"><em class="replaceable"><code>war-file-name</code></em>/WEB-INF/lib/opensso-sharedlib.jar</code>.</p></dd><dt><span class="term"><code class="filename">servlet-api.jar</code></span></dt><dd><p>This .jar provides the Java EE Servlet API.</p><p>If you use Apache Tomcat as your web application container, the file
     is <code class="filename">/path/to/tomcat/lib/servlet-api.jar</code>.</p></dd></dl></div><p>Put the sample plugin in
  <code class="filename">src/com/forgerock/openam/examples/SamplePAP.java</code>,
  and compile the class.</p><div class="screen"><pre class="brush: plain;">$ cd src
$ mkdir ../classes
$ javac
 -d ../classes
 -classpath /path/to/tomcat/webapps/openam/WEB-INF/lib/amserver.jar:
 /path/to/tomcat/webapps/openam/WEB-INF/lib/opensso-sharedlib.jar:
 /path/to/tomcat/lib/servlet-api.jar
 com/forgerock/openam/examples/SamplePAP.java</pre></div><p>Copy the classes to the <code class="filename">WEB-INF/classes</code> directory
  where you deployed OpenAM.</p><div class="screen"><pre class="brush: plain;">$ cp -r ../classes/* /path/to/tomcat/webapps/openam/WEB-INF/classes/</pre></div><p>Restart OpenAM or your web container to ensure the post authentication
  plugin class is loaded.</p><div class="screen"><pre class="brush: plain;">$ /etc/init.d/tomcat stop
$ /etc/init.d/tomcat start
$ tail -1 /path/to/tomcat/logs/catalina.out
INFO: Server startup in 32070 ms</pre></div></div><div class="section" title="16.3.&nbsp;Configuring Your Post Authentication Plugin"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="configure-post-authentication-plugin"></a>16.3.&nbsp;Configuring Your Post Authentication Plugin</h2></div></div></div><p>You can configure the post authentication plugin for a realm, for a
  service (authentication chain), or for a role. Where you configure the plugin
  depends on the scope to which the plugin should apply. Configuring the plugin
  at the realm level as shown here, for example, ensures that OpenAM calls your
  plugin for all authentications to the realm.</p><p>In the OpenAM console, browse to Access Control &gt; <em class="replaceable"><code>Realm
  Name</code></em> &gt; Authentication &gt; All Core Settings... In the
  Authentication Post Processing Classes list, add the sample plugin class,
  <code class="literal">com.forgerock.openam.examples.SamplePAP</code>, and then click
  Save.</p><p>Alternatively, you can configure sample plugin for the realm by using
  the <span class="command"><strong>ssoadm</strong></span> command.</p><div class="screen"><pre class="brush: plain;">$ ssoadm
 set-svc-attrs
 --adminid amadmin
 --password-file /tmp/pwd.txt
 --servicename iPlanetAMAuthService
 --realm /realm
 --attributevalues iplanet-am-auth-post-login-process-class=
 com.forgerock.openam.examples.SamplePAP

iPlanetAMAuthService under /realm was modified.</pre></div></div><div class="section" title="16.4.&nbsp;Testing Your Post Authentication Plugin"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="test-post-authentication-plugin"></a>16.4.&nbsp;Testing Your Post Authentication Plugin</h2></div></div></div><p>To test the sample post authentication plugin, login successfully to
  OpenAM in the scope where the plugin is configured. For example, if you
  configured your plugin for the realm, <code class="literal">/realm</code>, specify the
  realm in the login URL.</p><pre class="literallayout">http://openam.example.com:8080/openam/UI/Login?realm=realm</pre><p>Although as a user you do not notice anywhere in the user interface
  that OpenAM calls your plugin, a policy agent or custom client code could
  retrieve the session property your plugin added to the user session.</p></div></div><div lang="en" class="chapter" title="Chapter&nbsp;17.&nbsp;Customizing Policy Evaluation"><div class="titlepage"><div><div><h2 class="title"><a name="chap-policy-spi"></a>Chapter&nbsp;17.&nbsp;Customizing Policy Evaluation</h2></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl><dt><span class="section"><a href="#about-sample-policy-plugins">17.1. About the Sample Plugins</a></span></dt><dt><span class="section"><a href="#configure-sample-policy-plugin">17.2. Configuring A Sample Policy Plugin</a></span></dt></dl></div><a class="indexterm" name="d2063e3606"></a><p>OpenAM policies let you restrict access to resources based both on
 identity and group membership, and also on a range of conditions including
 session age, authentication chain or module used, authentication level, realm,
 session properties, IP address and DNS name, user profile content, resource
 environment, date, day, time of day, and time zone. Yet, some deployments
 require further distinctions for policy evaluation. This chapter explains how
 to customize policy evaluation for deployments with particular requirements
 not met by built-in OpenAM functionality.</p><p>OpenAM comes with sample plugins that demonstrate how to customize
 policy evaluation. This chapter shows how to compile the samples, and how
 to configure OpenAM to use one of the plugins.</p><div class="section" title="17.1.&nbsp;About the Sample Plugins"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="about-sample-policy-plugins"></a>17.1.&nbsp;About the Sample Plugins</h2></div></div></div><p>The OpenAM policy framework lets you build plugins to extend subjects,
  conditions, and response providers for policies, and also extend referrals
  for policy delegation. When you deploy OpenAM, you find Java code for sample
  policy evaluation plugins under
  <code class="filename"><em class="replaceable"><code>war-file-name</code></em>/source/com/sun/identity/samples/policy</code>.</p><div class="variablelist"><dl><dt><span class="term"><code class="filename">SampleCondition.java</code></span></dt><dd><p>Extends the <code class="literal">Condition</code> interface. Shows an
     implementation of a condition to base the policy decision on the length
     of the user name.</p></dd><dt><span class="term"><code class="filename">SampleReferral.java</code></span></dt><dd><p>Extends the <code class="literal">Referral</code> interface. Shows an
     implementation of a policy referral for delegation.</p></dd><dt><span class="term"><code class="filename">SampleResponseProvider.java</code></span></dt><dd><p>Extends the <code class="literal">ResponseProvider</code> interface. Shows an
     implementation of a response provider to send an attribute from the user
     profile with the response.</p></dd><dt><span class="term"><code class="filename">SampleSubject.java</code></span></dt><dd><p>Extends the <code class="literal">Subject</code> interface. Shows an
     implementation that defines the users to whom the policy applies, in this
     case all authenticated users.</p></dd></dl></div><p>Before including the plugins in OpenAM, you compile the four files, and
  package the classes into a .jar for deployment.</p><p>The sample policy evaluation code relies on two .jar files deployed
  with OpenAM.</p><div class="variablelist"><dl><dt><span class="term"><code class="filename">openam-core-10.1.0.jar</code></span></dt><dd><p>When you deploy OpenAM, the file is
      <code class="filename"><em class="replaceable"><code>war-file-name</code></em>/WEB-INF/lib/openam-core-10.1.0.jar</code>.</p></dd><dt><span class="term"><code class="filename">openam-shared-10.1.0.jar</code></span></dt><dd><p>When you deploy OpenAM, the file is
      <code class="filename"><em class="replaceable"><code>war-file-name</code></em>/WEB-INF/lib/openam-shared-10.1.0.jar</code>.</p></dd></dl></div><div class="screen"><pre class="brush: plain;">$ cd /path/to/tomcat/webapps/openam/
$ mkdir classes
$ javac -d classes
 -classpath /path/to/tomcat/webapps/openam/WEB-INF/lib/openam-core-10.1.0.jar:
  /path/to/tomcat/webapps/openam/WEB-INF/lib/openam-shared-10.1.0.jar
  source/com/sun/identity/samples/policy/Sample*.java
$ cd classes/
$ jar cf ../policy-plugins.jar .</pre></div><p>The .jar belongs under
  <code class="filename"><em class="replaceable"><code>war-file-name</code></em>/WEB-INF/lib/</code>.</p><div class="screen"><pre class="brush: plain;">$ cp ../policy-plugins.jar /path/to/tomcat/webapps/openam/WEB-INF/lib</pre></div><p>Alternatively, you can add individual classes under
  <code class="filename"><em class="replaceable"><code>war-file-name</code></em>/WEB-INF/classes/</code>.</p></div><div class="section" title="17.2.&nbsp;Configuring A Sample Policy Plugin"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="configure-sample-policy-plugin"></a>17.2.&nbsp;Configuring A Sample Policy Plugin</h2></div></div></div><p>This section shows how to configure the sample custom policy condition
  that you built. Configuration involves defining the strings that describe
  the policy condition, and plugging the policy condition into the
  <code class="literal">iPlanetAMPolicyService</code>, and then restarting OpenAM in
  order to be able to add the condition to your policies.</p><p>The strings describing your plugin belong as properties values in two
  files,
  <code class="filename"><em class="replaceable"><code>war-file-name</code></em>/WEB-INF/classes/amPolicy.properties</code>
  and
  <code class="filename"><em class="replaceable"><code>war-file-name</code></em>/WEB-INF/classes/amPolicyConfig.properties</code>.
  To the former, add this property:</p><pre class="literallayout">samplecondition-policy-name=Sample Condition</pre><p>To the later, add this property:</p><pre class="literallayout">x100=Sample Condition</pre><p>Add the schema that describes your plugin to OpenAM.</p><div class="screen"><pre class="brush: plain;">$ ssoadm
 add-plugin-schema
 --adminid amadmin
 --password-file /tmp/pwd.txt
 --servicename iPlanetAMPolicyService
 --interfacename Condition
 --pluginname SampleCondition
 --i18nname amPolicy
 --i18nkey samplecondition-policy-name
 --classname com.sun.identity.samples.policy.SampleCondition

Plug-in schema, Condition was added to service, iPlanetAMPolicyService.</pre></div><p>Set the choice values of the schema to include your plugin with other
  policy conditions in the policy service.</p><div class="screen"><pre class="brush: plain;">$ ssoadm
 set-attr-choicevals
 --adminid amadmin
 --password-file /tmp/pwd.txt
 --servicename iPlanetAMPolicyConfigService
 --schematype Organization
 --attributename iplanet-am-policy-selected-conditions
 --add
 --choicevalues "x100=Sample Condition"

Choice Values were set.</pre></div><p>Set the plugin policy condition as one of the default attibutes of the
  policy service.</p><div class="screen"><pre class="brush: plain;">$ ssoadm
 add-attr-defs
 --adminid amadmin
 --password-file /tmp/pwd.txt
 --servicename iPlanetAMPolicyConfigService
 --schematype Organization
 --attributevalues "iplanet-am-policy-selected-conditions=Sample Condition"

Schema attribute defaults were added.</pre></div><p>After completing configuration, restart OpenAM or the web application
  container.</p><div class="screen"><pre class="brush: plain;">$ /etc/init.d/tomcat stop
Password: 
Using CATALINA_BASE:   /path/to/tomcat
Using CATALINA_HOME:   /path/to/tomcat
Using CATALINA_TMPDIR: /path/to/tomcat/temp
Using JRE_HOME:        /path/to/jdk1.6/jre
Using CLASSPATH:       /path/to/tomcat/bin/bootstrap.jar:
 /path/to/tomcat/bin/tomcat-juli.jar
$ /etc/init.d/tomcat start
Password: 
Using CATALINA_BASE:   /path/to/tomcat
Using CATALINA_HOME:   /path/to/tomcat
Using CATALINA_TMPDIR: /path/to/tomcat/temp
Using JRE_HOME:        /path/to/jdk1.6/jre
Using CLASSPATH:       /path/to/tomcat/bin/bootstrap.jar:
 /path/to/tomcat/bin/tomcat-juli.jar</pre></div><p>In OpenAM console, browse to Access Control &gt; <em class="replaceable"><code>Realm
  Name</code></em> &gt; Policies &gt; <em class="replaceable"><code>Policy Name</code></em>
  &gt; Conditions &gt; New... Notice in the list of conditions that you can
  now apply your Sample Condition.</p><div class="mediaobject" title="Sample Condition in list of conditions"><a name="figure-sample-condition"></a><img src="images/sample-condition.png" longdesc="/Users/mark/Downloads/openam/openam-documentation/openam-doc-source/target/docbkx/html/dev-guide/figure-sample-condition.html"><div class="longdesc-link" align="right"><br clear="all"><span class="longdesc-link">[<a href="figure-sample-condition.html" target="longdesc">D</a>]</span></div></div></div></div><div lang="en" class="chapter" title="Chapter&nbsp;18.&nbsp;Customizing Identity Data Storage"><div class="titlepage"><div><div><h2 class="title"><a name="chap-identity-repo-spi"></a>Chapter&nbsp;18.&nbsp;Customizing Identity Data Storage</h2></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl><dt><span class="section"><a href="#about-idrepo-plugin">18.1. About the Identity Repository Plugin</a></span></dt><dt><span class="section"><a href="#idrepo-plugin-implementation">18.2. Identity Repository Plugin Implementation</a></span></dt><dt><span class="section"><a href="#idrepo-plugin-deployment">18.3. Identity Repository Plugin Deployment</a></span></dt></dl></div><a class="indexterm" name="d2063e3776"></a><p>OpenAM maps user and group identities into a realm using data stores.
 An OpenAM data store relies on a Java identity repository (IdRepo) plugin to
 implement interaction with the identity repository where the users and groups
 are stored.</p><div class="section" title="18.1.&nbsp;About the Identity Repository Plugin"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="about-idrepo-plugin"></a>18.1.&nbsp;About the Identity Repository Plugin</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#idrepo-plugin-inheritance">18.1.1. IdRepo Inheritance</a></span></dt><dt><span class="section"><a href="#idrepo-plugin-lifecycle">18.1.2. IdRepo Lifecycle</a></span></dt><dt><span class="section"><a href="#idrepo-plugin-capabilties">18.1.3. IdRepo Plugin Capabilities</a></span></dt></dl></div><p>This chapter describes how to create a custom identity repository plugin.
  OpenAM includes built-in support for LDAP and JDBC identity repositories. For
  most deployments, you therefore do not need to create your own custom identity
  repository plugin. Only create custom identity repository plugins for
  deployments with particular requirements not met by built-in OpenAM
  functionality.</p><div class="tip" title="Tip" style="font-style: italic;"><h3 class="title">Tip</h3><p>Before creating your own identity repository plugin, start by reading
   the OpenAM source code for the <code class="literal">FilesRepo</code> or
   <code class="literal">DatabaseRepo</code> plugins under
   <code class="literal">com.sun.identity.idm.plugins</code>.</p></div><div class="section" title="18.1.1.&nbsp;IdRepo Inheritance"><div class="titlepage"><div><div><h3 class="title"><a name="idrepo-plugin-inheritance"></a>18.1.1.&nbsp;IdRepo Inheritance</h3></div></div></div><p>Your identity repository plugin class must extend the
   <code class="literal">com.sun.identity.idm.IdRepo</code> abstract class, and must
   include a constructor method that takes no arguments.</p></div><div class="section" title="18.1.2.&nbsp;IdRepo Lifecycle"><div class="titlepage"><div><div><h3 class="title"><a name="idrepo-plugin-lifecycle"></a>18.1.2.&nbsp;IdRepo Lifecycle</h3></div></div></div><p>When OpenAM instantiates your IdRepo plugin, it calls the
   <code class="literal">initialize()</code> method.</p><pre class="brush: java;">public void initialize(Map configParams)</pre><p>The <code class="literal">configParams</code> are service configuration
   parameters for the realm where the IdRepo plugin is configured. The
   <code class="literal">configParams</code> normally serve to set up communication with
   the underlying identity data store. OpenAM calls the
   <code class="literal">initialize()</code> method once, and considers the identity
   repository ready for use.</p><p>If you encounter errors or exceptions during initialization, catch
   and store them in your plugin for use later when OpenAM calls other plugin
   methods.</p><p>After initialization, OpenAM calls the <code class="literal">addListener()</code>
   and <code class="literal">removeListener()</code> methods to register listeners that
   inform OpenAM client code of changes to identities managed by your
   IdRepo.</p><pre class="brush: java;">public int addListener(SSOToken token, IdRepoListener listener)
public void removeListener()</pre><p>You must handle listener registration in your IdRepo plugin, and also
   return events to OpenAM through the <code class="literal">IdRepoListener</code>.</p><p>When stopping, OpenAM calls your IdRepo plugin
   <code class="literal">shutdown()</code> method.</p><pre class="brush: java;">public void shutdown()</pre><p>You are not required to implement <code class="literal">shutdown()</code> unless
   your IdRepo plugin has shut down work of its own to do, such as close
   connections to the underlying identity data store.</p></div><div class="section" title="18.1.3.&nbsp;IdRepo Plugin Capabilities"><div class="titlepage"><div><div><h3 class="title"><a name="idrepo-plugin-capabilties"></a>18.1.3.&nbsp;IdRepo Plugin Capabilities</h3></div></div></div><p>Your IdRepo plugin provides OpenAM with a generic means to manage
   subjects&#8212;including users and groups but also special types such as
   roles, realms, and agents&#8212; and to create, read, update, delete, and
   search subjects. In order for OpenAM to determine your plugin's capabilities,
   it calls the methods described in this section.</p><pre class="brush: java;">public Set getSupportedTypes()</pre><p>The <code class="literal">getSupportedTypes()</code> method returns a set of
   <code class="literal">IdType</code> objects, such as <code class="literal">IdType.USER</code>
   and <code class="literal">IdType.GROUP</code>. You can either hard-code the supported
   types into your plugin, or make them configurable through the IdRepo
   service.</p><pre class="brush: java;">public Set getSupportedOperations(IdType type)</pre><p>The <code class="literal">getSupportedOperations()</code> method returns a set
   of <code class="literal">IdOperation</code> objects, such as
   <code class="literal">IdOperation.CREATE</code> and
   <code class="literal">IdOperation.EDIT</code>. You can also either hard-code these, or
   make them configurable.</p><pre class="brush: java;">public boolean supportsAuthentication()</pre><p>The <code class="literal">supportsAuthentication()</code> method returns true if
   your plugin supports the <code class="literal">authenticate()</code> method.</p></div></div><div class="section" title="18.2.&nbsp;Identity Repository Plugin Implementation"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idrepo-plugin-implementation"></a>18.2.&nbsp;Identity Repository Plugin Implementation</h2></div></div></div><p>Your IdRepo plugin implements operational methods depending on what
  you support. These methods perform the operations in your data store.</p><div class="variablelist"><dl><dt><span class="term">Create</span></dt><dd><p>OpenAM calls <code class="literal">create()</code> to provision a new identity
     in the repository, where <code class="literal">name</code> is the new identity's
     name, and <code class="literal">attrMap</code> holds the attributes names and
     values.</p><pre class="brush: java;">public String create(SSOToken token, IdType type, String name, Map attrMap)
  throws IdRepoException, SSOException</pre></dd><dt><span class="term">Read</span></dt><dd><p>OpenAM calls the following methods to retrieve subjects in the
     identity repository, and to check account activity. If your data store
     does not support binary attributes, return an empty <code class="literal">Map</code>
     for <code class="literal">getBinaryAttributes()</code>.</p><pre class="brush: java;">public boolean isExists(
  SSOToken token,
  IdType type,
  String name
) throws IdRepoException, SSOException

public boolean isActive(
  SSOToken token,
  IdType type,
  String name
) throws IdRepoException, SSOException

public Map getAttributes(
  SSOToken token,
  IdType type,
  String name
) throws IdRepoException, SSOException

public Map getAttributes(
  SSOToken token,
  IdType type,
  String name,
  Set attrNames
) throws IdRepoException, SSOException

public Map getBinaryAttributes(
  SSOToken token,
  IdType type,
  String name,
  Set attrNames
) throws IdRepoException, SSOException

public RepoSearchResults search(
  SSOToken token,
  IdType type,
  String pattern,
  Map avPairs,
  boolean recursive,
  int maxResults,
  int maxTime,
  Set returnAttrs
) throws IdRepoException, SSOException

public RepoSearchResults search(
  SSOToken token,
  IdType type,
  String pattern,
  int maxTime,
  int maxResults,
  Set returnAttrs,
  boolean returnAllAttrs,
  int filterOp,
  Map avPairs,
  boolean recursive
) throws IdRepoException, SSOException</pre></dd><dt><span class="term">Edit</span></dt><dd><p>OpenAM calls the following methods to update a subject in the
     identity repository.</p><pre class="brush: java;">public void setAttributes(
  SSOToken token,
  IdType type,
  String name,
  Map attributes,
  boolean isAdd
) throws IdRepoException, SSOException

public void setBinaryAttributes(
  SSOToken token,
  IdType type,
  String name,
  Map attributes,
  boolean isAdd
) throws IdRepoException, SSOException

public void removeAttributes(
  SSOToken token,
  IdType type,
  String name,
  Set attrNames
) throws IdRepoException, SSOException

public void modifyMemberShip(
  SSOToken token,
  IdType type,
  String name,
  Set members,
  IdType membersType,
  int operation
) throws IdRepoException, SSOException

public void setActiveStatus(
  SSOToken token,
  IdType type,
  String name,
  boolean active
)</pre></dd><dt><span class="term">Authenticate</span></dt><dd><p>OpenAM calls <code class="literal">authenticate()</code> with the credentials
     from the <code class="literal">DataStore</code> authentication module.</p><pre class="brush: java;">public boolean authenticate(Callback[] credentials)
  throws IdRepoException, AuthLoginException</pre></dd><dt><span class="term">Delete</span></dt><dd><p>The <code class="literal">delete()</code> method removes the subject from
     the identity repository. The <code class="literal">name</code> specifies the
     subject.</p><pre class="brush: java;">public void delete(SSOToken token, IdType type, String name)
  throws IdRepoException, SSOException</pre></dd><dt><span class="term">Service</span></dt><dd><p>The <code class="literal">IdOperation.SERVICE</code> operation is rarely used
     in recent OpenAM deployments.</p></dd></dl></div></div><div class="section" title="18.3.&nbsp;Identity Repository Plugin Deployment"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="idrepo-plugin-deployment"></a>18.3.&nbsp;Identity Repository Plugin Deployment</h2></div></div></div><p>Your IdRepo plugin must link to <code class="filename">amserver.jar</code>,
  which when you deploy OpenAM is
  <code class="filename"><em class="replaceable"><code>war-file-name</code></em>/WEB-INF/lib/amserver.jar</code>.</p><p>You can either package your plugin as a .jar, and then add it to
  <code class="filename"><em class="replaceable"><code>war-file-name</code></em>/WEB-INF/lib/</code>,
  or add the classes under
  <code class="filename"><em class="replaceable"><code>war-file-name</code></em>/WEB-INF/classes/</code>.</p><p>To register your plugin with OpenAM, you add a
  <code class="literal">SubSchema</code> to the
  <code class="literal">sunIdentityRepositoryService</code> using the
  <span class="command"><strong>ssoadm</strong></span> command. First, you create the
  <code class="literal">SubSchema</code> document having the following structure.</p><pre class="brush: xml;">&lt;SubSchema i18nKey="x4000" inheritance="multiple" maintainPriority="no"
           name="CustomRepo" supportsApplicableOrganization="no" validate="yes"&gt;
 &lt;AttributeSchema cosQualifier="default" isSearchable="no"
                  name="RequiredValueValidator" syntax="string"
                  type="validator" &gt;
  &lt;DefaultValues&gt;
   &lt;Value&gt;com.sun.identity.sm.RequiredValueValidator&lt;/Value&gt;
  &lt;/DefaultValues&gt;
 &lt;/AttributeSchema&gt;
 &lt;AttributeSchema any="required" cosQualifier="default"
                  i18nKey="x4001" isSearchable="no"
                  name="sunIdRepoClass" syntax="string"
                  type="single" validator="RequiredValueValidator" &gt;
  &lt;DefaultValues&gt;
   &lt;Value&gt;org.test.CustomRepo&lt;/Value&gt;
  &lt;/DefaultValues&gt;
 &lt;/AttributeSchema&gt;
 &lt;AttributeSchema cosQualifier="default" i18nKey="x4002" isSearchable="no"
                  name="sunIdRepoAttributeMapping" syntax="string" type="list"&gt;
  &lt;DefaultValues&gt;
    &lt;Value&gt;&lt;/Value&gt;
  &lt;/DefaultValues&gt;
 &lt;/AttributeSchema&gt;
&lt;/SubSchema&gt;</pre><p>Also include the <code class="literal">AttributeSchema</code> required to
  configure your IdRepo plugin.</p><p>Notice the <code class="literal">i18nKey</code> attributes on
  <code class="literal">SubSchema</code> elements. The <code class="literal">i18nKey</code>
  attribute values correspond to properties in the
  <code class="filename">amIdRepoService.properties</code> file, stored under
  <code class="filename"><em class="replaceable"><code>war-file-name</code></em>/WEB-INF/classes/</code>.
  OpenAM console displays the label for the configuration user interface that
  it retrieves from the value of the <code class="literal">i18nKey</code> property in the
  <code class="filename">amIdRepoService.properties</code> file.</p><p>Register your plugin using the <span class="command"><strong>ssoadm</strong></span> command after
  copy the files into place.</p><div class="screen"><pre class="brush: plain;">$ ssoadm
 add-sub-schema
 --adminid amadmin
 --password-file /tmp/pwd.txt
 --servicename sunIdentityRepositoryService
 --schematype Organization
 --filename customIdRepo.xml
 --subschemaname CustomRepo</pre></div><p>Login to OpenAM console as administrator, then then Browse to Access
  Control &gt; <em class="replaceable"><code>Realm Name</code></em> &gt; Data Stores. In the
  Data Stores table, click New... to create a Data Store corresponding to your
  custom IdRepo plugin. In the first screen of the wizard, name the Data Store
  and select the type corresponding to your plugin. In the second screen of the
  wizard, add the configuration for your plugin.</p><p>After creating the Data Store, create a new subject in the realm to
  check that your plugin works as expected. You can do this under Access
  Control &gt; <em class="replaceable"><code>Realm Name</code></em> &gt; Subjects.</p><p>If your plugin supports authentication, then users should now be able
  to authenticate using the <code class="literal">DataStore</code> module for the
  realm.</p><pre class="literallayout">http://openam.example.com:8080/openam/UI/Login?realm=test&amp;module=DataStore</pre></div></div><div class="index" title="Index"><div class="titlepage"><div><div><h2 class="title"><a name="d2063e4086"></a>Index</h2></div></div></div><div class="index"><div class="indexdiv"><h3>A</h3><dl><dt>Authentication</dt><dd><dl><dt>Custom module, <a class="indexterm" href="#chap-auth-spi">Customizing Authentication Modules</a></dt><dt>Java API, <a class="indexterm" href="#chap-authentication">Authenticating Using OpenAM Java SDK</a></dt><dt>Post authentication plugins, <a class="indexterm" href="#chap-post-auth">Creating a Post Authentication Plugin</a></dt><dt>REST API, <a class="indexterm" href="#rest-api-auth">Authentication &amp; Logout</a></dt></dl></dd></dl></div><div class="indexdiv"><h3>F</h3><dl><dt>Fedlets</dt><dd><dl><dt>.NET, <a class="indexterm" href="#chap-fedlet-dotnet">Using Fedlets in .NET Applications</a></dt><dt>Java, <a class="indexterm" href="#chap-fedlet-java">Using Fedlets in Java Web Applications</a></dt></dl></dd></dl></div><div class="indexdiv"><h3>I</h3><dl><dt>Installing</dt><dd><dl><dt>C SDK, <a class="indexterm" href="#chap-csdk">Using the OpenAM C API</a></dt><dt>Java SDK, <a class="indexterm" href="#chap-jdk">Using the OpenAM Java SDK</a></dt></dl></dd></dl></div><div class="indexdiv"><h3>O</h3><dl><dt>OAuth 2.0, <a class="indexterm" href="#chap-oauth2-scopes">Customizing OAuth 2.0 Scope Handling</a></dt><dd><dl><dt>REST API, <a class="indexterm" href="#rest-api-oauth2">OAuth 2.0 Authorization</a></dt></dl></dd></dl></div><div class="indexdiv"><h3>P</h3><dl><dt>Policy</dt><dd><dl><dt>Java API, <a class="indexterm" href="#chap-policy-decisions">Requesting Policy Decisions Using OpenAM Java SDK</a></dt><dt>Plugins, <a class="indexterm" href="#chap-policy-spi">Customizing Policy Evaluation</a></dt><dt>REST API, <a class="indexterm" href="#rest-api-authz">Authorization</a></dt></dl></dd></dl></div><div class="indexdiv"><h3>R</h3><dl><dt>REST API, <a class="indexterm" href="#chap-rest">Using RESTful Web Services</a></dt></dl></div><div class="indexdiv"><h3>S</h3><dl><dt>Secure Attribute Exchange (SAE), <a class="indexterm" href="#chap-sae">Using Secure Attribute Exchange</a></dt><dt>Session tokens</dt><dd><dl><dt>Java API, <a class="indexterm" href="#chap-session">Handling Single Sign On Using OpenAM Java SDK</a></dt><dt>REST API, <a class="indexterm" href="#rest-api-auth">Authentication &amp; Logout</a></dt></dl></dd></dl></div><div class="indexdiv"><h3>U</h3><dl><dt>User data</dt><dd><dl><dt>Custom profile attributes, <a class="indexterm" href="#chap-custom-attr">Customizing Profile Attributes</a></dt><dt>Custom repository, <a class="indexterm" href="#chap-identity-repo-spi">Customizing Identity Data Storage</a></dt><dt>REST access, <a class="indexterm" href="#rest-api-tokens">Token Validation &amp; Attribute Retrieval</a>, <a class="indexterm" href="#rest-api-crud-identity">Identity Management</a></dt></dl></dd></dl></div></div></div></div><p>&nbsp;</p><div id="footer"><p>Something wrong on this page? <a href="https://bugster.forgerock.org/jira/secure/CreateIssue.jspa?pid=10000&components=10007&issuetype=1">Log a documentation bug.</a></p></div>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-23412190-7']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</body></html>