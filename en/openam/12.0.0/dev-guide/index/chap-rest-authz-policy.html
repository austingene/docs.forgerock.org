<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head>

      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
   <title>Chapter&nbsp;4.&nbsp;RESTful Authorization and Policy Management Services</title><link rel="stylesheet" type="text/css" href="coredoc.css"><link rel="stylesheet" type="text/css" href="css/coredoc.css"><link rel="stylesheet" type="text/css" href="sh/shCore.css"><link rel="stylesheet" type="text/css" href="sh/shCoreEclipse.css"><link rel="stylesheet" type="text/css" href="sh/shThemeEclipse.css"><script src="http://code.jquery.com/jquery-1.11.0.min.js" type="text/javascript"></script><script src="uses-jquery.js" type="text/javascript"></script><script src="sh/shCore.js" type="text/javascript"></script><script src="sh/shBrushAci.js" type="text/javascript"></script><script src="sh/shBrushBash.js" type="text/javascript"></script><script src="sh/shBrushCsv.js" type="text/javascript"></script><script src="sh/shBrushHttp.js" type="text/javascript"></script><script src="sh/shBrushJava.js" type="text/javascript"></script><script src="sh/shBrushJScript.js" type="text/javascript"></script><script src="sh/shBrushLDIF.js" type="text/javascript"></script><script src="sh/shBrushPlain.js" type="text/javascript"></script><script src="sh/shBrushProperties.js" type="text/javascript"></script><script src="sh/shBrushXml.js" type="text/javascript"></script><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="OpenAM Developer's Guide"><link rel="up" href="index.html" title="OpenAM Developer's Guide"><link rel="prev" href="chap-rest.html" title="Chapter&nbsp;3.&nbsp;RESTful Web Services"><link rel="next" href="chap-rest-oauth2-oidc.html" title="Chapter&nbsp;5.&nbsp;RESTful OAuth 2.0 and OpenID Connect 1.0 Services"><link rel="copyright" href="legalnotice.html" title="Legal Notice"><script type="text/javascript">SyntaxHighlighter.all();</script>
<link rel="shortcut icon" href="http://forgerock.org/favicon.ico">
</head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter&nbsp;4.&nbsp;RESTful Authorization and Policy Management Services</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="chap-rest.html">Prev</a>&nbsp;</td><th width="60%" align="center">&nbsp;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="chap-rest-oauth2-oidc.html">Next</a></td></tr></table><hr></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-rest-authz-policy"></a>Chapter&nbsp;4.&nbsp;RESTful Authorization and Policy Management Services</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="section"><a href="chap-rest-authz-policy.html#rest-api-authz">4.1. About the REST Policy Endpoints</a></span></dt><dt><span class="section"><a href="chap-rest-authz-policy.html#rest-api-authz-policy-decisions">4.2. Requesting Policy Decisions</a></span></dt><dt><span class="section"><a href="chap-rest-authz-policy.html#rest-api-authz-policies">4.3. Managing Policies</a></span></dt><dt><span class="section"><a href="chap-rest-authz-policy.html#rest-api-manage-xacml">4.4. Managing Entitlements through REST</a></span></dt><dt><span class="section"><a href="chap-rest-authz-policy.html#rest-api-authz-applications">4.5. Defining Applications</a></span></dt><dt><span class="section"><a href="chap-rest-authz-policy.html#rest-api-authz-application-types">4.6. Viewing Application Types</a></span></dt><dt><span class="section"><a href="chap-rest-authz-policy.html#rest-api-authz-condition-types">4.7. Viewing Condition Types</a></span></dt><dt><span class="section"><a href="chap-rest-authz-policy.html#rest-api-authz-subject-attributes">4.8. Viewing Subject Attributes</a></span></dt><dt><span class="section"><a href="chap-rest-authz-policy.html#rest-api-authz-subject-types">4.9. Viewing Subject Types</a></span></dt><dt><span class="section"><a href="chap-rest-authz-policy.html#rest-api-authz-decision-combiners">4.10. Viewing Decision Combiners</a></span></dt><dt><span class="section"><a href="chap-rest-authz-policy.html#rest-api-authz-referrals">4.11. Managing Referrals</a></span></dt><dt><span class="section"><a href="chap-rest-authz-policy.html#rest-api-authz-legacy">4.12. Authorization (Legacy API)</a></span></dt><dt><span class="section"><a href="chap-rest-authz-policy.html#rest-api-policy-management">4.13. Managing Policies (Legacy API)</a></span></dt><dt><span class="section"><a href="chap-rest-authz-policy.html#rest-api-policy-management-create">4.14. Creating Policies (Legacy API)</a></span></dt><dt><span class="section"><a href="chap-rest-authz-policy.html#rest-api-policy-management-read">4.15. Reading Policies (Legacy API)</a></span></dt><dt><span class="section"><a href="chap-rest-authz-policy.html#rest-api-policy-management-update">4.16. Updating Policies (Legacy API)</a></span></dt><dt><span class="section"><a href="chap-rest-authz-policy.html#rest-api-policy-management-delete">4.17. Deleting Policies (Legacy API)</a></span></dt><dt><span class="section"><a href="chap-rest-authz-policy.html#rest-api-policy-management-query">4.18. Querying Policies (Legacy API)</a></span></dt></dl></div><a class="indexterm" name="d0e1974"></a><p>This chapter shows how to use the OpenAM RESTful interfaces for authorization
  and policy management and covers the following topics:
 </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
    <a class="xref" href="chap-rest-authz-policy.html#rest-api-authz" title="4.1.&nbsp;About the REST Policy Endpoints">Section&nbsp;4.1, &#8220;About the REST Policy Endpoints&#8221;</a>
   </p></li><li class="listitem"><p>
    <a class="xref" href="chap-rest-authz-policy.html#rest-api-authz-policy-decisions" title="4.2.&nbsp;Requesting Policy Decisions">Section&nbsp;4.2, &#8220;Requesting Policy Decisions&#8221;</a>
   </p></li><li class="listitem"><p>
    <a class="xref" href="chap-rest-authz-policy.html#rest-api-authz-policies" title="4.3.&nbsp;Managing Policies">Section&nbsp;4.3, &#8220;Managing Policies&#8221;</a>
   </p></li><li class="listitem"><p>
    <a class="xref" href="chap-rest-authz-policy.html#rest-api-manage-xacml" title="4.4.&nbsp;Managing Entitlements through REST">Section&nbsp;4.4, &#8220;Managing Entitlements through REST&#8221;</a>
   </p></li><li class="listitem"><p>
    <a class="xref" href="chap-rest-authz-policy.html#rest-api-authz-applications" title="4.5.&nbsp;Defining Applications">Section&nbsp;4.5, &#8220;Defining Applications&#8221;</a>
   </p></li><li class="listitem"><p>
    <a class="xref" href="chap-rest-authz-policy.html#rest-api-authz-application-types" title="4.6.&nbsp;Viewing Application Types">Section&nbsp;4.6, &#8220;Viewing Application Types&#8221;</a>
   </p></li><li class="listitem"><p>
    <a class="xref" href="chap-rest-authz-policy.html#rest-api-authz-condition-types" title="4.7.&nbsp;Viewing Condition Types">Section&nbsp;4.7, &#8220;Viewing Condition Types&#8221;</a>
   </p></li><li class="listitem"><p>
    <a class="xref" href="chap-rest-authz-policy.html#rest-api-authz-subject-types" title="4.9.&nbsp;Viewing Subject Types">Section&nbsp;4.9, &#8220;Viewing Subject Types&#8221;</a>
   </p></li><li class="listitem"><p>
    <a class="xref" href="chap-rest-authz-policy.html#rest-api-authz-decision-combiners" title="4.10.&nbsp;Viewing Decision Combiners">Section&nbsp;4.10, &#8220;Viewing Decision Combiners&#8221;</a>
   </p></li><li class="listitem"><p>
    <a class="xref" href="chap-rest-authz-policy.html#rest-api-authz-referrals" title="4.11.&nbsp;Managing Referrals">Section&nbsp;4.11, &#8220;Managing Referrals&#8221;</a>
   </p></li></ul></div><p>The chapter also describes how to manage policies using the
  backwards-compatible, legacy APIs:
 </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
     <a class="xref" href="chap-rest-authz-policy.html#rest-api-authz-legacy" title="4.12.&nbsp;Authorization (Legacy API)">Section&nbsp;4.12, &#8220;Authorization (Legacy API)&#8221;</a>
    </p></li><li class="listitem"><p>
     <a class="xref" href="chap-rest-authz-policy.html#rest-api-policy-management" title="4.13.&nbsp;Managing Policies (Legacy API)">Section&nbsp;4.13, &#8220;Managing Policies (Legacy API)&#8221;</a>
    </p></li><li class="listitem"><p>
     <a class="xref" href="chap-rest-authz-policy.html#rest-api-policy-management-create" title="4.14.&nbsp;Creating Policies (Legacy API)">Section&nbsp;4.14, &#8220;Creating Policies (Legacy API)&#8221;</a>
    </p></li><li class="listitem"><p>
     <a class="xref" href="chap-rest-authz-policy.html#rest-api-policy-management-read" title="4.15.&nbsp;Reading Policies (Legacy API)">Section&nbsp;4.15, &#8220;Reading Policies (Legacy API)&#8221;</a>
    </p></li><li class="listitem"><p>
     <a class="xref" href="chap-rest-authz-policy.html#rest-api-policy-management-update" title="4.16.&nbsp;Updating Policies (Legacy API)">Section&nbsp;4.16, &#8220;Updating Policies (Legacy API)&#8221;</a>
    </p></li><li class="listitem"><p>
     <a class="xref" href="chap-rest-authz-policy.html#rest-api-policy-management-delete" title="4.17.&nbsp;Deleting Policies (Legacy API)">Section&nbsp;4.17, &#8220;Deleting Policies (Legacy API)&#8221;</a>
    </p></li><li class="listitem"><p>
     <a class="xref" href="chap-rest-authz-policy.html#rest-api-policy-management-query" title="4.18.&nbsp;Querying Policies (Legacy API)">Section&nbsp;4.18, &#8220;Querying Policies (Legacy API)&#8221;</a>
    </p></li></ul></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="rest-api-authz"></a>4.1.&nbsp;About the REST Policy Endpoints</h2></div></div></div><a class="indexterm" name="d0e2071"></a><p>
   OpenAM provides REST APIs both for requesting policy decisions,
   and also for administering policy definitions.
  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
     Under <code class="literal">/json[/<em class="replaceable"><code>realm</code></em>]/policies</code>,
     you find the newer JSON-based APIs.
    </p></li><li class="listitem"><p>
     Under
     <code class="literal">/json[/<em class="replaceable"><code>realm</code></em>]/applications</code>
     and <code class="literal">/json/applicationtypes</code>
     you find JSON-based APIs
     for administering applications and reading application types.
    </p></li><li class="listitem"><p>
     Under <code class="literal">/json/conditiontypes</code> you find a JSON-based API
     for viewing what types of conditions you can use when defining policies.
    </p></li><li class="listitem"><p>
     Under <code class="literal">/json/subjecttypes</code> you find a JSON-based API
     for viewing what types of subjects you can use when defining policies.
    </p></li><li class="listitem"><p>
     Under <code class="literal">/json/decisioncombiners</code> you find a JSON-based API
     for viewing implementations you can use when defining policies
     to specify how to combine results when multiple policies apply.
    </p></li><li class="listitem"><p>
     Under <code class="literal">/identity/authorize</code>
     and <code class="literal">/ws/1/entitlement/</code>,
     you find the backwards-compatible, legacy APIs.
     See <a class="xref" href="chap-rest-authz-policy.html#rest-api-authz-legacy" title="4.12.&nbsp;Authorization (Legacy API)">Section&nbsp;4.12, &#8220;Authorization (Legacy API)&#8221;</a> below.
    </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="rest-api-authz-policy-decisions"></a>4.2.&nbsp;Requesting Policy Decisions</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="chap-rest-authz-policy.html#rest-api-authz-policy-decision-concrete">4.2.1. Requesting Policy Decisions For Specific Resources</a></span></dt><dt><span class="section"><a href="chap-rest-authz-policy.html#rest-api-authz-policy-decision-advice">4.2.2. Policy Decision Advice</a></span></dt><dt><span class="section"><a href="chap-rest-authz-policy.html#rest-api-authz-policy-decision-subtree">4.2.3. Requesting Policy Decisions For a Tree of Resources</a></span></dt></dl></div><p>
   You can request policy decisions from OpenAM
   by using the REST APIs described in this section.
   OpenAM evaluates the request
   based on the context and the policies configured,
   and returns decision that indicate what actions are allowed or denied,
   as well as any attributes or advice
   for the resources specified.
  </p><p>
   To request a decision for specific resources,
   see <a class="xref" href="chap-rest-authz-policy.html#rest-api-authz-policy-decision-concrete" title="4.2.1.&nbsp;Requesting Policy Decisions For Specific Resources">Section&nbsp;4.2.1, &#8220;Requesting Policy Decisions For Specific Resources&#8221;</a>.
  </p><p>
   To request decisions for a resource and all resources beneath it,
   see <a class="xref" href="chap-rest-authz-policy.html#rest-api-authz-policy-decision-subtree" title="4.2.3.&nbsp;Requesting Policy Decisions For a Tree of Resources">Section&nbsp;4.2.3, &#8220;Requesting Policy Decisions For a Tree of Resources&#8221;</a>.
  </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="rest-api-authz-policy-decision-concrete"></a>4.2.1.&nbsp;Requesting Policy Decisions For Specific Resources</h3></div></div></div><p>
    This section shows how you can request a policy decision over REST
    for specific resources.
   </p><p>
    To request policy decisions for specific resources,
    perform an HTTP POST using the evaluation action
    to the appropriate path under the URI where OpenAM is deployed,
    <code class="literal">/json[/<em class="replaceable"><code>realm</code></em>][/
     <em class="replaceable"><code>subrealm</code></em>]/policies?_action=evaluate</code>,
    where <em class="replaceable"><code>realm</code></em> optionally specifies the realm.
    The payload for the HTTP POST is a JSON object
    that specifies at least the resources,
    and takes the following form.
   </p><pre class="brush: javascript;">
{
    "resources": [
        "resource1",
        "resource2",
        ...,
        "resourceN"
    ],
    "application": "defaults to iPlanetAMWebAgentService if not specified",
    "subject": {
        "ssoToken": "SSO token ID string",
        "jwt": "JSON Web Token string",
        "claims": {
            "key": "value",
            ...
        }
    },
    "environment": {
        "optional key1": [
            "value",
            "another value",
            ...
        ],
        "optional key2": [
            "value",
            "another value",
            ...
        ],
        ...
    }
}
     </pre><div class="variablelist"><p>
     The values for the fields shown above are explained below:
    </p><dl class="variablelist"><dt><span class="term"><code class="literal">"resources"</code></span></dt><dd><p>
       This required field specifies the list of resources
       for which to return decisions.
      </p><p>
       For example, when using the default application,
       <code class="literal">"iPlanetAMWebAgentService"</code>,
       you can request decisions for resource URLs.
      </p><pre class="brush: javascript;">
{
    "resources": [
        "http://www.example.com/index.html",
        "http://www.example.com/do?action=run"
    ]
}
      </pre></dd><dt><span class="term"><code class="literal">"application"</code></span></dt><dd><p>
       This field holds the name of the application,
       and defaults to <code class="literal">"iPlanetAMWebAgentService"</code>
       if not specified.
      </p><p>
       For more on available applications,
       see <a class="xref" href="chap-rest-authz-policy.html#rest-api-authz-applications" title="4.5.&nbsp;Defining Applications">Section&nbsp;4.5, &#8220;Defining Applications&#8221;</a>.
      </p></dd><dt><span class="term"><code class="literal">"subject"</code></span></dt><dd><p>
      </p><div class="variablelist"><p>
        This optional field holds an object that represents the subject.
        You can specify one or more of the following keys.
        If you specify multiple keys,
        the subject can have multiple associated principals,
        and you can use subject conditions corresponding to any type in the request.
       </p><dl class="variablelist"><dt><span class="term">"ssoToken"</span></dt><dd><p>
          The value is the SSO token ID string for the subject,
          returned for example on successful authentication as described in,
          <a href="../../dev-guide/index/chap-rest.html#rest-api-auth-json" class="link"><em class="citetitle">REST APIs for Authentication &amp; Logout</em></a>.
         </p></dd><dt><span class="term">"claims"</span></dt><dd><p>
          The value is an object (map) of JWT claims to their values.
         </p></dd><dt><span class="term">"jwt"</span></dt><dd><p>
          The value is a JWT string.
         </p></dd></dl></div><p>
       If you do not specify the subject,
       OpenAM uses the SSO token ID of the subject making the request.
      </p></dd><dt><span class="term"><code class="literal">"environment"</code></span></dt><dd><p>
       This optional field holds a map of keys to lists of values.
      </p><p>
       If you do not specify the environment, the default is an empty map.
      </p></dd></dl></div><p>
    The example below requests policy decisions for two URL resources.
    The <code class="literal">iPlanetDirectoryPro</code> header sets the SSO token
    for a user who has access to perform the operation.
   </p><pre class="brush: plain;">
$ curl \
 --request POST \
 --header "iPlanetDirectoryPro: AQIC5..." \
 --header "Content-Type: application/json" \
 --data '{
    "resources": [
        "http://www.example.com/index.html",
        "http://www.example.com/do?action=run"
    ],
    "application": "iPlanetAMWebAgentService"
 }' \
 https://openam.example.com:8443/openam/json/myRealm/policies?_action
    =evaluate
[ {
  "resource" : "http://www.example.com:80/do?action=run",
  "actions" : {
  },
  "attributes" : {
  },
  "advices" : {
    "AuthLevelConditionAdvice" : [ "/myRealm:3" ]
  }
}, {
  "resource" : "http://www.example.com:80/index.html",
  "actions" : {
    "POST" : false,
    "GET" : true
  },
  "attributes" : {
    "cn" : [ "demo" ]
  },
  "advices" : {
  }
} ]
     </pre><div class="variablelist"><p>
     In the JSON list of decisions returned for each resource,
     OpenAM includes a these fields.
    </p><dl class="variablelist"><dt><span class="term"><code class="literal">"resource"</code></span></dt><dd><p>
       A resource specified in the request.
      </p><p>
       Notice that the resources are normalized.
       In the example, the request does not explicitly specify port 80,
       but the response does show the port number.
       Notice also that the decisions returned are not guaranteed
       to be in the same order as the resources were requested.
      </p></dd><dt><span class="term"><code class="literal">"actions"</code></span></dt><dd><p>
       A map of action name keys
       to Boolean values that indicate whether
       the action is allowed (<code class="literal">true</code>)
       or denied (<code class="literal">false</code>)
       for the specified resource.
      </p><p>
       In the example,
       for resource <code class="literal">http://www.example.com:80/index.html</code>
       HTTP GET is allowed, whereas HTTP POST is denied.
      </p></dd><dt><span class="term"><code class="literal">"attributes"</code></span></dt><dd><p>
       A map of attribute names to their values,
       if any resource attributes are returned
       according to applicable policies.
      </p><p>
       In the example, the policy that applies
       to <code class="literal">http://www.example.com:80/index.html</code>
       causes that the value of the subject's "cn" profile attribute
       to be returned.
      </p></dd><dt><span class="term"><code class="literal">"advices"</code></span></dt><dd><p>
       A map of advice names to their values,
       if any advice is returned according to applicable policies.
      </p><p>
       The <code class="literal">"advices"</code> field can provide hints
       regarding what OpenAM needs to take the authorization decision.
      </p><p>
       In the example, the policy that applies
       to <code class="literal">http://www.example.com:80/do?action=run</code>
       requests that the subject be authenticated
       in realm <code class="literal">/myRealm</code>
       at an authentication level of at least 3.
      </p><pre class="brush: javascript;">
{
    "advices": {
        "AuthLevelConditionAdvice": [
            "/myRealm:3"
        ]
    }
}
      </pre><p>
       See <a class="xref" href="chap-rest-authz-policy.html#rest-api-authz-policy-decision-advice" title="4.2.2.&nbsp;Policy Decision Advice">Section&nbsp;4.2.2, &#8220;Policy Decision Advice&#8221;</a> for details.
      </p></dd></dl></div><p>
    You can use the query string parameters
    <code class="literal">_prettyPrint=true</code> to make the output easier to read,
    and <code class="literal">_fields=<em class="replaceable"><code>field-name</code></em>[,<em class="replaceable"><code>field-name</code></em>...]</code>
    to limit the fields returned in the output.
   </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="rest-api-authz-policy-decision-advice"></a>4.2.2.&nbsp;Policy Decision Advice</h3></div></div></div><p>
    When OpenAM returns a policy decision,
    the JSON for the decision can include an "advices" field.
    This field contains hints for the policy enforcement point.
   </p><pre class="brush: javascript;">
{
    "advices": {
        "type": [
            "advice"
        ]
    }
}
   </pre><p>
    The "advices" returned depend on policy conditions.
    This section shows examples of the many different types
    of policy decision advice
    and the conditions that cause OpenAM to return the advice.
   </p><p>
    An "AttributeLookup" condition failure can result in advice
    showing the value and attribute expected.
    For example, failure against a policy with the following condition:
   </p><pre class="brush: javascript;">
{
    "type": "AttributeLookup",
    "key": "postaladdress",
    "value": "33 New Montgomery St."
}
   </pre><p>
    Leads to this advice:
   </p><pre class="brush: javascript;">
{
    "com.sun.identity.entitlement.AttributeLookupCondition": [
        "33 New Montgomery St.=postaladdress"
    ]
}
   </pre><p>
    A "DNSName" condition failure can result in advice
    showing the domain name mask.
    For example, the following condition:
   </p><pre class="brush: javascript;">
{
    "type": "DNSName",
    "domainNameMask": "*.example.org"
}
   </pre><p>
    Leads to this advice:
   </p><pre class="brush: javascript;">
{
    "com.sun.identity.entitlement.DNSNameCondition": [
        "requestDnsName=*.example.org"
    ]
}
   </pre><p>
    An "IP" condition failure can result in advice
    showing the request IP address range allowed.
    For example, the following condition:
   </p><pre class="brush: javascript;">
{
    "type": "IP",
    "startIp": "127.0.0.1",
    "endIp": "127.0.1.255"
}
   </pre><p>
    Leads to this advice:
   </p><pre class="brush: javascript;">
{
    "com.sun.identity.entitlement.IPCondition": [
        "requestIp=127.0.0.1-127.0.1.255"
    ]
}
   </pre><p>
    A "NumericAttribute" condition failure can result in advice
    showing the expectations about the attribute value,
    where the operator is one of <code class="literal">&lt; &lt;= = &gt;= &gt;</code>.
    For example, the following condition:
   </p><pre class="brush: javascript;">
{
    "type": "NumericAttribute",
    "attributeName": "gidNumber",
    "operator": "LESS_THAN",
    "value": "1000"
}
   </pre><p>
    Leads to this advice:
   </p><pre class="brush: javascript;">
{
    "com.sun.identity.entitlement.NumericAttributeCondition": [
        "gidNumber&lt;1000.0"
    ]
}
   </pre><p>
    A "StringAttribute" condition failure can result in advice
    showing the expectation about the value of the attribute.
    For example, the following condition:
   </p><pre class="brush: javascript;">
{
    "type": "StringAttribute",
    "attributeName": "location",
    "caseSensitive": false,
    "value": "Bristol"
}
   </pre><p>
    Leads to this advice:
   </p><pre class="brush: javascript;">
{
    "com.sun.identity.entitlement.StringAttributeCondition": [
        "location=Bristol"
    ]
}
   </pre><p>
    If "caseSensitive" in the policy condition is true,
    then OpenAM appends <code class="literal">(casesensitive)</code> to the value
    in the advice.
   </p><p>
    A "Time" condition evaluation returns advice
    showing the window during which the condition is satisfied.
    If the condition is satisfied, then
    "timeToLive" specifies the time in milliseconds until the end of the window.
    "maxTime" specifies the date in milliseconds at the end of the window.
    If the condition is not satisfied, then
    "timeToLive" specifies the time in milliseconds until the start of the window.
    "maxTime" specifies the date in milliseconds at the start of the window.
    For example, given the following condition:
   </p><pre class="brush: javascript;">
{
    "type": "Time",
    "startTime": "10:00",
    "endTime": "16:30"
}
   </pre><p>
    The following example shows advice returned:
   </p><pre class="brush: javascript;">
{
    "maxTime": [
        "1410273000000"
    ],
    "timeToLive": [
        "19648817"
    ]
}
   </pre><p>
    If it is necessary to authenticate again,
    OpenAM can return the following advice:
   </p><pre class="brush: javascript;">
{
    "ForceAuth": [
        "true"
    ]
}
   </pre><p>
    Failure against a policy with the following condition:
   </p><pre class="brush: javascript;">
{
    "type": "Policy",
    "className": "com.sun.identity.policy.plugins.AuthenticateToRealmCondition",
    "name": "realm",
    "properties": {
        "AuthenticateToRealm": [
            "/myRealm"
        ]
    }
}
   </pre><p>
    Leads to this advice:
   </p><pre class="brush: javascript;">
{
    "AuthenticateToRealmConditionAdvice": [
        "/myRealm"
    ]
}
   </pre><p>
    Failure against a policy with the following condition:
   </p><pre class="brush: javascript;">
{
    "type": "Policy",
    "className": "com.sun.identity.policy.plugins.AuthenticateToServiceCondition",
    "name": "Require MyAuthnChain",
    "properties": {
        "AuthenticateToService": [
            "MyAuthnChain"
        ]
    }
}
   </pre><p>
    Leads to this advice:
   </p><pre class="brush: javascript;">
{
    "AuthenticateToServiceConditionAdvice": [
        "MyAuthnChain"
    ]
}
   </pre><p>
    Failure against a policy with the following condition:
   </p><pre class="brush: javascript;">
{
    "type": "Policy",
    "className": "com.sun.identity.policy.plugins.AuthLevelCondition",
    "name": "AuthnLevelAtLeast5",
    "properties": {
        "AuthLevel": [
            "5"
        ]
    }
}
   </pre><p>
    Leads to this advice:
   </p><pre class="brush: javascript;">
{
    "AuthLevelConditionAdvice": [
        "5"
    ]
}
   </pre><p>
    Failure against a policy with the following condition:
   </p><pre class="brush: javascript;">
{
    "type": "Policy",
    "className": "com.sun.identity.policy.plugins.AuthSchemeCondition",
    "name": "RequireHOTP",
    "properties": {
        "AuthScheme": [
            "HOTP"
        ]
    }
}
   </pre><p>
    Leads to this advice:
   </p><pre class="brush: javascript;">
{
    "AuthSchemeConditionAdvice": [
        "HOTP"
    ]
}
   </pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="rest-api-authz-policy-decision-subtree"></a>4.2.3.&nbsp;Requesting Policy Decisions For a Tree of Resources</h3></div></div></div><p>
    This section shows how you can request policy decisions over REST
    for a resource and all other resources in the subtree beneath it.
   </p><p>
    To request policy decisions for a tree of resources,
    perform an HTTP POST using the evaluation action to the appropriate path
    under the URI where OpenAM is deployed,
    <code class="literal">/json[/<em class="replaceable"><code>realm</code></em>]/policies?_action=evaluateTree</code>,
    where <em class="replaceable"><code>realm</code></em> optionally specifies the realm.
    The payload for the HTTP POST is a JSON object that specifies
    at least the root resource, and takes the following form.
   </p><pre class="brush: javascript;">
{
    "resource": "resource string",
    "application": "defaults to iPlanetAMWebAgentService if not specified",
    "subject": {
        "ssoToken": "SSO token ID string",
        "jwt": "JSON Web Token string",
        "claims": {
            "key": "value",
            ...
        }
    },
    "environment": {
        "optional key1": [
            "value",
            "another value",
            ...
        ],
        "optional key2": [
            "value",
            "another value",
            ...
        ],
        ...
    }
}
   </pre><div class="variablelist"><p>
     The values for the fields shown above are explained below:
    </p><dl class="variablelist"><dt><span class="term"><code class="literal">"resource"</code></span></dt><dd><p>
       This required field specifies the root resource
       for the decisions to return.
      </p><p>
       For example, when using the default application,
       <code class="literal">"iPlanetAMWebAgentService"</code>,
       you can request decisions for resource URLs.
      </p><pre class="brush: javascript;">
{
    "resource": "http://www.example.com/"
}
      </pre></dd><dt><span class="term"><code class="literal">"application"</code></span></dt><dd><p>
       This field holds the name of the application,
       and defaults to <code class="literal">"iPlanetAMWebAgentService"</code>
       if not specified.
      </p><p>
       For more on available applications,
       see <a class="xref" href="chap-rest-authz-policy.html#rest-api-authz-applications" title="4.5.&nbsp;Defining Applications">Section&nbsp;4.5, &#8220;Defining Applications&#8221;</a>.
      </p></dd><dt><span class="term"><code class="literal">"subject"</code></span></dt><dd><p>
      </p><div class="variablelist"><p>
        This optional field holds an object that represents the subject.
        You can specify one or more of the following keys.
        If you specify multiple keys,
        the subject can have multiple associated principals,
        and you can use subject conditions corresponding to any type in the request.
       </p><dl class="variablelist"><dt><span class="term">"ssoToken"</span></dt><dd><p>
          The value is the SSO token ID string for the subject,
          returned for example on successful authentication as described in,
          <a href="../../dev-guide/index/chap-rest.html#rest-api-auth-json" class="link"><em class="citetitle">REST APIs for Authentication &amp; Logout</em></a>.
         </p></dd><dt><span class="term">"claims"</span></dt><dd><p>
          The value is an object (map) of JWT claims to their values.
         </p></dd><dt><span class="term">"jwt"</span></dt><dd><p>
          The value is a JWT string.
         </p></dd></dl></div><p>
       If you do not specify the subject,
       OpenAM uses the SSO token ID of the subject making the request.
      </p></dd><dt><span class="term"><code class="literal">"environment"</code></span></dt><dd><p>
       This optional field holds a map of keys to lists of values.
      </p><p>
       If you do not specify the environment, the default is an empty map.
      </p></dd></dl></div><p>
    The example below requests policy decisions
    for <code class="literal">http://www.example.com/</code>.
    The <code class="literal">iPlanetDirectoryPro</code> header sets the SSO token
    for a user who has access to perform the operation,
    and the subject takes the SSO token of the user
    who wants to access a resource.
   </p><pre class="brush: plain;">
$ curl \
 --request POST \
 --header "iPlanetDirectoryPro: AQIC5...NDU1*" \
 --header "Content-Type: application/json" \
 --data '{
    "resource": "http://www.example.com/",
    "subject": { "ssoToken": "AQIC5...zE4*" }
 }' \
 https://openam.example.com:8443/openam/json/myRealm/policies?_action=evaluateTree
[ {
  "resource" : "http://www.example.com:80/",
  "actions" : {
    "GET" : true,
    "OPTIONS" : true,
    "HEAD" : true
  },
  "attributes" : {
  },
  "advices" : {
  }
}, {
  "resource" : "http://www.example.com:80/*",
  "actions" : {
    "POST" : false,
    "PATCH" : false,
    "GET" : true,
    "DELETE" : true,
    "OPTIONS" : true,
    "HEAD" : true,
    "PUT" : true
  },
  "attributes" : {
    "myStaticAttr" : [ "myStaticValue" ]
  },
  "advices" : {
  }
}, {
  "resource" : "http://www.example.com:80/*?*",
  "actions" : {
    "POST" : false,
    "PATCH" : false,
    "GET" : false,
    "DELETE" : false,
    "OPTIONS" : true,
    "HEAD" : false,
    "PUT" : false
  },
  "attributes" : {
  },
  "advices" : {
    "AuthLevelConditionAdvice" : [ "/:3" ]
  }
} ]
  </pre><p>
    Notice that OpenAM returns decisions not only for the specified resource,
    but also for matching resource names
    in the tree whose root is the specified resource.
   </p><div class="variablelist"><p>
     In the JSON list of decisions returned for each resource,
     OpenAM includes a these fields.
    </p><dl class="variablelist"><dt><span class="term"><code class="literal">"resource"</code></span></dt><dd><p>
       A resource name whose root is the resource specified in the request.
      </p><p>
       Notice that the resources are normalized.
       In the example, the request does not explicitly specify port 80,
       but the response does show the port number.
      </p></dd><dt><span class="term"><code class="literal">"actions"</code></span></dt><dd><p>
       A map of action name keys
       to Boolean values that indicate whether
       the action is allowed (<code class="literal">true</code>)
       or denied (<code class="literal">false</code>)
       for the specified resource.
      </p><p>
       In the example, for matching resources with a query string
       only HTTP OPTIONS is allowed according to the policies configured.
      </p></dd><dt><span class="term"><code class="literal">"attributes"</code></span></dt><dd><p>
       A map of attribute names to their values,
       if any resource attributes are returned
       according to applicable policies.
      </p><p>
       In the example, the policy that applies
       to <code class="literal">http://www.example.com:80/*</code>
       causes a static attribute to be returned.
      </p></dd><dt><span class="term"><code class="literal">"advices"</code></span></dt><dd><p>
       A map of advice names to their values,
       if any advice is returned according to applicable policies.
      </p><p>
       The <code class="literal">"advices"</code> field can provide hints
       regarding what OpenAM needs to take the authorization decision.
      </p><p>
       In the example, the policy that applies
       to resources with a query string
       requests that the subject be authenticated
       at an authentication level of at least 3.
      </p><pre class="brush: javascript;">
{
    "advices": {
        "AuthLevelConditionAdvice": [ "/:3" ]
    }
}
      </pre></dd></dl></div><p>
    You can use the query string parameters
    <code class="literal">_prettyPrint=true</code> to make the output easier to read,
    and <code class="literal">_fields=<em class="replaceable"><code>field-name</code></em>[,<em class="replaceable"><code>field-name</code></em>...]</code>
    to limit the fields returned in the output.
   </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="rest-api-authz-policies"></a>4.3.&nbsp;Managing Policies</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="chap-rest-authz-policy.html#rest-api-authz-policies-create">4.3.1. Creating Policies</a></span></dt><dt><span class="section"><a href="chap-rest-authz-policy.html#rest-api-authz-policies-read">4.3.2. Reading Policies</a></span></dt><dt><span class="section"><a href="chap-rest-authz-policy.html#rest-api-authz-policies-update">4.3.3. Updating Policies</a></span></dt><dt><span class="section"><a href="chap-rest-authz-policy.html#rest-api-authz-policies-delete">4.3.4. Deleting Policies</a></span></dt><dt><span class="section"><a href="chap-rest-authz-policy.html#rest-api-authz-policies-query">4.3.5. Listing Policies</a></span></dt></dl></div><p>
   Policy resources are represented in JSON and take the following form.
   Policy resources are built from standard JSON objects and values
   (strings, numbers, objects, arrays, <code class="literal">true</code>,
   <code class="literal">false</code>, and <code class="literal">null</code>).
  </p><pre class="brush: javascript;">
{
   "name": "test",
   "active": true,
   "description": "A test policy",
   "resources": [
           "http://www.example.com:80/*"
   ],
   "applicationName": "application name",
   "actionValues": {
       "read": true,
       "write": false
   },
   "subject": {
       "a subject or": "a composite of subjects"
   },
   "condition": {
       "a condition or": "a composite of conditions"
   },
   "resourceAttributes": [
       {
           "type": "Static",
           "propertyName": "name",
           "propertyValues": [
               "value"
           ]
       },
       {
           "type": "User",
           "propertyName": "profile attribute",
           "propertyValues": [
               "profile attribute", ...
           ]
       },
   ]
}
  </pre><div class="variablelist"><p>
    The values for the fields shown in the example are explained below:
   </p><dl class="variablelist"><dt><span class="term"><code class="literal">"name"</code></span></dt><dd><p>
      String matching the name
      in the URL used when creating the policy by HTTP PUT
      or in the body when creating the policy by HTTP POST.
     </p></dd><dt><span class="term"><code class="literal">"active"</code></span></dt><dd><p>
      Boolean indicating whether OpenAM considers the policy active
      for evaluation purposes, defaults to <code class="literal">false</code>.
     </p></dd><dt><span class="term"><code class="literal">"description"</code></span></dt><dd><p>
      String describing the policy.
     </p></dd><dt><span class="term"><code class="literal">"resources"</code></span></dt><dd><p>
      List of the resource name pattern strings
      to which the policy applies.
     </p></dd><dt><span class="term"><code class="literal">"applicationName"</code></span></dt><dd><p>
      String application name,
      such as <code class="literal">"iPlanetAMWebAgentService"</code>,
      <code class="literal">"crestPolicyService"</code>,
      or some other application name.
     </p></dd><dt><span class="term"><code class="literal">"actionValues"</code></span></dt><dd><p>
      Set of string action names,
      each set to a boolean indicating whether the action is allowed.
     </p><p>
      Action values can also be expressed as numeric values. When using
      numeric values, use the value <code class="literal">0</code> for
      <code class="literal">false</code> and use any non-zero numeric
      value for <code class="literal">true</code>.
     </p></dd><dt><span class="term"><code class="literal">"subject"</code></span></dt><dd><p>
      Specifies the subjects to which the policy applies,
      where subjects can be combined by using the built-in types
      <code class="literal">"AND"</code>, <code class="literal">"OR"</code>,
      and <code class="literal">"NOT"</code>,
      and where subject implementations are pluggable.
     </p><p>
      Subjects are shown as JSON objects
      with <code class="literal">"type"</code> set to the name of the implementation
      (using a short name for all registered subject implementations),
      and also other fields depending on the implementation.
      The subject types registered by default include the following.
     </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        <code class="literal">"AnyUser"</code>, meaning any authenticated user.
       </p></li><li class="listitem"><p>
        <code class="literal">"Attribute"</code> to specify attributes
        of the subject's profile as in the following example:
       </p><pre class="brush: javascript;">
{
   "subject": {
       "type": "Attribute",
       "id": "mail",
       "value": "test@example.com"
   }
}
       </pre></li><li class="listitem"><p>
        <code class="literal">"Group"</code> to specify a particular group
         as in the following example:
       </p><pre class="brush: javascript;">
{
   "subject": {
       "type": "Group",
       "id": "id=HR Managers,ou=group,dc=openam,dc=forgerock,dc=org"
   }
}
       </pre></li><li class="listitem"><p>
        <code class="literal">"NONE"</code>, meaning no subject.
       </p></li><li class="listitem"><p>
        <code class="literal">"Role"</code> to specify a particular OpenAM role
        as in the following example:
       </p><pre class="brush: javascript;">
{
   "subject": {
       "type": "Role",
       "id": "id=admins,ou=role,dc=openam,dc=forgerock,dc=org"
   }
}
       </pre></li><li class="listitem"><p>
        <code class="literal">"User"</code> to specify a particular user
        as in the following example:
       </p><pre class="brush: javascript;">
{
   "subject": {
       "type": "User",
       "id": "id=bob,ou=user,dc=openam,dc=forgerock,dc=org"
   }
}
       </pre></li></ul></div><p>
      <code class="literal">"Policy"</code> subject types can be used
      to correspond to the subject configured for policies
      as in the following example:
     </p><pre class="brush: javascript;">
{
   "type": "Policy",
   "name": "All authenticated users",
   "className": "com.sun.identity.policy.plugins.AuthenticatedUsers",
   "values": []
}
     </pre><p>
      The following example defines the subject
      either as Bob Dobbs or as a member of the HR Managers group.
     </p><pre class="brush: javascript;">
{
   "subject": {
       "type": "OR",
       "subjects": [
           {
               "subject": {
                   "type": "User",
                   "id": "id=bob,ou=user,dc=openam,dc=forgerock,dc=org"
               }
           },
           {
               "subject": {
                   "type": "Group",
                   "id": "id=HR Managers,ou=group,dc=openam,dc=forgerock,dc=org"
               }
           }
       ]
   }
}
     </pre><p>
      To read a subject type description,
      or to list available subject types,
      see <a class="xref" href="chap-rest-authz-policy.html#rest-api-authz-subject-types" title="4.9.&nbsp;Viewing Subject Types">Section&nbsp;4.9, &#8220;Viewing Subject Types&#8221;</a>.
     </p></dd><dt><span class="term"><code class="literal">"condition"</code></span></dt><dd><p>
      Specifies additional conditions, where conditions can be combined
      by using the built-in types <code class="literal">"AND"</code>,
      <code class="literal">"OR"</code>, and <code class="literal">"NOT"</code>,
      and where condition implementations are pluggable.
     </p><p>
      Conditions are shown as JSON objects
      with <code class="literal">"type"</code> set to the name of the implementation
      (using a short name for all registered condition implementations),
      and also other fields depending on the implementation.
      The condition types registered by default include the following.
     </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
        <code class="literal">"AttributeLookup"</code> to specify
         a value to match in the resource as in the following example:
       </p><pre class="brush: javascript;">
{
   "type": "AttributeLookup",
   "key": "postaladdress",
   "value": "33 New Montgomery St."
}
       </pre></li><li class="listitem"><p>
        <code class="literal">"DNSName"</code> to specify domain names
        where the request originated as in the following example:
       </p><pre class="brush: javascript;">
{
   "type": "DNSName",
   "domainNameMask": "*.example.com"
}
       </pre></li><li class="listitem"><p>
        <code class="literal">"IP"</code> to specify an IP address range
        as in the following example:
       </p><pre class="brush: javascript;">
{
   "type": "IP",
   "startIp": "127.0.0.1",
   "endIp": "127.0.0.255"
}
       </pre></li><li class="listitem"><p>
        <code class="literal">"NumericAttribute"</code> to specify a value or range
        for a numeric attribute from the subject's user profile
        as in the following example:
       </p><pre class="brush: javascript;">
{
   "type": "NumericAttribute",
   "attributeName": "gidNumber",
   "operator": "LESS_THAN",
   "value": "1000"
}
       </pre><p>
        <code class="literal">"operator"</code> is optional, but if used
        it must be one of the following comparison operators:
        <code class="literal">LESS_THAN</code>,
        <code class="literal">LESS_THAN_OR_EQUAL</code>,
        <code class="literal">EQUAL</code>,
        <code class="literal">GREATER_THAN_OR_EQUAL</code>, or
        <code class="literal">GREATER_THAN</code>.
        Note that using symbols such as &lt;, &lt;=,=,&gt;=, or &gt; is not
        supported.
        If not specified, then OpenAM checks for equality (<code class="literal">EQUAL</code>).
       </p></li><li class="listitem"><p>
        <code class="literal">"StringAttribute"</code> to specify a value
        for a string-valued attribute from the subject's user profile
        as in the following example:
       </p><pre class="brush: javascript;">
{
    "type": "StringAttribute",
    "attributeName": "location",
    "caseSensitive": false,
    "value": "Bristol"
}
       </pre></li><li class="listitem"><p>
        <code class="literal">"Time"</code> to specify a time range,
        where type is the only required field in the following example:
       </p><pre class="brush: javascript;">
{
    "type": "Time",
    "startTime": "08:30",
    "endTime": "17:30",
    "startDay": "MONDAY",
    "endDay": "FRIDAY",
    "startDate": "01/01/2014",
    "endDate": "12/31/2014",
    "enforcementTimeZone": "GMT-8"
}
       </pre></li></ul></div><p>
      <code class="literal">"Policy"</code> condition types can be used
      to correspond to the conditions configured for policies
      as in the following example:
     </p><pre class="brush: javascript;">
{
    "type": "Policy",
    "className": "org.forgerock.openam.entitlement.conditions.environment
      .OAuth2ScopeCondition",
    "name": "oauth2scope",
    "properties": {
        "OAuth2Scope": [
            "openid profile"
        ]
    }
}
     </pre><p>
      The following example defines the condition as
      neither Saturday or Sunday, nor certain client IP addresses.
     </p><pre class="brush: javascript;">
{
    "type": "NOT",
    "condition": {
        "type": "OR",
        "conditions": [
            {
                "type": "Time",
                "startDay": "SATURDAY",
                "endDay": "SUNDAY",
                "enforcementTimeZone": "GMT"
            },
            {
                "type": "IP",
                "startIp": "192.168.0.1",
                "endIp": "192.168.0.255"
            }
        ]
    }
}
     </pre><p>
       To read a condition type description,
       or to list available condition types,
       see <a class="xref" href="chap-rest-authz-policy.html#rest-api-authz-condition-types" title="4.7.&nbsp;Viewing Condition Types">Section&nbsp;4.7, &#8220;Viewing Condition Types&#8221;</a>.
      </p></dd><dt><span class="term"><code class="literal">"resourceAttributes"</code></span></dt><dd><p>
      List of resource attributes to return with decisions,
      where resource attribute implementations are pluggable.
     </p><p>The default implementations provide
      for statically defined attributes
      and for attributes retrieved from user profiles.
     </p><p>
      Attributes are shown as JSON objects
      with <code class="literal">"type"</code> set to the name of the implementation
      (by default either
      <code class="literal">"Static"</code> for statically defined attributes
      or <code class="literal">"User"</code> for attributes from the user profile),
      <code class="literal">"propertyName"</code> set to the attribute names.
      In the current implementation,
      <code class="literal">"propertyValues"</code> also holds attribute names
      rather than attribute values.
     </p></dd></dl></div><p>
   The examples above do not show the fields added to a policy by OpenAM
   to indicate when the policy was created and last updated, and by whom.
   Those field are
   <code class="literal">"createdBy"</code> and <code class="literal">"lastModifiedBy"</code>,
   which take strings holding universal identifier DNs as their values,
   and <code class="literal">"creationDate"</code> and <code class="literal">"lastModified"</code>,
   which take strings holding ISO-8601 timestamps.
  </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="rest-api-authz-policies-create"></a>4.3.1.&nbsp;Creating Policies</h3></div></div></div><p>
    To create a policy,
    either perform an HTTP PUT indicating the full path to the resource
    and the name in the resource matching the name in the path,
    or perform an HTTP POST with the name to use specified in the resource.
   </p><p>
    The HTTP PUT form includes the policy definition as the JSON resource data,
    with the header <code class="literal">Content-Type: application/json</code>
    and uses the <code class="literal">If-None-Match: *</code> header.
   </p><p>
    The <code class="literal">iPlanetDirectoryPro</code> header sets the SSO token
    for a user who has access to perform the operation.
   </p><p lang="en">
  Do not use special characters within policy, application or referral names
  (for example, "my+referral") using the Policy Editor or REST endpoints as
  OpenAM returns a 400 Bad Request error.
  The special characters are: double quotes ("), plus sign (+), comma (,),
  less than (&lt;), equals (=), greater than (&gt;), backslash (\), and
  null (\u0000).
 </p><pre class="brush: plain;">
$ curl \
 --request PUT \
 --header "iPlanetDirectoryPro: AQIC5w..." \
 --header "If-None-Match: *" \
 --header "Content-Type: application/json" \
 --data '{
    "name": "example",
    "active": true,
    "description": "Example Policy",
    "resources": [
        "http://www.example.com:80/*",
        "http://www.example.com:80/*?*"
    ],
    "actionValues": {
        "POST": false,
        "GET": true
    },
    "subject": {
        "type": "User",
        "subjectName": "Bob Dobbs"
    }
}' \
 https://openam.example.com:8443/openam/json/myRealm/policies/example

{
  "name" : "example",
  "active" : true,
  "description" : "Example Policy",
  "resources" : [
    "http://www.example.com:80/*",
    "http://www.example.com:80/*?*"
  ],
  "applicationName" : "iPlanetAMWebAgentService",
  "actionValues" : {
    "POST" : false,
    "GET" : true
  },
  "subject" : {
    "type" : "User",
    "subjectName" : "Bob Dobbs"
  },
  "lastModifiedBy" :
  "id=demo,ou=user,o=realm,ou=services,dc=openam,dc=forgerock,dc=org",
  "lastModified" : "2014-04-24T16:23:34Z",
  "createdBy" :
  "id=demo,ou=user,o=realm,ou=services,dc=openam,dc=forgerock,dc=org",
  "creationDate" : "2014-04-24T16:23:34Z"
}
   </pre><p>
       You can use the query string parameters
       <code class="literal">_prettyPrint=true</code> to make the output easier to read,
       and <code class="literal">_fields=<em class="replaceable"><code>field-name</code></em>[,<em class="replaceable"><code>field-name</code></em>...]</code>
       to limit the fields returned in the output.
      </p><p>
       The HTTP POST form includes the policy definition as the JSON resource data,
       with the header <code class="literal">Content-Type: application/json</code>
       and uses the <code class="literal">_action=create</code> operation.
      </p><p>
       The <code class="literal">iPlanetDirectoryPro</code> header sets the SSO token
       for a user who has access to perform the operation.
      </p><pre class="brush: plain;">
$ curl \
 --request POST \
 --header "iPlanetDirectoryPro: AQIC5..." \
 --header "Content-Type: application/json" \
 --data '{
    "name": "example",
    "active": true,
    "description": "Example Policy",
    "resources": [
        "http://www.example.com:80/*",
        "http://www.example.com:80/*?*"
    ],
    "actionValues": {
        "POST": false,
        "GET": true
    },
    "subject": {
        "type": "User",
        "subjectName": "Bob Dobbs"
    }
}' \
 https://openam.example.com:8443/openam/json/myRealm/policies?_action=create
      
{
  "name" : "example",
  "active" : true,
  "description" : "Example Policy",
  "resources" : [
    "http://www.example.com:80/*",
    "http://www.example.com:80/*?*"
  ],
  "applicationName" : "iPlanetAMWebAgentService",
  "actionValues" : {
    "POST" : false,
    "GET" : true
  },
  "subject" : {
    "type" : "User",
    "subjectName" : "Bob Dobbs"
  },
  "lastModifiedBy" :
   "id=demo,ou=user,o=realm,ou=services,dc=openam,dc=forgerock,dc=org",
  "lastModified" : "2014-04-29T07:33:54Z",
  "createdBy" :
   "id=demo,ou=user,o=realm,ou=services,dc=openam,dc=forgerock,dc=org",
  "creationDate" : "2014-04-29T07:33:54Z"
}
      </pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="rest-api-authz-policies-read"></a>4.3.2.&nbsp;Reading Policies</h3></div></div></div><p>
    To read a policy definition, perform an HTTP GET
    specifying the resource name.
   </p><p>
    The <code class="literal">iPlanetDirectoryPro</code> header sets the SSO token
    for a user who has access to perform the operation.
   </p><pre class="brush: plain;">
$ curl \
 --header "iPlanetDirectoryPro: AQIC5..." \
 https://openam.example.com:8443/openam/json/myRealm/policies/example

{
  "name" : "example",
  "active" : true,
  "description" : "Example Policy",
  "resources" : [
    "http://www.example.com:80/*",
    "http://www.example.com:80/*?*"
  ],
  "applicationName" : "iPlanetAMWebAgentService",
  "actionValues" : {
    "POST" : false,
    "GET" : true
  },
  "subject" : {
    "type" : "User",
    "subjectName" : "Bob Dobbs"
  },
  "lastModifiedBy" :
  "id=demo,ou=user,o=realm,ou=services,dc=openam,dc=forgerock,dc=org",
  "lastModified" : "2014-04-24T16:23:34Z",
  "createdBy" :
  "id=demo,ou=user,o=realm,ou=services,dc=openam,dc=forgerock,dc=org",
  "creationDate" : "2014-04-24T16:23:34Z"
}
   </pre><p>
    You can use the query string parameters
    <code class="literal">_prettyPrint=true</code> to make the output easier to read,
    and <code class="literal">_fields=<em class="replaceable"><code>field-name</code></em>[,<em class="replaceable"><code>field-name</code></em>...]</code>
    to limit the fields returned in the output.
   </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="rest-api-authz-policies-update"></a>4.3.3.&nbsp;Updating Policies</h3></div></div></div><p>
    To update a policy definition, perform an HTTP PUT
    specifying the resource name
    with the policy definition as the JSON resource data,
    and with the header <code class="literal">Content-Type: application/json</code>.
    This is essentially the same as creating a policy,
    but without the <code class="literal">If-None-Match: *</code> header.
   </p><p>
    The <code class="literal">iPlanetDirectoryPro</code> header sets the SSO token
    for a user who has access to perform the operation.
   </p><pre class="brush: plain;">
$ curl \
 --request PUT \
 --header "iPlanetDirectoryPro: AQIC5w..." \
 --header "Content-Type: application/json" \
 --data '{
    "name": "example",
    "active": true,
    "description": "Updated example policy",
    "resources": [
        "http://www.example.com:80/*",
        "http://www.example.com:80/*?*"
    ],
    "actionValues": {
        "POST": true,
        "GET": true
    },
    "subject": {
        "type": "User",
        "subjectName": "Bob Dobbs"
    }
}' \
 https://openam.example.com:8443/openam/json/myRealm/policies/example

{
  "name" : "example",
  "active" : true,
  "description" : "Updated example policy",
  "resources" : [
    "http://www.example.com:80/*",
    "http://www.example.com:80/*?*"
  ],
  "applicationName" : "iPlanetAMWebAgentService",
  "actionValues" : {
    "POST" : true,
    "GET" : true
  },
  "subject" : {
    "type" : "User",
    "subjectName" : "Bob Dobbs"
  },
  "lastModifiedBy" :
  "id=demo,ou=user,o=realm,ou=services,dc=openam,dc=forgerock,dc=org",
  "lastModified" : "2014-04-24T16:44:01Z",
  "createdBy" :
  "id=demo,ou=user,o=realm,ou=services,dc=openam,dc=forgerock,dc=org",
  "creationDate" : "2014-04-24T16:23:34Z"
}
   </pre><div class="tip"><h3 class="title">Tip</h3><p>You can rename a policy by sending a new value in the
     <span class="emphasis"><em>name</em></span> attribute of the JSON body,
     as shown below.</p><pre class="brush: plain;">
$ curl \
 --request PUT \
 --header "iPlanetDirectoryPro: AQIC5w..." \
 --header "Content-Type: application/json" \
 --data '{
     "name": "new-example",
     "active": true,
     "description": "Renamed example policy",
     "resources": [
         "http://www.example.com:80/*",
         "http://www.example.com:80/*?*"
     ],
     "actionValues": {
         "POST": true,
         "GET": true
     },
     "subject": {
         "type": "User",
         "subjectName": "Bob Dobbs"
     }
 }' \
 https://openam.example.com:8443/openam/json/myRealm/policies/example

{
    "name" : "new-example",
    "active" : true,
    "description" : "Renamed example policy",
    "resources" : [
        "http://www.example.com:80/*",
        "http://www.example.com:80/*?*"
    ],
    "applicationName" : "iPlanetAMWebAgentService",
    "actionValues" : {
        "POST" : true,
        "GET" : true
    },
    "subject" : {
        "type" : "User",
        "subjectName" : "Bob Dobbs"
    },
    "lastModifiedBy" :
    "id=demo,ou=user,o=realm,ou=services,dc=openam,dc=forgerock,dc=org",
    "lastModified" : "2014-04-24T16:48:01Z",
    "createdBy" :
    "id=demo,ou=user,o=realm,ou=services,dc=openam,dc=forgerock,dc=org",
    "creationDate" : "2014-04-24T16:23:34Z"
}
   </pre></div><p>
    You can use the query string parameters
    <code class="literal">_prettyPrint=true</code> to make the output easier to read,
    and <code class="literal">_fields=<em class="replaceable"><code>field-name</code></em>[,<em class="replaceable"><code>field-name</code></em>...]</code>
    to limit the fields returned in the output.
   </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="rest-api-authz-policies-delete"></a>4.3.4.&nbsp;Deleting Policies</h3></div></div></div><p>
    To delete a policy definition, perform an HTTP DELETE
    specifying the resource name.
   </p><p>
    The <code class="literal">iPlanetDirectoryPro</code> header sets the SSO token
    for a user who has access to perform the operation.
   </p><pre class="brush: plain;">
$ curl \
 --header "iPlanetDirectoryPro: AQIC5w..." \
 --request DELETE \
 https://openam.example.com:8443/openam/json/myRealm/policies/myPolicy
{}
   </pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="rest-api-authz-policies-query"></a>4.3.5.&nbsp;Listing Policies</h3></div></div></div><p>
    To list policy definitions, perform an HTTP GET on the endpoint, setting
    at least the <code class="literal">_queryFilter</code> query string parameter.
   </p><pre class="brush: plain;">
$ curl \
 --header "iPlanetDirectoryPro: AQIC5w..." \
 https://openam.example.com:8443/openam/json/myRealm/policies?_queryFilter=true
   
{
  "result" : [ ...policies... ],
  "resultCount" : 0,
  "pagedResultsCookie" : null,
  "remainingPagedResults" : -1
}
   </pre><p>
    The <code class="literal">_queryFilter</code> parameter can take
    <code class="literal">true</code> to match every policy,
    <code class="literal">false</code> to match no policies,
    or a filter of the following form to match field values:
    <code class="literal"><em class="replaceable"><code>field</code></em> <em class="replaceable"><code>operator</code></em> <em class="replaceable"><code>value</code></em></code>
    where <em class="replaceable"><code>field</code></em> represents the field name,
    <em class="replaceable"><code>operator</code></em> is the operator code,
    <em class="replaceable"><code>value</code></em> is the value to match,
    and the entire filter is URL encoded.
    Supported operators are as follows:
   </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
      <code class="literal">eq</code>: equals
     </p></li><li class="listitem"><p>
      <code class="literal">ge</code>: greater than or equal to
     </p></li><li class="listitem"><p>
      <code class="literal">gt</code>: greater than
     </p></li><li class="listitem"><p>
      <code class="literal">le</code>: less than or equal to
     </p></li><li class="listitem"><p>
      <code class="literal">lt</code>: less than
     </p></li></ul></div><div class="itemizedlist"><p>
     The <code class="literal"><em class="replaceable"><code>field</code></em></code> value
     can take the following values:
    </p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
      <code class="literal">"name"</code> (string equality only)
     </p></li><li class="listitem"><p>
      <code class="literal">"description"</code> (string equality only)
     </p></li><li class="listitem"><p>
      <code class="literal">"applicationName"</code> (string equality only)
     </p></li><li class="listitem"><p>
      <code class="literal">"createdBy"</code> (string equality only)
     </p></li><li class="listitem"><p>
      <code class="literal">"lastModifiedBy"</code> (string equality only)
     </p></li><li class="listitem"><p>
      <code class="literal">"creationDate"</code> (all comparisons are supported;
      the date is either an
      <a class="link" href="http://sources.forgerock.org/action/jira-issue.do?key=ISO-8601" target="_blank">ISO-8601</a> string,
      or a integer number of seconds from the UNIX epoch)
     </p></li><li class="listitem"><p>
      <code class="literal">"lastModified"</code> (all comparisons are supported;
      the date is either an
      <a class="link" href="http://sources.forgerock.org/action/jira-issue.do?key=ISO-8601" target="_blank">ISO-8601</a> string,
      or a integer number of seconds from the UNIX epoch)
     </p></li></ul></div><p>
    Filters can be composed of multiple expressions
    by a using boolean operator <code class="literal">AND</code>,
    
    and by using parentheses,
    <code class="literal">(<em class="replaceable"><code>expression</code></em>)</code>,
    to group expressions.
    You must URL encode the filter expression
    in <code class="literal">_queryFilter=<em class="replaceable"><code>filter</code></em></code>.
   </p><p>
    You can use the query string parameters
    <code class="literal">_prettyPrint=true</code> to make the output easier to read,
    <code class="literal">_fields=<em class="replaceable"><code>field-name</code></em>[,<em class="replaceable"><code>field-name</code></em>...]</code>
    to limit the fields returned in the output.
   </p><p>
    You can use <code class="literal">_pageSize=<em class="replaceable"><code>integer</code></em></code>
    to limit the number of results returned, as shown in the following example
    that returns only the first of three policies.
   </p><pre class="brush: plain;">
$ curl \
 --header "iPlanetDirectoryPro: AQIC5w..." \
 https://openam.example.com:8443/openam/json/policies?_queryFilter=true\&amp;_fields=name\&amp;_pageSize=1
{
  "result" : [ {
    "name" : "My Other Policy"
  } ],
  "resultCount" : 1,
  "pagedResultsCookie" : null,
  "remainingPagedResults" : 2
}
   </pre><p>
    You can use <code class="literal">_sortKeys=[+-]<em class="replaceable"><code>field</code></em>[,<em class="replaceable"><code>field</code></em>...]</code>
    to sort the results returned,
    where <em class="replaceable"><code>field</code></em> represents a field
    in the JSON policy objects returned.
    Optionally use the <code class="literal">+</code> prefix to sort in ascending order
    (the default),
    or <code class="literal">-</code> to sort in descending order.
    The following example sorts the policy objects by their names.
   </p><pre class="brush: plain;">
$ curl \
  --header "iPlanetDirectoryPro: AQIC5w..." \
 https://openam.example.com:8443/openam/json/policies?_queryFilter=true\&amp;_sortKeys=name
  {
  "result" : [ {
    "name" : "Another Example Policy",
    ...
  }, {
    "name" : "My Other Policy",
    ...
  }, {
    "name" : "Sample Policy",
    ...
  } ],
  "resultCount" : 3,
  "pagedResultsCookie" : null,
  "remainingPagedResults" : 0
}
   </pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="rest-api-manage-xacml"></a>4.4.&nbsp;Managing Entitlements through REST</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="chap-rest-authz-policy.html#xacml-import">4.4.1. XACML Import</a></span></dt><dt><span class="section"><a href="chap-rest-authz-policy.html#xacml-export">4.4.2. XACML Export</a></span></dt></dl></div><p>
   OpenAM's entitlements engine supports the ability to import
   eXtensible Access Control Markup Language (XACML) 3.0-based
   formatted policies as well as export OpenAM entitlements to XACML 3.0 format
   through its <code class="literal">/xacml/policies</code> REST endpoint.
   The endpoint's functionally is identical to that of the
   
   <code class="literal">ssoadm</code> <code class="literal">import-xacml</code> and
   <code class="literal">export-xacml</code> commands.
   For more information, see
   <span class="olink">Managing Entitlements on the Command Line</span>
  </p><p>
   OpenAM runs its imports and exports by mapping the XACML 3.0 policy
   elements to OpenAM privileges (i.e., entitlements) and vice-versa. The
   mappings are as follows:
  </p><div class="table"><a name="xacml-mappings"></a><div class="table-title">Table&nbsp;4.1.&nbsp;Entitlements to XACML Mappings</div><div class="table-contents"><table summary="Entitlements to XACML Mappings" border="0"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th>XACML Policy</th><th>OpenAM Privilege</th></tr></thead><tbody><tr><td>Policy ID</td><td>Privilege Name</td></tr><tr><td>Description</td><td>Privilege Description</td></tr><tr><td>Version</td><td>Current Time (yyyy.MM.dd.HH.mm.ss.SSS)</td></tr><tr><td>entitlement excluded resource names</td><td>xacml rule target</td></tr><tr><td>Rule Combining Algorithm ID</td><td>Rule Deny Overrides</td></tr><tr><td>Target</td><td>
       <p>Any of:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Entitlement Subject</p></li><li class="listitem"><p>Resource Names</p></li><li class="listitem"><p>Application Names</p></li><li class="listitem"><p>Action Values</p></li></ul></div><p>
       </p>
      </td></tr><tr><td>Variable Definitions</td><td>
       <p>Any of:
        </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Application Name</p></li><li class="listitem"><p>Entitlement Name</p></li><li class="listitem"><p>Privilege Created By</p></li><li class="listitem"><p>Privilege Modified By</p></li><li class="listitem"><p>Privilege Creation Date</p></li><li class="listitem"><p>Privilege Last Modification Date</p></li></ul></div><p>
       </p>
      </td></tr><tr><td>Rules</td><td>
       Single Level Permit/Deny Actions converted
       to Policy Rules
      </td></tr></tbody></table></div></div><br class="table-break"><div class="note"><h3 class="title">Note</h3><p>
    XACML obligation is not supported. Also, only one XACML match is defined for
    each privilege action, and only one XACML rule for each privilege action value.
   </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="xacml-import"></a>4.4.1.&nbsp;XACML Import</h3></div></div></div><p>
    OpenAM supports the import of XACML 3.0-based policy sets into
    OpenAM entitlements using the REST <code class="literal">/xacml/policies</code>
    endpoint.
    To test an import, OpenAM provides a dry-run feature that runs an import
    without saving the changes to the database. The dry-run feature provides a
    summary of the import so that you can troubleshoot any potential mismatches
    prior to the actual import.
   </p><p>
    You can import a XACML policy using an HTTP POST request for the root realm
    or a specific realm at the following endpoints:
   </p><pre class="brush: plain;">
http://openam.example.com:8080/openam/xacml/policies
http://openam.example.com:8080/openam/xacml/{realm}/policies

where {realm} is the name of the specific realm
   </pre><div class="procedure"><a name="procedure-xacml-import"></a><div class="procedure-title">Procedure&nbsp;4.1.&nbsp;To Import a XACML 3.0 Policy</div><ol class="procedure" type="1"><li class="step"><p>You can do a dry-run using the <code class="literal">dryrun=true</code> query to
      test the import. The dry-run option outputs in JSON format and displays the status
      of each import policy, where "U" indicates "Updated"; "A" for "Added". The
      dry-run does not actually update to the database. When you are ready for an
      actual import, you need to re-run the command
      without the <code class="literal">dryrun=true</code> query.
     </p><pre class="brush: plain;">
$ curl \
  --request POST \
  --header "iPlanetDirectoryPro: AQIC5..." \
  --header "Content-Type: application/xml" \
  --data @xacml-policy.xml
  http://openam.example.com:8080/openam/xacml/policies?dryrun=true
[
 {
   "status":"U",
   "name":"testHelpDeskreferralpolicy"
 },
 {
   "status":"U",
   "name":"test_Referral"
 },
 {
   "status":"U",
   "name":"testexternalreferralpolicy"
 },
 {
   "status":"U",
   "name":"testregexternalreferralpolicy"
 }
]
     </pre></li><li class="step"><p>
Use the <code class="literal">/xacml/policies</code> endpoint to import a XACML policy:
     </p><pre class="brush: plain;">
$ curl \
  --request POST \
  --header "iPlanetDirectoryPro: AQIC5..." \
  --header "Content-Type: application/xml" \
  --data @xacml-policy.xml
  http://openam.example.com:8080/openam/xacml/policies
     </pre></li><li class="step"><p>You can import a XACML policy into a realm as follows:</p><pre class="brush: plain;">
$ curl \
  --request POST \
  --header "iPlanetDirectoryPro: AQIC5..." \
  --header "Content-Type: application/xml" \
  --data @xacml-policy.xml
  http://openam.example.com:8080/openam/xacml/{realm}/policies
     </pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="xacml-export"></a>4.4.2.&nbsp;XACML Export</h3></div></div></div><p>
    OpenAM supports the export of its entitlement policies into XACML 3.0 format.

    OpenAM only exports a PolicySet that contains policy definitions. No other
    types can be included in the PolicySet, such as sub-policySet or rules.
    The PolicySet mapping is as follows:
   </p><div class="table"><a name="xacml-export-mappings"></a><div class="table-title">Table&nbsp;4.2.&nbsp;PolicySet Mappings</div><div class="table-contents"><table summary="PolicySet Mappings" border="0"><colgroup><col width="33%"><col width="67%"></colgroup><thead><tr><th>XACML</th><th>OpenAM</th></tr></thead><tbody><tr><td>PolicySet ID</td><td>Realm:&lt;timestamp&gt;(yyyy.MM.dd.HH.mm.ss.SSS)</td></tr><tr><td>Version</td><td>Current Time (yyyy.MM.dd.HH.mm.ss.SSS)</td></tr><tr><td>Policy Combining Algorithm ID</td><td>Deny Overrides</td></tr><tr><td>Target</td><td>No targets defined</td></tr></tbody></table></div></div><br class="table-break"><p>
    The export service is accessible at the <code class="literal">/xacml/policies</code>
    endpoint using a HTTP GET request
    at the following endpoint for the root realm or a specific realm:
   </p><pre class="brush: plain;">
http://openam.example.com:8080/openam/xacml/policies
http://openam.example.com:8080/openam/xacml/{realm}/policies

  where {realm} is the name of the specific realm
   </pre><p>
    You can filter your XACML exports using query search filters. Note the
    following points about the search filters:
   </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="bold"><strong>LDAP-based Searches</strong></span>.
     The search filters follow the standard
     guidelines for LDAP searches as they are applied to the
     entitlements index in the LDAP configuration backend, located at:
     <code class="literal">ou=default,ou=OrganizationalConfig,ou=1.0,ou=sunEntitlement Indexes,
      ou=services,dc=openam,dc=forgerock,dc=org</code>.
    </p></li><li class="listitem"><p>
     <span class="bold"><strong>Search Filter Format</strong></span>. You can specify
     a single search filter or multiple filters in the HTTP URL parameters.
     The format for the search filter is as follows:
    </p><pre class="brush: plain;">
[attribute name][operator][attribute value]
    </pre><div class="table"><a name="export-search-filter-format"></a><div class="table-title">Table&nbsp;4.3.&nbsp;XACML Export Search Filter Format</div><div class="table-contents"><table summary="XACML Export Search Filter Format" border="0"><colgroup><col width="33%"><col width="67%"></colgroup><thead><tr><th>Element</th><th>Description</th></tr></thead><tbody><tr><td>Attribute Name</td><td>
         <p>
          The name of the attribute to be searched for. The only permissible
          values are: <code class="literal">application</code>, <code class="literal">createdby</code>,
          <code class="literal">lastmodifiedby</code>, <code class="literal">creationdate</code>,
          <code class="literal">lastmodifieddate</code>, <code class="literal">name</code>,
          <code class="literal">description</code>.
         </p>
        </td></tr><tr><td>Operator</td><td>
         <p>The type of comparison operation to perform.</p>
         <div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>= Equals (text)</p></li><li class="listitem"><p>&lt; Less Than or Equal To (numerical)</p></li><li class="listitem"><p>&gt; Greater Than or Equal To (numerical)</p></li></ul></div>
        </td></tr><tr><td>Attribute Value</td><td>
         <p>
          The matching value. Asterisk wildcards are supported.
         </p>
        </td></tr></tbody></table></div></div><br class="table-break"></li></ul></div><div class="procedure"><a name="export-policies"></a><div class="procedure-title">Procedure&nbsp;4.2.&nbsp;To Export Policies</div><ul class="procedure"><li class="step"><p>
     Use the <code class="literal">/xacml/policies</code> endpoint to export the OpenAM entitlement
     policies into XACML 3.0 format. The following curl command exports the policies
     and returns the XACML response (truncated for display purposes).
    </p><pre class="brush: plain;">
$ curl \
  --request GET \
  --header "iPlanetDirectoryPro: AQIC5..." \
  --header "Content-Type: application/json" \
  http://openam.example.com:8080/openam/xacml/policies
  
  
&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;PolicySet xmlns="urn:oasis:names:tc:xacml:3.0:core:schema:wd-17"
 PolicyCombiningAlgId="urn:oasis:names:tc:xacml:3.0:rule-combining-algorithm:deny-overrides"
 Version="2014.10.08.21.59.39.231" PolicySetId="/:2014.10.08.21.59.39.231"&gt;
 &lt;Target/&gt;
 &lt;Policy RuleCombiningAlgId="urn:oasis:names:tc:xacml:3.0:rule-combining-algorithm:deny-overrides"
  Version="2014.10.08.18.01.03.626"
  PolicyId="Rockshop_Checkout_https://forgerock-rockshop.openrock.org:443/wp-login.php*?*"&gt;
  ...
    </pre></li></ul></div><div class="procedure"><a name="export-policies-search-filter"></a><div class="procedure-title">Procedure&nbsp;4.3.&nbsp;To Export Policies with Search Filters</div><ol class="procedure" type="1"><li class="step"><p>
     Use the <code class="literal">/xacml/policies</code> endpoint to export the policies
     into XACML 3.0 format with a search filter. This command only exports policies
     that were created by "amadmin".
    </p><pre class="brush: plain;">
$ curl \
  --request GET \
  --header "iPlanetDirectoryPro: AQIC5..." \
  --header "Content-Type: application/json" \
  http://openam.example.com:8080/openam/xacml/policies?filter=createdby=amadmin
  
   </pre></li><li class="step"><p>
     You can also specify more than one search filter by logically ANDing the filters
     as follows:
    </p><pre class="brush: plain;">
$ curl \
  --request GET \
  --header "iPlanetDirectoryPro: AQIC5..." \
  --header "Content-Type: application/json" \
  http://openam.example.com:8080/openam/xacml/policies?filter=createdby=amadmin&amp;
  filter=creationdate=135563832
    </pre></li></ol></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="rest-api-authz-applications"></a>4.5.&nbsp;Defining Applications</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="chap-rest-authz-policy.html#rest-api-authz-applications-create">4.5.1. Creating Applications</a></span></dt><dt><span class="section"><a href="chap-rest-authz-policy.html#rest-api-authz-applications-read">4.5.2. Reading Applications</a></span></dt><dt><span class="section"><a href="chap-rest-authz-policy.html#rest-api-authz-applications-update">4.5.3. Updating Applications</a></span></dt><dt><span class="section"><a href="chap-rest-authz-policy.html#rest-api-authz-applications-delete">4.5.4. Deleting Applications</a></span></dt><dt><span class="section"><a href="chap-rest-authz-policy.html#rest-api-authz-applications-query">4.5.5. Listing Applications</a></span></dt></dl></div><p>
   Application definitions set constraints
   for the policies that can be defined for a particular application.
   The default built-in application is the <code class="literal">iPlanetAMWebAgentService</code>,
   which OpenAM policy agents use to allow policy management through the console.
  </p><p>
   Application resources are represented in JSON and take the following form.
   Application resources are built from standard JSON objects and values
   (strings, numbers, objects, arrays, <code class="literal">true</code>,
   <code class="literal">false</code>, and <code class="literal">null</code>).
  </p><p lang="en">
  Do not use special characters within policy, application or referral names
  (for example, "my+referral") using the Policy Editor or REST endpoints as
  OpenAM returns a 400 Bad Request error.
  The special characters are: double quotes ("), plus sign (+), comma (,),
  less than (&lt;), equals (=), greater than (&gt;), backslash (\), and
  null (\u0000).
 </p><pre class="brush: javascript;">
{
  "name": "application name string",
  "resources": [
     "resource name pattern",
     ...
  ],
  "actions": {
     "action name string": true,
     "other action name string": false,
     ...
  },
  "conditions": [
     "condition type",
     ...
  ],
  "realm": "/myRealm",
  "applicationType": "application type name string",
  "description": "string describing application",
  "resourceComparator": "resource comparator class name",
  "subjects": [
     "subject type",
     ...
  ],
  "entitlementCombiner": "decision combiner",
  "saveIndex": "save index class name",
  "searchIndex": "search index class name",
  "attributeNames": [
     "attribute implementation class name",
     ...
  ]
}
  </pre><div class="variablelist"><p>
    The values for the fields shown in the description are explained below:
   </p><dl class="variablelist"><dt><span class="term"><code class="literal">"name"</code></span></dt><dd><p>
      String matching the name
      in the URL used when creating the application by HTTP PUT
      or in the body when creating the application by HTTP POST.
     </p></dd><dt><span class="term"><code class="literal">"resources"</code></span></dt><dd><p>
      Strings specifying resource name patterns as in the following example:
     </p><pre class="brush: javascript;">
{
    "resources": [
        "http://www.example.com:8080/*",
        "http://www.example.com:8080/*?*"
    ]
}
     </pre></dd><dt><span class="term"><code class="literal">"actions"</code></span></dt><dd><p>
      Set of string action names,
      each set to a boolean indicating whether the action is allowed
      in the context of this application as in the following example:
     </p><pre class="brush: javascript;">
{
    "actions": {
        "UPDATE": true,
        "PATCH": true,
        "QUERY": true,
        "CREATE": true,
        "DELETE": true,
        "READ": true,
        "ACTION": true
    }
}
     </pre></dd><dt><span class="term"><code class="literal">"conditions"</code></span></dt><dd><p>
      Condition types allowed in the context of this application.
     </p><p>
      The following condition types are available:
     </p><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="literal">"AND"</code></td></tr><tr><td><code class="literal">"AttributeLookup"</code></td></tr><tr><td><code class="literal">"DNSName"</code></td></tr><tr><td><code class="literal">"IP"</code></td></tr><tr><td><code class="literal">"NOT"</code></td></tr><tr><td><code class="literal">"NumericAttribute"</code></td></tr><tr><td><code class="literal">"OR"</code></td></tr><tr><td><code class="literal">"Policy"</code></td></tr><tr><td><code class="literal">"StringAttribute"</code></td></tr><tr><td><code class="literal">"Time"</code></td></tr></table><p>
      For more on condition types,
      see <a class="xref" href="chap-rest-authz-policy.html#rest-api-authz-condition-types" title="4.7.&nbsp;Viewing Condition Types">Section&nbsp;4.7, &#8220;Viewing Condition Types&#8221;</a>.
     </p></dd><dt><span class="term"><code class="literal">"realm"</code></span></dt><dd><p>
      Name of the realm where this application is defined. You must specify the
      realm in the application resource JSON even though it can be derived from
      the URL that is used when creating the application using an HTTP PUT call.
     </p></dd><dt><span class="term"><code class="literal">"applicationType"</code></span></dt><dd><p>
      Name of the application type used as a template for this application.
     </p></dd><dt><span class="term"><code class="literal">"description"</code></span></dt><dd><p>
      String describing the application.
     </p></dd><dt><span class="term"><code class="literal">"resourceComparator"</code></span></dt><dd><p>
      Class name of the resource comparator implementation used
      in the context of this application.
     </p><p>
      The following implementations are available:
     </p><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="literal">"com.sun.identity.entitlement.ExactMatchResourceName"</code></td></tr><tr><td><code class="literal">"com.sun.identity.entitlement.PrefixResourceName"</code></td></tr><tr><td><code class="literal">"com.sun.identity.entitlement.RegExResourceName"</code></td></tr><tr><td><code class="literal">"com.sun.identity.entitlement.URLResourceName"</code></td></tr></table></dd><dt><span class="term"><code class="literal">"subjects"</code></span></dt><dd><p>
      Subject types allowed in the context of this application.
     </p><p>
      The following subject types are available:
     </p><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="literal">"AND"</code></td></tr><tr><td><code class="literal">"AnyUser"</code></td></tr><tr><td><code class="literal">"Attribute"</code></td></tr><tr><td><code class="literal">"Group"</code></td></tr><tr><td><code class="literal">"JwtClaim"</code></td></tr><tr><td><code class="literal">"NONE"</code></td></tr><tr><td><code class="literal">"NOT"</code></td></tr><tr><td><code class="literal">"OR"</code></td></tr><tr><td><code class="literal">"Policy"</code></td></tr><tr><td><code class="literal">"Role"</code></td></tr><tr><td><code class="literal">"User"</code></td></tr></table><p>
      For more on subject types,
      see <a class="xref" href="chap-rest-authz-policy.html#rest-api-authz-subject-types" title="4.9.&nbsp;Viewing Subject Types">Section&nbsp;4.9, &#8220;Viewing Subject Types&#8221;</a>.
     </p></dd><dt><span class="term"><code class="literal">"entitlementCombiner"</code></span></dt><dd><p>
      Name of the decision combiner, such as <code class="literal">"DenyOverride"</code>.
     </p><p>
      For more on decision combiners,
      see <a class="xref" href="chap-rest-authz-policy.html#rest-api-authz-decision-combiners" title="4.10.&nbsp;Viewing Decision Combiners">Section&nbsp;4.10, &#8220;Viewing Decision Combiners&#8221;</a>.
     </p></dd><dt><span class="term"><code class="literal">"saveIndex"</code></span></dt><dd><p>
      Class name of the implementation for creating indexes for resource names,
      such as <code class="literal">"com.sun.identity.entitlement.util.ResourceNameIndexGenerator"</code>
      for URL resource names.
     </p></dd><dt><span class="term"><code class="literal">"searchIndex"</code></span></dt><dd><p>
      Class name of the implementation for searching indexes for resource names,
      such as <code class="literal">"com.sun.identity.entitlement.util.ResourceNameSplitter"</code>
      for URL resource names.
     </p></dd><dt><span class="term"><code class="literal">"attributeNames"</code></span></dt><dd><p>
      Class names of implementations for getting attributes such as
      <code class="literal">"com.sun.identity.entitlement.StaticAttributes"</code>,
      and <code class="literal">"com.sun.identity.entitlement.UserAttributes"</code>.
     </p></dd></dl></div><p>
   The examples above do not show the fields added by OpenAM
   to indicate when the application was created and last updated, and by whom.
   Those field are
   <code class="literal">"createdBy"</code> and <code class="literal">"lastModifiedBy"</code>,
   which take strings holding universal identifier DNs as their values,
   and <code class="literal">"creationDate"</code> and <code class="literal">"lastModifiedDate"</code>,
   which an integer number of seconds since the Unix epoch.
  </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="rest-api-authz-applications-create"></a>4.5.1.&nbsp;Creating Applications</h3></div></div></div><p>
    To create an application definition,
    either perform an HTTP PUT indicating the full path to the resource
    and the name in the resource matching the name in the path,
    or perform an HTTP POST with the name to use specified in the resource.
   </p><p>
    The HTTP PUT form includes the application definition
    as the JSON resource data,
    with the header <code class="literal">Content-Type: application/json</code>
    and uses the <code class="literal">If-None-Match: *</code> header.
   </p><p>
    The <code class="literal">iPlanetDirectoryPro</code> header sets the SSO token
    for a user who has access to perform the operation.
   </p><p lang="en">
  Do not use special characters within policy, application or referral names
  (for example, "my+referral") using the Policy Editor or REST endpoints as
  OpenAM returns a 400 Bad Request error.
  The special characters are: double quotes ("), plus sign (+), comma (,),
  less than (&lt;), equals (=), greater than (&gt;), backslash (\), and
  null (\u0000).
 </p><pre class="brush: plain;">
$ curl \
 --request PUT \
 --header "If-None-Match: *" \
 --header "iPlanetDirectoryPro: AQIC5..." \
 --header "Content-Type: application/json" \
 --data '{
    "name": "crest",
    "resources": [
        "http://www.example.com:8080/*",
        "http://www.example.com:8080/*?*"
    ],
    "actions": {
        "UPDATE": true,
        "PATCH": true,
        "QUERY": true,
        "CREATE": true,
        "DELETE": true,
        "READ": true,
        "ACTION": true
    },
    "conditions": [
        "not",
        "dateRange",
        "timezone",
        "timeRange",
        "or",
        "dnsName",
        "ipRange",
        "daysOfWeek",
        "and"
    ],
    "realm": "/",
    "applicationType": "crestPolicyService",
    "description": "An example application for Common REST",
    "resourceComparator": "com.sun.identity.entitlement.URLResourceName",
    "subjects": [
        "com.sun.identity.admin.model.IdRepoUserViewSubject",
        "com.sun.identity.admin.model.NotViewSubject",
        "com.sun.identity.admin.model.IdRepoRoleViewSubject",
        "com.sun.identity.admin.model.AndViewSubject",
        "com.sun.identity.admin.model.VirtualViewSubject",
        "com.sun.identity.admin.model.OrViewSubject",
        "com.sun.identity.admin.model.IdRepoGroupViewSubject",
        "com.sun.identity.admin.model.AttributeViewSubject"
    ],
    "entitlementCombiner": "DenyOverride",
    "saveIndex": null,
    "searchIndex": null,
    "attributeNames": []
}' \
 https://openam.example.com:8443/openam/json/applications/crest
{
  "name" : "crest",
  "resources" : [
    "http://www.example.com:8080/*",
    "http://www.example.com:8080/*?*"
  ],
  "actions" : {
    "UPDATE" : true,
    "PATCH" : true,
    "QUERY" : true,
    "CREATE" : true,
    "DELETE" : true,
    "READ" : true,
    "ACTION" : true
  },
  "conditions" : [
   "not",
   "dateRange",
   "timezone",
   "timeRange",
   "or",
   "dnsName",
   "ipRange",
   "daysOfWeek",
   "and"
  ],
  "realm" : "/",
  "creationDate" : 1398761708295,
  "lastModifiedDate" : 1398761708295,
  "createdBy" : "id=amadmin,ou=user,dc=openam,dc=forgerock,dc=org",
  "lastModifiedBy" : "id=amadmin,ou=user,dc=openam,dc=forgerock,dc=org",
  "applicationType" : "crestPolicyService",
  "description" : "An example application for Common REST",
  "resourceComparator" : "com.sun.identity.entitlement.URLResourceName",
  "subjects" : [
   "com.sun.identity.admin.model.IdRepoUserViewSubject",
   "com.sun.identity.admin.model.NotViewSubject",
   "com.sun.identity.admin.model.AndViewSubject",
   "com.sun.identity.admin.model.IdRepoRoleViewSubject",
   "com.sun.identity.admin.model.OrViewSubject",
   "com.sun.identity.admin.model.VirtualViewSubject",
   "com.sun.identity.admin.model.IdRepoGroupViewSubject",
   "com.sun.identity.admin.model.AttributeViewSubject"
  ],
  "entitlementCombiner" : "DenyOverride",
  "saveIndex" : null,
  "searchIndex" : null,
  "attributeNames" : [ ]
}
   </pre><p>
    You can use the query string parameters
    <code class="literal">_prettyPrint=true</code> to make the output easier to read,
    and <code class="literal">_fields=<em class="replaceable"><code>field-name</code></em>[,<em class="replaceable"><code>field-name</code></em>...]</code>
    to limit the fields returned in the output.
   </p><p>
    The HTTP POST form includes the application definition
    as the JSON resource data,
    with the header <code class="literal">Content-Type: application/json</code>
    and uses the <code class="literal">_action=create</code> operation.
   </p><p>
    The <code class="literal">iPlanetDirectoryPro</code> header sets the SSO token
    for a user who has access to perform the operation.
   </p><pre class="brush: plain;">
$ curl \
 --request POST \
 --header "iPlanetDirectoryPro: AQIC5..." \
 --header "Content-Type: application/json" \
 --data '{
    "name": "crest",
    "resources": [
        "http://www.example.com:8080/*",
        "http://www.example.com:8080/*?*"
    ],
    "actions": {
        "UPDATE": true,
        "PATCH": true,
        "QUERY": true,
        "CREATE": true,
        "DELETE": true,
        "READ": true,
        "ACTION": true
    },
    "conditions": [
        "not",
        "dateRange",
        "timezone",
        "timeRange",
        "or",
        "dnsName",
        "ipRange",
        "daysOfWeek",
        "and"
    ],
    "realm": "/",
    "applicationType": "crestPolicyService",
    "description": "An example application for Common REST",
    "resourceComparator": "com.sun.identity.entitlement.URLResourceName",
    "subjects": [
        "com.sun.identity.admin.model.IdRepoUserViewSubject",
        "com.sun.identity.admin.model.NotViewSubject",
        "com.sun.identity.admin.model.IdRepoRoleViewSubject",
        "com.sun.identity.admin.model.AndViewSubject",
        "com.sun.identity.admin.model.VirtualViewSubject",
        "com.sun.identity.admin.model.OrViewSubject",
        "com.sun.identity.admin.model.IdRepoGroupViewSubject",
        "com.sun.identity.admin.model.AttributeViewSubject"
    ],
    "entitlementCombiner": "DenyOverride",
    "saveIndex": null,
    "searchIndex": null,
    "attributeNames": []
}' \
 https://openam.example.com:8443/openam/json/applications/?_action=create
{
  "name" : "crest",
  "resources" : [
    "http://www.example.com:8080/*",
    "http://www.example.com:8080/*?*"
  ],
  "actions" : {
    "UPDATE" : true,
    "PATCH" : true,
    "QUERY" : true,
    "CREATE" : true,
    "DELETE" : true,
    "READ" : true,
    "ACTION" : true
  },
  "conditions" : [
   "not",
   "dateRange",
   "timezone",
   "timeRange",
   "or",
   "dnsName",
   "ipRange",
   "daysOfWeek",
   "and"
  ],
  "realm" : "/",
  "creationDate" : 1398762452667,
  "lastModifiedDate" : 1398762452667,
  "createdBy" : "id=amadmin,ou=user,dc=openam,dc=forgerock,dc=org",
  "lastModifiedBy" : "id=amadmin,ou=user,dc=openam,dc=forgerock,dc=org",
  "applicationType" : "crestPolicyService",
  "description" : "An example application for Common REST",
  "resourceComparator" : "com.sun.identity.entitlement.URLResourceName",
  "subjects" : [
   "com.sun.identity.admin.model.IdRepoUserViewSubject",
   "com.sun.identity.admin.model.NotViewSubject",
   "com.sun.identity.admin.model.AndViewSubject",
   "com.sun.identity.admin.model.IdRepoRoleViewSubject",
   "com.sun.identity.admin.model.OrViewSubject",
   "com.sun.identity.admin.model.VirtualViewSubject",
   "com.sun.identity.admin.model.IdRepoGroupViewSubject",
   "com.sun.identity.admin.model.AttributeViewSubject"
  ],
  "entitlementCombiner" : "DenyOverride",
  "saveIndex" : null,
  "searchIndex" : null,
  "attributeNames" : [ ]
}
   </pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="rest-api-authz-applications-read"></a>4.5.2.&nbsp;Reading Applications</h3></div></div></div><p>
    To read an application definition, perform an HTTP GET
    specifying the resource name.
   </p><p>
    The <code class="literal">iPlanetDirectoryPro</code> header sets the SSO token
    for a user who has access to perform the operation.
   </p><pre class="brush: plain;">
$ curl \
 --header "iPlanetDirectoryPro: AQIC5..." \
 https://openam.example.com:8443/openam/json/myRealm/applications/myApp
{
  "name" : "myApp",
  "resources" : [ "http://*:*/*", "http://*:*/*?*" ],
  "actions" : {
    "POST" : true,
    "PATCH" : true,
    "GET" : true,
    "DELETE" : true,
    "OPTIONS" : true,
    "PUT" : true,
    "HEAD" : true
  },
  "conditions" : [
    "not",
    "dateRange",
    "timezone",
    "timeRange",
    "or",
    "dnsName",
    "ipRange",
    "daysOfWeek",
    "and"
  ],
  "realm" : "/myRealm",
  "creationDate" : 1398760362341,
  "lastModifiedDate" : 1398760362341,
  "createdBy" : "id=dsameuser,ou=user,dc=openam,dc=forgerock,dc=org",
  "lastModifiedBy" : "id=dsameuser,ou=user,dc=openam,dc=forgerock,dc=org",
  "applicationType" : "iPlanetAMWebAgentService",
  "description" : null,
  "resourceComparator" : "com.sun.identity.entitlement.URLResourceName",
  "subjects" : [
    "com.sun.identity.admin.model.IdRepoUserViewSubject",
    "com.sun.identity.admin.model.NotViewSubject",
    "com.sun.identity.admin.model.AndViewSubject",
    "com.sun.identity.admin.model.IdRepoRoleViewSubject",
    "com.sun.identity.admin.model.OrViewSubject",
    "com.sun.identity.admin.model.VirtualViewSubject",
    "com.sun.identity.admin.model.IdRepoGroupViewSubject",
    "com.sun.identity.admin.model.AttributeViewSubject"
  ],
  "entitlementCombiner" : "DenyOverride",
  "saveIndex" : null,
  "searchIndex" : null,
  "attributeNames" : [ ]
}
   </pre><p>
    You can use the query string parameters
    <code class="literal">_prettyPrint=true</code> to make the output easier to read,
    and <code class="literal">_fields=<em class="replaceable"><code>field-name</code></em>[,<em class="replaceable"><code>field-name</code></em>...]</code>
    to limit the fields returned in the output.
   </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="rest-api-authz-applications-update"></a>4.5.3.&nbsp;Updating Applications</h3></div></div></div><p>
    To update an application definition, perform an HTTP PUT
    specifying the resource name
    with the application definition as the JSON resource data,
    and with the header <code class="literal">Content-Type: application/json</code>.
    This is essentially the same as creating an application definition,
    but without the <code class="literal">If-None-Match: *</code> header.
   </p><p>
    The <code class="literal">iPlanetDirectoryPro</code> header sets the SSO token
    for a user who has access to perform the operation.
   </p><pre class="brush: plain;">
$ curl \
 --request PUT \
 --header "iPlanetDirectoryPro: AQIC5..." \
 --header "Content-Type: application/json" \
 --data '{
    "name": "crest",
    "resources": [
        "http://www.example.com:8080/*",
        "http://www.example.com:8080/*?*"
    ],
    "actions": {
        "UPDATE": false,
        "PATCH": false,
        "QUERY": true,
        "CREATE": false,
        "DELETE": false,
        "READ": true,
        "ACTION": false
    },
    "conditions": [
        "not",
        "dateRange",
        "timezone",
        "timeRange",
        "or",
        "dnsName",
        "ipRange",
        "daysOfWeek",
        "and"
    ],
    "realm": "/",
    "applicationType": "crestPolicyService",
    "description": "An read-only example application for Common REST",
    "resourceComparator": "com.sun.identity.entitlement.URLResourceName",
    "subjects": [
        "com.sun.identity.admin.model.IdRepoUserViewSubject",
        "com.sun.identity.admin.model.NotViewSubject",
        "com.sun.identity.admin.model.IdRepoRoleViewSubject",
        "com.sun.identity.admin.model.AndViewSubject",
        "com.sun.identity.admin.model.VirtualViewSubject",
        "com.sun.identity.admin.model.OrViewSubject",
        "com.sun.identity.admin.model.IdRepoGroupViewSubject",
        "com.sun.identity.admin.model.AttributeViewSubject"
    ],
    "entitlementCombiner": "DenyOverride",
    "saveIndex": null,
    "searchIndex": null,
    "attributeNames": []
}' \
 https://openam.example.com:8443/openam/json/applications/crest
{
  "name" : "crest",
  "resources" : [
    "http://www.example.com:8080/*",
    "http://www.example.com:8080/*?*"
  ],
  "actions" : {
    "UPDATE" : false,
    "PATCH" : false,
    "QUERY" : true,
    "CREATE" : false,
    "DELETE" : false,
    "READ" : true,
    "ACTION" : false
  },
  "conditions" : [
   "not",
   "dateRange",
   "timezone",
   "timeRange",
   "or",
   "dnsName",
   "ipRange",
   "daysOfWeek",
   "and"
  ],
  "realm" : "/",
  "creationDate" : 1398762194628,
  "lastModifiedDate" : 1398762194628,
  "createdBy" : "id=amadmin,ou=user,dc=openam,dc=forgerock,dc=org",
  "lastModifiedBy" : "id=amadmin,ou=user,dc=openam,dc=forgerock,dc=org",
  "applicationType" : "crestPolicyService",
  "description" : "An read-only example application for Common REST",
  "resourceComparator" : "com.sun.identity.entitlement.URLResourceName",
  "subjects" : [
   "com.sun.identity.admin.model.IdRepoUserViewSubject",
   "com.sun.identity.admin.model.NotViewSubject",
   "com.sun.identity.admin.model.AndViewSubject",
   "com.sun.identity.admin.model.IdRepoRoleViewSubject",
   "com.sun.identity.admin.model.OrViewSubject",
   "com.sun.identity.admin.model.VirtualViewSubject",
   "com.sun.identity.admin.model.IdRepoGroupViewSubject",
   "com.sun.identity.admin.model.AttributeViewSubject"
  ],
  "entitlementCombiner" : "DenyOverride",
  "saveIndex" : null,
  "searchIndex" : null,
  "attributeNames" : [ ]
}
   </pre><p>
    You can use the query string parameters
    <code class="literal">_prettyPrint=true</code> to make the output easier to read,
    and <code class="literal">_fields=<em class="replaceable"><code>field-name</code></em>[,<em class="replaceable"><code>field-name</code></em>...]</code>
    to limit the fields returned in the output.
   </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="rest-api-authz-applications-delete"></a>4.5.4.&nbsp;Deleting Applications</h3></div></div></div><p>
    To delete an application definition, perform an HTTP DELETE
    specifying the resource name.
   </p><p>
    The <code class="literal">iPlanetDirectoryPro</code> header sets the SSO token
    for a user who has access to perform the operation.
   </p><pre class="brush: plain;">
$ curl \
 --request DELETE \
 --header "iPlanetDirectoryPro: AQIC5..." \
 https://openam.example.com:8443/openam/json/applications/crest
{}
   </pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="rest-api-authz-applications-query"></a>4.5.5.&nbsp;Listing Applications</h3></div></div></div><p>
    To list application definitions, perform an HTTP GET on the endpoint,
    setting at least the <code class="literal">_queryFilter</code> query string parameter.
   </p><pre class="brush: plain;">
$ curl \
 --header "iPlanetDirectoryPro: AQIC5..." \
 https://openam.example.com:8443/openam/json/myRealm/applications?_queryFilter
    =true
{
  "result" : [ {
    "name" : "myApp",
    "resources" : [
      "http://*:*/*",
      "http://*:*/*?*"
    ],
    "actions" : {
      "POST" : true,
      "PATCH" : true,
      "GET" : true,
      "DELETE" : true,
      "OPTIONS" : true,
      "PUT" : true,
      "HEAD" : true
    },
    "conditions" : [
      "AuthenticateToService",
      "AuthLevelLE",
      "AuthScheme",
      "IPv6",
      "SimpleTime",
      "OAuth2Scope",
      "IPv4",
      "AuthenticateToRealm",
      "OR",
      "AMIdentityMembership",
      "LDAPFilter",
      "AuthLevel",
      "SessionProperty",
      "Session",
      "NOT",
      "AND",
      "ResourceEnvIP"
    ],
    "attributeNames" : [
    ],
    "realm":"/",
    "creationDate":1416428109115,
    "lastModifiedDate":1416428109115,
    "lastModifiedBy":"id=dsameuser,ou=user,dc=openam,dc=forgerock,dc=org",
    "subjects":[
      "JwtClaim",
      "AuthenticateUsers",
      "Identity",
      "NOT",
      "AND",
      "OR",
    ],
    "description":"The built-in Application used by OpenAM Policy Agents",
    "createdBy":id=dsameuser,ou=user,dc=openam,dc=forgerock,dc=org",
    "applicationType":"iPlanetAMWebServices",
    "entitlementCombiner":"DenyOverride",
    },
  ],
  "resultCount":1,
  "pagedResultsCookie":null,
  "remainingPagedResults":0
}
   </pre><p>
    The <code class="literal">_queryFilter</code> parameter can take
    <code class="literal">true</code> to match every policy,
    <code class="literal">false</code> to match no policies,
    or a filter of the following form to match field values:
    <code class="literal"><em class="replaceable"><code>field</code></em> <em class="replaceable"><code>operator</code></em> <em class="replaceable"><code>value</code></em></code>
    where <em class="replaceable"><code>field</code></em> represents the field name,
    <em class="replaceable"><code>operator</code></em> is the operator code,
    <em class="replaceable"><code>value</code></em> is the value to match,
    and the entire filter is URL encoded.
    Supported operators are as follows:
   </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
      <code class="literal">eq</code>: equals (for matching strings)
     </p></li><li class="listitem"><p>
      <code class="literal">ge</code>: greater than or equal to (for matching integers)
     </p></li><li class="listitem"><p>
      <code class="literal">gt</code>: greater than (for matching integers)
     </p></li><li class="listitem"><p>
      <code class="literal">le</code>: less than or equal to (for matching integers)
     </p></li><li class="listitem"><p>
      <code class="literal">lt</code>: less than (for matching integers)
     </p></li></ul></div><div class="itemizedlist"><p>
     The <code class="literal"><em class="replaceable"><code>field</code></em></code> value
     can take the following values:
    </p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
      <code class="literal">"name"</code> (string)
     </p></li><li class="listitem"><p>
      <code class="literal">"description"</code> (string)
     </p></li><li class="listitem"><p>
      <code class="literal">"createdBy"</code> (string)
     </p></li><li class="listitem"><p>
      <code class="literal">"creationDate"</code> (date)
     </p></li><li class="listitem"><p>
      <code class="literal">"lastModifiedBy"</code> (string)
     </p></li><li class="listitem"><p>
      <code class="literal">"lastModified"</code> (date)
     </p></li><li class="listitem"><p>
      <code class="literal">"lastModified"</code>
     </p></li></ul></div><p>
    The String fields only support the <code class="literal">eq</code> operator, which is
    implemented using regular expression pattern matching.
   </p><p>
    The Date files support the <code class="literal">eq</code>, <code class="literal">ge</code>,
    <code class="literal">gt</code>, <code class="literal">le</code>, and <code class="literal">lt</code>
    operators. The implementation of <code class="literal">eq</code> for the Date fields
    do not use regular expression pattern matching.
   </p><p>
    Filters can be composed of multiple expressions
    by a using boolean operator <code class="literal">AND</code>,
    and by using parentheses,
    <code class="literal">(<em class="replaceable"><code>expression</code></em>)</code>,
    to group expressions.
    You must URL encode the filter expression
    in <code class="literal">_queryFilter=<em class="replaceable"><code>filter</code></em></code>.
   </p><p>
    Since regular expressions are implemented for some operators, you can specify
    a filter that can include or exclude specified elements. For example,
    the following query searches for application names containing 'iPlanet'.
    The <code class="literal">queryFilter</code> string is URL-encoded.
   </p><pre class="brush: plain;">
$ curl --header "iPlanetyDirectoryPro" AQIC5..." \
https://openam.example.com:443/openam/json/realm/applications?_queryFilter=name%20eq%20%22iPlanet.*%22
   </pre><div class="note"><h3 class="title">Note</h3><p>While some operators use regular expressions as its underlying
    mechanism, CREST endpoints do not use regular expressions.
   </p></div><p>
    You can use the query string parameters
    <code class="literal">_prettyPrint=true</code> to make the output easier to read,
    <code class="literal">_fields=<em class="replaceable"><code>field-name</code></em>[,<em class="replaceable"><code>field-name</code></em>...]</code>
    to limit the fields returned in the output.
   </p><p>
    You can use <code class="literal">_pageSize=<em class="replaceable"><code>integer</code></em></code>
    to limit the number of results returned.
   </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="rest-api-authz-application-types"></a>4.6.&nbsp;Viewing Application Types</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="chap-rest-authz-policy.html#rest-api-authz-application-types-read">4.6.1. Reading Application Types</a></span></dt><dt><span class="section"><a href="chap-rest-authz-policy.html#rest-api-authz-application-types-query">4.6.2. Listing Application Types</a></span></dt></dl></div><p>
   Application types act as templates for creating applications.
  </p><p>
   The default application type that represents web resources
   is <code class="literal">iPlanetAMWebAgentService</code>,
   which defines resources as URL patterns and actions as HTTP methods.
   OpenAM policy agents use a default application type based on this type,
   which is called <code class="literal">iPlanetAMWebAgentService</code>.
   This is the application type for policies
   that you edit through OpenAM console.
  </p><p>
   OpenAM supports other application types as well, such as CREST types,
   that you can manage over the policy REST endpoints.
   If you configure the OpenAM policy agents to work with application types other than
   <code class="literal">iPlanetAMWebAgentService</code>, you must ensure that your
   policy evaluation points (PEPs) work with the REST endpoints for policy
   decision requests.
  </p><p>
   Applications types are server-wide, and do not differ by realm.
   Hence the URI for the application types API
   does not contain a realm component,
   but is <code class="literal">/json/applicationtypes</code>.
  </p><p>
   Application type resources are represented in JSON and take the following form.
   Application type resources are built from standard JSON objects and values
   (strings, numbers, objects, arrays, <code class="literal">true</code>,
   <code class="literal">false</code>, and <code class="literal">null</code>).
  </p><pre class="brush: javascript;">
{
  "name": "application type name string",
  "actions": {
     "action name string": true,
     "other action name string": false,
     ...
  },
  "resourceComparator": "resource comparator class name",
  "saveIndex": "save index class name",
  "searchIndex": "search index class name",
  "applicationClassName": "com.sun.identity.entitlement.Application"
}
  </pre><div class="variablelist"><p>
    The values for the fields shown in the description are explained below:
   </p><dl class="variablelist"><dt><span class="term"><code class="literal">"name"</code></span></dt><dd><p>
      String matching the name
      in the URL used when creating the application type by HTTP PUT
      or in the body when creating the application type by HTTP POST.
     </p></dd><dt><span class="term"><code class="literal">"actions"</code></span></dt><dd><p>
      Set of string action names,
      each set to a boolean indicating whether the action is allowed
      as in the following example:
     </p><pre class="brush: javascript;">
{
    "actions": {
        "UPDATE": true,
        "PATCH": true,
        "QUERY": true,
        "CREATE": true,
        "DELETE": true,
        "READ": true,
        "ACTION": true
    }
}
     </pre></dd><dt><span class="term"><code class="literal">"resourceComparator"</code></span></dt><dd><p>
      Class name of the resource comparator implementation used
      in the context of this application.
     </p><p>
      The following implementations are available:
     </p><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="literal">"com.sun.identity.entitlement.ExactMatchResourceName"</code></td></tr><tr><td><code class="literal">"com.sun.identity.entitlement.PrefixResourceName"</code></td></tr><tr><td><code class="literal">"com.sun.identity.entitlement.RegExResourceName"</code></td></tr><tr><td><code class="literal">"com.sun.identity.entitlement.URLResourceName"</code></td></tr></table></dd><dt><span class="term"><code class="literal">"resourceComparator"</code></span></dt><dd><p>
      Class name of the resource comparator implementation used
      in the context of this application.
     </p><p>
      The following implementations are available:
     </p><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="literal">"com.sun.identity.entitlement.ExactMatchResourceName"</code></td></tr><tr><td><code class="literal">"com.sun.identity.entitlement.PrefixResourceName"</code></td></tr><tr><td><code class="literal">"com.sun.identity.entitlement.RegExResourceName"</code></td></tr><tr><td><code class="literal">"com.sun.identity.entitlement.URLResourceName"</code></td></tr></table></dd><dt><span class="term"><code class="literal">"saveIndex"</code></span></dt><dd><p>
      Class name of the implementation for creating indexes for resource names,
      such as <code class="literal">"com.sun.identity.entitlement.util.ResourceNameIndexGenerator"</code>
      for URL resource names.
     </p></dd><dt><span class="term"><code class="literal">"searchIndex"</code></span></dt><dd><p>
      Class name of the implementation for searching indexes for resource names,
      such as <code class="literal">"com.sun.identity.entitlement.util.ResourceNameSplitter"</code>
      for URL resource names.
     </p></dd><dt><span class="term"><code class="literal">"applicationClassName"</code></span></dt><dd><p>
      Class name of the application implementation,
      such as <code class="literal">"com.sun.identity.entitlement.Application"</code>.
     </p></dd></dl></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="rest-api-authz-application-types-read"></a>4.6.1.&nbsp;Reading Application Types</h3></div></div></div><p>
    To read an application type, perform an HTTP GET
    specifying the resource name.
   </p><p>
    The <code class="literal">iPlanetDirectoryPro</code> header sets the SSO token
    for a user who has access to perform the operation.
   </p><pre class="brush: plain;">
$ curl \
 --header "iPlanetDirectoryPro: AQIC5..." \
 https://openam.example.com:8443/openam/json/applicationtypes/crestPolicyService
{
  "name" : "crestPolicyService",
  "actions" : {
    "UPDATE" : true,
    "PATCH" : true,
    "QUERY" : true,
    "CREATE" : true,
    "DELETE" : true,
    "READ" : true,
    "ACTION" : true
  },
  "resourceComparator" : "com.sun.identity.entitlement.URLResourceName",
  "saveIndex" : "org.forgerock.openam.entitlement.indextree.TreeSaveIndex",
  "searchIndex" : "org.forgerock.openam.entitlement.indextree.TreeSearchIndex",
  "applicationClassName" : "com.sun.identity.entitlement.Application"
}

   </pre><p>
    You can use the query string parameters
    <code class="literal">_prettyPrint=true</code> to make the output easier to read,
    and <code class="literal">_fields=<em class="replaceable"><code>field-name</code></em>[,<em class="replaceable"><code>field-name</code></em>...]</code>
    to limit the fields returned in the output.
   </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="rest-api-authz-application-types-query"></a>4.6.2.&nbsp;Listing Application Types</h3></div></div></div><p>
    To list application types, perform an HTTP GET on the endpoint,
    setting at least the <code class="literal">_queryFilter</code> query string parameter
    as in the following example:
   </p><pre class="brush: plain;">
$ curl \
 --header "iPlanetDirectoryPro: AQIC5..." \
 https://openam.example.com:8443/openam/json/applicationtypes?_queryFilter=true
{
  "result" : [ ... application types ... ],
  "resultCount" : 8,
  "pagedResultsCookie" : null,
  "remainingPagedResults" : -1
}
   </pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="rest-api-authz-condition-types"></a>4.7.&nbsp;Viewing Condition Types</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="chap-rest-authz-policy.html#rest-api-authz-condition-types-read">4.7.1. Reading Condition Types</a></span></dt><dt><span class="section"><a href="chap-rest-authz-policy.html#rest-api-authz-condition-types-query">4.7.2. Listing Condition Types</a></span></dt></dl></div><p>
   Condition types describe the JSON representation
   of conditions that you can use in policy definitions.
  </p><p>
   Condition types are server-wide, and do not differ by realm.
   Hence the URI for the condition types API
   does not contain a realm component,
   but is <code class="literal">/json/conditiontypes</code>.
  </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="rest-api-authz-condition-types-read"></a>4.7.1.&nbsp;Reading Condition Types</h3></div></div></div><p>
    To read a condition type, perform an HTTP GET
    specifying the resource name.
   </p><p>
    The <code class="literal">iPlanetDirectoryPro</code> header sets the SSO token
    for a user who has access to perform the operation.
   </p><p>
    You can use the query string parameter
    <code class="literal">_prettyPrint=true</code> to make the output easier to read.
   </p><pre class="brush: plain;">
$ curl \
 --header "iPlanetDirectoryPro: AQIC5..." \
 https://openam.example.com:8443/openam/json/myRealm/conditiontypes/IP
{
  "title" : "IP",
  "logical" : false,
  "config" : {
    "type" : "object",
    "properties" : {
      "startIp" : {
        "type" : "string"
      },
      "endIp" : {
        "type" : "string"
      }
    }
  }
}
   </pre><p>
    Notice that the condition type has a title,
    a "logical" field
    that indicates whether the type is a logical operator or takes a predicate,
    and a configuration specification.
    The configuration specification in this case indicates
    that an IP condition has two properties, "startIp" and "endIp",
    each of which take a string value.
    In other words, a concrete IP condition specification
    is represented in a policy definition as in the following example:
   </p><pre class="brush: javascript;">
{
   "type": "IP",
   "startIp": "127.0.0.1",
   "endIp": "127.0.0.255"
}
   </pre><p>
    The configuration is what differs the most across condition types.
    The NOT condition, for example, takes a single condition object
    as the body of its configuration.
   </p><pre class="brush: plain;">
$ curl \
 --header "iPlanetDirectoryPro: AQIC5..." \
 https://openam.example.com:8443/openam/json/myRealm/conditiontypes
    /NOT
{
  "title" : "NOT",
  "logical" : true,
  "config" : {
    "type" : "object",
    "properties" : {
      "condition" : {
        "type" : "object",
        "properties" : {
        }
      }
    }
  }
}
   </pre><p>
    The concrete NOT condition therefore takes the following form.
   </p><pre class="brush: javascript;">
{
    "type": "NOT",
    "condition": {
        ...
    }
}
   </pre><p>
    The OR condition takes an array of conditions.
   </p><pre class="brush: plain;">
$ curl \
 --header "iPlanetDirectoryPro: AQIC5..." \
 https://openam.example.com:8443/openam/json/myRealm/conditiontypes/OR
{
  "title" : "OR",
  "logical" : true,
  "config" : {
    "type" : "object",
    "properties" : {
      "conditions" : {
        "type" : "array",
        "items" : {
          "type" : "any"
        }
      }
    }
  }
}
   </pre><p>
    A corresponding concrete OR condition thus takes the following form.
   </p><pre class="brush: javascript;">
{
    "type": "OR",
    "conditions": [
        {
            ...
        },
        {
            ...
        },
        ...
    ]
}
   </pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="rest-api-authz-condition-types-query"></a>4.7.2.&nbsp;Listing Condition Types</h3></div></div></div><p>
    To list all condition types, perform an HTTP GET on the endpoint,
    setting the query string parameter, <code class="literal">_queryFilter=true</code>,
    as in the following example:
   </p><pre class="brush: plain;">
$ curl \
 --header "iPlanetDirectoryPro: AQIC5..." \
 https://openam.example.com:8443/openam/json/myRealm/conditiontypes?_queryFilter=true
{
  "result" : [ ... condition types ... ],
  "resultCount" : 10,
  "pagedResultsCookie" : null,
  "remainingPagedResults" : -1
}
   </pre><p>
    You can use the query string parameter
    <code class="literal">_prettyPrint=true</code> to make the output easier to read.
   </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="rest-api-authz-subject-attributes"></a>4.8.&nbsp;Viewing Subject Attributes</h2></div></div></div><p>
   When you define a policy subject condition, the condition can depend on values
   of subject attributes stored in a user's profile. The list of possible subject
   attributes that you can use depends on the LDAP User Attributes configured for
   the Identity data store where OpenAM looks up the user's profile.
  </p><p>
   Subject attributes derive from the list of LDAP user attributes configured
   for the Identity data store. For more information, see
   <a href="../../admin-guide/index/chap-realms.html#config-data-store" class="link">Configuring Data Stores</a>.

  </p><p>
   You can get a listing of all subject attribute
   names using the <code class="literal">/json/subjectattributes/?_queryFilter=true</code>
   command on the endpoint.
   There are no restrictions on the search and no pagination cookie is set.
   The subject
   attribute names are all returned as one in a "result" array named
   <code class="literal">applicationTypeNames</code>.
  </p><pre class="brush: plain;">
$ curl --request GET \
  --header "iPlanetDirectoryPro: AQIC&#8230;*" \
  --header "Content-Type: application/json" \
  http://openam.example.com:8080/openam/json/subjectattributes/?_queryFilter=true

{
 "result": [
   "sunIdentityServerPPInformalName",
   "sunIdentityServerPPFacadeGreetSound",
   "uid",
   "manager",
   "sunIdentityServerPPLegalIdentityGender",
   "sunIdentityServerPPCommonNameMN",
   "preferredLocale",
   "iplanet-am-session-get-valid-sessions",
   "sunIdentityServerPPFacadegreetmesound",
   "iplanet-am-user-password-reset-question-answer",
   "telephoneNumber",
   "employeeNumber",
   "iplanet-am-user-admin-start-dn",
   "iplanet-am-user-success-url",
   "sunIdentityServerPPDemographicsDisplayLanguage",
   "iplanet-am-user-federation-info",
   "objectClass",
   "sunIdentityServerPPDemographicsLanguage",
   "authorityRevocationList",
   "sunIdentityServerPPLegalIdentityDOB",
   "sunIdentityServerPPSignKey",
   "sunIdentityServerPPEmploymentIdentityOrg",
   "iplanet-am-session-max-caching-time",
   "sn",
   "iplanet-am-session-quota-limit",
   "sunIdentityServerPPEncryPTKey",
   "iplanet-am-session-max-session-time",
   "sunIdentityServerPPCommonNamePT",
   "sun-fm-saml2-nameid-info",
   "sunIdentityServerDiscoEntries",
   "iplanet-am-user-login-status",
   "sunIdentityServerPPCommonNameCN",
   "distinguishedName",
   "iplanet-am-session-max-idle-time",
   "cn",
   "sunIdentityServerPPLegalIdentityVATIdType",
   "iplanet-am-user-password-reset-options",
   "preferredlanguage",
   "iplanet-am-user-federation-info-key",
   "sunIdentityServerPPDemographicsAge",
   "inetUserHttpURL",
   "iplanet-am-user-alias-list",
   "sunIdentityServerPPFacadeNamePronounced",
   "sunIdentityServerPPEmploymentIdentityJobTitle",
   "sunIdentityMSISDNNumber",
   "sunIdentityServerPPMsgContact",
   "givenName",
   "sunIdentityServerPPLegalIdentityMaritalStatus",
   "devicePrintProfiles",
   "memberOf",
   "sun-fm-saml2-nameid-infokey",
   "iplanet-am-session-service-status",
   "sunIdentityServerPPLegalIdentityVATIdValue",
   "userPassword",
   "sunIdentityServerPPFacadeMugShot",
   "sunIdentityServerPPEmploymentIdentityAltO",
   "iplanet-am-user-auth-config",
   "assignedDashboard",
   "iplanet-am-user-failure-url",
   "sunAMAuthInvalidAttemptsData",
   "sunIdentityServerPPLegalIdentityLegalName",
   "adminRole",
   "sunIdentityServerPPCommonNameAltCN",
   "dn",
   "iplanet-am-session-add-session-listener-on-all-sessions",
   "userCertificate",
   "mail",
   "sunIdentityServerPPLegalIdentityAltIdValue",
   "iplanet-am-user-password-reset-force-reset",
   "caCertificate",
   "sunIdentityServerPPEmergencyContact",
   "sunIdentityServerPPDemographicsBirthDay",
   "sunIdentityServerPPFacadeWebSite",
   "preferredtimezone",
   "sunIdentityServerPPLegalIdentityAltIdType",
   "sunIdentityServerPPCommonNameSN",
   "sunIdentityServerPPAddressCard",
   "postalAddress",
   "iplanet-am-session-destroy-sessions",
   "inetUserStatus",
   "iplanet-am-auth-configuration",
   "iplanet-am-user-auth-modules",
   "iplanet-am-user-account-life",
   "sunIdentityServerPPDemographicsTimeZone",
   "sunIdentityServerPPCommonNameFN"
 ],
 "resultCount": 85,
 "pagedResultsCookie": null,
 "remainingPagedResults": 0
}

  </pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="rest-api-authz-subject-types"></a>4.9.&nbsp;Viewing Subject Types</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="chap-rest-authz-policy.html#rest-api-authz-subject-types-read">4.9.1. Reading Subject Types</a></span></dt><dt><span class="section"><a href="chap-rest-authz-policy.html#rest-api-authz-subject-types-query">4.9.2. Listing Subject Types</a></span></dt></dl></div><p>
   Subject types describe the JSON representation
   of subjects that you can use in policy definitions.
  </p><p>
   Subject types are server-wide, and do not differ by realm.
   Hence the URI for the subject types API
   does not contain a realm component,
   but is <code class="literal">/json/subjecttypes</code>.
  </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="rest-api-authz-subject-types-read"></a>4.9.1.&nbsp;Reading Subject Types</h3></div></div></div><p>
    To read a subject type, perform an HTTP GET
    specifying the resource name.
   </p><p>
    The <code class="literal">iPlanetDirectoryPro</code> header sets the SSO token
    for a user who has access to perform the operation.
   </p><p>
    You can use the query string parameter
    <code class="literal">_prettyPrint=true</code> to make the output easier to read.
   </p><pre class="brush: plain;">
$ curl \
 --header "iPlanetDirectoryPro: AQIC5..." \
 https://openam.example.com:8443/openam/json/subjecttypes/User
{
  "title" : "User",
  "logical" : false,
  "config" : {
    "type" : "object",
    "properties" : {
      "id" : {
        "type" : "string"
      }
    }
  }
}
   </pre><p>
    Notice that the subject type has a title,
    a "logical" field
    that indicates whether the type is a logical operator or takes a predicate,
    and a configuration specification.
    The configuration specification in this case indicates
    that a User subject has one property,
    an "Id", which takes a string value.
    In other words, a concrete User subject specification
    is represented in a policy definition as in the following example:
   </p><pre class="brush: javascript;">
{
   "type": "User",
   "id": "id=demo,ou=user,dc=openam,dc=forgerock,dc=org"
}
   </pre><p>
    The configuration is what differs the most across subject types.
    The AND condition, for example, takes an array of subject objects
    as the body of its configuration.
   </p><pre class="brush: plain;">
$ curl \
 --header "iPlanetDirectoryPro: AQIC5..." \
 https://openam.example.com:8443/openam/json/subjecttypes/AND
{
  "title" : "AND",
  "logical" : true,
  "config" : {
    "type" : "object",
    "properties" : {
      "subjects" : {
        "type" : "array",
        "items" : {
          "type" : "any"
        }
      }
    }
  }
}
   </pre><p>
    The concrete AND subject therefore takes the following form.
   </p><pre class="brush: javascript;">
{
    "type": "AND",
    "subject": [
      {
        ...
      },
      ...
    ]
}
   </pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="rest-api-authz-subject-types-query"></a>4.9.2.&nbsp;Listing Subject Types</h3></div></div></div><p>
    To list all subject types, perform an HTTP GET on the endpoint,
    setting the query string parameter, <code class="literal">_queryFilter=true</code>,
    as in the following example:
   </p><pre class="brush: plain;">
$ curl \
 --header "iPlanetDirectoryPro: AQIC5..." \
 https://openam.example.com:8443/openam/json/subjecttypes/?_queryFilter=true
{
  "result" : [ ... subject types ... ],
  "resultCount" : 10,
  "pagedResultsCookie" : null,
  "remainingPagedResults" : -1
}
   </pre><p>
    You can use the query string parameter
    <code class="literal">_prettyPrint=true</code> to make the output easier to read.
   </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="rest-api-authz-decision-combiners"></a>4.10.&nbsp;Viewing Decision Combiners</h2></div></div></div><p>
   Decision combiners describe how to resolve policy decisions
   when multiple policies apply.
  </p><p>
   Decision combiners are server-wide, and do not differ by realm.
   Hence the URI for the condition types API
   does not contain a realm component,
   but is <code class="literal">/json/decisioncombiners</code>.
  </p><p>
   To list all decision combiners, perform an HTTP GET on the endpoint,
   setting the query string parameter, <code class="literal">_queryFilter=true</code>,
   as in the following example:
  </p><pre class="brush: plain;">
$ curl \
 --header "iPlanetDirectoryPro: AQIC5..." \
 https://openam.example.com:8443/openam/json/decisioncombiners/?_queryFilter=true
{
  "result" : [ {
    "title" : "DenyOverride"
  } ],
  "resultCount" : 1,
  "pagedResultsCookie" : null,
  "remainingPagedResults" : -1
}
  </pre><p>
   You can use the query string parameter
   <code class="literal">_prettyPrint=true</code> to make the output easier to read.
  </p><p>
   To view an individual decision combiner, perform an HTTP GET on its resource.
  </p><pre class="brush: plain;">
$ curl \
 --header "iPlanetDirectoryPro: AQIC5..." \
 https://openam.example.com:8443/openam/json/decisioncombiners/DenyOverride
{
  "title" : "DenyOverride"
}
  </pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="rest-api-authz-referrals"></a>4.11.&nbsp;Managing Referrals</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="chap-rest-authz-policy.html#rest-api-authz-referrals-create">4.11.1. Creating Referrals</a></span></dt><dt><span class="section"><a href="chap-rest-authz-policy.html#rest-api-authz-referrals-read">4.11.2. Reading Referrals</a></span></dt><dt><span class="section"><a href="chap-rest-authz-policy.html#rest-api-authz-referrals-update">4.11.3. Updating Referrals</a></span></dt><dt><span class="section"><a href="chap-rest-authz-policy.html#rest-api-authz-referrals-delete">4.11.4. Deleting Referrals</a></span></dt><dt><span class="section"><a href="chap-rest-authz-policy.html#rest-api-authz-referrals-query">4.11.5. Listing Referrals</a></span></dt></dl></div><p>
   Referrals are represented in JSON. They
   use standard JSON objects and values
   (strings, numbers, objects, arrays, <code class="literal">true</code>,
   <code class="literal">false</code>, and <code class="literal">null</code>) as follows:
  </p><pre class="brush: javascript;">
   {
     "name": "MyReferral",
     "description": "Look for policies in two additional subrealms to protect HR pages",
     "resources": {
       "iPlanetAMWebAgentService" : [ "http://example.com/hr/*"]
     },
     "realms" : ["/MySubrealm", "/MySubrealm/ChildSubrealm"]
   }
  </pre><div class="variablelist"><p>
    The values for the fields shown in the example are explained below:
   </p><dl class="variablelist"><dt><span class="term"><code class="literal">"name"</code></span></dt><dd><p>
      String matching the name
      in the URL used when creating the referral by HTTP PUT
      or in the body when creating the referral by HTTP POST.
     </p></dd><dt><span class="term"><code class="literal">"description"</code></span></dt><dd><p>
      String describing the referral.
     </p></dd><dt><span class="term"><code class="literal">"resources"</code></span></dt><dd><p>
      The application and resource pattern string
      to which the referral applies. Each referral applies to a single
      application, so only a single application and
      resource pattern should be specified.
     </p></dd><dt><span class="term"><code class="literal">"realms"</code></span></dt><dd><p>
      One or more realms to search for policies that might protect
      the resource.
     </p></dd></dl></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="rest-api-authz-referrals-create"></a>4.11.1.&nbsp;Creating Referrals</h3></div></div></div><p>
    To create a referral,
    either perform an HTTP PUT indicating the full path to the resource
    and the name in the resource matching the name in the path,
    or perform an HTTP POST with the name to use specified in the resource.
   </p><p lang="en">
  Do not use special characters within policy, application or referral names
  (for example, "my+referral") using the Policy Editor or REST endpoints as
  OpenAM returns a 400 Bad Request error.
  The special characters are: double quotes ("), plus sign (+), comma (,),
  less than (&lt;), equals (=), greater than (&gt;), backslash (\), and
  null (\u0000).
 </p><p>
    The HTTP PUT form includes the referral definition as the JSON resource data,
    with the header <code class="literal">Content-Type: application/json</code>
    and uses the <code class="literal">If-None-Match: *</code> header.
   </p><p>
    The <code class="literal">iPlanetDirectoryPro</code> header sets the SSO token
    for a user who has access to perform the operation.
   </p><p>
    The following example creates a referral named <code class="literal">MyReferral</code>
    in the top-level realm. The referral causes OpenAM policy evaluation to
    search for policies defined in the <code class="literal">/MySubrealm</code> and
    <code class="literal">/MySubrealm/ChildSubrealms</code> realms
    that have application type <code class="literal">iPlanetAMWebAgentService</code> and
    protect pages under <code class="literal">http://example.com/hr/</code>.
   </p><pre class="brush: plain;">
    $ curl \
    --request PUT \
    --header "iPlanetDirectoryPro: AQIC5w..." \
    --header "If-None-Match: *" \
    --header "Content-Type: application/json" \
    --data '{
      "name": "MyReferral",
      "description": "Look for policies in two additional subrealms to protect HR pages",
      "resources": {
        "iPlanetAMWebAgentService" : [ "http://example.com/hr/*"]
      },
      "realms" : ["/MySubrealm", "/MySubrealm/ChildSubrealm"]
    }' \
    https://openam.example.com:8443/openam/json/referrals/MyReferral
   
    {
     "creationDate" : 1416956012949,
     "lastModifiedDate" : 1416956012949,
     "realms" : [ "/MySubrealm", "/MySubrealm/ChildSubrealm" ],
     "createdBy" : "id=amadmin,ou=user,dc=example,dc=com",
     "lastModifiedBy" : "id=amadmin,ou=user,dc=example,dc=com",
     "resources" : {
       "iPlanetAMWebAgentService" : [ "http://example.com/hr/*" ]
     },
     "name" : "MyReferral"
    }
   </pre><p>
    You can use the query string parameters
    <code class="literal">_prettyPrint=true</code> to make the output easier to read,
    and <code class="literal">_fields=<em class="replaceable"><code>field-name</code></em>
    [,<em class="replaceable"><code>field-name</code></em>...]</code>
    to limit the fields returned in the output.
   </p><p>
    The HTTP POST form includes the referral definition as the JSON resource data,
    with the header <code class="literal">Content-Type: application/json</code>
    and uses the <code class="literal">_action=create</code> operation.
   </p><p>
    The <code class="literal">iPlanetDirectoryPro</code> header sets the SSO token
    for a user who has access to perform the operation.
   </p><pre class="brush: plain;">
    $ curl \
    --request POST \
    --header "iPlanetDirectoryPro: AQIC5..." \
    --header "Content-Type: application/json" \
    --data '{
      "name": "MyReferralTwo",
      "description": "Look for policies in two additional subrealms to protect IT pages",
      "resources": {
        "iPlanetAMWebAgentService" : [ "http://example.com/it/*"]
      },
      "realms" : ["/MySubrealm", "/MySubrealm/ChildSubrealm"]
    }' \
    https://openam.example.com:8443/openam/json/referrals?_action=create
   
   
   {
     "creationDate" : 1416956884965,
     "lastModifiedDate" : 1416956884965,
     "realms" : [ "/MySubrealm", "/MySubrealm/ChildSubrealm" ],
     "createdBy" : "id=amadmin,ou=user,dc=example,dc=com",
     "lastModifiedBy" : "id=amadmin,ou=user,dc=example,dc=com",
     "resources" : {
       "iPlanetAMWebAgentService" : [ "http://example.com/it/*" ]
     },
     "name" : "MyReferralTwo"
   }
   
   </pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="rest-api-authz-referrals-read"></a>4.11.2.&nbsp;Reading Referrals</h3></div></div></div><p>
    To read a referral definition, perform an HTTP GET
    specifying the resource name.
   </p><p>
    The <code class="literal">iPlanetDirectoryPro</code> header sets the SSO token
    for a user who has access to perform the operation.
   </p><pre class="brush: plain;">
    $ curl \
    --header "iPlanetDirectoryPro: AQIC5..." \
    https://openam.example.com:8443/openam/json/referrals/MyReferral
   
   
   {
     "creationDate" : 1416956012949,
     "lastModifiedDate" : 1416956012949,
     "realms" : [ "/MySubrealm", "/MySubrealm/ChildSubrealm" ],
     "createdBy" : "id=amadmin,ou=user,dc=example,dc=com",
     "lastModifiedBy" : "id=amadmin,ou=user,dc=example,dc=com",
     "resources" : {
       "iPlanetAMWebAgentService" : [ "http://example.com/hr/*" ]
     },
     "name" : "MyReferral"
   }
   </pre><p>
    You can use the query string parameters
    <code class="literal">_prettyPrint=true</code> to make the output easier to read,
    and <code class="literal">_fields=<em class="replaceable"><code>field-name</code></em>
    [,<em class="replaceable"><code>field-name</code></em>...]</code>
    to limit the fields returned in the output.
   </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="rest-api-authz-referrals-update"></a>4.11.3.&nbsp;Updating Referrals</h3></div></div></div><p>
    To update a referral, perform an HTTP PUT
    specifying the resource name
    with the referral definition as the JSON resource data,
    and with the header <code class="literal">Content-Type: application/json</code>.
    This is essentially the same as creating a referral,
    but without the <code class="literal">If-None-Match: *</code> header.
   </p><p>
    The <code class="literal">iPlanetDirectoryPro</code> header sets the SSO token
    for a user who has access to perform the operation.
   </p><pre class="brush: plain;">
    $ curl \
    --request PUT \
    --header "iPlanetDirectoryPro: AQIC5w..." \
    --header "Content-Type: application/json" \
    --data '{
      "name": "MyReferral",
      "description": "Update referral to protect HR US pages only",
      "resources": {
        "iPlanetAMWebAgentService" : [ "http://example.com/hr/us/*"]
      },
      "realms" : ["/MySubrealm", "/MySubrealm/ChildSubrealm"]
    }' \
    https://openam.example.com:8443/openam/json/referrals/MyReferral
   
   
   {
     "creationDate" : 1416959024216,
     "lastModifiedDate" : 1416959024216,
     "realms" : [ "/MySubrealm", "/MySubrealm/ChildSubrealm" ],
     "createdBy" : "id=amadmin,ou=user,dc=example,dc=com",
     "lastModifiedBy" : "id=amadmin,ou=user,dc=example,dc=com",
     "resources" : {
       "iPlanetAMWebAgentService" : [ "http://example.com/hr/us/*" ]
     },
     "name" : "MyReferral"
   }
   
   </pre><div class="tip"><h3 class="title">Tip</h3><p>You can rename a referral by sending a new value in the
    <span class="emphasis"><em>name</em></span> attribute of the JSON body,
    as shown below.</p><pre class="brush: plain;">
     $ curl \
     --request PUT \
     --header "iPlanetDirectoryPro: AQIC5w..." \
     --header "Content-Type: application/json" \
     --data '{
       "name": "MyReferralHRUS",
       "description": "Update referral to protect HR US pages only",
       "resources": {
         "iPlanetAMWebAgentService" : [ "http://example.com/hr/us/*"]
       },
       "realms" : ["/MySubrealm", "/MySubrealm/ChildSubrealm"]
     }' \
     https://openam.example.com:8443/openam/json/referrals/MyReferral
    
    
    {
      "creationDate" : 1416959240491,
      "lastModifiedDate" : 1416959240491,
      "realms" : [ "/MySubrealm", "/MySubrealm/ChildSubrealm" ],
      "createdBy" : "id=amadmin,ou=user,dc=example,dc=com",
      "lastModifiedBy" : "id=amadmin,ou=user,dc=example,dc=com",
      "resources" : {
        "iPlanetAMWebAgentService" : [ "http://example.com/hr/us/*" ]
      },
      "name" : "MyReferralHRUS"
    }
    </pre></div><p>
    You can use the query string parameters
    <code class="literal">_prettyPrint=true</code> to make the output easier to read,
    and <code class="literal">_fields=<em class="replaceable"><code>field-name</code></em>
    [,<em class="replaceable"><code>field-name</code></em>...]</code>
    to limit the fields returned in the output.
   </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="rest-api-authz-referrals-delete"></a>4.11.4.&nbsp;Deleting Referrals</h3></div></div></div><p>
    To delete a referral, perform an HTTP DELETE
    specifying the resource name.
   </p><p>
    The <code class="literal">iPlanetDirectoryPro</code> header sets the SSO token
    for a user who has access to perform the operation.
   </p><pre class="brush: plain;">
    $ curl \
    --header "iPlanetDirectoryPro: AQIC5w..." \
    --request DELETE \
    https://openam.example.com:8443/openam/json/referrals/MyReferralHRUS
    {}
   </pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="rest-api-authz-referrals-query"></a>4.11.5.&nbsp;Listing Referrals</h3></div></div></div><p>
    To list referrals, perform an HTTP GET on the endpoint, setting
    at least the <code class="literal">_queryFilter</code> query string parameter.
   </p><pre class="brush: plain;">
    $ curl \
    --header "iPlanetDirectoryPro: AQIC5w..." \
    https://openam.example.com:8443/openam/json/referrals?_queryFilter=true
   
   
   {
     "result" : [ {
       "creationDate" : 1416956689230,
       "lastModifiedDate" : 1416956689230,
       "realms" : [ "/MySubrealm", "/MySubrealm/ChildSubrealm" ],
       "createdBy" : "id=amadmin,ou=user,dc=example,dc=com",
       "lastModifiedBy" : "id=amadmin,ou=user,dc=example,dc=com",
       "resources" : {
         "iPlanetAMWebAgentService" : [ "http://example.com/it/*" ]
       },
       "name" : "MyReferralOne"
       }, {
       "creationDate" : 1416956884965,
       "lastModifiedDate" : 1416956884965,
       "realms" : [ "/MySubrealm", "/MySubrealm/ChildSubrealm" ],
       "createdBy" : "id=amadmin,ou=user,dc=example,dc=com",
       "lastModifiedBy" : "id=amadmin,ou=user,dc=example,dc=com",
       "resources" : {
         "iPlanetAMWebAgentService" : [ "http://example.com/finance/*" ]
       },
       "name" : "MyReferralTwo"
     } ],
     "resultCount" : 2,
     "pagedResultsCookie" : null,
     "remainingPagedResults" : 2
   }
   
   </pre><p>
    The <code class="literal">_queryFilter</code> parameter can take
    <code class="literal">true</code> to match every referral,
    <code class="literal">false</code> to match no referrals,
    or a filter of the following form to match field values:
    <code class="literal"><em class="replaceable"><code>field</code></em> <em class="replaceable"><code>operator</code></em> <em class="replaceable"><code>value</code></em></code>
    where <em class="replaceable"><code>field</code></em> represents the field name,
    <em class="replaceable"><code>operator</code></em> is the operator code,
    <em class="replaceable"><code>value</code></em> is the value to match,
    and the entire filter is URL encoded.
    Supported operators are as follows:
   </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
      <code class="literal">eq</code>: equals
     </p></li><li class="listitem"><p>
      <code class="literal">ge</code>: greater than or equal to
     </p></li><li class="listitem"><p>
      <code class="literal">gt</code>: greater than
     </p></li><li class="listitem"><p>
      <code class="literal">le</code>: less than or equal to
     </p></li><li class="listitem"><p>
      <code class="literal">lt</code>: less than
     </p></li></ul></div><div class="itemizedlist"><p>
     The <code class="literal"><em class="replaceable"><code>field</code></em></code> value
     can take the following values:
    </p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
      <code class="literal">"name"</code> (string equality only)
     </p></li><li class="listitem"><p>
      <code class="literal">"description"</code> (string equality only)
     </p></li><li class="listitem"><p>
      <code class="literal">"applicationName"</code> (string equality only)
     </p></li><li class="listitem"><p>
      <code class="literal">"createdBy"</code> (string equality only)
     </p></li><li class="listitem"><p>
      <code class="literal">"lastModifiedBy"</code> (string equality only)
     </p></li><li class="listitem"><p>
      <code class="literal">"creationDate"</code> (all comparisons are supported;
      the date is either an
      <a class="link" href="http://www.w3.org/TR/NOTE-datetime" target="_blank">ISO-8601</a>
      string, or a integer number of seconds from the UNIX epoch)
     </p></li><li class="listitem"><p>
      <code class="literal">"lastModified"</code> (all comparisons are supported;
      the date is either an
      <a class="link" href="http://www.w3.org/TR/NOTE-datetime" target="_blank">ISO-8601</a>
      string, or a integer number of seconds from the UNIX epoch)
     </p></li></ul></div><p>
    Filters can be composed of multiple expressions
    by a using boolean operator
    <code class="literal">AND</code>,
    
    and by using parentheses,
    <code class="literal">(<em class="replaceable"><code>expression</code></em>)</code>,
    to group expressions.
    You must URL encode the filter expression
    in <code class="literal">_queryFilter=<em class="replaceable"><code>filter</code></em></code>.
   </p><p>
    You can use the query string parameters
    <code class="literal">_prettyPrint=true</code> to make the output easier to read,
    <code class="literal">_fields=<em class="replaceable"><code>field-name</code></em>[,<em class="replaceable"><code>field-name</code></em>...]</code>
    to limit the fields returned in the output.
   </p><p>
    You can use <code class="literal">_pageSize=<em class="replaceable"><code>integer</code></em></code>
    to limit the number of results returned.
   </p><p>
    You can use <code class="literal">_sortKeys=[+-]<em class="replaceable"><code>field</code></em>[,<em class="replaceable"><code>field</code></em>...]</code>
    to sort the results returned,
    where <em class="replaceable"><code>field</code></em> represents a field
    in the JSON referral objects returned.
    Optionally use the <code class="literal">+</code> prefix to sort in ascending order
    (the default),
    or <code class="literal">-</code> to sort in descending order.
    The following example sorts the referrals by their names in descending order.
   </p><pre class="brush: plain;">
    $ curl \
    --header "iPlanetDirectoryPro: AQIC5w..." \
    https://openam.example.com:8443/openam/json/referrals?_queryFilter=true\&amp;_sortKeys=-name
    
    {
      "result" : [ {
        "name" : "MyReferralTwo"
       }, {
         "name" : "MyReferralOne"
       } ],
       "resultCount" : 2,
       "pagedResultsCookie" : null,
       "remainingPagedResults" : 2
     }
    
   </pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="rest-api-authz-legacy"></a>4.12.&nbsp;Authorization (Legacy API)</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="chap-rest-authz-policy.html#rest-api-policy-decisions">4.12.1. Requesting Policy Decisions (Legacy API)</a></span></dt></dl></div><p>You can call on OpenAM to decide whether to authorize access to a
   protected resource based on a valid token. Of course, you must percent
   encode the resource URI.
  </p><p>Interface Stability:
   <a href="../../admin-guide/index/appendix-interface-stability.html#interface-stability" class="link">Deprecated</a>
  </p><pre class="brush: plain;">
$ curl "https://openam.example.com:8443/openam/identity/authorize?\
uri=http%3A%2F%2Fwww.example.com%3A8080%2Fexamples%2Findex.html\
&amp;subjectid=AQIC5wM2LY4SfcxuxIP0VnP2lVjs7ypEM6VDx6srk56CN1Q.*AAJTSQACMDE.*"
boolean=true
  </pre><p>
   To indicate access denied, OpenAM returns
   <code class="literal">boolean=false</code>.
  </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="rest-api-policy-decisions"></a>4.12.1.&nbsp;Requesting Policy Decisions (Legacy API)</h3></div></div></div><p>OpenAM provides additional REST APIs for requesting policy
    decisions.
   </p><div class="itemizedlist"><p>The policy decision interfaces use the following path suffixes and
     query string parameters.
    </p><p>
     Path suffixes for policy decision requests include the following:
    </p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">ws/1/entitlement/decision</code>. Request a decision
      pertaining to a single resource.</p></li><li class="listitem"><p><code class="literal">ws/1/entitlement/decisions</code>. Request decisions
     pertaining to multiple resources.</p></li><li class="listitem"><p>
      <code class="literal">ws/1/entitlement/entitlement</code>. Request decisions
      for a specified resource URL.
     </p></li><li class="listitem"><p>
      <code class="literal">ws/1/entitlement/entitlements</code>. Request decisions
      for a specified resource URL and all resources underneath.
     </p></li></ul></div><div class="itemizedlist"><p>
     Query string parameters for policy decision requests include the
     following.
    </p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">subject=<em class="replaceable"><code>encoded-token</code></em></code>,
      where the token is encoded using the method implemented in
      <a class="link" href="http://sources.forgerock.org/browse/~raw,r=6/openam/trunk/opensso/www/public/use/docs/fampdf/Encoder.java" target="_blank"><code class="filename">Encoder.java</code></a>.
     </p><p>
      In the examples for this section, the token ID obtained during
      authentication for <code class="literal">amadmin</code> is abbreviated as
      <code class="literal">AQIC5...DU3*</code> and the encoded token ID for the subject
      is <code class="literal">MJ3QFTr4ZV2QrtlJvXlg0Q2dMRM=</code>.
     </p></li><li class="listitem"><p>
      <code class="literal">action=get</code>, or <code class="literal">action=post</code>,
      which identifies the user agent action when requesting a decision.
     </p></li><li class="listitem"><p>
      <code class="literal">application=iPlanetAMWebAgentService</code>
      or <code class="literal">application=crestPolicyService</code>
     </p></li><li class="listitem"><p>
      <code class="literal">resource=<em class="replaceable"><code>resource-url</code></em></code>,
     or multiple <code class="literal">resources=<em class="replaceable"><code>resource-url</code></em></code>
     parameters for multiple decisions.
     </p></li><li class="listitem"><p>
      <code class="literal">env=<em class="replaceable"><code>requestDnsName%3Dfqdn</code></em></code>,
      <code class="literal">env=<em class="replaceable"><code>requestIP%3Ddotted-quads</code></em></code>,
      <code class="literal">env=<em class="replaceable"><code>requestTime%3Dseconds-since-epoch</code></em></code>,
      and <code class="literal">env=<em class="replaceable"><code>requestDnsName%3Dtime-zone</code></em></code>
      where <em class="replaceable"><code>time-zone</code></em> is from Java
      <code class="literal">TimeZone.getTimeZone().getID()</code>. The
      <code class="literal">env</code> parameters thus express conditions.
     </p><p>
      In order to express a condition that specifies OAuth 2.0 scopes,
      set the value of the parameter
      to <code class="literal">scope=<em class="replaceable"><code>scopes</code></em></code>.
      To set scopes to <code class="literal">openid</code> and <code class="literal">profile</code>,
      use <code class="literal">env=scope%3Dopenid%20profile</code> for example.
  &nbsp;&nbsp; </p></li></ul></div><p>
    Authentication for these interfaces uses cookies, so if your
    application is not running in a browser, first authenticate as described in
    <a href="../../dev-guide/index/chap-rest.html#rest-api-auth-json" class="link">REST APIs for Authentication &amp; Logout</a>.
   </p><p>
    To request a decision for a single resource, use an HTTP GET on
    <code class="literal">/ws/1/entitlement/decision</code> as in the following example:
   </p><pre class="brush: plain;">
$ curl \
 --request GET \
 --cookie "iPlanetDirectoryPro=AQIC5...DU3*" \
 "https://openam.example.com:8443/openam/ws/1/entitlement/decision\
?subject=MJ3QFTr4ZV2QrtlJvXlg0Q2dMRM=&amp;action=GET\
&amp;application=iPlanetAMWebAgentService\
&amp;resource=http%3A%2F%2Fwww.example.com%2Findex.html"
allow
   </pre><p>
    If access is denied, the result is <code class="literal">deny</code>.
   </p><p>
    To request decisions for multiple resources, use an HTTP GET on
     <code class="literal">/ws/1/entitlement/decisions</code> as in the following example:
   </p><pre class="brush: plain;">
$ curl \
 --request GET \
 --cookie "iPlanetDirectoryPro=AQIC5...DU3*" \
 "https://openam.example.com:8443/openam/ws/1/entitlement/decisions\
?subject=MJ3QFTr4ZV2QrtlJvXlg0Q2dMRM=&amp;action=GET\
&amp;application=iPlanetAMWebAgentService\
&amp;resources=http%3A%2F%2Fwww.example.com%2Findex.html\
&amp;resources=http%3A%2F%2Fwww.example.com%2Ffavicon.ico"
{
    "statusCode": 200,
    "body": {
        "results": [
            {
                "actionsValues": {
                    "POST": true,
                    "GET": true
                },
                "attributes": {},
                "advices": {},
                "resourceName": "http://www.example.com:80/index.html"
            },
            {
                "actionsValues": {
                    "POST": true,
                    "GET": true
                },
                "attributes": {},
                "advices": {},
                "resourceName": "http://www.example.com:80/favicon.ico"
            }
        ]
    },
    "statusMessage": "OK"
}
   </pre><p>
    To request decisions for a given resource,
    use an HTTP GET on <code class="literal">/ws/1/entitlement/entitlement</code>
    as in the following example:
   </p><pre class="brush: plain;">
$ curl \
 --request GET \
 --cookie "iPlanetDirectoryPro=AQIC5...DU3*" \
 "https://openam.example.com:8443/openam/ws/1/entitlement/entitlement\
?subject=MJ3QFTr4ZV2QrtlJvXlg0Q2dMRM=\
&amp;application=iPlanetAMWebAgentService\
&amp;resource=http%3A%2F%2Fwww.example.com%2F*"
{
    "statusCode": 200,
    "body": {
        "actionsValues": {
            "POST": true,
            "GET": true
        },
        "attributes": {},
        "advices": {},
        "resourceName": "http://www.example.com:80/*"
    },
    "statusMessage": "OK"
}
   </pre><p>
    To request decisions for all resources underneath a given resource,
    use an HTTP GET on <code class="literal">/ws/1/entitlement/entitlements</code>
    as in the following example:
   </p><pre class="brush: plain;">
$ curl \
 --request GET \
 --cookie "iPlanetDirectoryPro=AQIC5...DU3*" \
 "https://openam.example.com:8443/openam/ws/1/entitlement/entitlements\
?subject=MJ3QFTr4ZV2QrtlJvXlg0Q2dMRM=\
&amp;application=iPlanetAMWebAgentService\
&amp;resource=http%3A%2F%2Fwww.example.com%2F"
{
    "statusCode": 200,
    "body": {
        "results": [
            {
                "actionsValues": {},
                "resourceName": "http://www.example.com:80/"
            },
            {
                "actionsValues": {
                    "POST": true,
                    "GET": true
                },
                "advices": {},
                "resourceName": "http://www.example.com:80/*"
            },
            {
                "actionsValues": {
                    "POST": true,
                    "GET": true
                },
                "attributes": {},
                "advices": {},
                "resourceName": "http://www.example.com:80/*?*"
            }
        ]
    },
    "statusMessage": "OK"
}
   </pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="rest-api-policy-management"></a>4.13.&nbsp;Managing Policies (Legacy API)</h2></div></div></div><p>
   OpenAM exposes a REST API through the
   <code class="literal">/ws/1/entitlement/privilege</code> endpoint under the
   deployment URI. The API lets you create, read, update, delete, and query
   policies.
  </p><p>
   Authentication for these interfaces uses cookies, so if your
   application is not running in a browser, first authenticate as described in
   <a href="../../dev-guide/index/chap-rest.html#rest-api-auth-json" class="link">REST APIs for Authentication &amp; Logout</a>.
  </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="rest-api-policy-management-create"></a>4.14.&nbsp;Creating Policies (Legacy API)</h2></div></div></div><p>
    You create a policy by using an HTTP POST of the JSON representation
    to the endpoint. You must URL encode the JSON before passing it to
    OpenAM.
   </p><pre class="brush: plain;">
$ cat entitlement.json
{
    "name": "Example HTTP",
    "eSubject": {
        "state": {
            "className": "com.sun.identity.policy.plugins.AuthenticatedUsers",
            "exclusive": false,
            "name": "All Authenticated Users",
            "values": []
        },
        "className": "com.sun.identity.entitlement.opensso.PolicySubject"
    },
    "entitlement": {
        "actionsValues": {
            "POST": true,
            "GET": true
        },
        "applicationName": "iPlanetAMWebAgentService",
        "name": "authorize",
        "resourceNames": [
            "http://www.example.com:80/*"
        ]
    }
}
$ curl \
 --request POST \
 --cookie "iPlanetDirectoryPro=AQIC5...DU3*" \
 --data-urlencode "privilege.json@entitlement.json" \
 https://openam.example.com:8443/openam/ws/1/entitlement/privilege
{"statusCode":201,"body":"Created","statusMessage":"Created"}

$ cat entitlement2.json
{
    "name": "Example HTTPS",
    "eSubject": {
        "state": {
            "className": "com.sun.identity.policy.plugins.AuthenticatedUsers",
            "exclusive": false,
            "name": "All Authenticated Users",
            "values": []
        },
        "className": "com.sun.identity.entitlement.opensso.PolicySubject"
    },
    "entitlement": {
        "actionsValues": {
            "POST": false,
            "GET": true
        },
        "applicationName": "iPlanetAMWebAgentService",
        "name": "authorize",
        "resourceNames": [
            "https://www.example.com:443/*?*"
        ]
    }
}

$ curl \
 --request POST \
 --cookie "iPlanetDirectoryPro=AQIC5...DU3*" \
 --data-urlencode "privilege.json@entitlement2.json" \
 https://openam.example.com:8443/openam/ws/1/entitlement/privilege
{"statusCode":201,"body":"Created","statusMessage":"Created"}
   </pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="rest-api-policy-management-read"></a>4.15.&nbsp;Reading Policies (Legacy API)</h2></div></div></div><p>
    To read a policy, use an HTTP GET on the endpoint followed by
    the URL-encoded name of the policy.
   </p><p>
    Notice that the "state" is returned as a long string, and so is not
    shown here in full.
   </p><pre class="brush: plain;">
$ curl \
 --request GET \
 --cookie "iPlanetDirectoryPro=AQIC5...DU3*" \
 https://openam.example.com:8443/openam/ws/1/entitlement/privilege/Example%20HTTP
{
    "statusCode": 200,
    "body": {
        "results": {
            "name": "Example HTTP",
            "eSubject": {
                "state": "{\n  \"className\": \"com.sun.identity.policy...}",
                "className": "com.sun.identity.entitlement.opensso.PolicySubject"
            },
            "entitlement": {
                "actionsValues": {
                    "POST": true,
                    "GET": true
                },
                "applicationName": "iPlanetAMWebAgentService",
                "name": "authorize",
                "resourceNames": [
                    "http://www.example.com:80/*"
                ]
            }
        }
    },
    "statusMessage": "OK"
}

$ curl \
 --request GET \
 --cookie "iPlanetDirectoryPro=AQIC5...DU3*" \
 https://openam.example.com:8443/openam/ws/1/entitlement/privilege/Example%20HTTPS
{
    "statusCode": 200,
    "body": {
        "results": {
            "name": "Example HTTPS",
            "eSubject": {
                "state": "{\n  \"className\": \"com.sun.identity.policy...}",
                "className": "com.sun.identity.entitlement.opensso.PolicySubject"
            },
            "entitlement": {
                "actionsValues": {
                    "POST": false,
                    "GET": true
                },
                "applicationName": "iPlanetAMWebAgentService",
                "name": "authorize",
                "resourceNames": [
                    "https://www.example.com:443/*?*"
                ]
            }
        }
    },
    "statusMessage": "OK"
}
   </pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="rest-api-policy-management-update"></a>4.16.&nbsp;Updating Policies (Legacy API)</h2></div></div></div><p>
    To update a policy, use an HTTP PUT on the endpoint followed by the
    URL-encoded name of the policy.
   </p><pre class="brush: plain;">
$ cat update.json
{
    "name": "Example HTTP",
    "eSubject": {
        "state": {
            "className": "com.sun.identity.policy.plugins.AuthenticatedUsers",
            "exclusive": false,
            "name": "All Authenticated Users",
            "values": []
        },
        "className": "com.sun.identity.entitlement.opensso.PolicySubject"
    },
    "entitlement": {
        "actionsValues": {
            "POST": false,
            "GET": true
        },
        "applicationName": "iPlanetAMWebAgentService",
        "name": "authorize",
        "resourceNames": [
            "http://www.example.com:80/*?*"
        ]
    }
}

$ curl \
 --request PUT \
 --cookie "iPlanetDirectoryPro=AQIC5...DU3*" \
 --data-urlencode "privilege.json@update.json" \
 https://openam.example.com:8443/openam/ws/1/entitlement/privilege/Example%20HTTP
{"statusCode":200,"body":"OK","statusMessage":"OK"}
   </pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="rest-api-policy-management-delete"></a>4.17.&nbsp;Deleting Policies (Legacy API)</h2></div></div></div><p>
    To delete a policy, use an HTTP DELETE on the endpoint followed by
    the URL-encoded name of the policy.
   </p><pre class="brush: plain;">
$ curl \
 --request DELETE \
 --cookie "iPlanetDirectoryPro=AQIC5...DU3*" \
 https://openam.example.com:8443/openam/ws/1/entitlement/privilege/Example%20HTTPS
{"statusCode":200,"body":"OK","statusMessage":"OK"}
   </pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="rest-api-policy-management-query"></a>4.18.&nbsp;Querying Policies (Legacy API)</h2></div></div></div><p>
    To get the names of policies, use an HTTP GET on the endpoint.
   </p><pre class="brush: plain;">
$ curl \
 --request GET \
 --cookie "iPlanetDirectoryPro=AQIC5...DU3*" \
 https://openam.example.com:8443/openam/ws/1/entitlement/privilege
{
    "statusCode": 200,
    "body": {
        "results": [
            "Example HTTPS",
            "Example HTTP"
        ]
    },
    "statusMessage": "OK"
}
   </pre><p>
    You can pass a filter query parameter to get only policies
    that match the filter. Make sure you URL encode the filter value.
   </p><pre class="brush: plain;">
$ curl \
 --request GET \
 --cookie "iPlanetDirectoryPro=AQIC5...DU3*" \
 "https://openam.example.com:8443/openam/ws/1/entitlement/privilege\
?subject=MJ3QFTr4ZV2QrtlJvXlg0Q2dMRM=&amp;filter=name%3D*HTTP"
{
    "statusCode": 200,
    "body": {
        "results": [
            "Example HTTP"
        ]
    },
    "statusMessage": "OK"
}
   </pre></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="chap-rest.html">Prev</a>&nbsp;</td><td width="20%" align="center">&nbsp;</td><td width="40%" align="right">&nbsp;<a accesskey="n" href="chap-rest-oauth2-oidc.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter&nbsp;3.&nbsp;RESTful Web Services&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;5.&nbsp;RESTful OAuth 2.0 and OpenID Connect 1.0 Services</td></tr></table></div><p>&nbsp;</p><div id="footer"><p>Something wrong on this page? <a href="https://bugster.forgerock.org/jira/secure/CreateIssueDetails!init.jspa?pid=10000&components=10007&issuetype=1">Log a documentation bug.</a></p></div>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-23412190-14']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</body></html>