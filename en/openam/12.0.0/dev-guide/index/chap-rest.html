<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head>

      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
   <title>Chapter&nbsp;3.&nbsp;RESTful Web Services</title><link rel="stylesheet" type="text/css" href="coredoc.css"><link rel="stylesheet" type="text/css" href="css/coredoc.css"><link rel="stylesheet" type="text/css" href="sh/shCore.css"><link rel="stylesheet" type="text/css" href="sh/shCoreEclipse.css"><link rel="stylesheet" type="text/css" href="sh/shThemeEclipse.css"><script src="http://code.jquery.com/jquery-1.11.0.min.js" type="text/javascript"></script><script src="uses-jquery.js" type="text/javascript"></script><script src="sh/shCore.js" type="text/javascript"></script><script src="sh/shBrushAci.js" type="text/javascript"></script><script src="sh/shBrushBash.js" type="text/javascript"></script><script src="sh/shBrushCsv.js" type="text/javascript"></script><script src="sh/shBrushHttp.js" type="text/javascript"></script><script src="sh/shBrushJava.js" type="text/javascript"></script><script src="sh/shBrushJScript.js" type="text/javascript"></script><script src="sh/shBrushLDIF.js" type="text/javascript"></script><script src="sh/shBrushPlain.js" type="text/javascript"></script><script src="sh/shBrushProperties.js" type="text/javascript"></script><script src="sh/shBrushXml.js" type="text/javascript"></script><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="OpenAM Developer's Guide"><link rel="up" href="index.html" title="OpenAM Developer's Guide"><link rel="prev" href="chap-client-dev.html" title="Chapter&nbsp;2.&nbsp;Developing Client Applications"><link rel="next" href="chap-rest-authz-policy.html" title="Chapter&nbsp;4.&nbsp;RESTful Authorization and Policy Management Services"><link rel="copyright" href="legalnotice.html" title="Legal Notice"><script type="text/javascript">SyntaxHighlighter.all();</script>
<link rel="shortcut icon" href="http://forgerock.org/favicon.ico">
</head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter&nbsp;3.&nbsp;RESTful Web Services</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="chap-client-dev.html">Prev</a>&nbsp;</td><th width="60%" align="center">&nbsp;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="chap-rest-authz-policy.html">Next</a></td></tr></table><hr></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-rest"></a>Chapter&nbsp;3.&nbsp;RESTful Web Services</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="section"><a href="chap-rest.html#about-openam-rest-api">3.1. About the RESTful APIs</a></span></dt><dt><span class="section"><a href="chap-rest.html#rest-api-versioning">3.2. REST API Versioning</a></span></dt><dt><span class="section"><a href="chap-rest.html#c66-encoding">3.3. Token Encoding</a></span></dt><dt><span class="section"><a href="chap-rest.html#rest-api-auth">3.4. Authentication &amp; Logout</a></span></dt><dt><span class="section"><a href="chap-rest.html#rest-api-serverinfo">3.5. Server Information</a></span></dt><dt><span class="section"><a href="chap-rest.html#rest-api-cookie-info">3.6. Cookie Information</a></span></dt><dt><span class="section"><a href="chap-rest.html#rest-api-tokens">3.7. Token Validation and Session Information</a></span></dt><dt><span class="section"><a href="chap-rest.html#rest-api-logging">3.8. Logging</a></span></dt><dt><span class="section"><a href="chap-rest.html#rest-api-status-codes">3.9. REST Status Codes</a></span></dt></dl></div><a class="indexterm" name="d0e381"></a><p>This chapter shows how to use the OpenAM RESTful interfaces for direct
 integration between web client applications and OpenAM.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="about-openam-rest-api"></a>3.1.&nbsp;About the RESTful APIs</h2></div></div></div><p>
   <a class="link" href="http://en.wikipedia.org/wiki/Representational_state_transfer" target="_blank">Representational State Transfer</a>(REST) is an architectural style
   that sets certain constraints for designing and building
   large-scale distributed hypermedia systems.
   As an architectural style, REST has very broad application.
   The designs of both HTTP 1.1 and also URIs follow RESTful principles.
   The World Wide Web is no doubt the largest and best known REST application.
   Many other web services also follow the REST architectural style.
   Examples include OAuth 2.0 and OpenID Connect 1.0.
  </p><p>
   ForgeRock Common REST (CREST) applies RESTful principles
   to define common verbs for HTTP-based APIs that access web resources
   and collections of web resources.
  </p><p>
   Native OpenAM REST APIs in version 11.0.0 and later use the CREST verbs.
   (In contrast, OAuth 2.0 and OpenID Connect 1.0 APIs follow the standards.)
   APIs covered in sections labelled (Legacy API) predate CREST,
   and do not use the CREST verbs.
  </p><p>
   When using a CREST API, you use the common verbs as query string parameters
   in resource and resource collection URIs.
  </p><div class="variablelist"><p>
    CREST APIs use these verbs.
   </p><dl class="variablelist"><dt><span class="term">_create</span></dt><dd><p>
      Add a new resource.
     </p><p>
      Create maps to HTTP PUT (or POST).
     </p></dd><dt><span class="term">_read</span></dt><dd><p>
      Retrieve a single resource.
     </p><p>
      Read maps to HTTP GET.
     </p></dd><dt><span class="term">_update</span></dt><dd><p>
      Replace an existing resource.
     </p><p>
      Update maps to HTTP PUT.
     </p></dd><dt><span class="term">_delete</span></dt><dd><p>
      Remove an existing resource.
     </p><p>
      Delete maps to HTTP DELETE.
     </p></dd><dt><span class="term">_patch</span></dt><dd><p>
      Modify part of an existing resource
     </p><p>
      Patch maps to HTTP PATCH.
     </p></dd><dt><span class="term">_action</span></dt><dd><p>
      Perform a predefined action.
     </p><p>
      Action maps to HTTP POST.
     </p><p>
      The generic _action verb extends what the API can do
      where none of the other standard CREST verbs fit,
      as in <code class="literal">_action=logout</code>.
     </p></dd><dt><span class="term">_query</span></dt><dd><p>
      Search a collection of resources.
     </p><p>
      Query maps to HTTP GET.
     </p></dd></dl></div><p>
   <acronym class="acronym">CRUDPAQ</acronym> is an acronym for the verbs.
   Notice that reserved words in CREST, such as the verbs,
   start with underscores (<code class="literal">_</code>).
  </p><p>
   In CREST, you can address resources in collections of resources
   by their unique identifiers, their IDs.
   IDs are exposed in the resource URIs
   as in <code class="literal">/users/<em class="replaceable"><code>id</code></em></code>
   and <code class="literal">/groups/<em class="replaceable"><code>id</code></em></code>.
   The ID is also in the "_id" field of the resource.
  </p><p>
   In CREST, resources are versioned using revision numbers.
   A revision is specified in the resource's "_rev" field.
   Revisions make it possible to figure out whether to apply changes
   without resource locking and without distributed transactions.
  </p><p>
   In CREST, you can explicitly request API versions.
   This means that OpenAM can continue to support older API versions
   as well as newer API versions as developers migrate their applications
   to take advantage of capabilities provided by newer APIs.
  </p><p>
   Interface Stability:
   <a href="../../admin-guide/index/appendix-interface-stability.html#interface-stability" class="link">Evolving</a>
  </p><p>
   OpenAM offers RESTful APIs for these access and identity management operations:
  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="chap-rest.html#rest-api-auth" title="3.4.&nbsp;Authentication &amp; Logout">Authentication</a> (login)</p></li><li class="listitem"><p><a class="link" href="chap-rest.html#rest-api-auth" title="3.4.&nbsp;Authentication &amp; Logout">Logout</a></p></li><li class="listitem"><p><a class="link" href="chap-rest.html#rest-api-cookie-info" title="3.6.&nbsp;Cookie Information">Cookie information</a></p></li><li class="listitem"><p><a class="link" href="chap-rest.html#rest-api-tokens" title="3.7.&nbsp;Token Validation and Session Information">Token attribute retrieval</a></p></li><li class="listitem"><p><a class="link" href="chap-rest.html#rest-api-tokens" title="3.7.&nbsp;Token Validation and Session Information">Token validation</a></p></li><li class="listitem"><p><a class="link" href="chap-rest.html#rest-api-logging" title="3.8.&nbsp;Logging">Logging</a></p></li><li class="listitem"><p>
     <a href="../../dev-guide/index/chap-rest-authz-policy.html" class="link">Authorization</a>
    </p></li><li class="listitem"><p>
     <a href="../../dev-guide/index/chap-rest-oauth2-oidc.html" class="link">OAuth 2.0 Authorization</a>
    </p></li><li class="listitem"><p><a href="../../dev-guide/index/chap-rest-oauth2-oidc.html" class="link">OpenID Connect 1.0</a></p></li><li class="listitem"><p>
     <a href="../../dev-guide/index/chap-rest-user-services.html" class="link">User Self-Registration</a></p></li><li class="listitem"><p><a href="../../dev-guide/index/chap-rest-user-services.html" class="link">Resetting Forgotten Passwords</a></p></li><li class="listitem"><p><a href="../../dev-guide/index/chap-rest-user-services.html" class="link">Dashboard Service</a></p></li><li class="listitem"><p>
     <a href="../../dev-guide/index/chap-rest-identity-realm-mgmt.html" class="link">Identity Management
      (creating, reading, updating, deleting identities)
     </a>
    </p></li><li class="listitem"><p><a href="../../dev-guide/index/chap-rest-identity-realm-mgmt.html" class="link">Realm Management
     (creating, reading, updating, deleting realms)
    </a></p></li><li class="listitem"><p><a href="../../dev-guide/index/chap-rest-sts.html" class="link">Secure Token Service (STS)
    </a></p></li></ul></div><p>This chapter also includes a section on <a class="link" href="chap-rest.html#rest-api-status-codes" title="3.9.&nbsp;REST Status Codes">REST Status Codes</a>.</p><p>In this chapter, long URLs are wrapped to fit the printed page, as some
  of the output is formatted for easier reading.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="rest-api-versioning"></a>3.2.&nbsp;REST API Versioning</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="chap-rest.html#rest-api-versioning-supported-versions">3.2.1. Supported REST API Versions</a></span></dt><dt><span class="section"><a href="chap-rest.html#rest-api-explicit-version">3.2.2. Specifying an Explicit REST API Version</a></span></dt><dt><span class="section"><a href="chap-rest.html#rest-api-versioning-messages">3.2.3. REST API Versioning Messages</a></span></dt></dl></div><p>
   In OpenAM 12.0.0 and later, REST API features are assigned version numbers.
  </p><p>Providing version numbers in the REST API helps ensure compatibility
   between OpenAM releases. The version number of a feature increases when OpenAM
   introduces a non-backwards-compatible change that affects clients making use
   of the feature.</p><div class="variablelist"><p>
   OpenAM provides versions for the following aspects of the REST API.
  </p><dl class="variablelist"><dt><span class="term"><span class="emphasis"><em>resource</em></span></span></dt><dd><p>
     Any changes to the structure or syntax of a returned response will incur
     a <span class="emphasis"><em>resource</em></span> version change. For example changing
     <code class="literal">"errorMessage"</code> to <code class="literal">"message"</code> in a
     JSON response.
    </p></dd><dt><span class="term"><span class="emphasis"><em>protocol</em></span></span></dt><dd><p>
     Any changes to the methods used to make REST API calls will incur
     a <span class="emphasis"><em>protocol</em></span> version change. For example changing <code class="literal">_action</code>
     to <code class="literal">$action</code> in the required parameters of an API feature.
    </p></dd></dl></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="rest-api-versioning-supported-versions"></a>3.2.1.&nbsp;Supported REST API Versions</h3></div></div></div><p>The REST API version numbers supported in OpenAM 12.0.0
    are as follows:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><span class="emphasis"><em>Supported protocol versions</em></span></span></dt><dd><p>The <span class="emphasis"><em>protocol</em></span> versions supported in OpenAM 12.0.0
      are:</p><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="literal">1.0</code></td></tr></table></dd><dt><span class="term"><span class="emphasis"><em>Supported resource versions</em></span></span></dt><dd><p>The <span class="emphasis"><em>resource</em></span> versions supported in OpenAM 12.0.0
      are shown in the following table.</p><div class="table"><a name="rest-api-supported-resource-versions"></a><div class="table-title">Table&nbsp;3.1.&nbsp;Supported <span class="emphasis"><em>resource</em></span> Versions</div><div class="table-contents"><table summary="Supported resource Versions" width="100%" border="0"><colgroup><col width="33%"><col width="33%"><col width="34%"></colgroup><thead><tr><th>Base</th><th>End Point</th><th>Supported Versions</th></tr></thead><tbody><tr><td>/json</td><td>/authenticate</td><td>1.1, 2.0</td></tr><tr><td> </td><td>/users</td><td>1.1, 2.0</td></tr><tr><td> </td><td>/groups</td><td>1.1, 2.0</td></tr><tr><td> </td><td>/agents</td><td>1.1, 2.0</td></tr><tr><td> </td><td>/realms</td><td>1.0</td></tr><tr><td> </td><td>/dashboard</td><td>1.0</td></tr><tr><td> </td><td>/sessions</td><td>1.1</td></tr><tr><td> </td><td>/serverinfo/*</td><td>1.1</td></tr><tr><td> </td><td>/users/<span class="emphasis"><em>{user-id}</em></span>/devices/trusted</td><td>1.0</td></tr><tr><td> </td><td>/applications</td><td>1.0</td></tr><tr><td> </td><td>/policies</td><td>1.0</td></tr><tr><td> </td><td>/applicationtypes</td><td>1.0</td></tr><tr><td> </td><td>/conditiontypes</td><td>1.0</td></tr><tr><td> </td><td>/subjecttypes</td><td>1.0</td></tr><tr><td> </td><td>/subjectattributes</td><td>1.0</td></tr><tr><td> </td><td>/decisioncombiners</td><td>1.0</td></tr><tr><td> </td><td>/subjectattributes</td><td>1.0</td></tr><tr><td>/xacml</td><td>/policies</td><td>1.0</td></tr><tr><td>/frrest</td><td>/token</td><td>1.0</td></tr><tr><td> </td><td>/client</td><td>1.0</td></tr></tbody></table></div></div><br class="table-break"></dd></dl></div><p>The <em class="citetitle">OpenAM Release Notes</em> section,
     <a href="../../release-notes/index/chap-compatibility.html" class="link"><em class="citetitle">OpenAM Changes &amp; Deprecated Functionality</em></a>
     describes the differences between API versions.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="rest-api-explicit-version"></a>3.2.2.&nbsp;Specifying an Explicit REST API Version</h3></div></div></div><p>You can specify which version of the REST API to use by adding an
    <code class="literal">Accept-API-Version</code> header to the request, as in the
    following example, which is requesting <span class="emphasis"><em>resource</em></span> version
    2.0 and <span class="emphasis"><em>protocol</em></span> version 1.0.</p><div class="screen"><pre>
$ <strong>curl \
 --request POST \
 --header "Content-Type: application/json" \
 --header "X-OpenAM-Username: demo" \
 --header "X-OpenAM-Password: changeit" \
 --header "Accept-API-Version: resource=2.0, protocol=1.0" \
 https://openam.example.com:8443/openam/json/authenticate</strong>
</pre></div><p>You can configure the default behavior OpenAM will take when a REST
    call does not specify explicit version information. For more
    information, see <a href="../../admin-guide/index/chap-rest.html" class="link"><em class="citetitle">Configuring REST APIs</em></a>
    in the <em class="citetitle">OpenAM Administration Guide</em>.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="rest-api-versioning-messages"></a>3.2.3.&nbsp;REST API Versioning Messages</h3></div></div></div><p>OpenAM provides REST API version messages in the JSON response to a
   REST API call. You can also configure OpenAM to return version messages
   in the response headers. See <a href="../../admin-guide/index/chap-rest.html" class="link"><em class="citetitle">Configuring REST APIs</em></a>
   in the <em class="citetitle">OpenAM Administration Guide</em></p><p>Messages include:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Details of the REST API versions used to service a
    REST API call.</p></li><li class="listitem"><p>Warning messages if REST API version information is not specified
    or is incorrect in a REST API call.</p></li></ul></div><p>The <code class="literal">resource</code> and <code class="literal">protocol</code> version
   used to service a REST API call are returned in the
   <code class="literal">Content-API-Version</code> header, as shown below.</p><div class="screen"><pre>
$ <strong>curl \
 -i \
 --request POST \
 --header "Content-Type: application/json" \
 --header "X-OpenAM-Username: demo" \
 --header "X-OpenAM-Password: changeit" \
 --header "Accept-API-Version: resource=2.0, protocol=1.0" \
 https://openam.example.com:8443/openam/json/authenticate</strong>

<em>HTTP/1.1 200 OK
Content-API-Version: protocol=1.0,resource=2.0
Server: Restlet-Framework/2.1.7
Content-Type: application/json;charset=UTF-8

{
 "tokenId":"AQIC5wM...TU3OQ*",
 "successUrl":"/openam/console"
}</em>
</pre></div><p>If the default REST API version behavior is set to <code class="literal">None</code>,
   and a REST API call does not include the <code class="literal">Accept-API-Version</code>
   header, or does not specify a <code class="literal">resource</code> version, then a
   <code class="literal">400 Bad Request</code> status code is returned,
   as shown below.</p><div class="screen"><pre>
$ <strong>curl \
 --header "Content-Type: application/json" \
 --header "Accept-API-Version: protocol=1.0" \
 https://openam.example.com:8443/openam/json/serverinfo/*</strong>

<em>{
 "code":400,
 "reason":"Bad Request",
 "message":"No requested version specified and behavior set to NONE."
}</em>
</pre></div><p>If a REST API call does include the <code class="literal">Accept-API-Version</code>
   header, but the specified <code class="literal">resource</code> or
   <code class="literal">protocol</code> version does not exist in OpenAM, then a
   <code class="literal">404 Not Found</code> status code is returned,
   as shown below.</p><div class="screen"><pre>
$ <strong>curl \
 --header "Content-Type: application/json" \
 --header "Accept-API-Version: protocol=1.0, resource=999.0" \
 https://openam.example.com:8443/openam/json/serverinfo/*</strong>

<em>{
 "code":404,
 "reason":"Not Found",
 "message":"Accept-API-Version: Requested version \"999.0\" does not match any routes."
}</em>
</pre></div><div class="tip"><h3 class="title">Tip</h3><p>For more information on setting the default REST API
   version behavior, see <a href="../../admin-guide/index/chap-rest.html" class="link"><em class="citetitle">Configuring REST APIs</em></a>
    in the <em class="citetitle">OpenAM Administration Guide</em>.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="c66-encoding"></a>3.3.&nbsp;Token Encoding</h2></div></div></div><p>Valid tokens in OpenAM requires configuration either in percent encoding or in <span class="emphasis"><em>C66Encode</em></span>
  format. C66Encode format is encouraged. It is the default token format for OpenAM, and is used in this chapter.
  The following is an example token that has not been encoded:</p><pre class="literallayout">AQIC5wM2LY4SfczntBbXvEAOuECbqMY3J4NW3byH6xwgkGE=@AAJTSQACMDE=#</pre><p>This token includes reserved characters such as <code class="literal">+</code>, <code class="literal">/</code>,
  and <code class="literal">=</code> (The <code class="literal">@</code>, <code class="literal">#</code>, and <code class="literal">*</code> are not
  reserved characters per se, but substitutions are still required). To c66encode this token,
  you would substitute certain characters for others, as follows:</p><table border="0" summary="Simple list" class="simplelist"><tr><td><span class="keycap"><strong>+</strong></span> is replaced with <span class="keycap"><strong>-</strong></span></td></tr><tr><td><span class="keycap"><strong>/</strong></span> is replaced with <span class="keycap"><strong>_</strong></span></td></tr><tr><td><span class="keycap"><strong>=</strong></span> is replaced with <span class="keycap"><strong>.</strong></span></td></tr><tr><td><span class="keycap"><strong>@</strong></span> is replaced with <span class="keycap"><strong>*</strong></span></td></tr><tr><td><span class="keycap"><strong>#</strong></span> is replaced with <span class="keycap"><strong>*</strong></span></td></tr><tr><td><span class="keycap"><strong>*</strong></span> (first instance) is replaced with <span class="keycap"><strong>@</strong></span></td></tr><tr><td><span class="keycap"><strong>*</strong></span> (subsequent instances) is replaced with <span class="keycap"><strong>#</strong></span></td></tr></table><p>In this case, the translated token would appear as shown here:</p><pre class="literallayout">AQIC5wM2LY4SfczntBbXvEAOuECbqMY3J4NW3byH6xwgkGE.*AAJTSQACMDE.*</pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="rest-api-auth"></a>3.4.&nbsp;Authentication &amp; Logout</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="chap-rest.html#rest-api-auth-json">3.4.1. REST APIs for Authentication &amp; Logout</a></span></dt><dt><span class="section"><a href="chap-rest.html#rest-api-auth-legacy">3.4.2. Authentication &amp; Logout (Legacy API)</a></span></dt></dl></div><a class="indexterm" name="d0e1013"></a><a class="indexterm" name="d0e1018"></a><p>OpenAM provides REST APIs for authentication and for logout.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Under <code class="literal">/json/authenticate</code> and
    <code class="literal">/json/sessions</code>, you find the newer JSON-based APIs.</p><p>See <a class="xref" href="chap-rest.html#rest-api-auth-json" title="3.4.1.&nbsp;REST APIs for Authentication &amp; Logout">Section&nbsp;3.4.1, &#8220;REST APIs for Authentication &amp; Logout&#8221;</a> below.</p></li><li class="listitem"><p>Under <code class="literal">/identity/authenticate</code> and
    <code class="literal">/identity/logout</code>, you find the backwards-compatible,
    legacy API.</p><p>See <a class="xref" href="chap-rest.html#rest-api-auth-legacy" title="3.4.2.&nbsp;Authentication &amp; Logout (Legacy API)">Section&nbsp;3.4.2, &#8220;Authentication &amp; Logout (Legacy API)&#8221;</a> below.</p></li></ul></div><div class="tip"><h3 class="title">Tip</h3><p>
    When authentication depends on the client IP address,
    and OpenAM lies behind a load balancer or proxy layer,
    configure the load balancer or proxy to send the address
    by using the <code class="literal">X-Forwarded-For</code> header,
    and configure OpenAM to consume and forward the header as necessary.
    For details, see the <em class="citetitle">Installation Guide</em> section,
    <a href="../../install-guide/index/chap-install-multiple.html#handle-request-headers" class="link"><em class="citetitle">Handling HTTP Request Headers</em></a>.
   </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="rest-api-auth-json"></a>3.4.1.&nbsp;REST APIs for Authentication &amp; Logout</h3></div></div></div><p>The simplest user name/password authentication returns a
   <code class="literal">tokenId</code> that applications can present as a cookie
   value for other operations that require authentication. In this case use
   HTTP POST to prevent the web container from logging the credentials.
   Pass the user name in an <code class="literal">X-OpenAM-Username</code> header, and
   the password in an <code class="literal">X-OpenAM-Password</code> header.</p><div class="screen"><pre>
$ <strong>curl \
 --request POST \
 --header "X-OpenAM-Username: demo" \
 --header "X-OpenAM-Password: changeit" \
 --header "Content-Type: application/json" \
 --data "{}" \
 https://openam.example.com:8443/openam/json/authenticate</strong>
<em>{ "tokenId": "AQIC5w...NTcy*", "successUrl": "/openam/console" }</em>
   </pre></div><p>This "zero page login" mechanism works only for name/password
   authentication. If you include a POST body with the request, it must
   be an empty JSON string as shown in the example. Alternatively, you can
   leave the POST body empty. Otherwise, OpenAM interprets the body as a
   continuation of an existing authentication attempt, one that uses a
   supported callback mechanism.</p><p>The authentication service at <code class="literal">/json/authenticate</code>
   supports callback mechanisms that make it possible to perform other types of
   authentication in addition to simple user name/password login.</p><p>Callbacks that are not completed based on the content of the client
   HTTP request are returned in JSON as a response to the request. Each
   callback has an array of output suitable for displaying to the end user,
   and input which is what the client must complete and send back to
   OpenAM. The default is still user name/password authentication.</p><div class="screen"><pre>
$ <strong>curl \
 --request POST \
 --header "Content-Type: application/json" \
 https://openam.example.com:8443/openam/json/authenticate</strong>
<em>
{
    "authId": "...jwt-value...",
    "template": "",
    "stage": "DataStore1",
    "callbacks": [
        {
            "type": "NameCallback",
            "output": [
                {
                    "name": "prompt",
                    "value": " User Name: "
                }
            ],
            "input": [
                {
                    "name": "IDToken1",
                    "value": ""
                }
            ]
        },
        {
            "type": "PasswordCallback",
            "output": [
                {
                    "name": "prompt",
                    "value": " Password: "
                }
            ],
            "input": [
                {
                    "name": "IDToken2",
                    "value": ""
                }
            ]
        }
    ]
}</em>
   </pre></div><p>The "authId" value is a JSON Web Token (JWT) that uniquely identifies
   the authentication context to OpenAM, and so must also be sent back with the
   requests.</p><p>To respond to the callback, send back the JSON object with the missing
   values filled, as in this case where the user name is <code class="literal">demo</code>
   and the password is <code class="literal">changeit</code>.</p><div class="informalexample"><div class="screen"><pre>
$ <strong>curl \
 --request POST \
 --header "Content-Type: application/json" \
 --data '{ "authId": "...jwt-value...", "template": "", "stage": "DataStore1",
   "callbacks": [ { "type": "NameCallback", "output": [ { "name": "prompt",
   "value": " User Name: " } ], "input": [ { "name": "IDToken1", "value": "demo" } ] },
   { "type": "PasswordCallback", "output": [ { "name": "prompt", "value": " Password: " } ],
   "input": [ { "name": "IDToken2", "value": "changeit" } ] } ] }' \
 https://openam.example.com:8443/openam/json/authenticate</strong>
<em>
{ "tokenId": "AQIC5wM2...U3MTE4NA..*", "successUrl": "/openam/console" }</em>
   </pre></div></div><p>The response is a token ID holding the SSO Token value.</p><p>Alternatively, you can authenticate without requesting a session
   using the <code class="literal">noSession</code> query string parameter.</p><div class="informalexample"><div class="screen"><pre>
$ <strong>curl \
 --request POST \
 --header "Content-Type: application/json" \
 --data '{ "authId": "...jwt-value...", "template": "", "stage": "DataStore1",
   "callbacks": [ { "type": "NameCallback", "output": [ { "name": "prompt",
   "value": " User Name: " } ], "input": [ { "name": "IDToken1", "value": "demo" } ] },
   { "type": "PasswordCallback", "output": [ { "name": "prompt", "value": " Password: " } ],
   "input": [ { "name": "IDToken2", "value": "changeit" } ] } ] }' \
 https://openam.example.com:8443/openam/json/authenticate?noSession=true</strong>
<em>
{ "message": "Authentication Successful", "successUrl": "/openam/console" }</em>
   </pre></div></div><p>OpenAM can be configured to return a failure URL value when
   authentication fails. No failure URL is configured by default. The Default
   Failure Login URL can be configured for the <a href="../../admin-guide/index/chap-auth-services.html#core-module-conf-hints" class="link">Core</a> authentication
   module. Alternatively, failure URLs can be configured per authentication
   chain, which your client can specify using the <code class="literal">service</code>
   parameter described below. On failure OpenAM then returns HTTP status
   code 401 Unauthorized, and the JSON in the reply indicates the failure
   URL.</p><div class="screen"><pre>
$ <strong>curl \
 --request POST \
 --header "Content-Type: application/json" \
 --header "X-OpenAM-Username: demo" \
 --header "X-OpenAM-Password: badpassword" \
 https://openam.example.com:8443/openam/json/authenticate</strong>
<em>{
  "code":401,
  "reason":"Unauthorized",
  "message":"Invalid Password!!",
  "failureUrl": "http://www.example.com/401.html"
}</em>
   </pre></div><p>To specify a realm in your request, first make sure that the name of your realm does not match
       an endpoint name to avoid any potential routing errors.
       Then, specify the realm in one of two ways. For example, if you have a realm
       titled "<code class="literal">myRealm</code>," you can use it in your request as follows:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Using the realm in the URI to the endpoint (preferred method):</p><pre class="literallayout">https://openam.example.com:8443/openam/json/<code class="literal">myRealm</code>/authenticate</pre></li><li class="listitem"><p>Using the realm query string parameter:</p><pre class="literallayout">https://openam.example.com:8443/openam/json/authenticate?realm=<code class="literal">myRealm</code></pre></li></ul></div><div class="variablelist"><p>You can use the <code class="literal">authIndexType</code> and
    <code class="literal">authIndexValue</code> query string parameters as a pair
    to provide additional information about how you are authenticating.
    The <code class="literal">authIndexType</code> can be one of the following
    types:</p><dl class="variablelist"><dt><span class="term">composite</span></dt><dd><p>Set the value to a composite advice string.</p></dd><dt><span class="term">level</span></dt><dd><p>Set the value to the authentication level.</p></dd><dt><span class="term">module</span></dt><dd><p>Set the value to the name of an authentication module.</p></dd><dt><span class="term">resource</span></dt><dd><p>Set the value to a URL protected by an OpenAM policy.</p></dd><dt><span class="term">role</span></dt><dd><p>Set the value to an OpenAM role.</p></dd><dt><span class="term">service</span></dt><dd><p>Set the value to the name of an authentication chain.</p></dd><dt><span class="term">user</span></dt><dd><p>Set the value to an OpenAM user ID.</p></dd></dl></div><p>
    You can use the query string parameter,
    <code class="literal">sessionUpgradeSSOTokenId=<em class="replaceable"><code>tokenId</code></em></code>,
    to request session upgrade.
    For an explanation of session upgrade,
    see the <em class="citetitle">Administration Guide</em> section on,
    <a href="../../admin-guide/index/chap-auth-services.html#session-upgrade" class="link"><em class="citetitle">Authentication Levels &amp; Session Upgrade</em></a>.
   </p><div class="itemizedlist"><p>OpenAM uses the following callback types depending on the
    authentication module in use.</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
      <code class="literal">ChoiceCallback</code>:
      Used to display a list of choices and retrieve the selected choice
     </p></li><li class="listitem"><p>
      <code class="literal">ConfirmationCallback</code>:
      Used to ask for a confirmation such as Yes, No, or Cancel and retrieve the selection
     </p></li><li class="listitem"><p>
      <code class="literal">HiddenValueCallback</code>:
      Used to return form values that are not visually rendered to the end user
     </p></li><li class="listitem"><p>
      <code class="literal">HttpCallback</code>:
      Used for HTTP handshake negotiations
     </p></li><li class="listitem"><p>
      <code class="literal">LanguageCallback</code>:
      Used to retrieve the locale for localizing text presented to the end user
     </p></li><li class="listitem"><p>
      <code class="literal">NameCallback</code>:
      Used to retrieve a name string
     </p></li><li class="listitem"><p>
      <code class="literal">PasswordCallback</code>:
      Used to retrieve a password value
     </p></li><li class="listitem"><p>
      <code class="literal">RedirectCallback</code>:
      Used to redirect the client user-agent
     </p></li><li class="listitem"><p>
      <code class="literal">ScriptTextOutputCallback</code>:
      Used to insert a script into the page presented to the end user.
      The script can, for example, collect data about the user's environment.
     </p></li><li class="listitem"><p>
      <code class="literal">TextInputCallback</code>:
      Used to retrieve text input from the end user
     </p></li><li class="listitem"><p>
      <code class="literal">TextOutputCallback</code>:
      Used to display a message to the end user
     </p></li><li class="listitem"><p>
      <code class="literal">X509CertificateCallback</code>:
      Used to retrieve the content of an x.509 certificate
     </p></li></ul></div><p>Authenticated users can log out with the token cookie value and an HTTP
   POST to <code class="literal">/json/sessions/?_action=logout</code>.</p><div class="screen"><pre>
$ <strong>curl \
 --request POST \
 --header "iplanetDirectoryPro: AQIC5wM2...U3MTE4NA..*" \
 --header "Content-Type: application/json" \
 "https://openam.example.com:8443/openam/json/sessions/?_action=logout"</strong>
<em>
{"result":"Successfully logged out"}</em>
   </pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="rest-api-auth-legacy"></a>3.4.2.&nbsp;Authentication &amp; Logout (Legacy API)</h3></div></div></div><p>Interface Stability: <a href="../../admin-guide/index/appendix-interface-stability.html#interface-stability" class="link">Deprecated</a></p><p>Simple authentication with a user name and password returns a
    token.</p><div class="screen"><pre>
$ <strong>curl \
 --request POST \
 --data "username=bjensen&amp;password=hifalutin" \
 https://openam.example.com:8443/openam/identity/authenticate</strong>
<em>
token.id=AQIC5wM2LY4SfcxvdvHOXjtC_eWSs2RB54tgvgK8SuYi7aQ.*AAJTSQACMDE.*</em>
    </pre></div><p>If you must specify parameters as when authenticating to
    <code class="literal">/UI/Login</code>, you provide a percent encoded string of the
    parameters as the value of the <code class="literal">uri</code> parameter. The
    <code class="literal">/UI/Login</code> parameter deals with the <code class="literal">realm</code>,
    <code class="literal">module</code>, and <code class="literal">service</code> parameters. Setting the
    <code class="literal">client</code> parameter sets the user's IP address as part of the
    token following successful authentication. The default for the <code class="literal">client</code>
    parameter is the IP of the machine making the REST request.</p><div class="screen"><pre>
$ <strong>curl \
 --request POST \
 --data "username=bjensen&amp;password=hifalutin&amp;uri=realm%3D%2F%26module%3DDataStore\
&amp;client=192.168.1.1" \
 https://openam.example.com:8443/openam/identity/authenticate</strong>
<em>
token.id=AQIC5wM2LY4SfcxvdvHOXjtC_eWSs2RB54tgvgK8SuYi7aQ.*AAJTSQACMDE.*</em>
    </pre></div><p>You log out using the token to end the user session.</p><div class="screen"><pre>
$ <strong>curl \
 --request POST \
 --data "subjectid=AQIC5w...*AAJTSQACMDE.*" \
 https://openam.example.com:8443/openam/identity/logout</strong>
    </pre></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="rest-api-serverinfo"></a>3.5.&nbsp;Server Information</h2></div></div></div><p>You can retrieve OpenAM server information by using HTTP GET on
   <code class="literal">/json/serverinfo/*</code>.</p><div class="screen"><pre>
$ <strong>curl https://openam.example.com:8443/openam/json/serverinfo/*</strong>
<em>{
    "domains": [
        ".example.com"
    ],
    "protectedUserAttributes": [],
    "cookieName": "iPlanetDirectoryPro",
    "forgotPassword": "false",
    "selfRegistration": "false",
    "lang": "en",
    "successfulUserRegistrationDestination": "default",
    "socialImplementations": [
        {
            "iconPath": "XUI/images/dashboard/facebook.png",
            "authnChain": "FacebookSocialAuthenticationService",
            "displayName": "Facebook",
            "valid": true
        }
    ],
    "referralsEnabled": "false",
    "zeroPageLogin": {
        "enabled": false,
        "refererWhitelist": [
            ""
        ],
        "allowedWithoutReferer": true
    },
    "FQDN": "openam.example.com"
}</em>
</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="rest-api-cookie-info"></a>3.6.&nbsp;Cookie Information</h2></div></div></div><p>You can retrieve the cookie domains that OpenAM supports by HTTP GET on
  <code class="literal">/json/serverinfo/cookieDomains</code>.</p><div class="screen"><pre>
$ <strong>curl https://openam.example.com:8443/openam/json/serverinfo/cookieDomains</strong>
<em>{"domains":[".example.com"]}</em>
  </pre></div><p>You can retrieve the name of the cookie used for storing the session
  token. By default it is <code class="literal">iPlanetDirectoryPro</code>.</p><div class="screen"><pre>
$ <strong>curl https://openam.example.com:8443/openam/identity/getCookieNameForToken</strong>
<em>string=iPlanetDirectoryPro</em>
  </pre></div><p>You can also retrieve the name of the cookie used for storing the session
  token and the names of the cookies to forward with requests.</p><div class="screen"><pre>
$ <strong>curl https://openam.example.com:8443/openam/identity/getCookieNamesToForward</strong>
<em>string=iPlanetDirectoryPro
string=amlbcookie</em>
  </pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="rest-api-tokens"></a>3.7.&nbsp;Token Validation and Session Information</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="chap-rest.html#rest-api-token-validation">3.7.1. Token Validation</a></span></dt><dt><span class="section"><a href="chap-rest.html#rest-api-session-information">3.7.2. Session Information</a></span></dt><dt><span class="section"><a href="chap-rest.html#rest-api-tokens-legacy">3.7.3. Token Validation, Attribute Retrieval (Legacy API)</a></span></dt></dl></div><a class="indexterm" name="d0e1448"></a><a class="indexterm" name="d0e1453"></a><p>
   OpenAM provides REST APIs for validating SSO tokens and getting information
   about active sessions.
  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
     Under <code class="literal">/json/sessions</code>
     you find the newer JSON-based API.
    </p><p>
     See <a class="xref" href="chap-rest.html#rest-api-token-validation" title="3.7.1.&nbsp;Token Validation">Section&nbsp;3.7.1, &#8220;Token Validation&#8221;</a>
     and <a class="xref" href="chap-rest.html#rest-api-session-information" title="3.7.2.&nbsp;Session Information">Section&nbsp;3.7.2, &#8220;Session Information&#8221;</a> below.
    </p></li><li class="listitem"><p>
     Under <code class="literal">/identity/isTokenValid</code>
     you find the backwards compatible, legacy APIs.
    </p><p>
     See <a class="xref" href="chap-rest.html#rest-api-tokens-legacy" title="3.7.3.&nbsp;Token Validation, Attribute Retrieval (Legacy API)">Section&nbsp;3.7.3, &#8220;Token Validation, Attribute Retrieval (Legacy API)&#8221;</a> below.
    </p></li></ul></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="rest-api-token-validation"></a>3.7.1.&nbsp;Token Validation</h3></div></div></div><p>
    To check over REST whether a token is valid,
    perform an HTTP POST
    to the resource URL,
    <code class="literal">/json/sessions/<em class="replaceable"><code>tokenId</code></em></code>,
    using the <code class="literal">validate</code> action
    as shown in the following example:
   </p><div class="screen"><pre>
$ <strong>curl \
 --request POST \
 --header "Content-Type: application/json" \
 http://openam.example.com:8080/openam/json/sessions/AQIC5...?_action=validate</strong>
<em>{"valid":true,"uid":"demo","realm":"/myRealm"}</em>
   </pre></div><p>
    An invalid token returns only information about the validity.
   </p><div class="screen"><pre>
$ <strong>curl \
 --request POST \
 --header "Content-Type: application/json" \
 http://openam.example.com:8080/openam/json/sessions/AQIC5...?_action=validate</strong>
<em>{"valid":false}</em>
   </pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="rest-api-session-information"></a>3.7.2.&nbsp;Session Information</h3></div></div></div><p>
    You can use REST API calls to:

    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
       Identify whether a session is active
      </p></li><li class="listitem"><p>
       Check the maximum remaining amount of time a session has left before
       the user is required to reauthenticate
      </p></li><li class="listitem"><p>
       Determine the length of time a session has been idle
      </p></li><li class="listitem"><p>
       Reset a session's idle time to 0
      </p></li></ul></div><p>
   </p><p>
    For these REST endpoints, specify two SSO tokens. Provide the SSO token for the
    current authenticated user as the value of a header whose name is the name
    of the SSO token cookie, by default <code class="literal">iPlanetDirectoryPro</code>.
    Specify the SSO token about which you want information as the
    <code class="literal">tokenId</code> query string parameter of the REST URL.
    In the examples in this section, <code class="literal">AQIC5w...NTcy*</code> is the SSO
    token for the current authenticated user, while <code class="literal">BXCCq...NX*1*</code>
    is the token being queried.
   </p><p>
    To determine whether a session is active,
    perform an HTTP POST to the resource URL,
    <code class="literal">/json/sessions/</code>,
    using the <code class="literal">isActive</code> action
    as shown in the following example:
   </p><div class="screen"><pre>
$ <strong>curl \
 --request POST \
 --header "Content-Type: application/json" \
 --header "iplanetDirectoryPro: AQIC5w...NTcy*" \
 http://openam.example.com:8080/openam/json/sessions/?_action=isActive&amp;tokenId=BXCCq...NX*1*
  </strong>
<em>{"active":true}</em>
</pre></div><p>
    To check the maximum remaining time (in seconds) of a session,
    perform an HTTP POST to the resource URL,
    <code class="literal">/json/sessions/</code>,
    using the <code class="literal">getMaxTime</code> action
    as shown in the following example:
   </p><div class="screen"><pre>
$ <strong>curl \
 --request POST \
 --header "Content-Type: application/json" \
 --header "iplanetDirectoryPro: AQIC5w...NTcy*" \
 http://openam.example.com:8080/openam/json/sessions/?_action=getMaxTime&amp;tokenId=BXCCq...NX*1*
  </strong>
<em>{"maxtime":7022}</em>
</pre></div><p>
    To check the amount of time (in seconds) that a session has been idle,
    perform an HTTP POST to the resource URL,
    <code class="literal">/json/sessions/</code>,
    using the <code class="literal">getIdle</code> action
    as shown in the following example:
   </p><div class="screen"><pre>
$ <strong>curl \
 --request POST \
 --header "Content-Type: application/json" \
 --header "iplanetDirectoryPro: AQIC5w...NTcy*" \
 http://openam.example.com:8080/openam/json/sessions/?_action=getIdle&amp;tokenId=BXCCq...NX*1*
  </strong>
<em>{"idletime":355}</em>
</pre></div><p>
    To reset a session's idle time,
    perform an HTTP POST to the resource URL,
    <code class="literal">/json/sessions/</code>,
    using the <code class="literal">isActive</code> action with the
    <code class="literal">refresh=true</code>
    option as shown in the following example:
   </p><div class="screen"><pre>
$ <strong>curl \
 --request POST \
 --header "Content-Type: application/json" \
 --header "iplanetDirectoryPro: AQIC5w...NTcy*" \
 http://openam.example.com:8080/openam/json/sessions/?_action=isActive&amp;refresh=true&amp;tokenId=BXCCq...NX*1*
  </strong>
<em>{"active":true}</em>
</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="rest-api-tokens-legacy"></a>3.7.3.&nbsp;Token Validation, Attribute Retrieval (Legacy API)</h3></div></div></div><p>Interface Stability: <a href="../../admin-guide/index/appendix-interface-stability.html#interface-stability" class="link">Deprecated</a></p><p>You check whether a token is valid as follows:</p><div class="screen"><pre>
$ <strong>curl \
 --request POST \
 --data "tokenid=AQIC5w...*AAJTSQACMDE.*" \
 https://openam.example.com:8443/openam/identity/isTokenValid</strong>
<em>boolean=true</em>
   </pre></div><p>An invalid token returns <code class="literal">boolean=false</code>.</p><div class="screen"><pre>
$ <strong>curl \
 --request POST \
 --data "tokenid=INVALID" \
 https://openam.example.com:8443/openam/identity/isTokenValid</strong>
<em>boolean=false</em>
   </pre></div><p>With a valid token, you can retrieve attributes about the subject.
    OpenAM returns a series of <em class="replaceable"><code>name</code></em>,
    <em class="replaceable"><code>value</code></em> pairs.</p><p>The newer API for retrieving user information is demonstrated in
    <a href="../../dev-guide/index/chap-rest-identity-realm-mgmt.html#rest-api-read-identity" class="link">
     <em class="citetitle">Reading Identities</em></a>. What follows describes the
    legacy API.</p><div class="screen"><pre>
$ <strong>curl \
 --request POST \
 --data "subjectid=AQIC5w...*AAJTSQACMDE.*" \
 https://openam.example.com:8443/openam/identity/attributes</strong>
<em>userdetails.token.id=
 AQIC5wM2LY4SfcxuxIP0VnP2lVjs7ypEM6VDx6srk56CN1Q.*AAJTSQACMDE.*
userdetails.attribute.name=uid
userdetails.attribute.value=bjensen
userdetails.attribute.name=mail
userdetails.attribute.value=bjensen@example.com
userdetails.attribute.name=sn
userdetails.attribute.value=Jensen
userdetails.attribute.name=userpassword
userdetails.attribute.value={SSHA}rhusOfYpkapDWEHcfT2Y7y83LMuC++F4Abqvig==
userdetails.attribute.name=cn
userdetails.attribute.value=Babs Jensen
userdetails.attribute.value=Barbara Jensen
userdetails.attribute.name=givenname
userdetails.attribute.value=Barbara
userdetails.attribute.name=dn
userdetails.attribute.value=uid=bjensen,ou=people,dc=example,dc=com
userdetails.attribute.name=telephonenumber
userdetails.attribute.value=+1 408 555 1862
userdetails.attribute.name=objectclass
userdetails.attribute.value=organizationalPerson
userdetails.attribute.value=person
userdetails.attribute.value=posixAccount
userdetails.attribute.value=inetOrgPerson
userdetails.attribute.value=krbprincipalaux
userdetails.attribute.value=krbTicketPolicyAux
userdetails.attribute.value=top</em>
   </pre></div><p>You can specify attributes to limit what you retrieve.</p><div class="screen"><pre>
$ <strong>curl "https://openam.example.com:8443/openam/identity/attributes?\
subjectid=AQIC5wM2LY4SfcxuxIP0VnP2lVjs7ypEM6VDx6srk56CN1Q.*AAJTSQACMDE.*\
&amp;attributenames=mail\
&amp;attributenames=uid"</strong>
<em>userdetails.token.id=
 AQIC5wM2LY4SfcxuxIP0VnP2lVjs7ypEM6VDx6srk56CN1Q.*AAJTSQACMDE.*
userdetails.attribute.name=uid
userdetails.attribute.value=bjensen
userdetails.attribute.name=mail
userdetails.attribute.value=bjensen@example.com</em>
   </pre></div><p>When retrieving attributes, you can refresh the session thus setting
    the idle time to 0, by adding the boolean parameter
    <code class="literal">refresh=true</code> to the query string.</p><div class="screen"><pre>
$ <strong>curl "https://openam.example.com:8443/openam/identity/attributes?\
subjectid=AQIC5wM2LY4SfcxuxIP0VnP2lVjs7ypEM6VDx6srk56CN1Q.*AAJTSQACMDE.*\
&amp;attributenames=cn\
&amp;refresh=true"</strong>
<em>userdetails.token.id=
 AQIC5wM2LY4SfcxuxIP0VnP2lVjs7ypEM6VDx6srk56CN1Q.*AAJTSQACMDE.*
userdetails.attribute.name=cn
userdetails.attribute.value=Babs Jensen
userdetails.attribute.value=Barbara Jensen</em>
   </pre></div><p>
    You can specify the following attributes to retrieve information
    about the user's session time limits and current session:
    <code class="literal">maxsessiontime</code> (maximum length of a session),
    <code class="literal">maxidletime</code> (maximum idle time allowed during a session),
    <code class="literal">idletime</code> (actual idle time during the current session),
    <code class="literal">timeleft</code> (actual time left in session).
    The unit for maximum times is minutes.
    The unit for actual times is seconds.
   </p><p>
    Also use the parameter <code class="literal">refresh=false</code>
    to avoid changing the <code class="literal">idletime</code> with your request.
   </p><div class="screen"><pre>
$ <strong>curl \
--data "subjectid=AQIC5w....*AAJTSQACMDE.*\
 &amp;attributenames=idletime\
 &amp;attributenames=maxidletime\
 &amp;attributenames=timeleft\
 &amp;attributenames=maxsessiontime\
 &amp;refresh=false" \
 https://openam.example.com:8443/openam/identity/attributes</strong>
<em>
userdetails.token.id=AQIC5w....*AAJTSQACMDE.*
userdetails.attribute.name=maxsessiontime
userdetails.attribute.value=120
userdetails.attribute.name=maxidletime
userdetails.attribute.value=30
userdetails.attribute.name=idletime
userdetails.attribute.value=664
userdetails.attribute.name=timeleft
userdetails.attribute.value=6319</em>
  </pre></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="rest-api-logging"></a>3.8.&nbsp;Logging</h2></div></div></div><p>
   OpenAM supports access and audit logging for any request going to
   a CREST endpoint and writes the data to two files:
  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="bold"><strong>amRest.access</strong></span>. Records accesses to a
     CREST endpoint, regardless of whether the request successfully reached the
     endpoint through policy authorization.
    </p><p>
     An <code class="literal">amRest.access</code> example is as follows:
    </p><div class="screen"><pre>
$ <strong>cat openam/openam/log/amRest.access</strong>

<em>#Version: 1.0
#Fields: time  Data  LoginID  ContextID  IPAddr  LogLevel  Domain  LoggedBy  MessageID  ModuleName
NameID  HostName
"2011-09-14 16:38:17"   /home/user/openam/openam/log/ "cn=dsameuser,ou=DSAME Users,o=openam"
aa307b2dcb721d4201 "Not Available" INFO  o=openam   "cn=dsameuser,ou=DSAME Users,o=openam"
LOG-1  amRest.access  "Not Available"  192.168.56.2
"2011-09-14 16:38:17"  "Hello World"  id=bjensen,ou=user,o=openam 8a4025a2b3af291d01  "Not Available"
INFO  o=openam id=amadmin,ou=user,o=openam "Not Available" amRest.access "Not Available"
192.168.56.2</em>
    </pre></div></li><li class="listitem"><p><span class="bold"><strong>amRest.authz</strong></span>. Records all CREST
     authorization results regardless of success. If a request has an entry in the
     <code class="literal">amRest.access</code> log, but no corresponding entry in
     <code class="literal">amRest.authz</code>, then that
     endpoint was not protected by an authorization filter and therefore the
     request was granted access to the resource.
    </p><p>
     The <code class="literal">amRest.authz</code> file has a key field, the
     <code class="literal">Data</code> field, which specifies the authorization decision,
     resource, and type of action performed on that resource.
     The <code class="literal">Data</code> field has the following syntax:
    </p><pre class="brush: plain;">
("GRANT"||"DENY") &gt; "RESOURCE | ACTION"

where
  "GRANT &gt; " is prepended to the entry if the request was allowed
  "DENY  &gt; " is prepended to the entry if the request was not allowed
  "RESOURCE" is "ResourceLocation | ResourceParameter"
     where
       "ResourceLocation" is the endpoint location (e.g., subrealm/applicationtypes)
       "ResourceParameter" is the ID of the resource being touched
        (e.g., myApplicationType) if applicable. Otherwise, this field is empty
        if touching the resource itself, such as in a query.

  "ACTION" is "ActionType | ActionParameter"
     where
       "ActionType" is "CREATE||READ||UPDATE||DELETE||PATCH||ACTION||QUERY"
       "ActionParameter" is one of the following depending on the ActionType:
          For CREATE: the new resource ID
          For READ: empty
          For UPDATE: the revision of the resource to update
          For DELETE: the revision of the resource to delete
          For PATCH: the revision of the resource to patch
          For ACTION: the actual action performed (e.g., "forgotPassword")
          For QUERY: the query ID if any
    </pre><div class="screen"><pre>
$ <strong>cat openam/openam/log/amRest.authz</strong>

<em>#Version: 1.0
#Fields: time   Data  ContextID  LoginID  IPAddr  LogLevel  Domain  MessageID  LoggedBy  NameID
ModuleName    HostName
"2014-09-16 14:17:28"   /var/root/openam/openam/log/   7d3af9e799b6393301
"cn=dsameuser,ou=DSAME Users,dc=openam,dc=forgerock,dc=org" "Not Available" INFO
dc=openam,dc=forgerock,dc=org  LOG-1  "cn=dsameuser,ou=DSAME Users,dc=openam,dc=forgerock,dc=org"
"Not Available" amRest.authz    10.0.1.5
"2014-09-16 15:56:12"  "GRANT &gt; sessions|ACTION|logout|AdminOnlyFilter"  d3977a55a2ee18c201
id=amadmin,ou=user,dc=openam,dc=forgerock,dc=org "Not Available" INFO  dc=openam,dc=forgerock,dc=org
OAuth2Provider-2  "cn=dsameuser,ou=DSAME Users,dc=openam,dc=forgerock,dc=org"  "Not Available"
amRest.authz    127.0.0.1
"2014-09-16 15:56:40"   "GRANT &gt; sessions|ACTION|logout|AdminOnlyFilter"  eedbc205bf51780001
id=amadmin,ou=user,dc=openam,dc=forgerock,dc=org  "Not Available" INFO dc=openam,dc=forgerock,dc=org
OAuth2Provider-2  "cn=dsameuser,ou=DSAME Users,dc=openam,dc=forgerock,dc=org"  "Not Available"
amRest.authz    127.0.0.1</em>
    </pre></div></li></ul></div><p>
   OpenAM also provides additional information in its debug notifications for
   accesses to any endpoint,
   depending on the message type (error, warning or message) including realm,
   user, and result of the operation.
  </p><p>
   You can also send OpenAM messages to log, specifying the message content
   and the log file in which to write your message.
   Logging takes a valid <code class="literal">appid</code> token for the subject
   with access to log the message, and also a <code class="literal">subjectid</code> token
   for the user whom the message concerns. If the tokens are valid and the
   access rights correct, your message ends up in the log specified.
  </p><div class="screen"><pre>
$ <strong>curl "https://openam.example.com:8443/openam/identity/log?\
appid=AQIC5wM2LY4SfcwyCZkk-1JXzx6q1EzgagabHfBjMidb5jI.*AAJTSQACMDE.*\
&amp;subjectid=AQIC5wM2LY4SfcxuxIP0VnP2lVjs7ypEM6VDx6srk56CN1Q.*AAJTSQACMDE.*\
&amp;logname=amRest.access\
&amp;message=Hello%20World"</strong>
  </pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="rest-api-status-codes"></a>3.9.&nbsp;REST Status Codes</h2></div></div></div><p>OpenAM REST APIs respond to successful requests with HTTP status codes
   in the 2xx range. OpenAM REST APIs respond to error conditions with HTTP
   status codes in the 4xx and 5xx range. Status codes used are described in
   the following list.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">200 OK</span></dt><dd><p>The request was successful and a resource returned, depending on the
      request. For example, a successful HTTP GET on
      <code class="literal">/users/myUser</code> returns a user profile and status code
      200, whereas a successful HTTP DELETE returns
      <code class="literal">{"success","true"}</code> and status code 200.</p></dd><dt><span class="term">201 Created</span></dt><dd><p>The request succeeded and the resource was created.</p></dd><dt><span class="term">400 Bad Request</span></dt><dd><p>The request was malformed. Either parameters required by the
       action were missing, or as in the following example incorrect data was
       sent in the payload for the action.</p><div class="screen"><pre>
$ <strong>curl \
 --request POST \
 --header "Content-Type: application/json" \
 --data '{"bad":"data"}' \
 https://openam.example.com:8443/openam/json/users?_action=forgotPassword
</strong>
<em>{
 "code":400,
 "reason":"Bad Request",
 "message":"Username or email not provided in request"
}</em>
</pre></div></dd><dt><span class="term">401 Unauthorized</span></dt><dd><p>The request requires user authentication as in the following
      example, which is missing an SSO Token value.</p><div class="screen"><pre>
$ <strong>curl \
 --request POST \
 https://openam.example.com:8443/openam/json/sessions?_action=logout
</strong>
<em>{
 "code": 401,
 "reason": "Unauthorized",
 "message": "Access denied"
}</em>
</pre></div></dd><dt><span class="term">403 Forbidden</span></dt><dd><p>Access was forbidden during an operation on a resource as in the
      following example, which has a regular user trying to read the OpenAM
      administrator profile.</p><div class="screen"><pre>
$ <strong>curl \
 --request POST \
 --header "X-OpenAM-Username: demo" \
 --header "X-OpenAM-Password: changeit" \
 https://openam.example.com:8443/openam/json/authenticate
</strong>
<em>{ "tokenId": "AQIC5w...YyMA..*" }</em>

$ <strong>curl \
 --header "iplanetDirectoryPro: AQIC5w...YyMA..*" \
 https://openam.example.com:8443/openam/json/users/amadmin
</strong>
<em>{
 "code": 403,
 "reason": "Forbidden",
 "message": "Permission to perform the read operation denied to
             id=demo,ou=user,dc=openam,dc=forgerock,dc=org"
}</em>
</pre></div></dd><dt><span class="term">404 Not Found</span></dt><dd><p>The specified resource could not be found as in the following
      example, which is attempting to read a nonexistent user's profile.</p><div class="screen"><pre>
$ <strong>curl \
 --header "iplanetDirectoryPro: AQIC5w...NTcy*" \
 https://openam.example.com:8443/openam/json/users/missing
</strong>
<em>{
 "code":404,
 "reason":"Not Found",
 "message":"Resource cannot be found."
}</em>
</pre></div></dd><dt><span class="term">405 Method Not Allowed</span></dt><dd><p>The HTTP method is not allowed for the requested resource.</p></dd><dt><span class="term">406 Not Acceptable</span></dt><dd><p>The request contains parameters that are not acceptable as in
     the following example, which specifies an API version parameter that
     is not supported by OpenAM.</p><div class="screen"><pre>
$ <strong>curl \
 --request POST \
 --header "Content-Type: application/json" \
 --header "X-OpenAM-Username: demo" \
 --header "X-OpenAM-Password: changeit" \
 --header "Accept-API-Version: protocol=1.0, resource=999.0" \
 https://openam.example.com:8443/openam/json/authenticate</strong>

<em>{
 "code":406,
 "reason":"Not Acceptable",
 "message":"Accept-API-Version: Requested version \"999.0\" does not match any routes."
}</em>
</pre></div></dd><dt><span class="term">409 Conflict</span></dt><dd><p>The request would have resulted in a conflict with the current
      state of the resource. For example using the Forgot Password feature
       and specifying the user's email address as in the following
       example, where multiple users have the same email address.</p><div class="screen"><pre>
$ <strong>curl \
 --request POST \
 --header "Content-Type: application/json" \
 --data '{"email":"demo@example.com"}' \
 https://openam.example.com:8443/openam/json/users?_action=forgotPassword
</strong>
<em>{
 "code":409,
 "reason":"Conflict",
 "message":"Multiple users found"
}</em>
</pre></div></dd><dt><span class="term">410 Gone</span></dt><dd><p>The requested resource is no longer available, and will not
       become available again. The URI returned for resetting a password may
       have expired as in the following example:</p><div class="screen"><pre>
$ <strong>curl \
 --request POST \
 --header "Content-Type: application/json" \
 --data '{"username": "demo"}' \
 https://openam.example.com:8443/openam/json/users/?_action=forgotPassword
</strong>
<em>{
 "code":410,
 "reason":"Gone",
 "message":"Token not found"
}</em>
</pre></div></dd><dt><span class="term">415 Unsupported Media Type</span></dt><dd><p>The request is in a format not supported by the requested resource
      for the requested method as in the following example, which is attempting
      to pass basic authentication credentials as form-encoded data rather than
      query string parameters.</p><div class="screen"><pre>
$ <strong>curl \
 --request POST \
 --data "username=demo&amp;password=changeit" \
 https://openam.example.com:8443/openam/json/authenticate
</strong>
<em>...
HTTP Status 415
...
The server refused this request because the request entity is in a
format not supported by the requested resource for the requested method
...</em>
</pre></div></dd><dt><span class="term">500 Internal Server Error</span></dt><dd><p>The server encountered an unexpected condition which prevented it
      from fulfilling the request. This could be caused by an invalid
       configuration in the Email Service, or as in the following example the
       specified user account not  having an associated email address to send
       the Forgot Password URI to.</p><div class="screen"><pre>
$ <strong>curl \
 --request POST \
 --header "Content-Type: application/json" \
 --data '{"username": "demo"}' \
 https://openam.example.com:8443/openam/json/users/?_action=forgotPassword
</strong>
<em>{
 "code":500,
 "reason":"Internal Server Error",
 "message":"No email provided in profile."
}</em>
</pre></div></dd><dt><span class="term">501 Not Implemented</span></dt><dd><p>The resource does not support the functionality required to fulfill
      the request as in the following example, which is attempting to delete
      an entry as a delete action instead of using an HTTP DELETE request.</p><div class="screen"><pre>
$ <strong>curl \
 --request POST \
 --header "iplanetDirectoryPro: AQIC5w...NTcy*" \
 https://openam.example.com:8443/openam/json/users/demo?_action=delete
</strong>
<em>{
 "code": 501,
 "reason": "Not Implemented",
 "message": "Actions are not supported for resource instances"
}</em>
</pre></div></dd><dt><span class="term">503 Service Unavailable</span></dt><dd><p>The requested resource was temporarily unavailable. The
       service may have been disabled, as in the following example,
       where the Forgot Password functionality has been disabled.</p><div class="screen"><pre>
$ <strong>curl \
 --request POST \
 --header "Content-Type: application/json" \
 --data '{"username": "demo"}' \
 https://openam.example.com:8443/openam/json/users/?_action=forgotPassword
</strong>
<em>{
 "code":503,
 "reason":"Service Unavailable",
 "message":"Forgot password is not accessible."
}</em>
</pre></div></dd></dl></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="chap-client-dev.html">Prev</a>&nbsp;</td><td width="20%" align="center">&nbsp;</td><td width="40%" align="right">&nbsp;<a accesskey="n" href="chap-rest-authz-policy.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter&nbsp;2.&nbsp;Developing Client Applications&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;4.&nbsp;RESTful Authorization and Policy Management Services</td></tr></table></div><p>&nbsp;</p><div id="footer"><p>Something wrong on this page? <a href="https://bugster.forgerock.org/jira/secure/CreateIssueDetails!init.jspa?pid=10000&components=10007&issuetype=1">Log a documentation bug.</a></p></div>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-23412190-14']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</body></html>