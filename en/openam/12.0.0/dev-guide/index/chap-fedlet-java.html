<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head>

      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
   <title>Chapter&nbsp;14.&nbsp;Using Fedlets in Java Web Applications</title><link rel="stylesheet" type="text/css" href="coredoc.css"><link rel="stylesheet" type="text/css" href="css/coredoc.css"><link rel="stylesheet" type="text/css" href="sh/shCore.css"><link rel="stylesheet" type="text/css" href="sh/shCoreEclipse.css"><link rel="stylesheet" type="text/css" href="sh/shThemeEclipse.css"><script src="http://code.jquery.com/jquery-1.11.0.min.js" type="text/javascript"></script><script src="uses-jquery.js" type="text/javascript"></script><script src="sh/shCore.js" type="text/javascript"></script><script src="sh/shBrushAci.js" type="text/javascript"></script><script src="sh/shBrushBash.js" type="text/javascript"></script><script src="sh/shBrushCsv.js" type="text/javascript"></script><script src="sh/shBrushHttp.js" type="text/javascript"></script><script src="sh/shBrushJava.js" type="text/javascript"></script><script src="sh/shBrushJScript.js" type="text/javascript"></script><script src="sh/shBrushLDIF.js" type="text/javascript"></script><script src="sh/shBrushPlain.js" type="text/javascript"></script><script src="sh/shBrushProperties.js" type="text/javascript"></script><script src="sh/shBrushXml.js" type="text/javascript"></script><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="OpenAM Developer's Guide"><link rel="up" href="index.html" title="OpenAM Developer's Guide"><link rel="prev" href="chap-xacml.html" title="Chapter&nbsp;13.&nbsp;Requesting a XACML Policy Decision Using OpenAM Java SDK"><link rel="next" href="chap-fedlet-dotnet.html" title="Chapter&nbsp;15.&nbsp;Using Fedlets in .NET Applications"><link rel="copyright" href="legalnotice.html" title="Legal Notice"><script type="text/javascript">SyntaxHighlighter.all();</script>
<link rel="shortcut icon" href="http://forgerock.org/favicon.ico">
</head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter&nbsp;14.&nbsp;Using Fedlets in Java Web Applications</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="chap-xacml.html">Prev</a>&nbsp;</td><th width="60%" align="center">&nbsp;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="chap-fedlet-dotnet.html">Next</a></td></tr></table><hr></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-fedlet-java"></a>Chapter&nbsp;14.&nbsp;Using Fedlets in Java Web Applications</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="section"><a href="chap-fedlet-java.html#create-install-java-fedlet">14.1. Creating &amp; Installing a Java Fedlet</a></span></dt><dt><span class="section"><a href="chap-fedlet-java.html#fedlet-signing-encryption">14.2. Signing &amp; Encryption For a Fedlet</a></span></dt><dt><span class="section"><a href="chap-fedlet-java.html#customize-java-fedlet">14.3. Customizing a Java Fedlet</a></span></dt></dl></div><a class="indexterm" name="d0e8913"></a><p>This chapter introduces OpenAM Fedlets, and shows how to use the Fedlet
 as part of your Java web application.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="create-install-java-fedlet"></a>14.1.&nbsp;Creating &amp; Installing a Java Fedlet</h2></div></div></div><p>An OpenAM <em class="firstterm">Fedlet</em> is a small web application that
  can do federation in your service provider application with OpenAM acting as
  the identity provider. The Fedlet does not require an entire OpenAM
  installation alongside your application, but instead can redirect to OpenAM
  for single sign on, and to retrieve SAML assertions.</p><p>The process for creating and installing a Java Fedlet is divided into several procedures.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="chap-fedlet-java.html#create-a-java-fedlet" title="Procedure&nbsp;14.1.&nbsp;To Create a Fedlet">Procedure&nbsp;14.1, &#8220;To Create a Fedlet&#8221;</a></p></li><li class="listitem"><p><a class="xref" href="chap-fedlet-java.html#install-fedlet-as-demo" title="Procedure&nbsp;14.2.&nbsp;To Install the Fedlet as a Demo Application">Procedure&nbsp;14.2, &#8220;To Install the Fedlet as a Demo Application&#8221;</a></p></li><li class="listitem"><p><a class="xref" href="chap-fedlet-java.html#try-fedlet-attribute-query" title="Procedure&nbsp;14.3.&nbsp;To Try the Fedlet Attribute Query">Procedure&nbsp;14.3, &#8220;To Try the Fedlet Attribute Query&#8221;</a></p></li><li class="listitem"><p><a class="xref" href="chap-fedlet-java.html#try-fedlet-xacml-query" title="Procedure&nbsp;14.4.&nbsp;To Try the Fedlet XACML Query">Procedure&nbsp;14.4, &#8220;To Try the Fedlet XACML Query&#8221;</a></p></li></ul></div><div class="procedure"><a name="create-a-java-fedlet"></a><div class="procedure-title">Procedure&nbsp;14.1.&nbsp;To Create a Fedlet</div><p>The OpenAM administrator running the identity provider server creates
   a <code class="filename">Fedlet.zip</code> file for your service provider application,
   and then sends you the .zip.</p><ol class="procedure" type="1"><li class="step"><p>Before creating the Fedlet, create a Hosted Identity Provider if
    you have not already done so, using the test certificate for the signing
    key.</p><p>The single sign-on and single logout features that the Java Fedlet
    demonstrates do work with the Hosted Identity Provider you create starting
    from the Common Tasks page. The Java Fedlet Attribute Query and XACML Query
    tests require additional configuration, however.</p><p>See <a class="xref" href="chap-fedlet-java.html#try-fedlet-attribute-query" title="Procedure&nbsp;14.3.&nbsp;To Try the Fedlet Attribute Query">Procedure&nbsp;14.3, &#8220;To Try the Fedlet Attribute Query&#8221;</a> and
    <a class="xref" href="chap-fedlet-java.html#try-fedlet-xacml-query" title="Procedure&nbsp;14.4.&nbsp;To Try the Fedlet XACML Query">Procedure&nbsp;14.4, &#8220;To Try the Fedlet XACML Query&#8221;</a> for details.</p></li><li class="step"><p>On the Common Tasks page of the OpenAM console, click Create
    Fedlet.</p></li><li class="step"><p>Note that the Circle of Trust includes your hosted identity provider,
    and that Identity Provider is set to your to hosted identity
    provider.</p></li><li class="step"><p>Name the Fedlet, and also set the Destination URL.</p><p>You can use the deployment URL, such as
    <code class="literal">http://openam.example.com:8080/fedlet</code> as both the name and
    the destination URL.</p></li><li class="step"><p>Click create to generate the Fedlet.zip file, such as
    <code class="filename">$HOME/openam/myfedlets/httpopenamexamplecom8080fedlet/Fedlet.zip</code>.</p></li><li class="step"><p>Provide the Fedlet to the service provider, or install it yourself to
    demonstrate the Fedlet's features.</p></li></ol></div><div class="procedure"><a name="install-fedlet-as-demo"></a><div class="procedure-title">Procedure&nbsp;14.2.&nbsp;To Install the Fedlet as a Demo Application</div><p><code class="filename">Fedlet.zip</code> includes the
   <code class="filename">fedlet.war</code> archive corresponding to the identity
   provider, and a <code class="filename">README</code> file.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The <code class="filename">fedlet.war</code> archive contains both the Fedlet
     as a demo web application, and also the files you use to include the Fedlet
     in your service provider application.</p></li><li class="listitem"><p>The README file describes how to use the Fedlet.</p></li></ul></div><p>Perform the following steps to try single sign-on and single logout
   tests. For the attribute query and XACML query tests, additional configuration
   is required.</p><ol class="procedure" type="1"><li class="step"><p>Deploy the Fedlet in your web container.</p><div class="screen"><pre>
$ <strong>unzip Fedlet.zip</strong>
$ <strong>mv fedlet.war /path/to/tomcat/webapps</strong>
    </pre></div></li><li class="step"><p>Browse to the Fedlet URL, and then click the links to set up the
    configuration directory in <code class="filename">$HOME/fedlet</code>, where $HOME
    corresponds to the user running the web application container.</p></li><li class="step"><p>Try one or more examples from the Fedlet home page to validate Fedlet
    setup.</p><div class="mediaobject" align="center"><a name="figure-fedlet-demo"></a><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/fedlet-demo.png" align="middle" height="360" alt="Home page for demo Fedlet"></td></tr></table><div class="longdesc-link" align="right"><br clear="all"><span class="longdesc-link">[<a href="figure-fedlet-demo.html" target="longdesc">D</a>]</span></div></div><p>After setting up OpenAM with the default subjects, you can login on
    the identity provider with user name <code class="literal">demo</code> and password
    <code class="literal">changeit</code>.</p></li></ol></div><div class="procedure"><a name="try-fedlet-attribute-query"></a><div class="procedure-title">Procedure&nbsp;14.3.&nbsp;To Try the Fedlet Attribute Query</div><p>To try the Fedlet Attribute Query test, the Identity Provider
   must be configured with the Attribute Authority (<code class="literal">AttrAuth</code>)
   type and should sign responses. The Fedlet must be configured to deal with
   signed responses. Furthermore, map the attributes to request in both the
   Identity Provider and the Fedlet configurations.</p><ol class="procedure" type="1"><li class="step"><p>Add the Attribute Authority type to the hosted Identity Provider.</p><ol type="a" class="substeps"><li class="step"><p>On OpenAM where the Identity Provider is hosted, log in to OpenAM
      console as <code class="literal">amadmin</code>.</p></li><li class="step"><p>Under Federation &gt; Entity Providers, select the Identity Provider,
      and then click New..., even though you plan to change the configuration
      rather than create a new provider.</p></li><li class="step"><p>Select the protocol of the provider: SAMLv2.</p></li><li class="step"><p>In the Create SAMLv2 Entity Provider page, do the following.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Set the Realm.</p></li><li class="listitem"><p>Set the Entity Identifier to the same entity identifier you
        selected in the previous screen.</p></li><li class="listitem"><p>In the Attribute Authority section, set the Meta Alias for example
        to <code class="literal">/attra</code>, and set the Signing certificate alias and
        Encryption certificate alias values to <code class="literal">test</code> (to use
        the test certificate).</p></li><li class="listitem"><p>Click Create to save your changes.</p><p>Disregard any error messages stating that the entity already
        exists.</p></li></ul></div><p><code class="literal">AttrAuth</code> now appears in the list of Types for
      your Identity Provider.</p></li></ol></li><li class="step"><p>Under Federation &gt; Entity Providers, click the Identity Provider
    link to open the provider's configuration.</p></li><li class="step"><p>Make sure attributes for the query are mapped on the Identity
    Provider.</p><p>Under IDP &gt; Attribute Mapper, add the following values to the
    Attribute Map if they are not yet present.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">cn=cn</code></p></li><li class="listitem"><p><code class="literal">sn=sn</code></p></li><li class="listitem"><p><code class="literal">uid=uid</code></p></li></ul></div><div class="note"><h3 class="title">Note</h3><p>Make sure to use thread-safe code if you implement the AttributeAuthorityMapper.
     You can use the attributes on the HttpRequest instead of synchronizing them. The 
     default AttributeAuthorityMapper uses an attribute on the HttpServletRequest to
     pass information to the AttributeQueryUtil.</p></div><p>Click Save to save your changes.</p></li><li class="step"><p>Create the Fedlet as described in <a class="xref" href="chap-fedlet-java.html#create-a-java-fedlet" title="Procedure&nbsp;14.1.&nbsp;To Create a Fedlet">Procedure&nbsp;14.1, &#8220;To Create a Fedlet&#8221;</a>,
    making sure you map the attributes.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">cn=cn</code></p></li><li class="listitem"><p><code class="literal">sn=sn</code></p></li><li class="listitem"><p><code class="literal">uid=uid</code></p></li></ul></div><p>This step creates a Fedlet with updated Identity Provider metadata.
    If you already created a Fedlet, either use a different name, or delete
    the existing Fedlet.</p></li><li class="step"><p>Deploy the new Fedlet .war as described in <a class="xref" href="chap-fedlet-java.html#install-fedlet-as-demo" title="Procedure&nbsp;14.2.&nbsp;To Install the Fedlet as a Demo Application">Procedure&nbsp;14.2, &#8220;To Install the Fedlet as a Demo Application&#8221;</a>.</p></li><li class="step"><p>Edit the new Fedlet configuration to request signing and encryption,
    and replace the existing configuration in OpenAM with the edited
    configuration.</p><ol type="a" class="substeps"><li class="step"><p>Copy the test key store from OpenAM, and prepare password files.</p><div class="screen"><pre>
$ <strong>scp user@openam:/home/user/openam/openam/keystore.jks ~/fedlet/</strong>
      </pre></div><p>The Fedlet uses password files when accessing the keystore. These
      password files contain encoded passwords, where the encoding is specific
      to the Fedlet.</p><p>To encode the password, use <code class="literal">fedletEncode.jsp</code>.
      <code class="literal">fedletEncode.jsp</code> is in the deployed Fedlet, for example
      <code class="literal">http://openam.example.com:8080/fedlet/fedletEncode.jsp</code>.
      The only password to encode for OpenAM's test keystore is
      <code class="literal">changeit</code>, because the key store and private key
      passwords are both the same.</p><p>Use the encoded value to create the password files as in the
      following example.</p><div class="screen"><pre>
$ <strong>echo AQIC5BHNSjLwT303GqndmHbyYvzP9Tz7OAnK &gt; ~/fedlet/.storepass</strong>
$ <strong>echo AQIC5BHNSjLwT303GqndmHbyYvzP9Tz7OAnK &gt; ~/fedlet/.keypass</strong>
      </pre></div></li><li class="step"><p>Edit <code class="filename">~/fedlet/sp.xml</code> to use the test
      certificate for the attribute query.</p><p>Change the following:</p><pre class="brush: xml;">&lt;RoleDescriptor xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:query="urn:oasis:names:tc:SAML:metadata:ext:query"
    xsi:type="query:AttributeQueryDescriptorType"
    protocolSupportEnumeration="urn:oasis:names:tc:SAML:2.0:protocol"&gt;
 &lt;/RoleDescriptor&gt;</pre><p>To:</p><pre class="brush: xml;"> &lt;RoleDescriptor xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:query="urn:oasis:names:tc:SAML:metadata:ext:query"
    xsi:type="query:AttributeQueryDescriptorType"
    protocolSupportEnumeration="urn:oasis:names:tc:SAML:2.0:protocol"&gt;
  &lt;KeyDescriptor use="signing"&gt;
   &lt;ds:KeyInfo xmlns:ds="http://www.w3.org/2000/09/xmldsig#"&gt;
    &lt;ds:X509Data&gt;
     &lt;ds:X509Certificate&gt;
MIICQDCCAakCBEeNB0swDQYJKoZIhvcNAQEEBQAwZzELMAkGA1UEBhMCVVMxEzARBgNVBAgTCkNh
bGlmb3JuaWExFDASBgNVBAcTC1NhbnRhIENsYXJhMQwwCgYDVQQKEwNTdW4xEDAOBgNVBAsTB09w
ZW5TU08xDTALBgNVBAMTBHRlc3QwHhcNMDgwMTE1MTkxOTM5WhcNMTgwMTEyMTkxOTM5WjBnMQsw
CQYDVQQGEwJVUzETMBEGA1UECBMKQ2FsaWZvcm5pYTEUMBIGA1UEBxMLU2FudGEgQ2xhcmExDDAK
BgNVBAoTA1N1bjEQMA4GA1UECxMHT3BlblNTTzENMAsGA1UEAxMEdGVzdDCBnzANBgkqhkiG9w0B
AQEFAAOBjQAwgYkCgYEArSQc/U75GB2AtKhbGS5piiLkmJzqEsp64rDxbMJ+xDrye0EN/q1U5Of+
RkDsaN/igkAvV1cuXEgTL6RlafFPcUX7QxDhZBhsYF9pbwtMzi4A4su9hnxIhURebGEmxKW9qJNY
Js0Vo5+IgjxuEWnjnnVgHTs1+mq5QYTA7E6ZyL8CAwEAATANBgkqhkiG9w0BAQQFAAOBgQB3Pw/U
QzPKTPTYi9upbFXlrAKMwtFf2OW4yvGWWvlcwcNSZJmTJ8ARvVYOMEVNbsT4OFcfu2/PeYoAdiDA
cGy/F2Zuj8XJJpuQRSE6PtQqBuDEHjjmOQJ0rV/r8mO1ZCtHRhpZ5zYRjhRC9eCbjx9VrFax0JDC
/FfwWigmrW0Y0Q==
     &lt;/ds:X509Certificate&gt;
    &lt;/ds:X509Data&gt;
   &lt;/ds:KeyInfo&gt;
  &lt;/KeyDescriptor&gt;
  &lt;KeyDescriptor use="encryption"&gt;
   &lt;ds:KeyInfo xmlns:ds="http://www.w3.org/2000/09/xmldsig#"&gt;
    &lt;ds:X509Data&gt;
     &lt;ds:X509Certificate&gt;
MIICQDCCAakCBEeNB0swDQYJKoZIhvcNAQEEBQAwZzELMAkGA1UEBhMCVVMxEzARBgNVBAgTCkNh
bGlmb3JuaWExFDASBgNVBAcTC1NhbnRhIENsYXJhMQwwCgYDVQQKEwNTdW4xEDAOBgNVBAsTB09w
ZW5TU08xDTALBgNVBAMTBHRlc3QwHhcNMDgwMTE1MTkxOTM5WhcNMTgwMTEyMTkxOTM5WjBnMQsw
CQYDVQQGEwJVUzETMBEGA1UECBMKQ2FsaWZvcm5pYTEUMBIGA1UEBxMLU2FudGEgQ2xhcmExDDAK
BgNVBAoTA1N1bjEQMA4GA1UECxMHT3BlblNTTzENMAsGA1UEAxMEdGVzdDCBnzANBgkqhkiG9w0B
AQEFAAOBjQAwgYkCgYEArSQc/U75GB2AtKhbGS5piiLkmJzqEsp64rDxbMJ+xDrye0EN/q1U5Of+
RkDsaN/igkAvV1cuXEgTL6RlafFPcUX7QxDhZBhsYF9pbwtMzi4A4su9hnxIhURebGEmxKW9qJNY
Js0Vo5+IgjxuEWnjnnVgHTs1+mq5QYTA7E6ZyL8CAwEAATANBgkqhkiG9w0BAQQFAAOBgQB3Pw/U
QzPKTPTYi9upbFXlrAKMwtFf2OW4yvGWWvlcwcNSZJmTJ8ARvVYOMEVNbsT4OFcfu2/PeYoAdiDA
cGy/F2Zuj8XJJpuQRSE6PtQqBuDEHjjmOQJ0rV/r8mO1ZCtHRhpZ5zYRjhRC9eCbjx9VrFax0JDC
/FfwWigmrW0Y0Q==
     &lt;/ds:X509Certificate&gt;
    &lt;/ds:X509Data&gt;
   &lt;/ds:KeyInfo&gt;
   &lt;EncryptionMethod Algorithm="http://www.w3.org/2001/04/xmlenc#aes128-cbc"&gt;
    &lt;xenc:KeySize xmlns:xenc="http://www.w3.org/2001/04/xmlenc#"
      &gt;128&lt;/xenc:KeySize&gt;
   &lt;/EncryptionMethod&gt;
  &lt;/KeyDescriptor&gt;
 &lt;/RoleDescriptor&gt;</pre></li><li class="step"><p>Edit <code class="filename">~/fedlet/sp-extended.xml</code> to use the test
      certificate for the attribute query.</p><p>Change the following, assuming your Circle of Trust is called
      <code class="literal">cot</code>:</p><pre class="brush: xml;">&lt;AttributeQueryConfig metaAlias="/attrQuery"&gt;
    &lt;Attribute name="signingCertAlias"&gt;
        &lt;Value&gt;&lt;/Value&gt;
    &lt;/Attribute&gt;
    &lt;Attribute name="encryptionCertAlias"&gt;
        &lt;Value&gt;&lt;/Value&gt;
    &lt;/Attribute&gt;
    &lt;Attribute name="wantNameIDEncrypted"&gt;
        &lt;Value&gt;&lt;/Value&gt;
    &lt;/Attribute&gt;
    &lt;Attribute name="cotlist"&gt;
        &lt;Value&gt;cot&lt;/Value&gt;
    &lt;/Attribute&gt;
&lt;/AttributeQueryConfig&gt;</pre><p>To:</p><pre class="brush: xml;">&lt;AttributeQueryConfig metaAlias="/attrQuery"&gt;
    &lt;Attribute name="signingCertAlias"&gt;
        &lt;Value&gt;test&lt;/Value&gt;
    &lt;/Attribute&gt;
    &lt;Attribute name="encryptionCertAlias"&gt;
        &lt;Value&gt;test&lt;/Value&gt;
    &lt;/Attribute&gt;
    &lt;Attribute name="wantNameIDEncrypted"&gt;
        &lt;Value&gt;true&lt;/Value&gt;
    &lt;/Attribute&gt;
    &lt;Attribute name="cotlist"&gt;
        &lt;Value&gt;cot&lt;/Value&gt;
    &lt;/Attribute&gt;
&lt;/AttributeQueryConfig&gt;</pre></li><li class="step"><p>In OpenAM Console, under Federation &gt; Entity Providers, delete
      the existing configuration for your new Fedlet.</p></li><li class="step"><p>
       Make a copy of <code class="filename">sp-extended.xml</code>
       called <code class="filename">sp-extended-copy.xml</code>
       and set <code class="literal">hosted="0"</code> in the root element of the copy.
      </p><p>
       Use the copy, <code class="filename">sp-extended-copy.xml</code>,
       when importing the Fedlet configuration into OpenAM.
       OpenAM must register the Fedlet
       as a <span class="emphasis"><em>remote</em></span> service provider.
      </p></li><li class="step"><p>Under Federation &gt; Entity Providers, click Import Entity... and
      import your updated Fedlet configuration.</p><p>This ensures OpenAM has the correct service provider configuration
      for your new Fedlet.</p></li><li class="step"><p>Restart the Fedlet or the container where it is deployed.</p></li></ol></li><li class="step"><p>Try the Attribute Query test.</p><ol type="a" class="substeps"><li class="step"><p>Access the Fedlet.</p><div class="mediaobject" align="center"><a name="figure-fedlet-sso-request"></a><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/fedlet-sso-request.png" align="middle" height="360" alt="Home page for demo Fedlet"></td></tr></table><div class="longdesc-link" align="right"><br clear="all"><span class="longdesc-link">[<a href="figure-fedlet-sso-request.html" target="longdesc">D</a>]</span></div></div></li><li class="step"><p>Try SSO with user name <code class="literal">demo</code>, password
      <code class="literal">changeit</code>.</p><div class="mediaobject" align="center"><a name="figure-fedlet-sso-response"></a><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/fedlet-sso-response.png" align="middle" height="360" alt="Fedlet SSO response page"></td></tr></table><div class="longdesc-link" align="right"><br clear="all"><span class="longdesc-link">[<a href="figure-fedlet-sso-response.html" target="longdesc">D</a>]</span></div></div></li><li class="step"><p>Click Fedlet Attribute Query, set the attributes in the Attribute
      Query page to match the mapped attributes, and then click Submit.</p><div class="mediaobject" align="center"><a name="figure-fedlet-attr-query-request"></a><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/fedlet-attr-query-request.png" align="middle" height="360" alt="Fedlet Attribute Query request page"></td></tr></table><div class="longdesc-link" align="right"><br clear="all"><span class="longdesc-link">[<a href="figure-fedlet-attr-query-request.html" target="longdesc">D</a>]</span></div></div></li><li class="step"><p>Check that you see the attribute values in the response.</p><div class="mediaobject" align="center"><a name="figure-fedlet-attr-query-response"></a><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/fedlet-attr-query-response.png" align="middle" height="360" alt="Fedlet Attribute Query response page"></td></tr></table><div class="longdesc-link" align="right"><br clear="all"><span class="longdesc-link">[<a href="figure-fedlet-attr-query-response.html" target="longdesc">D</a>]</span></div></div></li></ol></li></ol></div><div class="procedure"><a name="try-fedlet-xacml-query"></a><div class="procedure-title">Procedure&nbsp;14.4.&nbsp;To Try the Fedlet XACML Query</div><p>To try the Fedlet XACML Query test, the Identity Provider
   must have a policy configured, must be configured with the Policy Decision
   Point (<code class="literal">XACML PDP</code>) type, and must have a SAMLv2 SOAP Binding
   PDP handler configured.</p><ol class="procedure" type="1"><li class="step"><p>Configure a policy on the hosted Identity Provider.</p><p>OpenAM uses the policy to make the decision whether to permit or deny
    access to a resource. For the purpose of the demonstration, configure a
    simple policy that allows all authenticated users HTTP GET access on
    <code class="literal">http://www.example.com/</code>.</p><ol type="a" class="substeps"><li class="step"><p>Log in to OpenAM console as <code class="literal">amadmin</code>.</p></li><li class="step"><p>
       Access the policy editor under
       Access Control &gt; <em class="replaceable"><code>realm-name</code></em> &gt; Policies.
      </p></li><li class="step"><p>
       Choose an application that allows the resource pattern
       <code class="literal">http://www.example.com/*</code>,
       and HTTP GET as an action.
      </p><p>
       If no application exists in the realm, add a new application
       for the resource pattern <code class="literal">http://www.example.com/*</code>.
      </p></li><li class="step"><p>
       Add a new policy with the following characteristics.
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
         Resource pattern: <code class="literal">http://www.example.com/*</code>
        </p></li><li class="listitem"><p>
         Actions: allow <code class="literal">GET</code>
        </p></li><li class="listitem"><p>
         Subject conditions: <code class="literal">Authenticated Users</code>
        </p></li></ul></div></li></ol></li><li class="step"><p>Add the Policy Decision Point type to the Identity Provider.</p><ol type="a" class="substeps"><li class="step"><p>Under Federation &gt; Entity Providers, select the Identity Provider,
      and then click New..., even though you plan to change the configuration
      rather than create a new provider.</p></li><li class="step"><p>Select the protocol of the provider: SAMLv2.</p></li><li class="step"><p>In the Create SAMLv2 Entity Provider page, do the following.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Set the Realm.</p></li><li class="listitem"><p>Set the Entity Identifier to the entity identifier for the hosted
        Identity Provider.</p></li><li class="listitem"><p>In the XACML Policy Decision Point section, set the Meta Alias for
        example to <code class="literal">/pdp</code>.</p></li><li class="listitem"><p>Click Create to save your changes.</p><p>Disregard any error messages stating that the entity already
        exists.</p></li></ul></div><p><code class="literal">XACML PDP</code> now appears in the list of Types for
      your identity provider.</p></li></ol></li><li class="step"><p>Add the PDP handler for the SAMLv2 SOAP Binding.</p><ol type="a" class="substeps"><li class="step"><p>Under Configuration &gt; Global &gt; SAMLv2 SOAP Binding, click
      New...</p></li><li class="step"><p>Set the new key to match the meta alias you used when adding the
      XACML PDP type to the Identity Provider configuration, for example
      <code class="literal">/pdp</code>.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Key: <code class="literal">/pdp</code></p></li><li class="listitem"><p>Class: <code class="literal">com.sun.identity.xacml.plugins.XACMLAuthzDecisionQueryHandler</code></p></li></ul></div><p>Click OK. (Your changes are not saved, yet.)</p></li><li class="step"><p>Click Save to actually save the new Key:Class pair.</p></li></ol></li><li class="step"><p>Create the Fedlet as described in <a class="xref" href="chap-fedlet-java.html#create-a-java-fedlet" title="Procedure&nbsp;14.1.&nbsp;To Create a Fedlet">Procedure&nbsp;14.1, &#8220;To Create a Fedlet&#8221;</a>.</p><p>This step creates a Fedlet with updated identity provider metadata.
    If you already created a Fedlet, either use a different name, or delete
    the existing Fedlet.</p></li><li class="step"><p>Deploy the new Fedlet .war as described in <a class="xref" href="chap-fedlet-java.html#install-fedlet-as-demo" title="Procedure&nbsp;14.2.&nbsp;To Install the Fedlet as a Demo Application">Procedure&nbsp;14.2, &#8220;To Install the Fedlet as a Demo Application&#8221;</a>.</p></li><li class="step"><p>Try the XACML Query test.</p><ol type="a" class="substeps"><li class="step"><p>Access the Fedlet.</p><div class="mediaobject" align="center"><a name="figure-fedlet-sso-request-xacml"></a><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/fedlet-sso-request.png" align="middle" height="360" alt="Home page for demo Fedlet"></td></tr></table><div class="longdesc-link" align="right"><br clear="all"><span class="longdesc-link">[<a href="figure-fedlet-sso-request-xacml.html" target="longdesc">D</a>]</span></div></div></li><li class="step"><p>Try SSO with user name <code class="literal">demo</code>, password
      <code class="literal">changeit</code>.</p><div class="mediaobject" align="center"><a name="figure-fedlet-sso-response-xacml"></a><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/fedlet-sso-response.png" align="middle" height="360" alt="Fedlet SSO response page"></td></tr></table><div class="longdesc-link" align="right"><br clear="all"><span class="longdesc-link">[<a href="figure-fedlet-sso-response-xacml.html" target="longdesc">D</a>]</span></div></div></li><li class="step"><p>Click XACML Attribute Query, set the Resource URL in the XACML
      Query page to <code class="literal">http://www.example.com/</code>, and then
      click Submit.</p><div class="mediaobject" align="center"><a name="figure-fedlet-xacml-query-request"></a><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/fedlet-xacml-query-request.png" align="middle" height="360" alt="Fedlet XACML Query request page"></td></tr></table><div class="longdesc-link" align="right"><br clear="all"><span class="longdesc-link">[<a href="figure-fedlet-xacml-query-request.html" target="longdesc">D</a>]</span></div></div></li><li class="step"><p>Check that you see the permit decision in the response.</p><div class="mediaobject" align="center"><a name="figure-fedlet-xacml-query-response"></a><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/fedlet-xacml-query-response.png" align="middle" height="360" alt="Fedlet XACML Query response page"></td></tr></table><div class="longdesc-link" align="right"><br clear="all"><span class="longdesc-link">[<a href="figure-fedlet-xacml-query-response.html" target="longdesc">D</a>]</span></div></div></li></ol></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="fedlet-signing-encryption"></a>14.2.&nbsp;Signing &amp; Encryption For a Fedlet</h2></div></div></div><p>By default when you create the Java Fedlet, signing and encryption are
  not configured. You can however set up OpenAM and the fedlet to sign and
  to verify XML signatures and to encrypt and to decrypt data such as SAML
  assertions. If you have tried the Attribute Query demonstration, then you
  have already configured the Fedlet to request signing and encryption using
  the test keys from the identity provider.</p><div class="itemizedlist"><p>Enable signing and encryption for the Java Fedlet involves the
   following high level stages.</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Before you create the Fedlet, configure the IDP to sign and encrypt
    data. See Federation &gt; Entity Providers &gt; <em class="replaceable"><code>IDP
    Name</code></em> &gt; Signing and Encryption in the OpenAM console.</p><p>For evaluation, you can use the <code class="literal">test</code> certificate
    delivered with OpenAM.</p></li><li class="listitem"><p>Initially deploy and configure the Fedlet, but do not use the Fedlet
    until you finish.</p></li><li class="listitem"><p>On the Fedlet side set up a JKS keystore used for signing and
    encryption. For evaluation, you can use copy the
    <code class="filename">keystore.jks</code> file delivered with OpenAM. You can find
    the file under the configuration directory for OpenAM, such as
    <code class="filename">$HOME/openam/openam/</code> for a server instance with
    base URI <code class="literal">openam</code>. The built-in keystore includes the
    <code class="literal">test</code> certificate.</p><p>You must also set up <code class="filename">.storepass</code> and
    <code class="filename">.keypass</code> files using the
    <code class="filename">fedletEncode.jsp</code> page, such as
    <code class="literal">http://openam.example.com:8080/fedlet/fedletEncode.jsp</code>, to
    encode passwords on the Fedlet side. The passwords for the test key store
    and private key are both <code class="literal">changeit</code>.</p></li><li class="listitem"><p>Configure the Fedlet to perform signing and encryption by ensuring
    the Fedlet has access to the key store, and by updating the SP metadata
    for the Fedlet.</p></li><li class="listitem"><p>Import the updated SP metadata into the IDP to replace the default
    Fedlet configuration.</p></li><li class="listitem"><p>Restart the Fedlet or container in which the Fedlet runs for the
    changes you made on the Fedlet side to take effect.</p></li></ul></div><div class="procedure"><a name="fedlet-conf-signing-encryption"></a><div class="procedure-title">Procedure&nbsp;14.5.&nbsp;To Configure the Fedlet For Signing &amp; Encryption</div><p>The <code class="filename">FederationConfig.properties</code> file specifies
   the paths to the JKS keystore holding the signing or encryption keys for
   the Fedlet, the keystore password file, and the private key password
   file.</p><ol class="procedure" type="1"><li class="step"><p>After setting up your keystore and password files as described above,
    edit the properties file in the configuration directory, such as
    <code class="filename">$HOME/fedlet/FederationConfig.properties</code>, to point
    to the keystore and password files.</p></li><li class="step"><p>Export the certificate to use for signing and encryption
    purposes.</p><div class="screen"><pre>
$ <strong>keytool -export -rfc -keystore keystore.jks -alias test</strong>
<em>Enter keystore password:
-----BEGIN CERTIFICATE-----
MIICQDCCAakCBEeNB0swDQYJKoZIhvcNAQEEBQAwZzELMAkGA1UEBhMCVVMxEzARBgNVBAgTCkNh
bGlmb3JuaWExFDASBgNVBAcTC1NhbnRhIENsYXJhMQwwCgYDVQQKEwNTdW4xEDAOBgNVBAsTB09w
ZW5TU08xDTALBgNVBAMTBHRlc3QwHhcNMDgwMTE1MTkxOTM5WhcNMTgwMTEyMTkxOTM5WjBnMQsw
CQYDVQQGEwJVUzETMBEGA1UECBMKQ2FsaWZvcm5pYTEUMBIGA1UEBxMLU2FudGEgQ2xhcmExDDAK
BgNVBAoTA1N1bjEQMA4GA1UECxMHT3BlblNTTzENMAsGA1UEAxMEdGVzdDCBnzANBgkqhkiG9w0B
AQEFAAOBjQAwgYkCgYEArSQc/U75GB2AtKhbGS5piiLkmJzqEsp64rDxbMJ+xDrye0EN/q1U5Of+
RkDsaN/igkAvV1cuXEgTL6RlafFPcUX7QxDhZBhsYF9pbwtMzi4A4su9hnxIhURebGEmxKW9qJNY
Js0Vo5+IgjxuEWnjnnVgHTs1+mq5QYTA7E6ZyL8CAwEAATANBgkqhkiG9w0BAQQFAAOBgQB3Pw/U
QzPKTPTYi9upbFXlrAKMwtFf2OW4yvGWWvlcwcNSZJmTJ8ARvVYOMEVNbsT4OFcfu2/PeYoAdiDA
cGy/F2Zuj8XJJpuQRSE6PtQqBuDEHjjmOQJ0rV/r8mO1ZCtHRhpZ5zYRjhRC9eCbjx9VrFax0JDC
/FfwWigmrW0Y0Q==</em>
    </pre></div></li><li class="step"><p>Edit the standard metadata file for the Fedlet, such as
    <code class="filename">$HOME/fedlet/sp.xml</code>, to include the certificate
    in KeyDescriptor elements, that are children of the SPSSODescriptor
    element.</p><pre class="brush: xml;">&lt;EntityDescriptor
 xmlns="urn:oasis:names:tc:SAML:2.0:metadata"
 entityID="http://www.example.com:8080/fedlet"&gt;
 &lt;SPSSODescriptor
  AuthnRequestsSigned="true"
  WantAssertionsSigned="true"
  protocolSupportEnumeration="urn:oasis:names:tc:SAML:2.0:protocol"&gt;
  &lt;KeyDescriptor use="signing"&gt;
   &lt;ds:KeyInfo xmlns:ds="http://www.w3.org/2000/09/xmldsig#"&gt;
    &lt;ds:X509Data&gt;
     &lt;ds:X509Certificate&gt;
MIICQDCCAakCBEeNB0swDQYJKoZIhvcNAQEEBQAwZzELMAkGA1UEBhMCVVMxEzARBgNVBAgTCkNh
bGlmb3JuaWExFDASBgNVBAcTC1NhbnRhIENsYXJhMQwwCgYDVQQKEwNTdW4xEDAOBgNVBAsTB09w
ZW5TU08xDTALBgNVBAMTBHRlc3QwHhcNMDgwMTE1MTkxOTM5WhcNMTgwMTEyMTkxOTM5WjBnMQsw
CQYDVQQGEwJVUzETMBEGA1UECBMKQ2FsaWZvcm5pYTEUMBIGA1UEBxMLU2FudGEgQ2xhcmExDDAK
BgNVBAoTA1N1bjEQMA4GA1UECxMHT3BlblNTTzENMAsGA1UEAxMEdGVzdDCBnzANBgkqhkiG9w0B
AQEFAAOBjQAwgYkCgYEArSQc/U75GB2AtKhbGS5piiLkmJzqEsp64rDxbMJ+xDrye0EN/q1U5Of+
RkDsaN/igkAvV1cuXEgTL6RlafFPcUX7QxDhZBhsYF9pbwtMzi4A4su9hnxIhURebGEmxKW9qJNY
Js0Vo5+IgjxuEWnjnnVgHTs1+mq5QYTA7E6ZyL8CAwEAATANBgkqhkiG9w0BAQQFAAOBgQB3Pw/U
QzPKTPTYi9upbFXlrAKMwtFf2OW4yvGWWvlcwcNSZJmTJ8ARvVYOMEVNbsT4OFcfu2/PeYoAdiDA
cGy/F2Zuj8XJJpuQRSE6PtQqBuDEHjjmOQJ0rV/r8mO1ZCtHRhpZ5zYRjhRC9eCbjx9VrFax0JDC
/FfwWigmrW0Y0Q==
     &lt;/ds:X509Certificate&gt;
    &lt;/ds:X509Data&gt;
   &lt;/ds:KeyInfo&gt;
  &lt;/KeyDescriptor&gt;
  &lt;KeyDescriptor use="encryption"&gt;
   &lt;ds:KeyInfo xmlns:ds="http://www.w3.org/2000/09/xmldsig#"&gt;
    &lt;ds:X509Data&gt;
     &lt;ds:X509Certificate&gt;
MIICQDCCAakCBEeNB0swDQYJKoZIhvcNAQEEBQAwZzELMAkGA1UEBhMCVVMxEzARBgNVBAgTCkNh
bGlmb3JuaWExFDASBgNVBAcTC1NhbnRhIENsYXJhMQwwCgYDVQQKEwNTdW4xEDAOBgNVBAsTB09w
ZW5TU08xDTALBgNVBAMTBHRlc3QwHhcNMDgwMTE1MTkxOTM5WhcNMTgwMTEyMTkxOTM5WjBnMQsw
CQYDVQQGEwJVUzETMBEGA1UECBMKQ2FsaWZvcm5pYTEUMBIGA1UEBxMLU2FudGEgQ2xhcmExDDAK
BgNVBAoTA1N1bjEQMA4GA1UECxMHT3BlblNTTzENMAsGA1UEAxMEdGVzdDCBnzANBgkqhkiG9w0B
AQEFAAOBjQAwgYkCgYEArSQc/U75GB2AtKhbGS5piiLkmJzqEsp64rDxbMJ+xDrye0EN/q1U5Of+
RkDsaN/igkAvV1cuXEgTL6RlafFPcUX7QxDhZBhsYF9pbwtMzi4A4su9hnxIhURebGEmxKW9qJNY
Js0Vo5+IgjxuEWnjnnVgHTs1+mq5QYTA7E6ZyL8CAwEAATANBgkqhkiG9w0BAQQFAAOBgQB3Pw/U
QzPKTPTYi9upbFXlrAKMwtFf2OW4yvGWWvlcwcNSZJmTJ8ARvVYOMEVNbsT4OFcfu2/PeYoAdiDA
cGy/F2Zuj8XJJpuQRSE6PtQqBuDEHjjmOQJ0rV/r8mO1ZCtHRhpZ5zYRjhRC9eCbjx9VrFax0JDC
/FfwWigmrW0Y0Q==
     &lt;/ds:X509Certificate&gt;
    &lt;/ds:X509Data&gt;
   &lt;/ds:KeyInfo&gt;
   &lt;EncryptionMethod Algorithm="http://www.w3.org/2001/04/xmlenc#aes128-cbc"&gt;
    &lt;xenc:KeySize xmlns:xenc="http://www.w3.org/2001/04/xmlenc#"&gt;
     128
    &lt;/xenc:KeySize&gt;
   &lt;/EncryptionMethod&gt;
  &lt;/KeyDescriptor&gt;
  &lt;SingleLogoutService
   Binding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect"
   Location="http://www.example.com:8080/fedlet/fedletSloRedirect"
   ResponseLocation="http://www.example.com:8080/fedlet/fedletSloRedirect" /&gt;
  &lt;SingleLogoutService
   Binding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST"
   Location="http://www.example.com:8080/fedlet/fedletSloPOST"
   ResponseLocation="http://www.example.com:8080/fedlet/fedletSloPOST" /&gt;
  &lt;SingleLogoutService
   Binding="urn:oasis:names:tc:SAML:2.0:bindings:SOAP"
   Location="http://www.example.com:8080/fedlet/fedletSloSoap" /&gt;
  &lt;NameIDFormat&gt;
   urn:oasis:names:tc:SAML:2.0:nameid-format:transient
  &lt;/NameIDFormat&gt;
  &lt;AssertionConsumerService
   index="0"
   isDefault="true"
   Binding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST"
   Location="http://www.example.com:8080/fedlet/fedletapplication" /&gt;
  &lt;AssertionConsumerService
   index="1"
   Binding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Artifact"
   Location="http://www.example.com:8080/fedlet/fedletapplication" /&gt;
 &lt;/SPSSODescriptor&gt;
 &lt;RoleDescriptor
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:query="urn:oasis:names:tc:SAML:metadata:ext:query"
  xsi:type="query:AttributeQueryDescriptorType"
  protocolSupportEnumeration="urn:oasis:names:tc:SAML:2.0:protocol"&gt;
 &lt;/RoleDescriptor&gt;
 &lt;XACMLAuthzDecisionQueryDescriptor
  WantAssertionsSigned="false"
  protocolSupportEnumeration="urn:oasis:names:tc:SAML:2.0:protocol" /&gt;
&lt;/EntityDescriptor&gt;</pre></li><li class="step"><p>Edit the extended metadata file for the Fedlet, such as
    <code class="filename">$HOME/fedlet/sp-extended.xml</code>, to set the certificate
    alias names to the alias for the Fedlet certificate, and the
    <code class="literal">want*Signed</code> and <code class="literal">want*Encrypted</code> values
    to <code class="literal">true</code>.</p><p>If you reformat the file, take care not to add white space around
    string values in elements.</p><pre class="brush: xml;">
&lt;EntityConfig xmlns="urn:sun:fm:SAML:2.0:entityconfig"
 xmlns:fm="urn:sun:fm:SAML:2.0:entityconfig" hosted="1"
 entityID="http://www.example.com:8080/fedlet"&gt;
 &lt;SPSSOConfig metaAlias="/sp"&gt;
  &lt;Attribute name="description"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="signingCertAlias"&gt;
   &lt;Value&gt;test&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="encryptionCertAlias"&gt;
   &lt;Value&gt;test&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="basicAuthOn"&gt;
   &lt;Value&gt;false&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="basicAuthUser"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="basicAuthPassword"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="autofedEnabled"&gt;
   &lt;Value&gt;false&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="autofedAttribute"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="transientUser"&gt;
   &lt;Value&gt;anonymous&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="spAdapter"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="spAdapterEnv"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="fedletAdapter"&gt;
   &lt;Value&gt;com.sun.identity.saml2.plugins.DefaultFedletAdapter&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="fedletAdapterEnv"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="spAccountMapper"&gt;
   &lt;Value&gt;com.sun.identity.saml2.plugins.DefaultLibrarySPAccountMapper&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="useNameIDAsSPUserID"&gt;
   &lt;Value&gt;false&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="spAttributeMapper"&gt;
   &lt;Value&gt;com.sun.identity.saml2.plugins.DefaultSPAttributeMapper&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="spAuthncontextMapper"&gt;
   &lt;Value&gt;com.sun.identity.saml2.plugins.DefaultSPAuthnContextMapper&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="spAuthncontextClassrefMapping"&gt;
   &lt;Value
   &gt;urn:oasis:names:tc:SAML:2.0:ac:classes:PasswordProtectedTransport|0|default&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="spAuthncontextComparisonType"&gt;
   &lt;Value&gt;exact&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="attributeMap"&gt;
   &lt;Value&gt;*=*&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="saml2AuthModuleName"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="localAuthURL"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="intermediateUrl"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="defaultRelayState"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="appLogoutUrl"&gt;
   &lt;Value&gt;http://www.example.com:8080/fedlet/logout&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="assertionTimeSkew"&gt;
   &lt;Value&gt;300&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="wantAttributeEncrypted"&gt;
   &lt;Value&gt;true&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="wantAssertionEncrypted"&gt;
   &lt;Value&gt;true&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="wantNameIDEncrypted"&gt;
   &lt;Value&gt;true&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="wantPOSTResponseSigned"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="wantArtifactResponseSigned"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="wantLogoutRequestSigned"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="wantLogoutResponseSigned"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="wantMNIRequestSigned"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="wantMNIResponseSigned"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="responseArtifactMessageEncoding"&gt;
   &lt;Value&gt;URI&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="cotlist"&gt;
   &lt;Value&gt;fedlet-cot&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="saeAppSecretList"&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="saeSPUrl"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="saeSPLogoutUrl"&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="ECPRequestIDPListFinderImpl"&gt;
   &lt;Value&gt;com.sun.identity.saml2.plugins.ECPIDPFinder&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="ECPRequestIDPList"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="ECPRequestIDPListGetComplete"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="enableIDPProxy"&gt;
   &lt;Value&gt;false&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="idpProxyList"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="idpProxyCount"&gt;
   &lt;Value&gt;0&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="useIntroductionForIDPProxy"&gt;
   &lt;Value&gt;false&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="spSessionSyncEnabled"&gt;
   &lt;Value&gt;false&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="relayStateUrlList"&gt;
  &lt;/Attribute&gt;
 &lt;/SPSSOConfig&gt;
 &lt;AttributeQueryConfig metaAlias="/attrQuery"&gt;
  &lt;Attribute name="signingCertAlias"&gt;
   &lt;Value&gt;test&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="encryptionCertAlias"&gt;
   &lt;Value&gt;test&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="wantNameIDEncrypted"&gt;
   &lt;Value&gt;true&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="cotlist"&gt;
   &lt;Value&gt;fedlet-cot&lt;/Value&gt;
  &lt;/Attribute&gt;
 &lt;/AttributeQueryConfig&gt;
 &lt;XACMLAuthzDecisionQueryConfig metaAlias="/pep"&gt;
  &lt;Attribute name="signingCertAlias"&gt;
   &lt;Value&gt;test&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="encryptionCertAlias"&gt;
   &lt;Value&gt;test&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="basicAuthOn"&gt;
   &lt;Value&gt;false&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="basicAuthUser"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="basicAuthPassword"&gt;
   &lt;Value&gt;&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="wantXACMLAuthzDecisionResponseSigned"&gt;
   &lt;Value&gt;false&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="wantAssertionEncrypted"&gt;
   &lt;Value&gt;true&lt;/Value&gt;
  &lt;/Attribute&gt;
  &lt;Attribute name="cotlist"&gt;
   &lt;Value&gt;fedlet-cot&lt;/Value&gt;
  &lt;/Attribute&gt;
 &lt;/XACMLAuthzDecisionQueryConfig&gt;
&lt;/EntityConfig&gt;</pre></li><li class="step"><p>
     Make a copy of <code class="filename">sp-extended.xml</code>
     called <code class="filename">sp-extended-copy.xml</code>
     and set <code class="literal">hosted="0"</code> in the root element of the copy.
    </p><p>
     Use the copy, <code class="filename">sp-extended-copy.xml</code>,
     when importing the Fedlet configuration into OpenAM.
     OpenAM must register the Fedlet
     as a <span class="emphasis"><em>remote</em></span> service provider.
    </p></li><li class="step"><p>In OpenAM console delete the original SP entity configuration for the
    Fedlet, and then import the updated metadata for the new configuration into
    OpenAM on the IDP side.</p></li><li class="step"><p>Restart the Fedlet or the container in which it runs in order for
    the Fedlet to pick up the changes to the configuration properties and the
    metadata.</p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="customize-java-fedlet"></a>14.3.&nbsp;Customizing a Java Fedlet</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="chap-fedlet-java.html#fedlet-perform-sso">14.3.1. Performing Single Sign-On</a></span></dt><dt><span class="section"><a href="chap-fedlet-java.html#fedlet-perform-slo">14.3.2. Performing Single Logout</a></span></dt><dt><span class="section"><a href="chap-fedlet-java.html#fedlet-perform-attr-query">14.3.3. Performing Attribute Queries</a></span></dt><dt><span class="section"><a href="chap-fedlet-java.html#fedlet-perform-xacml-query">14.3.4. Performing XACML Queries</a></span></dt></dl></div><p>You can customize the Java Fedlet to perform many of the SAML 2.0
  service provider operations. The Java Fedlet has the SAML 2.0 capabilities
  identified in the table in the <em class="citetitle">Administration Guide</em>,
  <a href="../../admin-guide/index/chap-federation.html#fedlet-saml2-features" class="link"><em class="citetitle">Fedlet Support for
  SAML 2.0 Features</em></a>.</p><div class="procedure"><a name="hello-world-with-fedlet"></a><div class="procedure-title">Procedure&nbsp;14.6.&nbsp;To Add Your Application</div><div class="variablelist"><p>The Fedlet includes the following files that you use when building
    your own service provider application based on the demo web application,
    including a set of JavaServer Pages (JSP) examples.</p><dl class="variablelist"><dt><span class="term"><code class="filename">conf/</code></span></dt><dd><p>Configuration files copied to <code class="filename">$HOME/fedlet</code> when
      you first deploy and configure the Fedlet. When deploying your application,
      you can move these to an alternate location passed to the Java virtual
      machine for the web application container at startup. For example, if
      you store the configuration under <code class="filename">/export/fedlet/</code>,
      then you could pass the following property to the JVM.</p><pre class="literallayout">-Dcom.sun.identity.fedlet.home=/export/fedlet/conf</pre><p>You do not need to include these files in your application.</p></dd><dt><span class="term"><code class="filename">fedletAttrQuery.jsp</code>, </span><span class="term"><code class="filename">fedletAttrResp.jsp</code></span></dt><dd><p>Sample SAML attribute query and response handlers.</p></dd><dt><span class="term"><code class="filename">fedletEncode.jsp</code></span></dt><dd><p>Utility JSP to encode a password, such as the password used to
      protect a Java keystore</p></dd><dt><span class="term"><code class="filename">fedletSampleApp.jsp</code>, </span><span class="term"><code class="filename">index.jsp</code></span></dt><dd><p>Demo application. You can remove these before deployment to replace
      them with your application.</p></dd><dt><span class="term"><code class="filename">fedletXACMLQuery.jsp</code>, </span><span class="term"><code class="filename">fedletXACMLResp.jsp</code></span></dt><dd><p>Sample SAML XACML query and response handlers.</p></dd><dt><span class="term"><code class="filename">logout.jsp</code></span></dt><dd><p>Utility page to perform single log out</p></dd><dt><span class="term"><code class="filename">saml2/jsp/</code></span></dt><dd><p>JSPs to initiate single sign on and single logout, and to handle
      errors, and also a JSP for obtaining Fedlet metadata,
      <code class="filename">saml2/jsp/exportmetadata.jsp</code></p></dd><dt><span class="term"><code class="filename">WEB-INF/classes/</code></span></dt><dd><p>Localized Java properties files for strings used in the Fedlet user
      interface</p></dd><dt><span class="term"><code class="filename">WEB-INF/lib/</code></span></dt><dd><p>Fedlet libraries required by your application</p></dd><dt><span class="term"><code class="filename">WEB-INF/web.xml</code></span></dt><dd><p>Fedlet web application configuration, showing how JSPs map to URLs
      used in the Fedlet. Add mappings for your application before
      deployment.</p><p>In the <code class="filename">web.xml</code> mappings, your application must
      be mapped to <code class="literal">/fedletapplication</code>, as this is the
      assertion consumer URL set in the Fedlet metadata.</p><pre class="brush: xml;">&lt;servlet&gt;
    &lt;servlet-name&gt;yourApp&lt;/servlet-name&gt;
    &lt;jsp-file&gt;/fedletSampleApp.jsp&lt;/jsp-file&gt;
&lt;/servlet&gt;
&lt;servlet-mapping&gt;
    &lt;servlet-name&gt;yourApp&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/fedletapplication&lt;/url-pattern&gt;
&lt;/servlet-mapping&gt;</pre></dd></dl></div><p>Follow these steps for a very simple demonstration of how to customize
   the Fedlet.</p><ol class="procedure" type="1"><li class="step"><p>Backup <code class="filename">fedletSampleApp.jsp</code>.</p><div class="screen"><pre>
$ <strong>cd /path/to/tomcat/webapps/fedlet/</strong>
$ <strong>cp fedletSampleApp.jsp fedletSampleApp.jsp.orig</strong>
    </pre></div></li><li class="step"><p>Edit <code class="filename">fedletSampleApp.jsp</code> to reduce it to a single
    redirection to <code class="filename">myapp.jsp</code>. An implementation of the
    &lt;html&gt; element of the file follows below.</p><pre class="brush: html;">&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Fedlet Sample Application&lt;/title&gt;
    &lt;meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" /&gt;
&lt;/head&gt;

&lt;body&gt;
&lt;%
    // BEGIN : following code is a must for Fedlet (SP) side application
    Map map;
    try {
        // invoke the Fedlet processing logic. this will do all the
        // necessary processing conforming to SAMLv2 specifications,
        // such as XML signature validation, Audience and Recipient
        // validation etc.
        map = SPACSUtils.processResponseForFedlet(request, response);
        response.sendRedirect("myapp.jsp");
    } catch (SAML2Exception sme) {
        SAMLUtils.sendError(request, response,
            response.SC_INTERNAL_SERVER_ERROR, "failedToProcessSSOResponse",
            sme.getMessage());
        return;
    } catch (IOException ioe) {
        SAMLUtils.sendError(request, response,
            response.SC_INTERNAL_SERVER_ERROR, "failedToProcessSSOResponse",
            ioe.getMessage());
        return;
    } catch (SessionException se) {
        SAMLUtils.sendError(request, response,
            response.SC_INTERNAL_SERVER_ERROR, "failedToProcessSSOResponse",
            se.getMessage());
        return;
    } catch (ServletException se) {
        SAMLUtils.sendError(request, response,
            response.SC_BAD_REQUEST, "failedToProcessSSOResponse",
            se.getMessage());
        return;
    }
    // END : code is a must for Fedlet (SP) side application
%&gt;
&lt;/body&gt;
&lt;/html&gt;</pre></li><li class="step"><p>Add a <code class="filename">myapp.jsp</code> page to the Fedlet, such as the
    following.</p><pre class="brush: html;">&lt;html&gt;
&lt;head&gt;
&lt;title&gt;My Application&lt;/title&gt;
&lt;meta http-equiv="Content-Type" content="text/html" /&gt;
&lt;/head&gt;

&lt;body&gt;

&lt;h1&gt;My Application&lt;/h1&gt;

&lt;p&gt;After you change the &lt;code&gt;fedletSampleApp.jsp&lt;/code&gt;,
   all it does is redirect to this home page after
   successful login.&lt;/p&gt;

&lt;/body&gt;
&lt;/html&gt;</pre></li><li class="step"><p>Browse to the Fedlet URL, such as
    <code class="literal">http://openam.example.com:8080/fedlet/</code>, and try one
    of the login methods.</p><p>After login you are redirected to <code class="filename">myapp.jsp</code>.</p></li></ol></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="fedlet-perform-sso"></a>14.3.1.&nbsp;Performing Single Sign-On</h3></div></div></div><p>The Java Fedlet includes a JSP file,
   <code class="filename">saml2/jsp/fedletSSOInit.jsp</code>, that you can call to
   initiate single sign-on from the Fedlet (SP) side. The Fedlet home page,
   <code class="filename">index.jsp</code>, calls this page when the user does
   Fedlet-initiated single sign-on.</p><p>When calling this JSP, the parameters to use are those also used by
   <code class="filename">saml2/jsp/spSSOInit.jsp</code> in OpenAM. Those parameters are
   described in the <em class="citetitle">Administration Guide</em> section,
   <a href="../../admin-guide/index/chap-federation.html#spssoinit-parameters" class="link"><em class="citetitle"><code class="filename">spSSOInit.jsp</code> Parameters</em></a>.</p><p>For IDP-initiated single sign-on, call the appropriate page on the
   Identity Provider. OpenAM's page is described in the
   <em class="citetitle">Administration Guide</em> section,
   <a href="../../admin-guide/index/chap-federation.html#idpssoinit-parameters" class="link"><em class="citetitle"><code class="filename">idpSSOInit.jsp</code> Parameters</em></a>.</p><p>After single sign-on, the user-agent is directed by default to the
   assertion consumer URI set in the Fedlet metadata, which by default is
   <code class="literal">/fedletapplication</code>. Also by default that URI points to
   the JSP, <code class="filename">fedletSampleApp.jsp</code></p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="fedlet-perform-slo"></a>14.3.2.&nbsp;Performing Single Logout</h3></div></div></div><p>The Java Fedlet includes a JSP file,
   <code class="filename">saml2/jsp/spSingleLogoutInit.jsp</code>, that you can call to
   initiate single logout from the Fedlet (SP) side. The Fedlet assertion
   consumer page, <code class="filename">fedletSampleApp.jsp</code>, calls this when
   the user does Fedlet-initiated single logout.</p><p>When calling this JSP, the parameters to use are those also used by
   <code class="filename">saml2/jsp/spSingleLogoutInit.jsp</code> in OpenAM. Those
   parameters are described in the <em class="citetitle">Administration Guide</em>
   section, <a href="../../admin-guide/index/chap-federation.html#spsloinit-parameters" class="link"><em class="citetitle"><code class="filename">spSingleLogoutInit.jsp</code> Parameters</em></a>.</p><p>For IDP-initiated single logout, call the appropriate page on the
   Identity Provider. OpenAM's page is described in the
   <em class="citetitle">Administration Guide</em> section,
   <a href="../../admin-guide/index/chap-federation.html#idpsloinit-parameters" class="link"><em class="citetitle"><code class="filename">idpSingleLogoutInit.jsp</code> Parameters</em></a>.</p><p>Set the <code class="literal">RelayState</code> parameter when initiating logout
   to redirect the user-agent appropriately when the process is complete.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="fedlet-perform-attr-query"></a>14.3.3.&nbsp;Performing Attribute Queries</h3></div></div></div><p>As seen in the procedure, <a class="xref" href="chap-fedlet-java.html#try-fedlet-attribute-query" title="Procedure&nbsp;14.3.&nbsp;To Try the Fedlet Attribute Query">Procedure&nbsp;14.3, &#8220;To Try the Fedlet Attribute Query&#8221;</a>,
   an attribute query allows the Fedlet to get profile information about a
   subject from the Attribute Authority. The Fedlet must be configured to deal
   with responses from the Attribute Authority, including configuration for
   signing and encryption. Also, an Identity Provider and Attribute Authority
   is likely to share only those attributes that the Fedlet absolutely requires
   to provide service, such as, for example, a name to customize a page. The
   attributes must then be mapped in the Attribute Authority and Fedlet
   metadata.</p><p>The Java Fedlet includes a JSP file,
   <code class="filename">fedletAttrQuery.jsp</code>, which is used in the procedure
   described above to prepare an attribute query using the transient subject
   identifier obtained during single sign-on. The
   <code class="filename">fedletAttrQuery.jsp</code> also supports using the Subject
   name from an X.509 identity certificate.</p><p>Another JSP file, <code class="filename">fedletAttrResp.jsp</code>, sends the
   query to the Attribute Authority using
   <code class="literal">com.sun.identity.saml2.profile.AttributeQueryUtil.html.getAttributesForFedlet()</code>,
   and if successful processes the result, which is a
   <code class="literal">java.util.Map</code> of the attribute types and their
   values.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="fedlet-perform-xacml-query"></a>14.3.4.&nbsp;Performing XACML Queries</h3></div></div></div><p>As seen in the procedure, <a class="xref" href="chap-fedlet-java.html#try-fedlet-xacml-query" title="Procedure&nbsp;14.4.&nbsp;To Try the Fedlet XACML Query">Procedure&nbsp;14.4, &#8220;To Try the Fedlet XACML Query&#8221;</a>,
   a XACML query allows the Fedlet to request a policy decision from a XACML
   PDP. You can configure OpenAM to respond to such queries as described in that
   procedure.</p><p>The Java Fedlet includes a JSP file,
   <code class="filename">fedletXACMLQuery.jsp</code>, which is used in the procedure
   described above to prepare a XACML query, identifying a resource URL and a
   type of HTTP operation to perform, and specifying the subject identifier
   obtained during single sign-on.</p><p>Another JSP file, <code class="filename">fedletXACMLResp.jsp</code>, sends the
   query to the XACML PDP using
   <code class="literal">com.sun.identity.saml2.profile.XACMLQueryUtil.getPolicyDecisionForFedlet()</code>,
   and if successful processes the result, which is a
   <code class="literal">java.lang.String</code> representing the decision, such as
   <code class="literal">Permit</code> if the decision is to allow access, or
   <code class="literal">Deny</code> if the decision is to deny access.</p></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="chap-xacml.html">Prev</a>&nbsp;</td><td width="20%" align="center">&nbsp;</td><td width="40%" align="right">&nbsp;<a accesskey="n" href="chap-fedlet-dotnet.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter&nbsp;13.&nbsp;Requesting a XACML Policy Decision Using OpenAM Java SDK&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;15.&nbsp;Using Fedlets in .NET Applications</td></tr></table></div><p>&nbsp;</p><div id="footer"><p>Something wrong on this page? <a href="https://bugster.forgerock.org/jira/secure/CreateIssueDetails!init.jspa?pid=10000&components=10007&issuetype=1">Log a documentation bug.</a></p></div>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-23412190-14']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</body></html>