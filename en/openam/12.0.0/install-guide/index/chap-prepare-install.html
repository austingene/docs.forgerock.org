<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head>

      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
   <title>Chapter&nbsp;1.&nbsp;Preparing For Installation</title><link rel="stylesheet" type="text/css" href="coredoc.css"><link rel="stylesheet" type="text/css" href="css/coredoc.css"><link rel="stylesheet" type="text/css" href="sh/shCore.css"><link rel="stylesheet" type="text/css" href="sh/shCoreEclipse.css"><link rel="stylesheet" type="text/css" href="sh/shThemeEclipse.css"><script src="http://code.jquery.com/jquery-1.11.0.min.js" type="text/javascript"></script><script src="uses-jquery.js" type="text/javascript"></script><script src="sh/shCore.js" type="text/javascript"></script><script src="sh/shBrushAci.js" type="text/javascript"></script><script src="sh/shBrushBash.js" type="text/javascript"></script><script src="sh/shBrushCsv.js" type="text/javascript"></script><script src="sh/shBrushHttp.js" type="text/javascript"></script><script src="sh/shBrushJava.js" type="text/javascript"></script><script src="sh/shBrushJScript.js" type="text/javascript"></script><script src="sh/shBrushLDIF.js" type="text/javascript"></script><script src="sh/shBrushPlain.js" type="text/javascript"></script><script src="sh/shBrushProperties.js" type="text/javascript"></script><script src="sh/shBrushXml.js" type="text/javascript"></script><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="OpenAM Installation Guide"><link rel="up" href="index.html" title="OpenAM Installation Guide"><link rel="prev" href="preface.html" title="Preface"><link rel="next" href="chap-install-core.html" title="Chapter&nbsp;2.&nbsp;Installing OpenAM Core Services"><link rel="copyright" href="legalnotice.html" title="Legal Notice"><script type="text/javascript">SyntaxHighlighter.all();</script>
<link rel="shortcut icon" href="http://forgerock.org/favicon.ico">
</head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter&nbsp;1.&nbsp;Preparing For Installation</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="preface.html">Prev</a>&nbsp;</td><th width="60%" align="center">&nbsp;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="chap-install-core.html">Next</a></td></tr></table><hr></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-prepare-install"></a>Chapter&nbsp;1.&nbsp;Preparing For Installation</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="section"><a href="chap-prepare-install.html#prepare-networking">1.1. Preparing a Fully-Qualified Domain Name</a></span></dt><dt><span class="section"><a href="chap-prepare-install.html#prepare-java">1.2. Preparing a Java Environment</a></span></dt><dt><span class="section"><a href="chap-prepare-install.html#prerequisites-file-descriptors">1.3. Setting Maximum File Descriptors</a></span></dt><dt><span class="section"><a href="chap-prepare-install.html#prepare-identity-repository">1.4. Preparing an Identity Repository</a></span></dt><dt><span class="section"><a href="chap-prepare-install.html#prepare-configuration-store">1.5. Preparing an External Configuration Data Store</a></span></dt><dt><span class="section"><a href="chap-prepare-install.html#download-openam-software">1.6. Obtaining OpenAM Software</a></span></dt><dt><span class="section"><a href="chap-prepare-install.html#enable-cors-support">1.7. Enabling CORS Support</a></span></dt><dt><span class="section"><a href="chap-prepare-install.html#prepare-apache-tomcat">1.8. Preparing Apache Tomcat</a></span></dt><dt><span class="section"><a href="chap-prepare-install.html#prepare-jboss-7">1.9. Preparing OpenAM &amp; JBoss AS 7 / EAP 6</a></span></dt><dt><span class="section"><a href="chap-prepare-install.html#prepare-oracle-weblogic">1.10. Preparing Oracle WebLogic</a></span></dt><dt><span class="section"><a href="chap-prepare-install.html#prepare-ibm-websphere">1.11. Preparing IBM WebSphere</a></span></dt></dl></div><a class="indexterm" name="d0e305"></a><p>This chapter covers prerequisites for installing OpenAM software,
 including how to prepare your application server to run OpenAM, how to prepare
 directory services to store configuration data, and how to prepare an identity
 repository to handle OpenAM identities.</p><div class="note"><h3 class="title">Note</h3><p>If a Java Security Manager is enabled for your application server,
  add permissions before installing OpenAM.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="prepare-networking"></a>1.1.&nbsp;Preparing a Fully-Qualified Domain Name</h2></div></div></div><a class="indexterm" name="d0e317"></a><a class="indexterm" name="d0e324"></a><p>OpenAM requires that you provide the fully-qualified domain name (FQDN)
  when you configure it. Before you set up OpenAM, be sure that your system
  has an FQDN such as <code class="literal">openam.example.com</code>. For evaluation
  purposes, you can give your system an alias using the
  <code class="filename">/etc/hosts</code> file on UNIX systems or
  <code class="filename">%SystemRoot%\system32\drivers\etc\hosts</code> on Windows. For
  deployment, make sure the FQDN is properly assigned for example using
  DNS.</p><p>Do not use the <code class="literal">localhost</code> domain for OpenAM, not even
  for testing purposes. OpenAM relies on browser cookies, which are returned
  based on domain name. Furthermore, use a domain name that contains at least 2
  <code class="literal">.</code> (dot) characters, such
  <code class="literal">openam.example.com</code>.</p><div class="important"><h3 class="title">Important</h3><p>
   Do not configure a top-level domain as your cookie domain as browsers will
   reject them.
   </p><p>
   Top-level domains are browser-specific.
    Some browsers, like Firefox, also consider special domains like Amazon's web
    service (for example, ap-southeast-2.compute.amazonaws.com) to be a top-level domain.
   </p><p>
    Check the effective top-level domain list at
    <a class="link" href="https://publicsuffix.org/list/effective_tld_names.dat" target="_blank"><em class="citetitle">https://publicsuffix.org/list/effective_tld_names.dat</em></a>
    to ensure that you do not set your cookie to a domain in the list.
  </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="prepare-java"></a>1.2.&nbsp;Preparing a Java Environment</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="chap-prepare-install.html#prepare-java-sun">1.2.1. Settings For Sun/Oracle Java Environments</a></span></dt><dt><span class="section"><a href="chap-prepare-install.html#prepare-java-ibm">1.2.2. Settings For IBM Java Environments</a></span></dt></dl></div><a class="indexterm" name="d0e363"></a><p>OpenAM software depends on a Java runtime environment. Check the output
  of <span class="command"><strong>java -version</strong></span> to make sure your the version is supported
  according to the <em class="citetitle">Release Notes</em> section on <a href="../../release-notes/index/chap-before-you-install.html#java-requirements" class="link"><em class="citetitle">Java
  Requirements</em></a>.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="prepare-java-sun"></a>1.2.1.&nbsp;Settings For Sun/Oracle Java Environments</h3></div></div></div><a class="indexterm" name="d0e385"></a><div class="variablelist"><p>When using a Sun or Oracle Java environment set at least the
    following options.</p><dl class="variablelist"><dt><span class="term"><code class="literal">-server</code></span></dt><dd><p>Use <code class="literal">-server</code> rather than
      <code class="literal">-client</code>.</p></dd><dt><span class="term"><code class="literal">-XX:MaxPermSize=256m</code></span></dt><dd><p>Set the permanent generation size to 256 MB.</p></dd><dt><span class="term"><code class="literal">-Xmx1024m</code> (minimum)</span></dt><dd><p>OpenAM requires at least a 1 GB heap. If you are including the embedded
      OpenDJ directory, OpenAM requires at least a 2 GB heap, as 50% of that space
      is allocated to OpenDJ. Higher volume and higher performance
      deployments require additional heap space.</p></dd></dl></div><p>For additional JVM tuning recommendations, see <a href="../../admin-guide/index/chap-tuning.html#tuning-jvm-for-openam" class="link"><em class="citetitle">Java Virtual
   Machine Settings</em></a>.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="prepare-java-ibm"></a>1.2.2.&nbsp;Settings For IBM Java Environments</h3></div></div></div><a class="indexterm" name="d0e430"></a><div class="variablelist"><p>When using an IBM Java environment set at least the following
    options.</p><dl class="variablelist"><dt><span class="term"><code class="literal">-DamCryptoDescriptor.provider=IBMJCE</code>, </span><span class="term"><code class="literal">-DamKeyGenDescriptor.provider=IBMJCE</code></span></dt><dd><p>Use the IBM Java Cryptography Extensions.</p></dd><dt><span class="term"><code class="literal">-Xmx1024m</code> (minimum)</span></dt><dd><p>OpenAM requires at least a 1 GB heap. If you are including the embedded
      OpenDJ directory, OpenAM requires at least a 2 GB heap, as 50% of that space
      is allocated to OpenDJ. Higher volume and higher
      performance deployments require additional heap space.</p></dd></dl></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="prerequisites-file-descriptors"></a>1.3.&nbsp;Setting Maximum File Descriptors</h2></div></div></div><a class="indexterm" name="d0e459"></a><a class="indexterm" name="d0e464"></a><p>
   If you use the embedded OpenDJ directory, make sure OpenDJ has enough
   file descriptors. OpenDJ needs to be able to open many files,
   especially when handling many client connections.

   Linux systems in particular often set a limit of 1024 per user,
   which is too low for OpenDJ.
  </p><p>
   OpenDJ should have access to use at least 64K (65536) file descriptors.
   The embedded OpenDJ directory runs inside the OpenAM process space.

   When running OpenAM as user <code class="literal">openam</code> on a Linux system
   that uses <code class="filename">/etc/security/limits.conf</code> to set user limits,
   you can set soft and hard limits by adding these lines to the file.
  </p><pre class="brush: plain;">
openam soft nofile 65536
openam hard nofile 131072
  </pre><div class="screen"><pre>
$ <strong>ulimit -n</strong>
<em>65536</em></pre></div><p>
   The example above assumes the system has enough file descriptors overall.

   You can verify the new soft limit the next time you log in as user
   <code class="literal">openam</code> with the <span class="command"><strong>ulimit -n</strong></span> command.
  </p><p>
   You can check the Linux system overall maximum as follows.
  </p><div class="screen"><pre>
$ <strong>cat /proc/sys/fs/file-max</strong>
<em>204252</em>
  </pre></div><div class="orderedlist"><p>
    If the overall maximum is too low, you can increase it as follows.
   </p><ol class="orderedlist" type="1"><li class="listitem"><p>
    As superuser, edit <code class="filename">/etc/sysctl.conf</code> to set
    the kernel parameter <code class="literal">fs.file-max</code> to a higher maximum.
   </p></li><li class="listitem"><p>
    Run the <span class="command"><strong>sysctl -p</strong></span> command to reload
    the settings in <code class="filename">/etc/sysctl.conf</code>.
   </p></li><li class="listitem"><p>
    Read <code class="filename">/proc/sys/fs/file-max</code> again to confirm
    that it now corresponds to the new maximum.
   </p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="prepare-identity-repository"></a>1.4.&nbsp;Preparing an Identity Repository</h2></div></div></div><a class="indexterm" name="d0e535"></a><a class="indexterm" name="d0e542"></a><p>OpenAM stores user identity data in one or more identity repositories.
   In many deployments OpenAM connects to existing LDAP directory services
   for user identity data. OpenAM is designed therefore to share data in an
   identity repository with other applications.</p><p>OpenAM ships with an embedded OpenDJ directory server that you can
   install as part of the OpenAM configuration process. In deployments where you
   will only ever have a few users to manage and do not need to share identity
   data with other applications, you can use the embedded store as your identity
   repository and avoid the additional overhead of maintaining a separate
   directory service. If OpenAM will share identity data with other applications,
   or if you expect to have lots of users, then connect OpenAM to an external
   identity repository. See the <a href="../../release-notes/index/chap-before-you-install.html" class="link"><em class="citetitle">Release
    Notes</em></a> for a list of supported external identity
   repositories.</p><p>When OpenAM connects to an external identity repository, the
   administrator must give OpenAM the following access rights.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>OpenAM requires specific directory schema definitions for the object
     classes and attribute types that describe its data. The directory
     administrator can find these definitions in the <code class="filename">ldif</code>
     directory found inside the full .zip delivery.</p><p>If the directory administrator chooses instead to have OpenAM update
     the directory schema at configuration time, then the directory administrator
     must grant OpenAM access.</p><p>To grant this access right with OpenDJ for example, first add a global
     ACI permitting the OpenAM user to modify schema definitions as in the
     following example where the OpenAM entry has DN
     <code class="literal">uid=openam,ou=admins,dc=example,dc=com</code>.</p><pre class="brush: ldif;">
global-aci: (target = "ldap:///cn=schema")(targetattr = "attributeTypes ||
   objectClasses")(version 3.0;acl "Modify schema"; allow (write)(userdn = "
   ldap:///uid=openam,ou=admins,dc=example,dc=com");)</pre><p>Also give the OpenAM user privileges to modify the schema and write
     to subentries such as the schema entry. Set the following attributes on
     the OpenAM user entry.</p><pre class="brush: ldif;">
ds-privilege-name: subentry-write
ds-privilege-name: update-schema</pre></li><li class="listitem"><p>Allow OpenAM to read directory schema.</p><p>With OpenDJ for example, keep the default "User-Visible Schema
     Operational Attributes" global ACI.</p></li><li class="listitem"><p>When OpenAM connects to an external identity repository, it requires
     access to read and potentially to update data.</p><p>To grant the access rights with OpenDJ for example, add following ACIs
     to the configuration base DN entry. Adjust them as necessary if the OpenAM
     user DN differs from
     <code class="literal">uid=openam,ou=admins,dc=example,dc=com</code>.</p><pre class="brush: ldif;">
aci: (targetattr="* || aci")(version 3.0;acl "Allow identity modification";
   allow (write)(userdn = "ldap:///uid=openam,ou=admins,dc=example,dc=com");)
aci: (targetattr!="userPassword||authPassword")(version 3.0;
   acl "Allow identity search"; allow (search, read)(userdn = "ldap:///
   uid=openam,ou=admins,dc=example,dc=com");)
aci: (targetcontrol="2.16.840.1.113730.3.4.3")(version 3.0;acl "Allow
   persistent search"; allow (search, read)(userdn = "ldap:///
   uid=openam,ou=admins,dc=example,dc=com");)
aci: (version 3.0;acl "Add identity"; allow (add)(userdn = "ldap:///
   uid=openam,ou=admins,dc=example,dc=com");)
aci: (version 3.0;acl "Delete identity"; allow (delete)(userdn = "ldap:///
   uid=openam,ou=admins,dc=example,dc=com");)
    </pre></li><li class="listitem"><p>Allow the OpenAM user to reset other users' passwords.</p><p>To grant this privilege in OpenDJ for example, set the following
     attribute on the OpenAM user entry.</p><pre class="brush: ldif;">
ds-privilege-name: password-reset</pre></li></ul></div><p>In addition for external directory services, the directory administrator
   should index the following attributes used by OpenAM.</p><div class="table"><a name="prepare-identity-repository-indexes"></a><div class="table-title">Table&nbsp;1.1.&nbsp;Identity Repository Indexes</div><div class="table-contents"><table summary="Identity Repository Indexes" border="0"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th>Attribute</th><th>Indexes Required</th></tr></thead><tbody><tr><td><code class="literal">iplanet-am-user-federation-info-key</code></td><td>equality</td></tr><tr><td><code class="literal">sun-fm-saml2-nameid-infokey</code></td><td>equality</td></tr></tbody></table></div></div><br class="table-break"></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="prepare-configuration-store"></a>1.5.&nbsp;Preparing an External Configuration Data Store</h2></div></div></div><a class="indexterm" name="d0e630"></a><a class="indexterm" name="d0e637"></a><p>
   OpenAM stores its configuration, session, and token data in an LDAP
   directory service. OpenAM ships with an embedded OpenDJ directory server
   that you can install as part of the OpenAM configuration process.
   By default, OpenAM installs the embedded directory server alongside its
   configuration settings under the $HOME directory of the user running OpenAM
   and runs the embedded directory server in the same JVM memory space as OpenAM.
  </p><p>
   With the embedded OpenDJ directory and the default configuration
   settings, OpenAM connects as directory super user, bypassing access control
   evaluation because OpenAM manages the directory as its private store. Be aware
   that failover and replication cannot be controlled when using the embedded store.
  </p><p>
   Before deploying OpenAM in production, measure the impact of
   using the embedded directory not only for relatively static configuration
   data, but also for volatile session and token data. Your tests should subject
   OpenAM to the same load patterns you expect in production. If it looks like
   a better choice to use an external directory service, then use one of the
   supported external configuration stores listed in the
   <a href="../../release-notes/index/chap-before-you-install.html" class="link"><em class="citetitle">Release
    Notes</em></a>, such as OpenDJ.
  </p><p>
   OpenAM supports the Core Token Service (CTS),
   a centralized token repository for OpenAM session tokens, OpenID Connect ID tokens, and
   SAML 2.0 tokens, which can be stored in a locally embedded or external
   directory store together or separately from OpenAM configuration data. For more information,
   see the chapter on <a href="../../install-guide/index/chap-cts.html" class="link">
    <em class="citetitle">Configuring the Core Token Service</em></a>.
  </p><div class="tip"><h3 class="title">Tip</h3><p>
    If you are the directory administrator and do not yet know directory services
    very well, take some time to read the documentation for your directory server,
    especially the sections covering directory schema and procedures on how
    to configure access to directory data.
   </p></div><div class="procedure"><a name="install-prepare-opendj-external-config-store"></a><div class="procedure-title">Procedure&nbsp;1.1.&nbsp;To Install an External OpenDJ Directory Server</div><a class="indexterm" name="idx-ext-opendj"></a><p>
     The following example procedure shows how to prepare a single OpenDJ
     directory server instance as an external configuration data store.
     The OpenDJ instance implements a single backend for the OpenAM
     configuration data.
     The procedure assumes that you have also prepared an external identity repository
     and an external CTS store,
     separate from the configuration data store.
    </p><ol class="procedure" type="1"><li class="step"><p>
      Prepare your OpenDJ installation, then download the OpenDJ software.
      See the OpenDJ documentation about
      <a class="link" href="http://docs.forgerock.org/en/opendj/2.6.0/install-guide/index.html#chap-install-cli" target="_blank">
            Installing OpenDJ From the Command Line</a>.
     </p><div class="screen"><pre>
$ <strong>cd /path/to/opendj</strong>
$ <strong>./setup --cli</strong>
     </pre></div><p>Example options are as follows:</p><div class="table"><a name="prepare-configuration-store-ds"></a><div class="table-title">Table&nbsp;1.2.&nbsp;Example OpenDJ Setup Parameters</div><div class="table-contents"><table summary="Example OpenDJ Setup Parameters" border="0"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th>Parameter</th><th>Example Inputs</th></tr></thead><tbody><tr><td><code class="literal">Accept License</code></td><td>Yes</td></tr><tr><td><code class="literal">Root User DN</code></td><td>cn=Directory Manager</td></tr><tr><td><code class="literal">Root User DN Password</code></td><td>(arbitrary)</td></tr><tr><td><code class="literal">Fully Qualified Domain Name</code></td><td>opendj.example.com</td></tr><tr><td><code class="literal">LDAP Port</code></td><td>1389</td></tr><tr><td><code class="literal">Administration Connector Port</code></td><td>4444</td></tr><tr><td><code class="literal">Create Base DN</code></td><td>No. This will be created in a later step.</td></tr><tr><td><code class="literal">Enable SSL</code></td><td>If you choose this option, make sure that
          OpenAM can trust the OpenDJ certificate.</td></tr><tr><td><code class="literal">Enable TLS</code></td><td>If you choose this option, make sure that
          OpenAM can trust the OpenDJ certificate.</td></tr><tr><td><code class="literal">Start Server After Config</code></td><td>Yes</td></tr></tbody></table></div></div><br class="table-break"></li><li class="step"><p>
      Change to the OpenDJ directory.
     </p><div class="screen"><pre>
$ <strong>cd /path/to/opendj</strong>
     </pre></div></li><li class="step"><p>
      Create a directory server backend, and call it <code class="literal">cfgStore</code>.
     </p><div class="screen"><pre>
$ <strong>bin/dsconfig create-backend \
  --backend-name cfgStore \
  --set base-dn:dc=example,dc=com \
  --set enabled:true \
  --type local-db \
  --port 4444 \
  --bindDN "cn=Directory Manager" \
  --bindPassword pwd \
  --no-prompt</strong>
     </pre></div></li><li class="step"><p>
      Create an LDIF file to add the initial entries for the
      configuration store, and save the file as
      <code class="literal">add-config-entries.ldif</code>.
      The entries include the base DN suffix, an organizational unit entry,
      and the OpenAM user entry needed to access the directory service.
     </p><p>
      When OpenAM connects as <code class="literal">uid=openam,ou=admins,dc=example,dc=com</code>
      to an external directory server to store its data, it requires both read
      and write access privileges. You add these privileges by means of access control
      instructions (ACIs) to the base distinguished name (DN) entry
      (<code class="literal">dc=example,dc=com</code>). If your OpenAM user has a different
      DN other than <code class="literal">uid=openam,ou=admins,dc=example,dc=com</code>,
      adjust the ACIs where appropriate.
     </p><p>
      You must also give privileges to the OpenAM user to modify the schema and write
      to subentries such as the schema entry. To grant these privileges, you include
      the following attributes on the OpenAM user entry:
      <code class="literal">ds-privilege-name: subentry-write</code> and
      <code class="literal">ds-privilege-name: update-schema</code>.
     </p><p>
      Note that if you are having trouble with this LDIF file,
      consider removing the line feeds for the ACI attributes
      and let it wrap to the next line. If you are still having trouble using
      the <span class="command"><strong>ldapmodify</strong></span>, you can use the
      <span class="command"><strong>import-ldif</strong></span> command although you may have to re-apply
      the <code class="literal">targetcontrol</code> ACI attribute.
     </p><pre class="brush: ldif;">
dn: dc=example,dc=com
objectclass: top
objectclass: domain
dc: example
aci: (targetattr="*")(version 3.0;acl "Allow entry search"; allow (
 search, read)(userdn = "ldap:///uid=openam,ou=admins,dc=example,dc=com");)
aci: (targetattr="*")(version 3.0;acl "Modify config entry"; allow (write)(
 userdn = "ldap:///uid=openam,ou=admins,dc=example,dc=com");)
aci: (targetcontrol="2.16.840.1.113730.3.4.3")(version 3.0;acl "Allow
 persistent search"; allow (search, read)(userdn = "ldap:///uid=openam
 ,ou=admins,dc=example,dc=com");)
aci: (version 3.0;acl "Add config entry"; allow (add)(userdn = "ldap:///
 uid=openam,ou=admins,dc=example,dc=com");)
aci: (version 3.0;acl "Delete config entry"; allow (delete)(userdn = "ldap:///
 uid=openam,ou=admins,dc=example,dc=com");)

dn: ou=admins,dc=example,dc=com
objectclass: top
objectclass: organizationalUnit
ou: admins

dn: uid=openam,ou=admins,dc=example,dc=com
objectclass: top
objectclass: person
objectclass: organizationalPerson
objectclass: inetOrgPerson
cn: openam
sn: openam
uid: openam
userPassword: secret12
ds-privilege-name: subentry-write
ds-privilege-name: update-schema
     </pre></li><li class="step"><p>
      Add the initial entries LDIF file using the
      <code class="literal">ldapmodify</code> command.
     </p><div class="screen"><pre>
$ <strong>bin/ldapmodify \
  --port 4444 \
  --bindDN "cn=Directory Manager" \
  --bindPassword pwd \
  &#8212;-defaultAdd \
  --useSSL \
  --trustAll \
  &#8212;-filename add-config-entries.ldif</strong>
     </pre></div></li><li class="step"><p>
      Add the Global Access Control Instruction (ACI) to the access control handler.
      The Global ACI gives OpenAM the privileges to modify the schema definitions
      for the custom configuration where the OpenAM entry has DN
      <code class="literal">uid=openam,ou=admins,dc=example,dc=com</code>.
     </p><div class="note"><h3 class="title">Note</h3><p>These access rights are only required during configuration, and only
       if the directory administrator does not add the OpenAM directory schema
       definitions manually.</p></div><p>
      If you are having difficulty successfully adding the <code class="literal">global-aci</code>
      attribute, try doing so without any line breaks.
     </p><div class="screen"><pre>
$ <strong>bin/dsconfig \
   set-access-control-handler-prop \
    --add global-aci:'(target = "ldap:///cn=schema")(targetattr = "attributeTypes || \
      objectClasses")(version 3.0; acl "Modify schema"; allow (write) \
      (userdn = "ldap:///uid=openam,ou=admins,dc=example,dc=com");)' \
    --port 4444 \
    --bindDN "cn=Directory Manager" \
    --bindPassword pwd \
    --trustAll \
    --no-prompt</strong>
     </pre></div></li><li class="step"><p>At this point, install the OpenAM server if you haven't done so
      already. For details,
      see <a href="../../install-guide/index/chap-install-core.html" class="link"><em class="citetitle">Installing OpenAM Core Services</em></a>.
     </p></li><li class="step"><p>
      OpenAM requires specific directory schema definitions for the object
      classes and attribute types that describe its data. For the configuration
      store, the directory administrator should let OpenAM update the directory
      schema at configuration time.
     </p><p>
      Copy the schema files, located at
      <code class="literal">/path/to/tomcat/webapps/openam/WEB-INF/template/ldif/sfha</code>
      to a local file, <code class="literal">cts-add-schema.ldif</code>.
     </p><div class="screen"><pre>
$ <strong>cp /path/to/tomcat/webapps/openam/WEB-INF/template/ldif/sfha/cts-add-schema.ldif /tmp/ldif</strong>
     </pre></div></li><li class="step"><p>
      Add the schema to the directory server.
     </p><div class="screen"><pre>
$ <strong>bin/ldapmodify \
  --port 4444 \
  --bindDN "cn=Directory Manager" \
  --bindPassword pwd \
  --useSSL \
  --trustAll \
  --fileName cts-add-schema.ldif</strong>
     </pre></div></li><li class="step"><p>
      OpenAM uses certain attributes to search for configuration data. You must
      set some indexes on these attributes for the configuration store.
     </p><div class="table"><a name="prepare-configuration-store-indexes"></a><div class="table-title">Table&nbsp;1.3.&nbsp;Configuration Data Store Indexes</div><div class="table-contents"><table summary="Configuration Data Store Indexes" border="0"><colgroup><col width="66%"><col width="34%"></colgroup><thead><tr><th>Attribute</th><th>Indexes Required</th></tr></thead><tbody><tr><td><code class="literal">iplanet-am-user-federation-info-key</code></td><td>equality</td></tr><tr><td><code class="literal">sun-fm-saml2-nameid-infokey</code></td><td>equality</td></tr><tr><td><code class="literal">sunxmlkeyvalue</code></td><td>equality, substring</td></tr></tbody></table></div></div><br class="table-break"><p>
      On the OpenDJ directory server, use <code class="literal">dsconfig</code> to add
      these indexes to your external configuration store. Repeat for each
      attribute in <a class="xref" href="chap-prepare-install.html#prepare-configuration-store-indexes" title="Table&nbsp;1.3.&nbsp;Configuration Data Store Indexes">Table&nbsp;1.3, &#8220;Configuration Data Store Indexes&#8221;</a>.
     </p><div class="screen"><pre>
$ <strong>bin/dsconfig \
   create-local-db-index \
   --port 4444 \
   --hostname opendj.example.com \
   --bindDN "cn=Directory Manager" \
   --bindPassword password \
   --backend-name cfgstore \
   --index-name iplanet-am-user-federation-info-key \
   --set index-type:equality \
   --trustAll \
   --no-prompt</strong>
     </pre></div></li><li class="step"><p>
      Rebuild the indexes using the <code class="literal">rebuild-index</code> command.
      You can stop the server and run <code class="literal">rebuild-index</code> in offline
      mode, or you can run <code class="literal">rebuild-index</code> online
      using a task as follows:
     </p><div class="screen"><pre>
$ <strong>bin/rebuild-index --port 4444 --hostname opendj.example.com \
  --bindDN "cn=Directory Manager" --bindPassword password \
  --baseDN dc=example,dc=com --rebuildAll \
  --start 0</strong>
     </pre></div></li><li class="step"><p>
      Verify the indexes.
     </p><div class="screen"><pre>
$ <strong>bin/verify-index --baseDN dc=example,dc=com</strong>
     </pre></div><p>
      You have successfully installed and prepared the directory server for an
      external configuration store. When installing the OpenAM server,
      you need to specify the host name, port and root suffix
      of the external directory server on the Configuration Data Store Settings
      screen of the OpenAM Configurator.
      See <a href="../../install-guide/index/chap-install-core.html#configure-openam-custom" class="link">
      <em class="citetitle">To Configure OpenAM</em></a> for more
      information.
     </p></li></ol></div><a class="indexterm" name="d0e963"></a></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="download-openam-software"></a>1.6.&nbsp;Obtaining OpenAM Software</h2></div></div></div><a class="indexterm" name="d0e973"></a><p>Download OpenAM releases from one of the following locations:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="http://forgerock.com/download-stack/" target="_blank"><em class="citetitle">Enterprise Downloads</em></a> has the latest stable version of OpenAM, including
     a <code class="filename">.zip</code> file with all of the OpenAM components, the
     <code class="filename">.war</code> file, OpenAM tools, the configurator, policy
     agents, OpenIG, and documentation. Make sure you review the Software License and 
     Subscription Agreement presented before you download OpenAM files.</p></li><li class="listitem"><p><a class="link" href="http://forgerock.org/openam.html" target="_blank"><em class="citetitle">Builds</em></a> has the nightly build, including a <code class="filename">.zip</code> 
     file with all of the OpenAM components, the <code class="filename">.war</code> file, 
     OpenAM tools, the configurator, policy agents, and the .NET Fedlet. Be
     aware that this is the working version of the trunk and should not be 
     used in a production environment.</p></li><li class="listitem"><p><a class="link" href="http://forgerock.org/openam-archive.html" target="_blank"><em class="citetitle">Archives</em></a> has old versions of OpenAM and
     policy agents. It includes the full <code class="filename">.zip</code> file with all
     of the OpenAM components, the server <code class="filename">.war</code> file,
     OpenAM tools, the configurator, policy agents,  the WSS policy agents, and
     the .NET Fedlet for all previous releases.</p></li></ul></div><p>For each release of the OpenAM core services, you can download the
  entire package as a <code class="filename">.zip</code> file, only the OpenAM 
  <code class="filename">.war</code> file, or only the administrative tools as a 
  <code class="filename">.zip</code> archive. The Archives also have only the 
  OpenAM source code used to build the release.</p><p>After you download the <code class="filename">.zip</code> file, create a new 
  openam folder, and unzip the <code class="filename">.zip</code> file to access the content:</p><div class="screen"><pre>
$ <strong>cd ~/Downloads</strong>
$ <strong>mkdir openam ; cd openam</strong>
$ <strong>unzip ~/Downloads/OpenAM-12.0.0.zip</strong>
  </pre></div><div class="variablelist"><p>When you unzip the archive of the entire package, you get ldif, license, and 
   legal directories in addition to the following files.</p><dl class="variablelist"><dt><span class="term"><code class="filename">ClientSDK-12.0.0.jar</code></span></dt><dd><p>The OpenAM Java client SDK library</p></dd><dt><span class="term"><code class="filename">ExampleClientSDK-CLI-12.0.0.zip</code></span></dt><dd><p>The .zip file containing the Java client SDK command-line examples,
     and .jar files needed to run the examples</p></dd><dt><span class="term"><code class="filename">ExampleClientSDK-WAR-12.0.0.war</code></span></dt><dd><p>The .war file containing Java client SDK examples in a web
     application</p></dd><dt><span class="term"><code class="filename">IDPDiscovery-12.0.0.war</code></span></dt><dd><p>The IDP discovery .war file, deployed as a service to service
     providers that must discover which identity provider corresponds to a
     SAML 2.0 request</p><p>For details, see <a href="../../admin-guide/index/chap-federation.html#deploy-idp-discovery" class="link"><em class="citetitle">Deploying the Identity Provider Discovery Service</em></a>.</p></dd><dt><span class="term"><code class="filename">Fedlet-12.0.0.zip</code></span></dt><dd><p>The .zip that contains the lightweight service provider
    implementations that you can embed in your Java EE or ASP.NET applications
    to enable it to use federated access management</p></dd><dt><span class="term"><code class="filename">OpenAM-12.0.0.war</code></span></dt><dd><p>The deployable .war file</p></dd><dt><span class="term"><code class="filename">OpenAM-DistAuth-12.0.0.war</code></span></dt><dd><p>The deployable .war file for distributed authentication</p></dd><dt><span class="term"><code class="filename">OpenAM-ServerOnly-12.0.0.war</code></span></dt><dd><p>The deployable .war file when you want to deploy OpenAM
    server without the OpenAM console</p></dd><dt><span class="term"><code class="filename">SSOAdminTools-12.0.0.zip</code></span></dt><dd><p>The .zip file that contains tools to manage OpenAM from 
    the command line</p></dd><dt><span class="term"><code class="filename">SSOConfiguratorTools-12.0.0.zip</code></span></dt><dd><p>The .zip file that contains tools to configure OpenAM from 
    the command line</p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="enable-cors-support"></a>1.7.&nbsp;Enabling CORS Support</h2></div></div></div><a class="indexterm" name="d0e1130"></a><p>
   Cross-origin resource sharing (CORS) allows requests
   to be made across domains from user agents.
   OpenAM supports CORS, but CORS is not configured out of the box.
  </p><div class="orderedlist"><p>
    Instead, you must edit the deployment descriptor file
    before deploying OpenAM.
    CORS support is implemented as a Servlet filter,
    and so you add the filter's configuration to the deployment descriptor file.
   </p><ol class="orderedlist" type="1"><li class="listitem"><p>
     Unpack the OpenAM .war file.
    </p><div class="screen"><pre>
$ <strong>mkdir /tmp/openam</strong>
$ <strong>cd /tmp/openam/</strong>
$ <strong>jar -xf ~/Downloads/openam/OpenAM-12.0.0.war</strong>
    </pre></div></li><li class="listitem"><p>
     Edit the deployment descriptor file, <code class="filename">WEB-INF/web.xml</code>,
     to add a CORS filter configuration.
    </p><p>
     First, add a <code class="literal">&lt;filter-mapping&gt;</code> element
     to name the filter and to indicate the URL pattern for the filter.
     The URL pattern matches the endpoints for which to support CORS.
     The following example adds CORS support for all OpenAM endpoints.
    </p><pre class="brush: xml;">
&lt;filter-mapping&gt;
    &lt;filter-name&gt;CORSFilter&lt;/filter-name&gt;
    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;&lt;!-- CORS support for all endpoints --&gt;
&lt;/filter-mapping&gt;
</pre><p>
     Next, add a <code class="literal">&lt;filter&gt;</code> element
     to configure the filter.
     The following excerpt describes and demonstrates
     all of the required and optional configuration parameters.
    </p><pre class="brush: xml;">
&lt;filter&gt;
    &lt;filter-name&gt;CORSFilter&lt;/filter-name&gt;
    &lt;filter-class&gt;org.forgerock.openam.cors.CORSFilter&lt;/filter-class&gt;
    &lt;init-param&gt;
        &lt;description&gt;
            Accepted Methods - (Required) -
            A list of HTTP methods for which to accept CORS requests
        &lt;/description&gt;
        &lt;param-name&gt;methods&lt;/param-name&gt;
        &lt;param-value&gt;POST,PUT&lt;/param-value&gt;
    &lt;/init-param&gt;
    &lt;init-param&gt;
        &lt;description&gt;
            Accepted Origins - (Required) -
            A list of origins from which to accept CORS requests
        &lt;/description&gt;
        &lt;param-name&gt;origins&lt;/param-name&gt;
        &lt;param-value&gt;www.example.net,example.org&lt;/param-value&gt;
    &lt;/init-param&gt;
    &lt;init-param&gt;
        &lt;description&gt;
            Allow Credentials - (Optional) -
            Whether to include the allow Vary (Origin)
            and Access-Control-Allow-Credentials headers
            in the response [default false]
        &lt;/description&gt;
        &lt;param-name&gt;allowCredentials&lt;/param-name&gt;
        &lt;param-value&gt;true&lt;/param-value&gt;
    &lt;/init-param&gt;
    &lt;init-param&gt;
        &lt;description&gt;
            Allowed Headers - (Optional) -
            A list of HTTP headers which if included in the request
            DO NOT make it abort
        &lt;/description&gt;
        &lt;param-name&gt;headers&lt;/param-name&gt;
        &lt;param-value&gt;headerOne,headerTwo,headerThree&lt;/param-value&gt;
    &lt;/init-param&gt;
    &lt;init-param&gt;
        &lt;description&gt;
            Expected Hostname - (Optional) -
            The name of the host expected in the request Host header
        &lt;/description&gt;
        &lt;param-name&gt;expectedHostname&lt;/param-name&gt;
        &lt;param-value&gt;http://openam.example.com&lt;/param-value&gt;
    &lt;/init-param&gt;
    &lt;init-param&gt;
        &lt;description&gt;
            Exposed Headers - (Optional) -
            The list of headers which the user-agent can expose
            to its CORS client
        &lt;/description&gt;
        &lt;param-name&gt;exposeHeaders&lt;/param-name&gt;
        &lt;param-value&gt;exposeHeaderOne,exposeHeaderTwo&lt;/param-value&gt;
    &lt;/init-param&gt;
    &lt;init-param&gt;
        &lt;description&gt;
            Maximum Cache Age - (Optional) -
            The maximum time that the CORS client can cache
            the pre-flight response, in seconds [default 600]
        &lt;/description&gt;
        &lt;param-name&gt;maxAge&lt;/param-name&gt;
        &lt;param-value&gt;600&lt;/param-value&gt;
    &lt;/init-param&gt;
&lt;/filter&gt;
</pre><p>
     For details on CORS, see the
     <a class="link" href="http://www.w3.org/TR/cors/" target="_blank"><em class="citetitle">Cross-Origin Resource Sharing</em></a>
     specification.
    </p></li><li class="listitem"><p>
     Pack up the OpenAM .war file to deploy.
    </p><div class="screen"><pre>
$ <strong>jar -cf ../openam.war *</strong>
    </pre></div></li><li class="listitem"><p>Deploy the new .war file.</p><p>
     In this example the .war file to deploy is
     <code class="filename">/tmp/openam.war</code>.
    </p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="prepare-apache-tomcat"></a>1.8.&nbsp;Preparing Apache Tomcat</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="chap-prepare-install.html#d0e1239">1.8.1. Tuning Apache Multi-Processing Modules</a></span></dt></dl></div><a class="indexterm" name="d0e1199"></a><p>
   OpenAM examples often use Apache Tomcat as the deployment container.
   Tomcat is installed on <code class="literal">openam.example.com</code>,
   and listens on the default ports,
   with no Java Security Manager enabled.
  </p><p>
   OpenAM core services require a minimum JVM heap size of 1 GB,
   and a permanent generation size of 256 MB.
   If you are including the embedded OpenDJ directory,
   OpenAM requires at least a 2 GB heap,
   as 50% of that space is allocated to OpenDJ.
   See <a class="xref" href="chap-prepare-install.html#prepare-java" title="1.2.&nbsp;Preparing a Java Environment">Section&nbsp;1.2, &#8220;Preparing a Java Environment&#8221;</a> for details.
  </p><p>
   ForgeRock recommends that you edit the Tomcat &lt;Connector&gt; configuration
   to set <code class="literal">URIEncoding="UTF-8"</code>.
   UTF-8 URI encoding ensures that URL-encoded characters
   in the paths of URIs are correctly decoded by the container.
   This is particularly useful when applications use the OpenAM REST APIs,
   and some identifiers such as user names can contain special characters.
  </p><p>
   &lt;Connector&gt; configuration elements are found in the configuration file,
   <code class="filename">/path/to/tomcat/conf/server.xml</code>.
   The following excerpt shows an example &lt;Connector&gt;
   with the <code class="literal">URIEncoding</code> attribute set appropriately.
  </p><pre class="brush: xml;">
&lt;Connector port="8443" protocol="HTTP/1.1" SSLEnabled="true"
              maxThreads="150" scheme="https" secure="true"
              clientAuth="false" sslProtocol="TLS" URIEncoding="UTF-8" /&gt;
  </pre><p>
   The following example script, <code class="filename">/etc/init.d/tomcat</code>,
   manages the service at system startup and shutdown.
   This script assumes you run OpenAM as the user <code class="literal">openam</code>.
  </p><pre class="brush: shell;">
#!/bin/sh
#
# tomcat
#
# chkconfig: 345 95 5
# description: Manage Tomcat web application container
CATALINA_HOME="/path/to/tomcat"
export CATALINA_HOME
JAVA_HOME=/path/to/jdk
export JAVA_HOME
CATALINA_OPTS="-server -Xmx2048m -XX:MaxPermSize=256m"
export CATALINA_OPTS

case "${1}" in
start)
  /bin/su openam -c "${CATALINA_HOME}/bin/startup.sh"
  exit ${?}
  ;;
stop)
  /bin/su openam -c "${CATALINA_HOME}/bin/shutdown.sh"
  exit ${?}
  ;;
*)
  echo "Usage:  $0 { start | stop }"
  exit 1
  ;;
esac
  </pre><div lang="en" class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d0e1239"></a>1.8.1.&nbsp;Tuning Apache Multi-Processing Modules</h3></div></div></div><a class="indexterm" name="d0e1242"></a><a class="indexterm" name="d0e1247"></a><p>
  Apache 2.0 and later comes with Multi-Processing Modules (MPMs) that extend
  the basic functionality of a web server to support the wide variety of operating
  systems and customizations for a particular site.
 </p><p>
  The key area of performance tuning for Apache is
  to run in worker mode ensuring that they are enough processes and threads
  available to service the expected number of client requests. Apache performance
  is configured in the <code class="filename">conf/extra/http-mpm.conf</code> file.</p><p>
  The key properties in this file are <code class="literal">ThreadsPerChild</code> and
  <code class="literal">MaxClients</code>.
  Together the properties control the maximum number of concurrent requests that can
  be processed by Apache. The default configuration allows for 150 concurrent
  clients spread across 6 processes of 25 threads each.</p><div class="screen"><pre>
&lt;IfModule mpm_worker_module&gt;
   StartServers          2
   MaxClients          150
   MinSpareThreads      25
   MaxSpareThreads      75
   ThreadsPerChild      25
   MaxRequestsPerChild   0
&lt;/IfModule&gt;
 </pre></div><div class="important"><h3 class="title">Important</h3><p>
   For the policy agent notification feature, the <code class="literal">MaxSpareThreads</code>,
   <code class="literal">ThreadLimit</code> and <code class="literal">ThreadsPerChild</code> default values
   must <span class="emphasis"><em>not</em></span> be altered; otherwise
   the notification queue listener thread cannot be registered.
  </p><p>
   Any other values apart from these three in the worker MPM can be customized.
   For example, it is possible to use a combination of <code class="literal">MaxClients</code>
   and <code class="literal">ServerLimit</code> to achieve a high level of concurrent clients.
  </p></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="prepare-jboss-7"></a>1.9.&nbsp;Preparing OpenAM &amp; JBoss AS 7 / EAP 6</h2></div></div></div><a class="indexterm" name="d0e1298"></a><p>Some preparation is required to deploy OpenAM on JBoss AS 7 / EAP 6.</p><p>The following instructions provide guidance for both standalone and domain deployments.
    OpenAM must be able to store its configuration between restarts. The procedures listed here are
    workarounds for JBoss AS 7.1.2 / 7.1.3, and the corresponding versions of JBoss EAP (6.0.0, 6.0.1).
    Workarounds are also needed for JBoss EAP 6.1.0/6.1.1.
    To identify the versions of JBoss EAP that have been built from JBoss
    AS, see the following article on <a class="link" href="https://access.redhat.com/site/articles/112673" target="_blank"><em class="citetitle">JBoss Enterprise Application Platform Component Details</em></a>.</p><p>Once JBoss has been configured, you can then prepare OpenAM for deployment, by making a few changes
    to the contents of the OpenAM <code class="filename">.war</code> archive.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="chap-prepare-install.html#prep-jboss-710-711" title="Procedure&nbsp;1.2.&nbsp;To Prepare JBoss AS 7.1.0 / 7.1.1">Procedure&nbsp;1.2, &#8220;To Prepare JBoss AS 7.1.0 / 7.1.1&#8221;</a></p></li><li class="listitem"><p><a class="xref" href="chap-prepare-install.html#prep-jboss-600-601" title="Procedure&nbsp;1.3.&nbsp;Alternative Method: To Prepare JBoss EAP 6.0.0 and 6.0.1">Procedure&nbsp;1.3, &#8220;Alternative Method: To Prepare JBoss EAP 6.0.0 and 6.0.1&#8221;</a></p></li><li class="listitem"><p><a class="xref" href="chap-prepare-install.html#prep-jboss-61x" title="Procedure&nbsp;1.4.&nbsp;To Prepare JBoss EAP 6.1.0 and 6.1.1">Procedure&nbsp;1.4, &#8220;To Prepare JBoss EAP 6.1.0 and 6.1.1&#8221;</a></p></li><li class="listitem"><p><a class="xref" href="chap-prepare-install.html#prep-jboss-for-openam" title="Procedure&nbsp;1.5.&nbsp;To Prepare JBoss for OpenAM">Procedure&nbsp;1.5, &#8220;To Prepare JBoss for OpenAM&#8221;</a></p></li><li class="listitem"><p><a class="xref" href="chap-prepare-install.html#prep-openam-for-jboss" title="Procedure&nbsp;1.6.&nbsp;To Prepare OpenAM for JBoss">Procedure&nbsp;1.6, &#8220;To Prepare OpenAM for JBoss&#8221;</a></p></li></ul></div><div class="procedure"><a name="prep-jboss-710-711"></a><div class="procedure-title">Procedure&nbsp;1.2.&nbsp;To Prepare JBoss AS 7.1.0 / 7.1.1</div><p>For JBoss AS 7.1.0 / 7.1.1, you need to make changes to the <code class="filename">module.xml</code>
                file in the <code class="filename">/path/to/jboss/modules/sun/jdk/main</code> directory, as well as changes
                to a configuration file associated with JBoss standalone or domain modes.</p><ol class="procedure" type="1"><li class="step"><p>Stop JBoss</p></li><li class="step"><p>Update the <code class="filename">module.xml</code> file associated with the container. You can
                    find this file a directory such as <code class="filename">/path/to/jboss/modules/sun/jdk/main</code>.</p></li><li class="step"><p>In the same <code class="filename">module.xml</code> file, add the Sun x509 security module path
                    (<code class="literal">sun/security/x509</code>).</p><p>The following example shows an excerpt of the revised file for JBoss AS 7.1.0.</p><pre class="brush: xml;">&lt;path name="com/sun/security/auth"/&gt;
&lt;path name="com/sun/security/auth/login"/&gt;
&lt;path name="com/sun/security/auth/module"/&gt;
&lt;path name ="sun/security/x509"/&gt; &lt;!-- path added here --&gt;
&lt;path name="sun/misc"/&gt;</pre></li><li class="step"><p>When using <span class="command"><strong>ssoadm</strong></span> or the distributed
                    authentication service (DAS), also add the following path to the aforementioned
                    <code class="filename">module.xml</code> file.</p><pre class="literallayout">&lt;path name="com/sun/org/apache/xerces/internal/dom" /&gt;</pre></li><li class="step"><a name="jboss711-disable-conflicts"></a><p>Disable modules that conflict with OpenAM REST libraries. All jaxrs
                    references need to be removed from the configuration. The file that you modify
                    depends on whether you are running JBoss in standalone or domain mode.</p><ul class="stepalternatives">
                    <li class="step"><p>The following example is based on JBoss 7.1.0 standalone mode. Remember to
                            remove all subsystems and extension tags associated with <code class="literal">urn:jboss:domain:jaxrs:1.0</code>.</p><div class="screen"><pre>
$ <strong>vi /path/to/jboss/standalone/configuration/standalone.xml</strong>
<em>&lt;extension module="org.jboss.as.ejb3"/&gt;
-  &lt;extension module="org.jboss.as.jaxrs"/&gt;
....
-  &lt;subsystem xmlns="urn:jboss:domain:jaxrs:1.0"/&gt;
&lt;subsystem xmlns="urn:jboss:domain:jca:1.1"&gt;</em>
                        </pre></div></li>
                    <li class="step"><p>The following example is based on JBoss 7.1.0 for a managed domain.</p><div class="screen"><pre>
$ <strong>vi /path/to/jboss7/domain/configuration/domain.xml</strong>
<em>&lt;extension module="org.jboss.as.ejb3"/&gt;
-  &lt;extension module="org.jboss.as.jaxrs"/&gt;
....
-  &lt;subsystem xmlns="urn:jboss:domain:jaxrs:1.0"/&gt;
&lt;subsystem xmlns="urn:jboss:domain:jca:1.1"&gt;</em>
                        </pre></div></li>
                </ul></li><li class="step"><a name="jboss711-delete-webservices"></a><p>In either the <code class="filename">standalone.xml</code> or <code class="filename">domain.xml</code>
                    files, you will also need to delete <code class="literal">org.jboss.as.webservices</code> references.
                    Depending on the file, this includes one or more groups of <code class="literal">subsystem</code> lines
                    such as:</p><pre class="brush: xml;">
&lt;subsystem xmlns="urn:jboss:domain:webservices:1.1"/&gt;
....
&lt;/subsystem&gt;
                </pre></li><li class="step"><p>You are now ready to prepare OpenAM as described in <a class="xref" href="chap-prepare-install.html#prep-openam-for-jboss" title="Procedure&nbsp;1.6.&nbsp;To Prepare OpenAM for JBoss">Procedure&nbsp;1.6, &#8220;To Prepare OpenAM for JBoss&#8221;</a>.</p></li></ol></div><div class="procedure"><a name="prep-jboss-600-601"></a><div class="procedure-title">Procedure&nbsp;1.3.&nbsp;Alternative Method: To Prepare JBoss EAP 6.0.0 and 6.0.1</div><a class="indexterm" name="d0e1439"></a><a class="indexterm" name="d0e1444"></a><p>JBoss EAP 6.0.0 and 6.0.1 are built from JBoss AS 7.1.2 and 7.1.3, respectively. The same techniques
                described in the <a class="xref" href="chap-prepare-install.html#prep-jboss-710-711" title="Procedure&nbsp;1.2.&nbsp;To Prepare JBoss AS 7.1.0 / 7.1.1">Procedure&nbsp;1.2, &#8220;To Prepare JBoss AS 7.1.0 / 7.1.1&#8221;</a> section work here as well. One alternative
                method is available, as described in this section.</p><ol class="procedure" type="1"><li class="step"><p>Stop JBoss.</p></li><li class="step"><p>Update the <code class="filename">openam.war</code> before deploying OpenAM.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Create a temporary directory and expand the <code class="filename">openam.war</code>.</p><div class="screen"><pre>
$ <strong>mkdir /tmp/openam ; cd /tmp/openam</strong>
$ <strong>jar xvf /path/to/OpenAM-12.0.0.war</strong>
                        </pre></div></li><li class="listitem"><p>Create a new <code class="filename">jboss-deployment-structure.xml</code> file in the
                            <code class="filename">WEB-INF</code> subdirectory so that it appears as follows, and save
                            the change.</p><pre class="brush: xml;">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
 &lt;jboss-deployment-structure xmlns="urn:jboss:deployment-structure:1.2"&gt;
  &lt;deployment&gt;
   &lt;exclusions&gt;
    &lt;module name="sun.jdk" /&gt;
   &lt;/exclusions&gt;
   &lt;exclude-subsystems&gt;
    &lt;subsystem name="jaxrs" /&gt;
    &lt;subsystem name="webservices" /&gt;
   &lt;/exclude-subsystems&gt;
  &lt;dependencies&gt;
   &lt;module name="sun.jdk" &gt;
    &lt;imports&gt;
     &lt;exclude-set&gt;
&lt;path name="com/sun/org/apache/xml/internal/security/transforms/implementations"/&gt;
     &lt;/exclude-set&gt;
    &lt;/imports&gt;
   &lt;/module&gt;
   &lt;system&gt;
    &lt;paths&gt;
     &lt;path name="sun/security/x509" /&gt;
     &lt;path name="com/sun/org/apache/xpath/internal" /&gt;
     &lt;path name="com/sun/org/apache/xerces/internal/dom" /&gt;
     &lt;path name="com/sun/org/apache/xml/internal/utils" /&gt;
    &lt;/paths&gt;
   &lt;/system&gt;
  &lt;/dependencies&gt;
 &lt;/deployment&gt;
&lt;/jboss-deployment-structure&gt;</pre></li><li class="listitem"><p>Rebuild the <code class="filename">openam.war</code> file.</p><div class="screen"><pre>
$ <strong>jar cvf ../openam.war *</strong>
                     </pre></div></li></ol></div></li><li class="step"><p>You will want to make at least one more change to the <code class="filename">openam.war</code> file before
                    deployment, as described in <a class="xref" href="chap-prepare-install.html#prep-openam-for-jboss" title="Procedure&nbsp;1.6.&nbsp;To Prepare OpenAM for JBoss">Procedure&nbsp;1.6, &#8220;To Prepare OpenAM for JBoss&#8221;</a>.</p></li><li class="step"><p>You do not need to make any of the other changes to XML files described in this section.
                    As JBoss EAP 6.0.0 and 6.0.1 was built from JBoss AS 7.1.2 and AS 7.1.3, respectively, this
                    procedure may also work on those versions of JBoss.</p></li></ol></div><div class="procedure"><a name="prep-jboss-61x"></a><div class="procedure-title">Procedure&nbsp;1.4.&nbsp;To Prepare JBoss EAP 6.1.0 and 6.1.1</div><a class="indexterm" name="d0e1513"></a><a class="indexterm" name="d0e1518"></a><ol class="procedure" type="1"><li class="step"><p>For JBoss EAP 6.1.0 / 6.1.1, follow <a class="xref" href="chap-prepare-install.html#jboss711-disable-conflicts" title="Step 5">Step 5</a>
                and <a class="xref" href="chap-prepare-install.html#jboss711-delete-webservices" title="Step 6">Step 6</a> from
                    <a class="xref" href="chap-prepare-install.html#prep-jboss-710-711" title="Procedure&nbsp;1.2.&nbsp;To Prepare JBoss AS 7.1.0 / 7.1.1">Procedure&nbsp;1.2, &#8220;To Prepare JBoss AS 7.1.0 / 7.1.1&#8221;</a>.</p></li><li class="step"><p>However, you still need to review <a class="xref" href="chap-prepare-install.html#prep-jboss-for-openam" title="Procedure&nbsp;1.5.&nbsp;To Prepare JBoss for OpenAM">Procedure&nbsp;1.5, &#8220;To Prepare JBoss for OpenAM&#8221;</a> and
                    <a class="xref" href="chap-prepare-install.html#prep-openam-for-jboss" title="Procedure&nbsp;1.6.&nbsp;To Prepare OpenAM for JBoss">Procedure&nbsp;1.6, &#8220;To Prepare OpenAM for JBoss&#8221;</a> to make sure the JVM and directories are
                    configured appropriately.</p></li></ol></div><div class="procedure"><a name="prep-jboss-for-openam"></a><div class="procedure-title">Procedure&nbsp;1.5.&nbsp;To Prepare JBoss for OpenAM</div><a class="indexterm" name="d0e1543"></a><p>The default JBoss settings for JVM do not give sufficient memory to OpenAM. This procedure
                documents one method that you can use to modify JBoss. Other methods described in <a class="link" href="http://www.jboss.org/jbossas/docs" target="_blank">
               <em class="citetitle">JBoss Main Documentation Page</em></a>.</p><ol class="procedure" type="1"><li class="step"><p>Stop JBoss.</p></li><li class="step"><p>Open an appropriate JBoss configuration file. This procedure describes the use of the
                    <code class="filename">standalone.conf</code> file in the <code class="filename">/path/to/jboss/bin</code>
                    directory for JBoss in standalone mode.</p></li><li class="step"><p>Check the JVM settings associated with <code class="literal">JAVA_OPTS</code>. For JBoss AS 7.1.0 and AS 7.1.1,
                    you should change the JVM heap size to <code class="literal">-Xmx1024m</code>. The default JVM heap size and permanent
                    generation settings for later versions of JBoss may already exceed recommended values (-Xmx1024m,
                    -XX:MaxPermSize=256m). If you are using the embedded version of OpenDJ, the minimum heap size may
                    be higher. For details on the JVM options to use, see <a class="xref" href="chap-prepare-install.html#prepare-java" title="1.2.&nbsp;Preparing a Java Environment">Section&nbsp;1.2, &#8220;Preparing a Java Environment&#8221;</a>.</p></li><li class="step"><p>Set the following JVM <code class="literal">JAVA_OPTS</code> setting in the same file.</p><pre class="brush: plain;">-Dorg.apache.tomcat.util.http.ServerCookie.ALWAYS_ADD_EXPIRES=true</pre><p>Make sure that headers include the <code class="literal">Expires</code>
                    attribute rather than only <code class="literal">Max-Age</code>, as some versions
                    of Internet Explorer do not support <code class="literal">Max-Age</code>.</p></li><li class="step"><p>Now deploy the <code class="filename">openam.war</code> file into the appropriate JBoss deployment directory.
                    The directory varies depending on whether you are running in standalone or domain mode.</p></li><li class="step"><p>You do not need to make any of the other changes to XML files described in this section.
                    As JBoss EAP 6.0.0 and 6.0.1 was built from JBoss AS 7.1.2 and AS 7.1.3, respectively, this
                    procedure may also work on those versions of JBoss.</p></li></ol></div><div class="procedure"><a name="prep-openam-for-jboss"></a><div class="procedure-title">Procedure&nbsp;1.6.&nbsp;To Prepare OpenAM for JBoss</div><a class="indexterm" name="d0e1609"></a><p>To take full advantage of JBoss with OpenAM, you should make a couple of changes to the
                OpenAM <code class="filename">war</code> file. One problem is that JBoss will deploy applications from
                different temporary directories every time you restart the container, which would require
                reconfiguring OpenAM. To avoid this issue, take the following steps:</p><ol class="procedure" type="1"><li class="step"><p>If you have not already done so, create a temporary directory and
                    expand the <code class="filename">openam.war</code>.</p><div class="screen"><pre>
$ <strong>cd /tmp</strong>
$ <strong>mkdir /tmp/openam ; cd /tmp/openam</strong>
$ <strong>jar xvf ~/Downloads/OpenAM-12.0.0.war</strong>
                </pre></div></li><li class="step"><p>Update the <code class="literal"># configuration.dir=</code> line in the
                    <code class="filename">bootstrap.properties</code> file so that it appears as follows,
                    and save the change.</p><pre class="brush: ini;">
# This property should also be used when the system user that
# is running the web/application server process does not have
# a home directory. i.e. System.getProperty("user.home") returns
# null.

configuration.dir=$HOME/openamJboss
                </pre></li><li class="step"><p>Rebuild the <code class="filename">openam.war</code> file.</p><div class="screen"><pre>
$ <strong>jar cvf ../openam.war *</strong>
                </pre></div></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="prepare-oracle-weblogic"></a>1.10.&nbsp;Preparing Oracle WebLogic</h2></div></div></div><a class="indexterm" name="idx-weblogic"></a><p>Before you deploy OpenAM, update the JVM options as described in
   <a class="xref" href="chap-prepare-install.html#prepare-java" title="1.2.&nbsp;Preparing a Java Environment">Section&nbsp;1.2, &#8220;Preparing a Java Environment&#8221;</a>.</p><div class="orderedlist"><p>
     Next, edit the WebLogic domain configuration
     to allow basic authentication credentials to be passed back to OpenAM.
     By default, WebLogic attempts to resolve authentication credentials itself.
     When you change the WebLogic domain configuration, you make sure that
     the OpenAM OAuth 2.0 providers receive basic authentication credentials
     for OAuth 2.0 grants that rely on basic authentication.
    </p><ol class="orderedlist" type="1"><li class="listitem"><p>
      Stop the WebLogic server.
     </p></li><li class="listitem"><p>
      Edit the WebLogic domain configuration,
      <code class="filename">/path/to/wlsdomain/config/config.xml</code>,
      setting <code class="literal">&lt;enforce-valid-basic-auth-credentials&gt;</code>
      to <code class="literal">false</code> in the
      <code class="literal">&lt;security-configuration</code> element.
     </p><pre class="brush: xml;">&lt;security-configuration&gt;
    &lt;enforce-valid-basic-auth-credentials&gt;false
    &lt;/enforce-valid-basic-auth-credentials&gt;
 &lt;/security-configuration&gt;</pre></li></ol></div><div class="orderedlist"><p>Weblogic uses its own classes if a class exists in both the parent
         and child classloaders by default.
         To use OpenAM and its classes on WebLogic 11g,
            create a WebLogic deployment descriptor file <code class="literal">weblogic.xml</code>
            and place it in the <code class="literal">/WEB-INF</code> directory.
            The descriptor file maps resources defined for OpenAM.
        </p><ol class="orderedlist" type="1"><li class="listitem"><p>Create a WebLogic descriptor file, <code class="literal">/WEB-INF/weblogic.xml</code>.</p><pre class="brush: xml;">
 &lt;?xml version="1.0" encoding="UTF-8"?&gt;
   &lt;weblogic-web-app xmlns="http://xmlns.oracle.com/weblogic/weblogic-web-app"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation="http://xmlns.oracle.com/weblogic/weblogic-web-app
      http://xmlns.oracle.com/weblogic/weblogic-web-app/1.3/weblogic-web-app.xsd"&gt;
         &lt;context-root&gt;/openam&lt;/context-root&gt;
         &lt;container-descriptor&gt;
            &lt;prefer-web-inf-classes&gt;true&lt;/prefer-web-inf-classes&gt;
         &lt;/container-descriptor&gt;
   &lt;/weblogic-web-app&gt;</pre></li><li class="listitem"><p>
      Start the WebLogic server.
     </p></li></ol></div><p>
     When deploying OpenAM on WebLogic 11g (version 10.3.x),
     use the SOAP with Attachments API for Java (SAAJ) implementation
     from the Java Runtime Environment, rather than the WebLogic implementation.

     The WebLogic implementation can cause OpenAM to throw exceptions with the
     message <code class="literal">java.lang.UnsupportedOperationException:
     This class does not support SAAJ 1.1</code>,
     and to fail to authenticate users in some cases.

     No change is necessary when deploying OpenAM on WebLogic 12c.
    </p><p>
     To use the Sun/Oracle Java SAAJ implementation,
     edit the WebLogic start up script for the domain where OpenAM runs, such as
     <code class="filename">/path/to/weblogic/user_projects/domains/wlsdomain/startWebLogic.sh</code>.

     Change the following line:

     </p><pre class="brush: shell;">${DOMAIN_HOME}/bin/startWebLogic.sh $*</pre><p>

     To set the <code class="literal">javax.xml.soap.MessageFactory</code> property:

     </p><pre class="brush: shell;">${DOMAIN_HOME}/bin/startWebLogic.sh \
 -Djavax.xml.soap.MessageFactory=\
 com.sun.xml.internal.messaging.saaj.soap.ver1_1.SOAPMessageFactory1_1Impl $*</pre><p>
    </p><p>
     When using WebLogic 12.1.1 with Java 6,
     if you plan to use the <span class="command"><strong>ssoadm</strong></span> command to configure OpenAM,
     then make the following change to the start up script,
     <code class="filename">startWebLogic.sh</code>,
     to avoid exceptions and incorrect results.
     Change the following line:
    </p><pre class="literallayout">${DOMAIN_HOME}/startWebLogic.sh</pre><p>
     To this:
    </p><pre class="literallayout">${DOMAIN_HOME}/bin/startWebLogic.sh \
 -Djavax.xml.soap.MessageFactory=\
 com.sun.xml.internal.messaging.saaj.soap.ver1_1.SOAPMessageFactory1_1Impl $*</pre><p>
     Restart WebLogic for the change to take effect.
    </p><a class="indexterm" name="d0e1749"></a></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="prepare-ibm-websphere"></a>1.11.&nbsp;Preparing IBM WebSphere</h2></div></div></div><a class="indexterm" name="d0e1757"></a><p>Before you deploy OpenAM, use the Administrator console to update
   JVM options as described in <a class="xref" href="chap-prepare-install.html#prepare-java" title="1.2.&nbsp;Preparing a Java Environment">Section&nbsp;1.2, &#8220;Preparing a Java Environment&#8221;</a>.</p><div class="orderedlist"><p>In addition, configure WebSphere to load classes from OpenAM bundled
    libraries before loading classes from libraries delivered with WebSphere.
    The following steps must be completed after you deploy OpenAM into
    WebSphere.</p><ol class="orderedlist" type="1"><li class="listitem"><p>In WebSphere administration console, browse to Application &gt;
     Application Type &gt; WebSphere enterprise applications &gt; <em class="replaceable"><code>OpenAM
     Name</code></em> &gt; Class loading and update detection.</p></li><li class="listitem"><p>Set Class loader order &gt; Classes loaded with local class loader first
     (parent last).</p></li><li class="listitem"><p>Set WAR class loader policy &gt; Single class loader for application.</p></li><li class="listitem"><p>Save your work.</p></li></ol></div><div class="orderedlist"><p>Furthermore when using IBM Java, add the JAXP Reference Implementation
    .jar into the OpenAM .war file before deploying the .war into WebSphere as
    this required library is missing otherwise.</p><ol class="orderedlist" type="1"><li class="listitem"><p>Unpack the OpenAM .war file.</p><div class="screen"><pre>
 $ <strong>mkdir /tmp/openam</strong>
 $ <strong>cd /tmp/openam/</strong>
 $ <strong>jar -xf ~/Downloads/openam/OpenAM-12.0.0.war</strong>
     </pre></div></li><li class="listitem"><p>Add the JAXP Reference Implementation .jar in
     <code class="filename">WEB-INF/lib/</code>.</p><div class="screen"><pre>
 $ <strong>wget http://repo1.maven.org/maven2/com/sun/xml/parsers/jaxp-ri/1.4.5/jaxp-ri-1.4.5.jar</strong>
 $ <strong>mv jaxp-ri-1.4.5.jar WEB-INF/lib/</strong>
     </pre></div></li><li class="listitem"><p>Pack up the OpenAM .war file to deploy in WebSphere.</p><div class="screen"><pre>
 $ <strong>jar -cf ../openam.war *</strong>
     </pre></div></li><li class="listitem"><p>Deploy the new .war file.</p><p>In this case the .war file to deploy is
     <code class="filename">/tmp/openam.war</code>.</p></li></ol></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="preface.html">Prev</a>&nbsp;</td><td width="20%" align="center">&nbsp;</td><td width="40%" align="right">&nbsp;<a accesskey="n" href="chap-install-core.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Preface&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;2.&nbsp;Installing OpenAM Core Services</td></tr></table></div><p>&nbsp;</p><div id="footer"><p>Something wrong on this page? <a href="https://bugster.forgerock.org/jira/secure/CreateIssueDetails!init.jspa?pid=10000&components=10007&issuetype=1">Log a documentation bug.</a></p></div>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-23412190-14']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</body></html>