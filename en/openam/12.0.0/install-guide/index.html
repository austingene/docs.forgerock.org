<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head>

      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
   <title>OpenAM Installation Guide</title><link rel="stylesheet" type="text/css" href="coredoc.css"><link rel="stylesheet" type="text/css" href="css/coredoc.css"><link rel="stylesheet" type="text/css" href="sh/shCore.css"><link rel="stylesheet" type="text/css" href="sh/shCoreEclipse.css"><link rel="stylesheet" type="text/css" href="sh/shThemeEclipse.css"><script src="http://code.jquery.com/jquery-1.11.0.min.js" type="text/javascript"></script><script src="uses-jquery.js" type="text/javascript"></script><script src="sh/shCore.js" type="text/javascript"></script><script src="sh/shBrushAci.js" type="text/javascript"></script><script src="sh/shBrushBash.js" type="text/javascript"></script><script src="sh/shBrushCsv.js" type="text/javascript"></script><script src="sh/shBrushHttp.js" type="text/javascript"></script><script src="sh/shBrushJava.js" type="text/javascript"></script><script src="sh/shBrushJScript.js" type="text/javascript"></script><script src="sh/shBrushLDIF.js" type="text/javascript"></script><script src="sh/shBrushPlain.js" type="text/javascript"></script><script src="sh/shBrushProperties.js" type="text/javascript"></script><script src="sh/shBrushXml.js" type="text/javascript"></script><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><meta name="description" content="Guide showing you how to install OpenAM. OpenAM provides open source Authentication, Authorization, Entitlement and Federation software."><script type="text/javascript">SyntaxHighlighter.all();</script>
<link rel="shortcut icon" href="http://forgerock.org/favicon.ico">
</head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div lang="en" class="book"><div class="titlepage"><div><div><h1 class="title"><a name="install-guide"></a>OpenAM Installation Guide</h1></div><div><h2 class="subtitle">Version 12.0.0</h2></div><div><div class="authorgroup"><div class="author"><h3 class="author"><span class="firstname">Mark </span> <span class="surname">Craig</span></h3></div><div class="author"><h3 class="author"><span class="firstname">David </span> <span class="surname">Goldsmith</span></h3></div><div class="author"><h3 class="author"><span class="firstname">Gene </span> <span class="surname">Hirayama</span></h3></div><div class="author"><h3 class="author"><span class="firstname">Mike </span> <span class="surname">Jang</span></h3></div><div class="author"><h3 class="author"><span class="firstname">Chris </span> <span class="surname">Lee</span></h3></div><div class="author"><h3 class="author"><span class="firstname">Vanessa </span> <span class="surname">Richie</span></h3><div lang="en" class="affiliation"><span class="orgname">ForgeRock AS<br></span><div class="address"><p><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="street">33&nbsp;New&nbsp;Montgomery&nbsp;St.</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="otheraddr">Suite&nbsp;1500</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="city">San&nbsp;Francisco</span>,&nbsp;<span class="state">CA</span>&nbsp;<span class="postcode">94105</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="country">USA</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="phone">+1&nbsp;415-599-1100&nbsp;(US)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<code class="uri">www.forgerock.com</code><br>
&nbsp;&nbsp;&nbsp;</p></div></div></div></div></div><div><p class="releaseinfo">Software release date: December 18, 2014</p></div><div><p class="copyright">Copyright &copy; 2011-2014 ForgeRock AS</p></div><div><a href="legalnotice.html">Legal Notice</a></div><div><p class="pubdate">Publication date: December 18, 2014</p></div><div><div class="abstract"><div class="abstract-title">Abstract</div><p>Guide showing you how to install OpenAM. OpenAM provides open source
   Authentication, Authorization, Entitlement and Federation software.</p></div></div></div><hr></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="preface"><a href="#preface">Preface</a></span></dt><dt><span class="chapter"><a href="#chap-prepare-install">1. Preparing For Installation</a></span></dt><dt><span class="chapter"><a href="#chap-install-core">2. Installing OpenAM Core Services</a></span></dt><dt><span class="chapter"><a href="#chap-install-tools">3. Installing OpenAM Tools</a></span></dt><dt><span class="chapter"><a href="#chap-install-multiple">4. Installing Multiple Servers</a></span></dt><dt><span class="chapter"><a href="#chap-install-das">5. Installing OpenAM Distributed Authentication</a></span></dt><dt><span class="chapter"><a href="#chap-custom-ui">6. Customizing the OpenAM End User Pages</a></span></dt><dt><span class="chapter"><a href="#chap-cts">7. Configuring the Core Token Service (CTS)</a></span></dt><dt><span class="chapter"><a href="#chap-session-failover">8. Setting Up OpenAM Session Failover</a></span></dt><dt><span class="chapter"><a href="#chap-uninstall">9. Removing OpenAM Software</a></span></dt><dt><span class="index"><a href="#d12792e5667">Index</a></span></dt></dl></div><div lang="en" class="preface"><div class="titlepage"><div><div><h1 class="title"><a name="preface"></a>Preface</h1></div></div></div><p>This guide shows you how to install core OpenAM services for access
 and federation management. Unless you are planning a throwaway evaluation
 or test installation, read the <em class="citetitle">Release Notes</em> before
 you get started.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d12792e178"></a>1.&nbsp;Who Should Use this Guide</h2></div></div></div><p>This guide is written for anyone installing OpenAM to manage
  and to federate access to web applications and web based resources.</p><p>This guide covers the install, upgrade, and removal (a.k.a. uninstall)
  procedures that you theoretically perform only once per version. This
  guide aims to provide you with at least some idea of what happens
  behind the scenes when you perform the steps.</p><p>You do not need to be an OpenAM wizard to learn something from
  this guide, though a background in access management and maintaining
  web application software can help. You do need some background in
  managing services on your operating systems and in your application
  servers. You can nevertheless get started with this guide, and then
  learn more as you go along.</p></div><div lang="en" class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="formatting-conventions"></a>2.&nbsp;Formatting Conventions</h2></div></div></div><p>
  Most examples in the documentation are created on GNU/Linux or Mac OS X.

  Where it is helpful to make a distinction between operating environments,
  examples for UNIX, GNU/Linux, Mac OS X, and so forth are labeled (UNIX).
  Mac OS X specific examples can be labeled (Mac OS X).
  Examples for Microsoft Windows can be labeled (Windows).

  To avoid repetition, however, file system directory names are
  often given only in UNIX format as in <code class="filename">/path/to/server</code>,
  even if the text applies to <code class="filename">C:\path\to\server</code> as well.
 </p><p>
  Absolute path names usually begin with the placeholder
  <code class="filename">/path/to/</code>.

  This path might translate to <code class="filename">/opt/</code>,
  <code class="filename">C:\Program Files\</code>, or somewhere else on your system.
 </p><p>
  Command line, terminal sessions are formatted as follows.
 </p><div class="screen"><pre>$ <strong>echo $JAVA_HOME</strong>
<em>/path/to/jdk</em></pre></div><p>
  Command output is sometimes formatted for narrower, more readable output
  even though formatting parameters are not shown in the command.
  In the following example, the query string parameter
  <code class="literal">_prettyPrint=true</code> is omitted.
 </p><div class="screen"><pre>
$ <strong>curl https://bjensen:hifalutin@opendj.example.com:8443/users/newuser</strong>
<em>{
  "_rev" : "000000005b337348",
  "schemas" : [ "urn:scim:schemas:core:1.0" ],
  "contactInformation" : {
    "telephoneNumber" : "+1 408 555 1212",
    "emailAddress" : "newuser@example.com"
  },
  "_id" : "newuser",
  "name" : {
    "familyName" : "New",
    "givenName" : "User"
  },
  "userName" : "newuser@example.com",
  "displayName" : "New User",
  "meta" : {
    "created" : "2014-06-03T09:58:27Z"
  },
  "manager" : [ {
    "_id" : "kvaughan",
    "displayName" : "Kirsten Vaughan"
  } ]
}</em>
 </pre></div><p>
  Program listings are formatted as follows.
 </p><pre class="brush: java;">class Test {
    public static void main(String [] args)  {
        System.out.println("This is a program listing.");
    }
}</pre></div><div lang="en" class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="accessing-doc-online"></a>3.&nbsp;Accessing Documentation Online</h2></div></div></div><p>
  ForgeRock core documentation, such as what you are now reading, aims to be
  technically accurate and complete with respect to the software documented.
 </p><div class="itemizedlist"><p>
   Core documentation therefore follows a three-phase review process
   designed to eliminate errors.
  </p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
    Product managers and software architects review project documentation design
    with respect to the users' software lifecycle needs.
   </p></li><li class="listitem"><p>
    Subject matter experts review proposed documentation changes for
    technical accuracy and completeness
    with respect to the corresponding software.
   </p></li><li class="listitem"><p>
    Quality experts validate implemented documentation changes for
    technical validity with respect to the software,
    technical completeness with respect to the scope of the document,
    and usability for the expected audience.
   </p></li></ul></div><p>
  The review process helps to ensure that documentation published for
  a ForgeRock release is technically accurate and complete.
 </p><p>
  Fully reviewed, published core documentation is available at
  <a class="link" href="http://docs.forgerock.org/" target="_blank">http://docs.forgerock.org/</a>.

  Use this documentation when working with a ForgeRock Enterprise release.
 </p><p>
  In-progress documentation can be found at each project site under the
  <a class="link" href="http://forgerock.org" target="_blank">Developer Community</a> projects page.

  Use this documentation when trying a nightly build.
 </p><p>
  The ForgeRock <a class="link" href="https://wikis.forgerock.org/" target="_blank">Community Wikis</a> and provide additional, user-created information.

  We encourage you to
  <a class="link" href="https://sso.forgerock.com/openam/UI/Login" target="_blank">join the community</a>, so that you can update the Wikis, too.
 </p></div><div lang="en" class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="joining-the-community"></a>4.&nbsp;Joining the ForgeRock Community</h2></div></div></div><p>
  After you
  <a class="link" href="https://backstage.forgerock.com/#/account/register" target="_blank">sign up</a> to join the ForgeRock community,
  you can edit the
  <a class="link" href="https://wikis.forgerock.org/" target="_blank">Community Wikis</a>,
  and also log bugs and feature requests in the
  <a class="link" href="https://bugster.forgerock.org/" target="_blank">issue tracker</a>.
 </p><p>
  If you have a question regarding a project but cannot find an answer
  in the project documentation or Wiki, browse to the
  <a class="link" href="http://forgerock.org" target="_blank">Developer Community</a> page for the project,
  where you can find details on joining the project mailing lists,
  and find links to mailing list archives.

  You can also suggest updates to documentation through the
  <a class="link" href="https://lists.forgerock.org/mailman/listinfo/docs" target="_blank">ForgeRock docs mailing list</a>.
 </p><p>
  The Community Wikis describe how to check out and build source code.

  Should you want to contribute a patch, test, or feature,
  or want to author part of the core documentation,
  first have a look on the ForgeRock site at
  <a class="link" href="http://forgerock.org/get_involved.html" target="_blank">how to get involved</a>.
 </p></div></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-prepare-install"></a>Chapter&nbsp;1.&nbsp;Preparing For Installation</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="section"><a href="#prepare-networking">1.1. Preparing a Fully-Qualified Domain Name</a></span></dt><dt><span class="section"><a href="#prepare-java">1.2. Preparing a Java Environment</a></span></dt><dt><span class="section"><a href="#prerequisites-file-descriptors">1.3. Setting Maximum File Descriptors</a></span></dt><dt><span class="section"><a href="#prepare-identity-repository">1.4. Preparing an Identity Repository</a></span></dt><dt><span class="section"><a href="#prepare-configuration-store">1.5. Preparing an External Configuration Data Store</a></span></dt><dt><span class="section"><a href="#download-openam-software">1.6. Obtaining OpenAM Software</a></span></dt><dt><span class="section"><a href="#enable-cors-support">1.7. Enabling CORS Support</a></span></dt><dt><span class="section"><a href="#prepare-apache-tomcat">1.8. Preparing Apache Tomcat</a></span></dt><dt><span class="section"><a href="#prepare-jboss-7">1.9. Preparing OpenAM &amp; JBoss AS 7 / EAP 6</a></span></dt><dt><span class="section"><a href="#prepare-oracle-weblogic">1.10. Preparing Oracle WebLogic</a></span></dt><dt><span class="section"><a href="#prepare-ibm-websphere">1.11. Preparing IBM WebSphere</a></span></dt></dl></div><a class="indexterm" name="d12792e305"></a><p>This chapter covers prerequisites for installing OpenAM software,
 including how to prepare your application server to run OpenAM, how to prepare
 directory services to store configuration data, and how to prepare an identity
 repository to handle OpenAM identities.</p><div class="note"><h3 class="title">Note</h3><p>If a Java Security Manager is enabled for your application server,
  add permissions before installing OpenAM.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="prepare-networking"></a>1.1.&nbsp;Preparing a Fully-Qualified Domain Name</h2></div></div></div><a class="indexterm" name="d12792e317"></a><a class="indexterm" name="d12792e324"></a><p>OpenAM requires that you provide the fully-qualified domain name (FQDN)
  when you configure it. Before you set up OpenAM, be sure that your system
  has an FQDN such as <code class="literal">openam.example.com</code>. For evaluation
  purposes, you can give your system an alias using the
  <code class="filename">/etc/hosts</code> file on UNIX systems or
  <code class="filename">%SystemRoot%\system32\drivers\etc\hosts</code> on Windows. For
  deployment, make sure the FQDN is properly assigned for example using
  DNS.</p><p>Do not use the <code class="literal">localhost</code> domain for OpenAM, not even
  for testing purposes. OpenAM relies on browser cookies, which are returned
  based on domain name. Furthermore, use a domain name that contains at least 2
  <code class="literal">.</code> (dot) characters, such
  <code class="literal">openam.example.com</code>.</p><div class="important"><h3 class="title">Important</h3><p>
   Do not configure a top-level domain as your cookie domain as browsers will
   reject them.
   </p><p>
   Top-level domains are browser-specific.
    Some browsers, like Firefox, also consider special domains like Amazon's web
    service (for example, ap-southeast-2.compute.amazonaws.com) to be a top-level domain.
   </p><p>
    Check the effective top-level domain list at
    <a class="link" href="https://publicsuffix.org/list/effective_tld_names.dat" target="_blank"><em class="citetitle">https://publicsuffix.org/list/effective_tld_names.dat</em></a>
    to ensure that you do not set your cookie to a domain in the list.
  </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="prepare-java"></a>1.2.&nbsp;Preparing a Java Environment</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#prepare-java-sun">1.2.1. Settings For Sun/Oracle Java Environments</a></span></dt><dt><span class="section"><a href="#prepare-java-ibm">1.2.2. Settings For IBM Java Environments</a></span></dt></dl></div><a class="indexterm" name="d12792e363"></a><p>OpenAM software depends on a Java runtime environment. Check the output
  of <span class="command"><strong>java -version</strong></span> to make sure your the version is supported
  according to the <em class="citetitle">Release Notes</em> section on <a href="../release-notes/index.html#java-requirements" class="link"><em class="citetitle">Java
  Requirements</em></a>.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="prepare-java-sun"></a>1.2.1.&nbsp;Settings For Sun/Oracle Java Environments</h3></div></div></div><a class="indexterm" name="d12792e385"></a><div class="variablelist"><p>When using a Sun or Oracle Java environment set at least the
    following options.</p><dl class="variablelist"><dt><span class="term"><code class="literal">-server</code></span></dt><dd><p>Use <code class="literal">-server</code> rather than
      <code class="literal">-client</code>.</p></dd><dt><span class="term"><code class="literal">-XX:MaxPermSize=256m</code></span></dt><dd><p>Set the permanent generation size to 256 MB.</p></dd><dt><span class="term"><code class="literal">-Xmx1024m</code> (minimum)</span></dt><dd><p>OpenAM requires at least a 1 GB heap. If you are including the embedded
      OpenDJ directory, OpenAM requires at least a 2 GB heap, as 50% of that space
      is allocated to OpenDJ. Higher volume and higher performance
      deployments require additional heap space.</p></dd></dl></div><p>For additional JVM tuning recommendations, see <a href="../admin-guide/index.html#tuning-jvm-for-openam" class="link"><em class="citetitle">Java Virtual
   Machine Settings</em></a>.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="prepare-java-ibm"></a>1.2.2.&nbsp;Settings For IBM Java Environments</h3></div></div></div><a class="indexterm" name="d12792e430"></a><div class="variablelist"><p>When using an IBM Java environment set at least the following
    options.</p><dl class="variablelist"><dt><span class="term"><code class="literal">-DamCryptoDescriptor.provider=IBMJCE</code>, </span><span class="term"><code class="literal">-DamKeyGenDescriptor.provider=IBMJCE</code></span></dt><dd><p>Use the IBM Java Cryptography Extensions.</p></dd><dt><span class="term"><code class="literal">-Xmx1024m</code> (minimum)</span></dt><dd><p>OpenAM requires at least a 1 GB heap. If you are including the embedded
      OpenDJ directory, OpenAM requires at least a 2 GB heap, as 50% of that space
      is allocated to OpenDJ. Higher volume and higher
      performance deployments require additional heap space.</p></dd></dl></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="prerequisites-file-descriptors"></a>1.3.&nbsp;Setting Maximum File Descriptors</h2></div></div></div><a class="indexterm" name="d12792e459"></a><a class="indexterm" name="d12792e464"></a><p>
   If you use the embedded OpenDJ directory, make sure OpenDJ has enough
   file descriptors. OpenDJ needs to be able to open many files,
   especially when handling many client connections.

   Linux systems in particular often set a limit of 1024 per user,
   which is too low for OpenDJ.
  </p><p>
   OpenDJ should have access to use at least 64K (65536) file descriptors.
   The embedded OpenDJ directory runs inside the OpenAM process space.

   When running OpenAM as user <code class="literal">openam</code> on a Linux system
   that uses <code class="filename">/etc/security/limits.conf</code> to set user limits,
   you can set soft and hard limits by adding these lines to the file.
  </p><pre class="brush: plain;">
openam soft nofile 65536
openam hard nofile 131072
  </pre><div class="screen"><pre>
$ <strong>ulimit -n</strong>
<em>65536</em></pre></div><p>
   The example above assumes the system has enough file descriptors overall.

   You can verify the new soft limit the next time you log in as user
   <code class="literal">openam</code> with the <span class="command"><strong>ulimit -n</strong></span> command.
  </p><p>
   You can check the Linux system overall maximum as follows.
  </p><div class="screen"><pre>
$ <strong>cat /proc/sys/fs/file-max</strong>
<em>204252</em>
  </pre></div><div class="orderedlist"><p>
    If the overall maximum is too low, you can increase it as follows.
   </p><ol class="orderedlist" type="1"><li class="listitem"><p>
    As superuser, edit <code class="filename">/etc/sysctl.conf</code> to set
    the kernel parameter <code class="literal">fs.file-max</code> to a higher maximum.
   </p></li><li class="listitem"><p>
    Run the <span class="command"><strong>sysctl -p</strong></span> command to reload
    the settings in <code class="filename">/etc/sysctl.conf</code>.
   </p></li><li class="listitem"><p>
    Read <code class="filename">/proc/sys/fs/file-max</code> again to confirm
    that it now corresponds to the new maximum.
   </p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="prepare-identity-repository"></a>1.4.&nbsp;Preparing an Identity Repository</h2></div></div></div><a class="indexterm" name="d12792e535"></a><a class="indexterm" name="d12792e542"></a><p>OpenAM stores user identity data in one or more identity repositories.
   In many deployments OpenAM connects to existing LDAP directory services
   for user identity data. OpenAM is designed therefore to share data in an
   identity repository with other applications.</p><p>OpenAM ships with an embedded OpenDJ directory server that you can
   install as part of the OpenAM configuration process. In deployments where you
   will only ever have a few users to manage and do not need to share identity
   data with other applications, you can use the embedded store as your identity
   repository and avoid the additional overhead of maintaining a separate
   directory service. If OpenAM will share identity data with other applications,
   or if you expect to have lots of users, then connect OpenAM to an external
   identity repository. See the <a href="../release-notes/index.html#chap-before-you-install" class="link"><em class="citetitle">Release
    Notes</em></a> for a list of supported external identity
   repositories.</p><p>When OpenAM connects to an external identity repository, the
   administrator must give OpenAM the following access rights.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>OpenAM requires specific directory schema definitions for the object
     classes and attribute types that describe its data. The directory
     administrator can find these definitions in the <code class="filename">ldif</code>
     directory found inside the full .zip delivery.</p><p>If the directory administrator chooses instead to have OpenAM update
     the directory schema at configuration time, then the directory administrator
     must grant OpenAM access.</p><p>To grant this access right with OpenDJ for example, first add a global
     ACI permitting the OpenAM user to modify schema definitions as in the
     following example where the OpenAM entry has DN
     <code class="literal">uid=openam,ou=admins,dc=example,dc=com</code>.</p><pre class="brush: ldif;">
global-aci: (target = "ldap:///cn=schema")(targetattr = "attributeTypes ||
   objectClasses")(version 3.0;acl "Modify schema"; allow (write)(userdn = "
   ldap:///uid=openam,ou=admins,dc=example,dc=com");)</pre><p>Also give the OpenAM user privileges to modify the schema and write
     to subentries such as the schema entry. Set the following attributes on
     the OpenAM user entry.</p><pre class="brush: ldif;">
ds-privilege-name: subentry-write
ds-privilege-name: update-schema</pre></li><li class="listitem"><p>Allow OpenAM to read directory schema.</p><p>With OpenDJ for example, keep the default "User-Visible Schema
     Operational Attributes" global ACI.</p></li><li class="listitem"><p>When OpenAM connects to an external identity repository, it requires
     access to read and potentially to update data.</p><p>To grant the access rights with OpenDJ for example, add following ACIs
     to the configuration base DN entry. Adjust them as necessary if the OpenAM
     user DN differs from
     <code class="literal">uid=openam,ou=admins,dc=example,dc=com</code>.</p><pre class="brush: ldif;">
aci: (targetattr="* || aci")(version 3.0;acl "Allow identity modification";
   allow (write)(userdn = "ldap:///uid=openam,ou=admins,dc=example,dc=com");)
aci: (targetattr!="userPassword||authPassword")(version 3.0;
   acl "Allow identity search"; allow (search, read)(userdn = "ldap:///
   uid=openam,ou=admins,dc=example,dc=com");)
aci: (targetcontrol="2.16.840.1.113730.3.4.3")(version 3.0;acl "Allow
   persistent search"; allow (search, read)(userdn = "ldap:///
   uid=openam,ou=admins,dc=example,dc=com");)
aci: (version 3.0;acl "Add identity"; allow (add)(userdn = "ldap:///
   uid=openam,ou=admins,dc=example,dc=com");)
aci: (version 3.0;acl "Delete identity"; allow (delete)(userdn = "ldap:///
   uid=openam,ou=admins,dc=example,dc=com");)
    </pre></li><li class="listitem"><p>Allow the OpenAM user to reset other users' passwords.</p><p>To grant this privilege in OpenDJ for example, set the following
     attribute on the OpenAM user entry.</p><pre class="brush: ldif;">
ds-privilege-name: password-reset</pre></li></ul></div><p>In addition for external directory services, the directory administrator
   should index the following attributes used by OpenAM.</p><div class="table"><a name="prepare-identity-repository-indexes"></a><div class="table-title">Table&nbsp;1.1.&nbsp;Identity Repository Indexes</div><div class="table-contents"><table summary="Identity Repository Indexes" border="0"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th>Attribute</th><th>Indexes Required</th></tr></thead><tbody><tr><td><code class="literal">iplanet-am-user-federation-info-key</code></td><td>equality</td></tr><tr><td><code class="literal">sun-fm-saml2-nameid-infokey</code></td><td>equality</td></tr></tbody></table></div></div><br class="table-break"></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="prepare-configuration-store"></a>1.5.&nbsp;Preparing an External Configuration Data Store</h2></div></div></div><a class="indexterm" name="d12792e630"></a><a class="indexterm" name="d12792e637"></a><p>
   OpenAM stores its configuration, session, and token data in an LDAP
   directory service. OpenAM ships with an embedded OpenDJ directory server
   that you can install as part of the OpenAM configuration process.
   By default, OpenAM installs the embedded directory server alongside its
   configuration settings under the $HOME directory of the user running OpenAM
   and runs the embedded directory server in the same JVM memory space as OpenAM.
  </p><p>
   With the embedded OpenDJ directory and the default configuration
   settings, OpenAM connects as directory super user, bypassing access control
   evaluation because OpenAM manages the directory as its private store. Be aware
   that failover and replication cannot be controlled when using the embedded store.
  </p><p>
   Before deploying OpenAM in production, measure the impact of
   using the embedded directory not only for relatively static configuration
   data, but also for volatile session and token data. Your tests should subject
   OpenAM to the same load patterns you expect in production. If it looks like
   a better choice to use an external directory service, then use one of the
   supported external configuration stores listed in the
   <a href="../release-notes/index.html#chap-before-you-install" class="link"><em class="citetitle">Release
    Notes</em></a>, such as OpenDJ.
  </p><p>
   OpenAM supports the Core Token Service (CTS),
   a centralized token repository for OpenAM session tokens, OpenID Connect ID tokens, and
   SAML 2.0 tokens, which can be stored in a locally embedded or external
   directory store together or separately from OpenAM configuration data. For more information,
   see the chapter on <a href="../install-guide/index.html#chap-cts" class="link">
    <em class="citetitle">Configuring the Core Token Service</em></a>.
  </p><div class="tip"><h3 class="title">Tip</h3><p>
    If you are the directory administrator and do not yet know directory services
    very well, take some time to read the documentation for your directory server,
    especially the sections covering directory schema and procedures on how
    to configure access to directory data.
   </p></div><div class="procedure"><a name="install-prepare-opendj-external-config-store"></a><div class="procedure-title">Procedure&nbsp;1.1.&nbsp;To Install an External OpenDJ Directory Server</div><a class="indexterm" name="idx-ext-opendj"></a><p>
     The following example procedure shows how to prepare a single OpenDJ
     directory server instance as an external configuration data store.
     The OpenDJ instance implements a single backend for the OpenAM
     configuration data.
     The procedure assumes that you have also prepared an external identity repository
     and an external CTS store,
     separate from the configuration data store.
    </p><ol class="procedure" type="1"><li class="step"><p>
      Prepare your OpenDJ installation, then download the OpenDJ software.
      See the OpenDJ documentation about
      <a class="link" href="http://docs.forgerock.org/en/opendj/2.6.0/install-guide/index.html#chap-install-cli" target="_blank">
            Installing OpenDJ From the Command Line</a>.
     </p><div class="screen"><pre>
$ <strong>cd /path/to/opendj</strong>
$ <strong>./setup --cli</strong>
     </pre></div><p>Example options are as follows:</p><div class="table"><a name="prepare-configuration-store-ds"></a><div class="table-title">Table&nbsp;1.2.&nbsp;Example OpenDJ Setup Parameters</div><div class="table-contents"><table summary="Example OpenDJ Setup Parameters" border="0"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th>Parameter</th><th>Example Inputs</th></tr></thead><tbody><tr><td><code class="literal">Accept License</code></td><td>Yes</td></tr><tr><td><code class="literal">Root User DN</code></td><td>cn=Directory Manager</td></tr><tr><td><code class="literal">Root User DN Password</code></td><td>(arbitrary)</td></tr><tr><td><code class="literal">Fully Qualified Domain Name</code></td><td>opendj.example.com</td></tr><tr><td><code class="literal">LDAP Port</code></td><td>1389</td></tr><tr><td><code class="literal">Administration Connector Port</code></td><td>4444</td></tr><tr><td><code class="literal">Create Base DN</code></td><td>No. This will be created in a later step.</td></tr><tr><td><code class="literal">Enable SSL</code></td><td>If you choose this option, make sure that
          OpenAM can trust the OpenDJ certificate.</td></tr><tr><td><code class="literal">Enable TLS</code></td><td>If you choose this option, make sure that
          OpenAM can trust the OpenDJ certificate.</td></tr><tr><td><code class="literal">Start Server After Config</code></td><td>Yes</td></tr></tbody></table></div></div><br class="table-break"></li><li class="step"><p>
      Change to the OpenDJ directory.
     </p><div class="screen"><pre>
$ <strong>cd /path/to/opendj</strong>
     </pre></div></li><li class="step"><p>
      Create a directory server backend, and call it <code class="literal">cfgStore</code>.
     </p><div class="screen"><pre>
$ <strong>bin/dsconfig create-backend \
  --backend-name cfgStore \
  --set base-dn:dc=example,dc=com \
  --set enabled:true \
  --type local-db \
  --port 4444 \
  --bindDN "cn=Directory Manager" \
  --bindPassword pwd \
  --no-prompt</strong>
     </pre></div></li><li class="step"><p>
      Create an LDIF file to add the initial entries for the
      configuration store, and save the file as
      <code class="literal">add-config-entries.ldif</code>.
      The entries include the base DN suffix, an organizational unit entry,
      and the OpenAM user entry needed to access the directory service.
     </p><p>
      When OpenAM connects as <code class="literal">uid=openam,ou=admins,dc=example,dc=com</code>
      to an external directory server to store its data, it requires both read
      and write access privileges. You add these privileges by means of access control
      instructions (ACIs) to the base distinguished name (DN) entry
      (<code class="literal">dc=example,dc=com</code>). If your OpenAM user has a different
      DN other than <code class="literal">uid=openam,ou=admins,dc=example,dc=com</code>,
      adjust the ACIs where appropriate.
     </p><p>
      You must also give privileges to the OpenAM user to modify the schema and write
      to subentries such as the schema entry. To grant these privileges, you include
      the following attributes on the OpenAM user entry:
      <code class="literal">ds-privilege-name: subentry-write</code> and
      <code class="literal">ds-privilege-name: update-schema</code>.
     </p><p>
      Note that if you are having trouble with this LDIF file,
      consider removing the line feeds for the ACI attributes
      and let it wrap to the next line. If you are still having trouble using
      the <span class="command"><strong>ldapmodify</strong></span>, you can use the
      <span class="command"><strong>import-ldif</strong></span> command although you may have to re-apply
      the <code class="literal">targetcontrol</code> ACI attribute.
     </p><pre class="brush: ldif;">
dn: dc=example,dc=com
objectclass: top
objectclass: domain
dc: example
aci: (targetattr="*")(version 3.0;acl "Allow entry search"; allow (
 search, read)(userdn = "ldap:///uid=openam,ou=admins,dc=example,dc=com");)
aci: (targetattr="*")(version 3.0;acl "Modify config entry"; allow (write)(
 userdn = "ldap:///uid=openam,ou=admins,dc=example,dc=com");)
aci: (targetcontrol="2.16.840.1.113730.3.4.3")(version 3.0;acl "Allow
 persistent search"; allow (search, read)(userdn = "ldap:///uid=openam
 ,ou=admins,dc=example,dc=com");)
aci: (version 3.0;acl "Add config entry"; allow (add)(userdn = "ldap:///
 uid=openam,ou=admins,dc=example,dc=com");)
aci: (version 3.0;acl "Delete config entry"; allow (delete)(userdn = "ldap:///
 uid=openam,ou=admins,dc=example,dc=com");)

dn: ou=admins,dc=example,dc=com
objectclass: top
objectclass: organizationalUnit
ou: admins

dn: uid=openam,ou=admins,dc=example,dc=com
objectclass: top
objectclass: person
objectclass: organizationalPerson
objectclass: inetOrgPerson
cn: openam
sn: openam
uid: openam
userPassword: secret12
ds-privilege-name: subentry-write
ds-privilege-name: update-schema
     </pre></li><li class="step"><p>
      Add the initial entries LDIF file using the
      <code class="literal">ldapmodify</code> command.
     </p><div class="screen"><pre>
$ <strong>bin/ldapmodify \
  --port 4444 \
  --bindDN "cn=Directory Manager" \
  --bindPassword pwd \
  &#8212;-defaultAdd \
  --useSSL \
  --trustAll \
  &#8212;-filename add-config-entries.ldif</strong>
     </pre></div></li><li class="step"><p>
      Add the Global Access Control Instruction (ACI) to the access control handler.
      The Global ACI gives OpenAM the privileges to modify the schema definitions
      for the custom configuration where the OpenAM entry has DN
      <code class="literal">uid=openam,ou=admins,dc=example,dc=com</code>.
     </p><div class="note"><h3 class="title">Note</h3><p>These access rights are only required during configuration, and only
       if the directory administrator does not add the OpenAM directory schema
       definitions manually.</p></div><p>
      If you are having difficulty successfully adding the <code class="literal">global-aci</code>
      attribute, try doing so without any line breaks.
     </p><div class="screen"><pre>
$ <strong>bin/dsconfig \
   set-access-control-handler-prop \
    --add global-aci:'(target = "ldap:///cn=schema")(targetattr = "attributeTypes || \
      objectClasses")(version 3.0; acl "Modify schema"; allow (write) \
      (userdn = "ldap:///uid=openam,ou=admins,dc=example,dc=com");)' \
    --port 4444 \
    --bindDN "cn=Directory Manager" \
    --bindPassword pwd \
    --trustAll \
    --no-prompt</strong>
     </pre></div></li><li class="step"><p>At this point, install the OpenAM server if you haven't done so
      already. For details,
      see <a href="../install-guide/index.html#chap-install-core" class="link"><em class="citetitle">Installing OpenAM Core Services</em></a>.
     </p></li><li class="step"><p>
      OpenAM requires specific directory schema definitions for the object
      classes and attribute types that describe its data. For the configuration
      store, the directory administrator should let OpenAM update the directory
      schema at configuration time.
     </p><p>
      Copy the schema files, located at
      <code class="literal">/path/to/tomcat/webapps/openam/WEB-INF/template/ldif/sfha</code>
      to a local file, <code class="literal">cts-add-schema.ldif</code>.
     </p><div class="screen"><pre>
$ <strong>cp /path/to/tomcat/webapps/openam/WEB-INF/template/ldif/sfha/cts-add-schema.ldif /tmp/ldif</strong>
     </pre></div></li><li class="step"><p>
      Add the schema to the directory server.
     </p><div class="screen"><pre>
$ <strong>bin/ldapmodify \
  --port 4444 \
  --bindDN "cn=Directory Manager" \
  --bindPassword pwd \
  --useSSL \
  --trustAll \
  --fileName cts-add-schema.ldif</strong>
     </pre></div></li><li class="step"><p>
      OpenAM uses certain attributes to search for configuration data. You must
      set some indexes on these attributes for the configuration store.
     </p><div class="table"><a name="prepare-configuration-store-indexes"></a><div class="table-title">Table&nbsp;1.3.&nbsp;Configuration Data Store Indexes</div><div class="table-contents"><table summary="Configuration Data Store Indexes" border="0"><colgroup><col width="66%"><col width="34%"></colgroup><thead><tr><th>Attribute</th><th>Indexes Required</th></tr></thead><tbody><tr><td><code class="literal">iplanet-am-user-federation-info-key</code></td><td>equality</td></tr><tr><td><code class="literal">sun-fm-saml2-nameid-infokey</code></td><td>equality</td></tr><tr><td><code class="literal">sunxmlkeyvalue</code></td><td>equality, substring</td></tr></tbody></table></div></div><br class="table-break"><p>
      On the OpenDJ directory server, use <code class="literal">dsconfig</code> to add
      these indexes to your external configuration store. Repeat for each
      attribute in <a class="xref" href="#prepare-configuration-store-indexes" title="Table&nbsp;1.3.&nbsp;Configuration Data Store Indexes">Table&nbsp;1.3, &#8220;Configuration Data Store Indexes&#8221;</a>.
     </p><div class="screen"><pre>
$ <strong>bin/dsconfig \
   create-local-db-index \
   --port 4444 \
   --hostname opendj.example.com \
   --bindDN "cn=Directory Manager" \
   --bindPassword password \
   --backend-name cfgstore \
   --index-name iplanet-am-user-federation-info-key \
   --set index-type:equality \
   --trustAll \
   --no-prompt</strong>
     </pre></div></li><li class="step"><p>
      Rebuild the indexes using the <code class="literal">rebuild-index</code> command.
      You can stop the server and run <code class="literal">rebuild-index</code> in offline
      mode, or you can run <code class="literal">rebuild-index</code> online
      using a task as follows:
     </p><div class="screen"><pre>
$ <strong>bin/rebuild-index --port 4444 --hostname opendj.example.com \
  --bindDN "cn=Directory Manager" --bindPassword password \
  --baseDN dc=example,dc=com --rebuildAll \
  --start 0</strong>
     </pre></div></li><li class="step"><p>
      Verify the indexes.
     </p><div class="screen"><pre>
$ <strong>bin/verify-index --baseDN dc=example,dc=com</strong>
     </pre></div><p>
      You have successfully installed and prepared the directory server for an
      external configuration store. When installing the OpenAM server,
      you need to specify the host name, port and root suffix
      of the external directory server on the Configuration Data Store Settings
      screen of the OpenAM Configurator.
      See <a href="../install-guide/index.html#configure-openam-custom" class="link">
      <em class="citetitle">To Configure OpenAM</em></a> for more
      information.
     </p></li></ol></div><a class="indexterm" name="d12792e963"></a></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="download-openam-software"></a>1.6.&nbsp;Obtaining OpenAM Software</h2></div></div></div><a class="indexterm" name="d12792e973"></a><p>Download OpenAM releases from one of the following locations:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="link" href="http://forgerock.com/download-stack/" target="_blank"><em class="citetitle">Enterprise Downloads</em></a> has the latest stable version of OpenAM, including
     a <code class="filename">.zip</code> file with all of the OpenAM components, the
     <code class="filename">.war</code> file, OpenAM tools, the configurator, policy
     agents, OpenIG, and documentation. Make sure you review the Software License and 
     Subscription Agreement presented before you download OpenAM files.</p></li><li class="listitem"><p><a class="link" href="http://forgerock.org/openam.html" target="_blank"><em class="citetitle">Builds</em></a> has the nightly build, including a <code class="filename">.zip</code> 
     file with all of the OpenAM components, the <code class="filename">.war</code> file, 
     OpenAM tools, the configurator, policy agents, and the .NET Fedlet. Be
     aware that this is the working version of the trunk and should not be 
     used in a production environment.</p></li><li class="listitem"><p><a class="link" href="http://forgerock.org/openam-archive.html" target="_blank"><em class="citetitle">Archives</em></a> has old versions of OpenAM and
     policy agents. It includes the full <code class="filename">.zip</code> file with all
     of the OpenAM components, the server <code class="filename">.war</code> file,
     OpenAM tools, the configurator, policy agents,  the WSS policy agents, and
     the .NET Fedlet for all previous releases.</p></li></ul></div><p>For each release of the OpenAM core services, you can download the
  entire package as a <code class="filename">.zip</code> file, only the OpenAM 
  <code class="filename">.war</code> file, or only the administrative tools as a 
  <code class="filename">.zip</code> archive. The Archives also have only the 
  OpenAM source code used to build the release.</p><p>After you download the <code class="filename">.zip</code> file, create a new 
  openam folder, and unzip the <code class="filename">.zip</code> file to access the content:</p><div class="screen"><pre>
$ <strong>cd ~/Downloads</strong>
$ <strong>mkdir openam ; cd openam</strong>
$ <strong>unzip ~/Downloads/OpenAM-12.0.0.zip</strong>
  </pre></div><div class="variablelist"><p>When you unzip the archive of the entire package, you get ldif, license, and 
   legal directories in addition to the following files.</p><dl class="variablelist"><dt><span class="term"><code class="filename">ClientSDK-12.0.0.jar</code></span></dt><dd><p>The OpenAM Java client SDK library</p></dd><dt><span class="term"><code class="filename">ExampleClientSDK-CLI-12.0.0.zip</code></span></dt><dd><p>The .zip file containing the Java client SDK command-line examples,
     and .jar files needed to run the examples</p></dd><dt><span class="term"><code class="filename">ExampleClientSDK-WAR-12.0.0.war</code></span></dt><dd><p>The .war file containing Java client SDK examples in a web
     application</p></dd><dt><span class="term"><code class="filename">IDPDiscovery-12.0.0.war</code></span></dt><dd><p>The IDP discovery .war file, deployed as a service to service
     providers that must discover which identity provider corresponds to a
     SAML 2.0 request</p><p>For details, see <a href="../admin-guide/index.html#deploy-idp-discovery" class="link"><em class="citetitle">Deploying the Identity Provider Discovery Service</em></a>.</p></dd><dt><span class="term"><code class="filename">Fedlet-12.0.0.zip</code></span></dt><dd><p>The .zip that contains the lightweight service provider
    implementations that you can embed in your Java EE or ASP.NET applications
    to enable it to use federated access management</p></dd><dt><span class="term"><code class="filename">OpenAM-12.0.0.war</code></span></dt><dd><p>The deployable .war file</p></dd><dt><span class="term"><code class="filename">OpenAM-DistAuth-12.0.0.war</code></span></dt><dd><p>The deployable .war file for distributed authentication</p></dd><dt><span class="term"><code class="filename">OpenAM-ServerOnly-12.0.0.war</code></span></dt><dd><p>The deployable .war file when you want to deploy OpenAM
    server without the OpenAM console</p></dd><dt><span class="term"><code class="filename">SSOAdminTools-12.0.0.zip</code></span></dt><dd><p>The .zip file that contains tools to manage OpenAM from 
    the command line</p></dd><dt><span class="term"><code class="filename">SSOConfiguratorTools-12.0.0.zip</code></span></dt><dd><p>The .zip file that contains tools to configure OpenAM from 
    the command line</p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="enable-cors-support"></a>1.7.&nbsp;Enabling CORS Support</h2></div></div></div><a class="indexterm" name="d12792e1130"></a><p>
   Cross-origin resource sharing (CORS) allows requests
   to be made across domains from user agents.
   OpenAM supports CORS, but CORS is not configured out of the box.
  </p><div class="orderedlist"><p>
    Instead, you must edit the deployment descriptor file
    before deploying OpenAM.
    CORS support is implemented as a Servlet filter,
    and so you add the filter's configuration to the deployment descriptor file.
   </p><ol class="orderedlist" type="1"><li class="listitem"><p>
     Unpack the OpenAM .war file.
    </p><div class="screen"><pre>
$ <strong>mkdir /tmp/openam</strong>
$ <strong>cd /tmp/openam/</strong>
$ <strong>jar -xf ~/Downloads/openam/OpenAM-12.0.0.war</strong>
    </pre></div></li><li class="listitem"><p>
     Edit the deployment descriptor file, <code class="filename">WEB-INF/web.xml</code>,
     to add a CORS filter configuration.
    </p><p>
     First, add a <code class="literal">&lt;filter-mapping&gt;</code> element
     to name the filter and to indicate the URL pattern for the filter.
     The URL pattern matches the endpoints for which to support CORS.
     The following example adds CORS support for all OpenAM endpoints.
    </p><pre class="brush: xml;">
&lt;filter-mapping&gt;
    &lt;filter-name&gt;CORSFilter&lt;/filter-name&gt;
    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;&lt;!-- CORS support for all endpoints --&gt;
&lt;/filter-mapping&gt;
</pre><p>
     Next, add a <code class="literal">&lt;filter&gt;</code> element
     to configure the filter.
     The following excerpt describes and demonstrates
     all of the required and optional configuration parameters.
    </p><pre class="brush: xml;">
&lt;filter&gt;
    &lt;filter-name&gt;CORSFilter&lt;/filter-name&gt;
    &lt;filter-class&gt;org.forgerock.openam.cors.CORSFilter&lt;/filter-class&gt;
    &lt;init-param&gt;
        &lt;description&gt;
            Accepted Methods - (Required) -
            A list of HTTP methods for which to accept CORS requests
        &lt;/description&gt;
        &lt;param-name&gt;methods&lt;/param-name&gt;
        &lt;param-value&gt;POST,PUT&lt;/param-value&gt;
    &lt;/init-param&gt;
    &lt;init-param&gt;
        &lt;description&gt;
            Accepted Origins - (Required) -
            A list of origins from which to accept CORS requests
        &lt;/description&gt;
        &lt;param-name&gt;origins&lt;/param-name&gt;
        &lt;param-value&gt;www.example.net,example.org&lt;/param-value&gt;
    &lt;/init-param&gt;
    &lt;init-param&gt;
        &lt;description&gt;
            Allow Credentials - (Optional) -
            Whether to include the allow Vary (Origin)
            and Access-Control-Allow-Credentials headers
            in the response [default false]
        &lt;/description&gt;
        &lt;param-name&gt;allowCredentials&lt;/param-name&gt;
        &lt;param-value&gt;true&lt;/param-value&gt;
    &lt;/init-param&gt;
    &lt;init-param&gt;
        &lt;description&gt;
            Allowed Headers - (Optional) -
            A list of HTTP headers which if included in the request
            DO NOT make it abort
        &lt;/description&gt;
        &lt;param-name&gt;headers&lt;/param-name&gt;
        &lt;param-value&gt;headerOne,headerTwo,headerThree&lt;/param-value&gt;
    &lt;/init-param&gt;
    &lt;init-param&gt;
        &lt;description&gt;
            Expected Hostname - (Optional) -
            The name of the host expected in the request Host header
        &lt;/description&gt;
        &lt;param-name&gt;expectedHostname&lt;/param-name&gt;
        &lt;param-value&gt;http://openam.example.com&lt;/param-value&gt;
    &lt;/init-param&gt;
    &lt;init-param&gt;
        &lt;description&gt;
            Exposed Headers - (Optional) -
            The list of headers which the user-agent can expose
            to its CORS client
        &lt;/description&gt;
        &lt;param-name&gt;exposeHeaders&lt;/param-name&gt;
        &lt;param-value&gt;exposeHeaderOne,exposeHeaderTwo&lt;/param-value&gt;
    &lt;/init-param&gt;
    &lt;init-param&gt;
        &lt;description&gt;
            Maximum Cache Age - (Optional) -
            The maximum time that the CORS client can cache
            the pre-flight response, in seconds [default 600]
        &lt;/description&gt;
        &lt;param-name&gt;maxAge&lt;/param-name&gt;
        &lt;param-value&gt;600&lt;/param-value&gt;
    &lt;/init-param&gt;
&lt;/filter&gt;
</pre><p>
     For details on CORS, see the
     <a class="link" href="http://www.w3.org/TR/cors/" target="_blank"><em class="citetitle">Cross-Origin Resource Sharing</em></a>
     specification.
    </p></li><li class="listitem"><p>
     Pack up the OpenAM .war file to deploy.
    </p><div class="screen"><pre>
$ <strong>jar -cf ../openam.war *</strong>
    </pre></div></li><li class="listitem"><p>Deploy the new .war file.</p><p>
     In this example the .war file to deploy is
     <code class="filename">/tmp/openam.war</code>.
    </p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="prepare-apache-tomcat"></a>1.8.&nbsp;Preparing Apache Tomcat</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#d12792e1239">1.8.1. Tuning Apache Multi-Processing Modules</a></span></dt></dl></div><a class="indexterm" name="d12792e1199"></a><p>
   OpenAM examples often use Apache Tomcat as the deployment container.
   Tomcat is installed on <code class="literal">openam.example.com</code>,
   and listens on the default ports,
   with no Java Security Manager enabled.
  </p><p>
   OpenAM core services require a minimum JVM heap size of 1 GB,
   and a permanent generation size of 256 MB.
   If you are including the embedded OpenDJ directory,
   OpenAM requires at least a 2 GB heap,
   as 50% of that space is allocated to OpenDJ.
   See <a class="xref" href="#prepare-java" title="1.2.&nbsp;Preparing a Java Environment">Section&nbsp;1.2, &#8220;Preparing a Java Environment&#8221;</a> for details.
  </p><p>
   ForgeRock recommends that you edit the Tomcat &lt;Connector&gt; configuration
   to set <code class="literal">URIEncoding="UTF-8"</code>.
   UTF-8 URI encoding ensures that URL-encoded characters
   in the paths of URIs are correctly decoded by the container.
   This is particularly useful when applications use the OpenAM REST APIs,
   and some identifiers such as user names can contain special characters.
  </p><p>
   &lt;Connector&gt; configuration elements are found in the configuration file,
   <code class="filename">/path/to/tomcat/conf/server.xml</code>.
   The following excerpt shows an example &lt;Connector&gt;
   with the <code class="literal">URIEncoding</code> attribute set appropriately.
  </p><pre class="brush: xml;">
&lt;Connector port="8443" protocol="HTTP/1.1" SSLEnabled="true"
              maxThreads="150" scheme="https" secure="true"
              clientAuth="false" sslProtocol="TLS" URIEncoding="UTF-8" /&gt;
  </pre><p>
   The following example script, <code class="filename">/etc/init.d/tomcat</code>,
   manages the service at system startup and shutdown.
   This script assumes you run OpenAM as the user <code class="literal">openam</code>.
  </p><pre class="brush: shell;">
#!/bin/sh
#
# tomcat
#
# chkconfig: 345 95 5
# description: Manage Tomcat web application container
CATALINA_HOME="/path/to/tomcat"
export CATALINA_HOME
JAVA_HOME=/path/to/jdk
export JAVA_HOME
CATALINA_OPTS="-server -Xmx2048m -XX:MaxPermSize=256m"
export CATALINA_OPTS

case "${1}" in
start)
  /bin/su openam -c "${CATALINA_HOME}/bin/startup.sh"
  exit ${?}
  ;;
stop)
  /bin/su openam -c "${CATALINA_HOME}/bin/shutdown.sh"
  exit ${?}
  ;;
*)
  echo "Usage:  $0 { start | stop }"
  exit 1
  ;;
esac
  </pre><div lang="en" class="section"><div class="titlepage"><div><div><h3 class="title"><a name="d12792e1239"></a>1.8.1.&nbsp;Tuning Apache Multi-Processing Modules</h3></div></div></div><a class="indexterm" name="d12792e1242"></a><a class="indexterm" name="d12792e1247"></a><p>
  Apache 2.0 and later comes with Multi-Processing Modules (MPMs) that extend
  the basic functionality of a web server to support the wide variety of operating
  systems and customizations for a particular site.
 </p><p>
  The key area of performance tuning for Apache is
  to run in worker mode ensuring that they are enough processes and threads
  available to service the expected number of client requests. Apache performance
  is configured in the <code class="filename">conf/extra/http-mpm.conf</code> file.</p><p>
  The key properties in this file are <code class="literal">ThreadsPerChild</code> and
  <code class="literal">MaxClients</code>.
  Together the properties control the maximum number of concurrent requests that can
  be processed by Apache. The default configuration allows for 150 concurrent
  clients spread across 6 processes of 25 threads each.</p><div class="screen"><pre>
&lt;IfModule mpm_worker_module&gt;
   StartServers          2
   MaxClients          150
   MinSpareThreads      25
   MaxSpareThreads      75
   ThreadsPerChild      25
   MaxRequestsPerChild   0
&lt;/IfModule&gt;
 </pre></div><div class="important"><h3 class="title">Important</h3><p>
   For the policy agent notification feature, the <code class="literal">MaxSpareThreads</code>,
   <code class="literal">ThreadLimit</code> and <code class="literal">ThreadsPerChild</code> default values
   must <span class="emphasis"><em>not</em></span> be altered; otherwise
   the notification queue listener thread cannot be registered.
  </p><p>
   Any other values apart from these three in the worker MPM can be customized.
   For example, it is possible to use a combination of <code class="literal">MaxClients</code>
   and <code class="literal">ServerLimit</code> to achieve a high level of concurrent clients.
  </p></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="prepare-jboss-7"></a>1.9.&nbsp;Preparing OpenAM &amp; JBoss AS 7 / EAP 6</h2></div></div></div><a class="indexterm" name="d12792e1298"></a><p>Some preparation is required to deploy OpenAM on JBoss AS 7 / EAP 6.</p><p>The following instructions provide guidance for both standalone and domain deployments.
    OpenAM must be able to store its configuration between restarts. The procedures listed here are
    workarounds for JBoss AS 7.1.2 / 7.1.3, and the corresponding versions of JBoss EAP (6.0.0, 6.0.1).
    Workarounds are also needed for JBoss EAP 6.1.0/6.1.1.
    To identify the versions of JBoss EAP that have been built from JBoss
    AS, see the following article on <a class="link" href="https://access.redhat.com/site/articles/112673" target="_blank"><em class="citetitle">JBoss Enterprise Application Platform Component Details</em></a>.</p><p>Once JBoss has been configured, you can then prepare OpenAM for deployment, by making a few changes
    to the contents of the OpenAM <code class="filename">.war</code> archive.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="#prep-jboss-710-711" title="Procedure&nbsp;1.2.&nbsp;To Prepare JBoss AS 7.1.0 / 7.1.1">Procedure&nbsp;1.2, &#8220;To Prepare JBoss AS 7.1.0 / 7.1.1&#8221;</a></p></li><li class="listitem"><p><a class="xref" href="#prep-jboss-600-601" title="Procedure&nbsp;1.3.&nbsp;Alternative Method: To Prepare JBoss EAP 6.0.0 and 6.0.1">Procedure&nbsp;1.3, &#8220;Alternative Method: To Prepare JBoss EAP 6.0.0 and 6.0.1&#8221;</a></p></li><li class="listitem"><p><a class="xref" href="#prep-jboss-61x" title="Procedure&nbsp;1.4.&nbsp;To Prepare JBoss EAP 6.1.0 and 6.1.1">Procedure&nbsp;1.4, &#8220;To Prepare JBoss EAP 6.1.0 and 6.1.1&#8221;</a></p></li><li class="listitem"><p><a class="xref" href="#prep-jboss-for-openam" title="Procedure&nbsp;1.5.&nbsp;To Prepare JBoss for OpenAM">Procedure&nbsp;1.5, &#8220;To Prepare JBoss for OpenAM&#8221;</a></p></li><li class="listitem"><p><a class="xref" href="#prep-openam-for-jboss" title="Procedure&nbsp;1.6.&nbsp;To Prepare OpenAM for JBoss">Procedure&nbsp;1.6, &#8220;To Prepare OpenAM for JBoss&#8221;</a></p></li></ul></div><div class="procedure"><a name="prep-jboss-710-711"></a><div class="procedure-title">Procedure&nbsp;1.2.&nbsp;To Prepare JBoss AS 7.1.0 / 7.1.1</div><p>For JBoss AS 7.1.0 / 7.1.1, you need to make changes to the <code class="filename">module.xml</code>
                file in the <code class="filename">/path/to/jboss/modules/sun/jdk/main</code> directory, as well as changes
                to a configuration file associated with JBoss standalone or domain modes.</p><ol class="procedure" type="1"><li class="step"><p>Stop JBoss</p></li><li class="step"><p>Update the <code class="filename">module.xml</code> file associated with the container. You can
                    find this file a directory such as <code class="filename">/path/to/jboss/modules/sun/jdk/main</code>.</p></li><li class="step"><p>In the same <code class="filename">module.xml</code> file, add the Sun x509 security module path
                    (<code class="literal">sun/security/x509</code>).</p><p>The following example shows an excerpt of the revised file for JBoss AS 7.1.0.</p><pre class="brush: xml;">&lt;path name="com/sun/security/auth"/&gt;
&lt;path name="com/sun/security/auth/login"/&gt;
&lt;path name="com/sun/security/auth/module"/&gt;
&lt;path name ="sun/security/x509"/&gt; &lt;!-- path added here --&gt;
&lt;path name="sun/misc"/&gt;</pre></li><li class="step"><p>When using <span class="command"><strong>ssoadm</strong></span> or the distributed
                    authentication service (DAS), also add the following path to the aforementioned
                    <code class="filename">module.xml</code> file.</p><pre class="literallayout">&lt;path name="com/sun/org/apache/xerces/internal/dom" /&gt;</pre></li><li class="step"><a name="jboss711-disable-conflicts"></a><p>Disable modules that conflict with OpenAM REST libraries. All jaxrs
                    references need to be removed from the configuration. The file that you modify
                    depends on whether you are running JBoss in standalone or domain mode.</p><ul class="stepalternatives">
                    <li class="step"><p>The following example is based on JBoss 7.1.0 standalone mode. Remember to
                            remove all subsystems and extension tags associated with <code class="literal">urn:jboss:domain:jaxrs:1.0</code>.</p><div class="screen"><pre>
$ <strong>vi /path/to/jboss/standalone/configuration/standalone.xml</strong>
<em>&lt;extension module="org.jboss.as.ejb3"/&gt;
-  &lt;extension module="org.jboss.as.jaxrs"/&gt;
....
-  &lt;subsystem xmlns="urn:jboss:domain:jaxrs:1.0"/&gt;
&lt;subsystem xmlns="urn:jboss:domain:jca:1.1"&gt;</em>
                        </pre></div></li>
                    <li class="step"><p>The following example is based on JBoss 7.1.0 for a managed domain.</p><div class="screen"><pre>
$ <strong>vi /path/to/jboss7/domain/configuration/domain.xml</strong>
<em>&lt;extension module="org.jboss.as.ejb3"/&gt;
-  &lt;extension module="org.jboss.as.jaxrs"/&gt;
....
-  &lt;subsystem xmlns="urn:jboss:domain:jaxrs:1.0"/&gt;
&lt;subsystem xmlns="urn:jboss:domain:jca:1.1"&gt;</em>
                        </pre></div></li>
                </ul></li><li class="step"><a name="jboss711-delete-webservices"></a><p>In either the <code class="filename">standalone.xml</code> or <code class="filename">domain.xml</code>
                    files, you will also need to delete <code class="literal">org.jboss.as.webservices</code> references.
                    Depending on the file, this includes one or more groups of <code class="literal">subsystem</code> lines
                    such as:</p><pre class="brush: xml;">
&lt;subsystem xmlns="urn:jboss:domain:webservices:1.1"/&gt;
....
&lt;/subsystem&gt;
                </pre></li><li class="step"><p>You are now ready to prepare OpenAM as described in <a class="xref" href="#prep-openam-for-jboss" title="Procedure&nbsp;1.6.&nbsp;To Prepare OpenAM for JBoss">Procedure&nbsp;1.6, &#8220;To Prepare OpenAM for JBoss&#8221;</a>.</p></li></ol></div><div class="procedure"><a name="prep-jboss-600-601"></a><div class="procedure-title">Procedure&nbsp;1.3.&nbsp;Alternative Method: To Prepare JBoss EAP 6.0.0 and 6.0.1</div><a class="indexterm" name="d12792e1439"></a><a class="indexterm" name="d12792e1444"></a><p>JBoss EAP 6.0.0 and 6.0.1 are built from JBoss AS 7.1.2 and 7.1.3, respectively. The same techniques
                described in the <a class="xref" href="#prep-jboss-710-711" title="Procedure&nbsp;1.2.&nbsp;To Prepare JBoss AS 7.1.0 / 7.1.1">Procedure&nbsp;1.2, &#8220;To Prepare JBoss AS 7.1.0 / 7.1.1&#8221;</a> section work here as well. One alternative
                method is available, as described in this section.</p><ol class="procedure" type="1"><li class="step"><p>Stop JBoss.</p></li><li class="step"><p>Update the <code class="filename">openam.war</code> before deploying OpenAM.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Create a temporary directory and expand the <code class="filename">openam.war</code>.</p><div class="screen"><pre>
$ <strong>mkdir /tmp/openam ; cd /tmp/openam</strong>
$ <strong>jar xvf /path/to/OpenAM-12.0.0.war</strong>
                        </pre></div></li><li class="listitem"><p>Create a new <code class="filename">jboss-deployment-structure.xml</code> file in the
                            <code class="filename">WEB-INF</code> subdirectory so that it appears as follows, and save
                            the change.</p><pre class="brush: xml;">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
 &lt;jboss-deployment-structure xmlns="urn:jboss:deployment-structure:1.2"&gt;
  &lt;deployment&gt;
   &lt;exclusions&gt;
    &lt;module name="sun.jdk" /&gt;
   &lt;/exclusions&gt;
   &lt;exclude-subsystems&gt;
    &lt;subsystem name="jaxrs" /&gt;
    &lt;subsystem name="webservices" /&gt;
   &lt;/exclude-subsystems&gt;
  &lt;dependencies&gt;
   &lt;module name="sun.jdk" &gt;
    &lt;imports&gt;
     &lt;exclude-set&gt;
&lt;path name="com/sun/org/apache/xml/internal/security/transforms/implementations"/&gt;
     &lt;/exclude-set&gt;
    &lt;/imports&gt;
   &lt;/module&gt;
   &lt;system&gt;
    &lt;paths&gt;
     &lt;path name="sun/security/x509" /&gt;
     &lt;path name="com/sun/org/apache/xpath/internal" /&gt;
     &lt;path name="com/sun/org/apache/xerces/internal/dom" /&gt;
     &lt;path name="com/sun/org/apache/xml/internal/utils" /&gt;
    &lt;/paths&gt;
   &lt;/system&gt;
  &lt;/dependencies&gt;
 &lt;/deployment&gt;
&lt;/jboss-deployment-structure&gt;</pre></li><li class="listitem"><p>Rebuild the <code class="filename">openam.war</code> file.</p><div class="screen"><pre>
$ <strong>jar cvf ../openam.war *</strong>
                     </pre></div></li></ol></div></li><li class="step"><p>You will want to make at least one more change to the <code class="filename">openam.war</code> file before
                    deployment, as described in <a class="xref" href="#prep-openam-for-jboss" title="Procedure&nbsp;1.6.&nbsp;To Prepare OpenAM for JBoss">Procedure&nbsp;1.6, &#8220;To Prepare OpenAM for JBoss&#8221;</a>.</p></li><li class="step"><p>You do not need to make any of the other changes to XML files described in this section.
                    As JBoss EAP 6.0.0 and 6.0.1 was built from JBoss AS 7.1.2 and AS 7.1.3, respectively, this
                    procedure may also work on those versions of JBoss.</p></li></ol></div><div class="procedure"><a name="prep-jboss-61x"></a><div class="procedure-title">Procedure&nbsp;1.4.&nbsp;To Prepare JBoss EAP 6.1.0 and 6.1.1</div><a class="indexterm" name="d12792e1513"></a><a class="indexterm" name="d12792e1518"></a><ol class="procedure" type="1"><li class="step"><p>For JBoss EAP 6.1.0 / 6.1.1, follow <a class="xref" href="#jboss711-disable-conflicts" title="Step 5">Step 5</a>
                and <a class="xref" href="#jboss711-delete-webservices" title="Step 6">Step 6</a> from
                    <a class="xref" href="#prep-jboss-710-711" title="Procedure&nbsp;1.2.&nbsp;To Prepare JBoss AS 7.1.0 / 7.1.1">Procedure&nbsp;1.2, &#8220;To Prepare JBoss AS 7.1.0 / 7.1.1&#8221;</a>.</p></li><li class="step"><p>However, you still need to review <a class="xref" href="#prep-jboss-for-openam" title="Procedure&nbsp;1.5.&nbsp;To Prepare JBoss for OpenAM">Procedure&nbsp;1.5, &#8220;To Prepare JBoss for OpenAM&#8221;</a> and
                    <a class="xref" href="#prep-openam-for-jboss" title="Procedure&nbsp;1.6.&nbsp;To Prepare OpenAM for JBoss">Procedure&nbsp;1.6, &#8220;To Prepare OpenAM for JBoss&#8221;</a> to make sure the JVM and directories are
                    configured appropriately.</p></li></ol></div><div class="procedure"><a name="prep-jboss-for-openam"></a><div class="procedure-title">Procedure&nbsp;1.5.&nbsp;To Prepare JBoss for OpenAM</div><a class="indexterm" name="d12792e1543"></a><p>The default JBoss settings for JVM do not give sufficient memory to OpenAM. This procedure
                documents one method that you can use to modify JBoss. Other methods described in <a class="link" href="http://www.jboss.org/jbossas/docs" target="_blank">
               <em class="citetitle">JBoss Main Documentation Page</em></a>.</p><ol class="procedure" type="1"><li class="step"><p>Stop JBoss.</p></li><li class="step"><p>Open an appropriate JBoss configuration file. This procedure describes the use of the
                    <code class="filename">standalone.conf</code> file in the <code class="filename">/path/to/jboss/bin</code>
                    directory for JBoss in standalone mode.</p></li><li class="step"><p>Check the JVM settings associated with <code class="literal">JAVA_OPTS</code>. For JBoss AS 7.1.0 and AS 7.1.1,
                    you should change the JVM heap size to <code class="literal">-Xmx1024m</code>. The default JVM heap size and permanent
                    generation settings for later versions of JBoss may already exceed recommended values (-Xmx1024m,
                    -XX:MaxPermSize=256m). If you are using the embedded version of OpenDJ, the minimum heap size may
                    be higher. For details on the JVM options to use, see <a class="xref" href="#prepare-java" title="1.2.&nbsp;Preparing a Java Environment">Section&nbsp;1.2, &#8220;Preparing a Java Environment&#8221;</a>.</p></li><li class="step"><p>Set the following JVM <code class="literal">JAVA_OPTS</code> setting in the same file.</p><pre class="brush: plain;">-Dorg.apache.tomcat.util.http.ServerCookie.ALWAYS_ADD_EXPIRES=true</pre><p>Make sure that headers include the <code class="literal">Expires</code>
                    attribute rather than only <code class="literal">Max-Age</code>, as some versions
                    of Internet Explorer do not support <code class="literal">Max-Age</code>.</p></li><li class="step"><p>Now deploy the <code class="filename">openam.war</code> file into the appropriate JBoss deployment directory.
                    The directory varies depending on whether you are running in standalone or domain mode.</p></li><li class="step"><p>You do not need to make any of the other changes to XML files described in this section.
                    As JBoss EAP 6.0.0 and 6.0.1 was built from JBoss AS 7.1.2 and AS 7.1.3, respectively, this
                    procedure may also work on those versions of JBoss.</p></li></ol></div><div class="procedure"><a name="prep-openam-for-jboss"></a><div class="procedure-title">Procedure&nbsp;1.6.&nbsp;To Prepare OpenAM for JBoss</div><a class="indexterm" name="d12792e1609"></a><p>To take full advantage of JBoss with OpenAM, you should make a couple of changes to the
                OpenAM <code class="filename">war</code> file. One problem is that JBoss will deploy applications from
                different temporary directories every time you restart the container, which would require
                reconfiguring OpenAM. To avoid this issue, take the following steps:</p><ol class="procedure" type="1"><li class="step"><p>If you have not already done so, create a temporary directory and
                    expand the <code class="filename">openam.war</code>.</p><div class="screen"><pre>
$ <strong>cd /tmp</strong>
$ <strong>mkdir /tmp/openam ; cd /tmp/openam</strong>
$ <strong>jar xvf ~/Downloads/OpenAM-12.0.0.war</strong>
                </pre></div></li><li class="step"><p>Update the <code class="literal"># configuration.dir=</code> line in the
                    <code class="filename">bootstrap.properties</code> file so that it appears as follows,
                    and save the change.</p><pre class="brush: ini;">
# This property should also be used when the system user that
# is running the web/application server process does not have
# a home directory. i.e. System.getProperty("user.home") returns
# null.

configuration.dir=$HOME/openamJboss
                </pre></li><li class="step"><p>Rebuild the <code class="filename">openam.war</code> file.</p><div class="screen"><pre>
$ <strong>jar cvf ../openam.war *</strong>
                </pre></div></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="prepare-oracle-weblogic"></a>1.10.&nbsp;Preparing Oracle WebLogic</h2></div></div></div><a class="indexterm" name="idx-weblogic"></a><p>Before you deploy OpenAM, update the JVM options as described in
   <a class="xref" href="#prepare-java" title="1.2.&nbsp;Preparing a Java Environment">Section&nbsp;1.2, &#8220;Preparing a Java Environment&#8221;</a>.</p><div class="orderedlist"><p>
     Next, edit the WebLogic domain configuration
     to allow basic authentication credentials to be passed back to OpenAM.
     By default, WebLogic attempts to resolve authentication credentials itself.
     When you change the WebLogic domain configuration, you make sure that
     the OpenAM OAuth 2.0 providers receive basic authentication credentials
     for OAuth 2.0 grants that rely on basic authentication.
    </p><ol class="orderedlist" type="1"><li class="listitem"><p>
      Stop the WebLogic server.
     </p></li><li class="listitem"><p>
      Edit the WebLogic domain configuration,
      <code class="filename">/path/to/wlsdomain/config/config.xml</code>,
      setting <code class="literal">&lt;enforce-valid-basic-auth-credentials&gt;</code>
      to <code class="literal">false</code> in the
      <code class="literal">&lt;security-configuration</code> element.
     </p><pre class="brush: xml;">&lt;security-configuration&gt;
    &lt;enforce-valid-basic-auth-credentials&gt;false
    &lt;/enforce-valid-basic-auth-credentials&gt;
 &lt;/security-configuration&gt;</pre></li></ol></div><div class="orderedlist"><p>Weblogic uses its own classes if a class exists in both the parent
         and child classloaders by default.
         To use OpenAM and its classes on WebLogic 11g,
            create a WebLogic deployment descriptor file <code class="literal">weblogic.xml</code>
            and place it in the <code class="literal">/WEB-INF</code> directory.
            The descriptor file maps resources defined for OpenAM.
        </p><ol class="orderedlist" type="1"><li class="listitem"><p>Create a WebLogic descriptor file, <code class="literal">/WEB-INF/weblogic.xml</code>.</p><pre class="brush: xml;">
 &lt;?xml version="1.0" encoding="UTF-8"?&gt;
   &lt;weblogic-web-app xmlns="http://xmlns.oracle.com/weblogic/weblogic-web-app"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation="http://xmlns.oracle.com/weblogic/weblogic-web-app
      http://xmlns.oracle.com/weblogic/weblogic-web-app/1.3/weblogic-web-app.xsd"&gt;
         &lt;context-root&gt;/openam&lt;/context-root&gt;
         &lt;container-descriptor&gt;
            &lt;prefer-web-inf-classes&gt;true&lt;/prefer-web-inf-classes&gt;
         &lt;/container-descriptor&gt;
   &lt;/weblogic-web-app&gt;</pre></li><li class="listitem"><p>
      Start the WebLogic server.
     </p></li></ol></div><p>
     When deploying OpenAM on WebLogic 11g (version 10.3.x),
     use the SOAP with Attachments API for Java (SAAJ) implementation
     from the Java Runtime Environment, rather than the WebLogic implementation.

     The WebLogic implementation can cause OpenAM to throw exceptions with the
     message <code class="literal">java.lang.UnsupportedOperationException:
     This class does not support SAAJ 1.1</code>,
     and to fail to authenticate users in some cases.

     No change is necessary when deploying OpenAM on WebLogic 12c.
    </p><p>
     To use the Sun/Oracle Java SAAJ implementation,
     edit the WebLogic start up script for the domain where OpenAM runs, such as
     <code class="filename">/path/to/weblogic/user_projects/domains/wlsdomain/startWebLogic.sh</code>.

     Change the following line:

     </p><pre class="brush: shell;">${DOMAIN_HOME}/bin/startWebLogic.sh $*</pre><p>

     To set the <code class="literal">javax.xml.soap.MessageFactory</code> property:

     </p><pre class="brush: shell;">${DOMAIN_HOME}/bin/startWebLogic.sh \
 -Djavax.xml.soap.MessageFactory=\
 com.sun.xml.internal.messaging.saaj.soap.ver1_1.SOAPMessageFactory1_1Impl $*</pre><p>
    </p><p>
     When using WebLogic 12.1.1 with Java 6,
     if you plan to use the <span class="command"><strong>ssoadm</strong></span> command to configure OpenAM,
     then make the following change to the start up script,
     <code class="filename">startWebLogic.sh</code>,
     to avoid exceptions and incorrect results.
     Change the following line:
    </p><pre class="literallayout">${DOMAIN_HOME}/startWebLogic.sh</pre><p>
     To this:
    </p><pre class="literallayout">${DOMAIN_HOME}/bin/startWebLogic.sh \
 -Djavax.xml.soap.MessageFactory=\
 com.sun.xml.internal.messaging.saaj.soap.ver1_1.SOAPMessageFactory1_1Impl $*</pre><p>
     Restart WebLogic for the change to take effect.
    </p><a class="indexterm" name="d12792e1749"></a></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="prepare-ibm-websphere"></a>1.11.&nbsp;Preparing IBM WebSphere</h2></div></div></div><a class="indexterm" name="d12792e1757"></a><p>Before you deploy OpenAM, use the Administrator console to update
   JVM options as described in <a class="xref" href="#prepare-java" title="1.2.&nbsp;Preparing a Java Environment">Section&nbsp;1.2, &#8220;Preparing a Java Environment&#8221;</a>.</p><div class="orderedlist"><p>In addition, configure WebSphere to load classes from OpenAM bundled
    libraries before loading classes from libraries delivered with WebSphere.
    The following steps must be completed after you deploy OpenAM into
    WebSphere.</p><ol class="orderedlist" type="1"><li class="listitem"><p>In WebSphere administration console, browse to Application &gt;
     Application Type &gt; WebSphere enterprise applications &gt; <em class="replaceable"><code>OpenAM
     Name</code></em> &gt; Class loading and update detection.</p></li><li class="listitem"><p>Set Class loader order &gt; Classes loaded with local class loader first
     (parent last).</p></li><li class="listitem"><p>Set WAR class loader policy &gt; Single class loader for application.</p></li><li class="listitem"><p>Save your work.</p></li></ol></div><div class="orderedlist"><p>Furthermore when using IBM Java, add the JAXP Reference Implementation
    .jar into the OpenAM .war file before deploying the .war into WebSphere as
    this required library is missing otherwise.</p><ol class="orderedlist" type="1"><li class="listitem"><p>Unpack the OpenAM .war file.</p><div class="screen"><pre>
 $ <strong>mkdir /tmp/openam</strong>
 $ <strong>cd /tmp/openam/</strong>
 $ <strong>jar -xf ~/Downloads/openam/OpenAM-12.0.0.war</strong>
     </pre></div></li><li class="listitem"><p>Add the JAXP Reference Implementation .jar in
     <code class="filename">WEB-INF/lib/</code>.</p><div class="screen"><pre>
 $ <strong>wget http://repo1.maven.org/maven2/com/sun/xml/parsers/jaxp-ri/1.4.5/jaxp-ri-1.4.5.jar</strong>
 $ <strong>mv jaxp-ri-1.4.5.jar WEB-INF/lib/</strong>
     </pre></div></li><li class="listitem"><p>Pack up the OpenAM .war file to deploy in WebSphere.</p><div class="screen"><pre>
 $ <strong>jar -cf ../openam.war *</strong>
     </pre></div></li><li class="listitem"><p>Deploy the new .war file.</p><p>In this case the .war file to deploy is
     <code class="filename">/tmp/openam.war</code>.</p></li></ol></div></div></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-install-core"></a>Chapter&nbsp;2.&nbsp;Installing OpenAM Core Services</h1></div></div></div><a class="indexterm" name="d12792e1835"></a><a class="indexterm" name="d12792e1840"></a><p>This chapter covers tasks required for a full install of OpenAM server
 with or without OpenAM Console.</p><p>This chapter does not cover installation for enforcing policies on
 resource servers. To manage access to resources on other servers, you can use
 OpenIG or OpenAM policy agents.</p><p><a class="link" href="http://openig.forgerock.org/" target="_blank">OpenIG</a>
 is a high-performance reverse proxy server with specialized session management
 and credential replay functionality. It can function as a standards-based 
 policy enforcement point.</p><p>
  OpenAM policy agents provide policy enforcement
  on supported web servers and Java EE containers,
  and are tightly integrated with OpenAM.
  See the
  <a class="link" href="http://docs.forgerock.org/en/openam-pa/3.3.0/web-users-guide/#web-users-guide" target="_blank"><em class="citetitle">OpenAM Web Policy Agent User's Guide</em></a>,
  or the
  <span class="olink"><em class="citetitle">OpenAM Java EE Policy Agent User's Guide</em></span>
  for instructions on installing OpenAM policy agents
  in supported web servers and Java EE application containers.
 </p><div class="table"><a name="decide-how-to-install"></a><div class="table-title">Table&nbsp;2.1.&nbsp;Deciding How To Install OpenAM</div><div class="table-contents"><table summary="Deciding How To Install OpenAM" width="100%" border="0"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th>If you want to...</th><th>Then see...</th></tr></thead><tbody><tr><td>Install quickly for evaluation using default settings</td><td>
      <p><a class="xref" href="#deploy-openam" title="Procedure&nbsp;2.1.&nbsp;To Deploy OpenAM">Procedure&nbsp;2.1, &#8220;To Deploy OpenAM&#8221;</a> and <a class="xref" href="#configure-openam-defaults" title="Procedure&nbsp;2.2.&nbsp;To Configure OpenAM With Defaults">Procedure&nbsp;2.2, &#8220;To Configure OpenAM With Defaults&#8221;</a></p>

      <p>Alternatively, follow the full example in the <a href="../getting-started/index.html#getting-started" class="link"><em class="citetitle">Getting
      Started</em></a> guide.</p>
     </td></tr><tr><td>Install OpenAM server and console, choosing settings</td><td><a class="xref" href="#deploy-openam" title="Procedure&nbsp;2.1.&nbsp;To Deploy OpenAM">Procedure&nbsp;2.1, &#8220;To Deploy OpenAM&#8221;</a> and <a class="xref" href="#configure-openam-custom" title="Procedure&nbsp;2.4.&nbsp;To Custom Configure OpenAM">Procedure&nbsp;2.4, &#8220;To Custom Configure OpenAM&#8221;</a></td></tr><tr><td>Erase the configuration and start over</td><td><a class="xref" href="#delete-config-start-over" title="Procedure&nbsp;2.3.&nbsp;To Delete an OpenAM Configuration Before Redeploying">Procedure&nbsp;2.3, &#8220;To Delete an OpenAM Configuration Before Redeploying&#8221;</a></td></tr><tr><td>Add an OpenAM server to a site</td><td><a class="xref" href="#deploy-openam" title="Procedure&nbsp;2.1.&nbsp;To Deploy OpenAM">Procedure&nbsp;2.1, &#8220;To Deploy OpenAM&#8221;</a>, and
     <a class="xref" href="#add-servers-to-site" title="Procedure&nbsp;2.5.&nbsp;To Add a Server to a Site">Procedure&nbsp;2.5, &#8220;To Add a Server to a Site&#8221;</a></td></tr><tr><td>Install OpenAM server only (no console)</td><td><a class="xref" href="#which-war-to-deploy" title="Table&nbsp;2.2.&nbsp;Determine Which War File to Deploy">Table&nbsp;2.2, &#8220;Determine Which War File to Deploy&#8221;</a>,
     <a class="xref" href="#deploy-openam" title="Procedure&nbsp;2.1.&nbsp;To Deploy OpenAM">Procedure&nbsp;2.1, &#8220;To Deploy OpenAM&#8221;</a>, and
     <a class="xref" href="#deploy-coreonly" title="Procedure&nbsp;2.6.&nbsp;To Deploy OpenAM Core Server (No Console)">Procedure&nbsp;2.6, &#8220;To Deploy OpenAM Core Server (No Console)&#8221;</a></td></tr><tr><td>Install <span class="command"><strong>ssoadm</strong></span> for CLI configuration</td><td><a href="../install-guide/index.html#chap-install-tools" class="link"><em class="citetitle">Installing
     OpenAM Tools</em></a>, or <a href="../admin-guide/index.html#openam-ssoadm-jsp-overview" class="link">OpenAM ssoadm.jsp</a>
     in the <em class="citetitle">Administration Guide</em></td></tr><tr><td>Perform a command-line install</td><td><a href="../install-guide/index.html#install-openam-config-tools" class="link"><em class="citetitle">To Set Up
     Configuration Tools</em></a></td></tr><tr><td>Install OpenAM in your DMZ</td><td><a href="../install-guide/index.html#chap-install-das" class="link"><em class="citetitle">Installing
     OpenAM Distributed Authentication</em></a></td></tr><tr><td>Skin OpenAM for your organization</td><td><a href="../install-guide/index.html#chap-custom-ui" class="link"><em class="citetitle">Customizing
     the OpenAM End User Pages</em></a></td></tr><tr><td>Uninstall OpenAM</td><td><a href="../install-guide/index.html#chap-uninstall" class="link"><em class="citetitle">Removing
     OpenAM Software</em></a></td></tr></tbody></table></div></div><br class="table-break"><p>Select the <code class="filename">.war</code> file based on the type of
  deployment you need, as defined in the following table.</p><div class="table"><a name="which-war-to-deploy"></a><div class="table-title">Table&nbsp;2.2.&nbsp;Determine Which War File to Deploy</div><div class="table-contents"><table summary="Determine Which War File to Deploy" width="100%" border="0"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th>If you want to...</th><th>Use...</th></tr></thead><tbody><tr><td>Install an OpenAM server including OpenAM Console</td><td><code class="filename">OpenAM-12.0.0.war</code></td></tr><tr><td>Install OpenAM server without OpenAM Console</td><td><code class="filename">OpenAM-ServerOnly-12.0.0.war</code></td></tr><tr><td>Install OpenAM distributed authentication UI</td><td><code class="filename">OpenAM-DistAuth-12.0.0.war</code></td></tr></tbody></table></div></div><br class="table-break"><div class="procedure"><a name="deploy-openam"></a><div class="procedure-title">Procedure&nbsp;2.1.&nbsp;To Deploy OpenAM</div><a class="indexterm" name="d12792e2000"></a><p>The <code class="filename">OpenAM-12.0.0.war</code> file contains OpenAM
  server with OpenAM Console. How you deploy the .war file depends on your web
  application container.</p><ol class="procedure" type="1"><li class="step"><p>Deploy the .war file on your container.</p><p>For example, copy the file to deploy on Apache Tomcat.</p><div class="screen"><pre>$ cp OpenAM-12.0.0.war /path/to/tomcat/webapps/openam.war</pre></div><p>You change the file name to <code class="filename">openam.war</code> when
   deploying in Tomcat so that the deployment URI is
   <code class="literal">/openam</code>.</p><div class="note"><h3 class="title">Note</h3><p>
     In order to be properly configured, OpenAM requires a deployment URI
     with a non-empty string after <code class="literal">/</code>.

     Do not deploy OpenAM at the root context.

     Do not rename the .war file to <code class="filename">ROOT.war</code>
     before deploying on Tomcat, for example.
    </p></div><p>It can take several seconds for OpenAM to be deployed in your
   container.</p></li><li class="step"><p>Browse to the initial configuration screen, for example at
   <code class="literal">http://openam.example.com:8080/openam</code>.</p><div class="mediaobject" align="center"><a name="figure-openam-start"></a><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/openam-start.png" align="middle" height="360" alt="Initial OpenAM configuration screen"></td></tr></table><div class="longdesc-link" align="right"><br clear="all"><span class="longdesc-link">[<a href="figure-openam-start.html" target="longdesc">D</a>]</span></div></div></li></ol></div><div class="procedure"><a name="configure-openam-defaults"></a><div class="procedure-title">Procedure&nbsp;2.2.&nbsp;To Configure OpenAM With Defaults</div><a class="indexterm" name="d12792e2053"></a><p>The default configuration option configures the embedded OpenDJ server
  using default ports&#8212;if the ports are already in use, OpenAM uses
  free ports&#8212;as both configuration store and identity store.</p><p>The default configuration sets the cookie domain based on the fully
  qualified domain name of the system. For an FQDN
  <code class="literal">openam.example.com</code>, the cookie domain is set to
  <code class="literal">.example.com</code>.</p><p>Configuration settings are saved to the home directory of the user
  running the web application container in a directory named after the
  deployment URI. In other words if OpenAM is deployed under
  <code class="literal">/openam</code>, then the configuration is saved under
  <code class="filename">$HOME/openam/</code>.</p><ol class="procedure" type="1"><li class="step"><p>In the initial configuration screen, click
   Create Default Configuration under Default Configuration.</p></li><li class="step"><p>Review the software license agreement. If you agree to the license,
       click "I accept the license agreement", and then click Continue.</p><div class="mediaobject" align="center"><a name="figure-openam-license"></a><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/openam-license-dialog.png" align="middle" height="360" alt="OpenAM default configuration license"></td></tr></table><div class="longdesc-link" align="right"><br clear="all"><span class="longdesc-link">[<a href="figure-openam-license.html" target="longdesc">D</a>]</span></div></div></li><li class="step"><p>Provide different passwords for the default OpenAM administrator,
   <code class="literal">amadmin</code>, and default Policy Agent users.</p><div class="mediaobject" align="center"><a name="figure-openam-default-conf"></a><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/openam-default-conf.png" align="middle" height="360" alt="OpenAM default configuration"></td></tr></table><div class="longdesc-link" align="right"><br clear="all"><span class="longdesc-link">[<a href="figure-openam-default-conf.html" target="longdesc">D</a>]</span></div></div></li><li class="step"><p>When the configuration completes, click Proceed to Login, and then
   login as the OpenAM administrator with the first of the two passwords you
   provided.</p><div class="mediaobject" align="center"><a name="figure-openam-first-login"></a><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/openam-first-login.png" align="middle" height="360" alt="OpenAM first login"></td></tr></table><div class="longdesc-link" align="right"><br clear="all"><span class="longdesc-link">[<a href="figure-openam-first-login.html" target="longdesc">D</a>]</span></div></div><p>After successful login, OpenAM redirects you to OpenAM Console.</p><div class="mediaobject" align="center"><a name="figure-openam-console-first-time"></a><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/openam-console.png" align="middle" height="360" alt="OpenAM Console home page"></td></tr></table><div class="longdesc-link" align="right"><br clear="all"><span class="longdesc-link">[<a href="figure-openam-console-first-time.html" target="longdesc">D</a>]</span></div></div></li></ol></div><div class="procedure"><a name="delete-config-start-over"></a><div class="procedure-title">Procedure&nbsp;2.3.&nbsp;To Delete an OpenAM Configuration Before Redeploying</div><a class="indexterm" name="d12792e2134"></a><a class="indexterm" name="d12792e2139"></a><p>If you are unhappy with your configuration and want to start over from
  the beginning, follow these steps.</p><ol class="procedure" type="1"><li class="step"><p>Stop the OpenAM web application to clear the configuration held
   in memory.</p><p>The following example shuts down Tomcat for example.</p><div class="screen"><pre>$ /path/to/tomcat/bin/shutdown.sh
Password: 
Using CATALINA_BASE:   /path/to/tomcat
Using CATALINA_HOME:   /path/to/tomcat
Using CATALINA_TMPDIR: /path/to/tomcat/temp
Using JRE_HOME:        /path/to/jdk/jre
Using CLASSPATH:
       /path/to/tomcat/bin/bootstrap.jar:/path/to/tomcat/bin/tomcat-juli.jar</pre></div></li><li class="step"><p>Delete OpenAM configuration files, by default under the
   <code class="filename">$HOME</code> of the user running the web application
   container.</p><div class="screen"><pre>$ rm -rf $HOME/openam $HOME/.openamcfg</pre></div><p>When using the internal OpenAM configuration store, this step
   deletes the embedded directory server and all of its contents. This is why
   you stop the application server before removing the configuration.</p><p>If you use an external configuration store, also delete the entries
   under the configured OpenAM suffix (by default
   dc=openam,dc=forgerock,dc=org).</p></li><li class="step"><p>Restart the OpenAM web application.</p><p>The following example starts the Tomcat container.</p><div class="screen"><pre>$ /path/to/tomcat/bin/startup.sh
Password: 
Using CATALINA_BASE:   /path/to/tomcat
Using CATALINA_HOME:   /path/to/tomcat
Using CATALINA_TMPDIR: /path/to/tomcat/temp
Using JRE_HOME:        /path/to/jdk/jre
Using CLASSPATH:
       /path/to/tomcat/bin/bootstrap.jar:/path/to/tomcat/bin/tomcat-juli.jar</pre></div></li></ol></div><div class="procedure"><a name="configure-openam-custom"></a><div class="procedure-title">Procedure&nbsp;2.4.&nbsp;To Custom Configure OpenAM</div><a class="indexterm" name="d12792e2177"></a><ol class="procedure" type="1"><li class="step"><p>In the initial configuration screen, click
   Create New Configuration under Custom Configuration.</p></li><li class="step"><p>Read the license agreement. If you agree to the license, click
   "I agree to the license agreement", and then click Continue.</p></li><li class="step"><p>On the Default User Password page, provide a password having at least
    8 characters for the OpenAM Administrator, <code class="literal">amadmin</code>.</p><div class="mediaobject" align="center"><a name="figure-openam-conf-amadmin"></a><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/openam-conf-amadmin.png" align="middle" height="360" alt="OpenAM amadmin password"></td></tr></table><div class="longdesc-link" align="right"><br clear="all"><span class="longdesc-link">[<a href="figure-openam-conf-amadmin.html" target="longdesc">D</a>]</span></div></div></li><li class="step"><p>Make sure the server settings are valid for your configuration.</p><div class="mediaobject" align="center"><a name="figure-openam-conf-server-settings"></a><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/openam-conf-server-settings.png" align="middle" height="360" alt="OpenAM server settings"></td></tr></table><div class="longdesc-link" align="right"><br clear="all"><span class="longdesc-link">[<a href="figure-openam-conf-server-settings.html" target="longdesc">D</a>]</span></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">Server URL</span></dt><dd><p>Provide a valid URL to the base of your OpenAM web
      container, including a fully qualified domain name (FQDN).</p><p>In a test environment, you can fake the FQDN by adding it to
      your <code class="filename">/etc/hosts</code> as an alias. The following excerpt
      shows lines from the <code class="filename">/etc/hosts</code> file on a Linux
      system where OpenAM is installed.</p><pre class="brush: plain;">127.0.0.1 localhost.localdomain localhost
::1 localhost6.localdomain6 localhost6
127.0.1.1 openam openam.example.com</pre></dd><dt><span class="term">Cookie Domain</span></dt><dd><p>Starts with a dot (<code class="literal">.</code>).</p></dd><dt><span class="term">Platform Locale</span></dt><dd><p>Supported locales include en_US (English), de (German),
      es (Spanish), fr (French), ja (Japanese), ko (Korean),
      zh_CN (Simplified Chinese), and zh_TW (Traditional Chinese).</p></dd><dt><span class="term">Configuration Directory</span></dt><dd><p>Location on server for OpenAM configuration files. OpenAM must
      be able to write to this directory.</p></dd></dl></div></li><li class="step"><p>In the Configuration Store screen, you can accept the defaults
   to allow OpenAM to store configuration data in an embedded directory.
   The embedded directory can be configured separately to replicate data
   for high availability if necessary.</p><div class="mediaobject" align="center"><a name="figure-openam-conf-store"></a><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/openam-conf-store.png" align="middle" height="360" alt="OpenAM configuration store"></td></tr></table><div class="longdesc-link" align="right"><br clear="all"><span class="longdesc-link">[<a href="figure-openam-conf-store.html" target="longdesc">D</a>]</span></div></div><p>You can also add this OpenAM installation to an existing deployment,
   providing the URL of the site. See <a class="xref" href="#add-servers-to-site" title="Procedure&nbsp;2.5.&nbsp;To Add a Server to a Site">Procedure&nbsp;2.5, &#8220;To Add a Server to a Site&#8221;</a>
   for details.</p><p>Alternatively, if you already manage an OpenDJ or DSEE deployment,
   you can choose to store OpenAM configuration data in your existing
   directory service. You must, however, create the suffix to store
   configuration data on the directory server before you configure
   OpenAM. OpenAM does not create the suffix when you use an external
   configuration store.</p><p>When you create a new OpenAM custom configuration that uses an
   external LDAP directory server for the configuration data store, you must
   use a root suffix DN with at least two domain components, such as
   <code class="literal">dc=example,dc=com</code>.</p></li><li class="step"><p>In the User Store screen, you configure where OpenAM looks for
   user identities.</p><p>OpenAM must have write access to the directory service you choose,
   as it adds to the directory schema needed to allow OpenAM to manage access
   for users in the user store.</p><div class="mediaobject" align="center"><a name="figure-openam-conf-user-store"></a><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/openam-conf-user-store.png" align="middle" height="360" alt="OpenAM user store settings"></td></tr></table><div class="longdesc-link" align="right"><br clear="all"><span class="longdesc-link">[<a href="figure-openam-conf-user-store.html" target="longdesc">D</a>]</span></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">User Data Store Type</span></dt><dd><p>If you have a directory service already provisioned with users in
      a supported user data store, then select that type of directory from the
      options available.</p></dd><dt><span class="term">SSL/TLS Enabled</span></dt><dd><p>To use a secure connection, check this box, then make sure
      the Port you define corresponds to the port on which the directory
      listens for StartTLS or SSL connections. When using this option you also
      need to make sure the trust store used by the JVM running OpenAM has the
      necessary certificates installed.</p></dd><dt><span class="term">Directory Name</span></dt><dd><p>FQDN for the host housing the directory service</p></dd><dt><span class="term">Port</span></dt><dd><p>LDAP directory port. The default for LDAP and LDAP with StartTLS
      to protect the connection is port 389. The default for LDAP over SSL
      is port 636. Your directory service might use a different port.</p></dd><dt><span class="term">Root Suffix</span></dt><dd><p>Base distinguished name (DN) where user data are stored</p></dd><dt><span class="term">Login ID</span></dt><dd><p>Directory administrator user DN. The administrator must be capable
      of updating schema and user data.</p></dd><dt><span class="term">Password</span></dt><dd><p>Password for the directory administrator user</p></dd></dl></div></li><li class="step"><p>In the Site Configuration screen, you can set up OpenAM as part of
   a site where the load is balanced across multiple OpenAM servers.</p><p>If you have a site configuration with a load balancer, you can enable
   session high availability persistence and failover. OpenAM then stores
   sessions across server restarts, so that users do not have to login
   again.</p><p>If you then add additional servers to this OpenAM site, OpenAM performs
   <em class="firstterm">session failover</em>, storing session data in a directory
   service that is shared by different OpenAM servers. The shared storage means
   that if an OpenAM server fails, other OpenAM servers in the site have access
   to the user's session data and can serve requests about that user. As a
   result the user does not have to log in again. If session failover is
   important for your deployment, also follow the instructions in <a href="../install-guide/index.html#chap-session-failover" class="link"><em class="citetitle">Setting Up
   OpenAM Session Failover</em></a>.</p><div class="mediaobject" align="center"><a name="figure-openam-conf-site"></a><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/openam-conf-site.png" align="middle" height="360" alt="OpenAM site configuration"></td></tr></table><div class="longdesc-link" align="right"><br clear="all"><span class="longdesc-link">[<a href="figure-openam-conf-site.html" target="longdesc">D</a>]</span></div></div><p>It is possible to set up a site after initial installation and
   configuration. Doing so is described in the chapter on
   <em class="citetitle">Setting Up OpenAM Session Failover</em>.</p></li><li class="step"><p>In the Agent Information screen, provide a password having at least
   8 characters to be used by policy agents to connect to OpenAM.</p><div class="mediaobject" align="center"><a name="figure-openam-conf-pa"></a><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/openam-conf-pa.png" align="middle" height="360" alt="OpenAM policy agent password"></td></tr></table><div class="longdesc-link" align="right"><br clear="all"><span class="longdesc-link">[<a href="figure-openam-conf-pa.html" target="longdesc">D</a>]</span></div></div></li><li class="step"><p>Check the summary screen, and if necessary click Previous to return to
   earlier screens if necessary to fix configuration errors.</p><div class="mediaobject" align="center"><a name="figure-openam-conf-summary"></a><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/openam-conf-summary.png" align="middle" height="360" alt="OpenAM configuration summary"></td></tr></table><div class="longdesc-link" align="right"><br clear="all"><span class="longdesc-link">[<a href="figure-openam-conf-summary.html" target="longdesc">D</a>]</span></div></div><p>After you click Create Configuration in the summary screen,
   configuration proceeds, logging progress that you can read in your browser
   and later in the installation log. The process ends, and OpenAM shows the
   Proceed to Login prompt.</p><div class="mediaobject" align="center"><a name="figure-openam-proceed-to-login"></a><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/openam-proceed-to-login.png" align="middle" height="360" alt="OpenAM proceed to login prompt"></td></tr></table><div class="longdesc-link" align="right"><br clear="all"><span class="longdesc-link">[<a href="figure-openam-proceed-to-login.html" target="longdesc">D</a>]</span></div></div></li><li class="step"><p>When the configuration completes, click Proceed to Login, and then
   login as the OpenAM administrator, <code class="literal">amadmin</code>.</p><div class="mediaobject" align="center"><a name="figure-openam-first-login-admin"></a><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/openam-first-login.png" align="middle" height="360" alt="OpenAM first login"></td></tr></table><div class="longdesc-link" align="right"><br clear="all"><span class="longdesc-link">[<a href="figure-openam-first-login-admin.html" target="longdesc">D</a>]</span></div></div><p>After login, OpenAM redirects you to the OpenAM Console page.</p><div class="mediaobject" align="center"><a name="figure-openam-console"></a><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/openam-console.png" align="middle" height="360" alt="OpenAM Console home page"></td></tr></table><div class="longdesc-link" align="right"><br clear="all"><span class="longdesc-link">[<a href="figure-openam-console.html" target="longdesc">D</a>]</span></div></div><p>You can also access OpenAM Console by browsing to the Console URL, such
   as <code class="literal">http://openam.example.com:8080/openam/console</code>.</p></li><li class="step"><p>Restrict permissions to the configuration directory (by default
   <code class="filename">$HOME/openam</code>, where
   $HOME corresponds to the user who runs the web container). Prevent other
   users from accessing files in the configuration directory.</p></li></ol></div><div class="procedure"><a name="add-servers-to-site"></a><div class="procedure-title">Procedure&nbsp;2.5.&nbsp;To Add a Server to a Site</div><a class="indexterm" name="d12792e2435"></a><a class="indexterm" name="d12792e2442"></a><p>High availability requires redundant servers in case of failure.
  With OpenAM, you configure an OpenAM site with multiple servers in a
  pool behind a load balancing service that exposes a single URL as an entry
  point to the site.</p><p>Follow these steps to configure a server to belong to an existing
  site.</p><ol class="procedure" type="1"><li class="step"><p>In the initial configuration screen, under Custom Configuration click
   Create New Configuration.</p></li><li class="step"><p>In the first screen, enter the same password entered for the OpenAM
   Administrator, <code class="literal">amadmin</code>, when you configured the first
   server in the site.</p></li><li class="step"><p>Configure server settings as required.</p><p>The cookie domain should be identical to that of the first server in
   the site.</p></li><li class="step"><p>In the configuration store screen, select Add to Existing Deployment,
   and enter as the Server URL the URL of the first OpenAM server in the
   site.</p><p>The directory used to store configuration data should belong to the
   same directory service used for this purpose by other OpenAM servers in
   the site. If you use the embedded OpenDJ directory server, for example,
   you can have the configurator set up data replication with embedded directory
   servers used by other servers in the site.</p><p>Settings for the user store are then shared with the existing server,
   so the corresponding wizard screen is skipped.</p></li><li class="step"><p>In the site configuration screen, select <code class="literal">Yes</code> and
    enter the same site configuration details as you did for the first server
    in the site.</p><p>Settings for agent information are also shared with the existing server,
   so the corresponding wizard screen is skipped.</p></li><li class="step"><p>In the summary screen, verify the settings you chose, and then click
   Create Configuration.</p></li><li class="step"><p>When the configuration process finishes, click Proceed to Login,
   and then login as the OpenAM administrator to access OpenAM Console.</p></li></ol></div><div class="procedure"><a name="deploy-coreonly"></a><div class="procedure-title">Procedure&nbsp;2.6.&nbsp;To Deploy OpenAM Core Server (No Console)</div><a class="indexterm" name="d12792e2489"></a><p>You can deploy OpenAM server without OpenAM console by performing the
  following steps.</p><ol class="procedure" type="1"><li class="step"><p>Deploy the <code class="filename">OpenAM-ServerOnly-12.0.0.war</code> file 
    in your container.</p><p>For example, copy the file to deploy on Apache Tomcat:</p><div class="screen"><pre>
$ <strong>cp OpenAM-ServerOnly-12.0.0.war /path/to/tomcat/webapps/coreonly.war</strong>
   </pre></div></li><li class="step"><p>Browse to the configuration application, such as
    <code class="literal">http://openam.example.com:8080/coreonly/</code>, and configure
    OpenAM core services as in <a class="xref" href="#configure-openam-custom" title="Procedure&nbsp;2.4.&nbsp;To Custom Configure OpenAM">Procedure&nbsp;2.4, &#8220;To Custom Configure OpenAM&#8221;</a>.</p></li><li class="step"><p>After configuration, restrict permissions to the configuration
   directory, such as <code class="filename">$HOME/coreonly/</code> where
   <code class="literal">$HOME</code> corresponds to the user who runs the web
   container. Prevent other users from accessing files in the configuration
   directory.</p></li></ol></div></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-install-tools"></a>Chapter&nbsp;3.&nbsp;Installing OpenAM Tools</h1></div></div></div><a class="indexterm" name="d12792e2532"></a><p>OpenAM tools are found in <code class="filename">.zip</code> files where you
 unpacked the archive of the entire package, such as
 <code class="filename">~/Downloads/openam</code>.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="filename">SSOAdminTools-12.0.0.zip</code></span></dt><dd><p>Administration tools: <span class="command"><strong>ampassword</strong></span>,
    <span class="command"><strong>ssoadm</strong></span> and <span class="command"><strong>amverifyarchive</strong></span></p><p>See <a class="xref" href="#install-openam-admin-tools" title="Procedure&nbsp;3.1.&nbsp;To Set Up Administration Tools">Procedure&nbsp;3.1, &#8220;To Set Up Administration Tools&#8221;</a>.</p></dd><dt><span class="term"><code class="filename">SSOConfiguratorTools-12.0.0.zip</code></span></dt><dd><p>Configuration and upgrade tools, alternatives to using
    the GUI configuration wizard</p><p>See <a class="xref" href="#install-openam-config-tools" title="Procedure&nbsp;3.2.&nbsp;To Set Up Configuration Tools">Procedure&nbsp;3.2, &#8220;To Set Up Configuration Tools&#8221;</a>.</p></dd></dl></div><div class="procedure"><a name="install-openam-admin-tools"></a><div class="procedure-title">Procedure&nbsp;3.1.&nbsp;To Set Up Administration Tools</div><a class="indexterm" name="d12792e2580"></a><p>
   The <span class="command"><strong>ssoadm</strong></span> administration tool
   requires access to OpenAM configuration files,
   and therefore must be installed on the same host as OpenAM core services.

   The <span class="command"><strong>ssoadm</strong></span> tool is not designed to run on a host
   where only the distributed authentication service (DAS) is installed.
  </p><p>The <span class="command"><strong>ssoadm</strong></span> tool also provides the ability to auto-accept
   the software license agreement and suppress the license acceptance screen
   to the user.
   To do so, you can add the <code class="literal">--acceptLicense</code> option to the
   <span class="command"><strong>setup</strong></span> or <span class="command"><strong>setup.bat</strong></span>
   script before you install the tool. If the option is not present, you must
   scroll through and accept the license interactively.</p><ol class="procedure" type="1"><li class="step"><p>Make sure OpenAM is installed and running before proceeding.</p></li><li class="step"><p>Make sure the <code class="literal">JAVA_HOME</code> environment variable
   is properly set.</p><div class="screen"><pre>
$ <strong>echo $JAVA_HOME</strong>
<em>/path/to/jdk</em>
   </pre></div></li><li class="step"><p>Create a file system directory to unpack the tools.</p><div class="screen"><pre>
$ <strong>mkdir -p /path/to/openam-tools/admin</strong>
   </pre></div></li><li class="step"><p>Unpack the tools.</p><div class="screen"><pre>
$ <strong>cd /path/to/openam-tools/admin</strong>
$ <strong>unzip ~/Downloads/openam/SSOAdminTools-12.0.0.zip</strong>
   </pre></div></li><li class="step"><p>Optional. Add <code class="literal">--acceptLicense</code> to the
    <span class="command"><strong>java</strong></span> command at the end of the <span class="command"><strong>setup</strong></span> or
    <span class="command"><strong>setup.bat</strong></span> script to auto-accept the license agreement and
    suppress the license acceptance screen to the user.</p><pre class="brush: shell;">
$JAVA_HOME/bin/java -D"load.config=yes" \
                    -D"help.print=$help_print" \
                    -D"path.AMConfig=$path_AMConfig" \
                    -D"path.debug=$path_debug" \
                    -D"path.log=$path_log" \
                    -cp "$CLASSPATH" com.sun.identity.tools.bundles.Main \
                    --acceptLicense
    </pre></li><li class="step"><p>If you connect to OpenAM over HTTPS and the certificate for the container
    is not signed by a Certificate Authority (CA), then you must configure a
    trust store with OpenAM's certificate for the <span class="command"><strong>ssoadm</strong></span> tool.
    Otherwise, the <span class="command"><strong>ssoadm</strong></span> tool cannot trust OpenAM and
    cannot complete the handshake phase of setting up a secure connection.
   </p><p>
    Once you have set up your trust store, you must update the <code class="literal">setup.sh</code>
    (or <code class="literal">setup.bat</code> on Windows) scripts so that <span class="command"><strong>ssoadm</strong></span>
    can reference the trust store.
    The <span class="command"><strong>ssoadm</strong></span> by default tries to trust the certificate
    based on the CA certificates in the Java <code class="literal">cacerts</code> truststore.
    The issuer certificate of the
    configuration data store's server certificate must be included in the
    truststore.
   </p><p>To identify the proper trust store,
    add an additional option to the <span class="command"><strong>java</strong></span> command in
    the script.
    The following example points to the key
    store in which Tomcat holds the certificate that it presents
    when establishing an HTTPS connection.
   </p><div class="literallayout"><p><br>
$&nbsp;JAVA_HOME/bin/java&nbsp;-D"javax.net.ssl.trustStore=/path/to/tomcat/conf/keystore.jks"<br>
&nbsp;&nbsp;&nbsp;</p></div></li><li class="step"><p>If you use IBM Java, add
   <code class="literal">-D"amCryptoDescriptor.provider=IBMJCE"</code> and
   <code class="literal">-D"amKeyGenDescriptor.provider=IBMJCE"</code> options to the
   <span class="command"><strong>setup</strong></span> or <span class="command"><strong>setup.bat</strong></span> script before
   you install the tools.</p><p>The options should be set for the <span class="command"><strong>java</strong></span> command
   at the end of the script.</p><p>You can optionally apply the <code class="literal">--acceptLicense</code> argument
   to the end of the script if you want to auto-accept the software
   license agreement and suppress the license acceptance screen to the user.</p><div class="screen"><pre>
$ <strong>tail setup</strong>
<em>CLASSPATH="$CLASSPATH:resources"

$JAVA_HOME/bin/java -D"load.config=yes" \
                    -D"help.print=$help_print" \
                    -D"path.AMConfig=$path_AMConfig" \
                    -D"path.debug=$path_debug" \
                    -D"path.log=$path_log" \
                    -D"amCryptoDescriptor.provider=IBMJCE" \
                    -D"amKeyGenDescriptor.provider=IBMJCE" \
                    -cp "$CLASSPATH" \
                    com.sun.identity.tools.bundles.Main \
                    --acceptLicense</em>
   </pre></div></li><li class="step"><p>Run the <span class="command"><strong>setup</strong></span> utility (<span class="command"><strong>setup.bat</strong></span>
   on Windows), providing the path to the directory where OpenAM configuration
   files are located, and where you want debug and log information to be
   located.</p><div class="screen"><pre>
$ <strong>./setup</strong>
<em>Path to config files of OpenAM server [/home/user/openam]:
Debug Directory [/path/to/openam-tools/admin/debug]:
Log Directory [/path/to/openam-tools/admin/log]:
The scripts are properly setup under directory:
 /path/to/openam-tools/admin/openam
Debug directory is /path/to/openam-tools/admin/debug.
Log directory is /path/to/openam-tools/admin/log.
The version of this tools.zip is: <em><strong>version and date</strong></em>
The version of your server instance is: OpenAM <em><strong>version and date</strong></em></em>
   </pre></div><p>After setup, the tools are located under a directory named after the
   instance of OpenAM. On Windows, these files are .bat scripts.</p><div class="screen"><pre>
$ <strong>ls openam/bin/</strong>
<em>ampassword  amverifyarchive  ssoadm</em>
   </pre></div></li><li class="step"><p>If you use IBM Java, add
   <code class="literal">-D"amCryptoDescriptor.provider=IBMJCE"</code> and
   <code class="literal">-D"amKeyGenDescriptor.provider=IBMJCE"</code> options to the
   <span class="command"><strong>ssoadm</strong></span> or <span class="command"><strong>ssoadm.bat</strong></span> script before
   using the script.</p><p>The options should be set before the call to
   <code class="literal">com.sun.identity.cli.CommandManager</code> at the end of the
   script.</p><div class="screen"><pre>
$ <strong>tail -3 /path/to/openam-tools/admin/openam/bin/ssoadm</strong>
<em>    -D"amCryptoDescriptor.provider=IBMJCE" \
    -D"amKeyGenDescriptor.provider=IBMJCE" \
    com.sun.identity.cli.CommandManager "$@"</em>
   </pre></div></li><li class="step"><p>Check that <span class="command"><strong>ssoadm</strong></span> works properly.</p><div class="screen"><pre>
$ <strong>echo password &gt; /tmp/pwd.txt</strong>
$ <strong>chmod 400 /tmp/pwd.txt</strong>
$ <strong>cd /path/to/openam-tools/admin/openam/bin/</strong>
$ <strong>./ssoadm list-servers -u amadmin -f /tmp/pwd.txt</strong>
<em>
http://openam.example.com:8080/openam</em>
   </pre></div><p>The <span class="command"><strong>ssoadm</strong></span> commands can also be run from
   <code class="filename">ssoadm.jsp</code> in OpenAM, for example at
   <code class="literal">http://openam.example.com:8080/openam/ssoadm.jsp</code>,
   once the page has been enabled as described in the section on <a href="../admin-guide/index.html#openam-ssoadm-jsp-overview" class="link">OpenAM ssoadm.jsp</a>
    in the <em class="citetitle">Administration Guide</em>.</p><p>Not all of the sub-commands available through the <span class="command"><strong>ssoadm</strong></span>
  command are available on the <code class="literal">ssoadm.jsp</code> web page.</p></li><li class="step"><p>If you connect to OpenAM over HTTPS, the <span class="command"><strong>ssoadm</strong></span>
    by default tries to trust the certificate based on the CA certificates in
    the Java <code class="literal">cacerts</code> truststore. This might not work for your
    deployment.</p><p>If the SSL certificate configured for the container where you deployed
    OpenAM was not signed by a recognized CA then the SSL connection process
    fails. For example, if you used a self-signed certificate as described in the
    <em class="citetitle">Administration Guide</em> procedure, <a href="../admin-guide/index.html#openam-with-https-on-tomcat" class="link"><em class="citetitle">To Set Up OpenAM
     With HTTPS on Tomcat</em></a>, then the <span class="command"><strong>ssoadm</strong></span>
    command cannot trust that certificate by default. To allow the
    <span class="command"><strong>ssoadm</strong></span> command to trust the certificate, edit the
    <span class="command"><strong>ssoadm</strong></span> (<span class="command"><strong>ssoadm.bat</strong></span> on Windows)
    script as follows.</p><p>To identify the proper trust store,
    add an additional option to the <span class="command"><strong>java</strong></span> command in
    the script.
    The following example points to the keystore in which Tomcat holds the
    self-signed certificate that it presents
    when establishing an HTTPS connection. The issuer certificate of the configuration
    data store's server certificate must be included in the truststore.
   </p><div class="literallayout"><p><br>
$&nbsp;JAVA_HOME/bin/java&nbsp;-D"javax.net.ssl.trustStore=/path/to/tomcat/conf/keystore.jks"<br>
&nbsp;&nbsp;&nbsp;</p></div><p>If the <span class="command"><strong>ssoadm</strong></span> command cannot access the server
    key store in this way, set up your own trust store and import the server
    certificate using the Java <span class="command"><strong>keytool</strong></span> command.</p></li><li class="step"><p>If you have deployed OpenAM in a site configuration, edit the
   <span class="command"><strong>ssoadm</strong></span> (<span class="command"><strong>ssoadm.bat</strong></span> on Windows) script
   to map the site URL to the OpenAM server URL.</p><p>To do this, set a
   <code class="literal">com.iplanet.am.naming.map.site.to.server</code> system property
   option of the <span class="command"><strong>java</strong></span> command in the script. The option
   takes the following form.</p><pre class="literallayout">-D"com.iplanet.am.naming.map.site.to.server=<em class="replaceable"><code>lb-url</code></em>=<em class="replaceable"><code>openam-url</code></em>[,
 <em class="replaceable"><code>other-lb-url</code></em>=<em class="replaceable"><code>openam-url</code></em> ...]"</pre><p>The property maps each <em class="replaceable"><code>lb-url</code></em> key to an
   <em class="replaceable"><code>openam-url</code></em> value, where
   <em class="replaceable"><code>lb-url</code></em> is the URL to a site load balancer and
   <em class="replaceable"><code>openam-url</code></em> is the URL to the OpenAM server against
   which you set up the <span class="command"><strong>ssoadm</strong></span> command.</p><p>The <span class="command"><strong>ssoadm</strong></span> command is dependent on the OpenAM server
   against which you set it up, so always map site load balancer URLs to that
   server's <em class="replaceable"><code>openam-url</code></em>.</p><p>For example, if your site is behind
   <code class="literal">https://lb.example.com:443/openam</code>, and the OpenAM server
   against which you set up the <span class="command"><strong>ssoadm</strong></span> is at
   <code class="literal">http://openam.example.com:8080/openam</code>, then add the
   following property to the <span class="command"><strong>java</strong></span> command (all on one line
   without spaces).</p><pre class="literallayout">-D"com.iplanet.am.naming.map.site.to.server=
 https://lb.example.com:443/openam=http://openam.example.com:8080/openam"</pre><p>Repeat this step for each OpenAM server in your site configuration.
   You can install all your instances of <span class="command"><strong>ssoadm</strong></span> on the same
   host, but in each case the command should manage only one OpenAM
   server.</p></li></ol></div><div class="procedure"><a name="install-openam-config-tools"></a><div class="procedure-title">Procedure&nbsp;3.2.&nbsp;To Set Up Configuration Tools</div><a class="indexterm" name="d12792e2959"></a><a class="indexterm" name="idx-config-tools"></a><ol class="procedure" type="1"><li class="step"><p>Make sure the <code class="literal">JAVA_HOME</code> environment variable
   is properly set.</p><div class="screen"><pre>
$ <strong>echo $JAVA_HOME</strong>
<em>/path/to/jdk</em>
   </pre></div></li><li class="step"><p>
    Create a file system directory to unpack the tools.
   </p><div class="screen"><pre>
$ <strong>mkdir -p /path/to/openam-tools/config</strong>
   </pre></div></li><li class="step"><p>Unpack the tools from where you unzipped OpenAM.</p><div class="informalexample"><div class="screen"><pre>
$ <strong>cd /path/to/openam-tools/config</strong>
$ <strong>unzip ~/Downloads/openam/SSOConfiguratorTools-12.0.0.zip</strong>
<em>Archive:  ~/Downloads/openam/SSOConfiguratorTools-12.0.0.zip
   creating: legal-notices/
  inflating: legal-notices/LICENSE.DOM-software.html
  inflating: legal-notices/NOTICE.resolver.txt
  inflating: legal-notices/LICENSE.DOM-documentation.html
        ... (more output) ...
 extracting: lib/xml-apis-2.11.0.jar
 extracting: openam-configurator-tool-12.0.0.jar
 extracting: lib/servlet-api-2.5.jar</em>
   </pre></div></div></li><li class="step"><p>
    Configure OpenAM server in a silent, unattended manner
    by using the openam-configurator-tool-12.0.0.jar tool after you deploy the .war.
   </p><a class="indexterm" name="d12792e3009"></a><p>
    OpenAM server must be deployed and running, but not configured yet,
    when you use the tool.
   </p><p>
    The openam-configurator-tool-12.0.0.jar relies on a properties file
    to specify the configuration for the OpenAM server.
    The following example shows the equivalent of a default configuration, which
    installs OpenAM to run as HTTP.
   </p><p>
    If you want implement HTTPS, see the next step.
   </p><div class="screen"><pre>
$ <strong>cp sampleconfiguration config.properties</strong>
$ <strong>vi config.properties</strong>
$ <strong>$ grep -v "^#" config.properties | grep -v "^$"</strong>
<em>SERVER_URL=http://openam.example.com:8080
DEPLOYMENT_URI=/openam
BASE_DIR=/home/openam/openam
locale=en_US
PLATFORM_LOCALE=en_US
AM_ENC_KEY=
ADMIN_PWD=password
AMLDAPUSERPASSWD=secret12
COOKIE_DOMAIN=.example.com
ACCEPT_LICENSES=true
DATA_STORE=embedded
DIRECTORY_SSL=SIMPLE
DIRECTORY_SERVER=openam.example.com
DIRECTORY_PORT=50389
DIRECTORY_ADMIN_PORT=4444
DIRECTORY_JMX_PORT=1689
ROOT_SUFFIX=dc=openam,dc=forgerock,dc=org
DS_DIRMGRDN=cn=Directory Manager
DS_DIRMGRPASSWD=password</em>
   </pre></div><p>
    When the OpenAM server .war file is deployed and running,
    you can configure it by using the tool with the properties file.
   </p><div class="screen"><pre>
$ <strong>java -jar openam-configurator-tool-12.0.0.jar --file config.properties</strong>
<em>Checking license acceptance...License terms accepted.
Checking configuration directory /home/openam/openam....Success.
Installing OpenAM configuration store...Success RSA/ECB/OAEPWithSHA1AndMGF1...
Extracting OpenDJ, please wait...Complete
Running OpenDJ setupSetup command: --cli --adminConnectorPort 4444
 --baseDN dc=openam,dc=forgerock,dc=org --rootUserDN cn=Directory Manager
 --ldapPort 50389 --skipPortCheck --rootUserPassword xxxxxxx --jmxPort 1689
 --no-prompt --doNotStart --hostname openam.example.com ...
...Success
Installing OpenAM configuration store in /home/openam/openam/... ...Success.
Creating OpenAM suffixImport+task+ ... ...Success
Tag swapping schema files....Success.
Loading Schema opendj_config_schema.ldif...Success.

...

...Success.
Reinitializing system properties....Done
Registering service dashboardService.xml...Success.

...

Configuring system....Done
Configuring server instance....Done
Creating demo user....Done
Creating Web Service Security Agents....Done
Setting up monitoring authentication file.
Configuration complete!</em>
   </pre></div></li><li class="step"><p>
    To configure HTTPS, you create a properties file and include
    the <code class="literal">SERVER_URL</code> property with the HTTPS URL
    and set the <code class="literal">DIRECTORY_SSL</code> to <code class="literal">SSL</code>
    as follows (the other properties remain the same):
   </p><div class="screen"><pre>
$ <strong>cp sampleconfiguration config.properties</strong>
$ <strong>vi config.properties</strong>
$ <strong>$ grep -v "^#" config.properties | grep -v "^$"</strong>
<em>SERVER_URL=https://openam.example.com:1443
DEPLOYMENT_URI=/openam
BASE_DIR=/home/openam/openam
locale=en_US
PLATFORM_LOCALE=en_US
AM_ENC_KEY=
ADMIN_PWD=password
AMLDAPUSERPASSWD=secret12
COOKIE_DOMAIN=.example.com
ACCEPT_LICENSES=true
DATA_STORE=embedded
DIRECTORY_SSL=SSL
DIRECTORY_SERVER=openam.example.com
DIRECTORY_PORT=50389
DIRECTORY_ADMIN_PORT=4444
DIRECTORY_JMX_PORT=1689
ROOT_SUFFIX=dc=openam,dc=forgerock,dc=org
DS_DIRMGRDN=cn=Directory Manager
DS_DIRMGRPASSWD=password</em>
   </pre></div><p>
    Then, when the OpenAM .war file is deployed and the server is running, configure the
    server to use HTTPS using the openam-configurator-tool-12.0.0.jar tool with the properties file
    as follows:
   </p><div class="screen"><pre>
java '-Djavax.net.ssl.trustStore=PATH_TO_JKS_TRUSTSTORE' \
      -jar openam-configurator-tool-12.0.0.jar \
      --file config.properties
   </pre></div></li></ol></div><p>
    For additional information about the command-line tool,
    see the reference documentation for
    <a href="../reference/index.html#man-configurator-jar-1" class="link"><span class="command"><strong>configurator.jar</strong></span></a>.
   </p><div class="note"><h3 class="title">Note</h3><p>OpenAM supports two methods to auto-accept the software licensing
        agreement and suppress the display of the licence acceptance screen to
        the user: using the configuration file or using a command-line option.
        You can include an optional <code class="literal">ACCEPT_LICENSES=true</code> property
        in the openam-configurator-tool-12.0.0.jar configuration file.
       </p><p>
        You can also use the <code class="option">--acceptLicense</code> option with the
        configurator tool on the command line. The configuration file property
        has precedence over the command-line option. The default value is
        <code class="literal">false</code>, which always displays the license acceptance screen.
       </p><div class="screen"><pre>
$ <strong>java -jar openam-configurator-tool-12.0.0.jar \
  --file config.properties \
  --acceptLicense</strong>
       </pre></div></div><a class="indexterm" name="d12792e3099"></a></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-install-multiple"></a>Chapter&nbsp;4.&nbsp;Installing Multiple Servers</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="section"><a href="#considerations-multiple-servers">4.1. Things to Consider When Installing Multiple Servers</a></span></dt><dt><span class="section"><a href="#configure-sites">4.2. Configuring OpenAM Sites</a></span></dt><dt><span class="section"><a href="#handle-request-headers">4.3. Handling HTTP Request Headers</a></span></dt></dl></div><a class="indexterm" name="d12792e3109"></a><a class="indexterm" name="d12792e3114"></a><a class="indexterm" name="d12792e3119"></a><p>
  This chapter covers what to do when installing multiple OpenAM servers.
 </p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="considerations-multiple-servers"></a>4.1.&nbsp;Things to Consider When Installing Multiple Servers</h2></div></div></div><p>
   When installing multiple servers, consider the following points.
  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
     You generally install multiple servers to provide service availability.
     If one server is down for any reason, another server can respond instead.
     This means that you need something between incoming traffic and OpenAM
     to route around servers that are down.
    </p><p>
     OpenAM has the concept of OpenAM <em class="firstterm">site</em> for this purpose.
     In an OpenAM site, multiple OpenAM servers are configured in the same way,
     and accessed through a load balancer layer.<a href="#ftn.d12792e3140" class="footnote" name="d12792e3140"><sup class="footnote">[1]</sup></a>
     The load balancer can be implemented in hardware or software,
     but it is separate and independent from OpenAM software.
     When installed properly, a site configuration improves service availability,
     as the load balancer routes around OpenAM servers that are down,
     sending traffic to other servers in the site.
    </p></li><li class="listitem"><p>
     You can use a load balancer layer to protect OpenAM services as well.
     The load balancer can restrict access to OpenAM services,
     throttle traffic, offload HTTPS encryption, and so forth.
    </p><p>
     As an alternative, or in addition,
     you can use a separate reverse proxy service,
     or the OpenAM distributed authentication UI.
     The distributed authentication UI exposes a subset of OpenAM functionality.
     For instructions on setting up the distributed authentication UI, see
     <a href="../install-guide/index.html#chap-install-das" class="link"><em class="citetitle">Installing OpenAM Distributed Authentication</em></a>.
    </p></li><li class="listitem"><p>
     When you are protecting OpenAM with a load balancer or proxy service,
     configure your container so that OpenAM can trust
     the load balancer or proxy service.
     OpenAM trusts the distributed authentication UI
     as the distributed authentication UI uses
     credentials registered with OpenAM.
    </p></li><li class="listitem"><p>
      OpenAM authentication can depend on information
      about the user to authenticate,
      such as the IP address where the request originated.
      When OpenAM is accessed through a load balancer or proxy layer,
      pass this information along using request headers.
      Also configure OpenAM to consume and to forward the headers as necessary.
      See <a class="xref" href="#handle-request-headers" title="4.3.&nbsp;Handling HTTP Request Headers">Section&nbsp;4.3, &#8220;Handling HTTP Request Headers&#8221;</a> for details.
    </p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="configure-sites"></a>4.2.&nbsp;Configuring OpenAM Sites</h2></div></div></div><a class="indexterm" name="d12792e3164"></a><p>
   The most expedient way to configure a server in a site
   is to set the site up during the initial OpenAM configuration.
   In the GUI configurator, this is done in the Site Configuration screen.
   It is also possible to configure a site separately.
  </p><div class="itemizedlist"><p>
    This section includes the following procedures.
   </p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
     <a class="xref" href="#configure-site-after-installation" title="Procedure&nbsp;4.1.&nbsp;To Configure a Site with a First OpenAM Server">Procedure&nbsp;4.1, &#8220;To Configure a Site with a First OpenAM Server&#8221;</a>
    </p></li><li class="listitem"><p>
     <a class="xref" href="#configure-site-load-balancing" title="Procedure&nbsp;4.2.&nbsp;To Configure Site Load Balancing">Procedure&nbsp;4.2, &#8220;To Configure Site Load Balancing&#8221;</a>
    </p></li></ul></div><div class="procedure"><a name="configure-site-after-installation"></a><div class="procedure-title">Procedure&nbsp;4.1.&nbsp;To Configure a Site with a First OpenAM Server</div><p>
    You might already have configured an OpenAM server before realizing
    that a site is what you want.
   </p><p>
    The following steps show how to set up the site for the first OpenAM server.
   </p><ol class="procedure" type="1"><li class="step"><p>
     Login to OpenAM Console as administrator,
     by default <code class="literal">amadmin</code>,
     and then browse to Configuration &gt; Servers and Sites &gt; Sites.
    </p></li><li class="step"><p>
     Click New to start configuring the new site.
    </p></li><li class="step"><p>
     On the New Site page enter the site name,
     and set the Primary URL to the load balancer URL
     that is the entry point for the site,
     such as <code class="literal">https://lb.example.com/openam</code>.
    </p><p>
     The site URL is the URL to the load balancer in front of
     the OpenAM servers in the site.
     For example, if your load balancer listens for
     HTTPS on host <code class="literal">lb.example.com</code>
     and port <code class="literal">443</code>,
     with OpenAM under <code class="literal">/openam</code>,
     then your site URL is <code class="literal">https://lb.example.com/openam</code>.
    </p><p>
     Client applications and policy agents access the servers in the site
     through the site URL.
    </p></li><li class="step"><p>
     Click Save to keep the site configuration.
    </p></li><li class="step"><p>
     Under Configuration &gt; Servers and Sites &gt; Server,
     click the link to the server configuration.
    </p></li><li class="step"><p>
     On the server configuration General tab page,
     set the Parent Site to the name of the site you just created,
     and then click Save to keep your changes.
    </p><p>
     At this point the server is part of the new site you have configured.
    </p><p>
     For all additional servers in the OpenAM site,
     add them to the site at configuration time as described in
     <a href="../install-guide/index.html#add-servers-to-site" class="link"><em class="citetitle">To Add a Server to a Site</em></a>.
    </p></li></ol></div><div class="procedure"><a name="configure-site-load-balancing"></a><div class="procedure-title">Procedure&nbsp;4.2.&nbsp;To Configure Site Load Balancing</div><p>
    If you did not set up the site during initial configuration,
    first follow the instructions in
    <a class="xref" href="#configure-site-after-installation" title="Procedure&nbsp;4.1.&nbsp;To Configure a Site with a First OpenAM Server">Procedure&nbsp;4.1, &#8220;To Configure a Site with a First OpenAM Server&#8221;</a>,
    and then follow all the steps below.
   </p><ol class="procedure" type="1"><li class="step"><p>
     For each OpenAM server in the site, select
     Configuration &gt; Servers and Sites &gt; Servers &gt; <em class="replaceable"><code>Server Name</code></em>,
     set Parent Site to the site you created,
     and then Save your work.
    </p></li><li class="step"><p>
     Make the <code class="literal">amlbcookie</code> value unique for each OpenAM server.
    </p><p>
     In an OpenAM site, the server that authenticated a user
     is the server that continues to manage that user's session,
     unless the server is no longer available.
     The load balancer should send subsequent requests to that server
     to avoid overhead resulting from the server that gets the
     request being different from the server that authenticated the user.
    </p><p>
     When traffic is protected with HTTPS, this approach requires
     that you terminate the connection on the load balancer.
     You then either re-encrypt the traffic from the load balancer to OpenAM,
     or make connections from the load balancer to OpenAM over HTTP.
    </p><ol type="a" class="substeps"><li class="step"><p>
       For each OpenAM server console in the site, browse to
       Configuration &gt; Servers and Sites &gt; Servers
       &gt; <em class="replaceable"><code>Server Name</code></em> &gt; Advanced,
       and set <code class="literal">com.iplanet.am.lbcookie.value</code>
       to a unique value.
      </p><p>
       By default, the cookie value is set to the OpenAM server ID.
      </p><p>
       Changes take effect only after you restart the OpenAM server.
      </p></li><li class="step"><p>
       Restart each OpenAM server where you changed the cookie value.
      </p><p>
       You can then check the cookie value by logging in to OpenAM console,
       and examining the <code class="literal">amlbcookie</code> cookie in your browser.
      </p></li></ol></li><li class="step"><p>
     Configure your load balancer to perform sticky load balancing
     based on the <code class="literal">amlbcookie</code> value.
    </p><p>
     In other words, the load balancer layer must keep track of
     which <code class="literal">amlbcookie</code> cookie value
     corresponds to which OpenAM server.
    </p><p>
     When the load balancer receives a request,
     it inspects the value of the <code class="literal">amlbcookie</code> cookie,
     and then forwards the request to the corresponding OpenAM server.
    </p></li></ol></div><div class="note"><h3 class="title">Note</h3><p>Sticky load balancing based on the value of the
    <code class="literal">amlbcookie</code> cookie does not guarantee request forwarding
    to the corresponding OpenAM server in all cases. For example,
    ForgeRock Common REST API calls do not typically use cookies. Therefore,
    load balancers are not able to route these calls to the OpenAM server
    on which a user's session resides.
   </p><p>
    When an OpenAM request to read a session arrives at a server that does not
    hold the user's session, the OpenAM server attempts to locate the session
    from the Core Token Service session store by default.
   </p><p>
    OpenAM servers can also use crosstalk to locate
    remote sessions. With crosstalk, OpenAM servers
    communicate with each other through a back channel to locate remote sessions.
    Because crosstalk generates network traffic, locating sessions from the
    Core Token Service session store is preferred for performance reasons.
   </p><p>
    Requests to log out or set a session attribute always use crosstalk to
    ensure the integrity of the update requests.
   </p><p>
   See
   <a href="../install-guide/index.html#chap-session-failover" class="link"><em class="citetitle">Setting Up OpenAM Session Failover</em></a>
   for information about configuring remote session location options.
  </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="handle-request-headers"></a>4.3.&nbsp;Handling HTTP Request Headers</h2></div></div></div><a class="indexterm" name="d12792e3321"></a><p>
   HTTP requests can include information needed for access management,
   such as the client IP address used for adaptive risk-based authentication.
  </p><p>
   Configure your load balancer or proxy to
   pass the information to OpenAM by using request headers.
   For example, the load balancer or proxy can send the client IP address
   by using the <code class="literal">X-Forwarded-For</code> HTTP request header.
  </p><p>
   If you use the distributed authentication UI, you can retain headers
   by using the <code class="literal">openam.retained.http.request.headers</code> setting
   as described in
   <a href="../install-guide/index.html#chap-install-das" class="link"><em class="citetitle">Installing OpenAM Distributed Authentication</em></a>.
  </p><p>
   Also configure OpenAM to consume and to forward the headers as necessary.
   When configuring OpenAM through the console, you set the following properties
   under Configuration &gt; Servers and Sites &gt; Servers
   &gt; <em class="replaceable"><code>Server Name</code></em> &gt; Advanced.
  </p><p>
   For example, to configure OpenAM to look for the client IP address
   in the <code class="literal">X-Forwarded-For</code> request header,
   set the advanced configuration property
   <code class="literal">com.sun.identity.authentication.client.ipAddressHeader</code>
   to <code class="literal">X-Forwarded-For</code>.
  </p><p>
   In a site configuration where one OpenAM server
   can forward requests to another OpenAM server,
   you can retain the header by adding it to the advanced configuration property
   <code class="literal">openam.retained.http.request.headers</code>.
   If <code class="literal">X-Forwarded-For</code> is the only additional header to retain,
   set <code class="literal">openam.retained.http.request.headers</code> to
   <code class="literal">X-DSAMEVersion,X-Forwarded-For</code>, for example.
  </p></div><div class="footnotes"><br><hr class="footnote-hr"><div id="ftn.d12792e3140" class="footnote"><p><a href="#d12792e3140" class="para"><sup class="para">[1] </sup></a>
       Technically it is possible to configure a site with only one OpenAM server.
      </p></div></div></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-install-das"></a>Chapter&nbsp;5.&nbsp;Installing OpenAM Distributed Authentication</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="section"><a href="#configure-valid-goto-url-resources">5.1. Configuring Valid goto URL Resources</a></span></dt></dl></div><a class="indexterm" name="d12792e3376"></a><a class="indexterm" name="d12792e3381"></a><p>OpenAM provides a login interface called the <span class="emphasis"><em>distributed authentication
  service (DAS)</em></span>, deployed within network demilitarized zones
  to limit OpenAM's exposure to the Internet.
  Login requests through the DAS are forwarded through the internal firewall to
  the OpenAM core server.
 </p><p>
  For more information see
  the OpenAM Administration Guide section on <a href="../admin-guide/index.html#protect-network-access" class="link"><em class="citetitle">Protecting Network
  Access</em></a>.
 </p><p>To deploy the DAS securely, select a system in your DMZ. Then take the following
  general steps:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Make sure the cookie domain for the DAS is configured in OpenAM under
    Configuration &gt; System &gt; Platform.</p></li><li class="listitem"><p>Make sure the realms used have a Realm/DNS alias for the DAS
    configured in OpenAM under Access Control &gt; <em class="replaceable"><code>Realm
    Name</code></em> &gt; General.</p></li><li class="listitem"><p>
    Create a 2.2 Agent profile in OpenAM for the DAS to connect to the server.
   </p><p>
    You can create the profile in OpenAM Console under
    Access Control &gt; <em class="replaceable"><code>Realm Name</code></em> &gt; Agents &gt; 2.2 Agents.
    See the <em class="citetitle">Administration Guide</em> section on
    <a href="../admin-guide/index.html#configure-22-policy-agent" class="link"><em class="citetitle">Configuring Version 2.2 Policy Agents</em></a> for details.
   </p></li><li class="listitem"><p>Deploy the OpenAM-DistAuth-12.0.0.war file into your web application
    container.</p><p>How you deploy the DAS .war file depends on your web application
     container. The procedure in this section shows how to deploy on
     Apache Tomcat.</p></li><li class="listitem"><p>Configure the DAS UI to access OpenAM core services.</p></li><li class="listitem"><p>Configure your firewall to allow end user access to the DAS.</p><p>Firewall configuration is not described here.</p></li></ol></div><div class="important"><h3 class="title">Important</h3><p>The DAS relies on the classic OpenAM UI. If you customize the end
    user pages, follow the procedures for the classic UI described in
    <a href="../install-guide/index.html#chap-custom-ui" class="link"><em class="citetitle">Customizing the
    OpenAM End User Pages</em></a>.</p></div><div class="procedure"><a name="deploy-distributed-auth-on-tomcat"></a><div class="procedure-title">Procedure&nbsp;5.1.&nbsp;To Deploy the DAS on Tomcat</div><a class="indexterm" name="d12792e3448"></a><ol class="procedure" type="1"><li class="step"><p>Copy the <code class="filename">OpenAM-DistAuth-12.0.0.war</code> file into the 
   <code class="filename">webapps/</code> directory.</p><div class="screen"><pre>
$ <strong>cp ~/Downloads/openam/OpenAM-DistAuth-12.0.0.war \
 /path/to/tomcat/webapps</strong>
   </pre></div></li><li class="step"><p>Check that you see the initial DAS configuration screen
   in your browser.</p></li></ol></div><div class="procedure"><a name="configure-distributed-auth"></a><div class="procedure-title">Procedure&nbsp;5.2.&nbsp;To Configure the DAS</div><a class="indexterm" name="d12792e3473"></a><ol class="procedure" type="1"><li class="step"><p>
    Configure the DAS using the agent profile to connect to OpenAM. The DAS agent
    profile can only be configured in the top level realm ("/").
    If working with sub-realms, you may then define the Realm/DNS alias for the
    DAS under Access Control &gt; <em class="replaceable"><code>Realm Name</code></em> &gt; General.
   </p><div class="mediaobject" align="center"><a name="figure-das-complete-config"></a><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/das-complete-config.png" align="middle" height="360" alt="Completed DAS configuration screen"></td></tr></table><div class="longdesc-link" align="right"><br clear="all"><span class="longdesc-link">[<a href="figure-das-complete-config.html" target="longdesc">D</a>]</span></div></div><p>Most DAS configuration choices require no clarification. Hints for
   equivocal parameters follow.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Debug Level</span></dt><dd><p>Default is <code class="literal">error</code>. Other options include
      <code class="literal">error</code>, <code class="literal">warning</code>,
      <code class="literal">message</code>, and <code class="literal">off</code>.</p></dd><dt><span class="term">Encryption Key</span></dt><dd><p>Do not change the password encryption key.</p></dd><dt><span class="term">Application User Name</span></dt><dd><p>
       The DAS uses this 2.2 Agent identity to authenticate to OpenAM.
      </p><p>
       You can find the 2.2 Agent profile in OpenAM Console under
       Access Control &gt; <em class="replaceable"><code>Realm Name</code></em> &gt; Agents &gt; 2.2 Agents
       as described above.
      </p></dd><dt><span class="term">Application User Password</span></dt><dd><p>The DAS uses this password to authenticate to OpenAM.</p></dd></dl></div></li><li class="step"><p>Login through the DAS to access OpenAM services.</p><p>For testing, you can login as user <code class="literal">demo</code>,
   password <code class="literal">changeit</code>.</p><div class="mediaobject" align="center"><a name="figure-das-login-success"></a><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/das-login-success.png" align="middle" height="360" alt="Successfully logged in through the DAS"></td></tr></table><div class="longdesc-link" align="right"><br clear="all"><span class="longdesc-link">[<a href="figure-das-login-success.html" target="longdesc">D</a>]</span></div></div><p>When the <code class="literal">/openam/idm/EndUser</code> page is inside the
   firewall, and therefore not visible to users outside, redirect the
   browser after successful login to a page that exists. One way to do this
   is to use the <code class="literal">goto</code> parameter in the URL.</p><pre class="literallayout">https://das.example.com/das/UI/Login?goto=<em class="replaceable"><code>absolute-successful-redirect-URL</code></em></pre><p>On successful login, your browser stores an
   <code class="literal">AMDistAuthConfig</code> cookie that identifies the DAS.</p></li><li class="step"><a name="das-configuration-file"></a><p>
    Restrict permissions to the configuration for the DAS
    under the <code class="filename">$HOME/FAMDistAuth</code> directory of the user
    who runs the web container where you deployed the service.
   </p><p>
    Configuration file names depend on the path where the DAS is deployed,
    and end in <code class="filename">AMDistAuthConfig.properties</code>.
    For example,
    if the DAS is deployed under <code class="filename">/path/to/tomcat/webapps/das/</code>
    then the configuration file name is
    <code class="filename">$HOME/FAMDistAuth/_path_to_tomcat_webapps_das_AMDistAuthConfig.properties</code>.
   </p></li><li class="step"><p>If you deploy multiple DAS servers, you can configure them to forward
   requests to each other based on the <code class="literal">AMDistAuthConfig</code>
   cookie by setting the <code class="literal">com.sun.identity.distauth.cluster</code>
   property in this file. The following example lines are wrapped to fit on the
   page, but you put the entire property on a single line in the configuration
   file.</p><pre class="brush: ini;">com.sun.identity.distauth.cluster=
 http://das.example.com:8080/das/UI/Login,
 http://das2.example.com:8080/das/UI/Login</pre></li><li class="step"><p>
    If your deployment includes multiple OpenAM servers,
    then edit the DAS configuration file
    mentioned in <a class="xref" href="#das-configuration-file" title="Step 3">Step 3</a>
    to include <code class="literal">X-Forwarded-For</code> in the list of
    <a href="../reference/index.html#openam-retained-http-request-headers" class="link"><code class="literal">openam.retained.http.request.headers</code></a>.
   </p><p>
    Example:
    <code class="literal">openam.retained.http.request.headers=X-DSAMEVersion,X-Forwarded-For</code>
   </p><p>This ensures the authoritative OpenAM authentication server gets
   the client IP address in this header of the forwarded HTTP request. You can
   also add the header to the list for the
   <code class="literal">openam.retained.http.headers</code> property to have OpenAM copy
   the header to the response.</p></li><li class="step"><p>Some application servers such as JBoss 7 mount the content of the
   deployed .war file in a temporary location that can change on restart. To
   make sure that the DAS can find its bootstrap configuration in this case,
   specify the path to the bootstrap configuration file as a Java runtime option
   for the DAS, as in the following example. The property to set is
   <code class="literal">openam.das.bootstrap.file</code>.</p><pre class="brush: ini;">-Dopenam.das.bootstrap.file=/home/openam/FAMDistAuth/AMDistAuthConfig.properties</pre><p>You must make sure that the value of the option corresponds to the path
   to the correct <code class="filename">AMDistAuthConfig.properties</code> file.</p></li><li class="step"><p>
    If your deployment uses a custom login URI,
    then edit the DAS configuration file
    mentioned in <a class="xref" href="#das-configuration-file" title="Step 3">Step 3</a>
    to add the custom login URI to the whitelist specified
    by the <code class="literal">org.forgerock.openam.cdc.validLoginURIs</code> property.
   </p><p>
    Example:
    <code class="literal">org.forgerock.openam.cdc.validLoginURIs=/UI/Login,/customLoginURI</code>
   </p><p>
    For more information about this property,
    see the <em class="citetitle">Reference</em> section on advanced properties,
    <a href="../reference/index.html#servers-advanced-configuration" class="link"><em class="citetitle">Servers &gt; Advanced</em></a>.
   </p></li></ol></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="configure-valid-goto-url-resources"></a>5.1.&nbsp;Configuring Valid goto URL Resources</h2></div></div></div><a class="indexterm" name="d12792e3664"></a><p>By default, OpenAM redirects the user to the URL specified in the
   <code class="literal">goto</code> and <code class="literal">gotoOnFail</code> query string parameters
   supplied to the authentication interface in the login URL.
  </p><p>
   You can increase security against possible phishing attacks through open redirect
   by specifying a list of valid URL resources against which OpenAM
   validates these URLs.

   OpenAM only redirects a user if the <code class="literal">goto</code> and
   <code class="literal">gotoOnFail</code> URL matches any of the resources specified in
   this setting.
   If no setting is present, it is assumed that the <code class="literal">goto</code> or
   <code class="literal">gotoOnFail</code> URL is valid.
  </p><div class="itemizedlist"><p>
    When setting valid <code class="literal">goto</code> URLs,
    you can use the "*" wildcard,
    where "*" matches all characters except "?".
    The following rules apply:
   </p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
     To allow only a single host name to be used
     when redirecting the user after authentication,
     specify the host name.
    </p><p>
     For example, if you specify
     <code class="literal">http*://secure.example.com</code>,
     then you can redirect only to
     URLs on <code class="literal">secure.example.com</code>,
     not URLs on <code class="literal">www.example.com</code>.
    </p></li><li class="listitem"><p>
     Start the domain name with <code class="literal">*.</code>
     to allow all host names in the domain to be used
     when redirecting the user after authentication.
    </p><p>
     For example, to allow redirects to URLs on any hosts in the domain
     <code class="literal">secure.example.com</code>,
     use <code class="literal">http*://*.secure.example.com</code>.
    </p><p>
     Note that <code class="literal">http*://*.secure.example.com</code>
     matches URLs on <code class="literal">www.secure.example.com</code>,
     and also URLs on <code class="literal">www.subdomain.secure.example.com</code>.
    </p><p>
     Also note that the <code class="literal">*</code> wildcard in the protocol,
     <code class="literal">http*://</code>, matches URLs starting with
     either <code class="literal">http://</code> or <code class="literal">https://</code>.
    </p></li><li class="listitem"><p>
     To match URLs using secure connections
     to <code class="literal">www.example.com</code> on any port,
     but no URLs with query string parameters,
     use <code class="literal">https://www.example.com:*/*</code>.
    </p></li></ul></div><div class="procedure"><a name="configure-valid-goto-url-resource"></a><div class="procedure-title">Procedure&nbsp;5.3.&nbsp;To Configure Valid goto URL Resources</div><p>
   You can increase security against possible phishing attacks through open redirect
   by specifying a list of valid URL resources using the Valid
   <code class="literal">goto</code> URL Resource service.
  </p><p>
   OpenAM only redirects a user if the <code class="literal">goto</code> and
   <code class="literal">gotoOnFail</code> URL matches any of the resources specified in
   this setting.
   If no setting is present, it is assumed that the <code class="literal">goto</code> or
   <code class="literal">gotoOnFail</code> URL is valid.
  </p><p>
   When setting valid <code class="literal">goto</code> URLs,
   you can use the "*" wildcard,
   where "*" matches all characters except "?".
   For more specific patterns,
   use resource names with wildcards as described in the procedure,
   <a href="../admin-guide/index.html#configure-valid-goto-url-resources" class="link"><em class="citetitle">Configuring Valid goto URL Resources</em></a>.
  </p><ol class="procedure" type="1"><li class="step"><p>Open the OpenAM console. Click Access Control &gt;
    <em class="replaceable"><code>Realm Name</code></em> &gt; Services, and
    then click Add.</p></li><li class="step"><p>Select Validation Service.</p></li><li class="step"><p>In the New Value box, enter a valid <code class="literal">goto</code> URL, and
   then click Add. You can repeat this step to enter additional URLs.</p></li></ol></div></div></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-custom-ui"></a>Chapter&nbsp;6.&nbsp;Customizing the OpenAM End User Pages</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="section"><a href="#basic-xui-configuration">6.1. Configuring the XUI</a></span></dt><dt><span class="section"><a href="#update-classic-ui">6.2. Updating the Classic UI (Legacy)</a></span></dt><dt><span class="section"><a href="#lookup-for-ui-files">6.3. How OpenAM Looks Up UI Files</a></span></dt></dl></div><a class="indexterm" name="d12792e3809"></a><p>
  When you deploy OpenAM to protect your web-based applications,
  users can be redirected to OpenAM pages for login and logout.
 </p><p>
  The end user pages have ForgeRock styling and branding by default.
  You likely want to change at least the images to reflect your organization.
  You might want different customizations for different realms.
  This chapter addresses how to get started customizing OpenAM end user pages
  for your organizations and supported locales.
 </p><div class="itemizedlist"><p>
   You configure which set of OpenAM pages the end user sees.
  </p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
    By default, end users see the XUI pages.
   </p><p>
    See <a class="xref" href="#basic-xui-configuration" title="6.1.&nbsp;Configuring the XUI">Section&nbsp;6.1, &#8220;Configuring the XUI&#8221;</a> for details.
   </p></li><li class="listitem"><p>
    For backwards compatibility, OpenAM bundles the classic UI pages as well.
    This can be useful when upgrading as it allows you to use customizations
    developed with earlier versions of OpenAM.
   </p><p>
    To enable the classic UI, disable the XUI.
   </p><a class="indexterm" name="d12792e3831"></a><p>
    You can disable XUI globally for an OpenAM server in OpenAM console under
    Configuration &gt; Authentication &gt; Core &gt; Global Attributes.
    Clear XUI Interface Enabled, save your work, and log out.
    When you return to the login page, you see the classic UI.
   </p></li></ul></div><p>
  While customizing the UI, you can set the advanced server property,
  <code class="literal">org.forgerock.openam.core.resource.lookup.cache.enabled</code>,
  to <code class="literal">false</code> to allow OpenAM immediately to pick up changes
  to the files as you customize them.
  This includes both the XML callback files for authentication modules
  used both by the XUI and also by the classic UI,
  and the JSP files used by the classic UI.
  You can set advanced server properties in OpenAM console under
  Configuration &gt; Servers and Sites &gt; <em class="replaceable"><code>Server Name</code></em> &gt; Advanced.
  Before using OpenAM in production, set
  <code class="literal">org.forgerock.openam.core.resource.lookup.cache.enabled</code>
  back to the default setting, <code class="literal">true</code>.
 </p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="basic-xui-configuration"></a>6.1.&nbsp;Configuring the XUI</h2></div></div></div><a class="indexterm" name="d12792e3858"></a><p>
      XUI is the default UI for OpenAM.
      Compared with the classic UI, XUI does more on the client side.
      XUI is based on JavaScript that accesses OpenAM REST APIs,
      and is styled with
      <a class="link" href="http://lesscss.org/" target="_blank">LESS CSS</a>.
     </p><p>
      Interface Stability:
      <a href="../admin-guide/index.html#interface-stability" class="link">Evolving</a>
     </p><p>
      The main XUI configuration file,
      <code class="filename">XUI/themeConfig.json</code> under the directory
      where you unpack OpenAM,
      serves to customize the look and feel of end user pages.
      For details, see the <em class="citetitle">Reference</em> chapter on
      <a href="../reference/index.html#chap-xui-parameters" class="link"><em class="citetitle">XUI Configuration Parameters</em></a>.
     </p><p>
      You can set different themes for different realms
      by adding each realm configuration to the array of "themes",
      with the realm "name", "path", and "realms" fields set appropriately.
      The following example shows a new theme for <code class="literal">myRealm</code>
      added after the default theme.
     </p><pre class="brush: javascript;">
{
     "themes": [
         {
            "name": "default",
            "path": "",
            "realms": [".*"],
            "regex"" true,

         . . .

                 "footer": {
                    "mailto": "info@forgerock.com",
                    "phone": ""
                 }
             }
         },
         {
            "name": "myRealm",
            "path": "path/to/myRealm/",
            "realms": ["myRealm.*"],
            "regex": true,

         . . .

                "footer": {
                    "mailto": "info@example.com",
                    "phone": "+1 555 555 5555"
                }
            }
         }
     ]
}</pre><p>
      Make sure <code class="filename">themeConfig.json</code> is valid JSON
      after you apply your changes.
      If in doubt, use a validator such as
      <a class="link" href="http://jsonlint.com" target="_blank">http://jsonlint.com</a>.
     </p><p>If you want to keep a parameter used in the default realm, just delete it from the later realm. Except
     for the following parameters, realm parameters inherit values from the default: <code class="literal">name</code>,
     <code class="literal">path</code>, <code class="literal">realms</code>, and <code class="literal">regex</code>.</p><p>When configuring new or revised parameters, keep the following tips in mind:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The <code class="literal">path</code> to the directory with custom realm settings requires a
             trailing forward slash <code class="literal">/</code>.</p></li><li class="listitem"><p>Logos may require custom height and width parameters.</p></li><li class="listitem"><p>Each of the <code class="literal">lessVars</code> parameters are based on variables defined in files
             in the <code class="filename">XUI/css/user</code> directory.</p></li><li class="listitem"><p>After making changes, use available tools to make sure the file uses correct JSON syntax.</p></li><li class="listitem"><p>Each realm after the default requires at least the <code class="literal">name</code>,
             <code class="literal">path</code>, <code class="literal">realms</code>, and <code class="literal">regex</code>
             parameters.</p></li></ul></div><p>When testing different options, make sure to clear the browser cache on a regular basis. Otherwise, changes
     that you have made might not be shown in your browser.</p><p>
      Much of the text supplied in XUI
      is stored in <code class="filename">translation.json</code> files for each locale.
      To customize the English text,
      edit <code class="filename">XUI/locales/en/translation.json</code>
      under the directory where OpenAM is unpacked for deployment.
      To prepare a translation for a new locale, copy the English file,
      <code class="filename">XUI/locales/en/translation.json</code>,
      to <code class="filename">XUI/locales/<em class="replaceable"><code>new-locale</code></em>/</code>
      and edit the copy changing only the values not the keys,
      and taking care not to change the JSON structure or to render it invalid.
     </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="update-classic-ui"></a>6.2.&nbsp;Updating the Classic UI (Legacy)</h2></div></div></div><a class="indexterm" name="d12792e3977"></a><p>
      To customize the classic UI,
      first you copy the pages to customize to the proper location,
      and then you customize the files themselves.
     </p><p>
      Interface Stability:
      <a href="../admin-guide/index.html#interface-stability" class="link">Deprecated</a>
     </p><p>
      Classic UI provides pages localized for English, French, German, Spanish,
      Japanese, Korean, Simplified Chinese, and Traditional Chinese,
      but you might require additional language support for your organization.
     </p><p>
      Classic UI images are located under <code class="filename">images/</code>,
      and CSS under <code class="filename">css/</code>
      where OpenAM files are unpacked for deployment.
      If you choose to modify images for your deployment,
      maintain image size dimensions to avoid having to change page layout.
     </p><p>When developing with a web container that deploys
         OpenAM in a temporary location, such as JBoss or Jetty, restarting the
         container can overwrite your changes with the deployable .war content. For
         those web containers, you should also prepare a deployable .war containing
         your changes, and redeploy that file to check your work.</p><div class="tip"><h3 class="title">Tip</h3><p>For production deployment you must package your changes in a custom
         OpenAM deployable .war file. To create a deployable .war, unpack the
         OpenAM .war file from <code class="filename">~/Downloads/openam</code>
         into a staging directory, apply your changes in the staging directory, and
         use the <span class="command"><strong>jar</strong></span> command  to prepare the deployable .war.</p></div><div class="itemizedlist"><p>The procedures below describe how to update a deployed version of
             OpenAM, so that you can see your changes without redeploying the application.
             This approach works for development as long as your web container does
             not overwrite changes.</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><a class="xref" href="#copy-ui-to-customize-top-level-realm" title="Procedure&nbsp;6.1.&nbsp;To Copy the Pages to Customize For the Top-Level Realm">Procedure&nbsp;6.1, &#8220;To Copy the Pages to Customize For the Top-Level Realm&#8221;</a></p></li><li class="listitem"><p><a class="xref" href="#copy-ui-to-customize-subrealm" title="Procedure&nbsp;6.2.&nbsp;To Copy the Pages to Customize For Another Realm">Procedure&nbsp;6.2, &#8220;To Copy the Pages to Customize For Another Realm&#8221;</a></p></li><li class="listitem"><p><a class="xref" href="#customize-ui-copy" title="Procedure&nbsp;6.3.&nbsp;To Customize Files You Copied">Procedure&nbsp;6.3, &#8220;To Customize Files You Copied&#8221;</a></p></li></ul></div><div class="procedure"><a name="copy-ui-to-customize-top-level-realm"></a><div class="procedure-title">Procedure&nbsp;6.1.&nbsp;To Copy the Pages to Customize For the Top-Level Realm</div><p>Rather than changing the default pages, customize your own copy.</p><ol class="procedure" type="1"><li class="step"><p>Change to the <code class="filename">config/auth</code> directory where
   you deployed OpenAM.</p><div class="screen"><pre>
$ <strong>cd /path/to/tomcat/webapps/openam/config/auth</strong>
   </pre></div></li><li class="step"><p>Copy the default files and optionally the localized files to
   <code class="filename"><em class="replaceable"><code>suffix</code></em>[_<em class="replaceable"><code>locale</code></em>]/html</code>,
   where <em class="replaceable"><code>suffix</code></em> is the value of the RDN of the
   configuration suffix, such as <code class="literal">openam</code> if you use the
   default configuration suffix <code class="literal">dc=openam,dc=forgerock,dc=org</code>,
   and the optional <em class="replaceable"><code>locale</code></em> is, for example,
   <code class="literal">jp</code> for Japanese, or <code class="literal">zh_CN</code> for
   Simplified Chinese.</p><p>The following example copies the files for the Top-Level Realm
   (<code class="literal">/</code>) for a custom French locale.</p><div class="screen"><pre>
$ <strong>mkdir -p openam/html</strong>
$ <strong>cp -r default/* openam/html</strong>
$ <strong>mkdir -p openam_fr/html</strong>
$ <strong>cp -r default_fr/* openam_fr/html</strong>
   </pre></div><p>
    See <a class="xref" href="#lookup-for-ui-files" title="6.3.&nbsp;How OpenAM Looks Up UI Files">Section&nbsp;6.3, &#8220;How OpenAM Looks Up UI Files&#8221;</a> for details.
   </p></li><li class="step"><p>
    You can now either follow
    the steps in <a class="xref" href="#copy-ui-to-customize-subrealm" title="Procedure&nbsp;6.2.&nbsp;To Copy the Pages to Customize For Another Realm">Procedure&nbsp;6.2, &#8220;To Copy the Pages to Customize For Another Realm&#8221;</a>,
    or in <a class="xref" href="#customize-ui-copy" title="Procedure&nbsp;6.3.&nbsp;To Customize Files You Copied">Procedure&nbsp;6.3, &#8220;To Customize Files You Copied&#8221;</a>.
   </p></li></ol></div><div class="procedure"><a name="copy-ui-to-customize-subrealm"></a><div class="procedure-title">Procedure&nbsp;6.2.&nbsp;To Copy the Pages to Customize For Another Realm</div><p>As for the top-level realm, customize your own copy rather than the
  default pages.</p><ol class="procedure" type="1"><li class="step"><p>Change to the <code class="filename">config/auth</code> directory where
   you deployed OpenAM.</p><div class="screen"><pre>
$ <strong>cd /path/to/tomcat/webapps/openam/config/auth</strong>
   </pre></div></li><li class="step"><p>Depending on which locale you want to customize, copy the default
   files and optionally the localized files to
   <code class="filename"><em class="replaceable"><code>suffix</code></em>[_<em class="replaceable"><code>locale</code></em>]/services/<em class="replaceable"><code>realm</code></em>/html</code>, where
   <em class="replaceable"><code>suffix</code></em> is the value of the RDN of the
   configuration suffix, which is <code class="literal">openam</code> if you use the
   default configuration suffix <code class="literal">dc=openam,dc=forgerock,dc=org</code>.</p><p>The following example copies the files for a custom French locale and
   a realm named <code class="literal">ventes</code>.</p><div class="screen"><pre>
$ <strong>mkdir -p openam/services/ventes/html</strong>
$ <strong>cp -r default/* openam/services/ventes/html</strong>
$ <strong>mkdir -p openam_fr/services/ventes/html</strong>
$ <strong>cp -r default_fr/* openam_fr/services/ventes/html</strong>
   </pre></div></li><li class="step"><p>
    You can now follow the steps in <a class="xref" href="#customize-ui-copy" title="Procedure&nbsp;6.3.&nbsp;To Customize Files You Copied">Procedure&nbsp;6.3, &#8220;To Customize Files You Copied&#8221;</a>.
   </p></li></ol></div><div class="procedure"><a name="customize-ui-copy"></a><div class="procedure-title">Procedure&nbsp;6.3.&nbsp;To Customize Files You Copied</div><p>The .jsp files from the <code class="filename">default/</code> directory
  reference the images used in the OpenAM pages, and retrieve localized text
  from the .xml files. Thus you customize appearance through the .jsp files,
  being careful not to change the functionality itself. You customize the
  localized text through the .xml files.</p><ol class="procedure" type="1"><li class="step"><p>Modify appearance if you must by editing the .jsp, image, and
   CSS files without changing any of the JSP tags that govern how the pages
   work.</p></li><li class="step"><p>Modify the localized text, using UTF-8 without escaped characters, by
   changing only the original text strings in the .xml files.</p><p>For example, to change the text in the default OpenAM login screen in
   the top-level realm for the French locale, edit
   <code class="filename">openam_fr/html/DataStore.xml</code>.</p></li><li class="step"><p>
    After making the changes, restart OpenAM or the web container where it runs.
   </p></li><li class="step"><p>
    Test the changes you have made.
   </p><p>The following screen shot shows a customized French login page
   where the string <code class="literal">Nom d'utilisateur</code> has been replaced
   with the string <code class="literal">Votre identifiant</code>, and the string
   <code class="literal">Mot de passe</code> has been replaced with the string
   <code class="literal">Votre mot de passe</code> in
   <code class="filename">openam_fr/html/DataStore.xml</code>.</p><div class="mediaobject" align="center"><a name="figure-modified-fr-login"></a><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/modified-fr-login.png" align="middle" height="360" alt="Example customized OpenAM login page"></td></tr></table><div class="longdesc-link" align="right"><br clear="all"><span class="longdesc-link">[<a href="figure-modified-fr-login.html" target="longdesc">D</a>]</span></div></div></li><li class="step"><p>
    As mentioned in the tip at the outset of this section,
    build a customized OpenAM .war that includes your tested changes,
    and use this customized .war to deploy OpenAM.
   </p></li></ol></div><div class="procedure"><a name="customize-ui-elements"></a><div class="procedure-title">Procedure&nbsp;6.4.&nbsp;To Customize UI Elements</div><p>
    To customize classic UI elements such as button text on the login screen,
    follow these steps.
   </p><ol class="procedure" type="1"><li class="step"><p>
     Unpack the core OpenAM library, <code class="filename">openam-core-12.0.0.jar</code>,
     that contains the text in Java properties files.
    </p><p>
     This library is available under <code class="filename">WEB-INF/lib/</code>
     where OpenAM is unpacked for deployment.
     In the following example OpenAM is deployed on Apache Tomcat.
    </p><div class="screen"><pre>
$ <strong>mkdir openam-core &amp;&amp; cd openam-core</strong>
$ <strong>jar xf /path/to/tomcat/webapps/openam/WEB-INF/lib/openam-core-12.0.0.jar</strong>
    </pre></div></li><li class="step"><p>
     Edit only property values in the appropriate properties files.
    </p></li><li class="step"><p>
     Prepare a new core OpenAM library with your modifications.
    </p><div class="screen"><pre>
$ <strong>jar cf ../openam-core-12.0.0.jar *</strong>
    </pre></div></li><li class="step"><p>
     Replace the existing core OpenAM library with your modified version.
    </p><p>
     The following example replaces the library only in a deployed OpenAM server.
    </p><div class="screen"><pre>
$ <strong>cp openam-core-12.0.0.jar /path/to/tomcat/webapps/openam/WEB-INF/lib/</strong>
    </pre></div><p>
     When preparing for production deployment make the modification
     in the OpenAM war file, <code class="filename">OpenAM-12.0.0.war</code>, instead.
    </p></li><li class="step"><p>
     Restart OpenAM or the container in which it runs to load the changes.
    </p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="lookup-for-ui-files"></a>6.3.&nbsp;How OpenAM Looks Up UI Files</h2></div></div></div><a class="indexterm" name="d12792e4269"></a><p>
   This section provides a more complete description
   of how OpenAM looks up UI files.
  </p><div class="note"><h3 class="title">Note</h3><p>
   Case mismatch can cause failures in the UI lookup for some systems.
   To ensure lookup success and for consistency,
   use lowercase names for your customized directories
   except for locale territories.
   All of the default directories are already lowercase.
  </p></div><p>
   Locale settings play an important role in how OpenAM looks up UI files.
   A locale consists of a language and optionally a territory
   such as <code class="literal">en</code> to specify the English language,
   or <code class="literal">en_GB</code> to specify British English.
   Locale settings are determined at authentication time,
   and are then set in the authentication context.
   To change locales, the user must reauthenticate.
   OpenAM allows you and also clients to set locale in the ways described below.
  </p><div class="orderedlist"><p>
    When finding the UI files that best match the user's locale,
    OpenAM takes two locale settings into account.
   </p><ol class="orderedlist" type="1"><li class="listitem"><p>
     Requested locale
    </p><p>
     OpenAM arrives at the requested locale based on
     an optional <code class="literal">locale</code> query string parameter,
     an optional HTTP <code class="literal">Accept-Language</code> header from the browser,
     and the Default Locale set in the configuration for OpenAM.
    </p></li><li class="listitem"><p>
     Platform locale
    </p><p>
     When OpenAM cannot find a match for the user's requested locale,
     it tries to use the platform locale,
     which is the locale for the Java Virtual Machine (JVM) where OpenAM runs.
    </p><p>
     If neither the requested locale nor the platform locale result in a match,
     OpenAM returns the default files that are not localized.
    </p></li></ol></div><div class="variablelist"><p>
    OpenAM uses the following information to look up the UI files.
   </p><dl class="variablelist"><dt><span class="term">Configuration suffix RDN value</span></dt><dd><p>
      When you set up OpenAM to store its configuration in a directory server,
      you provide the distinguished name of the configuration suffix,
      by default <code class="literal">dc=openam,dc=forgerock,dc=org</code>.
      Therefore, the default relative distinguished name attribute value
      is <code class="literal">openam</code>.
     </p></dd><dt><span class="term">Client locale query string parameter</span></dt><dd><p>
      The client can request a locale by using the <code class="literal">locale</code>
      query string parameter when performing an HTTP GET on the login page.
     </p><p>
      For example, a client can specify <code class="literal">locale=fr</code>
      to request the French language.
     </p></dd><dt><span class="term">Client (browser) locale language and territory</span></dt><dd><p>
      The client can specify a locale
      by using the HTTP <code class="literal">Accept-Language</code> header.
      End users set this behavior by choosing languages and territory settings
      in their web browser preferences.
     </p><p>
      The value of this header can include a list of languages
      with information about how strongly the user prefers each language.
      OpenAM uses the first language in the list.
     </p></dd><dt><span class="term">Default locale</span></dt><dd><p>
      You set the default locale in OpenAM when you install OpenAM core services.
      You can change the default locale either through OpenAM console under
      Configuration &gt; Servers and Sites &gt; <em class="replaceable"><code>server-name</code></em>
      &gt; General &gt; System &gt; Default Locale,
      or by setting the server configuration property,
      <code class="literal">com.iplanet.am.locale</code>.
     </p><p>
      Default locale only affects the requested locale.
      Do not confuse the Default Locale setting
      with the locale that OpenAM uses
      when it cannot find matching UI files for the requested locale.
     </p><p>
      Default: <code class="literal">en_US</code>
     </p></dd><dt><span class="term">Requested locale</span></dt><dd><p>
      OpenAM determines the requested locale based on multiple settings.
     </p><p>
      If the <code class="literal">locale</code> query string parameter is set,
      OpenAM uses this setting as the requested locale.
     </p><p>
      Otherwise, if the client set the <code class="literal">Accept-Language</code> header,
      OpenAM uses this setting as the requested locale.
     </p><p>
      Otherwise OpenAM uses the default locale as the requested locale.
     </p></dd><dt><span class="term">Platform locale language and territory</span></dt><dd><p>
      The locale for the Java Virtual Machine (JVM) where OpenAM runs
      is the platform locale.
      Platform locale is the alternative when
      OpenAM cannot find files for the requested locale.
     </p><p>
      By default the JVM uses the system locale.
      You can, however, set the JVM platform locale when starting Java
      by using Java system properties.
      The following example that sets the platform locale
      to the Hungarian language in Hungary.
     </p><pre class="brush: shell;">
java -Duser.language=hu -Duser.region=HU other options
     </pre><p>
      See the documentation about your JVM for details.
     </p><p>
      If OpenAM cannot find matching UI files either for the requested locale
      or for the platform locale,
      it returns UI files that are not localized.
     </p></dd><dt><span class="term">Realm</span></dt><dd><p>
      Realms can be nested.
      OpenAM uses the nesting as necessary to look for files
      specific to a subrealm before looking in the parent realm.
     </p><p>
      For all realms below the top level realm,
      OpenAM adds a <code class="filename">services</code> directory
      to the search path before the realm.
     </p></dd><dt><span class="term">Client name</span></dt><dd><p>
      Client names identify the type of client.
      The default, <code class="literal">html</code>, is the only client name used
      unless client detection mode is enabled.
      When client detection mode is enabled,
      the client name can be different for mobile clients, for example.
     </p></dd><dt><span class="term">File name</span></dt><dd><p>
      File names are not themselves localized.
      For example, <code class="filename">Login.jsp</code> has the same name in all locales.
     </p></dd></dl></div><p>
   OpenAM tries first to find the most specific file
   for the realm and locale requested,
   gradually falling back on less specific alternatives,
   then on other locales.
   The first and most specific location is as follows.
  </p><div class="literallayout"><p><em class="replaceable"><code>suffix</code></em>_<em class="replaceable"><code>requested-locale-language</code></em>_<em class="replaceable"><code>requested-locale-territory</code></em>/services/<em class="replaceable"><code>realm</code></em>/<em class="replaceable"><code>client-name</code></em>/<em class="replaceable"><code>file-name</code></em></p></div><div class="example"><a name="example-ui-file-lookup"></a><div class="example-title">Example&nbsp;6.1.&nbsp;UI File Lookup</div><div class="example-contents"><p>
    OpenAM looks up <code class="filename">Login.jsp</code> in the following order
    for a realm named <code class="literal">myRealm</code>,
    with the requested locale being <code class="literal">en_GB</code>,
    the platform locale being <code class="literal">hu_HU</code>,
    and the configuration suffix named <code class="literal">dc=openam,dc=forgerock,dc=org</code>.
    The client name used in this example
    is the generic client name <code class="literal">html</code>.
   </p><pre class="brush: plain;">
openam_en_GB/services/myRealm/html/Login.jsp
openam_en_GB/services/myRealm/Login.jsp
openam_en_GB/services/html/Login.jsp
openam_en_GB/services/Login.jsp
openam_en_GB/html/Login.jsp
openam_en_GB/Login.jsp
openam_en/services/myRealm/html/Login.jsp
openam_en/services/myRealm/Login.jsp
openam_en/services/html/Login.jsp
openam_en/services/Login.jsp
openam_en/html/Login.jsp
openam_en/Login.jsp
openam_hu_HU/services/myRealm/html/Login.jsp
openam_hu_HU/services/myRealm/Login.jsp
openam_hu_HU/services/html/Login.jsp
openam_hu_HU/services/Login.jsp
openam_hu_HU/html/Login.jsp
openam_hu_HU/Login.jsp
openam_hu/services/myRealm/html/Login.jsp
openam_hu/services/myRealm/Login.jsp
openam_hu/services/html/Login.jsp
openam_hu/services/Login.jsp
openam_hu/html/Login.jsp
openam_hu/Login.jsp
openam/services/myRealm/html/Login.jsp
openam/services/myRealm/Login.jsp
openam/services/html/Login.jsp
openam/services/Login.jsp
openam/html/Login.jsp
openam/Login.jsp
default_en_GB/services/myRealm/html/Login.jsp
default_en_GB/services/myRealm/Login.jsp
default_en_GB/services/html/Login.jsp
default_en_GB/services/Login.jsp
default_en_GB/html/Login.jsp
default_en_GB/Login.jsp
default_en/services/myRealm/html/Login.jsp
default_en/services/myRealm/Login.jsp
default_en/services/html/Login.jsp
default_en/services/Login.jsp
default_en/html/Login.jsp
default_en/Login.jsp
default_hu_HU/services/myRealm/html/Login.jsp
default_hu_HU/services/myRealm/Login.jsp
default_hu_HU/services/html/Login.jsp
default_hu_HU/services/Login.jsp
default_hu_HU/html/Login.jsp
default_hu_HU/Login.jsp
default_hu/services/myRealm/html/Login.jsp
default_hu/services/myRealm/Login.jsp
default_hu/services/html/Login.jsp
default_hu/services/Login.jsp
default_hu/html/Login.jsp
default_hu/Login.jsp
default/services/myRealm/html/Login.jsp
default/services/myRealm/Login.jsp
default/services/html/Login.jsp
default/services/Login.jsp
default/html/Login.jsp
default/Login.jsp
   </pre></div></div><br class="example-break"></div></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-cts"></a>Chapter&nbsp;7.&nbsp;Configuring the Core Token Service (CTS)</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="section"><a href="#cts-config">7.1. CTS Configuration Parameters</a></span></dt><dt><span class="section"><a href="#cts-schema">7.2. CTS Schema and Indexes</a></span></dt><dt><span class="section"><a href="#cts-acis">7.3. CTS Access Control Instructions</a></span></dt><dt><span class="section"><a href="#cts-opendj-preparation">7.4. Preparing an OpenDJ Directory Service for CTS</a></span></dt><dt><span class="section"><a href="#cts-replication">7.5. CTS and OpenDJ Replication</a></span></dt><dt><span class="section"><a href="#cts-token-managing">7.6. Managing CTS Tokens</a></span></dt><dt><span class="section"><a href="#cts-tuning-considerations">7.7. CTS Tuning Considerations</a></span></dt><dt><span class="section"><a href="#cts-general-recommend">7.8. General Recommendations for CTS Configuration</a></span></dt></dl></div><a class="indexterm" name="d12792e4481"></a><p>The Core Token Service (CTS) provides persistent and highly available
  token storage for OpenAM session, OAuth 2.0, and SAML 2.0 tokens.
  CTS is set up in a generalized token storage format, which by default is
  always used for OAuth 2.0 tokens.
  If configured, it can also be used to persist session and SAML 2.0 tokens.</p><p>The easiest CTS configuration is to run the default configuration
  option in the installer, which uses an embedded OpenDJ directory server to store both
  configuration and CTS tokens including the CTS schema.
  If your deployment requires it, you can go beyond the default
  embedded directory server and deploy separate external directory servers to store
  configuration and CTS data.
 </p><div class="important"><h3 class="title">Important</h3><p>CTS relies on OpenDJ to store and replicate its tokens.
   Only OpenDJ is supported for CTS. No other directory server is supported currently.
  </p><p>
   If you deploy separate external stores for configuration
   and CTS data respectively, note that external <span class="emphasis"><em>configuration</em></span> stores
   support OpenDJ and DSEE servers, while
   external <span class="emphasis"><em>CTS</em></span> stores only support OpenDJ currently.
  </p></div><p>CTS tokens are volatile and change frequently, while other data stored
  in an OpenDJ server is considerably more static.
  Therefore, the performance tuning requirements are quite different for
  both types of data.
 </p><p>If you choose to set up CTS in an external OpenDJ instance, you will
   have to install OpenDJ separately from OpenAM.
   For more information, see the
   
   <a class="link" href="http://docs.forgerock.org/en/opendj/2.6.0/install-guide/" target="_blank">
         <em class="citetitle">OpenDJ Installation Guide</em></a>.</p><p>Once you have installed OpenDJ on an external server,
   you should first configure the basic parameters for the CTS token store in the
   OpenAM console.
   After that, you can set up schema definitions,
   specify tokens in a valid LDAP format, configure indexes to allow OpenAM to retrieve tokens,
   and possibly Access Control Instructions (ACIs) to give an appropriate user Create, Read,
   Update, and Delete (CRUD) privileges.
  </p><p>The procedures to run these tasks are presented in the following sections.</p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="cts-config"></a>7.1.&nbsp;CTS Configuration Parameters</h2></div></div></div><a class="indexterm" name="d12792e4517"></a><p>If you want to reconfigure an existing implementation of CTS,
     any reconfiguration orphans any tokens that are currently stored, which
     may require users to log in again.
     To keep this from happening, disable client access to OpenAM before making
     any changes. Any changes require a server restart to put them into
     effect.</p><p>To access the main CTS configuration page from the console, select Configuration &gt; Servers and Sites &gt;
    Default Server Settings &gt; CTS. The options that appear in the screenshot that follows are detailed in the
    <a href="../reference/index.html#servers-cts" class="link">
    <em class="citetitle">Reference</em></a> document. You can set a root suffix for CTS tokens in either the
    configuration store or an external token store.</p><p>If you select <code class="literal">Default Token Store</code>, OpenAM will use the embedded configuration
    store for CTS tokens.</p><div class="note"><h3 class="title">Note</h3><p>If desired, you could make these changes from the command line with variations on the
    <a href="../reference/index.html#ssoadm-update-server-cfg" class="link"><span class="command"><strong>ssoadm update-server-cfg</strong></span></a>
    command, as described in the OpenAM Reference document.</p></div><div class="mediaobject" align="center"><a name="cts-default-store"></a><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/cts-default-store.png" align="middle" height="360" alt="Configuring Default Server CTS Options"></td></tr></table><div class="longdesc-link" align="right"><br clear="all"><span class="longdesc-link">[<a href="cts-default-store.html" target="longdesc">D</a>]</span></div></div><p>Possible options have been entered in the figure.
     If the <code class="literal">External Token Store</code> is selected, entries are
     required in all text boxes. The options shown in the figure are:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code class="literal">Root Suffix</code></p><p><code class="literal">dc=cts,dc=example,dc=com</code></p><p>
         When you configure a new OpenDJ suffix for the CTS,
         also consider creating a dedicated OpenDJ backend for the suffix.

         This allows you to manage CTS data separately from less volatile data.
        </p></li><li class="listitem"><p><code class="literal">SSL/TLS Enabled</code></p><p>By default, disabled. Click the checkbox to enable SSL or TLS for
         the connection to the directory server.
        </p></li><li class="listitem"><p><code class="literal">Connection String(s)</code></p><p>Specifies the ordered list of connection strings for the external
         OpenDJ directory servers. The format is: <code class="literal">HOST:PORT[|SERVERID[|SITEID]]</code>,
         where <code class="literal">SERVERID</code> and <code class="literal">SITEID</code> are
         optional parameters, which prioritize the particular connection when
         used by the specified node(s).
        </p><p><code class="literal">opendj.example.com:389, opendj2.example.com:50389|server1|site1</code></p></li><li class="listitem"><p><code class="literal">Login Id</code></p><p><code class="literal">uid=openam,ou=admins,dc=example,dc=com</code></p><p>
         This is the DN of a user with administrative access to CTS data.

         The value here corresponds to the DN used in the examples in
         <a class="xref" href="#cts-acis" title="7.3.&nbsp;CTS Access Control Instructions">Section&nbsp;7.3, &#8220;CTS Access Control Instructions&#8221;</a>.

         You can bypass access control by binding with a root DN such as
         <code class="literal">cn=Directory Manager</code>.
        </p></li><li class="listitem"><p><code class="literal">Password</code></p></li><li class="listitem"><p>
         <code class="literal">Max Connections</code>
        </p><p>
         When the directory service backing the CTS is external
         (differs from the directory service backing the OpenAM configuration)
         then this setting configures the maximum number of connections
         in the connection pool used to access the directory service for the CTS.
         One connection is reserved for cleanup of expired tokens.
         The other connections are available for CTS operations.
        </p><p>
         <code class="literal">17</code>
         (16 connections for CTS operations, 1 for token cleanup)
        </p></li><li class="listitem"><p><code class="literal">Heartbeat</code></p><p><code class="literal">10</code> (default, in seconds)</p></li></ul></div><p>Navigate to Configuration &gt; Servers and Sites &gt; Default Server Settings &gt; CTS. Any options that
    you change under this tab are inherited as defaults by individual servers. To confirm, make a change, and then
    navigate to Configuration &gt; Servers and Sites &gt; [Server Name] &gt; CTS.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="cts-schema"></a>7.2.&nbsp;CTS Schema and Indexes</h2></div></div></div><a class="indexterm" name="d12792e4635"></a><a class="indexterm" name="d12792e4640"></a><p>OpenAM stores volatile CTS token data in an instance of OpenDJ. To make that possible, OpenDJ needs
    the associated configuration store indexes, which allow OpenAM to search CTS token data in an efficient
    manner.</p><p>Different schema files are available in the OpenAM
    <code class="filename">WEB-INF/template/ldif/sfha</code> directory. If you install OpenAM
    with the embedded version of OpenDJ, the schema from the <code class="filename">cts-add-schema.ldif</code>,
    <code class="filename">cts-container.ldif</code>, and <code class="filename">cts-indices.ldif</code> files are installed.
    If you upgrade to OpenAM 12.0.0 from a previous version with embedded OpenDJ,
    the schema from the <code class="filename">99-cts-add-schema-backport.ldif</code> file is incorporated in your
    upgrade.</p><p>
     However, if you are configuring an external OpenDJ CTS server,
     you must add schema manually.

     You must also configure the indexes in the table shown below.

     To do so, you can use the <span class="command"><strong>dsconfig</strong></span>
     command depicted in the <em class="citetitle">OpenDJ Administration Guide</em>
     chapter on <a class="link" href="http://docs.forgerock.org/en/opendj/2.6.0/admin-guide/#configure-indexes" target="_blank"><em class="citetitle">Configuring a Standard Index</em></a>.
    </p><p>
     After creating indexes for the external OpenDJ CTS server,
     rebuild the indexes with the <span class="command"><strong>rebuild-index</strong></span> command
     described in the <em class="citetitle">OpenDJ Administration Guide</em>
     chapter on <a class="link" href="http://docs.forgerock.org/en/opendj/2.6.0/admin-guide/#rebuild-index" target="_blank"><em class="citetitle">Rebuilding Indexes</em></a>.
    </p><div class="table"><a name="cts-configuration-store-indexes"></a><div class="table-title">Table&nbsp;7.1.&nbsp;CTS Data Store Indexes</div><div class="table-contents"><table summary="CTS Data Store Indexes" border="0"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th>Attribute</th><th>Indexes Required</th></tr></thead><tbody><tr><td><code class="literal">coreTokenDate01</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenDate02</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenDate03</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenDate04</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenDate05</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenExpirationDate</code></td><td>ordering</td></tr><tr><td><code class="literal">coreTokenInteger01</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenInteger02</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenInteger03</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenInteger04</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenInteger05</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenInteger06</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenInteger07</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenInteger08</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenInteger09</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenInteger10</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenString01</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenString02</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenString03</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenString04</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenString05</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenString06</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenString07</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenString08</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenString09</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenString10</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenString11</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenString12</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenString13</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenString14</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenString15</code></td><td>equality</td></tr><tr><td><code class="literal">coreTokenUserId</code></td><td>equality</td></tr></tbody></table></div></div><br class="table-break"></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="cts-acis"></a>7.3.&nbsp;CTS Access Control Instructions</h2></div></div></div><a class="indexterm" name="d12792e4896"></a><p>
     If you bind to the OpenDJ CTS server as a root DN user,
     such <code class="literal">cn=Directory Manager</code>, you can skip this section.
    </p><p>
     If you bind as a regular administrative user,
     you must give the user appropriate access to the CTS data.

     Give the regular administrative user access to
     add, delete, modify, read, and search CTS data,
     by setting access control instructions on the Root Suffix entry for CTS data.

     The user in examples shown here has DN
     <code class="literal">uid=openam,ou=admins,dc=cts,dc=example,dc=com</code>, but
     set your DN to match your installation.
    </p><pre class="brush: ldif;">aci: (version 3.0;acl "Add config entry";
 allow (add)(userdn =
 "ldap:///uid=openam,ou=admins,dc=cts,dc=example,dc=com");)
aci: (targetattr="*")(version 3.0;acl "Allow entry search";
 allow (search, read)(userdn =
 "ldap:///uid=openam,ou=admins,dc=cts,dc=example,dc=com");)
aci: (targetattr="*")(version 3.0;acl "Modify entries";
 allow (write)(userdn =
 "ldap:///uid=openam,ou=admins,dc=cts,dc=example,dc=com");)
aci: (version 3.0;acl "Delete entries";
 allow (delete)(userdn =
 "ldap:///uid=openam,ou=admins,dc=cts,dc=example,dc=com");)
aci: (targetcontrol="2.16.840.1.113730.3.4.3")(version 3.0;acl "Allow
 persistent search";
 allow (search, read)(userdn =
 "ldap:///uid=openam,ou=admins,dc=cts,dc=example,dc=com");)</pre><p>For detailed information on ACIs, with examples showing how you can use
     the <span class="command"><strong>dsconfig</strong></span>,
     as well as various <span class="command"><strong>ldap*</strong></span> commands to configure them,
     see the OpenDJ chapter on
    <a class="link" href="http://docs.forgerock.org/en/opendj/2.6.0/admin-guide/#chap-privileges-acis" target="_blank"><em class="citetitle">Configuring Privileges &amp; Access Control</em></a>.
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="cts-opendj-preparation"></a>7.4.&nbsp;Preparing an OpenDJ Directory Service for CTS</h2></div></div></div><a class="indexterm" name="d12792e4928"></a><p>The Default Configuration option installs OpenAM with an embedded OpenDJ
   directory server that stores both configuration and CTS data.
   The default option is suitable for OpenAM evaluation purposes, or for single
   site or smaller-scale environments, where lower volume write loads and
   replication traffic occur.</p><p>In general, CTS causes more volatile replication traffic due to the
    nature of its short-lived tokens compared to regular configuration data.
    To handle the data volatility, you can configure OpenAM to use the embedded
    directory server as a dedicated configuration data store, while using an
    external OpenDJ directory server instance as a CTS store.
    This type of deployment is useful if you have multiple OpenAM instances
    in a fully-replicated topology, communicating with an external CTS data store
    over WAN.
    </p><p>
    The following example script installs a single instance of an OpenDJ directory
    server as an external CTS store. The procedure assumes that you have installed
    OpenAM with its default configuration settings.
   </p><p>The example directory server install script uses the following parameters:</p><div class="table"><a name="prepare-config-store-ds"></a><div class="table-title">Table&nbsp;7.2.&nbsp;Example OpenDJ Setup Parameters</div><div class="table-contents"><table summary="Example OpenDJ Setup Parameters" border="0"><colgroup><col width="50%"><col width="50%"></colgroup><thead><tr><th>Parameter</th><th>Example Inputs</th></tr></thead><tbody><tr><td><code class="literal">Hostname</code></td><td>Provide a Fully Qualified Domain Name, like opendj.example.com</td></tr><tr><td><code class="literal">LDAP Port</code></td><td>1389</td></tr><tr><td><code class="literal">generateSelfSignedCertificate</code></td><td>true</td></tr><tr><td><code class="literal">enableStartTLS</code></td><td>true</td></tr><tr><td><code class="literal">ldapsPort</code></td><td>1636</td></tr><tr><td><code class="literal">jmxPort</code></td><td>1689</td></tr><tr><td><code class="literal">Administration Connector Port</code></td><td>4444</td></tr><tr><td><code class="literal">Root User DN</code></td><td>cn=Directory Manager</td></tr><tr><td><code class="literal">Root User DN Password</code></td><td>(arbitrary)</td></tr><tr><td><code class="literal">baseDN</code></td><td>Not needed. The base DN for the backend will be configured in a later step.</td></tr><tr><td><code class="literal">ldifFile</code></td><td>Not needed. This file is typically used to import user entries.</td></tr><tr><td><code class="literal">sampleData</code></td><td>Not needed</td></tr><tr><td><code class="literal">Start Server After Config</code></td><td>Yes</td></tr></tbody></table></div></div><br class="table-break"><div class="procedure"><a name="prepare-run-ext-cts-script"></a><div class="procedure-title">Procedure&nbsp;7.1.&nbsp;To Prepare and Run the External OpenDJ CTS Install Script</div><a class="indexterm" name="d12792e5035"></a><ol class="procedure" type="1"><li class="step"><p>Download
      <a class="link" href="http://forgerock.com/download-stack/" target="_blank">OpenDJ</a>.
     </p></li><li class="step"><p>Create the install script. The following is an example, which you can
      edit for your specific system.
     </p><pre class="brush: plain;">
#!/bin/sh

#
# copyright (C) 2014 ForgeRock AS
#
# cts-setup.sh: This script installs and configures an external CTS data store.
# It assumes that you have downloaded the OpenDJ zip file to a local
# folder.

# Reset the tmp folder
T=/tmp/ldif
rm -rf $T
mkdir $T

# Define variables used in this script. Make them specific to your deployment.

TOMCAT_OPENAM_WEBAPP=/usr/local/tomcat/webapps/openam/WEB-INF/template/ldif/sfha
USER="cn=Directory Manager"
PASS="pwd"
PORT=4444
CTS_DN="dc=cts,dc=example,dc=com"

# Make sure to download the OpenDJ Zip file and place it in the same folder as
# this script
DS="OpenDJ-2.6.2.zip"

# Sanity Check
[ ! -d "$TOMCAT_OPENAM_WEBAPP" ] &amp;&amp; echo "TOMCAT OPENAM WEBAPP folder inaccessible" \
 &amp;&amp; exit 1
[ ! -f "$DS" ] &amp;&amp; echo "$DS is not present" &amp;&amp; exit 1

# Create a properties file for the OpenDJ install
printf '#\n' &gt;&gt; $T/setup.props
printf '# Sample properties file to set up the OpenDJ directory server\n' &gt;&gt; \
 $T/setup.props
printf '#\n' &gt;&gt; $T/setup.props
printf 'hostname                      = opendj.example.com\n' &gt;&gt; $T/setup.props
printf 'ldapPort                      = 1389\n' &gt;&gt; $T/setup.props
printf 'generateSelfSignedCertificate = true\n' &gt;&gt; $T/setup.props
printf 'enableStartTLS                = true\n' &gt;&gt; $T/setup.props
printf 'ldapsPort                     = 1636\n' &gt;&gt; $T/setup.props
printf 'jmxPort                       = 1689\n' &gt;&gt; $T/setup.props
printf "adminConnectorPort            = $PORT\n" &gt;&gt; $T/setup.props
printf "rootUserDN                    = $USER\n" &gt;&gt; $T/setup.props
printf 'rootUserPassword              = pwd\n' &gt;&gt; $T/setup.props
#printf '#baseDN                      = dc=example,dc=com\n' &gt;&gt; $T/setup.props
#printf '#ldifFile                    = /path/to/Example.ldif\n' &gt;&gt; $T/setup.props
#printf '#sampleData                  = \n' &gt;&gt; $T/setup.props

# Create the CTS base dn and ACIs entries and write them to a file
# Linefeeds have been added for publication purposes.
printf '#\n' &gt;&gt; $T/add-cts-entries.ldif
printf '# add-cts-entries.ldif: base DN and ACIs\n' &gt;&gt; $T/add-cts-entries.ldif
printf '#\n' &gt;&gt; $T/add-cts-entries.ldif
printf "dn: $CTS_DN\n" &gt;&gt; $T/add-cts-entries.ldif
printf 'objectclass: top\n' &gt;&gt; $T/add-cts-entries.ldif
printf 'objectclass: domain\n' &gt;&gt; $T/add-cts-entries.ldif
printf 'dc: cts\n' &gt;&gt; $T/add-cts-entries.ldif
printf "aci: (targetattr=\"*\")(version 3.0;acl \"Allow entry search\"; \
 allow (search, read)(userdn = \
 "ldap:///uid=openam,ou=admins,$CTS_DN\");)\n" &gt;&gt; $T/add-cts-entries.ldif
printf "aci: (targetattr=\"*\")(version 3.0;acl \"Modify config entry\"; \
 allow (write)(userdn = \
 "ldap:///uid=openam,ou=admins,$CTS_DN\");)\n" &gt;&gt; $T/add-cts-entries.ldif
printf "aci: (targetcontrol=\"2.16.840.1.113730.3.4.3\") \
 (version 3.0;acl \"Allow persistent search\"; \
 allow (search, read)(userdn = \
 "ldap:///uid=openam,ou=admins,$CTS_DN\");)\n" &gt;&gt; $T/add-cts-entries.ldif
printf "aci: (version 3.0;acl \"Add config entry\"; allow (add)(userdn = \
 "ldap:///uid=openam,ou=admins,$CTS_DN\");)\n" &gt;&gt; $T/add-cts-entries.ldif
printf "aci: (version 3.0;acl \"Delete config entry\"; allow (delete)(userdn = \
 "ldap:///uid=openam,ou=admins,$CTS_DN\");)\n" &gt;&gt; $T/add-cts-entries.ldif
printf '\n' &gt;&gt;$T/add-cts-entries.ldif
printf "dn: ou=admins,$CTS_DN\n" &gt;&gt; $T/add-cts-entries.ldif
printf 'objectclass: top\n' &gt;&gt; $T/add-cts-entries.ldif
printf 'objectclass: organizationalUnit\n' &gt;&gt; $T/add-cts-entries.ldif
printf 'ou: admins\n' &gt;&gt; $T/add-cts-entries.ldif
printf '\n' &gt;&gt;$T/add-cts-entries.ldif
printf "dn: uid=openam,ou=admins,$CTS_DN\n" &gt;&gt; $T/add-cts-entries.ldif
printf 'objectclass: top\n' &gt;&gt; $T/add-cts-entries.ldif
printf 'objectclass: person\n' &gt;&gt; $T/add-cts-entries.ldif
printf 'objectclass: organizationalPerson\n' &gt;&gt; $T/add-cts-entries.ldif
printf 'objectclass: inetOrgPerson\n' &gt;&gt; $T/add-cts-entries.ldif
printf 'cn: openam\n' &gt;&gt; $T/add-cts-entries.ldif
printf 'sn: openam\n' &gt;&gt; $T/add-cts-entries.ldif
printf 'uid: openam\n' &gt;&gt; $T/add-cts-entries.ldif
printf 'userPassword: secret12\n' &gt;&gt; $T/add-cts-entries.ldif
printf 'ds-privilege-name: subentry-write\n' &gt;&gt; $T/add-cts-entries.ldif
printf 'ds-privilege-name: update-schema\n' &gt;&gt; $T/add-cts-entries.ldif

# Unzip and install OpenDJ using the properties file
echo ""
echo "... Unpacking OpenDJ and installing ..."
unzip "$DS" &amp;&amp; cd opendj
./setup --cli --propertiesFilePath $T/setup.props --acceptLicense --no-prompt

# Create the CTS Backend
echo ""
echo "... Creating backend ..."
echo ""
bin/dsconfig create-backend \
--backend-name cts-store \
--set base-dn:"$CTS_DN" \
--set enabled:true \
--type local-db \
--port $PORT \
--bindDN "$USER" \
--bindPassword $PASS \
--trustAll \
--no-prompt
echo "Backend created"

# Verify Backend
#bin/dsconfig list-backends \
#--port $PORT \
#--bindDN "$USER" \
#--bindPassword $PASS \
#--trustAll \
#--no-prompt

# Add the Base DN and ACIs
echo ""
echo "...Adding Base DN and ACIs..."
echo ""
bin/ldapmodify \
--port $PORT \
--bindDN "$USER" \
--bindPassword $PASS \
--defaultAdd \
--filename $T/add-cts-entries.ldif \
--useSSL \
--trustAll 
echo "BaseDN and ACIs added."

# Verify BaseDN and ACIs
#bin/ldapsearch --port $PORT --bindDN "$USER" --bindPassword $PASS \
 --baseDN "$CTS_DN" --searchscope sub --useSSL --trustAll  "(objectclass=*)"

# Add the Admin Global ACI
echo ""
echo "...Adding Admin Global ACIs..."
echo ""
bin/dsconfig set-access-control-handler-prop \
--add global-aci:'(target = "ldap:///cn=schema")(targetattr = "attributeTypes || \
 objectClasses")(version 3.0; acl "Modify schema"; allow (write) userdn = \
 "ldap:///uid=openam,ou=admins,dc=cts,dc=example,dc=com";)' \
--port $PORT \
--bindDN "$USER" \
--bindPassword $PASS \
--trustAll \
--no-prompt
echo "Global ACI added."

# Verify Global ACI
#bin/dsconfig get-access-control-handler-prop --property global-aci --port $PORT \
 --bindDN "$USER" --bindPassword $PASS -X -n

# Copy the Schema, Indexes, and Container files for CTS
echo ""
echo "... Begin copying schema, indexes, and container ..."
cp $TOMCAT_OPENAM_WEBAPP/cts-add-schema.ldif $T/cts-add-schema.ldif
cat $TOMCAT_OPENAM_WEBAPP/cts-indices.ldif | sed -e 's/@DB_NAME@/cts-store/' &gt; \
 $T/cts-indices.ldif
cat $TOMCAT_OPENAM_WEBAPP/cts-container.ldif | sed -e \
 "s/@SM_CONFIG_ROOT_SUFFIX@/$CTS_DN/" &gt; $T/cts-container.ldif
echo "Schema, index, and container files copied."

# Add the Schema Files
echo ""
echo "... Adding CTS Schema ..."
bin/ldapmodify --port $PORT --bindDN "$USER" --bindPassword $PASS \
 --fileName $T/cts-add-schema.ldif --useSSL --trustAll

# Add the CTS Indexes
echo ""
echo "... Adding CTS Indexes ..."
bin/ldapmodify --port $PORT --bindDN "$USER" --bindPassword $PASS --defaultAdd \
 --fileName $T/cts-indices.ldif --useSSL --trustAll

# Add the CTS Container Files
echo ""
echo "... Adding CTS Container ..."
bin/ldapmodify --port $PORT --bindDN "$USER" --bindPassword "$PASS" --defaultAdd \
 --fileName $T/cts-container.ldif --useSSL --trustAll

# Rebuild the Indexes
echo ""
echo "... Rebuilding Index ..."
bin/rebuild-index --port $PORT --bindDN "$USER" --bindPassword "$PASS" \
 --baseDN "$CTS_DN" --rebuildALL --start 0 --trustAll

# Verify the Indexes
echo ""
echo "... Verifying Index ..."
bin/verify-index --baseDN "$CTS_DN"

echo ""
echo "Your CTS External Store has been successfully installed and configured."
exit 0
</pre></li><li class="step"><p>Make the file executable.</p><div class="screen"><pre>
chmod u+x cts-setup.sh
     </pre></div></li><li class="step"><p>Run the script. Make sure the OpenDJ zip file is in your same directory
      and update the script accordingly.
     </p><div class="screen"><pre>
./cts-setup.sh
     </pre></div></li></ol></div><div class="procedure"><a name="configure-cts"></a><div class="procedure-title">Procedure&nbsp;7.2.&nbsp;To Configure the CTS Data Store</div><a class="indexterm" name="d12792e5067"></a><p>The following example procedure assumes that you have implemented
     the previous procedure.
     Also note that the OpenAM server will require a restart for the
     configuration changes to take effect.</p><ol class="procedure" type="1"><li class="step"><p>Log into the OpenAM Console.</p></li><li class="step"><p>On the main OpenAM Console screen, click Configuration &gt;
       Servers and Sites &gt; <code class="literal">Server Name</code> &gt; CTS.
       For this example, the <code class="literal">Server Name</code> is
       <code class="literal">http://openam.example.com:8080/openam</code>.</p></li><li class="step"><p>On the Edit <code class="literal">Server Name</code> screen, click Inheritance
       Settings. By default, the CTS properties are inherited from the Configuration
       data store settings created in a previous step. We want to clear or
       uncheck these properties to modify these properties for CTS.</p></li><li class="step"><p>On the Server Property Inheritance Setting screen, uncheck the
       properties that you want to modify for CTS, and then click Save. </p><div class="mediaobject" align="center"><a name="figure-openam-config-store-inheritance"></a><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/openam-config-store-inheritance.png" align="middle" height="360" alt="OpenAM External Configuration Inheritance Settings"></td></tr></table><div class="longdesc-link" align="right"><br clear="all"><span class="longdesc-link">[<a href="figure-openam-config-store-inheritance.html" target="longdesc">D</a>]</span></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Connection String(s).
         For example, <code class="literal">host1:389,host2:50389|server1|site1,host3:50389</code>.
        </p></li><li class="listitem"><p>Heartbeat. Default is 10.</p></li><li class="listitem"><p>Login Id. Specifies the directory server's bind DN.</p></li><li class="listitem"><p>Max Connections. Sets the maximum number of connections to the data store.</p></li><li class="listitem"><p>Password. Specifies the directory servers admin password.</p></li><li class="listitem"><p>Port. Specifies the LDAP port of the directory server.</p></li><li class="listitem"><p>Root Suffix. Specifies the base DN of the CTS store.</p></li><li class="listitem"><p>SSL/TLS Enabled. Specifies if SSL or TLS is configured for the
          connection to the directory server.
         </p></li><li class="listitem"><p>Store Mode. Specifies if the data store is a default (internal)
          data store or an external store. This property is required if you want
          to configure an external CTS store. Note that we recommend all
          settings to be enabled for editing and populated with the appropriate values.
         </p></li></ul></div></li><li class="step"><p>On the Edit <code class="literal">Server Name</code> screen,
      click External Token Store and then enter the Root Suffix for the CTS store.
      For this example, enter <code class="literal">dc=cts,dc=example,dc=com</code>.</p></li><li class="step"><p>Under External Store Configuration, enter the properties for
       the CTS backend and then click Save.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Connection String(s)</span></dt><dd><p><code class="literal">host1:389,host2:50389|server1|site1,host3:50389</code></p></dd><dt><span class="term">Login Id</span></dt><dd><p><code class="literal">uid=openam,ou=admins,dc=cts,dc=example,dc=com</code></p></dd><dt><span class="term">Password</span></dt><dd><p>Enter the Login ID password. For this example, enter <code class="literal">secret12</code>.</p></dd></dl></div></li><li class="step"><p>Restart the OpenAM server to complete the external CTS store
        configuration.
        If there is a problem with the configuration, view the error
        in the <code class="filename">&lt;openam-installation&gt;/debug/Session</code>
        debug log, which will indicate that the External CTS connection could not be
        established.
        </p><p>You have successfully configured an external OpenDJ directory server
         and configured OpenAM to use the external CTS store.
         For more CTS configuration options, see
         <a class="xref" href="#cts-token-managing" title="7.6.&nbsp;Managing CTS Tokens">Section&nbsp;7.6, &#8220;Managing CTS Tokens&#8221;</a>.</p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="cts-replication"></a>7.5.&nbsp;CTS and OpenDJ Replication</h2></div></div></div><a class="indexterm" name="d12792e5196"></a><p>Replication in this context is the process of copying updates between directory servers to help all servers
    converge to identical copies of directory, token, and session / SAML 2.0 / OAuth 2.0 data. OpenDJ uses advanced
    data replication methods to ensure that directory services remain available in the event of a server crash or
    network interruption.</p><p>The historical information needed to resolve the latest changes is periodically purged to avoid
    growing to unmanageable sizes. The age at which the information is purged is known as the
    <code class="literal">replication-purge-delay</code>.</p><p>With CTS, the default <code class="literal">replication-purge-delay</code> for OpenDJ is 3 days. Unless you have
    configured a separate OpenDJ server for CTS data, you may have to balance the needs for backups, the requirements
    for replication, disk space, and different useful lifetimes for CTS tokens and other OpenDJ data. So adjustments
    may be required. One way to set a new period for <code class="literal">replication-purge-delay</code> of
    <em class="replaceable"><code>n</code></em> hours is with the following command:</p><div class="screen"><pre>
$ <strong>dsconfig \
 set-replication-server-prop \
 --port 4444 \
 --hostname opendj-cts.example.org \
 --bindDN "cn=Directory Manager" \
 --bindPassword password \
 --provider-name "Multimaster Synchronization" \
 --set replication-purge-delay:<em><strong>n</strong></em> \
 --no-prompt \
 --trustStorePath /path/to/truststore</strong>
    </pre></div><p>At this point, you need to understand whether CTS data backups are important in your deployment.
     Session, SAML 2.0, and OAuth 2.0 token data is often short-lived. In some deployments, the "worst-case"
     scenario is that users have to log in again.</p><p>If CTS data backups are important in your deployment, note that OpenDJ
      backups that are older than the <code class="literal">replication-purge-delay</code>
      are useless and must be discarded. You can use the OpenDJ
      <span class="command"><strong>backup</strong></span> to schedule backups. For example, the following
      command uses <code class="literal">crontab</code> format to configure daily backups
      for a hypothetical Base DN of <code class="literal">ctsData</code> at x minutes
      after every hour:</p><div class="screen"><pre>
$ <strong>backup \
 --port 4444 \
 --bindDN "cn="Directory Manager" \
 --bindPassword password \
 --backendID ctsData \
 --backupDirectory /path/to/opendj/backup \
 --recurringTask "x * * * *" \
 --completionNotify backupadmin@example.com \
 --errorNotify backupadmin@example.com</strong>
     </pre></div><p>While you may choose to adjust the time periods associated with
     <code class="literal">replication-purge-delay</code> and backups, be sure that backups
     are performed more frequently.
     Otherwise, change log records that are required to restore data may be lost.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="cts-token-managing"></a>7.6.&nbsp;Managing CTS Tokens</h2></div></div></div><a class="indexterm" name="d12792e5258"></a><p>There are properties associated with token encryption, compression,
    and token cleanup frequency, which are disabled by default.
    The properties are as follows:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">com.sun.identity.session.repository.enableEncryption</code></span></dt><dd><p>Supports encryption of CTS tokens. Default: <code class="literal">false</code>.</p></dd><dt><span class="term"><code class="literal">com.sun.identity.session.repository.enableCompression</code></span></dt><dd><p>Enables GZip-based compression of CTS tokens. Default: <code class="literal">false</code>.</p></dd><dt><span class="term"><code class="literal">com.sun.identity.session.repository.enableAttributeCompression</code></span></dt><dd><p>Supports compression over and above the GZip-based compression of CTS tokens. Default: <code class="literal">false</code>.</p></dd><dt><span class="term"><code class="literal">com.sun.identity.session.repository.cleanupRunPeriod</code></span></dt><dd><p>Specifies a minimum CTS token lifetime. If there is no activity in the specified
       time period, the token is erased. Default: 300 seconds.</p></dd><dt><span class="term"><code class="literal">com.sun.identity.session.repository.healthCheckRunPeriod</code></span></dt><dd><p>Sets a period of time when requests are sent to make sure the current instance of
       OpenAM is running. Default: 60 seconds.</p></dd></dl></div><p>To enable the encryption/compression options, navigate to Configuration
    &gt; Servers and Sites &gt; Default Server Settings &gt; Advanced.
    In the Advanced Properties window, you should see these entries in the
    <code class="literal">Property Name</code> column with the corresponding value in the
    <code class="literal">Property Value</code> column.
    To enable them, change <code class="literal">false</code> to <code class="literal">true</code>
    in the Property Value column associated with the desired property, and click Save.</p><div class="note"><h3 class="title">Note</h3><p>If you want to enable compression or encryption, you must enable the same property
    on every OpenAM instance within the site, otherwise they will not function
    correctly together. You must also restart the servers for the changes to take
    effect.</p></div><div class="warning"><h3 class="title">Warning</h3><p>When encryption or compression properties are changed, all previous
    tokens in the LDAP store will be un-readable; thus, invalidating any user's
    sessions. The user will be required to log in again.
   </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="cts-tuning-considerations"></a>7.7.&nbsp;CTS Tuning Considerations</h2></div></div></div><a class="indexterm" name="d12792e5334"></a><p>CTS processes all requests asynchronously in the background, allowing
    callers (that is, those entities that call CTS) to send subsequent requests
    without waiting for a previous request to finish processing.
    The following OpenAM components make CTS requests:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Session service for session failover</p></li><li class="listitem"><p>OAuth 2.0 for token persistence</p></li><li class="listitem"><p>SAML 2.0 for token persistence</p></li><li class="listitem"><p>REST API for functions like Forgotten passwords</p></li></ol></div><p>
    All create, read, update, delete, query (CRUDQ) requests to CTS are placed
    into an asynchronous buffer before being handled by an asynchronous processor.
    This ensures the caller can continue without waiting for CTS to complete processing.
   </p><p>Once the queue is full, all operations are "blocked" before an operation
    can be placed on the queue. Once on the queue, the caller can continue as normal.
   </p><p>
    CTS is designed to automatically throttle throughput in the event that the buffer
    fills up with requests.
    Therefore, if you require a balance between performance versus system memory,
    OpenAM provides two properties that can be used to tune CTS: queue size and queue timeout.
   </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">org.forgerock.services.cts.async.queue.size</code></span></dt><dd><p>
       Default size: 5000. Determines how many request operations can be buffered
       before the queue size becomes full, after which the caller will be required
       to wait for the buffered requests to complete processing. All CRUDQ operations
       are converted to tasks, which are placed on the queue, ensuring that operations
       happen in the correct sequence.
      </p></dd><dt><span class="term"><code class="literal">org.forgerock.services.cts.async.queue.timeout</code></span></dt><dd><p>
        Default timeout is 120 seconds. Determines how long a caller will wait
        in the even that the buffer is full.
        If the timeout expires, the caller receives an error.
        The timeout property is used in any system configuration where the LDAP
        server throughput is considerably slower than the OpenAM server, which
        can result in blocked requests as the backlog increases.
       </p></dd></dl></div><p>To set the queue size and timeout properties, navigate to the OpenAM Console:
    Configuration
    &gt; Servers and Sites &gt; Default Server Settings
    &gt; Advanced, and then click Add.
   </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="cts-general-recommend"></a>7.8.&nbsp;General Recommendations for CTS Configuration</h2></div></div></div><a class="indexterm" name="d12792e5381"></a><p>
    When properly configured, CTS can help your deployment avoid single points
    of failure (SPOF). Session and SAML 2.0 tokens which are normally stored
    only in the memory of a single server are also written to the
    CTS as a secondary token store. If the OpenAM instance that owns the session
    or SAML 2.0 token fails, a second instance of OpenAM can allow access to the
    session or token. To reduce the impact of any given failure,
    consider the following options:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
      <span class="bold"><strong>First Look at Embedded</strong></span>.
      Start your implementation, if possible, with the CTS options available
      with the OpenDJ instance embedded in OpenAM, which is the simplest deployment
      option to implement.
      If you are deploying on a single site and want CTS replication limited
      to that site, the default configuration store may be sufficient for your
      particular needs.
     </p><p>
      Note that the embedded CTS store is generally not recommended for high
      volume deployments and assumes a small scale deployment with a relatively
      simple topology.
     </p></li><li class="listitem"><p>
      <span class="bold"><strong>Isolate the Different Stores</strong></span>.
      Isolate the user, configuration, and session stores from OpenAM into separate
      external OpenDJ servers.
     </p></li><li class="listitem"><p>
      <span class="bold"><strong>Configure External CTS Stores for High Volumes</strong></span>.
      If your needs go beyond a higher-level performance threshold, you may want
      to move the CTS token storage to one or more dedicated systems as
      CTS generally causes much more replication traffic than less volatile
      configuration data.
      Alternatively, if you need global replication of session, SAML 2.0, and
      OAuth 2.0 tokens, this would also justify a move to dedicated systems as
      it provides an extra level of control over how much replication is taking place.
     </p><p>
      On the Admin Console, specify the main external OpenDJ directory
      server for the CTS store and designate additional OpenDJ instances for
      session failover using the <code class="literal">Connection String(s)</code> property.
      This property allows you to configure multiple OpenDJ directory servers for
      your CTS data stores without a load balancer.
     </p><div class="note"><h3 class="title">Note</h3><p>
       The CTS requires that it talks to a single server or load balancer
       to reduce the risk of replication errors.
      </p></div><div class="mediaobject" align="center"><a name="cts-deploy"></a><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/cts-deploy.png" align="middle" height="360" alt="A Simplified CTS Deployment"></td></tr></table><div class="longdesc-link" align="right"><br clear="all"><span class="longdesc-link">[<a href="cts-deploy.html" target="longdesc">D</a>]</span></div></div><p>
      To improve performance, ensure that you have
      properly-sized directory servers for your external CTS stores.
      In addition, you can enable token compression as discussed in
      <a class="xref" href="#cts-token-managing" title="7.6.&nbsp;Managing CTS Tokens">Section&nbsp;7.6, &#8220;Managing CTS Tokens&#8221;</a>.
      When enabled, token compression reduces
      load requirements on the network connection between data stores
      in exchange for processing time compressing tokens.
     </p></li><li class="listitem"><p>
      <span class="bold"><strong>
       Prevent random or round-robin load balancing to external CTS stores.
      </strong></span>
      No load balancer is needed between OpenAM and an external CTS store.
      Instead configure multiple directory server replicas
      in the Connection Strings of the configuration.
      For details, see <a class="xref" href="#cts-config" title="7.1.&nbsp;CTS Configuration Parameters">Section&nbsp;7.1, &#8220;CTS Configuration Parameters&#8221;</a>.
     </p><p>
      When OpenAM writes to a directory server in the external CTS store,
      directory server replication pushes the write to other directory servers
      in the same replication group.
      When under load operations in an OpenAM server
      can happen more quickly than the network can push replication updates.
      Therefore, balancing the LDAP traffic from OpenAM to the CTS store
      in random or round robin fashion leads to errors
      where a read operation arrives at a replica
      before the expected write operation can cross the network.
     </p><p>
      For complex deployments
      you might opt for an external directory service as the CTS store
      with a load balancer between OpenAM and the directory service.
      In this case, the choice of load balancing algorithm is important
      to ensure consistency under load within the CTS layer.
      High loads with a round-robin or random algorithm
      cause replication conflicts within the CTS layer,
      which the CTS layer is unable to resolve.
      The load balancer <span class="emphasis"><em>must</em></span> operate only for failover,
      and not to balance LDAP traffic between directory servers.
      In other words, the load balancer in front of the external CTS store
      <span class="emphasis"><em>must</em></span> use an Active/Passive configuration,
      whereby the load balancer sends all requests to the same directory server
      until that server becomes unavailable,
      and then all requests go to the standby directory server, and so on.
      Load balancers <span class="emphasis"><em>must not</em></span> use an Active/Active configuration,
      as this leads to the type of errors described above.
     </p></li></ul></div><p>
    Once configured, the OpenDJ directory service replicates CTS data
    transmitted from OpenAM servers to connected OpenDJ servers.
    The amount of replication traffic can be significant, especially if
    replication proceeds over a WAN.
    You can limit this replication traffic by separating OpenDJ instances
    into directory and replication servers.
    For more information on how this is done
    with OpenDJ, see the OpenDJ documentation on
    <a class="link" href="http://docs.forgerock.org/en/opendj/2.6.0/admin-guide/#repl-dedicated-servers" target="_blank">
     <em class="citetitle">Stand-alone Replication Servers</em></a>.
   </p></div></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-session-failover"></a>Chapter&nbsp;8.&nbsp;Setting Up OpenAM Session Failover</h1></div></div></div><a class="indexterm" name="d12792e5463"></a><a class="indexterm" name="d12792e5468"></a><p>
  This chapter covers setting up session failover (SFO).
  Session failover allows another OpenAM server to manage a session
  when the server that initially authenticated the user is down.
  This means the user does not need to log in again,
  even though the server that authenticated them is down.
 </p><p>
  Session failover (high availability for sessions) builds
  on OpenAM service availability.
  Before configuring session failover,
  you must therefore first make the overall OpenAM service highly available.
  This is done by setting up OpenAM in a site configuration.
  You can find instructions for setting up a site configuration in the chapter,
  <a href="../install-guide/index.html#chap-install-multiple" class="link"><em class="citetitle">Installing Multiple Servers</em></a>.
 </p><p>
  Session failover also relies on a shared Core Token Service (CTS)
  to store user session data.
  The service is shared with other OpenAM servers in the same OpenAM Site.
  When an OpenAM server goes down, other servers in the Site
  can read user session information from the CTS,
  so the user with a valid session does not have to log in again.
  When the original OpenAM server becomes available again,
  it can also read session information from the CTS,
  and can carry on serving users with active sessions.
  By default the Core Token Service uses the embedded OpenDJ directory server.
  For more information on configuring the Core Token Service, see the chapter,
  <a href="../install-guide/index.html#chap-cts" class="link"><em class="citetitle">Configuring the Core Token Service (CTS)</em></a>.
 </p><p>
  In deployments with multiple OpenAM Sites,
  session failover can function across Sites.
  In order for this to work, all Sites must use
  the same, global, underlying Core Token Service,
  which is replicated across all Sites.
  Then when an entire Site fails or becomes unavailable,
  OpenAM servers in another Site detect the failure of the Site's load balancer
  and attempt to recover the user session from the global Core Token Service.
 </p><p>
  In the event of a failure,
  client applications can connect to an OpenAM server in an active data center
  as shown in <a class="xref" href="#figure-global-cts" title="Figure&nbsp;8.1.&nbsp;Core Token Service For Global Session Failover">Figure&nbsp;8.1, &#8220;Core Token Service For Global Session Failover&#8221;</a>.
 </p><div class="figure"><a name="figure-global-cts"></a><div class="figure-title">Figure&nbsp;8.1.&nbsp;Core Token Service For Global Session Failover</div><div class="figure-contents"><div class="mediaobject" align="center"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/global-cts.png" align="middle" height="360" alt="Global CTS"></td></tr></table><div class="longdesc-link" align="right"><br clear="all"><span class="longdesc-link">[<a href="ld-d12792e5494.html" target="longdesc">D</a>]</span></div></div></div></div><br class="figure-break"><p>
  For more information on how this is done with OpenDJ directory server,
  see the OpenDJ documentation on
  <a class="link" href="http://docs.forgerock.org/en/opendj/2.6.0/admin-guide/#chap-replication" target="_blank"><em class="citetitle">Managing Data Replication</em></a>.
 </p><div class="procedure"><a name="enable-session-failover"></a><div class="procedure-title">Procedure&nbsp;8.1.&nbsp;To Configure Session Failover After Installation</div><a class="indexterm" name="d12792e5511"></a><p>
   Session failover requires an OpenAM Site configuration
   with a Core Token Service.
  </p><p>
   If you did not configure session persistence and availability during
   initial configuration,
   first complete the steps in the procedure,
   <a href="../install-guide/index.html#configure-site-load-balancing" class="link"><em class="citetitle">To Configure Site Load Balancing</em></a>,
   and then follow these steps.
  </p><ol class="procedure" type="1"><li class="step"><p>
    In the OpenAM console for one of the servers in the Site,
    under Configuration &gt; Global, click Session.
   </p></li><li class="step"><p>
    Under Secondary Configuration Instance, click New.
   </p><p>
    If the server is not part of a Site,
    or if the configuration server does not support the Core Token Service,
    the New button is grayed out.
   </p></li><li class="step"><p>
    In the Add Sub Configuration page,
    check that the Name is set to the name of the site.
   </p></li><li class="step"><p>
    To activate the Session Persistence and High Availability Failover option,
    check the Enabled box.
   </p></li><li class="step"><p>To ensure that local OpenAM instances resolve sessions from the Core
    Token Service session store rather than by using crosstalk, check the Reduce
    Crosstalk Enabled box. For more information about crosstalk, see the section,
    <a href="../install-guide/index.html#chap-install-multiple" class="link"><em class="citetitle">To Configure Site Load Balancing</em></a>.
   </p><p>Do not disable reduced crosstalk unless advised to do so by ForgeRock
    Technical Support.
   </p></li><li class="step"><p>
    Set reduced crosstalk options.
   </p><p>
    Session logout/destroy broadcasting enables
    notification to all servers in an OpenAM site when a user logs out or
    her session is destroyed by the OpenAM server. The broadcast notifications
    are in addition to normal session logout/destroy notifications sent to
    interested clients and servers.
   </p><p>
    Without session logout/destroy broadcasting,
    it is possible for a user to log out
    from one OpenAM server and then access her session on another server during
    the brief window between the logout and session store replication.
    Enabling session
    logout/destroy broadcasting ensures that logged out and destroyed sessions
    have the correct state on all OpenAM servers.
   </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
      Select Disabled if you do not want the OpenAM server to broadcast session
      logout/destroy messages. Session logout/destroy broadcasting is disabled
      by default. Disabling broadcasting is suitable when you do not need the
      highest level of security. Disable broadcasting when you do not expect
      users to maliciously attempt to access logged out or destroyed sessions.
     </p></li><li class="listitem"><p>
      Specify one of the two broadcast options to achieve a higher level of
      security, at a cost of incurring additional network I/O. Select
      "Broadcast only to local site servers" if your session store
      supports a single OpenAM site. Select
      "Broadcast to servers in all sites" if your session store
      supports multiple OpenAM sites.
     </p></li></ul></div><p>
    The Reduced Crosstalk Purge
    Delay option specifies the amount of time (in minutes) before
    sessions are purged from OpenAM servers after the server receives
    session logout/destroy broadcast notification. The delay ensures that
    sessions are in memory during the time between
    session logout/destruction and session store replication.
   </p><p>
    The default purge delay is 1 minute, which should be adequate unless
    session store replication is abnormally slow on your network.
   </p></li><li class="step"><p>
    Click Add to save your work.
   </p></li><li class="step"><p>
    Restart all the OpenAM servers in the site.
   </p></li></ol></div></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-uninstall"></a>Chapter&nbsp;9.&nbsp;Removing OpenAM Software</h1></div></div></div><a class="indexterm" name="d12792e5575"></a><p>
  This chapter shows you how to uninstall OpenAM core software.
  See the
  <a class="link" href="http://docs.forgerock.org/en/openam-pa/3.3.0/web-users-guide/#web-users-guide" target="_blank"><em class="citetitle">OpenAM Web Policy Agent User's Guide</em></a>,
  or the
  <span class="olink"><em class="citetitle">OpenAM Java EE Policy Agent User's Guide</em></span>
  for instructions on removing OpenAM agents.
 </p><div class="procedure"><a name="uninstall-OpenAM-core"></a><div class="procedure-title">Procedure&nbsp;9.1.&nbsp;To Remove OpenAM Core Software</div><p>After you have deployed and configured OpenAM core services, you have
  at least two, perhaps three or four, locations where OpenAM files are stored
  on your system.</p><p>You remove the internal OpenAM configuration store when you follow
  the procedure below. If you used an external configuration store, you can
  remove OpenAM configuration data after removing all the software.</p><ol class="procedure" type="1"><li class="step"><p>Shut down the web application container in which you deployed
   OpenAM.</p><div class="screen"><pre>
$ <strong>/etc/init.d/tomcat stop</strong>
<em>Password:
Using CATALINA_BASE:   /path/to/tomcat
Using CATALINA_HOME:   /path/to/tomcat
Using CATALINA_TMPDIR: /path/to/tomcat/temp
Using JRE_HOME:        /path/to/jdk/jre
Using CLASSPATH:       /path/to/tomcat/bin/bootstrap.jar:
 /path/to/tomcat/bin/tomcat-juli.jar</em>
   </pre></div></li><li class="step"><p>Unconfigure OpenAM by removing configuration files found in the $HOME
   directory of the user running the web application container.</p><div class="itemizedlist"><p>For a full install of OpenAM core services, configuration files
    include the following.</p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The configuration directory, by default
     <code class="filename">$HOME/openam</code>. If you did not use the default
     configuration location, then check in the OpenAM console under
     Configuration &gt; Servers and Sites &gt; <em class="replaceable"><code>Server
     Name</code></em> &gt; General &gt; System &gt; Base installation
     directory.</p></li><li class="listitem"><p>The hidden file that points to the configuration directory.</p><p>For example, if you are using Apache Tomcat as the web container,
     this file could be
     <code class="filename">$HOME/.openamcfg/AMConfig_path_to_tomcat_webapps_openam_</code>
     OR
     <code class="filename">$HOME/.openssocfg/AMConfig_path_to_tomcat_webapps_openam_</code>.</p></li></ul></div><div class="screen"><pre>
$ <strong>rm -rf $HOME/openam $HOME/.openamcfg</strong>
   </pre></div><p>Or:</p><div class="screen"><pre>
$ <strong>rm -rf $HOME/openam $HOME/.openssocfg</strong>
   </pre></div><div class="note"><h3 class="title">Note</h3><p>At this point, you can restart the web container and configure
    OpenAM anew if you only want to start over with a clean configuration
    rather than removing OpenAM completely.</p></div><p>If you used an external configuration store you must also remove
   the configuration manually from your external directory server. The default
   base DN for the OpenAM configuration is
   <code class="literal">dc=openam,dc=forgerock,dc=org</code>.</p></li><li class="step"><p>Undeploy the OpenAM web application.</p><p>For example, if you are using Apache Tomcat as the web container,
   remove the .war file and expanded web application from the container.</p><div class="screen"><pre>
$ <strong>cd /path/to/tomcat/webapps/</strong>
$ <strong>rm -rf openam.war openam/</strong>
   </pre></div></li></ol></div></div><div class="index"><div class="titlepage"><div><div><h1 class="title"><a name="d12792e5667"></a>Index</h1></div></div></div><div class="index"><div class="indexdiv"><h3>A</h3><dl><dt>administration tools</dt><dd><dl><dt>setting up, <a class="indexterm" href="#chap-install-tools">Installing OpenAM Tools</a></dt></dl></dd><dt>Apache 2.2 policy agent</dt><dd><dl><dt>tuning MPM, <a class="indexterm" href="#d12792e1239">Tuning Apache Multi-Processing Modules</a></dt></dl></dd><dt>Apache 2.4 policy agent</dt><dd><dl><dt>tuning MPM, <a class="indexterm" href="#d12792e1239">Tuning Apache Multi-Processing Modules</a></dt></dl></dd><dt>Apache Tomcat</dt><dd><dl><dt>preparing, <a class="indexterm" href="#prepare-apache-tomcat">Preparing Apache Tomcat</a></dt></dl></dd></dl></div><div class="indexdiv"><h3>C</h3><dl><dt>configuration data</dt><dd><dl><dt>external OpenDJ</dt><dd><dl><dt>installing, <a class="indexterm" href="#prepare-configuration-store">Preparing an External Configuration Data Store</a>-<a class="indexterm" href="#prepare-configuration-store">Preparing an External Configuration Data Store</a></dt></dl></dd><dt>preparing</dt><dd><dl><dt>external store, <a class="indexterm" href="#prepare-configuration-store">Preparing an External Configuration Data Store</a></dt></dl></dd></dl></dd><dt>configuration tools</dt><dd><dl><dt>setting up, <a class="indexterm" href="#chap-install-tools">Installing OpenAM Tools</a>-<a class="indexterm" href="#chap-install-tools">Installing OpenAM Tools</a></dt></dl></dd><dt>Core Token Service, <a class="indexterm" href="#chap-cts">Configuring the Core Token Service (CTS)</a></dt><dd><dl><dt>access control instructions, <a class="indexterm" href="#cts-acis">CTS Access Control Instructions</a></dt><dt>and OpenDJ replication, <a class="indexterm" href="#cts-token-managing">Managing CTS Tokens</a></dt><dt>configuration parameters, <a class="indexterm" href="#cts-config">CTS Configuration Parameters</a></dt><dt>configuring</dt><dd><dl><dt>general recommendations, <a class="indexterm" href="#cts-general-recommend">General Recommendations for CTS Configuration</a></dt></dl></dd><dt>CTS data store</dt><dd><dl><dt>configuring on OpenAM, <a class="indexterm" href="#cts-opendj-preparation">Preparing an OpenDJ Directory Service for CTS</a></dt></dl></dd><dt>indexes, <a class="indexterm" href="#cts-schema">CTS Schema and Indexes</a></dt><dt>OpenAM</dt><dd><dl><dt>configuring, <a class="indexterm" href="#cts-replication">CTS and OpenDJ Replication</a></dt></dl></dd><dt>OpenDJ</dt><dd><dl><dt>install script, <a class="indexterm" href="#cts-opendj-preparation">Preparing an OpenDJ Directory Service for CTS</a></dt></dl></dd><dt>preparing OpenDJ, <a class="indexterm" href="#cts-opendj-preparation">Preparing an OpenDJ Directory Service for CTS</a></dt><dt>schema, <a class="indexterm" href="#cts-schema">CTS Schema and Indexes</a></dt><dt>tuning, <a class="indexterm" href="#cts-tuning-considerations">CTS Tuning Considerations</a></dt></dl></dd><dt>cross-origin resource sharing (CORS)</dt><dd><dl><dt>enabling, <a class="indexterm" href="#enable-cors-support">Enabling CORS Support</a></dt></dl></dd></dl></div><div class="indexdiv"><h3>D</h3><dl><dt>directory service requirements</dt><dd><dl><dt>preparing</dt><dd><dl><dt>external configuration data store, <a class="indexterm" href="#prepare-configuration-store">Preparing an External Configuration Data Store</a></dt><dt>Identity repository, <a class="indexterm" href="#prepare-identity-repository">Preparing an Identity Repository</a></dt></dl></dd></dl></dd><dt>distributed authentication</dt><dd><dl><dt>configuring, <a class="indexterm" href="#chap-install-das">Installing OpenAM Distributed Authentication</a></dt><dt>deploying on Tomcat, <a class="indexterm" href="#chap-install-das">Installing OpenAM Distributed Authentication</a></dt><dt>installing, <a class="indexterm" href="#chap-install-das">Installing OpenAM Distributed Authentication</a></dt></dl></dd></dl></div><div class="indexdiv"><h3>F</h3><dl><dt>fully-qualified domain name, <a class="indexterm" href="#prepare-networking">Preparing a Fully-Qualified Domain Name</a></dt></dl></div><div class="indexdiv"><h3>H</h3><dl><dt>HTTP request headers</dt><dd><dl><dt>handling, <a class="indexterm" href="#handle-request-headers">Handling HTTP Request Headers</a></dt></dl></dd></dl></div><div class="indexdiv"><h3>I</h3><dl><dt>IBM WebSphere</dt><dd><dl><dt>preparing, <a class="indexterm" href="#prepare-ibm-websphere">Preparing IBM WebSphere</a></dt></dl></dd><dt>Identity repository</dt><dd><dl><dt>preparing, <a class="indexterm" href="#prepare-identity-repository">Preparing an Identity Repository</a></dt></dl></dd><dt>Installing</dt><dd><dl><dt>Behind the firewall, <a class="indexterm" href="#chap-install-das">Installing OpenAM Distributed Authentication</a></dt><dt>Full install, <a class="indexterm" href="#chap-install-core">Installing OpenAM Core Services</a></dt><dt>load balancer, <a class="indexterm" href="#chap-install-multiple">Installing Multiple Servers</a></dt><dt>multiple servers, <a class="indexterm" href="#chap-install-multiple">Installing Multiple Servers</a></dt><dt>No console, <a class="indexterm" href="#chap-install-core">Installing OpenAM Core Services</a></dt><dt>proxy settings, <a class="indexterm" href="#chap-install-multiple">Installing Multiple Servers</a></dt><dt>Session failover, <a class="indexterm" href="#chap-session-failover">Setting Up OpenAM Session Failover</a></dt><dt>Silent configuration, <a class="indexterm" href="#chap-install-tools">Installing OpenAM Tools</a></dt><dt>Silent install, <a class="indexterm" href="#chap-install-tools">Installing OpenAM Tools</a></dt><dt>Starting over, <a class="indexterm" href="#chap-install-core">Installing OpenAM Core Services</a></dt><dt>Tools (ssoadm, etc.), <a class="indexterm" href="#chap-install-tools">Installing OpenAM Tools</a></dt></dl></dd></dl></div><div class="indexdiv"><h3>J</h3><dl><dt>Java requirements</dt><dd><dl><dt>IBM Java, <a class="indexterm" href="#prepare-java-ibm">Settings For IBM Java Environments</a></dt><dt>Sun/Oracle Java, <a class="indexterm" href="#prepare-java-sun">Settings For Sun/Oracle Java Environments</a></dt></dl></dd><dt>JBoss</dt><dd><dl><dt>preparing OpenAM for, <a class="indexterm" href="#prepare-jboss-7">Preparing OpenAM &amp; JBoss AS 7 / EAP 6</a></dt></dl></dd><dt>JBoss AS 7/EAP 6</dt><dd><dl><dt>preparing, <a class="indexterm" href="#prepare-jboss-7">Preparing OpenAM &amp; JBoss AS 7 / EAP 6</a></dt></dl></dd><dt>JBoss EAP 6.0.0</dt><dd><dl><dt>preparing, <a class="indexterm" href="#prepare-jboss-7">Preparing OpenAM &amp; JBoss AS 7 / EAP 6</a></dt></dl></dd><dt>JBoss EAP 6.0.1</dt><dd><dl><dt>preparing, <a class="indexterm" href="#prepare-jboss-7">Preparing OpenAM &amp; JBoss AS 7 / EAP 6</a></dt></dl></dd><dt>JBoss EAP 6.1.0</dt><dd><dl><dt>preparing, <a class="indexterm" href="#prepare-jboss-7">Preparing OpenAM &amp; JBoss AS 7 / EAP 6</a></dt></dl></dd><dt>JBoss EAP 6.1.1</dt><dd><dl><dt>preparing, <a class="indexterm" href="#prepare-jboss-7">Preparing OpenAM &amp; JBoss AS 7 / EAP 6</a></dt></dl></dd></dl></div><div class="indexdiv"><h3>M</h3><dl><dt>maximum file descriptors, <a class="indexterm" href="#prerequisites-file-descriptors">Setting Maximum File Descriptors</a></dt></dl></div><div class="indexdiv"><h3>O</h3><dl><dt>OpenAM</dt><dd><dl><dt>configuring</dt><dd><dl><dt>custom, <a class="indexterm" href="#chap-install-core">Installing OpenAM Core Services</a></dt><dt>defaults, <a class="indexterm" href="#chap-install-core">Installing OpenAM Core Services</a></dt><dt>starting over, <a class="indexterm" href="#chap-install-core">Installing OpenAM Core Services</a></dt></dl></dd><dt>deploying, <a class="indexterm" href="#chap-install-core">Installing OpenAM Core Services</a></dt><dd><dl><dt>core (no console), <a class="indexterm" href="#chap-install-core">Installing OpenAM Core Services</a></dt></dl></dd><dt>downloading, <a class="indexterm" href="#download-openam-software">Obtaining OpenAM Software</a></dt><dt>preparing</dt><dd><dl><dt>fully-qualified domain name, <a class="indexterm" href="#prepare-networking">Preparing a Fully-Qualified Domain Name</a></dt><dt>Java requirements, <a class="indexterm" href="#prepare-java">Preparing a Java Environment</a></dt></dl></dd><dt>preparing JBoss for, <a class="indexterm" href="#prepare-jboss-7">Preparing OpenAM &amp; JBoss AS 7 / EAP 6</a></dt><dt>sites</dt><dd><dl><dt>adding to, <a class="indexterm" href="#chap-install-core">Installing OpenAM Core Services</a></dt></dl></dd><dt>uninstalling, <a class="indexterm" href="#chap-uninstall">Removing OpenAM Software</a></dt></dl></dd><dt>OpenDJ</dt><dd><dl><dt>maximum file descriptors, <a class="indexterm" href="#prerequisites-file-descriptors">Setting Maximum File Descriptors</a></dt></dl></dd><dt>Oracle WebLogic</dt><dd><dl><dt>preparing, <a class="indexterm" href="#prepare-oracle-weblogic">Preparing Oracle WebLogic</a>-<a class="indexterm" href="#prepare-oracle-weblogic">Preparing Oracle WebLogic</a></dt></dl></dd></dl></div><div class="indexdiv"><h3>P</h3><dl><dt>Prerequisites, <a class="indexterm" href="#chap-prepare-install">Preparing For Installation</a></dt></dl></div><div class="indexdiv"><h3>S</h3><dl><dt>session failover, <a class="indexterm" href="#chap-session-failover">Setting Up OpenAM Session Failover</a></dt><dd><dl><dt>configuring, <a class="indexterm" href="#chap-session-failover">Setting Up OpenAM Session Failover</a></dt></dl></dd><dt>sites</dt><dd><dl><dt>adding a server, <a class="indexterm" href="#chap-install-core">Installing OpenAM Core Services</a></dt><dt>configuring, <a class="indexterm" href="#configure-sites">Configuring OpenAM Sites</a></dt></dl></dd></dl></div><div class="indexdiv"><h3>U</h3><dl><dt>UI, <a class="indexterm" href="#chap-custom-ui">Customizing the OpenAM End User Pages</a></dt><dd><dl><dt>Customizing classic UI, <a class="indexterm" href="#update-classic-ui">Updating the Classic UI (Legacy)</a></dt><dt>Customizing XUI, <a class="indexterm" href="#basic-xui-configuration">Configuring the XUI</a></dt><dt>Disabling XUI, <a class="indexterm" href="#chap-custom-ui">Customizing the OpenAM End User Pages</a></dt><dt>End user page lookup, <a class="indexterm" href="#lookup-for-ui-files">How OpenAM Looks Up UI Files</a></dt></dl></dd></dl></div><div class="indexdiv"><h3>V</h3><dl><dt>valid goto URL resources</dt><dd><dl><dt>configuring, <a class="indexterm" href="#configure-valid-goto-url-resources">Configuring Valid goto URL Resources</a></dt></dl></dd></dl></div></div></div></div><p>&nbsp;</p><div id="footer"><p>Something wrong on this page? <a href="https://bugster.forgerock.org/jira/secure/CreateIssueDetails!init.jspa?pid=10000&components=10007&issuetype=1">Log a documentation bug.</a></p></div>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-23412190-14']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</body></html>