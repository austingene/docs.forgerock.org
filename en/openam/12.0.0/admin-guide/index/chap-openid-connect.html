<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head>

      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
   <title>Chapter&nbsp;13.&nbsp;Managing OpenID Connect 1.0 Authorization</title><link rel="stylesheet" type="text/css" href="coredoc.css"><link rel="stylesheet" type="text/css" href="css/coredoc.css"><link rel="stylesheet" type="text/css" href="sh/shCore.css"><link rel="stylesheet" type="text/css" href="sh/shCoreEclipse.css"><link rel="stylesheet" type="text/css" href="sh/shThemeEclipse.css"><script src="http://code.jquery.com/jquery-1.11.0.min.js" type="text/javascript"></script><script src="uses-jquery.js" type="text/javascript"></script><script src="sh/shCore.js" type="text/javascript"></script><script src="sh/shBrushAci.js" type="text/javascript"></script><script src="sh/shBrushBash.js" type="text/javascript"></script><script src="sh/shBrushCsv.js" type="text/javascript"></script><script src="sh/shBrushHttp.js" type="text/javascript"></script><script src="sh/shBrushJava.js" type="text/javascript"></script><script src="sh/shBrushJScript.js" type="text/javascript"></script><script src="sh/shBrushLDIF.js" type="text/javascript"></script><script src="sh/shBrushPlain.js" type="text/javascript"></script><script src="sh/shBrushProperties.js" type="text/javascript"></script><script src="sh/shBrushXml.js" type="text/javascript"></script><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="OpenAM Administration Guide"><link rel="up" href="index.html" title="OpenAM Administration Guide"><link rel="prev" href="chap-oauth2.html" title="Chapter&nbsp;12.&nbsp;Managing OAuth 2.0 Authorization"><link rel="next" href="chap-saml-1.html" title="Chapter&nbsp;14.&nbsp;Managing SAML 1.x Single Sign-On"><link rel="copyright" href="legalnotice.html" title="Legal Notice"><script type="text/javascript">SyntaxHighlighter.all();</script>
<link rel="shortcut icon" href="http://forgerock.org/favicon.ico">
</head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter&nbsp;13.&nbsp;Managing OpenID Connect 1.0 Authorization</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="chap-oauth2.html">Prev</a>&nbsp;</td><th width="60%" align="center">&nbsp;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="chap-saml-1.html">Next</a></td></tr></table><hr></div><div lang="en" class="chapter"><div class="titlepage"><div><div><h1 class="title"><a name="chap-openid-connect"></a>Chapter&nbsp;13.&nbsp;Managing OpenID Connect 1.0 Authorization</h1></div></div></div><div class="toc"><div class="toc-title">Table of Contents</div><dl class="toc"><dt><span class="section"><a href="chap-openid-connect.html#about-openid-connect-support">13.1. About OpenID Connect 1.0 Support in OpenAM</a></span></dt><dt><span class="section"><a href="chap-openid-connect.html#configure-openid-connect-provider">13.2. Configuring OpenAM As OpenID Provider</a></span></dt><dt><span class="section"><a href="chap-openid-connect.html#configure-openid-connect-discovery">13.3. Configuring OpenAM For OpenID Connect Discovery</a></span></dt><dt><span class="section"><a href="chap-openid-connect.html#register-openid-connect-clients">13.4. Registering OpenID Connect Relying Parties</a></span></dt><dt><span class="section"><a href="chap-openid-connect.html#manage-sessions-openid-connect">13.5. Managing User Sessions</a></span></dt><dt><span class="section"><a href="chap-openid-connect.html#openid-connect-examples">13.6. Relying Party Examples</a></span></dt><dt><span class="section"><a href="chap-openid-connect.html#openid-connect-security-considerations">13.7. Security Considerations</a></span></dt><dt><span class="section"><a href="chap-openid-connect.html#mobile-connect">13.8. Using OpenAM with Mobile Connect</a></span></dt></dl></div><a class="indexterm" name="d0e28938"></a><a class="indexterm" name="d0e28943"></a><p>
  This chapter covers OpenAM support for OpenID Connect 1.0.
  <a class="link" href="http://openid.net/connect/" target="_blank">OpenID Connect</a> 1.0 is an authentication layer built on OAuth 2.0.
  OpenID Connect 1.0 is a specific implementation of OAuth 2.0
  where the identity provider that runs the authorization server
  also holds the protected resource
  that the third-party application aims to access.
  This resource is the <span class="emphasis"><em>UserInfo</em></span>,
  information about the authenticated end user expressed in a standard format.
  In this way OpenID Connect 1.0 allows relying parties
  both to verify the identity of the end user
  and also to obtain user information using REST.
  This contrasts with OAuth 2.0, which only defines the authorization mechanism.
 </p><div class="itemizedlist"><p>
   The names used in OpenID Connect 1.0 differ from those used in OAuth 2.0.
   In OpenID Connect 1.0, the key entities are the following.
  </p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
    The <em class="firstterm">end user</em> (OAuth 2.0 resource owner)
    whose user information the application needs to access.
   </p><p>
    The end user wants to use an application
    through existing identity provider account
    without signing up to and creating credentials for yet another web service.
   </p></li><li class="listitem"><p>
    The <em class="firstterm">Relying Party</em> (RP) (OAuth 2.0 client)
    needs access to the end user's protected user information.
   </p><p>
    For example, an online mail application needs to know which end user
    is accessing the application in order to present the correct inbox.
   </p><p>
    As another example, an online shopping site needs to know which end user
    is accessing the site in order to present
    the right offerings, account, and shopping cart.
   </p></li><li class="listitem"><p>
    The <em class="firstterm">OpenID Provider</em> (OP)
    (OAuth 2.0 authorization server and also resource server)
    that holds the user information and grants access.
   </p><p>
    OpenAM can play this role in an OpenID Connect deployment.
   </p><p>
    The OP effectively has the end user's consent to providing the RP
    with access to some of its user information.
    As OpenID Connect 1.0 defines unique identification for an account
    (subject identifier + issuer identifier),
    the RP can use this as a key to its own user profile.
   </p><p>
    In the case of the online mail application,
    this key could be used to access the mailboxes
    and related account information.
    In the case of the online shopping site,
    this key could be used to access
    the offerings, account, shopping cart and so forth.
    The key makes it possible to serve users as if they had local accounts.
   </p></li></ul></div><p>
  In OpenID Connect the relying party can verify claims
  about the identity of the end user,
  and log the user out at the end of a session.
  OpenID Connect also makes it possible
  to discover the OpenID Provider for an end user,
  and to register relying party client applications dynamically.
  OpenID connect services are built on
  OAuth 2.0, JSON Web Token (JWT), WebFinger and Well-Known URIs.
 </p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="about-openid-connect-support"></a>13.1.&nbsp;About OpenID Connect 1.0 Support in OpenAM</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="chap-openid-connect.html#openam-openid-basic-client-profile">13.1.1. OpenID Connect Authorization Code Flow</a></span></dt><dt><span class="section"><a href="chap-openid-connect.html#openam-openid-implicit-client-profile">13.1.2. OpenID Connect Implicit Flow</a></span></dt><dt><span class="section"><a href="chap-openid-connect.html#openam-openid-discovery">13.1.3. OpenID Connect Discovery</a></span></dt><dt><span class="section"><a href="chap-openid-connect.html#openam-openid-client-registration">13.1.4. OpenID Connect Relying Party Registration</a></span></dt><dt><span class="section"><a href="chap-openid-connect.html#openam-openid-session-management">13.1.5. OpenID Connect Session Management</a></span></dt></dl></div><p>
   In its role as OpenID Provider, OpenAM
   lets OpenID Connect relying parties (clients) discover its capabilities,
   handles both dynamic and static registration of OpenID Connect relying parties,
   responds to relying party requests with authorization codes, access tokens,
   and user information
   according to the Authorization Code and Implicit flows of OpenID Connect,
   and manages sessions.
  </p><p>
   This section describes how OpenAM fits into the OpenID Connect picture
   in terms of the roles that it plays
   in the authorization code and implicit flows,
   provider discovery, client registration, and session management.
  </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="openam-openid-basic-client-profile"></a>13.1.1.&nbsp;OpenID Connect Authorization Code Flow</h3></div></div></div><p>
    The OpenID Connect Authorization Code Flow specifies
    how the relying party interacts with the OpenID Provider,
    in this case OpenAM,
    based on use of the OAuth 2.0 authorization grant.
    The following sequence diagram shows successful processing
    from the authorization request,
    through grant of the authorization code, access token, and ID token,
    and optional use of the access token to get information about the end user.
   </p><div class="mediaobject" align="center"><a name="figure-openid-connect-basic"></a><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/openid-connect-basic.png" align="middle" height="360" alt="OpenAM in OpenID Connect Authorization Code Flow"></td></tr></table><div class="longdesc-link" align="right"><br clear="all"><span class="longdesc-link">[<a href="figure-openid-connect-basic.html" target="longdesc">D</a>]</span></div></div><p>
    In addition to what OAuth 2.0 specifies,
    OpenID Connect uses an ID token
    so the relying party can validate claims about the end user.
    It also defines how to get user information
    such as profile, email, address, and phone details
    from the UserInfo endpoint with a valid access token.
   </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="openam-openid-implicit-client-profile"></a>13.1.2.&nbsp;OpenID Connect Implicit Flow</h3></div></div></div><p>
    The OpenID Connect Implicit Flow specifies
    how the relying party interacts with the OpenID Provider,
    in this case OpenAM,
    based on use of the OAuth 2.0 implicit grant.
    The following sequence diagram shows successful processing
    from the authorization request,
    through grant of the access and ID tokens,
    and optional use of the access token to get information about the end user.
   </p><div class="mediaobject" align="center"><a name="figure-openid-connect-implicit"></a><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/openid-connect-implicit.png" align="middle" height="360" alt="OpenAM in OpenID Connect Implicit Flow"></td></tr></table><div class="longdesc-link" align="right"><br clear="all"><span class="longdesc-link">[<a href="figure-openid-connect-implicit.html" target="longdesc">D</a>]</span></div></div><p>
    As for the Authorization Code Flow, the Implicit Flow specifies
    an ID token so that the relying party can validate claims about the end user.
    It also defines how to get user information
    such as profile, email, address, and phone details
    from the UserInfo endpoint with a valid access token.
   </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="openam-openid-discovery"></a>13.1.3.&nbsp;OpenID Connect Discovery</h3></div></div></div><p>OpenID Connect defines how a relying party can discover the
   OpenID Provider and corresponding OpenID Connect configuration for
   an end user. The discovery mechanism relies on WebFinger to get the
   information based on the end user's identifier. The server returns the
   information in JSON Resource Descriptor (JRD) format.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="openam-openid-client-registration"></a>13.1.4.&nbsp;OpenID Connect Relying Party Registration</h3></div></div></div><p>
    OpenID Connect relying parties register OAuth 2.0 client profiles with OpenAM.
    Relying parties can register with OpenAM as a provider both statically,
    as for other OAuth 2.0 clients,
    and also dynamically as specified by OpenID Connect Discovery.
    To allow dynamic registration, you register an initial OAuth 2.0 client
    that other relying parties can use to get access tokens for registration.
   </p><p>
    You can also enable OpenID Connect relying parties to register dynamically
    without having to provide an access token.
    For details, see the documentation on the advanced server property,
    <code class="literal">org.forgerock.openam.openidconnect.allow.open.dynamic.registration</code>,
    in the <em class="citetitle">OpenAM Reference</em> section,
    <a href="../../reference/index/chap-config-ref.html#servers-advanced-configuration" class="link"><em class="citetitle">Servers &gt; Advanced</em></a>.
    Take care to limit or throttle dynamic registration
    if you enable this capability on production systems.
   </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="openam-openid-session-management"></a>13.1.5.&nbsp;OpenID Connect Session Management</h3></div></div></div><p>OpenID Connect lets the relying party track whether the end user is logged in
   at the provider, and also initiate end user logout at the provider. The
   specification has the relying party monitor session state using an
   invisible iframe and communicate status using the HTML 5 postMessage
   API.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="configure-openid-connect-provider"></a>13.2.&nbsp;Configuring OpenAM As OpenID Provider</h2></div></div></div><p>
   You can configure OpenAM's OAuth 2.0 authorization service
   to double as an OpenID Provider.
  </p><p>
   First, follow the instructions for
   <a href="../../admin-guide/index/chap-oauth2.html#configure-oauth2-authz" class="link"><em class="citetitle">Configuring the OAuth 2.0 Authorization Service</em></a>,
   making sure that the Response Type Plugins list includes
   at least the default plugin classes.
  </p><div class="itemizedlist"><p>
    Next, configure the OpenID Connect specific options.
   </p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
     The optional Remote JSON Web Key URL field allows you to set a URL to a
     <a class="link" href="https://tools.ietf.org/html/draft-ietf-jose-json-web-key" target="_blank">JSON Web Key set</a>
     with the public key(s) for the provider.
    </p><p>
     If this setting is not configured, then OpenAM provides a local URL
     to access the public key of the private key used to sign ID tokens.
    </p></li><li class="listitem"><p>
     The Subject Types supported map allows you to support pairwise subject types
     as described in the OpenID Connect core specification section concerning
     <a class="link" href="http://openid.net/specs/openid-connect-core-1_0.html#SubjectIDTypes" target="_blank">Subject Identifier Types</a>.
    </p></li><li class="listitem"><p>
     The ID Token Signing Algorithms supported list allows you
     to change the list of algorithms used sign ID Tokens.
    </p></li><li class="listitem"><p>
     The Supported Claims list allows you
     to restrict the claims supported by OpenAM's userinfo endpoint.
    </p></li><li class="listitem"><p>
     The Alias of ID Token Signing Key alias allows you
     to set the key pair alias for the key used to sign ID Tokens
     when using a signing algorithm that involves asymmetric keys.
    </p><p>
     For instructions on changing the key pair, see
     <a href="../../admin-guide/index/chap-certs-keystores.html#change-signing-key" class="link"><em class="citetitle">To Change the Signing Key for Federation</em></a>.
    </p></li><li class="listitem"><p>
     The Allow Open Dynamic Client Registration checkbox enables relying parties
     to register without using an access token.
    </p></li><li class="listitem"><p>
     The Generate Registration Access Tokens checkbox has OpenAM generate
     Registration Access Tokens for dynamic client registration when
     Allow Open Dynamic Client Registration is enabled.
     This allows the client to view and update its registration.
    </p></li></ul></div><p>
   Finally, if your provider is part of a GSMA Mobile Connect deployment, see
   <a class="xref" href="chap-openid-connect.html#mobile-connect-configure" title="Procedure&nbsp;13.3.&nbsp;Configuring OpenAM as an OP for Mobile Connect">Procedure&nbsp;13.3, &#8220;Configuring OpenAM as an OP for Mobile Connect&#8221;</a>.
  </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="configure-openid-connect-discovery"></a>13.3.&nbsp;Configuring OpenAM For OpenID Connect Discovery</h2></div></div></div><p>
   In order to allow relying parties to discover
   the OpenID Provider for an end user,
   OpenAM supports OpenID Connect Discovery 1.0.
   In addition to discovering the OpenID Provider for an end user,
   the relying party can also request the OpenID Provider configuration.
  </p><p>OpenAM as OpenID Provider exposes two endpoints for
  discovery:</p><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="literal">/.well-known/webfinger</code></td></tr><tr><td><code class="literal">/.well-known/openid-configuration</code></td></tr></table><p>
   A relying party needs to be able to discover the OpenID provider for an end user.
   In this case you should consider redirecting requests to URIs at the server root,
   such as <code class="literal">http://www.example.com/.well-known/webfinger</code>
   and <code class="literal">http://www.example.com/.well-known/openid-configuration</code>,
   to these Well-Known URIs in OpenAM's space.
  </p><p>Discovery relies on <a class="link" href="http://tools.ietf.org/html/draft-ietf-appsawg-webfinger" target="_blank">WebFinger</a>, a protocol to discover information about people and other
  entities using standard HTTP methods. WebFinger uses <a class="link" href="http://tools.ietf.org/html/rfc5785" target="_blank">Well-Known URIs</a>,
  which defines the path prefix <code class="literal">/.well-known/</code> for the
  URLs defined by OpenID Connect Discovery.</p><p>Unless you deploy OpenAM in the root context of a container listening
  on port 80 on the primary host for your domain, relying parties need to find
  the right <em class="replaceable"><code>host:port/deployment-uri</code></em> combination
  to locate the well-known endpoints. Therefore you must manage the redirection
  to OpenAM. If you are using WebFinger for something else than OpenID Connect
  Discovery, then you probably also need proxy logic to route the requests.</p><p>
   To retrieve the OpenID Provider for an end user,
   the relying party needs the following.
  </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">host</code></span></dt><dd><p>The server where the relying party can access the WebFinger service.</p><p>Notice that this is a host name rather than a URL to the endpoint,
     which is why you might need to redirect relying parties appropriately as described
     above.</p></dd><dt><span class="term"><code class="literal">resource</code></span></dt><dd><p>Identifies the end user that is the subject of the request.</p><p>The relying party must percent-encode the resource value when using it in
     the query string of the request, so when using the "acct" URI scheme and
     the resource is <code class="literal">acct:user@example.com</code>, then the value
     to use is <code class="literal">acct%3Auser%40example.com</code>.</p></dd><dt><span class="term"><code class="literal">rel</code></span></dt><dd><p>URI identifying the type of service whose location is requested.</p><p>In this case <code class="literal">http://openid.net/specs/connect/1.0/issuer</code>,
     which is <code class="literal">http%3A%2F%2Fopenid.net%2Fspecs%2Fconnect%2F1.0%2Fissuer</code>.</p></dd></dl></div><p>Ignoring the question of redirection, you can test the endpoint for the
  demo user account (output lines folded to make them easier to read).</p><div class="screen"><pre>
$ <strong>curl \
 "https://openam.example.com:8443/openam/.well-known/webfinger\
?resource=acct%3Ademo%40example.com\
&amp;rel=http%3A%2F%2Fopenid.net%2Fspecs%2Fconnect%2F1.0%2Fissuer"</strong>
<em>{
  "subject": "acct:demo@example.com",
  "links": [
    {
      "rel": "http://openid.net/specs/connect/1.0/issuer",
      "href": "https://openam.example.com:8443/openam"
    }
  ]
}</em>
  </pre></div><p>This shows that the OpenID Provider for the OpenAM demo user is
  indeed the OpenAM server.</p><p>
   The relying party can also discover the OpenID provider configuration.
   Ignoring the question of redirection, you can test this
   (output lines folded to make them easier to read).
  </p><div class="informalexample"><div class="screen"><pre>
$ <strong>curl https://openam.example.com:8443/openam/.well-known/openid-configuration</strong>
<em>{
    "response_types_supported": [
        "token id_token",
        "code token",
        "code token id_token",
        "token",
        "code id_token",
        "code",
        "id_token"
    ],
    "registration_endpoint": "https://openam.example.com:8443/openam/oauth2/connect/register",
    "token_endpoint": "https://openam.example.com:8443/openam/oauth2/access_token",
    "end_session_endpoint": "https://openam.example.com:8443/openam/oauth2/connect/endSession",
    "version": "3.0",
    "userinfo_endpoint": "https://openam.example.com:8443/openam/oauth2/userinfo",
    "subject_types_supported": [
        "public"
    ],
    "issuer": "https://openam.example.com:8443/openam",
    "jwks_uri": "https://openam.example.com:8443/openam/oauth2/connect/jwk_uri?realm=/",
    "id_token_signing_alg_values_supported": [
        "HS256",
        "HS512",
        "RS256",
        "HS384"
    ],
    "check_session_iframe": "https://openam.example.com:8443/openam/oauth2/connect/checkSession",
    "claims_supported": [
        "phone",
        "email",
        "address",
        "openid",
        "profile"
    ],
    "authorization_endpoint": "https://openam.example.com:8443/openam/oauth2/authorize"
}</em>
  </pre></div></div><p>
   When the OpenID Provider is configured in a subrealm,
   then relying parties can get the configuration
   by passing the realm as a query string parameter, as in
   <code class="literal">https://openam.example.com:8443/openam/.well-known/openid-configuration?realm=<em class="replaceable"><code>realm-name</code></em></code>.
  </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="register-openid-connect-clients"></a>13.4.&nbsp;Registering OpenID Connect Relying Parties</h2></div></div></div><p>
   OpenID Connect relying parties can register with OpenAM
   both statically through OpenAM console for example,
   and also dynamically using OpenID Connect 1.0 Dynamic Registration.
  </p><div class="procedure"><a name="register-openid-connect-client-static"></a><div class="procedure-title">Procedure&nbsp;13.1.&nbsp;To Register a Relying Party With OpenAM Console</div><p>Registering a relying party by using the OpenAM console consists of first
   creating an OAuth 2.0 Client agent profile, and then editing the profile
   for the settings pertinent to OpenID Connect 1.0.</p><ol class="procedure" type="1"><li class="step"><p>In the OpenAM console under Access Control &gt; <em class="replaceable"><code>Realm
    Name</code></em> &gt; Agents &gt; OAuth 2.0 Client &gt; Agent, click
    New..., then provide the client identifier and client password, and
    finally click Create to create the profile.</p></li><li class="step"><p>Follow the hints in the section, <a href="../../admin-guide/index/chap-agents.html#configure-oauth2-client" class="link"><em class="citetitle">Configuring
    OAuth 2.0 &amp; OpenID Connect 1.0 Clients</em></a> to edit
    the profile to match the relying party configuration.</p><p>In order to read and edit the relying party profile dynamically later
    without using OpenAM console, be sure to set an access token in the Access
    Token field.</p></li></ol></div><div class="procedure"><a name="register-openid-connect-client-dynamic"></a><div class="procedure-title">Procedure&nbsp;13.2.&nbsp;To Register a Relying Party Dynamically</div><p>For dynamic registration you need the relying party profile data,
   and an access token to write the configuration to OpenAM by HTTP POST. To
   obtain the access token, register an initial client statically after creating
   the provider, as described in
   <a class="xref" href="chap-openid-connect.html#register-openid-connect-client-static" title="Procedure&nbsp;13.1.&nbsp;To Register a Relying Party With OpenAM Console">Procedure&nbsp;13.1, &#8220;To Register a Relying Party With OpenAM Console&#8221;</a>. Relying parties can
   then use that client to obtain the access token needed to perform dynamic
   registration.</p><div class="tip"><h3 class="title">Tip</h3><p>
     As described in <a class="xref" href="chap-openid-connect.html#openam-openid-client-registration" title="13.1.4.&nbsp;OpenID Connect Relying Party Registration">Section&nbsp;13.1.4, &#8220;OpenID Connect Relying Party Registration&#8221;</a>,
     You can allow relying parties to register without having an access token
     by setting the advanced server property,
     <code class="literal">org.forgerock.openam.openidconnect.allow.open.dynamic.registration</code>,
     to <code class="literal">true</code>.
     When using that setting in production systems,
     take care to limit or throttle dynamic registration.
    </p></div><p>On successful registration, OpenAM responds with information including
   an access token to allow the relying party subsequently to read and edit its
   profile.</p><ol class="procedure" type="1"><li class="step"><p>Register an initial OAuth 2.0 client statically with a client ID
    such as <code class="literal">masterClient</code> and client secret such as
    <code class="literal">password</code>.</p></li><li class="step"><p>Obtain an access token using the client you registered.</p><p>For example, if you created the client as described in the previous
    step, and OpenAM administrator <code class="literal">amadmin</code> has password
    <code class="literal">password</code>, you can use the OAuth 2.0 resource owner
    password grant as in the following example.</p><div class="screen"><pre>
$ <strong>curl \
 --request POST \
 --user "masterClient:password" \
 --data "grant_type=password&amp;username=amadmin&amp;password=password" \
 https://openam.example.com:8443/openam/oauth2/access_token</strong>
<em>{
    "expires_in": 59,
    "token_type": "Bearer",
    "refresh_token": "26938cd0-6870-4e31-ade9-df31afc37ee1",
    "access_token": "515d6551-4512-4279-98b6-c0ef3f03a722"
}</em>
    </pre></div></li><li class="step"><p>HTTP POST the relying party registration profile to the
    <code class="literal">/oauth2/connect/register</code> endpoint, using bearer token
    authorization with the access token you obtained from OpenAM.</p><p>For an example written in JavaScript, see the registration page in
    the examples <a class="link" href="https://github.com/markcraig/openid/" target="_blank">available online</a>.
    Successful registration shows a response that includes the client ID and
    client secret. Lines are folded in the following example.</p><pre class="brush: javascript;">
{
  "issued_at": 1392364349,
  "expires_at": 0,
  "client_secret": "7f446ca9-3f1f-48fb-bf8c-150b9e643f29",
  "redirect_uris": [
    "https://openam.example.com:8443/openid/cb-basic.html",
    "https://openam.example.com:8443/openid/cb-implicit.html"
  ],
  "registration_access_token": "515d6551-4512-4279-98b6-c0ef3f03a722",
  "client_id": "6e4abd50-3f03-41dc-b807-c6705c3e45d7",
  "registration_client_uri":
     "https://openam.example.com:8443/openam/oauth2/connect/register
     ?client_id=6e4abd50-3f03-41dc-b807-c6705c3e45d7"
}
    </pre></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="manage-sessions-openid-connect"></a>13.5.&nbsp;Managing User Sessions</h2></div></div></div><p>OpenID Connect Session Management 1.0 allows the relying party to manage
  OpenID Connect sessions, making it possible to know when the end user should
  be logged out.</p><p>As described in the <a class="link" href="http://openid.net/specs/openid-connect-session-1_0.html" target="_blank">OpenID Connect Session Management 1.0</a> specification,
  OpenAM's OpenID Provider exposes both a "check_session_iframe" URL
  that allows the relying party to receive notifications when the end user's session
  state changes at the provider, and also an "end_session_endpoint" URL to
  which to redirect an end user for logout.</p><p>When registering your relying party that uses session management, you set the
  OAuth 2.0 client agent profile properties Post Logout Redirect URI and
  Client Session URI, described in <a href="../../admin-guide/index/chap-agents.html#configure-oauth2-client" class="link"><em class="citetitle">Configuring
  OAuth 2.0 &amp; OpenID Connect 1.0 Clients</em></a>. The Post
  Logout Redirect URI is used to redirect the end user user-agent after logout.
  The Client Session URI is the relying party URI where OpenAM sends notifications
  when the end user's session state changes.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="openid-connect-examples"></a>13.6.&nbsp;Relying Party Examples</h2></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="chap-openid-connect.html#openid-basic-profile-example">13.6.1. Authorization Code Flow Example</a></span></dt><dt><span class="section"><a href="chap-openid-connect.html#openid-implicit-profile-example">13.6.2. Implicit Flow Example</a></span></dt></dl></div><p>
   OpenID Connect Authorization Code Flow and Implicit Flow
   define how clients interact with the provider
   to obtain end user authorization and profile information.
   Although you can run the simple example relying parties
   that are mentioned in this section
   without setting up Transport Layer Security,
   do not deploy relying parties in production without securing the transport.
  </p><p>
   Code for the relying party examples shown here is
   <a class="link" href="https://github.com/markcraig/openid/" target="_blank">available online</a>.
   Clone the example project to deploy it in the same web container as OpenAM.
   Edit the configuration at the outset of the .js files in the project,
   register a corresponding profile for the example relying party
   as described in <a class="xref" href="chap-openid-connect.html#register-openid-connect-clients" title="13.4.&nbsp;Registering OpenID Connect Relying Parties">Section&nbsp;13.4, &#8220;Registering OpenID Connect Relying Parties&#8221;</a>,
   and browse the deployment URL to see the initial page.
  </p><div class="mediaobject" align="center"><a name="figure-openid-connect-example-start-page"></a><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/openid-connect-example-start-page.png" align="middle" height="360" alt="OpenID Connect Client Profiles Start Page"></td></tr></table><div class="longdesc-link" align="right"><br clear="all"><span class="longdesc-link">[<a href="figure-openid-connect-example-start-page.html" target="longdesc">D</a>]</span></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="openid-basic-profile-example"></a>13.6.1.&nbsp;Authorization Code Flow Example</h3></div></div></div><p>
    OpenID Connect Authorization Code Flow is designed
    for web-based relying parties
    that use the OAuth 2.0 Authorization Code grant type.
    This grant type makes it possible for the relying party
    to get the access code by using the authorization code directly,
    without passing through the end user's browser.
    To protect its client secret (password),
    part of the relying party must run on a server.
   </p><p>
    In the example, the Basic Client Profile Start Page
    describes the prerequisite configuration,
    which must be part of the relying party profile
    that is stored in the OpenAM realm where you set up the OpenID Provider.
    In OpenAM console,
    check that the OAuth 2.0 client profile matches the settings described.
   </p><div class="mediaobject" align="center"><a name="figure-openid-connect-basic-start-page"></a><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/openid-connect-basic-start-page.png" align="middle" height="360" alt="OpenID Connect Basic Client Profile Start Page"></td></tr></table><div class="longdesc-link" align="right"><br clear="all"><span class="longdesc-link">[<a href="figure-openid-connect-basic-start-page.html" target="longdesc">D</a>]</span></div></div><p>
    Logout of OpenAM,
    and click the link at the bottom of the page to request authorization.
    The link sends an HTTP GET request
    asking for <code class="literal">openid profile</code> scopes
    to the OpenID Provider authorization URI.
   </p><p>
    If everything is configured correctly,
    OpenAM's OpenID Provider has you authenticate as an end user,
    such as the demo user
    with username <code class="literal">demo</code> and password <code class="literal">changeit</code>,
    and grant (Allow) the relying party access to your profile.
   </p><p>
    If you successfully authenticate
    and allow the example relying party access to your profile,
    OpenAM returns an authorization code to the example relying party.
    The example relying party then uses the authorization code
    to request an access token and an ID token.
    It shows the response to that request.
    It also validates the ID token signature using the default (HS256) algorithm,
    and decodes the ID token to validate its content and show it in the output.
    Finally it uses the access token
    to request information about the end user who authenticated,
    and displays the result.
   </p><div class="mediaobject" align="center"><a name="figure-openid-connect-basic-response-page"></a><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/openid-connect-basic-response-page.png" align="middle" height="360" alt="OpenID Connect Basic Client Profile Response Page"></td></tr></table><div class="longdesc-link" align="right"><br clear="all"><span class="longdesc-link">[<a href="figure-openid-connect-basic-response-page.html" target="longdesc">D</a>]</span></div></div><p>
    Notice that in addition to the standard payload,
    the ID token indicates the end user's OpenAM realm,
    in this case <code class="literal">"realm": "/"</code>.
   </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="openid-implicit-profile-example"></a>13.6.2.&nbsp;Implicit Flow Example</h3></div></div></div><p>
    OpenID Connect Implicit Flow is designed
    for relying parties that use the OAuth 2.0 Implicit grant type.
    This grant type is designed for relying parties implemented in a browser.
    Rather than protect a client secret, the client profile must
    register a protected redirect URI in advance with the OpenID Provider.
   </p><p>
    In the example,
    the Implicit Client Profile Start Page describes the prerequisite configuration,
    which must be part of the relying party profile
    that is stored in the OpenAM realm where you set up the OpenID Provider.
    In OpenAM console,
    check that the OAuth 2.0 client profile matches the settings described.
    If you have already configured the agent profile
    for the Authorization Code Flow example
    then you still need to add the redirect URI for the Implicit Flow.
   </p><div class="mediaobject" align="center"><a name="figure-openid-connect-implicit-start-page"></a><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/openid-connect-implicit-start-page.png" align="middle" height="360" alt="OpenID Connect Implicit Client Profile Start Page"></td></tr></table><div class="longdesc-link" align="right"><br clear="all"><span class="longdesc-link">[<a href="figure-openid-connect-implicit-start-page.html" target="longdesc">D</a>]</span></div></div><p>
    Logout of OpenAM,
    and click the link at the bottom of the page to request authorization.
    The link sends an HTTP GET request asking
    for <code class="literal">id_token token</code> response types
    and <code class="literal">openid profile</code> scopes
    to the OpenID Provider authorization URI.
   </p><p>
    If everything is configured correctly,
    OpenAM's OpenID Provider has you authenticate as an end user,
    such as the demo user
    with username <code class="literal">demo</code> and password <code class="literal">changeit</code>,
    and grant (Allow) the relying party access to your profile.
   </p><p>
    If you successfully authenticate
    and allow the example relying party access to your profile,
    OpenAM returns the access token and ID token
    directly in the fragment (after <code class="literal">#</code>) of the redirect URI.
    The relying party does not get an authorization code.
    The relying party shows the response to the request.
    It also validates the ID token signature using the default (HS256) algorithm,
    and decodes the ID token to validate its content and show it in the output.
    Finally the relying party uses the access token
    to request information about the end user who authenticated,
    and displays the result.
   </p><div class="mediaobject" align="center"><a name="figure-openid-connect-implicit-response-page"></a><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td align="center"><img src="images/openid-connect-implicit-response-page.png" align="middle" height="360" alt="OpenID Connect Implicit Client Profile Response Page"></td></tr></table><div class="longdesc-link" align="right"><br clear="all"><span class="longdesc-link">[<a href="figure-openid-connect-implicit-response-page.html" target="longdesc">D</a>]</span></div></div><p>
    As for the Authorization Code Flow example,
    the ID Token indicates the end user's
    OpenAM realm and OpenAM token ID in addition to the standard information.
   </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="openid-connect-security-considerations"></a>13.7.&nbsp;Security Considerations</h2></div></div></div><p>As for other OAuth 2.0 applications, you must protect messages going
  across the network. OpenID Connect 1.0 requires Transport Layer Security
  (TLS). The chapter on <a href="../../admin-guide/index/chap-certs-keystores.html" class="link"><em class="citetitle">Managing
  Certificates</em></a> includes some discussion of protecting
  traffic in the container where OpenAM runs. Also see the documentation for
  your web application container.</p><p>Also take into account the points developed in the section on <a class="link" href="http://openid.net/specs/openid-connect-messages-1_0.html#security-considerations" target="_blank"><em class="citetitle">Security Considerations</em></a> in
  the OpenID Connect Messages draft specification.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="mobile-connect"></a>13.8.&nbsp;Using OpenAM with Mobile Connect</h2></div></div></div><p>
   <a class="link" href="http://gsmamobileeconomy.com/gsmamc/" target="_blank">GSMA Mobile Connect</a> is an application of OpenID Connect (OIDC).
   Mobile Connect builds on OIDC
   to facilitate use of mobile phones as authentication devices
   independently of the service provided
   and independently of the device used to consume the service.
   Mobile Connect thus offers a standard way for Mobile Network Operators
   to act as general-purpose identity providers,
   providing a range of levels of assurance and profile data
   to Mobile Connect-compliant Service Providers.
  </p><div class="itemizedlist"><p>
    This section includes an overview, as well as the following.
   </p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>
     <a class="xref" href="chap-openid-connect.html#mobile-connect-table-auth-request-params" title="Table&nbsp;13.1.&nbsp;Authorization Request Parameters">Table&nbsp;13.1, &#8220;Authorization Request Parameters&#8221;</a>
    </p></li><li class="listitem"><p>
     <a class="xref" href="chap-openid-connect.html#mobile-connect-table-id-token-properties" title="Table&nbsp;13.2.&nbsp;ID Token Properties">Table&nbsp;13.2, &#8220;ID Token Properties&#8221;</a>
    </p></li><li class="listitem"><p>
     <a class="xref" href="chap-openid-connect.html#mobile-connect-configure" title="Procedure&nbsp;13.3.&nbsp;Configuring OpenAM as an OP for Mobile Connect">Procedure&nbsp;13.3, &#8220;Configuring OpenAM as an OP for Mobile Connect&#8221;</a>
    </p></li></ul></div><p>
   In a Mobile Connect deployment OpenAM can play the OpenID Provider role,
   implementing the Mobile Connect Profile
   as part of the Service Provider - Identity Gateway interface.
  </p><p>
   OpenAM can also play the Authenticator role
   as part of the Identity Gateway - Authenticators interface.
   In this role, OpenAM serves to authenticate users
   at the appropriate Level of Assurance (LoA).
   In Mobile Connect, LoAs represent the authentication level achieved.
   A Service Provider can request LoAs without regard to the implementation,
   and the Identity Gateway includes a claim in the ID Token
   that indicates the LoA achieved.
  </p><p>
   In OpenAM, Mobile Connect LoAs map to an authentication mechanism.
   Service Providers acting as OpenID Relying Parties (RP) request an LoA
   by using the "acr_values" field in an OIDC authentication request.
   In OIDC, "acr_values" specifies Authentication Context Class Reference values.
   The RP sets "acr_values" as part of the OIDC Authentication Request.
   OpenAM returns the corresponding "acr" claim in the Authentication Response
   as the value of the ID Token "acr" field.
  </p><p>
   OpenAM as OP supports LoAs 1 (low - little or no confidence),
   2 (medium - some confidence, as in single-factor authentication),
   and 3 (high - high confidence, as in multi-factor authentication),
   though out of the box it does not include support for 4,
   which involves digital signatures.
  </p><p>
   As Mobile Connect OP, OpenAM supports mandatory request parameters,
   and a number of optional request parameters.
  </p><div class="table"><a name="mobile-connect-table-auth-request-params"></a><div class="table-title">Table&nbsp;13.1.&nbsp;Authorization Request Parameters</div><div class="table-contents"><table summary="Authorization Request Parameters" border="0"><colgroup><col width="33%"><col width="16%"><col width="51%"></colgroup><thead><tr><th>Request Parameter</th><th>Support</th><th>Description</th></tr></thead><tbody><tr><td>
       <p>
        <code class="literal">response_type</code>
       </p>
      </td><td>
       <p>
        Supported
       </p>
      </td><td>
       <p>
        OAuth 2.0 grant type to use.
        Set this to <code class="literal">code</code> for the authorization grant.
       </p>
      </td></tr><tr><td>
       <p>
        <code class="literal">client_id</code>
       </p>
      </td><td>
       <p>
        Supported
       </p>
      </td><td>
       <p>
        Set this to the client identifier.
       </p>
      </td></tr><tr><td>
       <p>
        <code class="literal">scope</code>
       </p>
      </td><td>
       <p>
        Supported
       </p>
      </td><td>
       <p>
        Space delimited OAuth 2.0 scope values.
       </p>

       <p>
        Required: <code class="literal">openid</code>
       </p>

       <p>
        Optional: <code class="literal">profile</code>, <code class="literal">email</code>,
        <code class="literal">address</code>, <code class="literal">phone</code>,
        <code class="literal">offline_access</code>
       </p>
      </td></tr><tr><td>
       <p>
        <code class="literal">redirect_uri</code>
       </p>
      </td><td>
       <p>
        Supported
       </p>
      </td><td>
       <p>
        OAuth 2.0 URI where the authorization request callback should go.
        Must match the <code class="literal">redirect_uri</code> in the client profile
        that you registered with OpenAM.
       </p>
      </td></tr><tr><td>
       <code class="literal">state</code>
      </td><td>
       <p>
        Supported
       </p>
      </td><td>
       <p>
        Value to maintain state between the request and the callback.
        Required for Mobile Connect.
       </p>
      </td></tr><tr><td>
       <code class="literal">nonce</code>
      </td><td>
       <p>
        Supported
       </p>
      </td><td>
       <p>
        String value to associate the client session with the ID Token.
        Optional in OIDC, but required for Mobile Connect.
       </p>
      </td></tr><tr><td>
       <code class="literal">display</code>
      </td><td>
       <p>
        Supported
       </p>
      </td><td>
       <p>
        String value to specify the user interface display.
       </p>
      </td></tr><tr><td>
       <code class="literal">login_hint</code>
      </td><td>
       <p>
        Supported
       </p>
      </td><td>
       <p>
        String value indicating the the ID to use for login.
       </p>

       <p>
        When provided as part of the OIDC Authentication Request,
        the <code class="literal">login_hint</code> is set
        as the value of a cookie named oidcLoginHint,
        which is an HttpOnly cookie (only sent over HTTPS).
        Authentication modules can then retrieve the cookie's value.
       </p>
      </td></tr><tr><td>
       <code class="literal">acr_values</code>
      </td><td>
       <p>
        Supported
       </p>
      </td><td>
       <p>
        Authentication Context class Reference values
        used to communicate acceptable LoAs.
       </p>

       <p>
        When the OIDC relying party on the server provider
        supplies <code class="literal">acr_values</code> in the authorization request,
        OpenAM uses the OP configuration to map the values
        to authentication chains.
        It runs through the list of <code class="literal">acr_values</code> in order,
        attempting to use the first authentication chain that matches.
        OpenAM then returns the authentication chain used
        as the value of the ID token "acr" claims property.
        In this way the relying part on the service provider
        can determine the LoA achieved during authentication.
       </p>
      </td></tr><tr><td>
       <code class="literal">dtbs</code>
      </td><td>
       <p>
        Not supported
       </p>
      </td><td>
       <p>
        Data To Be Signed
       </p>

       <p>
        At present OpenAM does not support LoA 4.
       </p>
      </td></tr></tbody></table></div></div><br class="table-break"><p>
   As Mobile Connect OP, OpenAM responds to a successful authorization request
   with a response containing all the required fields,
   and also the optional "expires_in" field.
   OpenAM supports the mandatory ID Token properties,
   though the relying party is expected to use the "expires_in" value,
   rather than specifying <code class="literal">max_age</code> as a request parameter.
  </p><div class="table"><a name="mobile-connect-table-id-token-properties"></a><div class="table-title">Table&nbsp;13.2.&nbsp;ID Token Properties</div><div class="table-contents"><table summary="ID Token Properties" border="0"><colgroup><col width="33%"><col width="16%"><col width="51%"></colgroup><thead><tr><th>Request Parameter</th><th>Support</th><th>Description</th></tr></thead><tbody><tr><td>
       <p>
        <code class="literal">iss</code>
       </p>
      </td><td>
       <p>
        Supported
       </p>
      </td><td>
       <p>
        Issuer identifier
       </p>
      </td></tr><tr><td>
       <p>
        <code class="literal">sub</code>
       </p>
      </td><td>
       <p>
        Supported
       </p>
      </td><td>
       <p>
        Subject identifier
       </p>

       <p>
        By default OpenAM returns the identifier from the user profile.
       </p>
      </td></tr><tr><td>
       <p>
        <code class="literal">aud</code>
       </p>
      </td><td>
       <p>
        Supported
       </p>
      </td><td>
       <p>
        Audience, an array including the <code class="literal">client_id</code>
       </p>
      </td></tr><tr><td>
       <p>
        <code class="literal">exp</code>
       </p>
      </td><td>
       <p>
        Supported
       </p>
      </td><td>
       <p>
        Expiration time in seconds since the epoch
       </p>
      </td></tr><tr><td>
       <p>
        <code class="literal">iat</code>
       </p>
      </td><td>
       <p>
        Supported
       </p>
      </td><td>
       <p>
        Issued at time in seconds since the epoch
       </p>
      </td></tr><tr><td>
       <code class="literal">nonce</code>
      </td><td>
       <p>
        Supported
       </p>
      </td><td>
       <p>
        The nonce supplied in the request
       </p>
      </td></tr><tr><td>
       <p>
        <code class="literal">at_hash</code>
       </p>
      </td><td>
       <p>
        Supported
       </p>
      </td><td>
       <p>
        Base64url encoding of the SHA-256 hash of the "access_token" value
       </p>
      </td></tr><tr><td>
       <p>
        <code class="literal">acr</code>
       </p>
      </td><td>
       <p>
        Supported
       </p>
      </td><td>
       <p>
        Authentication Context class Reference for the LoA achieved
       </p>

       <p>
        For example, if the request specifies
        <code class="literal">acr_values=loa-3 loa-2</code>
        and OpenAM achieves LoA 2, then the ID token includes
        <code class="literal">"acr": "loa-2"</code>.
       </p>
      </td></tr><tr><td>
       <p>
        <code class="literal">amr</code>
       </p>
      </td><td>
       <p>
        Supported
       </p>
      </td><td>
       <p>
        Authentication Methods Reference to indicate the authentication method
       </p>

       <p>
        OpenAM maps these to authentication modules.
       </p>

       <p>
        Suggested values include the following:
        <code class="literal">OK, DEV_PIN, SIM_PIN, UID_PWD, BIOM, HDR, OTP</code>
       </p>
      </td></tr><tr><td>
       <p>
        <code class="literal">azp</code>
       </p>
      </td><td>
       <p>
        Supported
       </p>
      </td><td>
       <p>
        Authorized party identifier, which is the <code class="literal">client_id</code>
       </p>
      </td></tr></tbody></table></div></div><br class="table-break"><p>
   In addition to the standard OIDC user information returned with userinfo,
   OpenAM as OP for Mobile Connect returns the "updated_at" property,
   representing the time last updated as seconds since the epoch.
  </p><div class="procedure"><a name="mobile-connect-configure"></a><div class="procedure-title">Procedure&nbsp;13.3.&nbsp;Configuring OpenAM as an OP for Mobile Connect</div><p>
    You configure OpenAM as an OpenID Provider for Mobile Connect
    by changing the OAuth2 Provider configuration.
   </p><p>
    In OpenAM console, the OAuth2 Provider configuration is
    under Access Control &gt; <em class="replaceable"><code>Realm Name</code></em>
    &gt; Services &gt; OAuth2 Provider for the configuration in a specific realm,
    and under Configuration &gt; Global &gt; OAuth2 Provider
    for the inherited global settings.
   </p><ol class="procedure" type="1"><li class="step"><p>
     Configure OpenAM as an OpenID Provider as described in
     <a class="xref" href="chap-openid-connect.html#configure-openid-connect-provider" title="13.2.&nbsp;Configuring OpenAM As OpenID Provider">Section&nbsp;13.2, &#8220;Configuring OpenAM As OpenID Provider&#8221;</a>.
    </p></li><li class="step"><p>
     For the OpenID Connect acr_values to Auth Chain Mapping,
     configure the mapping between <code class="literal">acr_values</code>
     in the authorization request and OpenAM authentication chains.
    </p><p>
     For example, if the relying party request includes
     <code class="literal">acr_values=loa-3 loa-2</code>
     and the map includes <code class="literal">[loa-2]=ldapService</code>,
     and <code class="literal">[loa-3]=msisdnAndHotpChain</code>,
     then the authentication chain for the request
     is <code class="literal">msisdnPlusHotpChain</code>.
    </p><p>
     The <span class="command"><strong>ssoadm</strong></span> attribute is
     <code class="literal">forgerock-oauth2-provider-loa-mapping</code>.
    </p></li><li class="step"><p>
     For the OpenID Connect default acr claim,
     set the "acr" claim value to return in the ID Token
     when falling back to the default authentication chain.
    </p><p>
     The <span class="command"><strong>ssoadm</strong></span> attribute is
     <code class="literal">forgerock-oauth2-provider-default-acr</code>.
    </p></li><li class="step"><p>
     For the OpenID Connect id_token amr values to Auth Module mappings,
     set the "amr" values to return in the ID Token
     after successfully authenticating with specified authentication modules.
    </p><p>
     For example, you could set <code class="literal">[UID_PWD]=LDAP</code> to return
     <code class="literal">"amr": [ "UID_PWD" ]</code> in the ID Token
     after authenticating with the LDAP module.
    </p><p>
     The <span class="command"><strong>ssoadm</strong></span> attribute is
     <code class="literal">forgerock-oauth2-provider-amr-mappings</code>.
    </p></li><li class="step"><p>
     Configure the identity Data Store attributes used to return
     "updated_at" values in the ID Token.
    </p><p>
     For Mobile Connect clients,
     the user info endpoint returns "updated_at" values in the ID Token.
     If the user profile has never been updated "updated_at"
     reflects creation time.
    </p><p>
     The "updated_at" values are read from the profile attributes you specify.
     When using OpenDJ directory server as an identity Data Store,
     the value is read from the <code class="literal">modifyTimestamp</code> attribute,
     or the <code class="literal">createTimestamp</code> attribute
     for a profile that has never been modified.
    </p><p>
     The <span class="command"><strong>ssoadm</strong></span> attribute
     for Modified Timestamp attribute name is
     <code class="literal">forgerock-oauth2-provider-modified-attribute-name</code>.
    </p><p>
     The <span class="command"><strong>ssoadm</strong></span> attribute is
     for Created Timestamp attribute name is
     <code class="literal">forgerock-oauth2-provider-created-attribute-name</code>.
    </p><p>
     In addition, you must also add these attributes to the list
     of LDAP User Attributes for the data store.
     Otherwise the attributes are not returned when OpenAM reads the user profile.
     To edit the list in OpenAM console, browse to
     Access Control &gt; <em class="replaceable"><code>Realm Name</code></em>
     &gt; Data Stores &gt; <em class="replaceable"><code>Data Store Name</code></em>
     &gt; LDAP User Attributes.
    </p></li></ol></div><p>
   A simple, non-secure GSMA Mobile Connect relying party example is
   <a class="link" href="https://github.com/markcraig/openid" target="_blank">available online</a>.
  </p></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="chap-oauth2.html">Prev</a>&nbsp;</td><td width="20%" align="center">&nbsp;</td><td width="40%" align="right">&nbsp;<a accesskey="n" href="chap-saml-1.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter&nbsp;12.&nbsp;Managing OAuth 2.0 Authorization&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;14.&nbsp;Managing SAML 1.x Single Sign-On</td></tr></table></div><p>&nbsp;</p><div id="footer"><p>Something wrong on this page? <a href="https://bugster.forgerock.org/jira/secure/CreateIssueDetails!init.jspa?pid=10000&components=10007&issuetype=1">Log a documentation bug.</a></p></div>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-23412190-14']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</body></html>